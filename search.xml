<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>ComputerNetwork</title>
    <url>/2023/02/28/ComputerNetwork/</url>
    <content><![CDATA[]]></content>
  </entry>
  <entry>
    <title>C++</title>
    <url>/2023/02/27/C++/</url>
    <content><![CDATA[]]></content>
  </entry>
  <entry>
    <title>DataStructuresAndAlgorithms</title>
    <url>/2023/02/28/DataStructuresAndAlgorithms/</url>
    <content><![CDATA[<h1 id><a href="#" class="headerlink" title></a></h1><h1 id="å¤æ‚åº¦åˆ†æ"><a href="#å¤æ‚åº¦åˆ†æ" class="headerlink" title="å¤æ‚åº¦åˆ†æ"></a>å¤æ‚åº¦åˆ†æ</h1><h1 id="æ•°æ®ç»“æ„"><a href="#æ•°æ®ç»“æ„" class="headerlink" title="æ•°æ®ç»“æ„"></a>æ•°æ®ç»“æ„</h1><h2 id="æ•°ç»„"><a href="#æ•°ç»„" class="headerlink" title="æ•°ç»„"></a>æ•°ç»„</h2><h2 id="é“¾è¡¨"><a href="#é“¾è¡¨" class="headerlink" title="é“¾è¡¨"></a>é“¾è¡¨</h2><h2 id="æ ˆ"><a href="#æ ˆ" class="headerlink" title="æ ˆ"></a>æ ˆ</h2><h2 id="é˜Ÿåˆ—"><a href="#é˜Ÿåˆ—" class="headerlink" title="é˜Ÿåˆ—"></a>é˜Ÿåˆ—</h2><h2 id="å“ˆå¸Œè¡¨"><a href="#å“ˆå¸Œè¡¨" class="headerlink" title="å“ˆå¸Œè¡¨"></a>å“ˆå¸Œè¡¨</h2><h2 id="äºŒå‰æ ‘"><a href="#äºŒå‰æ ‘" class="headerlink" title="äºŒå‰æ ‘"></a>äºŒå‰æ ‘</h2><h2 id="å †"><a href="#å †" class="headerlink" title="å †"></a>å †</h2><h2 id="è·³è¡¨"><a href="#è·³è¡¨" class="headerlink" title="è·³è¡¨"></a>è·³è¡¨</h2><h2 id="å›¾"><a href="#å›¾" class="headerlink" title="å›¾"></a>å›¾</h2><h2 id="Tireæ ‘"><a href="#Tireæ ‘" class="headerlink" title="Tireæ ‘"></a>Tireæ ‘</h2><h1 id="å¸¸è§ç®—æ³•"><a href="#å¸¸è§ç®—æ³•" class="headerlink" title="å¸¸è§ç®—æ³•"></a>å¸¸è§ç®—æ³•</h1><h2 id="æŸ¥æ‰¾"><a href="#æŸ¥æ‰¾" class="headerlink" title="æŸ¥æ‰¾"></a>æŸ¥æ‰¾</h2><h3 id="äºŒåˆ†æŸ¥æ‰¾"><a href="#äºŒåˆ†æŸ¥æ‰¾" class="headerlink" title="äºŒåˆ†æŸ¥æ‰¾"></a>äºŒåˆ†æŸ¥æ‰¾</h3><p>åŠ›æ‰£704ï¼š<a href="https://leetcode.cn/problems/binary-search">https://leetcode.cn/problems/binary-search</a></p>
<p>é¢˜ç›®æè¿°ï¼šç»™å®šä¸€ä¸ª n ä¸ªå…ƒç´ æœ‰åºçš„ï¼ˆå‡åºï¼‰æ•´å‹æ•°ç»„ nums å’Œä¸€ä¸ªç›®æ ‡å€¼ target  ï¼Œå†™ä¸€ä¸ªå‡½æ•°æœç´¢ nums ä¸­çš„ targetï¼Œå¦‚æœç›®æ ‡å€¼å­˜åœ¨è¿”å›ä¸‹æ ‡ï¼Œå¦åˆ™è¿”å› -1ã€‚</p>
<p>ç¤ºä¾‹ä¸€ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">è¾“å…¥: nums = [-1,0,3,5,9,12], target = 9</span><br><span class="line">è¾“å‡º: 4</span><br><span class="line">è§£é‡Š: 9 å‡ºç°åœ¨ nums ä¸­å¹¶ä¸”ä¸‹æ ‡ä¸º 4</span><br></pre></td></tr></table></figure>

<p>ç¤ºä¾‹äºŒï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">è¾“å…¥: nums = [-1,0,3,5,9,12], target = 2</span><br><span class="line">è¾“å‡º: -1</span><br><span class="line">è§£é‡Š: 2 ä¸å­˜åœ¨ nums ä¸­å› æ­¤è¿”å› -1</span><br></pre></td></tr></table></figure>



<p>æ€è·¯ï¼š</p>
<p>ä»£ç ç¤ºä¾‹ã€Javaã€‘</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">search</span><span class="params">(<span class="type">int</span>[] arr, <span class="type">int</span> target)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (target &lt; arr[<span class="number">0</span>] || target &gt; arr[arr.length - <span class="number">1</span>]) &#123;</span><br><span class="line">        <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">int</span> <span class="variable">left</span> <span class="operator">=</span> <span class="number">0</span>, right = arr.length - <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">while</span> (left &lt;= right) &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">mid</span> <span class="operator">=</span> left + (right - left) / <span class="number">2</span>;</span><br><span class="line">        <span class="keyword">if</span> (arr[mid] == target) &#123;</span><br><span class="line">            <span class="keyword">return</span> mid;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (arr[mid] &lt; target) &#123;</span><br><span class="line">            left = mid + <span class="number">1</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (arr[mid] &gt; target) &#123;</span><br><span class="line">            right = mid - <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>











<h2 id="æ’åº"><a href="#æ’åº" class="headerlink" title="æ’åº"></a>æ’åº</h2><h2 id="æœç´¢"><a href="#æœç´¢" class="headerlink" title="æœç´¢"></a>æœç´¢</h2><h3 id="æ·±åº¦æœç´¢"><a href="#æ·±åº¦æœç´¢" class="headerlink" title="æ·±åº¦æœç´¢"></a>æ·±åº¦æœç´¢</h3><h3 id="å¹¿åº¦æœç´¢"><a href="#å¹¿åº¦æœç´¢" class="headerlink" title="å¹¿åº¦æœç´¢"></a>å¹¿åº¦æœç´¢</h3><h2 id="å“ˆå¸Œ"><a href="#å“ˆå¸Œ" class="headerlink" title="å“ˆå¸Œ"></a>å“ˆå¸Œ</h2><h2 id="é€’å½’"><a href="#é€’å½’" class="headerlink" title="é€’å½’"></a>é€’å½’</h2><h2 id="åŠ¨æ€è§„åˆ’"><a href="#åŠ¨æ€è§„åˆ’" class="headerlink" title="åŠ¨æ€è§„åˆ’"></a>åŠ¨æ€è§„åˆ’</h2><h3 id="åŸºæœ¬æ€æƒ³"><a href="#åŸºæœ¬æ€æƒ³" class="headerlink" title="åŸºæœ¬æ€æƒ³"></a>åŸºæœ¬æ€æƒ³</h3><h4 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h4><p>â€‹		åŠ¨æ€è§„åˆ’ï¼ˆDynamic Programmingï¼‰</p>
<h4 id="ä½¿ç”¨åœºæ™¯"><a href="#ä½¿ç”¨åœºæ™¯" class="headerlink" title="ä½¿ç”¨åœºæ™¯"></a>ä½¿ç”¨åœºæ™¯</h4><p>â€‹		é—®é¢˜å«æœ‰é‡å¤çš„å­é—®é¢˜ï¼Œæ¯ä¸€ä¸ªçŠ¶æ€éƒ½ç”±ä¸Šä¸€ä¸ªçŠ¶æ€æ¨å¯¼å¾—åˆ°ã€‚</p>
<h4 id="è§£é¢˜æ­¥éª¤"><a href="#è§£é¢˜æ­¥éª¤" class="headerlink" title="è§£é¢˜æ­¥éª¤"></a>è§£é¢˜æ­¥éª¤</h4><ul>
<li>ç¬¬ä¸€æ­¥ï¼šç¡®å®šæ•°ç»„å«ä¹‰ï¼Œæ— è®ºæ˜¯ä¸€ç»´è¿˜æ˜¯äºŒç»´</li>
<li>ç¬¬äºŒæ­¥ï¼šç¡®å®šçŠ¶æ€æ–¹ç¨‹</li>
<li>ç¬¬ä¸‰æ­¥ï¼šç¡®å®šåˆå§‹å€¼</li>
</ul>
<h4 id="æ–æ³¢é‚£å¥‘æ•°åˆ—"><a href="#æ–æ³¢é‚£å¥‘æ•°åˆ—" class="headerlink" title="æ–æ³¢é‚£å¥‘æ•°åˆ—"></a>æ–æ³¢é‚£å¥‘æ•°åˆ—</h4><p>æ–æ³¢é‚£å¥‘æ•°åˆ—ä½œä¸ºåŠ¨æ€è§„åˆ’çš„ç»å…¸å…¥é—¨ç¤ºä¾‹ï¼Œå¦‚ä¸‹ï¼š</p>
<p>åŠ›æ‰£ï¼š<a href="https://leetcode.cn/problems/fibonacci-number/">https://leetcode.cn/problems/fibonacci-number/</a></p>
<p>æ–æ³¢é‚£å¥‘æ•° ï¼ˆé€šå¸¸ç”¨ F(n) è¡¨ç¤ºï¼‰å½¢æˆçš„åºåˆ—ç§°ä¸º æ–æ³¢é‚£å¥‘æ•°åˆ— ã€‚è¯¥æ•°åˆ—ç”± 0 å’Œ 1 å¼€å§‹ï¼Œåé¢çš„æ¯ä¸€é¡¹æ•°å­—éƒ½æ˜¯å‰é¢ä¸¤é¡¹æ•°å­—çš„å’Œã€‚ä¹Ÿå°±æ˜¯ï¼š</p>
<p>F(0) &#x3D; 0ï¼ŒF(1) &#x3D; 1<br>F(n) &#x3D; F(n - 1) + F(n - 2)ï¼Œå…¶ä¸­ n &gt; 1<br>ç»™å®š n ï¼Œè¯·è®¡ç®— F(n) ã€‚</p>
<p>ç¤ºä¾‹ 1ï¼š</p>
<p>è¾“å…¥ï¼šn &#x3D; 2<br>è¾“å‡ºï¼š1<br>è§£é‡Šï¼šF(2) &#x3D; F(1) + F(0) &#x3D; 1 + 0 &#x3D; 1<br>ç¤ºä¾‹ 2ï¼š</p>
<p>è¾“å…¥ï¼šn &#x3D; 3<br>è¾“å‡ºï¼š2<br>è§£é‡Šï¼šF(3) &#x3D; F(2) + F(1) &#x3D; 1 + 1 &#x3D; 2</p>
<p>ã€æ–¹æ¡ˆä¸€ï¼šé€’å½’ã€‘</p>
<p>é€’å½’çš„æ€è·¯æ˜¯æœ€æ¸…æ™°çš„ã€‚</p>
<p>ä»£ç å®ç°ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * é€’å½’å®ç° F(n) = F(n-1) + F(n-2)</span></span><br><span class="line"><span class="comment"> * ç¼ºç‚¹ï¼š</span></span><br><span class="line"><span class="comment"> *  1. å¯¼è‡´æ ˆæº¢å‡º</span></span><br><span class="line"><span class="comment"> *  2. é‡å¤è®¡ç®—</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> n</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">fibonacci01</span><span class="params">(<span class="type">int</span> n)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (n &lt; <span class="number">2</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> n;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> fibonacci01(n - <span class="number">1</span>) + fibonacci01(n - <span class="number">2</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>é€’å½’çš„ç¼ºç‚¹ï¼šï¼ˆ1ï¼‰æ ˆæº¢å‡º	ï¼ˆ2ï¼‰é‡å¤è®¡ç®—</p>
<p>å­é—®é¢˜å‡ºç°äº†é‡å¤è®¡ç®—ï¼Œé‡‡ç”¨åŠ¨æ€è§„åˆ’æ”¹è¿›ã€‚</p>
<p>ã€æ–¹æ¡ˆäºŒï¼šåŠ¨æ€è§„åˆ’ã€‘</p>
<p>æ­¥éª¤ï¼š</p>
<ul>
<li>ç¬¬ä¸€æ­¥ï¼šç¡®å®šæ•°ç»„å«ä¹‰ï¼Œdp[i] è¡¨ç¤ºå½“å‰çš„æ–æ³¢é‚£å¥‘æ•°å€¼</li>
<li>ç¬¬äºŒæ­¥ï¼šç¡®å®šçŠ¶æ€æ–¹ç¨‹ï¼ŒF(n) &#x3D; F(n-1) + F(n-2)</li>
<li>ç¬¬ä¸‰æ­¥ï¼šç¡®å®šåˆå§‹å€¼ï¼ŒF(0) &#x3D; 0ï¼ŒF(1) &#x3D; 1</li>
</ul>
<p>ä»£ç å®ç°ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * åŠ¨æ€è§„åˆ’</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> n</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">fibonacci02</span><span class="params">(<span class="type">int</span> n)</span> &#123;</span><br><span class="line">    <span class="type">int</span>[] dp = <span class="keyword">new</span> <span class="title class_">int</span>[n + <span class="number">1</span>];</span><br><span class="line">    dp[<span class="number">0</span>] = <span class="number">0</span>;</span><br><span class="line">    dp[<span class="number">1</span>] = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">2</span>; i &lt;= n; i++) &#123;</span><br><span class="line">        dp[i] = dp[i - <span class="number">1</span>] + dp[i - <span class="number">2</span>];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> dp[n];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ã€æ–¹æ¡ˆä¸‰ï¼šæ»šåŠ¨æ•°ç»„æ€æƒ³ã€‘</p>
<p>ç”±äºF(n)åªä¸F(n-1) å’Œ F(n-2)æœ‰å…³ï¼Œä¸”æ˜¯ä¸€ç»´æ•°ç»„ï¼Œé‡‡ç”¨æ»šåŠ¨æ•°ç»„æ€æƒ³</p>
<p>ä»£ç å®ç°ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * è¿›ä¸€æ­¥ç®€åŒ–ï¼š</span></span><br><span class="line"><span class="comment"> * ç”±äºF(n)åªä¸F(n-1) å’Œ F(n-2)æœ‰å…³ï¼Œä¸”æ˜¯ä¸€ç»´æ•°ç»„ï¼Œé‡‡ç”¨æ»šåŠ¨æ•°ç»„æ€æƒ³</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> n</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">fibonacci03</span><span class="params">(<span class="type">int</span> n)</span> &#123;</span><br><span class="line">    <span class="type">int</span> <span class="variable">p</span> <span class="operator">=</span> <span class="number">0</span>, q = <span class="number">0</span>, r = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">2</span>; i &lt;= n; i++) &#123;</span><br><span class="line">        p = q;</span><br><span class="line">        q = r;</span><br><span class="line">        r = p + q;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> r;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="å…¥é—¨ç¤ºä¾‹"><a href="#å…¥é—¨ç¤ºä¾‹" class="headerlink" title="å…¥é—¨ç¤ºä¾‹"></a>å…¥é—¨ç¤ºä¾‹</h3><h4 id="çˆ¬æ¥¼æ¢¯"><a href="#çˆ¬æ¥¼æ¢¯" class="headerlink" title="çˆ¬æ¥¼æ¢¯"></a>çˆ¬æ¥¼æ¢¯</h4><p>åŠ›æ‰£ï¼š<a href="https://leetcode.cn/problems/climbing-stairs/">https://leetcode.cn/problems/climbing-stairs/</a></p>
<p>å‡è®¾ä½ æ­£åœ¨çˆ¬æ¥¼æ¢¯ã€‚éœ€è¦ n é˜¶ä½ æ‰èƒ½åˆ°è¾¾æ¥¼é¡¶ã€‚</p>
<p>æ¯æ¬¡ä½ å¯ä»¥çˆ¬ 1 æˆ– 2 ä¸ªå°é˜¶ã€‚ä½ æœ‰å¤šå°‘ç§ä¸åŒçš„æ–¹æ³•å¯ä»¥çˆ¬åˆ°æ¥¼é¡¶å‘¢ï¼Ÿ</p>
<p>ç¤ºä¾‹ 1ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">è¾“å…¥ï¼šn = 2</span><br><span class="line">è¾“å‡ºï¼š2</span><br><span class="line">è§£é‡Šï¼šæœ‰ä¸¤ç§æ–¹æ³•å¯ä»¥çˆ¬åˆ°æ¥¼é¡¶ã€‚</span><br><span class="line">1. 1 é˜¶ + 1 é˜¶</span><br><span class="line">2. 2 é˜¶</span><br></pre></td></tr></table></figure>


<p>ç¤ºä¾‹ 2ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">è¾“å…¥ï¼šn = 3</span><br><span class="line">è¾“å‡ºï¼š3</span><br><span class="line">è§£é‡Šï¼šæœ‰ä¸‰ç§æ–¹æ³•å¯ä»¥çˆ¬åˆ°æ¥¼é¡¶ã€‚</span><br><span class="line">1. 1 é˜¶ + 1 é˜¶ + 1 é˜¶</span><br><span class="line">2. 1 é˜¶ + 2 é˜¶</span><br><span class="line">3. 2 é˜¶ + 1 é˜¶</span><br></pre></td></tr></table></figure>

<p>è§£é¢˜æ­¥éª¤ï¼š</p>
<p>ç†è§£é¢˜æ„ï¼šæ¯ä¸€ä¸ªçŠ¶æ€éƒ½æ˜¯ç”±ä¸Šä¸€ä¸ªçŠ¶æ€æ¨å¯¼å¾—å‡ºï¼Œè€ƒè™‘åŠ¨æ€è§„åˆ’ã€‚</p>
<ul>
<li><p>ç¬¬ä¸€æ­¥ï¼šç¡®å®šæ•°ç»„å«ä¹‰ï¼Œdp[i] è¡¨ç¤ºçˆ¬åˆ°å½“å‰æ¥¼æ¢¯æ‰€éœ€è¦èµ°çš„æ–¹æ³•æ€»æ•°</p>
</li>
<li><p>ç¬¬äºŒæ­¥ï¼šç¡®å®šçŠ¶æ€æ–¹ç¨‹ï¼Œç”±äºæ¯æ¬¡å¯ä»¥çˆ¬ 1 æˆ– 2 ä¸ªå°é˜¶ï¼Œå› æ­¤çˆ¬åˆ°å½“å‰çš„æ–¹æ³•æ•°ç­‰äºä»ä¸‹ä¸€ä¸ªæ¥¼æ¢¯çˆ¬ä¸Šæ¥çš„æ–¹æ³•æ•°åŠ </p>
<p>â€‹				ä¸Šä»ä¸‹ä¸¤ä¸ªæ¥¼æ¢¯çˆ¬ä¸Šæ¥çš„æ–¹æ³•æ•°ï¼›ä¾¿æœ‰çŠ¶æ€æ–¹ç¨‹ï¼šdp[i] &#x3D; dp[i-1] + dp[i-2]ï¼Œå…¬å¼ç­‰åŒäºæ–æ³¢é‚£å¥‘æ•°åˆ—ï¼Œä½†æ€</p>
<p>â€‹				æƒ³ä¸åŒã€‚</p>
</li>
<li><p>ç¬¬ä¸‰æ­¥ï¼šç¡®å®šåˆå§‹å€¼ï¼Œé¦–å…ˆåˆå§‹å€¼æ˜¯ç¡®å®šçš„ï¼Œä¸èƒ½ä»ç¬¬äºŒé˜¶å¼€å§‹ç®—ï¼Œå› ä¸ºçˆ¬åˆ°ç¬¬äºŒé˜¶æœ‰ä¸¤ç§æ–¹å¼ï¼Œå› æ­¤åˆå§‹å€¼éœ€è¦ç¡®</p>
<p>â€‹				å®šç¬¬ 0 é˜¶å’Œç¬¬ 1 é˜¶ï¼›dp[0] &#x3D; 1, dp[1] &#x3D; 1ã€‚</p>
</li>
</ul>
<p>ä»£ç å®ç°ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">climbStairs</span><span class="params">(<span class="type">int</span> n)</span> &#123;</span><br><span class="line">    <span class="type">int</span>[] dp = <span class="keyword">new</span> <span class="title class_">int</span>[n + <span class="number">1</span>];</span><br><span class="line">    dp[<span class="number">0</span>] = <span class="number">1</span>;</span><br><span class="line">    dp[<span class="number">1</span>] = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">2</span>; i &lt;= n; i++) &#123;</span><br><span class="line">        dp[i] = dp[i - <span class="number">1</span>] + dp[i - <span class="number">2</span>];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> dp[n];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<h3 id="èƒŒåŒ…é—®é¢˜"><a href="#èƒŒåŒ…é—®é¢˜" class="headerlink" title="èƒŒåŒ…é—®é¢˜"></a>èƒŒåŒ…é—®é¢˜</h3><h4 id="åˆ†ç±»"><a href="#åˆ†ç±»" class="headerlink" title="åˆ†ç±»"></a>åˆ†ç±»</h4><h4 id="æ€æƒ³"><a href="#æ€æƒ³" class="headerlink" title="æ€æƒ³"></a>æ€æƒ³</h4><p><img src="/images/%E8%83%8C%E5%8C%85%E9%97%AE%E9%A2%98.png" alt="èƒŒåŒ…é—®é¢˜"></p>
<h4 id="0-1èƒŒåŒ…"><a href="#0-1èƒŒåŒ…" class="headerlink" title="0-1èƒŒåŒ…"></a>0-1èƒŒåŒ…</h4><p>â€‹		æœ‰ N ä»¶ç‰©å“å’Œä¸€ä¸ªå®¹é‡ä¸º V çš„èƒŒåŒ…ã€‚ç¬¬ i ä»¶ç‰©å“çš„é‡é‡æ˜¯ w[i]ï¼Œä»·å€¼æ˜¯ v[i]ã€‚æ±‚è§£å°†å“ªäº›ç‰©å“è£…å…¥èƒŒåŒ…å¯ä½¿è¿™äº›ç‰©å“çš„é‡é‡æ€»å’Œä¸è¶…è¿‡èƒŒåŒ…å®¹é‡ï¼Œä¸”ä»·å€¼æ€»å’Œæœ€å¤§ã€‚æ¯ç§ç‰©å“ä»…æœ‰ä¸€ä»¶ï¼Œå¯ä»¥é€‰æ‹©æ”¾æˆ–ä¸æ”¾ã€‚</p>
<h4 id="è§£é¢˜æ­¥éª¤-1"><a href="#è§£é¢˜æ­¥éª¤-1" class="headerlink" title="è§£é¢˜æ­¥éª¤"></a>è§£é¢˜æ­¥éª¤</h4><p>ï¼ˆ1ï¼‰æ”¾å…¥ç¬¬ i ä»¶ç‰©å“æ—¶çš„ä»·å€¼ä¾èµ–äºæ”¾å…¥ç¬¬ i-1 ä»¶ç‰©å“æ—¶çš„ä»·å€¼ï¼Œå±äºå­é—®é¢˜ï¼Œå› æ­¤è€ƒè™‘åŠ¨æ€è§„åˆ’ï¼›</p>
<p>ï¼ˆ2ï¼‰ç”±äºæ¯æ¬¡æ”¾å…¥ç‰©å“æ—¶ï¼Œéƒ½è¦è€ƒè™‘é‡é‡ï¼Œå› æ­¤ä½¿ç”¨äºŒç»´æ•°ç»„ dp[i] [j] è¡¨ç¤ºç¬¬ i ä¸ªç‰©å“ï¼Œåœ¨å®¹é‡ä¸º j æ—¶çš„ä»·å€¼ï¼›</p>
<p>ï¼ˆ3ï¼‰æ¯æ¬¡æ”¾å…¥ç‰©å“æ—¶éœ€è¦è€ƒè™‘æ”¾å¾—ä¸‹è¿˜æ˜¯æ”¾ä¸ä¸‹çš„é—®é¢˜ï¼Œé’ˆå¯¹ä¸¤ç§æƒ…å†µåˆ¤æ–­æœ€ä¼˜è§£ã€‚</p>
<p>ä½¿ç”¨è¡¨æ ¼æ¼”ç¤ºè¿‡ç¨‹ï¼š</p>
<ul>
<li><p>ç¬¬ä¸€æ­¥ï¼šç¡®å®šæ•°ç»„å«ä¹‰ï¼›ä½¿ç”¨ dp[i] [j] è¡¨ç¤ºåœ¨å®¹é‡ä¸º j æ—¶ï¼Œæ”¾å…¥ç¬¬ i ä¸ªç‰©å“çš„æ€»ä»·å€¼ã€‚</p>
</li>
<li><p>ç¬¬äºŒæ­¥ï¼šç¡®å®šçŠ¶æ€æ–¹ç¨‹ï¼›æ­¤å¤„éœ€è¦è€ƒè™‘æ”¾å¾—ä¸‹è¿˜æ˜¯æ”¾ä¸ä¸‹çš„é—®é¢˜ã€‚</p>
<p>â€‹				æ”¾ä¸ä¸‹ï¼šèƒŒåŒ…çš„æœ€å¤§ä»·å€¼ä¾¿æ˜¯å·²æ”¾å…¥ç‰©å“çš„æœ€å¤§ä»·å€¼ï¼Œdp[i] [j] &#x3D; dp[i-1] [j]</p>
<p>â€‹				æ”¾å¾—ä¸‹ï¼šæœ€å¤§ä»·å€¼ä¸ºå½“å‰çš„ç‰©å“ä»·å€¼ï¼ŒåŠ ä¸Šæ€»å®¹é‡å‡å»å½“å‰ç‰©å“çš„é‡é‡åçš„æœ€å¤§ä»·å€¼ï¼Œä¹Ÿå°±æ˜¯</p>
<p>â€‹								dp[i] [j] &#x3D; v[i] + dp[i - 1] [j - w[i]]</p>
<p>â€‹				æœ€å¤§ä»·å€¼å–ä¸¤è€…çš„æœ€å¤§å€¼ï¼Œå› æ­¤çŠ¶æ€æ–¹ç¨‹ä¸ºï¼šdp[i] [j] &#x3D; Max{dp[i-1] [j], v[i] + dp[i - 1] [j - w[i]]}</p>
</li>
<li><p>ç¬¬ä¸‰æ­¥ï¼šç¡®å®šåˆå§‹å€¼ï¼›æ¶‰åŠåˆ° i -1 çš„é—®é¢˜ï¼Œå› æ­¤ i &#x3D; 0æ—¶éœ€è¦åˆå§‹åŒ–</p>
<p>â€‹</p>
</li>
</ul>
<p>			</p>
<h3 id="æ‰“å®¶åŠ«èˆ"><a href="#æ‰“å®¶åŠ«èˆ" class="headerlink" title="æ‰“å®¶åŠ«èˆ"></a>æ‰“å®¶åŠ«èˆ</h3><h3 id="è‚¡ç¥¨é—®é¢˜"><a href="#è‚¡ç¥¨é—®é¢˜" class="headerlink" title="è‚¡ç¥¨é—®é¢˜"></a>è‚¡ç¥¨é—®é¢˜</h3><h3 id="å­åºåˆ—é—®é¢˜"><a href="#å­åºåˆ—é—®é¢˜" class="headerlink" title="å­åºåˆ—é—®é¢˜"></a>å­åºåˆ—é—®é¢˜</h3><h2 id="è´ªå¿ƒç®—æ³•"><a href="#è´ªå¿ƒç®—æ³•" class="headerlink" title="è´ªå¿ƒç®—æ³•"></a>è´ªå¿ƒç®—æ³•</h2><h2 id="å›æº¯ç®—æ³•"><a href="#å›æº¯ç®—æ³•" class="headerlink" title="å›æº¯ç®—æ³•"></a>å›æº¯ç®—æ³•</h2><h2 id="åˆ†æ²»ç®—æ³•"><a href="#åˆ†æ²»ç®—æ³•" class="headerlink" title="åˆ†æ²»ç®—æ³•"></a>åˆ†æ²»ç®—æ³•</h2><h2 id="æšä¸¾ç®—æ³•"><a href="#æšä¸¾ç®—æ³•" class="headerlink" title="æšä¸¾ç®—æ³•"></a>æšä¸¾ç®—æ³•</h2><h2 id="å­—ç¬¦ä¸²åŒ¹é…"><a href="#å­—ç¬¦ä¸²åŒ¹é…" class="headerlink" title="å­—ç¬¦ä¸²åŒ¹é…"></a>å­—ç¬¦ä¸²åŒ¹é…</h2><h2 id="å¹¶æŸ¥é›†"><a href="#å¹¶æŸ¥é›†" class="headerlink" title="å¹¶æŸ¥é›†"></a>å¹¶æŸ¥é›†</h2><h2 id="å•è°ƒæ ˆ"><a href="#å•è°ƒæ ˆ" class="headerlink" title="å•è°ƒæ ˆ"></a>å•è°ƒæ ˆ</h2><p>è§£å†³é—®é¢˜ï¼šé€šå¸¸æŠ½è±¡å‡ºä¸€ç»´æ•°ç»„ï¼Œå¯»æ‰¾å³è¾¹æˆ–è€…å·¦è¾¹æ¯”å½“å‰å…ƒç´ å¤§æˆ–è€…å°çš„å…ƒç´ ï¼Œå¯ä»¥ä½¿ç”¨åŒå±‚ for å¾ªç¯æš´åŠ›è§£å†³ï¼Œæ—¶é—´å¤æ‚åº¦æ˜¯O(n^2)ï¼Œå¦ä¸€ç§ç®€æ´çš„è§£æ³•æ˜¯ä½¿ç”¨æ ˆï¼Œè¯¥æ ˆä¸­çš„å…ƒç´ æ˜¯å•è°ƒé€’å‡æˆ–è€…é€’å¢çš„ã€‚</p>
<p>é—®é¢˜ç¤ºä¾‹ã€æ¯æ—¥æ¸©åº¦ã€‘ï¼š<a href="https://leetcode.cn/problems/daily-temperatures/">https://leetcode.cn/problems/daily-temperatures/</a></p>
<p>ç»™å®šä¸€ä¸ªæ•´æ•°æ•°ç»„ temperatures ï¼Œè¡¨ç¤ºæ¯å¤©çš„æ¸©åº¦ï¼Œè¿”å›ä¸€ä¸ªæ•°ç»„ answer ï¼Œå…¶ä¸­ answer[i] æ˜¯æŒ‡å¯¹äºç¬¬ i å¤©ï¼Œä¸‹ä¸€ä¸ªæ›´é«˜æ¸©åº¦å‡ºç°åœ¨å‡ å¤©åã€‚å¦‚æœæ°”æ¸©åœ¨è¿™ä¹‹åéƒ½ä¸ä¼šå‡é«˜ï¼Œè¯·åœ¨è¯¥ä½ç½®ç”¨ 0 æ¥ä»£æ›¿ã€‚</p>
<p>ç¤ºä¾‹ 1:</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">è¾“å…¥: temperatures = [<span class="number">73</span>,<span class="number">74</span>,<span class="number">75</span>,<span class="number">71</span>,<span class="number">69</span>,<span class="number">72</span>,<span class="number">76</span>,<span class="number">73</span>]</span><br><span class="line">è¾“å‡º: [<span class="number">1</span>,<span class="number">1</span>,<span class="number">4</span>,<span class="number">2</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>]</span><br></pre></td></tr></table></figure>

<p>ç¤ºä¾‹ 2:</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">è¾“å…¥: temperatures = [<span class="number">30</span>,<span class="number">40</span>,<span class="number">50</span>,<span class="number">60</span>]</span><br><span class="line">è¾“å‡º: [<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>]</span><br></pre></td></tr></table></figure>

<p>ç¤ºä¾‹ 3:</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">è¾“å…¥: temperatures = [<span class="number">30</span>,<span class="number">60</span>,<span class="number">90</span>]</span><br><span class="line">è¾“å‡º: [<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>]</span><br></pre></td></tr></table></figure>

<p>æ–¹å¼ä¸€ï¼šæš´åŠ›è§£æ³•</p>
<p>æ–¹å¼äºŒï¼šå•è°ƒæ ˆ</p>
<p>å¯ä»¥ç»´æŠ¤ä¸€ä¸ªå­˜å‚¨ä¸‹æ ‡çš„å•è°ƒæ ˆï¼Œä»æ ˆåº•åˆ°æ ˆé¡¶çš„ä¸‹æ ‡å¯¹åº”çš„æ¸©åº¦åˆ—è¡¨ä¸­çš„æ¸©åº¦ä¾æ¬¡é€’å‡ã€‚å¦‚æœä¸€ä¸ªä¸‹æ ‡åœ¨å•è°ƒæ ˆé‡Œï¼Œåˆ™è¡¨ç¤ºå°šæœªæ‰¾åˆ°ä¸‹ä¸€æ¬¡æ¸©åº¦æ›´é«˜çš„ä¸‹æ ‡ã€‚</p>
<p>æ­£å‘éå†æ¸©åº¦åˆ—è¡¨ã€‚å¯¹äºæ¸©åº¦åˆ—è¡¨ä¸­çš„æ¯ä¸ªå…ƒç´  temperatures[i]ï¼Œå¦‚æœæ ˆä¸ºç©ºï¼Œåˆ™ç›´æ¥å°† i è¿›æ ˆï¼Œå¦‚æœæ ˆä¸ä¸ºç©ºï¼Œåˆ™æ¯”è¾ƒæ ˆé¡¶å…ƒç´  prevIndex å¯¹åº”çš„æ¸©åº¦ temperatures[prevIndex] å’Œå½“å‰æ¸©åº¦ temperatures[i]ï¼Œå¦‚æœ temperatures[i] &gt; temperatures[prevIndex]ï¼Œåˆ™å°† prevIndex ç§»é™¤ï¼Œå¹¶å°† prevIndex å¯¹åº”çš„ç­‰å¾…å¤©æ•°èµ‹ä¸º i - prevIndexï¼Œé‡å¤ä¸Šè¿°æ“ä½œç›´åˆ°æ ˆä¸ºç©ºæˆ–è€…æ ˆé¡¶å…ƒç´ å¯¹åº”çš„æ¸©åº¦å°äºç­‰äºå½“å‰æ¸©åº¦ï¼Œç„¶åå°† i è¿›æ ˆã€‚</p>
<p>ä¸ºä»€ä¹ˆå¯ä»¥åœ¨å¼¹æ ˆçš„æ—¶å€™æ›´æ–° ans[prevIndex] å‘¢ï¼Ÿå› ä¸ºåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå³å°†è¿›æ ˆçš„ i å¯¹åº”çš„ temperatures[i] ä¸€å®šæ˜¯ temperatures[prevIndex] å³è¾¹ç¬¬ä¸€ä¸ªæ¯”å®ƒå¤§çš„å…ƒç´ ï¼Œè¯•æƒ³å¦‚æœ prevIndex å’Œ i æœ‰æ¯”å®ƒå¤§çš„å…ƒç´ ï¼Œå‡è®¾ä¸‹æ ‡ä¸º jï¼Œé‚£ä¹ˆ prevIndex ä¸€å®šä¼šåœ¨ä¸‹æ ‡ j çš„é‚£ä¸€è½®è¢«å¼¹æ‰ã€‚</p>
<p>ç”±äºå•è°ƒæ ˆæ»¡è¶³ä»æ ˆåº•åˆ°æ ˆé¡¶å…ƒç´ å¯¹åº”çš„æ¸©åº¦é€’å‡ï¼Œå› æ­¤æ¯æ¬¡æœ‰å…ƒç´ è¿›æ ˆæ—¶ï¼Œä¼šå°†æ¸©åº¦æ›´ä½çš„å…ƒç´ å…¨éƒ¨ç§»é™¤ï¼Œå¹¶æ›´æ–°å‡ºæ ˆå…ƒç´ å¯¹åº”çš„ç­‰å¾…å¤©æ•°ï¼Œè¿™æ ·å¯ä»¥ç¡®ä¿ç­‰å¾…å¤©æ•°ä¸€å®šæ˜¯æœ€å°çš„ã€‚</p>
<p>ä»¥ä¸‹ç”¨ä¸€ä¸ªå…·ä½“çš„ä¾‹å­å¸®åŠ©è¯»è€…ç†è§£å•è°ƒæ ˆã€‚å¯¹äºæ¸©åº¦åˆ—è¡¨ </p>
<h3 id="ä¸‹ä¸€ä¸ªæ›´å¤§çš„å…ƒç´ ï¼ˆä¸€ï¼‰"><a href="#ä¸‹ä¸€ä¸ªæ›´å¤§çš„å…ƒç´ ï¼ˆä¸€ï¼‰" class="headerlink" title="ä¸‹ä¸€ä¸ªæ›´å¤§çš„å…ƒç´ ï¼ˆä¸€ï¼‰"></a>ä¸‹ä¸€ä¸ªæ›´å¤§çš„å…ƒç´ ï¼ˆä¸€ï¼‰</h3><p>é—®é¢˜ç¤ºä¾‹ï¼š<a href="https://leetcode.cn/problems/next-greater-element-i/">https://leetcode.cn/problems/next-greater-element-i/</a></p>
<p>nums1 ä¸­æ•°å­— x çš„ ä¸‹ä¸€ä¸ªæ›´å¤§å…ƒç´  æ˜¯æŒ‡ x åœ¨ nums2 ä¸­å¯¹åº”ä½ç½® å³ä¾§ çš„ ç¬¬ä¸€ä¸ª æ¯” x å¤§çš„å…ƒç´ ã€‚</p>
<p>ç»™ä½ ä¸¤ä¸ª æ²¡æœ‰é‡å¤å…ƒç´  çš„æ•°ç»„ nums1 å’Œ nums2 ï¼Œä¸‹æ ‡ä» 0 å¼€å§‹è®¡æ•°ï¼Œå…¶ä¸­nums1 æ˜¯ nums2 çš„å­é›†ã€‚</p>
<p>å¯¹äºæ¯ä¸ª 0 &lt;&#x3D; i &lt; nums1.length ï¼Œæ‰¾å‡ºæ»¡è¶³ nums1[i] &#x3D;&#x3D; nums2[j] çš„ä¸‹æ ‡ j ï¼Œå¹¶ä¸”åœ¨ nums2 ç¡®å®š nums2[j] çš„ ä¸‹ä¸€ä¸ªæ›´å¤§å…ƒç´  ã€‚å¦‚æœä¸å­˜åœ¨ä¸‹ä¸€ä¸ªæ›´å¤§å…ƒç´ ï¼Œé‚£ä¹ˆæœ¬æ¬¡æŸ¥è¯¢çš„ç­”æ¡ˆæ˜¯ -1 ã€‚</p>
<p>è¿”å›ä¸€ä¸ªé•¿åº¦ä¸º nums1.length çš„æ•°ç»„ ans ä½œä¸ºç­”æ¡ˆï¼Œæ»¡è¶³ ans[i] æ˜¯å¦‚ä¸Šæ‰€è¿°çš„ ä¸‹ä¸€ä¸ªæ›´å¤§å…ƒç´  ã€‚</p>
<p>ç¤ºä¾‹ 1ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">è¾“å…¥ï¼šnums1 = [<span class="number">4</span>,<span class="number">1</span>,<span class="number">2</span>], nums2 = [<span class="number">1</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">2</span>].</span><br><span class="line">è¾“å‡ºï¼š[-<span class="number">1</span>,<span class="number">3</span>,-<span class="number">1</span>]</span><br><span class="line">è§£é‡Šï¼šnums1 ä¸­æ¯ä¸ªå€¼çš„ä¸‹ä¸€ä¸ªæ›´å¤§å…ƒç´ å¦‚ä¸‹æ‰€è¿°ï¼š</span><br><span class="line"></span><br><span class="line">- <span class="number">4</span> ï¼Œç”¨åŠ ç²—æ–œä½“æ ‡è¯†ï¼Œnums2 = [<span class="number">1</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">2</span>]ã€‚ä¸å­˜åœ¨ä¸‹ä¸€ä¸ªæ›´å¤§å…ƒç´ ï¼Œæ‰€ä»¥ç­”æ¡ˆæ˜¯ -<span class="number">1</span> ã€‚</span><br><span class="line">- <span class="number">1</span> ï¼Œç”¨åŠ ç²—æ–œä½“æ ‡è¯†ï¼Œnums2 = [<span class="number">1</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">2</span>]ã€‚ä¸‹ä¸€ä¸ªæ›´å¤§å…ƒç´ æ˜¯ <span class="number">3</span> ã€‚</span><br><span class="line">- <span class="number">2</span> ï¼Œç”¨åŠ ç²—æ–œä½“æ ‡è¯†ï¼Œnums2 = [<span class="number">1</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">2</span>]ã€‚ä¸å­˜åœ¨ä¸‹ä¸€ä¸ªæ›´å¤§å…ƒç´ ï¼Œæ‰€ä»¥ç­”æ¡ˆæ˜¯ -<span class="number">1</span> ã€‚</span><br></pre></td></tr></table></figure>

<p>ç¤ºä¾‹ 2ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">è¾“å…¥ï¼šnums1 = [<span class="number">2</span>,<span class="number">4</span>], nums2 = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>].</span><br><span class="line">è¾“å‡ºï¼š[<span class="number">3</span>,-<span class="number">1</span>]</span><br><span class="line">è§£é‡Šï¼šnums1 ä¸­æ¯ä¸ªå€¼çš„ä¸‹ä¸€ä¸ªæ›´å¤§å…ƒç´ å¦‚ä¸‹æ‰€è¿°ï¼š</span><br><span class="line"></span><br><span class="line">- <span class="number">2</span> ï¼Œç”¨åŠ ç²—æ–œä½“æ ‡è¯†ï¼Œnums2 = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>]ã€‚ä¸‹ä¸€ä¸ªæ›´å¤§å…ƒç´ æ˜¯ <span class="number">3</span> ã€‚</span><br><span class="line">- <span class="number">4</span> ï¼Œç”¨åŠ ç²—æ–œä½“æ ‡è¯†ï¼Œnums2 = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>]ã€‚ä¸å­˜åœ¨ä¸‹ä¸€ä¸ªæ›´å¤§å…ƒç´ ï¼Œæ‰€ä»¥ç­”æ¡ˆæ˜¯ -<span class="number">1</span> ã€‚</span><br></pre></td></tr></table></figure>

<p>æç¤ºï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="number">1</span> &lt;= nums1.length &lt;= nums2.length &lt;= <span class="number">1000</span></span><br><span class="line"><span class="number">0</span> &lt;= nums1[i], nums2[i] &lt;= <span class="number">104</span></span><br><span class="line">nums1å’Œnums2ä¸­æ‰€æœ‰æ•´æ•° äº’ä¸ç›¸åŒ</span><br><span class="line">nums1 ä¸­çš„æ‰€æœ‰æ•´æ•°åŒæ ·å‡ºç°åœ¨ nums2 ä¸­</span><br></pre></td></tr></table></figure>

<p>æ–¹å¼ä¸€ï¼šå•è°ƒæ ˆ + å“ˆå¸Œè¡¨</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure>





<h3 id="ä¸‹ä¸€ä¸ªæ›´å¤§çš„å…ƒç´ ï¼ˆäºŒï¼‰"><a href="#ä¸‹ä¸€ä¸ªæ›´å¤§çš„å…ƒç´ ï¼ˆäºŒï¼‰" class="headerlink" title="ä¸‹ä¸€ä¸ªæ›´å¤§çš„å…ƒç´ ï¼ˆäºŒï¼‰"></a>ä¸‹ä¸€ä¸ªæ›´å¤§çš„å…ƒç´ ï¼ˆäºŒï¼‰</h3><p>é—®é¢˜ç¤ºä¾‹ï¼š<a href="https://leetcode.cn/problems/next-greater-element-ii/">https://leetcode.cn/problems/next-greater-element-ii/</a></p>
<p>ç»™å®šä¸€ä¸ªå¾ªç¯æ•°ç»„ numsï¼ˆ nums[nums.length - 1] çš„ä¸‹ä¸€ä¸ªå…ƒç´ æ˜¯ nums[0] ï¼‰ï¼Œè¿”å› nums ä¸­æ¯ä¸ªå…ƒç´ çš„ ä¸‹ä¸€ä¸ªæ›´å¤§å…ƒç´  ã€‚</p>
<p>æ•°å­— x çš„ ä¸‹ä¸€ä¸ªæ›´å¤§çš„å…ƒç´  æ˜¯æŒ‰æ•°ç»„éå†é¡ºåºï¼Œè¿™ä¸ªæ•°å­—ä¹‹åçš„ç¬¬ä¸€ä¸ªæ¯”å®ƒæ›´å¤§çš„æ•°ï¼Œè¿™æ„å‘³ç€ä½ åº”è¯¥å¾ªç¯åœ°æœç´¢å®ƒçš„ä¸‹ä¸€ä¸ªæ›´å¤§çš„æ•°ã€‚å¦‚æœä¸å­˜åœ¨ï¼Œåˆ™è¾“å‡º -1 ã€‚</p>
<p>ç¤ºä¾‹ 1:</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">è¾“å…¥: nums = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">1</span>]</span><br><span class="line">è¾“å‡º: [<span class="number">2</span>,-<span class="number">1</span>,<span class="number">2</span>]</span><br><span class="line">è§£é‡Š: ç¬¬ä¸€ä¸ª <span class="number">1</span> çš„ä¸‹ä¸€ä¸ªæ›´å¤§çš„æ•°æ˜¯ <span class="number">2</span>ï¼›</span><br><span class="line">æ•°å­— <span class="number">2</span> æ‰¾ä¸åˆ°ä¸‹ä¸€ä¸ªæ›´å¤§çš„æ•°ï¼› </span><br><span class="line">ç¬¬äºŒä¸ª <span class="number">1</span> çš„ä¸‹ä¸€ä¸ªæœ€å¤§çš„æ•°éœ€è¦å¾ªç¯æœç´¢ï¼Œç»“æœä¹Ÿæ˜¯ <span class="number">2</span>ã€‚</span><br></pre></td></tr></table></figure>


<p>ç¤ºä¾‹ 2:</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">è¾“å…¥: nums = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">3</span>]</span><br><span class="line">è¾“å‡º: [<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,-<span class="number">1</span>,<span class="number">4</span>]</span><br></pre></td></tr></table></figure>


<p>æç¤º:</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="number">1</span> &lt;= nums.length &lt;= <span class="number">10</span>^<span class="number">4</span></span><br><span class="line">-<span class="number">10</span>^<span class="number">9</span> &lt;= nums[i] &lt;= <span class="number">10</span>^<span class="number">9</span></span><br></pre></td></tr></table></figure>

<p>ä»£ç ç¤ºä¾‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure>









<h2 id="æ»‘åŠ¨çª—å£"><a href="#æ»‘åŠ¨çª—å£" class="headerlink" title="æ»‘åŠ¨çª—å£"></a>æ»‘åŠ¨çª—å£</h2>]]></content>
  </entry>
  <entry>
    <title>C</title>
    <url>/2023/02/27/C/</url>
    <content><![CDATA[]]></content>
  </entry>
  <entry>
    <title>Docker</title>
    <url>/2023/02/28/Docker/</url>
    <content><![CDATA[<div align="center"><font size="70"><b>Docker</b></font></div>

<hr>
<blockquote>
<p>ã€Referã€‘</p>
<p>å®˜ç½‘åœ°å€ï¼š<a href="http://www.docker.com/">http://www.docker.com</a></p>
<p>Docker Hubï¼š<a href="https://hub.docker.com/">https://hub.docker.com/</a></p>
<p>å‚è€ƒæ•™ç¨‹ï¼š</p>
<p><a href="https://docs.docker.com/">https://docs.docker.com/</a></p>
<p><a href="https://docs.docker.com/get-started/overview/">https://docs.docker.com/get-started/overview/</a></p>
<p>è¯´æ˜ï¼šæ­¤å¤„ä»¥ CentOS7.9 ä¸ºä¾‹ã€‚</p>
</blockquote>
<h1 id="Docker-ç®€ä»‹"><a href="#Docker-ç®€ä»‹" class="headerlink" title="Docker ç®€ä»‹"></a>Docker ç®€ä»‹</h1><h2 id="æ¦‚è¿°"><a href="#æ¦‚è¿°" class="headerlink" title="æ¦‚è¿°"></a>æ¦‚è¿°</h2><blockquote>
<p>Docker is written in the <a href="https://golang.org/">Go programming language</a> and takes advantage of several features of the Linux kernel to deliver its functionality. Docker uses a technology called <code>namespaces</code> to provide the isolated workspace called the <em>container</em>. When you run a container, Docker creates a set of <em>namespaces</em> for that container.</p>
<p>Docker ä½¿ç”¨ Go è¯­è¨€å¼€å‘ï¼Œä¸»è¦ç›®æ ‡æ˜¯ <code>&quot;Buildï¼ŒShip and Run Any App,  Anywhere&quot;</code>ï¼Œä¹Ÿå°±æ˜¯é€šè¿‡å¯¹åº”ç”¨ç»„ä»¶çš„å°è£…ã€åˆ†å‘ã€éƒ¨ç½²ã€è¿è¡Œç­‰ç”Ÿå‘½å‘¨æœŸçš„ç®¡ç†ï¼Œä½¿ç”¨æˆ·çš„ APP åŠå…¶è¿è¡Œç¯å¢ƒèƒ½å¤Ÿåšåˆ° â€œä¸€æ¬¡é•œåƒï¼Œå¤„å¤„è¿è¡Œâ€ã€‚</p>
<p><strong>è§£å†³äº†è¿è¡Œç¯å¢ƒå’Œé…ç½®é—®é¢˜çš„è½¯ä»¶å®¹å™¨ï¼Œæ–¹ä¾¿åšæŒç»­é›†æˆå¹¶æœ‰åŠ©äºæ•´ä½“å‘å¸ƒçš„å®¹å™¨è™šæ‹ŸåŒ–æŠ€æœ¯ã€‚</strong></p>
</blockquote>
<h2 id="ä½œç”¨"><a href="#ä½œç”¨" class="headerlink" title="ä½œç”¨"></a>ä½œç”¨</h2><blockquote>
<ul>
<li><p>æ›´å¿«é€Ÿçš„åº”ç”¨äº¤ä»˜å’Œéƒ¨ç½²</p>
<p>åº”ç”¨å¼€å‘å®Œæˆååªéœ€è¦æä¾› DockerFile é•œåƒæ–‡ä»¶ï¼Œè€Œä¸éœ€è¦æä¾›å¤§é‡çš„é…ç½®è¯´æ˜ä»¥åŠå®‰è£…ç¨‹åºã€‚</p>
</li>
<li><p>æ›´ä¾¿æ·çš„å‡çº§å’Œæ‰©ç¼©å®¹</p>
<p>å½“ç°æœ‰çš„å®¹å™¨ä¸è¶³ä»¥æ”¯æ’‘ä¸šåŠ¡å¤„ç†æ—¶ï¼Œå¯é€šè¿‡é•œåƒè¿è¡Œæ–°çš„å®¹å™¨è¿›è¡Œå¿«é€Ÿæ‰©å®¹ã€‚</p>
</li>
<li><p>æ›´ç®€å•çš„ç³»ç»Ÿè¿ç»´</p>
<p>åº”ç”¨å®¹å™¨åŒ–è¿è¡Œåï¼Œç”Ÿäº§ç¯å¢ƒè¿è¡Œçš„åº”ç”¨å¯ä¸å¼€å‘ã€æµ‹è¯•ç¯å¢ƒçš„åº”ç”¨é«˜åº¦ä¸€è‡´ï¼Œå½“å‡ºç°ç¨‹åºå¼‚å¸¸æ—¶ï¼Œä¹Ÿå¯ä»¥é€šè¿‡æµ‹è¯•ç¯å¢ƒçš„ç›¸åŒå®¹å™¨è¿›è¡Œå¿«é€Ÿå®šä½å’Œä¿®å¤ã€‚</p>
</li>
<li><p>æ›´é«˜æ•ˆçš„è®¡ç®—èµ„æºåˆ©ç”¨</p>
<p>Docker æ˜¯å†…æ ¸çº§è™šæ‹ŸåŒ–ï¼Œå…¶ä¸åƒä¼ ç»Ÿçš„è™šæ‹ŸåŒ–æŠ€æœ¯ä¸€æ ·éœ€è¦é¢å¤–çš„ Hypervisor æ”¯æŒï¼Œæ‰€ä»¥åœ¨ä¸€å°ç‰©ç†æœºä¸Šå¯ä»¥è¿è¡Œå¾ˆå¤šä¸ªå®¹å™¨å®ä¾‹ï¼Œå¯å¤§å¤§æå‡ç‰©ç†æœåŠ¡å™¨çš„ CPU å’Œå†…å­˜çš„åˆ©ç”¨ç‡ã€‚</p>
</li>
</ul>
</blockquote>
<blockquote>
<h2 id="What-can-I-use-Docker-for"><a href="#What-can-I-use-Docker-for" class="headerlink" title="What can I use Docker for?"></a>What can I use Docker for?</h2><p><strong>Fast, consistent delivery of your applications</strong></p>
<p>Docker streamlines the development lifecycle by allowing developers to work in standardized environments using local containers which provide your applications and services. Containers are great for continuous integration and continuous delivery (CI&#x2F;CD) workflows.</p>
<p>Consider the following example scenario:</p>
<ul>
<li>Your developers write code locally and share their work with their colleagues using Docker containers.</li>
<li>They use Docker to push their applications into a test environment and execute automated and manual tests.</li>
<li>When developers find bugs, they can fix them in the development environment and redeploy them to the test environment for testing and validation.</li>
<li>When testing is complete, getting the fix to the customer is as simple as pushing the updated image to the production environment.</li>
</ul>
<p><strong>Responsive deployment and scaling</strong></p>
<p>Dockerâ€™s container-based platform allows for highly portable workloads. Docker containers can run on a developerâ€™s local laptop, on physical or virtual machines in a data center, on cloud providers, or in a mixture of environments.</p>
<p>Dockerâ€™s portability and lightweight nature also make it easy to dynamically manage workloads, scaling up or tearing down applications and services as business needs dictate, in near real time.</p>
<p><strong>Running more workloads on the same hardware</strong></p>
<p>Docker is lightweight and fast. It provides a viable, cost-effective alternative to hypervisor-based virtual machines, so you can use more of your server capacity to achieve your business goals. Docker is perfect for high density environments and for small and medium deployments where you need to do more with fewer resources.</p>
</blockquote>
<h2 id="åŸºæœ¬ç»„æˆ"><a href="#åŸºæœ¬ç»„æˆ" class="headerlink" title="åŸºæœ¬ç»„æˆ"></a>åŸºæœ¬ç»„æˆ</h2><ul>
<li>é•œåƒ Imagesï¼šDocker å®¹å™¨æ¨¡æ¿ï¼Œç”¨äºè¿è¡Œå®¹å™¨ã€‚</li>
<li>å®¹å™¨ Containersï¼šå®¹å™¨ç±»ä¼¼äºä¸€ä¸ªè™šæ‹ŸåŒ–çš„è¿è¡Œç¯å¢ƒï¼Œæ˜¯ç”±é•œåƒåˆ›å»ºçš„è¿è¡Œå®ä¾‹ï¼Œå¯ä»¥ç‹¬ç«‹è¿è¡Œçš„ä¸€ä¸ªæˆ–ä¸€ç»„åº”ç”¨ï¼Œå®¹å™¨ä¸ºé•œåƒæä¾›äº†ä¸€ä¸ªæ ‡å‡†çš„å’Œéš”ç¦»çš„è¿è¡Œç¯å¢ƒï¼Œå®ƒå¯ä»¥è¢«å¯åŠ¨ã€å¼€å§‹ã€åœæ­¢ã€åˆ é™¤ï¼Œæ¯ä¸ªå®¹å™¨éƒ½æ˜¯ç›¸äº’éš”ç¦»çš„ã€ä¿è¯å®‰å…¨çš„å¹³å°ã€‚</li>
<li>ä»“åº“ Repositoryï¼šå­˜æ”¾é•œåƒæ–‡ä»¶ï¼ŒDocker å…¬å¸æä¾›çš„å®˜æ–¹ registry è¢«ç§°ä¸º Docker Hubï¼Œåˆ†ä¸ºå…¬å¼€ä»“åº“å’Œç§æœ‰ä»“åº“ã€‚</li>
</ul>
<p>Docker å¯ä»¥ç†è§£ä¸ºä¸€ä¸ªå®¹å™¨è¿è¡Œè½½ä½“ï¼Œå¦‚æŠŠåº”ç”¨ç¨‹åºå’Œé…ç½®ä¾èµ–æ‰“åŒ…å¥½å½¢æˆä¸€ä¸ªå¯äº¤ä»˜çš„è¿è¡Œç¯å¢ƒï¼Œè¿™ä¸ªæ‰“åŒ…å¥½çš„è¿è¡Œç¯å¢ƒå°±æ˜¯ image é•œåƒæ–‡ä»¶ï¼Œå®¹å™¨å°±æ˜¯ä¸€ä¸ªé•œåƒå®ä¾‹ã€‚</p>
<p><strong>Docker åŸºç¡€æ¶æ„è¯´æ˜ï¼š</strong></p>
<p>â€‹		Docker ä½¿ç”¨å®¢æˆ·ç«¯-æœåŠ¡å™¨æ¶æ„ã€‚Docker <em>å®¢æˆ·ç«¯</em>ä¸ Docker <em>å®ˆæŠ¤è¿›ç¨‹</em>ï¼Œå®ƒè´Ÿè´£æ„å»ºã€è¿è¡Œå’Œåˆ†å‘æ‚¨çš„ Docker å®¹å™¨ã€‚Docker å®¢æˆ·ç«¯å’Œå®ˆæŠ¤ç¨‹åºå¯ä»¥åœ¨åŒä¸€ç³»ç»Ÿä¸Šè¿è¡Œï¼Œä¹Ÿå¯ä»¥å°† Docker å®¢æˆ·ç«¯è¿æ¥åˆ°è¿œç¨‹ Docker å®ˆæŠ¤ è¿›ç¨‹ã€‚Docker å®¢æˆ·ç«¯å’Œå®ˆæŠ¤ç¨‹åºä½¿ç”¨ REST API é€šè¿‡ UNIX è¿›è¡Œé€šä¿¡å¥—æ¥å­—æˆ–ç½‘ç»œæ¥å£ã€‚å¦ä¸€ä¸ª Docker å®¢æˆ·ç«¯æ˜¯ Docker Composeï¼Œ è¿™ä½¿æ‚¨å¯ä»¥å¤„ç†ç”±ä¸€ç»„å®¹å™¨ç»„æˆçš„åº”ç”¨ç¨‹åºã€‚</p>
<blockquote>
<h2 id="Docker-architectureğŸ”—"><a href="#Docker-architectureğŸ”—" class="headerlink" title="Docker architectureğŸ”—"></a>Docker architecture<a href="https://docs.docker.com/get-started/overview/#docker-architecture">ğŸ”—</a></h2><p>Docker uses a client-server architecture. The Docker <em>client</em> talks to the Docker <em>daemon</em>, which does the heavy lifting of building, running, and distributing your Docker containers. The Docker client and daemon <em>can</em> run on the same system, or you can connect a Docker client to a remote Docker daemon. The Docker client and daemon communicate using a REST API, over UNIX sockets or a network interface. Another Docker client is Docker Compose, that lets you work with applications consisting of a set of containers.</p>
</blockquote>
<p><img src="/2023/02/28/Docker/DockerArchitecture.png" alt="DockerArchitecture"></p>
<h2 id="å®¹å™¨ä¸è™šæ‹Ÿæœºçš„å¯¹æ¯”"><a href="#å®¹å™¨ä¸è™šæ‹Ÿæœºçš„å¯¹æ¯”" class="headerlink" title="å®¹å™¨ä¸è™šæ‹Ÿæœºçš„å¯¹æ¯”"></a>å®¹å™¨ä¸è™šæ‹Ÿæœºçš„å¯¹æ¯”</h2><p><strong>ä¼ ç»Ÿè™šæ‹ŸæœºæŠ€æœ¯</strong></p>
<blockquote>
<p>Virtual Machineï¼Œä¼ ç»Ÿè™šæ‹ŸæœºæŠ€æœ¯æ˜¯åŸºäºå®‰è£…åœ¨ä¸»æ“ä½œç³»ç»Ÿä¸Šçš„è™šæ‹Ÿæœºç®¡ç†ç³»ç»Ÿï¼Œç”±è¯¥ç³»ç»Ÿåˆ›å»ºå‡ºè™šæ‹Ÿæœºï¼Œè™šæ‹Ÿæœºå¯¹äºç³»ç»Ÿæ¥è¯´ä»…ä»…æ˜¯ä¸€ä¸ªæ–‡ä»¶ï¼Œè™šæ‹Ÿå‡ºå„ç§ç¡¬ä»¶ï¼Œä¹‹åå†è¯¥è™šæ‹Ÿæœºä¸Šå®‰è£…æ“ä½œç³»ç»Ÿï¼Œæœ€ååœ¨æ‰æ“ä½œç³»ç»Ÿä¸Šå®‰è£…åº”ç”¨ç¨‹åºã€‚</p>
<p>ç¼ºç‚¹ï¼šèµ„æºå ç”¨å¤šï¼Œå¯åŠ¨é€Ÿåº¦æ…¢ã€‚</p>
</blockquote>
<p><strong>å®¹å™¨åŒ–è™šæ‹ŸæŠ€æœ¯</strong></p>
<blockquote>
<p>ç”±äºå‰é¢è™šæ‹Ÿæœºå­˜åœ¨æŸäº›ç¼ºç‚¹ï¼ŒLinuxå‘å±•å‡ºäº†å¦ä¸€ç§è™šæ‹ŸåŒ–æŠ€æœ¯ï¼šLXCï¼ˆLinux Containersï¼ŒLinuxå®¹å™¨ ï¼‰</p>
<p>Linuxå®¹å™¨æ˜¯ä¸ç³»ç»Ÿå…¶ä»–éƒ¨åˆ†éš”ç¦»å¼€çš„ä¸€ç³»åˆ—è¿›ç¨‹ï¼Œä»å¦ä¸€ä¸ªé•œåƒè¿è¡Œï¼Œå¹¶ç”±è¯¥é•œåƒæä¾›æ”¯æŒè¿›ç¨‹æ‰€éœ€çš„å…¨éƒ¨æ–‡ä»¶ã€‚å®¹å™¨æä¾›çš„é•œåƒåŒ…å«äº†åº”ç”¨çš„æ‰€æœ‰ä¾èµ–é¡¹ï¼Œå› è€Œåœ¨ä»å¼€å‘åˆ°æµ‹è¯•å†åˆ°ç”Ÿäº§çš„æ•´ä¸ªè¿‡ç¨‹ä¸­ï¼Œå®ƒéƒ½å…·æœ‰å¯ç§»æ¤æ€§å’Œä¸€è‡´æ€§ã€‚</p>
<p>Linux å®¹å™¨ä¸æ˜¯æ¨¡æ‹Ÿä¸€ä¸ªå®Œæ•´çš„æ“ä½œç³»ç»Ÿè€Œæ˜¯å¯¹è¿›ç¨‹è¿›è¡Œéš”ç¦»ã€‚æœ‰äº†å®¹å™¨ï¼Œå°±å¯ä»¥å°†è½¯ä»¶è¿è¡Œæ‰€éœ€çš„æ‰€æœ‰èµ„æºæ‰“åŒ…åˆ°ä¸€ä¸ªéš”ç¦»çš„å®¹å™¨ä¸­ã€‚å®¹å™¨ä¸è™šæ‹Ÿæœºä¸åŒï¼Œä¸éœ€è¦æ†ç»‘ä¸€æ•´å¥—æ“ä½œç³»ç»Ÿï¼Œåªéœ€è¦è½¯ä»¶å·¥ä½œæ‰€éœ€çš„åº“èµ„æºå’Œè®¾ç½®ã€‚ç³»ç»Ÿå› æ­¤è€Œå˜å¾—é«˜æ•ˆè½»é‡å¹¶ä¿è¯éƒ¨ç½²åœ¨ä»»ä½•ç¯å¢ƒä¸­çš„è½¯ä»¶éƒ½èƒ½å§‹ç»ˆå¦‚ä¸€åœ°è¿è¡Œã€‚</p>
<p>Docker å®¹å™¨æ˜¯åœ¨æ“ä½œç³»ç»Ÿä¸Šå®ç°è™šæ‹ŸåŒ–ï¼Œç›´æ¥å¤ç”¨æœ¬åœ°çš„æ“ä½œç³»ç»Ÿï¼Œè€Œä¼ ç»Ÿè™šæ‹Ÿæœºæ˜¯åœ¨ç¡¬ä»¶å±‚é¢å®ç°è™šæ‹ŸåŒ–ï¼Œå› æ­¤å¯åŠ¨é€Ÿåº¦å¿«ï¼Œå ç”¨ä½“ç§¯å°ã€‚</p>
</blockquote>
<p><strong>å¯¹æ¯”æ€»ç»“</strong></p>
<blockquote>
<p>ä¼ ç»Ÿè™šæ‹ŸæœºæŠ€æœ¯æ˜¯è™šæ‹Ÿå‡ºä¸€å¥—ç¡¬ä»¶åï¼Œåœ¨å…¶ä¸Šè¿è¡Œä¸€ä¸ªå®Œæ•´æ“ä½œç³»ç»Ÿï¼Œåœ¨è¯¥ç³»ç»Ÿä¸Šå†è¿è¡Œæ‰€éœ€åº”ç”¨è¿›ç¨‹ï¼›<br>å®¹å™¨å†…çš„åº”ç”¨è¿›ç¨‹ç›´æ¥è¿è¡Œäºå®¿ä¸»çš„å†…æ ¸ï¼Œå®¹å™¨å†…æ²¡æœ‰è‡ªå·±çš„å†…æ ¸ä¸”ä¹Ÿæ²¡æœ‰è¿›è¡Œç¡¬ä»¶è™šæ‹Ÿã€‚å› æ­¤å®¹å™¨è¦æ¯”ä¼ ç»Ÿè™šæ‹Ÿæœºæ›´ä¸ºè½»ä¾¿ã€‚</p>
<p>æ¯ä¸ªå®¹å™¨ä¹‹é—´äº’ç›¸éš”ç¦»ï¼Œæ¯ä¸ªå®¹å™¨æœ‰è‡ªå·±çš„æ–‡ä»¶ç³»ç»Ÿ ï¼Œå®¹å™¨ä¹‹é—´è¿›ç¨‹ä¸ä¼šç›¸äº’å½±å“ï¼Œèƒ½åŒºåˆ†è®¡ç®—èµ„æºã€‚</p>
</blockquote>
<h1 id="Docker-å®‰è£…"><a href="#Docker-å®‰è£…" class="headerlink" title="Docker å®‰è£…"></a>Docker å®‰è£…</h1><h2 id="å‰ææ¡ä»¶"><a href="#å‰ææ¡ä»¶" class="headerlink" title="å‰ææ¡ä»¶"></a>å‰ææ¡ä»¶</h2><p>ã€Referã€‘<a href="https://docs.docker.com/engine/install/centos/">https://docs.docker.com/engine/install/centos/</a></p>
<p><strong>æ¡ä»¶ï¼š64ä½ç³»ç»Ÿã€Linuxç³»ç»Ÿå†…æ ¸ç‰ˆæœ¬ä¸º 3.8ä»¥ä¸Šã€‚</strong></p>
<p>æŸ¥çœ‹å†…æ ¸ï¼š</p>
<ol>
<li>uname ã€å†…æ ¸ç‰ˆæœ¬å·ã€ç¡¬ä»¶æ¶æ„ã€ä¸»æœºåç§°å’Œæ“ä½œç³»ç»Ÿç±»å‹ã€‘</li>
<li>cat  &#x2F;etc&#x2F;redhat-release</li>
</ol>
<h2 id="å®‰è£…æ–¹å¼"><a href="#å®‰è£…æ–¹å¼" class="headerlink" title="å®‰è£…æ–¹å¼"></a>å®‰è£…æ–¹å¼</h2><p><strong>æ­¤å¤„ä½¿ç”¨ YUM å®‰è£…</strong></p>
<blockquote>
<h2 id="Installation-methods"><a href="#Installation-methods" class="headerlink" title="Installation methods"></a>Installation methods</h2><p>You can install Docker Engine in different ways, depending on your needs:</p>
<ul>
<li>You can <a href="https://docs.docker.com/engine/install/centos/#install-using-the-repository">set up Dockerâ€™s repositories</a> and install from them, for ease of installation and upgrade tasks. This is the recommended approach.</li>
<li>You can download the RPM package and <a href="https://docs.docker.com/engine/install/centos/#install-from-a-package">install it manually</a> and manage upgrades completely manually. This is useful in situations such as installing Docker on air-gapped systems with no access to the internet.</li>
<li>In testing and development environments, you can use automated <a href="https://docs.docker.com/engine/install/centos/#install-using-the-convenience-script">convenience scripts</a> to install Docker.</li>
</ul>
<h3 id="Install-using-the-repository"><a href="#Install-using-the-repository" class="headerlink" title="Install using the repository"></a>Install using the repository</h3><p>Before you install Docker Engine for the first time on a new host machine, you need to set up the Docker repository. Afterward, you can install and update Docker from the repository.</p>
</blockquote>
<h2 id="å®‰è£…æ­¥éª¤"><a href="#å®‰è£…æ­¥éª¤" class="headerlink" title="å®‰è£…æ­¥éª¤"></a>å®‰è£…æ­¥éª¤</h2><h3 id="å¸è½½æ—§ç‰ˆæœ¬"><a href="#å¸è½½æ—§ç‰ˆæœ¬" class="headerlink" title="å¸è½½æ—§ç‰ˆæœ¬"></a>å¸è½½æ—§ç‰ˆæœ¬</h3><p><strong>Uninstall old versions</strong></p>
<p>Older versions of Docker went by the names of <code>docker</code> or <code>docker-engine</code>. Uninstall any such older versions before attempting to install a new version, along with associated dependencies:</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">$ sudo yum remove docker \</span><br><span class="line">                  docker-client \</span><br><span class="line">                  docker-client-latest \</span><br><span class="line">                  docker-common \</span><br><span class="line">                  docker-latest \</span><br><span class="line">                  docker-latest-logrotate \</span><br><span class="line">                  docker-logrotate \</span><br><span class="line">                  docker-engine</span><br></pre></td></tr></table></figure>

<p>Itâ€™s OK if <code>yum</code> reports that none of these packages are installed.</p>
<p>Images, containers, volumes, and networks stored in <code>/var/lib/docker/</code> arenâ€™t automatically removed when you uninstall Docker.</p>
<p><strong>é•œåƒï¼Œå®¹å™¨ï¼Œæ•°æ®å·ï¼Œå’Œç½‘ç»œå­˜å‚¨åœ¨  <code>/var/lib/docker/</code> å¸è½½æ—¶ä¸ä¼šè‡ªåŠ¨ç§»é™¤ã€‚</strong></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">systemctl stop docker </span><br><span class="line">yum remove docker-ce docker-ce-cli containerd.io</span><br><span class="line">rm -rf /var/lib/docker</span><br><span class="line">rm -rf /var/lib/containerd</span><br></pre></td></tr></table></figure>

<h3 id="ç¬¬ä¸€æ­¥ï¼šå®‰è£…-gcc"><a href="#ç¬¬ä¸€æ­¥ï¼šå®‰è£…-gcc" class="headerlink" title="ç¬¬ä¸€æ­¥ï¼šå®‰è£… gcc"></a>ç¬¬ä¸€æ­¥ï¼šå®‰è£… gcc</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">yum -y install gcc</span><br><span class="line">yum -y install gcc-c++</span><br></pre></td></tr></table></figure>

<h3 id="ç¬¬äºŒæ­¥ï¼šé…ç½®-YUM-é•œåƒæº"><a href="#ç¬¬äºŒæ­¥ï¼šé…ç½®-YUM-é•œåƒæº" class="headerlink" title="ç¬¬äºŒæ­¥ï¼šé…ç½® YUM é•œåƒæº"></a>ç¬¬äºŒæ­¥ï¼šé…ç½® YUM é•œåƒæº</h3><p>éœ€è¦å®‰è£…  yum-utilsï¼Œä½¿ç”¨ aliyun é•œåƒæº</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">yum install -y yum-utils</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æ­¤å¤„ä½¿ç”¨ aliyun é•œåƒ</span></span><br><span class="line">yum-config-manager --add-repo http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo</span><br></pre></td></tr></table></figure>

<h3 id="ç¬¬ä¸‰æ­¥ï¼šæ›´æ–°-YUM-ç´¢å¼•"><a href="#ç¬¬ä¸‰æ­¥ï¼šæ›´æ–°-YUM-ç´¢å¼•" class="headerlink" title="ç¬¬ä¸‰æ­¥ï¼šæ›´æ–° YUM ç´¢å¼•"></a>ç¬¬ä¸‰æ­¥ï¼šæ›´æ–° YUM ç´¢å¼•</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">yum makecache fast</span><br></pre></td></tr></table></figure>

<h3 id="ç¬¬å››æ­¥ï¼šå®‰è£…-Docker-CE"><a href="#ç¬¬å››æ­¥ï¼šå®‰è£…-Docker-CE" class="headerlink" title="ç¬¬å››æ­¥ï¼šå®‰è£… Docker CE"></a>ç¬¬å››æ­¥ï¼šå®‰è£… Docker CE</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">yum -y install docker-ce docker-ce-cli containerd.io</span><br></pre></td></tr></table></figure>

<h3 id="ç¬¬äº”æ­¥ï¼šå¯åŠ¨-Docker"><a href="#ç¬¬äº”æ­¥ï¼šå¯åŠ¨-Docker" class="headerlink" title="ç¬¬äº”æ­¥ï¼šå¯åŠ¨ Docker"></a>ç¬¬äº”æ­¥ï¼šå¯åŠ¨ Docker</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">systemctl start docker</span><br></pre></td></tr></table></figure>

<h3 id="ç¬¬å…­æ­¥ï¼šæµ‹è¯•"><a href="#ç¬¬å…­æ­¥ï¼šæµ‹è¯•" class="headerlink" title="ç¬¬å…­æ­¥ï¼šæµ‹è¯•"></a>ç¬¬å…­æ­¥ï¼šæµ‹è¯•</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">docker version</span><br></pre></td></tr></table></figure>

<p>æ‹‰å–æµ‹è¯•é•œåƒï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">docker run helloworld</span><br></pre></td></tr></table></figure>

<h2 id="é…ç½®é•œåƒåŠ é€Ÿ"><a href="#é…ç½®é•œåƒåŠ é€Ÿ" class="headerlink" title="é…ç½®é•œåƒåŠ é€Ÿ"></a>é…ç½®é•œåƒåŠ é€Ÿ</h2><h1 id="Docker-å¸¸ç”¨å‘½ä»¤"><a href="#Docker-å¸¸ç”¨å‘½ä»¤" class="headerlink" title="Docker å¸¸ç”¨å‘½ä»¤"></a>Docker å¸¸ç”¨å‘½ä»¤</h1>]]></content>
  </entry>
  <entry>
    <title>DesignPattern</title>
    <url>/2023/02/28/DesignPattern/</url>
    <content><![CDATA[<h1 id><a href="#" class="headerlink" title></a></h1><h1 id="è®¾è®¡æ¨¡å¼"><a href="#è®¾è®¡æ¨¡å¼" class="headerlink" title="è®¾è®¡æ¨¡å¼"></a>è®¾è®¡æ¨¡å¼</h1><h1 id="è®¾è®¡æ¨¡å¼ç®€ä»‹"><a href="#è®¾è®¡æ¨¡å¼ç®€ä»‹" class="headerlink" title="è®¾è®¡æ¨¡å¼ç®€ä»‹"></a>è®¾è®¡æ¨¡å¼ç®€ä»‹</h1><blockquote>
<p><strong>è®¾è®¡æ¨¡å¼ä»‹ç»</strong></p>
<ul>
<li>è®¾è®¡æ¨¡å¼æ˜¯ç¨‹åºå‘˜åœ¨é¢å¯¹åŒç±»è½¯ä»¶å·¥ç¨‹è®¾è®¡é—®é¢˜æ‰€æ€»ç»“å‡ºæ¥çš„æœ‰ç”¨çš„ç»éªŒï¼Œ æ¨¡å¼ä¸æ˜¯ä»£ç ï¼Œè€Œæ˜¯æŸç±»é—®é¢˜çš„é€šç”¨è§£å†³æ–¹æ¡ˆï¼Œè®¾è®¡æ¨¡å¼ï¼ˆDesign patternï¼‰ ä»£è¡¨äº†æœ€ä½³çš„å®è·µã€‚è¿™äº›è§£å†³æ–¹æ¡ˆæ˜¯ä¼—å¤šè½¯ä»¶å¼€å‘äººå‘˜ç»è¿‡ç›¸å½“é•¿çš„ä¸€æ®µæ—¶é—´çš„è¯•éªŒå’Œé”™è¯¯æ€»ç»“å‡ºæ¥çš„ã€‚</li>
<li><strong>è®¾è®¡æ¨¡å¼çš„æœ¬è´¨æé«˜è½¯ä»¶çš„ç»´æŠ¤æ€§ï¼Œé€šç”¨æ€§å’Œæ‰©å±•æ€§ï¼Œå¹¶é™ä½è½¯ä»¶çš„å¤æ‚åº¦ã€‚</strong></li>
</ul>
<p><strong>è®¾è®¡æ¨¡å¼ç±»å‹</strong></p>
<p>è®¾è®¡æ¨¡å¼åˆ†ä¸ºä¸‰ç§ç±»å‹ï¼Œå…±23ç§ã€‚</p>
<ul>
<li>åˆ›å»ºå‹æ¨¡å¼ï¼šå•ä¾‹æ¨¡å¼ã€æŠ½è±¡å·¥å‚æ¨¡å¼ã€åŸå‹æ¨¡å¼ã€å»ºé€ è€…æ¨¡å¼ã€å·¥å‚æ¨¡å¼ã€‚</li>
<li>ç»“æ„å‹æ¨¡å¼ï¼šé€‚é…å™¨æ¨¡å¼ã€æ¡¥æ¥æ¨¡å¼ã€è£…é¥°æ¨¡å¼ã€ç»„åˆæ¨¡å¼ã€å¤–è§‚æ¨¡å¼ã€äº«å…ƒæ¨¡å¼ã€ä»£ç†æ¨¡å¼ã€‚</li>
<li>è¡Œä¸ºå‹æ¨¡å¼ï¼šæ¨¡ç‰ˆæ–¹æ³•æ¨¡å¼ã€å‘½ä»¤æ¨¡å¼ã€è®¿é—®è€…æ¨¡å¼ã€è¿­ä»£å™¨æ¨¡å¼ã€è§‚å¯Ÿè€…æ¨¡å¼ã€ä¸­ä»‹è€…æ¨¡å¼ã€å¤‡å¿˜å½•æ¨¡å¼ã€è§£é‡Šå™¨æ¨¡å¼ï¼ˆInterpreteræ¨¡å¼ï¼‰ã€çŠ¶æ€æ¨¡å¼ã€ç­–ç•¥æ¨¡å¼ã€èŒè´£é“¾æ¨¡å¼ï¼ˆè´£ä»»é“¾æ¨¡å¼ï¼‰ã€‚</li>
</ul>
</blockquote>
<h1 id="è®¾è®¡æ¨¡å¼ä¸ƒå¤§åŸåˆ™"><a href="#è®¾è®¡æ¨¡å¼ä¸ƒå¤§åŸåˆ™" class="headerlink" title="è®¾è®¡æ¨¡å¼ä¸ƒå¤§åŸåˆ™"></a>è®¾è®¡æ¨¡å¼ä¸ƒå¤§åŸåˆ™</h1><p>â€‹		è®¾è®¡æ¨¡å¼åŸåˆ™ï¼Œå³ç¼–ç¨‹æ—¶åº”å½“éµå®ˆçš„åŸåˆ™ï¼Œä¹Ÿæ˜¯å„ç§è®¾è®¡æ¨¡å¼çš„åŸºç¡€ã€‚</p>
<blockquote>
<ul>
<li>è®¾è®¡æ¨¡å¼å¸¸ç”¨çš„ä¸ƒå¤§åŸåˆ™ï¼š</li>
<li>å•ä¸€èŒè´£åŸåˆ™</li>
<li>æ¥å£éš”ç¦»åŸåˆ™</li>
<li>ä¾èµ–å€’è½¬åŸåˆ™</li>
<li>é‡Œå¼æ›¿æ¢åŸåˆ™</li>
<li>å¼€é—­åŸåˆ™</li>
<li>è¿ªç±³ç‰¹æ³•åˆ™</li>
<li>åˆæˆå¤ç”¨åŸåˆ™</li>
</ul>
</blockquote>
<h2 id="å•ä¸€èŒè´£åŸåˆ™"><a href="#å•ä¸€èŒè´£åŸåˆ™" class="headerlink" title="å•ä¸€èŒè´£åŸåˆ™"></a>å•ä¸€èŒè´£åŸåˆ™</h2><h3 id="åŸºæœ¬ä»‹ç»"><a href="#åŸºæœ¬ä»‹ç»" class="headerlink" title="åŸºæœ¬ä»‹ç»"></a>åŸºæœ¬ä»‹ç»</h3><p>â€‹		å¯¹ç±»æ¥è¯´çš„ï¼Œå³ä¸€ä¸ªç±»åº”è¯¥åªè´Ÿè´£ä¸€é¡¹èŒè´£ã€‚å¦‚ç±» A è´Ÿè´£ä¸¤ä¸ªä¸åŒèŒè´£ï¼šèŒè´£1ï¼ŒèŒè´£2ã€‚ å½“èŒè´£1éœ€æ±‚å˜æ›´è€Œæ”¹å˜Aæ—¶ï¼Œå¯èƒ½é€ æˆèŒè´£2æ‰§è¡Œé”™è¯¯ï¼Œæ‰€ä»¥éœ€è¦å°†ç±» A çš„ç²’åº¦åˆ†è§£ä¸º A1ï¼ŒA2ã€‚</p>
<h3 id="åº”ç”¨ç¤ºä¾‹"><a href="#åº”ç”¨ç¤ºä¾‹" class="headerlink" title="åº”ç”¨ç¤ºä¾‹"></a>åº”ç”¨ç¤ºä¾‹</h3><p>æ–¹å¼ä¸€ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.priciple.singleResponsibility;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SingleResponsibility01</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">Vehicle</span> <span class="variable">vehicle</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Vehicle</span>();</span><br><span class="line">        vehicle.run(<span class="string">&quot;æ±½è½¦&quot;</span>);</span><br><span class="line">        vehicle.run(<span class="string">&quot;é£æœº&quot;</span>);</span><br><span class="line">        vehicle.run(<span class="string">&quot;è½®èˆ¹&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * è¿åäº†å•ä¸€èŒè´£åŸåˆ™ï¼Œå³ä¸€ä¸ªç±»åº”è¯¥åªè´Ÿè´£ä¸€é¡¹èŒè´£</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Vehicle</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">(String vehicle)</span> &#123;</span><br><span class="line">        System.out.println(vehicle + <span class="string">&quot;åœ¨å…¬è·¯ä¸Šè¡Œé©¶&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ–¹å¼äºŒï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.priciple.singleResponsibility;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SingleResponsibility02</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">RoadVehicle</span> <span class="variable">roadVehicle</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">RoadVehicle</span>();</span><br><span class="line">        roadVehicle.run(<span class="string">&quot;æ±½è½¦&quot;</span>);</span><br><span class="line">        <span class="type">WaterVehicle</span> <span class="variable">waterVehicle</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">WaterVehicle</span>();</span><br><span class="line">        waterVehicle.run(<span class="string">&quot;è½®èˆ¹&quot;</span>);</span><br><span class="line">        <span class="type">AirVehicle</span> <span class="variable">airVehicle</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AirVehicle</span>();</span><br><span class="line">        airVehicle.run(<span class="string">&quot;é£æœº&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * éµå®ˆäº†å•ä¸€èŒè´£åŸåˆ™ï¼Œä½†å¯¹ç±»è¿›è¡Œäº†æ‹†åˆ†å¹¶ä¿®æ”¹äº†å®¢æˆ·ç«¯ï¼Œæ”¹åŠ¨å¾ˆå¤§</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">RoadVehicle</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">(String vehicle)</span> &#123;</span><br><span class="line">        System.out.println(vehicle + <span class="string">&quot;åœ¨å…¬è·¯ä¸Šè¡Œé©¶&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">WaterVehicle</span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">(String vehicle)</span> &#123;</span><br><span class="line">        System.out.println(vehicle+<span class="string">&quot;åœ¨æ°´ä¸­è¡Œé©¶&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">AirVehicle</span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">(String vehicle)</span> &#123;</span><br><span class="line">        System.out.println(vehicle+<span class="string">&quot;åœ¨å¤©ç©ºè¡Œé©¶&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ–¹å¼ä¸‰ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.priciple.singleResponsibility;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SingleResponsibility03</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">VehicleTool</span> <span class="variable">vehicle</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">VehicleTool</span>();</span><br><span class="line">        vehicle.runRoad(<span class="string">&quot;æ±½è½¦&quot;</span>);</span><br><span class="line">        vehicle.runWater(<span class="string">&quot;è½®èˆ¹&quot;</span>);</span><br><span class="line">        vehicle.runAir(<span class="string">&quot;é£æœº&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ²¡æœ‰å¯¹åŸæ¥ç±»åšå¤§çš„ä¿®æ”¹ï¼Œåªæ˜¯å¢åŠ æ–¹æ³•</span></span><br><span class="line"><span class="comment"> * è™½ç„¶åœ¨ç±»ä¸Šé¢æ²¡æœ‰éµå®ˆå•ä¸€èŒè´£åŸåˆ™ï¼Œä½†åœ¨æ–¹æ³•å±‚é¢ä¸Šéµå®ˆäº†è¯¥åŸåˆ™</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">VehicleTool</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">runRoad</span><span class="params">(String vehicle)</span> &#123;</span><br><span class="line">        System.out.println(vehicle + <span class="string">&quot;åœ¨å…¬è·¯ä¸Šè¡Œé©¶&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">runWater</span><span class="params">(String vehicle)</span> &#123;</span><br><span class="line">        System.out.println(vehicle + <span class="string">&quot;åœ¨æ°´ä¸­è¡Œé©¶&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">runAir</span><span class="params">(String vehicle)</span> &#123;</span><br><span class="line">        System.out.println(vehicle + <span class="string">&quot;åœ¨å¤©ç©ºè¡Œé©¶&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="æ³¨æ„äº‹é¡¹"><a href="#æ³¨æ„äº‹é¡¹" class="headerlink" title="æ³¨æ„äº‹é¡¹"></a>æ³¨æ„äº‹é¡¹</h3><blockquote>
<p>1ï¼‰é™ä½ç±»çš„å¤æ‚åº¦ï¼Œä¸€ä¸ªç±»åªè´Ÿè´£ä¸€é¡¹èŒè´£ã€‚</p>
<p>2ï¼‰æé«˜ç±»çš„å¯è¯»æ€§ï¼Œå¯ç»´æŠ¤æ€§ã€‚</p>
<p>3ï¼‰é™ä½å˜æ›´å¼•èµ·çš„é£é™©ã€‚</p>
<p>4ï¼‰é€šå¸¸æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬åº”å½“éµå®ˆå•ä¸€èŒè´£åŸåˆ™ï¼Œåªæœ‰é€»è¾‘è¶³å¤Ÿç®€å•ï¼Œæ‰å¯ä»¥åœ¨ä»£ç çº§è¿åå•ä¸€èŒè´£åŸåˆ™ï¼›åªæœ‰ç±»ä¸­æ–¹	  	 æ³•æ•°é‡è¶³å¤Ÿå°‘ï¼Œå¯ä»¥åœ¨æ–¹æ³•çº§åˆ«ä¿æŒå•ä¸€èŒè´£åŸåˆ™ã€‚</p>
</blockquote>
<h2 id="æ¥å£éš”ç¦»åŸåˆ™"><a href="#æ¥å£éš”ç¦»åŸåˆ™" class="headerlink" title="æ¥å£éš”ç¦»åŸåˆ™"></a>æ¥å£éš”ç¦»åŸåˆ™</h2><p>Interface Segregation Principle</p>
<h3 id="åŸºæœ¬ä»‹ç»-1"><a href="#åŸºæœ¬ä»‹ç»-1" class="headerlink" title="åŸºæœ¬ä»‹ç»"></a>åŸºæœ¬ä»‹ç»</h3><blockquote>
<ol>
<li>å®¢æˆ·ç«¯ä¸åº”è¯¥ä¾èµ–å®ƒä¸éœ€è¦çš„æ¥å£ï¼Œå³ä¸€ä¸ªç±»å¯¹å¦ä¸€ä¸ªç±»çš„ä¾èµ–åº”è¯¥å»ºç«‹åœ¨æœ€å°çš„æ¥å£ä¸Šã€‚</li>
</ol>
<img src="/2023/02/28/DesignPattern/Java\Document\è®¾è®¡æ¨¡å¼\è®¾è®¡æ¨¡å¼.assets\image-20221017225157506.png" alt="image-20221017225157506" style="zoom:67%;">

<ol start="2">
<li><p>ç±» A é€šè¿‡æ¥å£ Interface1 ä¾èµ–ç±» B ï¼Œç±» C é€šè¿‡æ¥å£ Interface1 ä¾èµ–ç±» Dï¼Œå¦‚æœæ¥å£ Interface1 å¯¹äºç±» A å’Œç±» C æ¥è¯´ä¸æ˜¯æœ€å°æ¥å£ï¼Œé‚£ä¹ˆç±» B å’Œç±» D å¿…é¡»å»å®ç°å®ƒä»¬ä¸éœ€è¦çš„æ–¹æ³•ã€‚</p>
</li>
<li><p>æŒ‰éš”ç¦»åŸåˆ™åº”å½“è¿™æ ·å¤„ç†ï¼šå°†æ¥å£ Interface1 æ‹†åˆ†ä¸ºç‹¬ç«‹çš„å‡ ä¸ªæ¥å£ï¼Œç±» A å’Œç±» C åˆ†åˆ«ä¸å®ƒä»¬éœ€è¦çš„æ¥å£å»ºç«‹ä¾èµ–å…³ç³»ï¼Œä¹Ÿå°±æ˜¯é‡‡ç”¨æ¥å£éš”ç¦»åŸåˆ™ã€‚</p>
</li>
</ol>
</blockquote>
<h3 id="é—®é¢˜ä»£ç "><a href="#é—®é¢˜ä»£ç " class="headerlink" title="é—®é¢˜ä»£ç "></a>é—®é¢˜ä»£ç </h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> priciple.interfaceSegreation;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">InterfaceSegreation01</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">ClassA</span> <span class="variable">classA</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassA</span>();</span><br><span class="line">        classA.depend1(<span class="keyword">new</span> <span class="title class_">ClassB</span>());</span><br><span class="line">        classA.depend2(<span class="keyword">new</span> <span class="title class_">ClassB</span>());</span><br><span class="line">        classA.depend3(<span class="keyword">new</span> <span class="title class_">ClassB</span>());</span><br><span class="line">        <span class="type">ClassC</span> <span class="variable">classC</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassC</span>();</span><br><span class="line">        classC.depend1(<span class="keyword">new</span> <span class="title class_">ClassD</span>());</span><br><span class="line">        classC.depend4(<span class="keyword">new</span> <span class="title class_">ClassD</span>());</span><br><span class="line">        classC.depend5(<span class="keyword">new</span> <span class="title class_">ClassD</span>());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">Interface1</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">operation1</span><span class="params">()</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">operation2</span><span class="params">()</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">operation3</span><span class="params">()</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">operation4</span><span class="params">()</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">operation5</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ClassA</span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">depend1</span><span class="params">(Interface1 i)</span> &#123;</span><br><span class="line">        i.operation1();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">depend2</span><span class="params">(Interface1 i)</span> &#123;</span><br><span class="line">        i.operation2();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">depend3</span><span class="params">(Interface1 i)</span> &#123;</span><br><span class="line">        i.operation3();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ClassC</span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">depend1</span><span class="params">(Interface1 i)</span> &#123;</span><br><span class="line">        i.operation1();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">depend4</span><span class="params">(Interface1 i)</span> &#123;</span><br><span class="line">        i.operation4();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">depend5</span><span class="params">(Interface1 i)</span> &#123;</span><br><span class="line">        i.operation5();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ClassB</span> <span class="keyword">implements</span> <span class="title class_">Interface1</span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">operation1</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;ClassBå®ç°äº†operation1&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">operation2</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;ClassBå®ç°äº†operation2&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">operation3</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;ClassBå®ç°äº†operation3&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">operation4</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;ClassBå®ç°äº†operation4&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">operation5</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;ClassBå®ç°äº†operation5&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ClassD</span> <span class="keyword">implements</span> <span class="title class_">Interface1</span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">operation1</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;ClassDå®ç°äº†operation1&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">operation2</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;ClassDå®ç°äº†operation2&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">operation3</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;ClassDå®ç°äº†operation3&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">operation4</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;ClassDå®ç°äº†operation4&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">operation5</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;ClassDå®ç°äº†operation5&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿è¡Œç»“æœï¼š</p>
<figure class="highlight tex"><table><tr><td class="code"><pre><span class="line">ClassBå®ç°äº†operation1</span><br><span class="line">ClassBå®ç°äº†operation2</span><br><span class="line">ClassBå®ç°äº†operation3</span><br><span class="line">ClassDå®ç°äº†operation1</span><br><span class="line">ClassDå®ç°äº†operation4</span><br><span class="line">ClassDå®ç°äº†operation5</span><br></pre></td></tr></table></figure>

<h3 id="æ”¹è¿›ä»£ç "><a href="#æ”¹è¿›ä»£ç " class="headerlink" title="æ”¹è¿›ä»£ç "></a>æ”¹è¿›ä»£ç </h3><blockquote>
<p><strong>ä½¿ç”¨æ¥å£éš”ç¦»åŸåˆ™æ”¹è¿›</strong></p>
<ol>
<li><p>ç±»Aé€šè¿‡æ¥å£ Interface1 ä¾èµ–ç±» Bï¼Œç±» C é€šè¿‡æ¥å£ Interface1 ä¾èµ–ç±» Dï¼Œå¦‚æœæ¥å£ Interface1 å¯¹äºç±» A å’Œç±» C æ¥è¯´ä¸æ˜¯æœ€å°æ¥å£ï¼Œé‚£ä¹ˆç±» B å’Œç±» D å¿…é¡»å»å®ç°å®ƒä»¬ä¸éœ€è¦çš„æ–¹æ³•ã€‚</p>
</li>
<li><p>å°†æ¥å£ Interface1 æ‹†åˆ†ä¸ºç‹¬ç«‹çš„å‡ ä¸ªæ¥å£ï¼Œç±» A å’Œç±» C åˆ†åˆ«ä¸å®ƒä»¬éœ€è¦çš„æ¥å£å»ºç«‹ä¾èµ–å…³ç³»ã€‚ä¹Ÿå°±æ˜¯é‡‡ç”¨æ¥å£éš”ç¦»åŸåˆ™ã€‚</p>
</li>
<li><p>æ¥å£ Interface1 ä¸­å‡ºç°çš„æ–¹æ³•ï¼Œæ ¹æ®å®é™…æƒ…å†µæ‹†åˆ†ä¸ºä¸‰ä¸ªæ¥å£ã€‚</p>
</li>
<li><p>ç±»å›¾ç¤ºä¾‹ï¼š</p>
 <img src="/2023/02/28/DesignPattern/Java\Document\è®¾è®¡æ¨¡å¼\è®¾è®¡æ¨¡å¼.assets\image-20221017230102382.png" alt="image-20221017230102382" style="zoom:67%;"></li>
</ol>
</blockquote>
<p>ä»£ç ç¤ºä¾‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> principle.interfaceSegreation.improve;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">InterfaceSegreation02</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">ClassA</span> <span class="variable">classA</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassA</span>();</span><br><span class="line">        classA.depend1(<span class="keyword">new</span> <span class="title class_">ClassB</span>());</span><br><span class="line">        classA.depend2(<span class="keyword">new</span> <span class="title class_">ClassB</span>());</span><br><span class="line">        classA.depend3(<span class="keyword">new</span> <span class="title class_">ClassB</span>());</span><br><span class="line">        <span class="type">ClassC</span> <span class="variable">classC</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassC</span>();</span><br><span class="line">        classC.depend1(<span class="keyword">new</span> <span class="title class_">ClassD</span>());</span><br><span class="line">        classC.depend4(<span class="keyword">new</span> <span class="title class_">ClassD</span>());</span><br><span class="line">        classC.depend5(<span class="keyword">new</span> <span class="title class_">ClassD</span>());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">Interface1</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">operation1</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">Interface2</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">operation2</span><span class="params">()</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">operation3</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">Interface3</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">operation4</span><span class="params">()</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">operation5</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ClassB</span> <span class="keyword">implements</span> <span class="title class_">Interface1</span>, Interface2 &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">operation1</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;ClassBå®ç°äº†operation1&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">operation2</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;ClassBå®ç°äº†operation2&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">operation3</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;ClassBå®ç°äº†operation3&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ClassD</span> <span class="keyword">implements</span> <span class="title class_">Interface1</span>, Interface3 &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">operation1</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;ClassDå®ç°äº†operation1&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">operation4</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;ClassDå®ç°äº†operation4&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">operation5</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;ClassDå®ç°äº†operation5&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ClassA</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">depend1</span><span class="params">(Interface1 i)</span> &#123;</span><br><span class="line">        i.operation1();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">depend2</span><span class="params">(Interface2 i)</span> &#123;</span><br><span class="line">        i.operation2();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">depend3</span><span class="params">(Interface2 i)</span> &#123;</span><br><span class="line">        i.operation3();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ClassC</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">depend1</span><span class="params">(Interface1 i)</span> &#123;</span><br><span class="line">        i.operation1();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">depend4</span><span class="params">(Interface3 i)</span> &#123;</span><br><span class="line">        i.operation4();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">depend5</span><span class="params">(Interface3 i)</span> &#123;</span><br><span class="line">        i.operation5();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="ä¾èµ–å€’è½¬åŸåˆ™"><a href="#ä¾èµ–å€’è½¬åŸåˆ™" class="headerlink" title="ä¾èµ–å€’è½¬åŸåˆ™"></a>ä¾èµ–å€’è½¬åŸåˆ™</h2><h3 id="åŸºæœ¬ä»‹ç»-2"><a href="#åŸºæœ¬ä»‹ç»-2" class="headerlink" title="åŸºæœ¬ä»‹ç»"></a>åŸºæœ¬ä»‹ç»</h3><blockquote>
<ol>
<li>ä¾èµ–å€’è½¬åŸåˆ™ï¼ˆDependence Inversion Principleï¼‰æ˜¯æŒ‡ï¼š</li>
<li>é«˜å±‚æ¨¡å—ä¸åº”è¯¥ä¾èµ–ä½å±‚æ¨¡å—ï¼ŒäºŒè€…éƒ½åº”è¯¥ä¾èµ–å…¶æŠ½è±¡ã€‚</li>
<li>æŠ½è±¡ä¸åº”è¯¥ä¾èµ–ç»†èŠ‚ï¼Œç»†èŠ‚åº”è¯¥ä¾èµ–æŠ½è±¡ã€‚</li>
<li>ä¾èµ–å€’è½¬ï¼ˆå€’ç½®ï¼‰çš„ä¸­å¿ƒæ€æƒ³æ˜¯é¢å‘æ¥å£ç¼–ç¨‹ã€‚</li>
<li>ä¾èµ–å€’è½¬åŸåˆ™æ˜¯åŸºäºè¿™æ ·çš„è®¾è®¡ç†å¿µï¼šç›¸å¯¹äºç»†èŠ‚çš„å¤šå˜æ€§ï¼ŒæŠ½è±¡çš„ä¸œè¥¿è¦ç¨³å®šçš„å¤šã€‚ä»¥æŠ½è±¡ä¸ºåŸºç¡€æ­å»ºçš„æ¶æ„æ¯”ä»¥ç»†èŠ‚ä¸ºåŸºç¡€çš„æ¶æ„è¦ç¨³å®šçš„å¤šã€‚åœ¨ java ä¸­ï¼ŒæŠ½è±¡æŒ‡çš„æ˜¯æ¥å£æˆ–æŠ½è±¡ç±»ï¼Œç»†èŠ‚å°±æ˜¯å…·ä½“çš„å®ç°ç±»ã€‚</li>
<li>ä½¿ç”¨æ¥å£æˆ–æŠ½è±¡ç±»çš„ç›®çš„æ˜¯åˆ¶å®šå¥½è§„èŒƒï¼Œè€Œä¸æ¶‰åŠä»»ä½•å…·ä½“çš„æ“ä½œï¼ŒæŠŠå±•ç°ç»†èŠ‚çš„ä»»åŠ¡äº¤ç»™ä»–ä»¬çš„å®ç°ç±»å»å®Œæˆã€‚</li>
</ol>
</blockquote>
<h3 id="åº”ç”¨ç¤ºä¾‹-1"><a href="#åº”ç”¨ç¤ºä¾‹-1" class="headerlink" title="åº”ç”¨ç¤ºä¾‹"></a>åº”ç”¨ç¤ºä¾‹</h3><p>é—®é¢˜ä»£ç ï¼šPersonæ¥æ”¶æ¶ˆæ¯</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> principle.dependenceInversion;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DependencyInversion</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">Person</span> <span class="variable">person</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Person</span>();</span><br><span class="line">        person.receiveMsg(<span class="keyword">new</span> <span class="title class_">Email</span>());</span><br><span class="line">        <span class="comment">// person.receiveMsg(new WeiXin());</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Person</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">receiveMsg</span><span class="params">(Email email)</span> &#123;</span><br><span class="line">        email.getInfo();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Email</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">getInfo</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Email:getInfo()...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">WeiXin</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">getInfo</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;WeiXin:getInfo()...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä»£ç æ”¹è¿›ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> principle.dependenceInversion.improve;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DependencyInversion02</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">Person</span> <span class="variable">person</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Person</span>();</span><br><span class="line">        person.receiveMsg(<span class="keyword">new</span> <span class="title class_">Email</span>());</span><br><span class="line">        person.receiveMsg(<span class="keyword">new</span> <span class="title class_">WeiXin</span>());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Person</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">receiveMsg</span><span class="params">(IReceiver receive)</span> &#123;</span><br><span class="line">        receive.getInfo();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">IReceiver</span> &#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">getInfo</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Email</span> <span class="keyword">implements</span> <span class="title class_">IReceiver</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">getInfo</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Email:getInfo()...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">WeiXin</span> <span class="keyword">implements</span> <span class="title class_">IReceiver</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">getInfo</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;WeiXin:getInfo()...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="ä¾èµ–å…³ç³»ä¼ é€’çš„ä¸‰ç§æ–¹å¼"><a href="#ä¾èµ–å…³ç³»ä¼ é€’çš„ä¸‰ç§æ–¹å¼" class="headerlink" title="ä¾èµ–å…³ç³»ä¼ é€’çš„ä¸‰ç§æ–¹å¼"></a>ä¾èµ–å…³ç³»ä¼ é€’çš„ä¸‰ç§æ–¹å¼</h3><blockquote>
<ol>
<li><p>æ¥å£ä¼ é€’</p>
</li>
<li><p>æ„é€ æ–¹æ³•ä¼ é€’</p>
</li>
<li><p>setæ–¹å¼ä¼ é€’</p>
</li>
</ol>
</blockquote>
<p>æ¥å£ä¼ é€’ä¾èµ–ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">interface</span> <span class="title class_">IOpenAndClose</span> &#123; <span class="keyword">void</span> <span class="title function_">open</span><span class="params">(ITV tv)</span>; &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">ITV</span> &#123; <span class="keyword">void</span> <span class="title function_">play</span><span class="params">()</span>; &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ChangHong</span> <span class="keyword">implements</span> <span class="title class_">ITV</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span> <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">play</span><span class="params">()</span> &#123; System.out.println(<span class="string">&quot;é•¿è™¹ç”µè§†æœºæ‰“å¼€....&quot;</span>); &#125; &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">class</span> <span class="title class_">OpenAndClose</span> <span class="keyword">implements</span> <span class="title class_">IOpenAndClose</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span> <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">open</span><span class="params">(ITV tv)</span> &#123; tv.play(); &#125; </span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DependencyPass</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">		<span class="type">OpenAndClose</span> <span class="variable">openAndClose</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">OpenAndClose</span>();</span><br><span class="line">		openAndClose.open(<span class="keyword">new</span> <span class="title class_">ChangHong</span>());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>é€šè¿‡æ„é€ å‡½æ•°ä¼ é€’ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">interface</span> <span class="title class_">IOpenAndClose</span> &#123;</span><br><span class="line">	<span class="keyword">void</span> <span class="title function_">open</span><span class="params">(ITV tv)</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">ITV</span> &#123;</span><br><span class="line">	<span class="keyword">void</span> <span class="title function_">play</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ChangHong</span> <span class="keyword">implements</span> <span class="title class_">ITV</span> &#123;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">play</span><span class="params">()</span> &#123;</span><br><span class="line">		System.out.println(<span class="string">&quot;é•¿è™¹ç”µè§†æœºæ‰“å¼€....&quot;</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">OpenAndClose</span> <span class="keyword">implements</span> <span class="title class_">IOpenAndClose</span> &#123;</span><br><span class="line">	<span class="keyword">private</span> ITV tv;</span><br><span class="line">	<span class="keyword">public</span> <span class="title function_">OpenAndClose</span><span class="params">(ITV tv)</span> &#123;</span><br><span class="line">		<span class="built_in">this</span>.tv = tv;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">open</span><span class="params">(ITV tv)</span> &#123;</span><br><span class="line">		tv.play();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DependencyPass</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">		<span class="type">ChangHong</span> <span class="variable">tv</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ChangHong</span>();</span><br><span class="line">		<span class="type">OpenAndClose</span> <span class="variable">openAndClose</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">OpenAndClose</span>(tv);</span><br><span class="line">		openAndClose.open(tv);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>set æ–¹æ³•ä¼ é€’ä¾èµ–ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">interface</span> <span class="title class_">IOpenAndClose</span> &#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">open</span><span class="params">(ITV tv)</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">ITV</span> &#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">play</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ChangHong</span> <span class="keyword">implements</span> <span class="title class_">ITV</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">play</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;é•¿è™¹ç”µè§†æœºæ‰“å¼€....&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">OpenAndClose</span> <span class="keyword">implements</span> <span class="title class_">IOpenAndClose</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> ITV tv;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setTv</span><span class="params">(ITV tv)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.tv = tv;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">open</span><span class="params">(ITV tv)</span> &#123;</span><br><span class="line">        tv.play();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="æ³¨æ„äº‹é¡¹-1"><a href="#æ³¨æ„äº‹é¡¹-1" class="headerlink" title="æ³¨æ„äº‹é¡¹"></a>æ³¨æ„äº‹é¡¹</h3><blockquote>
<ul>
<li>ä½å±‚æ¨¡å—å°½é‡éƒ½è¦æœ‰æŠ½è±¡ç±»æˆ–æ¥å£ï¼Œæˆ–è€…ä¸¤è€…éƒ½æœ‰ï¼Œç¨‹åºç¨³å®šæ€§æ›´å¥½ã€‚</li>
<li>å˜é‡çš„å£°æ˜ç±»å‹å°½é‡æ˜¯æŠ½è±¡ç±»æˆ–æ¥å£, è¿™æ ·æˆ‘ä»¬çš„å˜é‡å¼•ç”¨å’Œå®é™…å¯¹è±¡é—´ï¼Œå°±å­˜åœ¨ ä¸€ä¸ªç¼“å†²å±‚ï¼Œåˆ©äºç¨‹åºæ‰©å±•å’Œä¼˜åŒ–ã€‚</li>
<li>ç»§æ‰¿æ—¶éµå¾ªé‡Œæ°æ›¿æ¢åŸåˆ™ã€‚</li>
</ul>
</blockquote>
<h2 id="é‡Œæ°æ›¿æ¢åŸåˆ™"><a href="#é‡Œæ°æ›¿æ¢åŸåˆ™" class="headerlink" title="é‡Œæ°æ›¿æ¢åŸåˆ™"></a>é‡Œæ°æ›¿æ¢åŸåˆ™</h2><h3 id="åŸºæœ¬ä»‹ç»-3"><a href="#åŸºæœ¬ä»‹ç»-3" class="headerlink" title="åŸºæœ¬ä»‹ç»"></a>åŸºæœ¬ä»‹ç»</h3><blockquote>
<p><strong>OOä¸­çš„ç»§æ‰¿æ€§çš„æ€è€ƒå’Œè¯´æ˜</strong></p>
<ol>
<li><p>ç»§æ‰¿åŒ…å«è¿™æ ·ä¸€å±‚å«ä¹‰ï¼šçˆ¶ç±»ä¸­å‡¡æ˜¯å·²ç»å®ç°å¥½çš„æ–¹æ³•ï¼Œå®é™…ä¸Šæ˜¯åœ¨è®¾å®šè§„èŒƒå’Œå¥‘çº¦ï¼Œè™½ç„¶å®ƒä¸å¼ºåˆ¶è¦æ±‚æ‰€æœ‰çš„å­ç±»å¿…é¡»éµå¾ªè¿™äº›å¥‘çº¦ï¼Œä½†æ˜¯å¦‚æœå­ç±»å¯¹è¿™äº›å·²ç»å®ç°çš„æ–¹æ³•ä»»æ„ä¿®æ”¹ï¼Œå°±ä¼šå¯¹æ•´ä¸ªç»§æ‰¿ä½“ç³»é€ æˆç ´åã€‚</p>
</li>
<li><p>ç»§æ‰¿åœ¨ç»™ç¨‹åºè®¾è®¡å¸¦æ¥ä¾¿åˆ©çš„åŒæ—¶ï¼Œä¹Ÿå¸¦æ¥äº†å¼Šç«¯ã€‚æ¯”å¦‚ä½¿ç”¨ç»§æ‰¿ä¼šç»™ç¨‹åºå¸¦æ¥ä¾µå…¥æ€§ï¼Œç¨‹åºçš„å¯ç§»æ¤æ€§é™ä½ï¼Œå¢åŠ å¯¹è±¡é—´çš„è€¦åˆæ€§ï¼Œå¦‚æœä¸€ä¸ªç±»è¢«å…¶ä»–çš„ç±»æ‰€ç»§æ‰¿ï¼Œ åˆ™å½“è¿™ä¸ªç±»éœ€è¦ä¿®æ”¹æ—¶ï¼Œå¿…é¡»è€ƒè™‘åˆ°æ‰€æœ‰çš„å­ç±»ï¼Œå¹¶ä¸”çˆ¶ç±»ä¿®æ”¹åï¼Œæ‰€æœ‰æ¶‰åŠåˆ°å­ç±»çš„åŠŸèƒ½éƒ½æœ‰å¯èƒ½äº§ç”Ÿæ•…éšœã€‚</p>
</li>
<li><p>é—®é¢˜æå‡ºï¼šåœ¨ç¼–ç¨‹ä¸­ï¼Œå¦‚ä½•æ­£ç¡®çš„ä½¿ç”¨ç»§æ‰¿? &#x3D;&gt; é‡Œæ°æ›¿æ¢åŸåˆ™ã€‚</p>
</li>
</ol>
<p>é‡Œæ°æ›¿æ¢åŸåˆ™ï¼š</p>
<ol>
<li><p>æˆ‘ä»¬å¸¸å¸¸ä¼šé€šè¿‡é‡å†™çˆ¶ç±»çš„æ–¹æ³•å®Œæˆæ–°çš„åŠŸèƒ½ï¼Œè¿™æ ·å†™èµ·æ¥è™½ç„¶ç®€å•ï¼Œä½†æ•´ä¸ªç»§æ‰¿ä½“ç³»çš„å¤ç”¨æ€§ä¼šæ¯”è¾ƒå·®ã€‚ç‰¹åˆ«æ˜¯è¿è¡Œå¤šæ€æ¯”è¾ƒé¢‘ç¹çš„æ—¶å€™ã€‚</p>
</li>
<li><p>é€šç”¨çš„åšæ³•æ˜¯ï¼šåŸæ¥çš„çˆ¶ç±»å’Œå­ç±»éƒ½ç»§æ‰¿ä¸€ä¸ªæ›´é€šä¿—çš„åŸºç±»ï¼ŒåŸæœ‰çš„ç»§æ‰¿å…³ç³»å»æ‰ï¼Œ é‡‡ç”¨ä¾èµ–ï¼Œèšåˆï¼Œç»„åˆç­‰å…³ç³»ä»£æ›¿ã€‚</p>
</li>
</ol>
</blockquote>
<h3 id="é—®é¢˜ä»£ç -1"><a href="#é—®é¢˜ä»£ç -1" class="headerlink" title="é—®é¢˜ä»£ç "></a>é—®é¢˜ä»£ç </h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> principle.liskov;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * é‡Œæ°æ›¿æ¢</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Liskov</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">A</span> <span class="variable">a</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">A</span>();</span><br><span class="line">        System.out.println(<span class="string">&quot;12-3=&quot;</span> + a.fun1(<span class="number">12</span>, <span class="number">3</span>)); <span class="comment">// 12-3=9</span></span><br><span class="line">        System.out.println(<span class="string">&quot;1-8=&quot;</span> + a.fun1(<span class="number">1</span>, <span class="number">8</span>)); <span class="comment">// 1-8=-7</span></span><br><span class="line">        <span class="type">B</span> <span class="variable">b</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">B</span>();</span><br><span class="line">        System.out.println(<span class="string">&quot;12-3=&quot;</span> + b.fun1(<span class="number">12</span>, <span class="number">3</span>)); <span class="comment">// 12-3=15</span></span><br><span class="line">        System.out.println(<span class="string">&quot;1-8=&quot;</span> + b.fun2(<span class="number">1</span>, <span class="number">8</span>));<span class="comment">// 1-8=11</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">A</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">fun1</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> y)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> x - y;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">B</span> <span class="keyword">extends</span> <span class="title class_">A</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">fun1</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> y)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> x + y;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">fun2</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> y)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> fun1(x, y) + <span class="number">2</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="ä¼˜åŒ–ä»£ç "><a href="#ä¼˜åŒ–ä»£ç " class="headerlink" title="ä¼˜åŒ–ä»£ç "></a>ä¼˜åŒ–ä»£ç </h3><p>â€‹		ä½¿åŸæ¥çš„çˆ¶ç±»å’Œå­ç±»éƒ½ç»§æ‰¿ä¸€ä¸ªæ›´é€šä¿—çš„åŸºç±»ï¼ŒåŸæœ‰çš„ç»§æ‰¿å…³ç³»å»æ‰ï¼Œ é‡‡ç”¨ä¾èµ–ï¼Œèšåˆï¼Œç»„åˆç­‰å…³ç³»ä»£æ›¿ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> principle.liskov.improve;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Liskov</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">A</span> <span class="variable">a</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">A</span>();</span><br><span class="line">        System.out.println(<span class="string">&quot;12-3=&quot;</span> + a.fun1(<span class="number">12</span>, <span class="number">3</span>)); <span class="comment">// 12-3=9</span></span><br><span class="line">        System.out.println(<span class="string">&quot;1-8=&quot;</span> + a.fun1(<span class="number">1</span>, <span class="number">8</span>)); <span class="comment">// 1-8=-7</span></span><br><span class="line">        <span class="type">B</span> <span class="variable">b</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">B</span>();</span><br><span class="line">        System.out.println(<span class="string">&quot;12-3=&quot;</span> + b.fun1(<span class="number">12</span>, <span class="number">3</span>)); <span class="comment">// 12-3=15</span></span><br><span class="line">        System.out.println(<span class="string">&quot;1-8=&quot;</span> + b.fun2(<span class="number">1</span>, <span class="number">8</span>));<span class="comment">// 1-8=11</span></span><br><span class="line">        System.out.println(<span class="string">&quot;1-8=&quot;</span> + b.fun3(<span class="number">1</span>, <span class="number">8</span>));<span class="comment">// 1-8=11</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//åˆ›å»ºä¸€ä¸ªæ›´åŠ åŸºç¡€çš„åŸºç±»</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Base</span>&#123;</span><br><span class="line">    <span class="comment">//æŠŠæ›´åŠ åŸºç¡€çš„æ–¹æ³•å’Œæˆå‘˜å†™åˆ°Baseç±»</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">A</span> <span class="keyword">extends</span> <span class="title class_">Base</span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">fun1</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> y)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> x - y;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">B</span> <span class="keyword">extends</span> <span class="title class_">Base</span> &#123;</span><br><span class="line">    <span class="comment">//å¦‚æœBéœ€è¦ä½¿ç”¨Aç±»çš„æ–¹æ³•,ä½¿ç”¨ç»„åˆå…³ç³»</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">A</span> <span class="variable">a</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">A</span>();</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">fun1</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> y)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> x + y;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">fun2</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> y)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> fun1(x, y) + <span class="number">2</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">fun3</span><span class="params">(<span class="type">int</span> x,<span class="type">int</span> y)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.a.fun1(x,y);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="å¼€é—­åŸåˆ™"><a href="#å¼€é—­åŸåˆ™" class="headerlink" title="å¼€é—­åŸåˆ™"></a>å¼€é—­åŸåˆ™</h2><h3 id="åŸºæœ¬ä»‹ç»-4"><a href="#åŸºæœ¬ä»‹ç»-4" class="headerlink" title="åŸºæœ¬ä»‹ç»"></a>åŸºæœ¬ä»‹ç»</h3><blockquote>
<ol>
<li><p>å¼€é—­åŸåˆ™ï¼ˆOpen Closed Principleï¼‰æ˜¯ç¼–ç¨‹ä¸­æœ€åŸºç¡€ã€æœ€é‡è¦çš„è®¾è®¡åŸåˆ™ã€‚</p>
</li>
<li><p>ä¸€ä¸ªè½¯ä»¶å®ä½“å¦‚ç±»ï¼Œæ¨¡å—å’Œå‡½æ•°åº”è¯¥å¯¹æ‰©å±•å¼€æ”¾ï¼ˆå¯¹æä¾›æ–¹ï¼‰ï¼Œå¯¹ä¿®æ”¹å…³é—­ï¼ˆå¯¹ä½¿ç”¨æ–¹ï¼‰ã€‚ç”¨æŠ½è±¡æ„å»ºæ¡†æ¶ï¼Œç”¨å®ç°æ‰©å±•ç»†èŠ‚ã€‚</p>
</li>
<li><p>å½“è½¯ä»¶éœ€è¦å˜åŒ–æ—¶ï¼Œå°½é‡é€šè¿‡æ‰©å±•è½¯ä»¶å®ä½“çš„è¡Œä¸ºæ¥å®ç°å˜åŒ–ï¼Œè€Œä¸æ˜¯é€šè¿‡ä¿®æ”¹å·²æœ‰çš„ä»£ç æ¥å®ç°å˜åŒ–ã€‚</p>
</li>
<li><p>ç¼–ç¨‹ä¸­éµå¾ªå…¶å®ƒåŸåˆ™ï¼Œä»¥åŠä½¿ç”¨è®¾è®¡æ¨¡å¼çš„ç›®çš„å°±æ˜¯éµå¾ªå¼€é—­åŸåˆ™ã€‚</p>
</li>
<li><p><strong>å³å½“æˆ‘ä»¬ç»™ç±»å¢åŠ æ–°åŠŸèƒ½çš„æ—¶å€™ï¼Œå°½é‡ä¸ä¿®æ”¹ä»£ç ï¼Œæˆ–è€…å°½å¯èƒ½å°‘ä¿®æ”¹ä»£ç ã€‚</strong></p>
<p> ç¤ºä¾‹ï¼š</p>
 <img src="/2023/02/28/DesignPattern/Java\Document\è®¾è®¡æ¨¡å¼\è®¾è®¡æ¨¡å¼.assets\image-20221018134626777.png" alt="image-20221018134626777" style="zoom:67%;"></li>
</ol>
</blockquote>
<h3 id="é—®é¢˜ä»£ç -2"><a href="#é—®é¢˜ä»£ç -2" class="headerlink" title="é—®é¢˜ä»£ç "></a>é—®é¢˜ä»£ç </h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> principle.ocp;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">GraphicEditor</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">GraphicEditor</span> <span class="variable">graphicEditor</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">GraphicEditor</span>();</span><br><span class="line">        graphicEditor.drawShape(<span class="keyword">new</span> <span class="title class_">Circle</span>());</span><br><span class="line">        graphicEditor.drawShape(<span class="keyword">new</span> <span class="title class_">Rectangle</span>());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">drawShape</span><span class="params">(Shape s)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (s.m_type == <span class="number">1</span>) &#123;</span><br><span class="line">            drawCircle();</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (s.m_type == <span class="number">2</span>) &#123;</span><br><span class="line">            drawRectangle();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">drawRectangle</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot; Rectangle &quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">drawCircle</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot; Circle &quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Shape</span> &#123;</span><br><span class="line">    <span class="type">int</span> m_type;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Circle</span> <span class="keyword">extends</span> <span class="title class_">Shape</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Circle</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>.m_type = <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Rectangle</span> <span class="keyword">extends</span> <span class="title class_">Shape</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Rectangle</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>.m_type = <span class="number">2</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="ä¼˜åŒ–ä»£ç -1"><a href="#ä¼˜åŒ–ä»£ç -1" class="headerlink" title="ä¼˜åŒ–ä»£ç "></a>ä¼˜åŒ–ä»£ç </h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> principle.ocp.improve;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">GraphicEditor</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">GraphicEditor</span> <span class="variable">graphicEditor</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">GraphicEditor</span>();</span><br><span class="line">        graphicEditor.drawShape(<span class="keyword">new</span> <span class="title class_">Circle</span>());</span><br><span class="line">        graphicEditor.drawShape(<span class="keyword">new</span> <span class="title class_">Rectangle</span>());</span><br><span class="line">        graphicEditor.drawShape(<span class="keyword">new</span> <span class="title class_">OtherShape</span>());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">drawShape</span><span class="params">(Shape s)</span> &#123;</span><br><span class="line">        s.draw();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">Shape</span> &#123;</span><br><span class="line">    <span class="type">int</span> m_type;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title function_">draw</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Circle</span> <span class="keyword">extends</span> <span class="title class_">Shape</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Circle</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>.m_type = <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">draw</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;draw circle...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Rectangle</span> <span class="keyword">extends</span> <span class="title class_">Shape</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Rectangle</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>.m_type = <span class="number">2</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">draw</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;rectangle circle...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">OtherShape</span> <span class="keyword">extends</span> <span class="title class_">Shape</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">OtherShape</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>.m_type = <span class="number">3</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">draw</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;draw otherShape...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="è¿ªç±³ç‰¹æ³•åˆ™"><a href="#è¿ªç±³ç‰¹æ³•åˆ™" class="headerlink" title="è¿ªç±³ç‰¹æ³•åˆ™"></a>è¿ªç±³ç‰¹æ³•åˆ™</h2><h3 id="åŸºæœ¬ä»‹ç»-5"><a href="#åŸºæœ¬ä»‹ç»-5" class="headerlink" title="åŸºæœ¬ä»‹ç»"></a>åŸºæœ¬ä»‹ç»</h3><blockquote>
<ol>
<li>ä¸€ä¸ªå¯¹è±¡åº”è¯¥å¯¹å…¶ä»–å¯¹è±¡ä¿æŒæœ€å°‘çš„äº†è§£ã€‚</li>
<li>ç±»ä¸ç±»å…³ç³»è¶Šå¯†åˆ‡ï¼Œè€¦åˆåº¦è¶Šå¤§ã€‚</li>
<li>è¿ªç±³ç‰¹æ³•åˆ™ï¼ˆDemeter Principleï¼‰åˆå«æœ€å°‘çŸ¥é“åŸåˆ™ï¼Œ<strong>å³ä¸€ä¸ªç±»å¯¹è‡ªå·±ä¾èµ–çš„ç±»çŸ¥é“çš„è¶Šå°‘è¶Šå¥½</strong>ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¯¹äºè¢«ä¾èµ–çš„ç±»ä¸ç®¡å¤šä¹ˆå¤æ‚ï¼Œéƒ½å°½é‡å°†é€»è¾‘å°è£…åœ¨ç±»çš„å†…éƒ¨ã€‚å¯¹å¤–é™¤äº†æä¾›çš„ public æ–¹æ³•ï¼Œä¸å¯¹å¤–æ³„éœ²ä»»ä½•ä¿¡æ¯ã€‚</li>
<li>è¿ªç±³ç‰¹æ³•åˆ™è¿˜æœ‰ä¸ªæ›´ç®€å•çš„å®šä¹‰ï¼šåªä¸ç›´æ¥çš„æœ‹å‹é€šä¿¡ã€‚</li>
<li>ç›´æ¥çš„æœ‹å‹ï¼šæ¯ä¸ªå¯¹è±¡éƒ½ä¼šä¸å…¶ä»–å¯¹è±¡æœ‰è€¦åˆå…³ç³»ï¼Œåªè¦ä¸¤ä¸ªå¯¹è±¡ä¹‹é—´æœ‰è€¦åˆå…³ç³»ï¼Œæˆ‘ä»¬å°±è¯´è¿™ä¸¤ä¸ªå¯¹è±¡ä¹‹é—´æ˜¯æœ‹å‹å…³ç³»ã€‚è€¦åˆçš„æ–¹å¼å¾ˆå¤šï¼Œä¾èµ–ï¼Œå…³è”ï¼Œç»„åˆï¼Œèšåˆç­‰ã€‚å…¶ä¸­ï¼Œæˆ‘ä»¬ç§°å‡ºç°æˆå‘˜å˜é‡ï¼Œæ–¹æ³•å‚æ•°ï¼Œæ–¹æ³•è¿”å›å€¼ä¸­çš„ç±»ä¸ºç›´æ¥çš„æœ‹å‹ï¼Œ<strong>è€Œå‡ºç°åœ¨å±€éƒ¨å˜é‡ä¸­çš„ç±»ä¸æ˜¯ç›´æ¥çš„æœ‹å‹</strong>ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œé™Œç”Ÿçš„ç±»æœ€å¥½ä¸è¦ä»¥å±€éƒ¨å˜é‡çš„å½¢å¼å‡ºç°åœ¨ç±»çš„å†…éƒ¨ã€‚</li>
</ol>
</blockquote>
<h3 id="åº”ç”¨ç¤ºä¾‹-2"><a href="#åº”ç”¨ç¤ºä¾‹-2" class="headerlink" title="åº”ç”¨ç¤ºä¾‹"></a>åº”ç”¨ç¤ºä¾‹</h3><p>â€‹		æœ‰ä¸€ä¸ªå­¦æ ¡ï¼Œä¸‹å±æœ‰å„ä¸ªå­¦é™¢å’Œæ€»éƒ¨ï¼Œç°è¦æ±‚æ‰“å°å‡ºå­¦æ ¡æ€»éƒ¨å‘˜å·¥IDå’Œå­¦é™¢å‘˜å·¥çš„idã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> principle.demeter;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Demeter1</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">CollegeManager</span> <span class="variable">collegeManager</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CollegeManager</span>();</span><br><span class="line">        <span class="type">SchoolManager</span> <span class="variable">schoolManager</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SchoolManager</span>();</span><br><span class="line">        schoolManager.printAllEmployee(collegeManager);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//åˆ†æ ¡å‘˜å·¥</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Employee</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String id;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getId</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setId</span><span class="params">(String id)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.id = id;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//æ€»æ ¡å‘˜å·¥</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">SchoolEmployee</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String id;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getId</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setId</span><span class="params">(String id)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.id = id;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">CollegeManager</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> List&lt;Employee&gt; employeeList = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;Employee&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> List&lt;Employee&gt; <span class="title function_">getAllEmployee</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span><br><span class="line">            <span class="type">Employee</span> <span class="variable">employee</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Employee</span>();</span><br><span class="line">            employee.setId(<span class="string">&quot;åˆ†æ ¡idï¼š&quot;</span> + i);</span><br><span class="line">            employeeList.add(employee);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> employeeList;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">SchoolManager</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> List&lt;SchoolEmployee&gt; schoolEmployeeList = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;SchoolEmployee&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> List&lt;SchoolEmployee&gt; <span class="title function_">getAllEmployee</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span><br><span class="line">            <span class="type">SchoolEmployee</span> <span class="variable">schoolEmployee</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SchoolEmployee</span>();</span><br><span class="line">            schoolEmployee.setId(<span class="string">&quot;æ€»æ ¡idï¼š&quot;</span> + i);</span><br><span class="line">            schoolEmployeeList.add(schoolEmployee);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> schoolEmployeeList;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">printAllEmployee</span><span class="params">(CollegeManager collegeManager)</span> &#123;</span><br><span class="line">        List&lt;Employee&gt; employeeList = collegeManager.getAllEmployee();</span><br><span class="line">        </span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * åˆ†æé—®é¢˜</span></span><br><span class="line"><span class="comment">         * 1. è¿™é‡Œçš„ CollegeEmployee ä¸æ˜¯ SchoolManagerçš„ç›´æ¥æœ‹å‹</span></span><br><span class="line"><span class="comment">         * 2. CollegeEmployee æ˜¯ä»¥å±€éƒ¨å˜é‡æ–¹å¼å‡ºç°åœ¨ SchoolManager</span></span><br><span class="line"><span class="comment">         * 3. è¿åäº† è¿ªç±³ç‰¹æ³•åˆ™</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="keyword">for</span> (Employee e : employeeList) &#123;</span><br><span class="line">            System.out.println(e.getId());</span><br><span class="line">        &#125;</span><br><span class="line">        List&lt;SchoolEmployee&gt; allEmployee = <span class="built_in">this</span>.getAllEmployee();</span><br><span class="line">        <span class="keyword">for</span> (SchoolEmployee schoolEmployee : allEmployee) &#123;</span><br><span class="line">            System.out.println(schoolEmployee.getId());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä»£ç ä¿®æ”¹ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> principle.demeter.improve;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Demeter2</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">CollegeManager</span> <span class="variable">collegeManager</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CollegeManager</span>();</span><br><span class="line">        <span class="type">SchoolManager</span> <span class="variable">schoolManager</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SchoolManager</span>();</span><br><span class="line">        schoolManager.printAllEmployee(collegeManager);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//åˆ†æ ¡å‘˜å·¥</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Employee</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String id;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getId</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setId</span><span class="params">(String id)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.id = id;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//æ€»æ ¡å‘˜å·¥</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">SchoolEmployee</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String id;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getId</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setId</span><span class="params">(String id)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.id = id;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">CollegeManager</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> List&lt;Employee&gt; employeeList = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;Employee&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> List&lt;Employee&gt; <span class="title function_">getAllEmployee</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span><br><span class="line">            <span class="type">Employee</span> <span class="variable">employee</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Employee</span>();</span><br><span class="line">            employee.setId(<span class="string">&quot;åˆ†æ ¡idï¼š&quot;</span> + i);</span><br><span class="line">            employeeList.add(employee);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> employeeList;</span><br><span class="line">    &#125;</span><br><span class="line">	<span class="comment">// ==========æ‰“å°åˆ†æ ¡==========</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">printAllEmployee</span><span class="params">()</span> &#123;</span><br><span class="line">        List&lt;Employee&gt; allEmployee = <span class="built_in">this</span>.getAllEmployee();</span><br><span class="line">        <span class="keyword">for</span> (Employee e : allEmployee) &#123;</span><br><span class="line">            System.out.println(e.getId());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">SchoolManager</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> List&lt;SchoolEmployee&gt; schoolEmployeeList = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;SchoolEmployee&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> List&lt;SchoolEmployee&gt; <span class="title function_">getAllEmployee</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span><br><span class="line">            <span class="type">SchoolEmployee</span> <span class="variable">schoolEmployee</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SchoolEmployee</span>();</span><br><span class="line">            schoolEmployee.setId(<span class="string">&quot;æ€»æ ¡idï¼š&quot;</span> + i);</span><br><span class="line">            schoolEmployeeList.add(schoolEmployee);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> schoolEmployeeList;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">printAllEmployee</span><span class="params">(CollegeManager collegeManager)</span> &#123;</span><br><span class="line">        <span class="comment">// ==============ä¿®æ”¹ï¼šå°†æ‰“å°åˆ†æ ¡çš„ä»£ç å•ç‹¬æå‡º==============</span></span><br><span class="line">        collegeManager.printAllEmployee();</span><br><span class="line">        List&lt;SchoolEmployee&gt; allEmployee = <span class="built_in">this</span>.getAllEmployee();</span><br><span class="line">        <span class="keyword">for</span> (SchoolEmployee schoolEmployee : allEmployee) &#123;</span><br><span class="line">            System.out.println(schoolEmployee.getId());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="æ³¨æ„äº‹é¡¹-2"><a href="#æ³¨æ„äº‹é¡¹-2" class="headerlink" title="æ³¨æ„äº‹é¡¹"></a>æ³¨æ„äº‹é¡¹</h3><blockquote>
<ul>
<li>è¿ªç±³ç‰¹æ³•åˆ™çš„æ ¸å¿ƒæ˜¯é™ä½ç±»ä¹‹é—´çš„è€¦åˆã€‚</li>
<li>ä½†æ˜¯æ³¨æ„ï¼šç”±äºæ¯ä¸ªç±»éƒ½å‡å°‘äº†ä¸å¿…è¦çš„ä¾èµ–ï¼Œå› æ­¤è¿ªç±³ç‰¹æ³•åˆ™åªæ˜¯è¦æ±‚é™ä½ç±»é—´ï¼ˆå¯¹è±¡é—´ï¼‰è€¦åˆå…³ç³»ï¼Œå¹¶ä¸æ˜¯è¦æ±‚å®Œå…¨æ²¡æœ‰ä¾èµ–å…³ç³»ã€‚</li>
</ul>
</blockquote>
<h2 id="åˆæˆå¤ç”¨åŸåˆ™"><a href="#åˆæˆå¤ç”¨åŸåˆ™" class="headerlink" title="åˆæˆå¤ç”¨åŸåˆ™"></a>åˆæˆå¤ç”¨åŸåˆ™</h2><h3 id="åŸºæœ¬ä»‹ç»-6"><a href="#åŸºæœ¬ä»‹ç»-6" class="headerlink" title="åŸºæœ¬ä»‹ç»"></a>åŸºæœ¬ä»‹ç»</h3><p>â€‹		Composite Reuse Principle åŸåˆ™æ˜¯å°½é‡ä½¿ç”¨åˆæˆ &#x2F; èšåˆçš„æ–¹å¼ï¼Œè€Œä¸æ˜¯ä½¿ç”¨ç»§æ‰¿ã€‚</p>
<h3 id="è®¾è®¡åŸåˆ™æ ¸å¿ƒæ€æƒ³"><a href="#è®¾è®¡åŸåˆ™æ ¸å¿ƒæ€æƒ³" class="headerlink" title="è®¾è®¡åŸåˆ™æ ¸å¿ƒæ€æƒ³"></a>è®¾è®¡åŸåˆ™æ ¸å¿ƒæ€æƒ³</h3><blockquote>
<ol>
<li><p>æ‰¾å‡ºåº”ç”¨ä¸­å¯èƒ½éœ€è¦å˜åŒ–ä¹‹å¤„ï¼ŒæŠŠå®ƒä»¬ç‹¬ç«‹å‡ºæ¥ï¼Œä¸è¦å’Œé‚£äº›ä¸éœ€è¦å˜åŒ–çš„ä»£ç æ··åœ¨ä¸€èµ·ã€‚</p>
</li>
<li><p>é’ˆå¯¹æ¥å£ç¼–ç¨‹ï¼Œè€Œä¸æ˜¯é’ˆå¯¹å®ç°ç¼–ç¨‹ã€‚</p>
</li>
<li><p>ä¸ºäº†äº¤äº’å¯¹è±¡ä¹‹é—´çš„æ¾è€¦åˆè®¾è®¡è€ŒåŠªåŠ›ã€‚</p>
</li>
</ol>
<img src="/2023/02/28/DesignPattern/Java\Document\è®¾è®¡æ¨¡å¼\è®¾è®¡æ¨¡å¼.assets\image-20221018145123126.png" alt="image-20221018145123126" style="zoom:50%;">
</blockquote>
<h1 id="UML-ç±»å›¾"><a href="#UML-ç±»å›¾" class="headerlink" title="UML ç±»å›¾"></a>UML ç±»å›¾</h1><blockquote>
<p>Dependency ï¼šè¡¨ç¤ºä¾èµ–ï¼Œå¦‚Bç±»ä¸­çš„æ–¹æ³•éœ€è¦ä¼ å…¥å‚æ•°ä¸ºAç±»çš„ç±»å‹</p>
<p>Association  ï¼šè¡¨ç¤ºå…³è”</p>
<p>Generalization ï¼šè¡¨ç¤ºæ³›åŒ–ï¼ˆç»§æ‰¿ï¼‰</p>
<p>Realization  ï¼šè¡¨ç¤ºå®ç°</p>
<p>Aggregation ï¼šè¡¨ç¤ºèšåˆï¼Œå¦‚Bç±»ä¸­åŒ…å«å±æ€§æˆå‘˜Aç±»ç±»å‹ï¼Œé€šè¿‡setæ–¹æ³•èµ‹å€¼</p>
<p>Composite  ï¼šè¡¨ç¤ºç»„åˆï¼Œå¦‚åœ¨Bç±»newä¸€ä¸ªAç±»ç±»å‹ï¼Œè€¦åˆæ€§æ›´å¼ºã€‚</p>
</blockquote>
<blockquote>
<p><img src="/2023/02/28/DesignPattern/Java\Document\è®¾è®¡æ¨¡å¼\è®¾è®¡æ¨¡å¼.assets\image-20221018152704557.png" alt="image-20221018152704557"></p>
<p><img src="/2023/02/28/DesignPattern/Java\Document\è®¾è®¡æ¨¡å¼\è®¾è®¡æ¨¡å¼.assets\image-20221018152737496.png" alt="image-20221018152737496"></p>
<p><img src="/2023/02/28/DesignPattern/Java\Document\è®¾è®¡æ¨¡å¼\è®¾è®¡æ¨¡å¼.assets\image-20221018152749477.png" alt="image-20221018152749477"></p>
<p><img src="/2023/02/28/DesignPattern/Java\Document\è®¾è®¡æ¨¡å¼\è®¾è®¡æ¨¡å¼.assets\image-20221018152803857.png" alt="image-20221018152803857"></p>
<p><img src="/2023/02/28/DesignPattern/Java\Document\è®¾è®¡æ¨¡å¼\è®¾è®¡æ¨¡å¼.assets\image-20221018152817414.png" alt="image-20221018152817414"></p>
<p><img src="/2023/02/28/DesignPattern/Java\Document\è®¾è®¡æ¨¡å¼\è®¾è®¡æ¨¡å¼.assets\image-20221018152832611.png" alt="image-20221018152832611"></p>
<p><img src="/2023/02/28/DesignPattern/Java\Document\è®¾è®¡æ¨¡å¼\è®¾è®¡æ¨¡å¼.assets\image-20221018152900011.png" alt="image-20221018152900011"></p>
<p><img src="/2023/02/28/DesignPattern/Java\Document\è®¾è®¡æ¨¡å¼\è®¾è®¡æ¨¡å¼.assets\image-20221018152844299.png" alt="image-20221018152844299"></p>
<p><img src="/2023/02/28/DesignPattern/Java\Document\è®¾è®¡æ¨¡å¼\è®¾è®¡æ¨¡å¼.assets\image-20221018152930534.png" alt="image-20221018152930534"></p>
<p><img src="/2023/02/28/DesignPattern/Java\Document\è®¾è®¡æ¨¡å¼\è®¾è®¡æ¨¡å¼.assets\image-20221018153000462.png" alt="image-20221018153000462"></p>
</blockquote>
<h1 id="å•ä¾‹æ¨¡å¼"><a href="#å•ä¾‹æ¨¡å¼" class="headerlink" title="å•ä¾‹æ¨¡å¼"></a>å•ä¾‹æ¨¡å¼</h1><h2 id="åŸºæœ¬ä»‹ç»-7"><a href="#åŸºæœ¬ä»‹ç»-7" class="headerlink" title="åŸºæœ¬ä»‹ç»"></a>åŸºæœ¬ä»‹ç»</h2><blockquote>
<p>æ‰€è°“ç±»çš„å•ä¾‹è®¾è®¡æ¨¡å¼ï¼Œå°±æ˜¯é‡‡å–ä¸€å®šçš„æ–¹æ³•ä¿è¯åœ¨æ•´ä¸ªçš„è½¯ä»¶ç³»ç»Ÿä¸­ï¼Œå¯¹æŸä¸ªç±» åªèƒ½å­˜åœ¨ä¸€ä¸ªå¯¹è±¡å®ä¾‹ï¼Œå¹¶ä¸”è¯¥ç±»åªæä¾›ä¸€ä¸ªå–å¾—å…¶å¯¹è±¡å®ä¾‹çš„æ–¹æ³•(é™æ€æ–¹æ³•)ã€‚</p>
<p>æ¯”å¦‚Hibernateçš„SessionFactoryï¼Œå®ƒå……å½“æ•°æ®å­˜å‚¨æºçš„ä»£ç†ï¼Œå¹¶è´Ÿè´£åˆ›å»ºSession å¯¹è±¡ã€‚SessionFactoryå¹¶ä¸æ˜¯è½»é‡çº§çš„ï¼Œä¸€èˆ¬æƒ…å†µä¸‹ï¼Œä¸€ä¸ªé¡¹ç›®é€šå¸¸åªéœ€è¦ä¸€ä¸ª SessionFactoryå°±å¤Ÿï¼Œè¿™æ˜¯å°±ä¼šä½¿ç”¨åˆ°å•ä¾‹æ¨¡å¼ã€‚</p>
<p>å•ä¾‹æ¨¡å¼æœ‰å…«ç§æ–¹å¼ï¼š</p>
<ol>
<li><p>é¥¿æ±‰å¼(é™æ€å¸¸é‡)</p>
</li>
<li><p>é¥¿æ±‰å¼ï¼ˆé™æ€ä»£ç å—ï¼‰</p>
</li>
<li><p>æ‡’æ±‰å¼ï¼ˆçº¿ç¨‹ä¸å®‰å…¨ï¼‰</p>
</li>
<li><p>æ‡’æ±‰å¼ï¼ˆçº¿ç¨‹å®‰å…¨ï¼ŒåŒæ­¥æ–¹æ³•ï¼‰</p>
</li>
<li><p>æ‡’æ±‰å¼ï¼ˆçº¿ç¨‹å®‰å…¨ï¼ŒåŒæ­¥ä»£ç å—ï¼‰</p>
</li>
<li><p>åŒé‡æ£€æŸ¥</p>
</li>
<li><p>é™æ€å†…éƒ¨ç±»</p>
</li>
<li><p>æšä¸¾</p>
</li>
</ol>
</blockquote>
<h2 id="å•ä¾‹æ¨¡å¼ï¼ˆé™æ€å¸¸é‡é¥¿æ±‰å¼ï¼‰"><a href="#å•ä¾‹æ¨¡å¼ï¼ˆé™æ€å¸¸é‡é¥¿æ±‰å¼ï¼‰" class="headerlink" title="å•ä¾‹æ¨¡å¼ï¼ˆé™æ€å¸¸é‡é¥¿æ±‰å¼ï¼‰"></a>å•ä¾‹æ¨¡å¼ï¼ˆé™æ€å¸¸é‡é¥¿æ±‰å¼ï¼‰</h2><ul>
<li>æ„é€ å™¨ç§æœ‰åŒ– (é˜²æ­¢ new )ã€‚</li>
<li>ç±»çš„å†…éƒ¨åˆ›å»ºå¯¹è±¡ã€‚</li>
<li>å‘å¤–æš´éœ²ä¸€ä¸ªé™æ€çš„å…¬å…±æ–¹æ³•ã€‚getInstance</li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * staticé¥¿æ±‰å¼</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">SingleTon01</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">SingleTon01</span> <span class="variable">INSTANCE</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SingleTon01</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">SingleTon01</span><span class="params">()</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> SingleTon01 <span class="title function_">getInstance</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> INSTANCE;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä¼˜ç¼ºç‚¹ï¼š</p>
<blockquote>
<p>ä¼˜ç‚¹ï¼šå†™æ³•æ¯”è¾ƒç®€å•ï¼Œå°±æ˜¯åœ¨ç±»è£…è½½çš„æ—¶å€™å°±å®Œæˆå®ä¾‹åŒ–ã€‚é¿å…äº†çº¿ç¨‹åŒ æ­¥é—®é¢˜ã€‚</p>
<p>ç¼ºç‚¹ï¼šåœ¨ç±»è£…è½½çš„æ—¶å€™å°±å®Œæˆå®ä¾‹åŒ–ï¼Œæ²¡æœ‰è¾¾åˆ°Lazy Loadingçš„æ•ˆæœã€‚å¦‚æœä»å§‹ è‡³ç»ˆä»æœªä½¿ç”¨è¿‡è¿™ä¸ªå®ä¾‹ï¼Œåˆ™ä¼šé€ æˆå†…å­˜çš„æµªè´¹ã€‚è¿™ç§æ–¹å¼åŸºäº classloder æœºåˆ¶é¿å…äº†å¤šçº¿ç¨‹çš„åŒæ­¥é—®é¢˜ï¼Œä¸è¿‡ï¼Œinstanceåœ¨ç±»è£…è½½ æ—¶å°±å®ä¾‹åŒ–ï¼Œåœ¨å•ä¾‹æ¨¡å¼ä¸­å¤§å¤šæ•°éƒ½æ˜¯è°ƒç”¨ getInstance æ–¹æ³•ï¼Œä½†æ˜¯å¯¼è‡´ç±»è£…è½½çš„åŸå› æœ‰å¾ˆå¤šç§ï¼Œå› æ­¤ä¸èƒ½ç¡®å®šæœ‰å…¶ä»–çš„æ–¹å¼ï¼ˆæˆ–è€…å…¶ä»–çš„é™æ€æ–¹æ³•ï¼‰å¯¼è‡´ç±»è£…è½½ï¼Œè¿™æ—¶å€™åˆå§‹åŒ–instanceå°±æ²¡æœ‰è¾¾åˆ°lazy loadingçš„æ•ˆæœã€‚</p>
<p>ç»“è®ºï¼šè¿™ç§å•ä¾‹æ¨¡å¼å¯ç”¨ï¼Œå¯èƒ½é€ æˆå†…å­˜æµªè´¹ã€‚</p>
</blockquote>
<h2 id="å•ä¾‹ï¼ˆé™æ€ä»£ç å—é¥¿æ±‰å¼ï¼‰"><a href="#å•ä¾‹ï¼ˆé™æ€ä»£ç å—é¥¿æ±‰å¼ï¼‰" class="headerlink" title="å•ä¾‹ï¼ˆé™æ€ä»£ç å—é¥¿æ±‰å¼ï¼‰"></a>å•ä¾‹ï¼ˆé™æ€ä»£ç å—é¥¿æ±‰å¼ï¼‰</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * é™æ€ä»£ç å—</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">SingleTon02</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">SingleTon02</span><span class="params">()</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> SingleTon02 singleTon;</span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        singleTon = <span class="keyword">new</span> <span class="title class_">SingleTon02</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> SingleTon02 <span class="title function_">getInstance</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> singleTon;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¯´æ˜ï¼š</p>
<blockquote>
<ol>
<li><p>è¿™ç§æ–¹å¼å’Œä¸Šé¢çš„æ–¹å¼å…¶å®ç±»ä¼¼ï¼Œåªä¸è¿‡å°†ç±»å®ä¾‹åŒ–çš„è¿‡ç¨‹æ”¾åœ¨äº†é™æ€ä»£ç å—ä¸­ï¼Œä¹Ÿæ˜¯åœ¨ç±»è£…è½½çš„æ—¶å€™ï¼Œå°±æ‰§è¡Œé™æ€ä»£ç å—ä¸­çš„ä»£ç ï¼Œåˆå§‹åŒ–ç±»çš„å®ä¾‹ã€‚ä¼˜ç¼ºç‚¹å’Œä¸Šé¢æ˜¯ä¸€æ ·çš„ã€‚</p>
</li>
<li><p>ç»“è®ºï¼šè¿™ç§å•ä¾‹æ¨¡å¼å¯ç”¨ï¼Œä½†æ˜¯å¯èƒ½é€ æˆå†…å­˜æµªè´¹ã€‚</p>
</li>
</ol>
</blockquote>
<h2 id="å•ä¾‹ï¼ˆçº¿ç¨‹ä¸å®‰å…¨æ‡’æ±‰å¼ï¼‰"><a href="#å•ä¾‹ï¼ˆçº¿ç¨‹ä¸å®‰å…¨æ‡’æ±‰å¼ï¼‰" class="headerlink" title="å•ä¾‹ï¼ˆçº¿ç¨‹ä¸å®‰å…¨æ‡’æ±‰å¼ï¼‰"></a>å•ä¾‹ï¼ˆçº¿ç¨‹ä¸å®‰å…¨æ‡’æ±‰å¼ï¼‰</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ‡’æ±‰å¼ï¼šçº¿ç¨‹ä¸å®‰å…¨</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">SingleTon03</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">SingleTon03</span><span class="params">()</span> &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> SingleTon03 singleTon;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æä¾›ä¸€ä¸ªé™æ€çš„å…¬æœ‰æ–¹æ³•ï¼Œå½“ä½¿ç”¨åˆ°è¯¥æ–¹æ³•æ—¶ï¼Œæ‰å»åˆ›å»º instance,å³æ‡’æ±‰å¼</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> SingleTon03 <span class="title function_">getInstance</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (singleTon == <span class="literal">null</span>) &#123;</span><br><span class="line">            singleTon = <span class="keyword">new</span> <span class="title class_">SingleTon03</span>();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> singleTon;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>ä¼˜ç¼ºç‚¹è¯´æ˜ï¼š</strong></p>
<blockquote>
<ol>
<li><p>èµ·åˆ°äº† Lazy Loading çš„æ•ˆæœï¼Œä½†æ˜¯åªèƒ½åœ¨å•çº¿ç¨‹ä¸‹ä½¿ç”¨ã€‚</p>
</li>
<li><p>å¦‚æœåœ¨å¤šçº¿ç¨‹ä¸‹ï¼Œä¸€ä¸ªçº¿ç¨‹è¿›å…¥äº† if (singleton &#x3D;&#x3D; null) åˆ¤æ–­è¯­å¥å—ï¼Œè¿˜æœªæ¥å¾—åŠå¾€ä¸‹æ‰§è¡Œï¼Œå¦ä¸€ä¸ªçº¿ç¨‹ä¹Ÿé€šè¿‡äº†è¿™ä¸ªåˆ¤æ–­è¯­å¥ï¼Œè¿™æ—¶ä¾¿ä¼šäº§ç”Ÿå¤šä¸ªå®ä¾‹ã€‚æ‰€ä»¥åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹ä¸å¯ä½¿ç”¨è¿™ç§æ–¹å¼ã€‚</p>
</li>
<li><p>ç»“è®ºï¼šåœ¨å®é™…å¼€å‘ä¸­ï¼Œä¸è¦ä½¿ç”¨è¿™ç§æ–¹å¼ã€‚</p>
</li>
</ol>
</blockquote>
<h2 id="å•ä¾‹ï¼ˆçº¿ç¨‹å®‰å…¨æ‡’æ±‰å¼ï¼‰"><a href="#å•ä¾‹ï¼ˆçº¿ç¨‹å®‰å…¨æ‡’æ±‰å¼ï¼‰" class="headerlink" title="å•ä¾‹ï¼ˆçº¿ç¨‹å®‰å…¨æ‡’æ±‰å¼ï¼‰"></a>å•ä¾‹ï¼ˆçº¿ç¨‹å®‰å…¨æ‡’æ±‰å¼ï¼‰</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ‡’æ±‰å¼ï¼šåŒæ­¥æ–¹æ³•</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">SingleTon04</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">SingleTon04</span><span class="params">()</span> &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> SingleTon04 singleTon;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æä¾›ä¸€ä¸ªé™æ€çš„å…¬æœ‰æ–¹æ³•ï¼ŒåŠ å…¥åŒæ­¥å¤„ç†çš„ä»£ç ï¼Œè§£å†³çº¿ç¨‹å®‰å…¨é—®é¢˜,å³æ‡’æ±‰å¼</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">synchronized</span> SingleTon04 <span class="title function_">getInstance</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (singleTon == <span class="literal">null</span>) &#123;</span><br><span class="line">            singleTon = <span class="keyword">new</span> <span class="title class_">SingleTon04</span>();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> singleTon;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä¼˜ç¼ºç‚¹ï¼š</p>
<blockquote>
<ol>
<li><p>è§£å†³äº†çº¿ç¨‹ä¸å®‰å…¨é—®é¢˜ã€‚</p>
</li>
<li><p>æ•ˆç‡ä½ï¼Œæ¯ä¸ªçº¿ç¨‹åœ¨æƒ³è·å¾—ç±»çš„å®ä¾‹æ—¶å€™ï¼Œæ‰§è¡ŒgetInstance()æ–¹æ³•éƒ½è¦è¿›è¡Œ åŒæ­¥ã€‚è€Œå…¶å®è¿™ä¸ªæ–¹æ³•åªæ‰§è¡Œä¸€æ¬¡å®ä¾‹åŒ–ä»£ç å°±å¤Ÿäº†ï¼Œåé¢çš„æƒ³è·å¾—è¯¥ç±»å®ä¾‹ï¼Œç›´æ¥returnå³å¯ã€‚</p>
</li>
<li><p>ç»“è®ºï¼šåœ¨å®é™…å¼€å‘ä¸­ï¼Œä¸æ¨èä½¿ç”¨è¿™ç§æ–¹å¼ã€‚</p>
</li>
</ol>
</blockquote>
<h2 id="å•ä¾‹ï¼ˆåŒæ­¥ä»£ç å—æ‡’æ±‰å¼ï¼‰"><a href="#å•ä¾‹ï¼ˆåŒæ­¥ä»£ç å—æ‡’æ±‰å¼ï¼‰" class="headerlink" title="å•ä¾‹ï¼ˆåŒæ­¥ä»£ç å—æ‡’æ±‰å¼ï¼‰"></a>å•ä¾‹ï¼ˆåŒæ­¥ä»£ç å—æ‡’æ±‰å¼ï¼‰</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ‡’æ±‰å¼ï¼šåŒæ­¥ä»£ç å—</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">SingleTon05</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">SingleTon05</span><span class="params">()</span> &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> SingleTon05 singleTon;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> SingleTon05 <span class="title function_">getInstance</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">if</span>(singleTon==<span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">synchronized</span>(SingleTon05.class) &#123;</span><br><span class="line">                singleTon = <span class="keyword">new</span> <span class="title class_">SingleTon05</span>();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> singleTon;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä¼˜ç¼ºç‚¹ï¼š</p>
<blockquote>
<ul>
<li>è¿™ç§æ–¹å¼ï¼Œæœ¬æ„æ˜¯æƒ³å¯¹ç¬¬å››ç§å®ç°æ–¹å¼çš„æ”¹è¿›ï¼Œå› ä¸ºå‰é¢åŒæ­¥æ–¹æ³•æ•ˆç‡å¤ªä½ï¼Œ æ”¹ä¸ºåŒæ­¥äº§ç”Ÿå®ä¾‹åŒ–çš„çš„ä»£ç å—ã€‚</li>
<li>ä½†æ˜¯è¿™ç§åŒæ­¥å¹¶ä¸èƒ½èµ·åˆ°çº¿ç¨‹åŒæ­¥çš„ä½œç”¨ã€‚è·Ÿç¬¬3ç§å®ç°æ–¹å¼é‡åˆ°çš„æƒ…å½¢ä¸€ è‡´ï¼Œå‡å¦‚ä¸€ä¸ªçº¿ç¨‹è¿›å…¥äº†if (singleton &#x3D;&#x3D; null)åˆ¤æ–­è¯­å¥å—ï¼Œè¿˜æœªæ¥å¾—åŠå¾€ä¸‹æ‰§è¡Œï¼Œ å¦ä¸€ä¸ªçº¿ç¨‹ä¹Ÿé€šè¿‡äº†è¿™ä¸ªåˆ¤æ–­è¯­å¥ï¼Œè¿™æ—¶ä¾¿ä¼šäº§ç”Ÿå¤šä¸ªå®ä¾‹ã€‚</li>
<li>ç»“è®ºï¼šåœ¨å®é™…å¼€å‘ä¸­ï¼Œä¸èƒ½ä½¿ç”¨è¿™ç§æ–¹å¼ã€‚</li>
</ul>
</blockquote>
<h2 id="å•ä¾‹ï¼ˆDoubleCheckï¼‰"><a href="#å•ä¾‹ï¼ˆDoubleCheckï¼‰" class="headerlink" title="å•ä¾‹ï¼ˆDoubleCheckï¼‰"></a>å•ä¾‹ï¼ˆDoubleCheckï¼‰</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * åŒé‡æ£€æŸ¥</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">SingleTon06</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">SingleTon06</span><span class="params">()</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> SingleTon06 singleTon;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> SingleTon06 <span class="title function_">getInstance</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (singleTon == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">synchronized</span> (SingleTon06.class) &#123;</span><br><span class="line">                <span class="keyword">if</span> (singleTon == <span class="literal">null</span>) &#123;</span><br><span class="line">                    singleTon = <span class="keyword">new</span> <span class="title class_">SingleTon06</span>();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> singleTon;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä¼˜ç¼ºç‚¹ï¼š</p>
<blockquote>
<ul>
<li>Double-Checkæ¦‚å¿µæ˜¯å¤šçº¿ç¨‹å¼€å‘ä¸­å¸¸ä½¿ç”¨åˆ°çš„ï¼Œå¦‚ä»£ç ä¸­æ‰€ç¤ºï¼Œæˆ‘ä»¬è¿›è¡Œäº†ä¸¤ æ¬¡if (singleton &#x3D;&#x3D; null)æ£€æŸ¥ï¼Œè¿™æ ·å°±å¯ä»¥ä¿è¯çº¿ç¨‹å®‰å…¨äº†ã€‚</li>
<li>è¿™æ ·ï¼Œå®ä¾‹åŒ–ä»£ç åªç”¨æ‰§è¡Œä¸€æ¬¡ï¼Œåé¢å†æ¬¡è®¿é—®æ—¶ï¼Œåˆ¤æ–­if (singleton &#x3D;&#x3D; null)ï¼Œ ç›´æ¥returnå®ä¾‹åŒ–å¯¹è±¡ï¼Œä¹Ÿé¿å…çš„åå¤è¿›è¡Œæ–¹æ³•åŒæ­¥ã€‚</li>
<li>çº¿ç¨‹å®‰å…¨ï¼›å»¶è¿ŸåŠ è½½ï¼›æ•ˆç‡è¾ƒé«˜ã€‚</li>
<li>ç»“è®ºï¼šåœ¨å®é™…å¼€å‘ä¸­ï¼Œæ¨èä½¿ç”¨è¿™ç§å•ä¾‹è®¾è®¡æ¨¡å¼ã€‚</li>
</ul>
</blockquote>
<h2 id="å•ä¾‹ï¼ˆé™æ€å†…éƒ¨ç±»ï¼‰"><a href="#å•ä¾‹ï¼ˆé™æ€å†…éƒ¨ç±»ï¼‰" class="headerlink" title="å•ä¾‹ï¼ˆé™æ€å†…éƒ¨ç±»ï¼‰"></a>å•ä¾‹ï¼ˆé™æ€å†…éƒ¨ç±»ï¼‰</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * é™æ€å†…éƒ¨ç±»</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">SingleTon07</span> &#123;</span><br><span class="line">    SingleTon07() &#123;&#125;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">SingletonInstance</span> &#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">SingleTon07</span> <span class="variable">INSTANCE</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SingleTon07</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * é™æ€å†…éƒ¨ç±»æ–¹å¼åœ¨Singletonç±»è¢«è£…è½½æ—¶å¹¶ä¸ä¼šç«‹å³å®ä¾‹åŒ–ï¼Œè€Œæ˜¯åœ¨éœ€è¦å®ä¾‹åŒ–æ—¶ï¼Œ</span></span><br><span class="line"><span class="comment">     * è°ƒç”¨getInstanceæ–¹æ³•ï¼Œæ‰ä¼šè£…è½½SingletonInstanceç±»ï¼Œä»è€Œå®ŒæˆSingletonçš„å®ä¾‹åŒ–</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">synchronized</span> SingleTon07 <span class="title function_">getInstance</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> SingletonInstance.INSTANCE;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä¼˜ç¼ºç‚¹ï¼š</p>
<blockquote>
<ol>
<li><p>è¿™ç§æ–¹å¼é‡‡ç”¨äº†ç±»è£…è½½çš„æœºåˆ¶æ¥ä¿è¯åˆå§‹åŒ–å®ä¾‹æ—¶åªæœ‰ä¸€ä¸ªçº¿ç¨‹ã€‚</p>
</li>
<li><p>é™æ€å†…éƒ¨ç±»æ–¹å¼åœ¨ Singleton ç±»è¢«è£…è½½æ—¶å¹¶ä¸ä¼šç«‹å³å®ä¾‹åŒ–ï¼Œè€Œæ˜¯åœ¨éœ€è¦å®ä¾‹åŒ–æ—¶ï¼Œè°ƒç”¨ getInstance æ–¹æ³•ï¼Œæ‰ä¼šè£…è½½ SingletonInstance ç±»ï¼Œä»è€Œå®Œæˆ Singleton çš„å®ä¾‹åŒ–ã€‚</p>
</li>
<li><p>ç±»çš„é™æ€å±æ€§åªä¼šåœ¨ç¬¬ä¸€æ¬¡åŠ è½½ç±»çš„æ—¶å€™åˆå§‹åŒ–ï¼Œæ‰€ä»¥åœ¨è¿™é‡Œï¼ŒJVMå¸®åŠ©æˆ‘ä»¬ä¿è¯äº†çº¿ç¨‹çš„å®‰å…¨æ€§ï¼Œåœ¨ç±»è¿›è¡Œåˆå§‹åŒ–æ—¶ï¼Œåˆ«çš„çº¿ç¨‹æ˜¯æ— æ³•è¿›å…¥çš„ã€‚</p>
</li>
<li><p>ä¼˜ç‚¹ï¼šé¿å…äº†çº¿ç¨‹ä¸å®‰å…¨ï¼Œåˆ©ç”¨é™æ€å†…éƒ¨ç±»ç‰¹ç‚¹å®ç°å»¶è¿ŸåŠ è½½ï¼Œæ•ˆç‡é«˜ã€‚</p>
</li>
<li><p>ç»“è®ºï¼šæ¨èä½¿ç”¨ã€‚</p>
</li>
</ol>
</blockquote>
<h2 id="å•ä¾‹ï¼ˆæšä¸¾æ–¹å¼ï¼‰"><a href="#å•ä¾‹ï¼ˆæšä¸¾æ–¹å¼ï¼‰" class="headerlink" title="å•ä¾‹ï¼ˆæšä¸¾æ–¹å¼ï¼‰"></a>å•ä¾‹ï¼ˆæšä¸¾æ–¹å¼ï¼‰</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">enum</span> <span class="title class_">SingleTon</span>&#123;</span><br><span class="line">    INSTANCE;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">m1</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;hello world&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>ä¼˜ç¼ºç‚¹:</strong></p>
<blockquote>
<ol>
<li><p>è¿™å€ŸåŠ©JDK1.5ä¸­æ·»åŠ çš„æšä¸¾æ¥å®ç°å•ä¾‹æ¨¡å¼ã€‚ä¸ä»…èƒ½é¿å…å¤šçº¿ç¨‹åŒæ­¥é—®é¢˜ï¼Œè€Œä¸”è¿˜èƒ½é˜²æ­¢ååºåˆ—åŒ–é‡æ–°åˆ›å»ºæ–°çš„å¯¹è±¡ã€‚</p>
</li>
<li><p>è¿™ç§æ–¹å¼æ˜¯Effective Javaä½œè€…Josh Bloch æå€¡çš„æ–¹å¼ã€‚</p>
</li>
<li><p>ç»“è®ºï¼šæ¨èä½¿ç”¨ã€‚</p>
</li>
</ol>
</blockquote>
<h2 id="JDK-æºç "><a href="#JDK-æºç " class="headerlink" title="JDK æºç "></a>JDK æºç </h2><p>java.lang.Runtime å°±æ˜¯ç»å…¸çš„å•ä¾‹æ¨¡å¼ï¼ˆé¥¿æ±‰å¼ï¼‰ </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Runtime</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">Runtime</span> <span class="variable">currentRuntime</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Runtime</span>();</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Runtime <span class="title function_">getRuntime</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> currentRuntime;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">Runtime</span><span class="params">()</span> &#123;&#125;</span><br></pre></td></tr></table></figure>

<h2 id="æ³¨æ„äº‹é¡¹-3"><a href="#æ³¨æ„äº‹é¡¹-3" class="headerlink" title="æ³¨æ„äº‹é¡¹"></a>æ³¨æ„äº‹é¡¹</h2><blockquote>
<ol>
<li><p>å•ä¾‹æ¨¡å¼ä¿è¯äº†ç³»ç»Ÿå†…å­˜ä¸­è¯¥ç±»åªå­˜åœ¨ä¸€ä¸ªå¯¹è±¡ï¼ŒèŠ‚çœäº†ç³»ç»Ÿèµ„æºï¼Œå¯¹äºä¸€äº›éœ€è¦é¢‘ç¹åˆ›å»ºé”€æ¯çš„å¯¹è±¡ï¼Œä½¿ç”¨å•ä¾‹æ¨¡å¼å¯ä»¥æé«˜ç³»ç»Ÿæ€§èƒ½ã€‚</p>
</li>
<li><p>å½“æƒ³å®ä¾‹åŒ–ä¸€ä¸ªå•ä¾‹ç±»çš„æ—¶å€™ï¼Œå¿…é¡»è¦è®°ä½ä½¿ç”¨ç›¸åº”çš„è·å–å¯¹è±¡çš„æ–¹æ³•ï¼Œè€Œä¸æ˜¯ä½¿ç”¨newã€‚</p>
</li>
<li><p>å•ä¾‹æ¨¡å¼ä½¿ç”¨çš„åœºæ™¯ï¼šéœ€è¦é¢‘ç¹çš„è¿›è¡Œåˆ›å»ºå’Œé”€æ¯çš„å¯¹è±¡ã€åˆ›å»ºå¯¹è±¡æ—¶è€—æ—¶è¿‡å¤šæˆ–è€—è´¹èµ„æºè¿‡å¤šï¼ˆå³ï¼šé‡é‡çº§å¯¹è±¡ï¼‰ï¼Œä½†åˆç»å¸¸ç”¨åˆ°çš„å¯¹è±¡ã€å·¥å…·ç±»å¯¹è±¡ã€é¢‘ç¹è®¿é—®æ•°æ®åº“æˆ–æ–‡ä»¶çš„å¯¹è±¡ï¼ˆæ¯”å¦‚æ•°æ®æºã€sessionå·¥å‚ç­‰ï¼‰ã€‚</p>
</li>
</ol>
</blockquote>
<h1 id="å·¥å‚æ¨¡å¼"><a href="#å·¥å‚æ¨¡å¼" class="headerlink" title="å·¥å‚æ¨¡å¼"></a>å·¥å‚æ¨¡å¼</h1><h2 id="ç®€å•å·¥å‚æ¨¡å¼"><a href="#ç®€å•å·¥å‚æ¨¡å¼" class="headerlink" title="ç®€å•å·¥å‚æ¨¡å¼"></a>ç®€å•å·¥å‚æ¨¡å¼</h2><h2 id="å·¥å‚æ–¹æ³•æ¨¡å¼"><a href="#å·¥å‚æ–¹æ³•æ¨¡å¼" class="headerlink" title="å·¥å‚æ–¹æ³•æ¨¡å¼"></a>å·¥å‚æ–¹æ³•æ¨¡å¼</h2><h2 id="æŠ½è±¡å·¥å‚æ¨¡å¼"><a href="#æŠ½è±¡å·¥å‚æ¨¡å¼" class="headerlink" title="æŠ½è±¡å·¥å‚æ¨¡å¼"></a>æŠ½è±¡å·¥å‚æ¨¡å¼</h2><h1 id="åŸå‹æ¨¡å¼"><a href="#åŸå‹æ¨¡å¼" class="headerlink" title="åŸå‹æ¨¡å¼"></a>åŸå‹æ¨¡å¼</h1><h1 id="å»ºé€ è€…æ¨¡å¼"><a href="#å»ºé€ è€…æ¨¡å¼" class="headerlink" title="å»ºé€ è€…æ¨¡å¼"></a>å»ºé€ è€…æ¨¡å¼</h1><h1 id="é€‚é…å™¨æ¨¡å¼"><a href="#é€‚é…å™¨æ¨¡å¼" class="headerlink" title="é€‚é…å™¨æ¨¡å¼"></a>é€‚é…å™¨æ¨¡å¼</h1><h1 id="æ¡¥æ¥æ¨¡å¼"><a href="#æ¡¥æ¥æ¨¡å¼" class="headerlink" title="æ¡¥æ¥æ¨¡å¼"></a>æ¡¥æ¥æ¨¡å¼</h1><h1 id="è£…é¥°è€…æ¨¡å¼"><a href="#è£…é¥°è€…æ¨¡å¼" class="headerlink" title="è£…é¥°è€…æ¨¡å¼"></a>è£…é¥°è€…æ¨¡å¼</h1><h1 id="ç»„åˆæ¨¡å¼"><a href="#ç»„åˆæ¨¡å¼" class="headerlink" title="ç»„åˆæ¨¡å¼"></a>ç»„åˆæ¨¡å¼</h1><h1 id="å¤–è§‚æ¨¡å¼"><a href="#å¤–è§‚æ¨¡å¼" class="headerlink" title="å¤–è§‚æ¨¡å¼"></a>å¤–è§‚æ¨¡å¼</h1><h1 id="äº«å…ƒæ¨¡å¼"><a href="#äº«å…ƒæ¨¡å¼" class="headerlink" title="äº«å…ƒæ¨¡å¼"></a>äº«å…ƒæ¨¡å¼</h1><h1 id="ä»£ç†æ¨¡å¼"><a href="#ä»£ç†æ¨¡å¼" class="headerlink" title="ä»£ç†æ¨¡å¼"></a>ä»£ç†æ¨¡å¼</h1><h1 id="æ¨¡æ¿æ¨¡å¼"><a href="#æ¨¡æ¿æ¨¡å¼" class="headerlink" title="æ¨¡æ¿æ¨¡å¼"></a>æ¨¡æ¿æ¨¡å¼</h1><h1 id="å‘½ä»¤æ¨¡å¼"><a href="#å‘½ä»¤æ¨¡å¼" class="headerlink" title="å‘½ä»¤æ¨¡å¼"></a>å‘½ä»¤æ¨¡å¼</h1><h1 id="è®¿é—®è€…æ¨¡å¼"><a href="#è®¿é—®è€…æ¨¡å¼" class="headerlink" title="è®¿é—®è€…æ¨¡å¼"></a>è®¿é—®è€…æ¨¡å¼</h1><h1 id="è¿­ä»£å™¨æ¨¡å¼"><a href="#è¿­ä»£å™¨æ¨¡å¼" class="headerlink" title="è¿­ä»£å™¨æ¨¡å¼"></a>è¿­ä»£å™¨æ¨¡å¼</h1><h1 id="è§‚å¯Ÿè€…æ¨¡å¼"><a href="#è§‚å¯Ÿè€…æ¨¡å¼" class="headerlink" title="è§‚å¯Ÿè€…æ¨¡å¼"></a>è§‚å¯Ÿè€…æ¨¡å¼</h1><h1 id="ä¸­ä»‹è€…æ¨¡å¼"><a href="#ä¸­ä»‹è€…æ¨¡å¼" class="headerlink" title="ä¸­ä»‹è€…æ¨¡å¼"></a>ä¸­ä»‹è€…æ¨¡å¼</h1><h1 id="å¤‡å¿˜å½•æ¨¡å¼"><a href="#å¤‡å¿˜å½•æ¨¡å¼" class="headerlink" title="å¤‡å¿˜å½•æ¨¡å¼"></a>å¤‡å¿˜å½•æ¨¡å¼</h1><h1 id="è§£é‡Šå™¨æ¨¡å¼"><a href="#è§£é‡Šå™¨æ¨¡å¼" class="headerlink" title="è§£é‡Šå™¨æ¨¡å¼"></a>è§£é‡Šå™¨æ¨¡å¼</h1><h1 id="çŠ¶æ€æ¨¡å¼"><a href="#çŠ¶æ€æ¨¡å¼" class="headerlink" title="çŠ¶æ€æ¨¡å¼"></a>çŠ¶æ€æ¨¡å¼</h1><h1 id="ç­–ç•¥æ¨¡å¼"><a href="#ç­–ç•¥æ¨¡å¼" class="headerlink" title="ç­–ç•¥æ¨¡å¼"></a>ç­–ç•¥æ¨¡å¼</h1><h1 id="èŒè´£é“¾æ¨¡å¼"><a href="#èŒè´£é“¾æ¨¡å¼" class="headerlink" title="èŒè´£é“¾æ¨¡å¼"></a>èŒè´£é“¾æ¨¡å¼</h1>]]></content>
  </entry>
  <entry>
    <title>EffectiveJava</title>
    <url>/2023/02/28/Effective%20Java/</url>
    <content><![CDATA[<h1 id><a href="#" class="headerlink" title></a></h1><h1 id="Effective-Java"><a href="#Effective-Java" class="headerlink" title="Effective Java"></a>Effective Java</h1><h1 id="ç¬¬ä¸€ç« -åˆ›å»ºå’Œé”€æ¯å¯¹è±¡"><a href="#ç¬¬ä¸€ç« -åˆ›å»ºå’Œé”€æ¯å¯¹è±¡" class="headerlink" title="ç¬¬ä¸€ç«  åˆ›å»ºå’Œé”€æ¯å¯¹è±¡"></a>ç¬¬ä¸€ç«  åˆ›å»ºå’Œé”€æ¯å¯¹è±¡</h1><h2 id="ç”¨é™æ€å·¥å‚æ–¹æ³•ä»£æ›¿æ„é€ å™¨"><a href="#ç”¨é™æ€å·¥å‚æ–¹æ³•ä»£æ›¿æ„é€ å™¨" class="headerlink" title="ç”¨é™æ€å·¥å‚æ–¹æ³•ä»£æ›¿æ„é€ å™¨"></a>ç”¨é™æ€å·¥å‚æ–¹æ³•ä»£æ›¿æ„é€ å™¨</h2><h2 id="é‡åˆ°å¤šä¸ªæ„é€ å‚æ•°æ—¶è€ƒè™‘ä½¿ç”¨æ„å»ºå™¨"><a href="#é‡åˆ°å¤šä¸ªæ„é€ å‚æ•°æ—¶è€ƒè™‘ä½¿ç”¨æ„å»ºå™¨" class="headerlink" title="é‡åˆ°å¤šä¸ªæ„é€ å‚æ•°æ—¶è€ƒè™‘ä½¿ç”¨æ„å»ºå™¨"></a>é‡åˆ°å¤šä¸ªæ„é€ å‚æ•°æ—¶è€ƒè™‘ä½¿ç”¨æ„å»ºå™¨</h2><h2 id="ç”¨ç§æœ‰æ„é€ å™¨æˆ–æšä¸¾ç±»å‹å¼ºåŒ–Singletonå±æ€§"><a href="#ç”¨ç§æœ‰æ„é€ å™¨æˆ–æšä¸¾ç±»å‹å¼ºåŒ–Singletonå±æ€§" class="headerlink" title="ç”¨ç§æœ‰æ„é€ å™¨æˆ–æšä¸¾ç±»å‹å¼ºåŒ–Singletonå±æ€§"></a>ç”¨ç§æœ‰æ„é€ å™¨æˆ–æšä¸¾ç±»å‹å¼ºåŒ–Singletonå±æ€§</h2><h2 id="é€šè¿‡ç§æœ‰æ„é€ å™¨å¼ºåŒ–ä¸å¯å®ä¾‹åŒ–çš„èƒ½åŠ›"><a href="#é€šè¿‡ç§æœ‰æ„é€ å™¨å¼ºåŒ–ä¸å¯å®ä¾‹åŒ–çš„èƒ½åŠ›" class="headerlink" title="é€šè¿‡ç§æœ‰æ„é€ å™¨å¼ºåŒ–ä¸å¯å®ä¾‹åŒ–çš„èƒ½åŠ›"></a>é€šè¿‡ç§æœ‰æ„é€ å™¨å¼ºåŒ–ä¸å¯å®ä¾‹åŒ–çš„èƒ½åŠ›</h2><h2 id="ä¼˜å…ˆè€ƒè™‘ä¾èµ–æ³¨å…¥æ¥å¼•ç”¨èµ„æº"><a href="#ä¼˜å…ˆè€ƒè™‘ä¾èµ–æ³¨å…¥æ¥å¼•ç”¨èµ„æº" class="headerlink" title="ä¼˜å…ˆè€ƒè™‘ä¾èµ–æ³¨å…¥æ¥å¼•ç”¨èµ„æº"></a>ä¼˜å…ˆè€ƒè™‘ä¾èµ–æ³¨å…¥æ¥å¼•ç”¨èµ„æº</h2><h2 id="é¿å…åˆ›å»ºä¸å¿…è¦çš„å¯¹è±¡"><a href="#é¿å…åˆ›å»ºä¸å¿…è¦çš„å¯¹è±¡" class="headerlink" title="é¿å…åˆ›å»ºä¸å¿…è¦çš„å¯¹è±¡"></a>é¿å…åˆ›å»ºä¸å¿…è¦çš„å¯¹è±¡</h2><p>å°½å¯èƒ½çš„é‡ç”¨å•ä¸ªå¯¹è±¡ï¼Œè€Œä¸æ˜¯æ¯æ¬¡éœ€è¦çš„æ—¶å€™åˆ›å»ºä¸€ä¸ªç›¸åŒåŠŸèƒ½çš„æ–°å¯¹è±¡ï¼Œå¦‚æœå¯¹è±¡æ˜¯ä¸å¯å˜çš„ï¼ˆimmutableï¼‰ï¼Œé‚£ä¹ˆå®ƒå°±å§‹ç»ˆå¯ä»¥è¢«é‡ç”¨ã€‚å¦‚æœåœ¨å¾ªç¯è¯­å¥æˆ–è€…é¢‘ç¹è°ƒç”¨çš„æ–¹æ³•ä¸­åˆ›å»ºè¯¥å¯¹è±¡ï¼Œå¯¹æ€§èƒ½æˆ–å†…å­˜æœ‰å¾ˆå¤§çš„å½±å“ã€‚</p>
<p>ç¤ºä¾‹ä¸€ï¼ˆé”™è¯¯å†™æ³•ï¼‰ï¼š</p>
<p>String s &#x3D; new String(â€œbikiniâ€);</p>
<p>è¯´æ˜ï¼šè¯¥è¯­å¥æ¯æ¬¡è¢«æ‰§è¡Œçš„æ—¶å€™éƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„Stringå®ä¾‹ï¼Œæ²¡æœ‰å¿…é¡»ä½¿ç”¨new String()æ„é€ å™¨ï¼Œå‚æ•°â€bikiniâ€æœ¬èº«å°±æ˜¯ä¸€ä¸ªStringå®ä¾‹ï¼Œå¯¹äºç›¸åŒçš„å­—ç¬¦ä¸²å¸¸é‡å®ä¾‹ï¼Œè¯¥å®ä¾‹å°±ä¼šè¢«é‡ç”¨ã€‚åŠŸèƒ½ç›¸åŒçš„æƒ…å†µä¸‹ï¼Œå¦‚æœåœ¨å¾ªç¯æˆ–é¢‘ç¹è°ƒç”¨çš„æ–¹æ³•ä¸­ï¼Œå°±ä¼šåˆ›å»ºå¤§é‡ä¸å¿…è¦çš„Stringå®ä¾‹ã€‚</p>
<p>æ³¨æ„äº‹é¡¹äºŒï¼š</p>
<p>â€‹	å¯¹äºåŒæ—¶æä¾›äº†é™æ€å·¥å‚æ–¹æ³•å’Œæ„é€ å™¨çš„ä¸å¯å˜ç±»ï¼Œé€šå¸¸ä¼˜å…ˆä½¿ç”¨é™æ€å·¥å‚æ–¹æ³•ï¼Œä»¥é¿å…åˆ›å»ºä¸å¿…è¦çš„å¯¹è±¡ã€‚</p>
<p>â€‹	æ„é€ å™¨æ¯æ¬¡è¢«è°ƒç”¨çš„æ—¶å€™éƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„å¯¹è±¡ï¼Œè€Œé™æ€å·¥å‚æ–¹æ³•ä¸ä¼šï¼Œé™¤äº†é‡ç”¨ä¸å¯å˜çš„å¯¹è±¡ä¹‹å¤–ï¼Œä¹Ÿå¯ä»¥é‡ç”¨é‚£äº›å·²çŸ¥ä¸ä¼šè¢«ä¿®æ”¹çš„å¯å˜å¯¹è±¡ã€‚</p>
<p>ç¤ºä¾‹ï¼šé™æ€å·¥å‚æ–¹æ³• Boolean.valueOf(String s) æ€»æ˜¯ä¼˜å…ˆäºæ„é€ å™¨ new Boolean(String);</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> Boolean <span class="title function_">valueOf</span><span class="params">(String s)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> parseBoolean(s) ? TRUE : FALSE;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="type">boolean</span> <span class="title function_">parseBoolean</span><span class="params">(String s)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> ((s != <span class="literal">null</span>) &amp;&amp; s.equalsIgnoreCase(<span class="string">&quot;true&quot;</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ³¨æ„äº‹é¡¹ä¸‰ï¼š</p>
<p>â€‹	å¯¹äºåˆ›å»ºæˆæœ¬é«˜çš„â€œæ˜‚è´µ&#x2F;é‡é‡çº§çš„å¯¹è±¡â€ï¼Œå»ºè®®ç¼“å­˜ä¸‹æ¥ä½¿ç”¨ï¼Œå¦‚ä¸‹é¢çš„æ­£åˆ™è¡¨è¾¾å¼ï¼ˆåˆ¤æ–­æ˜¯å¦ä¸ºç½—é©¬æ•°å­—ï¼‰ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// Performance can be grately improved!</span></span><br><span class="line"><span class="keyword">static</span> <span class="type">boolean</span> <span class="title function_">isRomanNumeral</span><span class="params">(String s)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> s.matches(<span class="string">&quot;^(?=.)M*(C[MD]|D?C&#123;0,3&#125;)&quot;</span>+<span class="string">&quot;(X[CL]|L?X&#123;0,3&#125;)(I[XV]|V?I&#123;0,3&#125;)$&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¯¹äº matches æ–¹æ³•ï¼ŒæŸ¥çœ‹ä¸€ä¸ªå­—ç¬¦ä¸²æ˜¯å¦ä¸æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…ï¼Œä½†ä¸é€‚åˆåœ¨æ³¨é‡æ€§èƒ½çš„åœºæ™¯ä½¿ç”¨ï¼Œå› ä¸ºå®ƒæ¯æ¬¡éƒ½ä¼šåˆ›å»ºä¸€ä¸ªPattern å®ä¾‹ï¼Œå´åªç”¨äº†ä¸€æ¬¡ï¼Œä¹‹åå°±ä¼šè¢«åƒåœ¾å›æ”¶ã€‚åˆ›å»º Pattern çš„æˆæœ¬å¾ˆé«˜ï¼Œä¸ºäº†æå‡æ€§èƒ½ï¼Œåº”è¯¥å°†æ­£åˆ™è¡¨è¾¾å¼ç¼–è¯‘ä¸ºä¸€ä¸ª Pattern å®ä¾‹ï¼Œç¼“å­˜èµ·æ¥ï¼Œæ¯æ¬¡è°ƒç”¨çš„ isRomanNumeral æ–¹æ³•çš„æ—¶å€™é‡ç”¨è¯¥å®ä¾‹ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// Reusing expensive object for improved performance</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RomanNumerals</span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Pattern</span> <span class="variable">ROMAN</span> <span class="operator">=</span> </span><br><span class="line">        Pattern.compile(<span class="string">&quot;^(?=.)M*(C[MD]|D?C&#123;0,3&#125;)&quot;</span>+<span class="string">&quot;(X[CL]|L?X&#123;0,3&#125;)(I[XV]|V?I&#123;0,3&#125;)$&quot;</span>);</span><br><span class="line">    <span class="keyword">static</span> <span class="type">boolean</span> <span class="title function_">isRomanNumeral</span><span class="params">(String s)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> ROMAN.matcher(s).matches();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ”¹è¿›åçš„ isRomanNumeral æ–¹æ³•å¦‚æœè¢«é¢‘ç¹è°ƒç”¨ï¼Œä¼šæœ‰æ˜æ˜¾çš„æ€§èƒ½ä¼˜åŠ¿ï¼Œæ­¤å¤–ï¼Œç»™æ­£åˆ™è¡¨è¾¾å¼èµ·ä¸€ä¸ªåå­—ï¼Œæ›´åŠ æœ‰å¯è¯»æ€§ã€‚</p>
<p>æ³¨æ„äº‹é¡¹ä¸‰ï¼š</p>
<p>æ³¨æ„äº‹é¡¹å››ï¼š</p>
<p>ä¼˜å…ˆä½¿ç”¨åŸºæœ¬ç±»å‹è€Œä¸æ˜¯è£…ç®±ç±»å‹ï¼Œè‡ªåŠ¨æ‹†è£…ç®±å¯èƒ½ä¹Ÿä¼šåˆ›å»ºå¤šä½™çš„å¯¹è±¡ï¼Œå¦‚åŒ…è£…ç±»é¢‘ç¹ä½œä¸ºè®¡ç®—å€¼å„¿å¤§é‡åˆ›å»ºå¯¹è±¡ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// è®¡ç®—æ‰€æœ‰æ­£æ•´æ•°å’Œ</span></span><br><span class="line"><span class="comment">// Hideously slow!</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="type">long</span> <span class="title function_">sum</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="type">Long</span> <span class="variable">sum</span> <span class="operator">=</span> <span class="number">0L</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>;i &lt;= Integer.MAX_VALUE;i++)&#123;</span><br><span class="line">		sum += i;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> sum;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä»¥ä¸Šä»£ç ä¼šåˆ›å»º 2 çš„ 31 æ¬¡æ–¹ä¸ª Long å®ä¾‹ï¼Œå¯¹æ€§èƒ½å½±å“å¾ˆå¤§ã€‚</p>
<p>æ³¨æ„äº‹é¡¹äº”ï¼š</p>
<h2 id="æ¶ˆé™¤è¿‡æœŸçš„å¯¹è±¡å¼•ç”¨"><a href="#æ¶ˆé™¤è¿‡æœŸçš„å¯¹è±¡å¼•ç”¨" class="headerlink" title="æ¶ˆé™¤è¿‡æœŸçš„å¯¹è±¡å¼•ç”¨"></a>æ¶ˆé™¤è¿‡æœŸçš„å¯¹è±¡å¼•ç”¨</h2><h2 id="é¿å…ä½¿ç”¨ç»ˆç»“æ–¹æ³•å’Œæ¸…é™¤æ–¹æ³•"><a href="#é¿å…ä½¿ç”¨ç»ˆç»“æ–¹æ³•å’Œæ¸…é™¤æ–¹æ³•" class="headerlink" title="é¿å…ä½¿ç”¨ç»ˆç»“æ–¹æ³•å’Œæ¸…é™¤æ–¹æ³•"></a>é¿å…ä½¿ç”¨ç»ˆç»“æ–¹æ³•å’Œæ¸…é™¤æ–¹æ³•</h2><h2 id="try-with-resources-ä¼˜å…ˆäº-try-finally"><a href="#try-with-resources-ä¼˜å…ˆäº-try-finally" class="headerlink" title="try-with-resources ä¼˜å…ˆäº try-finally"></a>try-with-resources ä¼˜å…ˆäº try-finally</h2><p>Javaç±»åº“ä¸­å¿…é¡»è°ƒç”¨ close æ–¹æ³•å…³é—­èµ„æºï¼Œå¦‚ InputStreamã€OutputStreamã€java.sql.Connectionéƒ½éœ€è¦å…³é—­èµ„æºï¼Œå¦åˆ™é€ æˆä¸¥é‡çš„æ€§èƒ½é—®é¢˜ï¼Œtry-finally èƒ½å¤Ÿç¡®ä¿èµ„æºè¢«æ­£ç¡®å…³é—­ï¼Œä½†ä¸å¤Ÿå¥½ï¼Œä¹Ÿå­˜åœ¨è®¸å¤šé—®é¢˜ã€‚</p>
<p>æ³¨æ„äº‹é¡¹ä¸€ï¼š</p>
<p>å¯¹äºå•ä¸ªèµ„æºï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// try-finally no logger the best way to close resources!</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> String <span class="title function_">firstLineOfFile</span><span class="params">(String path)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    <span class="type">BufferedReader</span> <span class="variable">br</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BufferedReader</span>(<span class="keyword">new</span> <span class="title class_">FileReader</span>(path));</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> br.readLine();</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        br.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¯¹äºå¤šä¸ªèµ„æºï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="type">int</span> <span class="variable">BUFFER_SIZE</span> <span class="operator">=</span> <span class="number">1024</span>;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">copy</span><span class="params">(String src, String dst)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">       <span class="type">FileInputStream</span> <span class="variable">fis</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileInputStream</span>(src);</span><br><span class="line">       <span class="keyword">try</span> &#123;</span><br><span class="line">           <span class="type">FileOutputStream</span> <span class="variable">fos</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(dst);</span><br><span class="line">           <span class="keyword">try</span> &#123;</span><br><span class="line">               <span class="type">byte</span>[] bytes = <span class="keyword">new</span> <span class="title class_">byte</span>[BUFFER_SIZE];</span><br><span class="line">               <span class="type">int</span> len;</span><br><span class="line">               <span class="keyword">while</span> ((len = fis.read(bytes)) &gt;= <span class="number">0</span>) &#123;</span><br><span class="line">                   fos.write(bytes, <span class="number">0</span>, len);</span><br><span class="line">               &#125;</span><br><span class="line">           &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">               fos.close();</span><br><span class="line">           &#125;</span><br><span class="line">       &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">           fis.close();</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<p>ä»¥ä¸Šä¸¤ç§æ–¹å¼ï¼Œå³ä¾¿ä½¿ç”¨ try-finally å…³é—­äº†èµ„æºï¼Œä½†ä¹Ÿå­˜åœ¨é—®é¢˜ï¼Œå› ä¸º try å’Œ finally ä¸­çš„ä»£ç éƒ½ä¼šæŠ›å‡ºå¼‚å¸¸ï¼Œä¾‹å¦‚æ–¹æ³• firstLineOfFile ï¼Œå¦‚æœåº•å±‚çš„ç‰©ç†è®¾å¤‡å¼‚å¸¸ï¼Œnameè°ƒç”¨ readLine å°±ä¼šæŠ›å‡ºå¼‚å¸¸ï¼ŒåŸºäºåŒæ ·çš„åŸå› ï¼Œè°ƒç”¨ close æ–¹æ³•ï¼Œä¹Ÿä¼šå‡ºç°å¼‚å¸¸ï¼Œæ­¤æ—¶ï¼Œç¬¬äºŒä¸ªå¼‚å¸¸å°±ä¼šæŠ¹é™¤ç¬¬ä¸€ä¸ªå¼‚å¸¸ï¼Œåœ¨å¼‚å¸¸çš„å †æ ˆä¸­æ˜¯æ²¡æœ‰ç¬¬ä¸€ä¸ªå¼‚å¸¸çš„è®°å½•ä¿¡æ¯çš„ï¼Œè¿™æ ·å°±ä¼šå¯¼è‡´å†ç°å®ä¸­è°ƒè¯•å˜å¾—å¾ˆå›°éš¾ï¼Œè™½ç„¶å¯ä»¥é€šè¿‡ç¼–å†™ä»£ç ç¦æ­¢ç¬¬äºŒä¸ªå¼‚å¸¸ï¼Œä¿ç•™ç¬¬ä¸€ä¸ªå¼‚å¸¸ï¼Œä½†è¿‡äºç¹çä¸å»ºè®®ä½¿ç”¨ã€‚</p>
<p>â€‹		Java7 å¼•å…¥ try-with-resources æ¥å…³é—­èµ„æºï¼Œå¦‚æœä¸€ä¸ªç±»å¿…é¡»æ˜¯è¢«å…³é—­çš„èµ„æºï¼Œé‚£ä¹ˆè¿™ä¸ªç±»åº”è¯¥å®ç° AutoCloseable æ¥å£ï¼Œå…¶ä¸­åŒ…å« close æ–¹æ³•ï¼ŒJavaç±»åº“å’Œç¬¬ä¸‰æ–¹ç±»åº“çš„è®¸å¤šç±»å’Œæ¥å£éƒ½å®ç°æˆ–æ‰©å±•äº† AutoCloseable æ¥å£ã€‚</p>
<p>ç¤ºä¾‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// try-with-resources the best way to close resources!</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> String <span class="title function_">firstLineOfFile</span><span class="params">(String path)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    <span class="keyword">try</span> (<span class="type">BufferedReader</span> <span class="variable">br</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BufferedReader</span>(<span class="keyword">new</span> <span class="title class_">FileReader</span>(path))) &#123;</span><br><span class="line">        <span class="keyword">return</span> br.readLine();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">copy2</span><span class="params">(String src, String dst)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    <span class="keyword">try</span> (<span class="type">FileInputStream</span> <span class="variable">fis</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileInputStream</span>(src);</span><br><span class="line">         <span class="type">FileOutputStream</span> <span class="variable">fos</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(dst);</span><br><span class="line">    ) &#123;</span><br><span class="line">        <span class="type">byte</span>[] bytes = <span class="keyword">new</span> <span class="title class_">byte</span>[BUFFER_SIZE];</span><br><span class="line">        <span class="type">int</span> len;</span><br><span class="line">        <span class="keyword">while</span> ((len = fis.read(bytes)) &gt;= <span class="number">0</span>) &#123;</span><br><span class="line">            fos.write(bytes, <span class="number">0</span>, len);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>â€‹		ä½¿ç”¨ try-with-resources ä¸ä»…ä½¿ä»£ç å˜å¾—ç®€æ´æ˜“æ‡‚ï¼Œæ›´å®¹æ˜“è¯Šæ–­é”™è¯¯ï¼Œä»¥ firstLineOfFile ä¸ºä¾‹ï¼Œå¦‚æœè°ƒç”¨ readLine å’Œï¼ˆä¸å¯è§çš„ï¼‰close æ–¹æ³•éƒ½æŠ›å‡ºå¼‚å¸¸ï¼Œåä¸€ä¸ªå¼‚å¸¸å°±ä¼šè¢«ç¦æ­¢ï¼Œä»¥ä¿ç•™ç¬¬ä¸€ä¸ªå¼‚å¸¸ï¼Œè¢«ç¦æ­¢çš„å¼‚å¸¸ä¸æ˜¯è¢«æŠ›å¼ƒäº†ï¼Œè€Œæ˜¯ä¼šè¢«æ‰“å°åˆ°å †æ ˆä¸­ï¼Œå¹¶æ ‡æ³¨ä¸ºè¢«ç¦æ­¢çš„å¼‚å¸¸ï¼Œé€šè¿‡ç¼–ç¨‹ getSuppressed æ–¹æ³•å¯ä»¥è®¿é—®ï¼Œè¯¥æ–¹æ³•è¢«æ·»åŠ åˆ° Throwableä¸­äº†ã€‚</p>
<p>â€‹		åŒæ—¶ try-with-resources è¿˜å¯ä»¥ä½¿ç”¨ catch è¯­å¥ï¼Œè¿™æ ·æ—¢å¯ä»¥å¤„ç†å¼‚å¸¸ï¼Œåˆä¸ç”¨å†å¤–åµŒå¥—ä¸€å±‚ä»£ç ï¼Œå¦‚ä¸€ä¸‹ä»£ç ï¼Œæ— æ³•æ‰“å¼€æ–‡ä»¶æ—¶ï¼Œå°±ä¼šè¿”å›ä¸€ä¸ªé»˜è®¤å€¼ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// try-with-resources with catch</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> String <span class="title function_">firstLineOfFile</span><span class="params">(String path, String defaultValue)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    <span class="keyword">try</span> (<span class="type">BufferedReader</span> <span class="variable">br</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BufferedReader</span>(<span class="keyword">new</span> <span class="title class_">FileReader</span>(path))) &#123;</span><br><span class="line">        <span class="keyword">return</span> br.readLine();</span><br><span class="line">    &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">        <span class="keyword">return</span> defaultValue;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç»“è®ºï¼šå¤„ç†å¿…é¡»å…³é—­çš„èµ„æº&#x3D;&#x3D;æ—¶&#x3D;&#x3D;ï¼Œå§‹ç»ˆä¼˜å…ˆè€ƒè™‘ try-with-resources è€Œä¸æ˜¯ try-finally ï¼Œè¿™æ ·å¾—åˆ°çš„ä»£ç æ›´åŠ ç®€ä»‹æ¸…æ™°ï¼Œäº§ç”Ÿçš„å¼‚å¸¸æ›´æœ‰ä»·å€¼ã€‚</p>
<h1 id="ç¬¬äºŒç« -å¯¹äºæ‰€æœ‰å¯¹è±¡éƒ½é€šç”¨çš„æ–¹æ³•"><a href="#ç¬¬äºŒç« -å¯¹äºæ‰€æœ‰å¯¹è±¡éƒ½é€šç”¨çš„æ–¹æ³•" class="headerlink" title="ç¬¬äºŒç«  å¯¹äºæ‰€æœ‰å¯¹è±¡éƒ½é€šç”¨çš„æ–¹æ³•"></a>ç¬¬äºŒç«  å¯¹äºæ‰€æœ‰å¯¹è±¡éƒ½é€šç”¨çš„æ–¹æ³•</h1><h2 id="è¦†ç›–-equals-æ—¶è¯·éµå®ˆé€šç”¨çº¦å®š"><a href="#è¦†ç›–-equals-æ—¶è¯·éµå®ˆé€šç”¨çº¦å®š" class="headerlink" title="è¦†ç›– equals æ—¶è¯·éµå®ˆé€šç”¨çº¦å®š"></a>è¦†ç›– equals æ—¶è¯·éµå®ˆé€šç”¨çº¦å®š</h2><h2 id="è¦†ç›–-equals-æ—¶æ€»è¦è¦†ç›–-hashCode"><a href="#è¦†ç›–-equals-æ—¶æ€»è¦è¦†ç›–-hashCode" class="headerlink" title="è¦†ç›– equals æ—¶æ€»è¦è¦†ç›– hashCode"></a>è¦†ç›– equals æ—¶æ€»è¦è¦†ç›– hashCode</h2><h2 id="å§‹ç»ˆè¦†ç›–-toString"><a href="#å§‹ç»ˆè¦†ç›–-toString" class="headerlink" title="å§‹ç»ˆè¦†ç›– toString"></a>å§‹ç»ˆè¦†ç›– toString</h2><h2 id="è°¨æ…è¦†ç›–-clone"><a href="#è°¨æ…è¦†ç›–-clone" class="headerlink" title="è°¨æ…è¦†ç›– clone"></a>è°¨æ…è¦†ç›– clone</h2><h2 id="è€ƒè™‘å®ç°-Comparable-æ¥å£"><a href="#è€ƒè™‘å®ç°-Comparable-æ¥å£" class="headerlink" title="è€ƒè™‘å®ç° Comparable æ¥å£"></a>è€ƒè™‘å®ç° Comparable æ¥å£</h2><h1 id="ç¬¬ä¸‰ç« -ç±»å’Œæ¥å£"><a href="#ç¬¬ä¸‰ç« -ç±»å’Œæ¥å£" class="headerlink" title="ç¬¬ä¸‰ç«  ç±»å’Œæ¥å£"></a>ç¬¬ä¸‰ç«  ç±»å’Œæ¥å£</h1>]]></content>
  </entry>
  <entry>
    <title>Dubbo</title>
    <url>/2023/02/27/Dubbo/</url>
    <content><![CDATA[]]></content>
  </entry>
  <entry>
    <title>Elasticsearch</title>
    <url>/2023/02/27/Elasticsearch/</url>
    <content><![CDATA[]]></content>
  </entry>
  <entry>
    <title>Go</title>
    <url>/2023/02/27/Go/</url>
    <content><![CDATA[]]></content>
  </entry>
  <entry>
    <title>HelloWorld</title>
    <url>/2023/02/27/HelloWorld/</url>
    <content><![CDATA[<p>HelloWorld</p>
<p><img src="/2023/02/27/HelloWorld/%E5%86%85%E5%AD%98%E7%BB%93%E6%9E%84%E6%A6%82%E8%BF%B0%E8%AF%A6%E7%BB%86%E7%89%88.png" alt="æµ‹è¯•å›¾ç‰‡"></p>
]]></content>
  </entry>
  <entry>
    <title>Jvm</title>
    <url>/2023/02/23/JVM/</url>
    <content><![CDATA[<h1 id="ä¸Šç¯‡ï¼šJavaå†…å­˜ä¸åƒåœ¾å›æ”¶"><a href="#ä¸Šç¯‡ï¼šJavaå†…å­˜ä¸åƒåœ¾å›æ”¶" class="headerlink" title="ä¸Šç¯‡ï¼šJavaå†…å­˜ä¸åƒåœ¾å›æ”¶"></a>ä¸Šç¯‡ï¼šJavaå†…å­˜ä¸åƒåœ¾å›æ”¶</h1><h2 id="JVMä¸Javaä½“ç³»ç»“æ„"><a href="#JVMä¸Javaä½“ç³»ç»“æ„" class="headerlink" title="JVMä¸Javaä½“ç³»ç»“æ„"></a>JVMä¸Javaä½“ç³»ç»“æ„</h2><h3 id="Javaè™šæ‹Ÿæœºæ¦‚è¿°"><a href="#Javaè™šæ‹Ÿæœºæ¦‚è¿°" class="headerlink" title="Javaè™šæ‹Ÿæœºæ¦‚è¿°"></a>Javaè™šæ‹Ÿæœºæ¦‚è¿°</h3><h4 id="ä¸ºä»€ä¹ˆè¦å­¦-JVMï¼Ÿ"><a href="#ä¸ºä»€ä¹ˆè¦å­¦-JVMï¼Ÿ" class="headerlink" title="ä¸ºä»€ä¹ˆè¦å­¦ JVMï¼Ÿ"></a>ä¸ºä»€ä¹ˆè¦å­¦ JVMï¼Ÿ</h4><ol>
<li><p>å¦‚ä½•è®©ç³»ç»Ÿæ›´å¿«ï¼Œ å¦‚ä½•é¿å…ç³»ç»Ÿå‡ºç°æ€§èƒ½ç“¶é¢ˆã€‚å•çº¯çš„ä¾é ç‰©ç†æœºä¸è¶³ä»¥è§£å†³é—®é¢˜ï¼Œåˆ†æç³»ç»Ÿæ€§èƒ½ã€è°ƒä¼˜ç³»ç»Ÿç“¶é¢ˆç¦»ä¸äº†å¯¹ JVM ä¸­å†…å­˜ã€åƒåœ¾å›æ”¶ã€å­—èŠ‚ç æŒ‡ä»¤ã€æ€§èƒ½ç›‘æ§å·¥å…·ã€è°ƒä¼˜å‚æ•°çš„ç†Ÿç»ƒæŒæ¡ã€‚</p>
</li>
<li><p>JVM æ˜¯ Java ç”Ÿæ€çš„æ ¸å¿ƒä»·å€¼çš„ä½“ç°ï¼Œåƒåœ¾å›æ”¶ç®—æ³•ã€JITã€åº•å±‚åŸç†å€¼å¾—æ¯ä¸ªç¨‹åºå‘˜å»æ¢ç´¢ã€‚åŒæ—¶ï¼ŒJVM ä½œä¸ºè·¨è¯­è¨€çš„å¹³å°ï¼Œå¯¹äºæ·±å…¥ç†è§£ Scalaã€Kotlinã€JavaScriptã€Jythonã€Groovy ä¹Ÿå¾ˆæœ‰å¸®åŠ©ã€‚</p>
</li>
<li><p>Javaé»˜è®¤ä½¿ç”¨HotSpotä½œä¸ºè™šæ‹Ÿæœº</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">C:\Users\16968&gt;java -version</span><br><span class="line">java version &quot;1.8.0_181&quot;</span><br><span class="line">Java(TM) SE Runtime Environment (build 1.8.0_181-b13)</span><br><span class="line">Java HotSpot(TM) 64-Bit Server VM (build 25.181-b13, mixed mode)</span><br></pre></td></tr></table></figure></li>
</ol>
<h4 id="Java-è·¨å¹³å°è¯­è¨€çš„ä½“ç°"><a href="#Java-è·¨å¹³å°è¯­è¨€çš„ä½“ç°" class="headerlink" title="Java è·¨å¹³å°è¯­è¨€çš„ä½“ç°"></a>Java è·¨å¹³å°è¯­è¨€çš„ä½“ç°</h4><ol>
<li><p>å­—èŠ‚ç æ–‡ä»¶å¯ä»¥ç”±ä¸åŒçš„ç¼–ç¨‹è¯­è¨€æä¾›ï¼ˆç›¸åº”çš„ç¼–è¯‘å™¨ï¼‰</p>
</li>
<li><p>Java è™šæ‹Ÿæœºå¯ä»¥è¿è¡Œé Java è¯­è¨€ç¼–å†™çš„ç¨‹åºï¼Œåªå…³å¿ƒå­—èŠ‚ç æ–‡ä»¶ã€‚</p>
</li>
<li><p>JVM æœ€å¼ºå¤§çš„è™šæ‹Ÿæœºï¼Œè§£é‡Šè¿è¡Œå­—èŠ‚ç æ–‡ä»¶ã€‚</p>
</li>
<li><p>å¤šè¯­è¨€æ··åˆç¼–ç¨‹è¿è¡Œçš„è¶‹åŠ¿ã€‚</p>
</li>
</ol>
<p><img src="/2023/02/23/JVM/.%5Cimages%5CJava%E8%B7%A8%E5%B9%B3%E5%8F%B0%E8%AF%AD%E8%A8%80%E7%9A%84%E4%BD%93%E7%8E%B0.JPG" alt="Javaè·¨å¹³å°è¯­è¨€çš„ä½“ç°"></p>
<h3 id="Java-åŠ-JVMç®€ä»‹"><a href="#Java-åŠ-JVMç®€ä»‹" class="headerlink" title="Java åŠ JVMç®€ä»‹"></a>Java åŠ JVMç®€ä»‹</h3><h4 id="Javaå‘å±•çš„é‡å¤§äº‹ä»¶"><a href="#Javaå‘å±•çš„é‡å¤§äº‹ä»¶" class="headerlink" title="Javaå‘å±•çš„é‡å¤§äº‹ä»¶"></a>Javaå‘å±•çš„é‡å¤§äº‹ä»¶</h4><ul>
<li>1990å¹´ï¼Œåœ¨Sunè®¡ç®—æœºå…¬å¸ä¸­ï¼Œç”±Patrick Naughtonã€MikeSheridanåŠJames Gosling é¢†å¯¼çš„å°ç»„Green Teamï¼Œå¼€å‘å‡ºçš„æ–°çš„ç¨‹åºè¯­è¨€ï¼Œå‘½åä¸º0akï¼ŒåæœŸå‘½åä¸ºJavaã€‚</li>
<li>1995å¹´ï¼Œ Sunæ­£å¼å‘å¸ƒJavaå’ŒHotJavaäº§å“ï¼ŒJavaé¦–æ¬¡å…¬å¼€äº®ç›¸ã€‚</li>
<li>1996å¹´1æœˆ23æ—¥Sun Microsystemså‘å¸ƒäº†JDK 1.0ã€‚</li>
<li>1998å¹´ï¼ŒJDK 1.2ç‰ˆæœ¬å‘å¸ƒã€‚åŒæ—¶ï¼ŒSunå‘å¸ƒäº†JSP&#x2F;Servletã€EJBè§„èŒƒï¼Œä»¥åŠå°†Javaåˆ†æˆäº†J2EEã€J2SEå’ŒJ2MEã€‚è¿™è¡¨æ˜äº†Javaå¼€å§‹å‘ä¼ä¸šã€æ¡Œé¢åº”ç”¨å’Œç§»åŠ¨è®¾å¤‡åº”ç”¨3å¤§é¢†åŸŸæŒºè¿›ã€‚</li>
<li>2000å¹´ï¼ŒJDK 1.3å‘å¸ƒï¼ŒJava HotSpot Virtual Machineæ­£å¼å‘å¸ƒï¼Œæˆä¸ºJavaçš„é»˜è®¤è™›æ‹Ÿæœºã€‚</li>
<li>2002å¹´ï¼ŒJDK 1.4å‘å¸ƒï¼Œå¤è€çš„Classicè™šæ‹Ÿæœºé€€å‡ºå†å²èˆå°ã€‚</li>
<li>2003å¹´å¹´åº•ï¼ŒJavaå¹³å°çš„Scalaæ­£å¼å‘å¸ƒï¼ŒåŒå¹´Groovyä¹ŸåŠ å…¥äº†Javaé˜µè¥ã€‚</li>
<li>2004å¹´ï¼ŒJDK 1.5å‘å¸ƒã€‚åŒæ—¶JDK 1.5æ”¹åä¸ºJavaSE 5.0ã€‚</li>
<li>2006å¹´ï¼ŒJDK 6å‘å¸ƒã€‚åŒå¹´ï¼ŒJavaå¼€æºå¹¶å»ºç«‹äº†OpenJDKã€‚é¡ºç†æˆç« ï¼ŒHotspotè™šæ‹Ÿæœºä¹Ÿæˆä¸ºäº†OpenJDKä¸­çš„é»˜è®¤è™›æ‹Ÿæœºã€‚</li>
<li>2007å¹´ï¼ŒJavaå¹³å°è¿æ¥äº†æ–°ä¼™ä¼´Clojureã€‚</li>
<li>2008å¹´ï¼ŒOracle æ”¶è´­äº†BEAï¼Œ å¾—åˆ°äº†JRockit è™šæ‹Ÿæœºã€‚</li>
<li>2009å¹´ï¼ŒTwitterå®£å¸ƒæŠŠåå°å¤§éƒ¨åˆ†ç¨‹åºä»Rubyè¿ç§»åˆ°scalaï¼Œè¿™æ˜¯Javaå¹³å°çš„åˆä¸€æ¬¡å¤§è§„æ¨¡åº”ç”¨ã€‚</li>
<li>2010å¹´ï¼ŒOracleæ”¶è´­äº†Sunï¼Œè·å¾—Javaå•†æ ‡å’Œæœ€å…·ä»·å€¼çš„HotSpotè™šæ‹Ÿæœºã€‚æ­¤æ—¶ï¼ŒOracleæ‹¥æœ‰å¸‚åœºå ç”¨ç‡æœ€é«˜çš„ä¸¤æ¬¾è™šæ‹ŸæœºHotSpotå’ŒJRockitï¼Œå¹¶è®¡åˆ’åœ¨æœªæ¥å¯¹å®ƒä»¬è¿›è¡Œæ•´åˆï¼š HotRockit. JCPç»„ç»‡ç®¡ç†ï¼š Javaè¯­è¨€</li>
<li>2011å¹´ï¼ŒJDK7å‘å¸ƒã€‚åœ¨JDK 1. 7u4ä¸­ï¼Œæ­£å¼å¯ç”¨äº†æ–°çš„åƒåœ¾å›æ”¶å™¨G1ã€‚</li>
<li>2017å¹´ï¼ŒJDK9å‘å¸ƒã€‚å°†G1è®¾ç½®ä¸ºé»˜è®¤GCï¼Œæ›¿ä»£CMSï¼ŒåŒå¹´ï¼ŒIBMçš„J9å¼€æºï¼Œå½¢æˆäº†ç°åœ¨çš„Open J9ç¤¾åŒºã€‚</li>
<li>2018å¹´ï¼ŒAndroidçš„Javaä¾µæƒæ¡ˆåˆ¤å†³ï¼ŒGoogleèµ” å¿Oracleè®¡88äº¿ç¾å…ƒï¼ŒåŒå¹´ï¼ŒOracleå®£å‘ŠJavaEEæˆä¸ºå†å²åè¯ï¼ŒJDBCã€ JMSã€Servletèµ äºˆEclipseåŸºé‡‘ä¼šï¼ŒåŒå¹´ï¼ŒJDK11å‘å¸ƒï¼ŒLTSç‰ˆæœ¬çš„JDKï¼Œå‘å¸ƒé©å‘½æ€§çš„ZGCï¼Œè°ƒæ•´JDKæˆæƒè®¸å¯ã€‚</li>
<li>2019å¹´ï¼ŒJDK12å‘å¸ƒï¼ŒåŠ å…¥RedHaté¢†å¯¼å¼€å‘çš„Shenandoah GCã€‚</li>
</ul>
<p>ä¸‰å¤§ä¸»æµè™šæ‹Ÿæœºï¼šHotspotã€Jrockitã€J9</p>
<h4 id="è™šæ‹Ÿæœº"><a href="#è™šæ‹Ÿæœº" class="headerlink" title="è™šæ‹Ÿæœº"></a>è™šæ‹Ÿæœº</h4><ol>
<li><p>Virtual Machineï¼Œæ˜¯ä¸€å°è™šæ‹Ÿçš„è®¡ç®—æœºï¼Œæ˜¯ä¸€æ¬¾è½¯ä»¶ï¼Œç”¨æ¥æ‰§è¡Œä¸€ç³»åˆ—è™šæ‹Ÿçš„è®¡ç®—æœºæŒ‡ä»¤ï¼Œå¤§ä½“å¯ä»¥åˆ†ä¸ºï¼šç³»ç»Ÿè™šæ‹Ÿæœºå’Œç¨‹åºè™šæ‹Ÿæœºã€‚</p>
</li>
<li><p>Virtual Box å’Œ VMware æ˜¯ç³»ç»Ÿè™šæ‹Ÿæœºï¼Œæ˜¯å¯¹ç‰©ç†è®¡ç®—æœºçš„ä»¿çœŸï¼Œæä¾›äº†ä¸€ä¸ªå¯è¿è¡Œæ“ä½œç³»ç»Ÿçš„è½¯ä»¶å¹³å°ã€‚</p>
</li>
<li><p>ç¨‹åºè™šæ‹Ÿæœºçš„å…¸å‹ä»£è¡¨æ˜¯ Java è™šæ‹Ÿæœºï¼Œå®ƒä¸“é—¨æ‰§è¡Œå•ä¸ªè®¡ç®—æœºç¨‹åºè€Œè®¾è®¡ï¼Œåœ¨ Java è™šæ‹Ÿæœºä¸­æ‰§è¡Œçš„æŒ‡ä»¤æˆ‘ä»¬ç§°ä¸º Javaå­—èŠ‚ç æŒ‡ä»¤ã€‚</p>
</li>
<li><p>æ— è®ºæ˜¯ç³»ç»Ÿè™šæ‹Ÿæœºè¿˜æ˜¯ç¨‹åºè™šæ‹Ÿæœºï¼Œåœ¨ä¸Šé¢è¿è¡Œçš„è½¯ä»¶éƒ½è¢«é™åˆ¶åœ¨è™šæ‹Ÿæœºæä¾›çš„èµ„æºä¸­ã€‚</p>
</li>
</ol>
<h4 id="Javaè™šæ‹Ÿæœº"><a href="#Javaè™šæ‹Ÿæœº" class="headerlink" title="Javaè™šæ‹Ÿæœº"></a>Javaè™šæ‹Ÿæœº</h4><ol>
<li><p>Java è™šæ‹Ÿæœºæ˜¯ä¸€å°æ‰§è¡Œ Java å­—èŠ‚ç çš„è™šæ‹Ÿè®¡ç®—æœºï¼Œå®ƒæ‹¥æœ‰ç‹¬ç«‹çš„è¿è¡Œæœºåˆ¶ï¼Œæœºå™¨è¿è¡Œçš„å­—èŠ‚ç æœªå¿…æ˜¯ç”± Javaç¼–å†™çš„ã€‚</p>
</li>
<li><p>JVM å¹³å°çš„å„ç§è¯­è¨€å¯ä»¥å…±äº« Java è™šæ‹Ÿæœºå¸¦æ¥çš„è·¨å¹³å°æ€§ã€ä¼˜ç§€çš„åƒåœ¾å›æ”¶æœºåˆ¶ï¼Œä»¥åŠå¯é çš„å³æ—¶ç¼–è¯‘å™¨ã€‚</p>
</li>
<li><p>JavaæŠ€æœ¯çš„æ ¸å¿ƒå°±æ˜¯ Javaè™šæ‹Ÿæœºï¼ˆJava Virtual VMwareï¼‰ï¼Œå› ä¸ºæ‰€æœ‰çš„ Java ç¨‹åºéƒ½è¿è¡Œåœ¨ Java è™šæ‹Ÿæœºå†…éƒ¨ã€‚</p>
</li>
</ol>
<h3 id="Javaè™šæ‹Ÿæœºçš„ä½œç”¨"><a href="#Javaè™šæ‹Ÿæœºçš„ä½œç”¨" class="headerlink" title="Javaè™šæ‹Ÿæœºçš„ä½œç”¨"></a>Javaè™šæ‹Ÿæœºçš„ä½œç”¨</h3><ol>
<li>Java è™šæ‹Ÿæœºå°±æ˜¯äºŒè¿›åˆ¶å­—èŠ‚ç çš„è¿è¡Œç¯å¢ƒï¼Œè´Ÿè´£è£…è½½å­—èŠ‚ç åˆ°å…¶å†…éƒ¨ï¼Œè§£é‡Š&#x2F;ç¼–è¯‘ä¸ºå¯¹åº”å¹³å°ä¸Šçš„æœºå™¨æŒ‡ä»¤æ‰§è¡Œã€‚</li>
<li>æ¯ä¸€æ¡ Java æŒ‡ä»¤ï¼ŒJava è™šæ‹Ÿæœºè§„èŒƒä¸­éƒ½æœ‰è¯¦ç»†å®šä¹‰ï¼Œå¦‚å–æ“ä½œæ•°ï¼Œå¤„ç†æ“ä½œæ•°ï¼Œå¤„ç†ç»“æœæ”¾åœ¨å“ªé‡Œã€‚</li>
</ol>
<h3 id="Javaè™šæ‹Ÿæœºçš„ç‰¹ç‚¹"><a href="#Javaè™šæ‹Ÿæœºçš„ç‰¹ç‚¹" class="headerlink" title="Javaè™šæ‹Ÿæœºçš„ç‰¹ç‚¹"></a>Javaè™šæ‹Ÿæœºçš„ç‰¹ç‚¹</h3><ol>
<li>&#x3D;&#x3D;è·¨å¹³å°ï¼Œä¸€æ¬¡ç¼–è¯‘ï¼Œåˆ°å¤„è¿è¡Œ&#x3D;&#x3D;</li>
<li>&#x3D;&#x3D;è‡ªåŠ¨å†…å­˜ç®¡ç†&#x3D;&#x3D;</li>
<li>&#x3D;&#x3D;è‡ªåŠ¨åƒåœ¾å›æ”¶æœºåˆ¶&#x3D;&#x3D;</li>
<li>&#x3D;&#x3D;å³æ—¶ç¼–è¯‘&#x3D;&#x3D;</li>
</ol>
<h3 id="JDK-çš„ç»“æ„"><a href="#JDK-çš„ç»“æ„" class="headerlink" title="JDK çš„ç»“æ„"></a>JDK çš„ç»“æ„</h3><p>æ–‡æ¡£ï¼š<a href="https://docs.oracle.com/javase/8/docs/index.html">https://docs.oracle.com/javase/8/docs/index.html</a></p>
<img src="./images\JDKç»“æ„.JPG" style="zoom:80%">

<h3 id="JVMæ•´ä½“ç»“æ„ï¼ˆHotSpotï¼‰"><a href="#JVMæ•´ä½“ç»“æ„ï¼ˆHotSpotï¼‰" class="headerlink" title="JVMæ•´ä½“ç»“æ„ï¼ˆHotSpotï¼‰"></a>JVMæ•´ä½“ç»“æ„ï¼ˆHotSpotï¼‰</h3><p>â€‹		HotSpot VMæ˜¯ç›®å‰ä¸Šæ€§èƒ½æœ€é«˜çš„è™šæ‹Ÿæœºä»£è¡¨ä¹‹ä¸€ï¼Œ<strong>å®ƒé‡‡ç”¨çš„æ˜¯è§£é‡Šå™¨ä¸å³æ—¶ç¼–è¯‘å™¨å¹¶å­˜çš„æ¶æ„ã€‚</strong></p>
<h2 id="ç±»åŠ è½½å­ç³»ç»Ÿ"><a href="#ç±»åŠ è½½å­ç³»ç»Ÿ" class="headerlink" title="ç±»åŠ è½½å­ç³»ç»Ÿ"></a>ç±»åŠ è½½å­ç³»ç»Ÿ</h2><h3 id="å†…å­˜ç»“æ„æ¦‚è¿°"><a href="#å†…å­˜ç»“æ„æ¦‚è¿°" class="headerlink" title="å†…å­˜ç»“æ„æ¦‚è¿°"></a>å†…å­˜ç»“æ„æ¦‚è¿°</h3><p>   è™šæ‹Ÿæœºæœ€é‡è¦çš„æ˜¯ä¸¤ä¸ªéƒ¨åˆ†ï¼šç±»åŠ è½½å™¨å’Œæ‰§è¡Œå¼•æ“</p>
<p><strong>ç®€å•ç‰ˆï¼š</strong></p>
<p><img src="/images/%E5%86%85%E5%AD%98%E7%BB%93%E6%9E%84%E6%A6%82%E8%BF%B0%E7%AE%80%E5%8D%95%E7%89%88.png" alt="å†…å­˜ç»“æ„æ¦‚è¿°ç®€å•ç‰ˆ.png"></p>
<p><strong>è¯¦ç»†ç‰ˆï¼š</strong></p>
<p><img src="/images/%E5%86%85%E5%AD%98%E7%BB%93%E6%9E%84%E6%A6%82%E8%BF%B0%E8%AF%A6%E7%BB%86%E7%89%88.png" alt="å†…å­˜ç»“æ„æ¦‚è¿°è¯¦ç»†ç‰ˆ.png"></p>
<p>è¯´æ˜ï¼š</p>
<ul>
<li><p>æ¯ä¸ªçº¿ç¨‹éƒ½æœ‰ä¸€ä»½PCå¯„å­˜å™¨</p>
</li>
<li><p>å¯¹äºè™šæ‹Ÿæœºæ ˆï¼šåŒ…å«å¾ˆå¤šçš„æ ˆå¸§ï¼Œæ ˆå¸§çš„ç»“æ„å¦‚ä¸‹ï¼š</p>
<ul>
<li>LVï¼šå±€éƒ¨å˜é‡è¡¨</li>
<li>OSï¼šæ“ä½œæ•°æ ˆ</li>
<li>DLï¼šåŠ¨æ€é“¾æ¥åº“</li>
<li>RAï¼šæ–¹æ³•è¿”å›åœ°å€</li>
</ul>
</li>
<li><p>æœ¬åœ°æ–¹æ³•æ ˆï¼šç”±æœ¬åœ°æ–¹æ³•è°ƒç”¨é‡‡ç”¨æœ¬åœ°æ–¹æ³•æ ˆ</p>
</li>
<li><p>å †åŒºï¼šå…±äº«åŒºåŸŸï¼Œå­˜å‚¨å¯¹è±¡</p>
</li>
<li><p>æ–¹æ³•åŒºï¼šå­˜å‚¨ç±»çš„ä¿¡æ¯ï¼Œå¸¸é‡æ± ï¼Œæ–¹æ³•ä¿¡æ¯ç­‰ï¼Œæ–¹æ³•åŒºæ˜¯ HotSpot ç‰¹æœ‰çš„ï¼ŒJdk1.7ä¹‹å‰æ–¹æ³•åŒºä¹Ÿç§°ä½œæ°¸ä¹…ä»£ï¼ŒJDK1.8ä¹‹åç§°ä¸ºå…ƒç©ºé—´ã€‚</p>
</li>
</ul>
<p><img src="/images/%E5%86%85%E5%AD%98%E7%BB%93%E6%9E%84%E6%A6%82%E8%BF%B0%E4%B8%AD%E6%96%87%E8%AF%A6%E7%BB%86%E7%89%88.png" alt="å†…å­˜ç»“æ„æ¦‚è¿°ä¸­æ–‡è¯¦ç»†ç‰ˆ.png"></p>
<h3 id="ç±»åŠ è½½å™¨ä»¥åŠç±»çš„åŠ è½½è¿‡ç¨‹"><a href="#ç±»åŠ è½½å™¨ä»¥åŠç±»çš„åŠ è½½è¿‡ç¨‹" class="headerlink" title="ç±»åŠ è½½å™¨ä»¥åŠç±»çš„åŠ è½½è¿‡ç¨‹"></a>ç±»åŠ è½½å™¨ä»¥åŠç±»çš„åŠ è½½è¿‡ç¨‹</h3><p><img src="/images/%E7%B1%BB%E7%9A%84%E5%8A%A0%E8%BD%BD%E8%BF%87%E7%A8%8B.png" alt="ç±»çš„åŠ è½½è¿‡ç¨‹.png"></p>
<ul>
<li><p>ç±»åŠ è½½å™¨å­ç³»ç»Ÿè´Ÿè´£ä»æ–‡ä»¶ç³»ç»Ÿæˆ–ç½‘ç»œä¸­åŠ è½½Classæ–‡ä»¶ï¼ŒClassæ–‡ä»¶åœ¨æ–‡ä»¶å¼€å¤´ç”±ç‰¹å®šçš„æ–‡ä»¶æ ‡è¯†ã€‚</p>
</li>
<li><p>ClassLoaderåªè´Ÿè´£classæ–‡ä»¶çš„åŠ è½½ï¼Œè‡³äºæ˜¯å¦å¯ä»¥è¿è¡Œï¼Œåˆ™ç”± Execution Engine å†³å®šã€‚</p>
</li>
<li><p>åŠ è½½çš„ç±»çš„ä¿¡æ¯å­˜æ”¾äºæ–¹æ³•åŒºçš„å†…å­˜ç©ºé—´ï¼Œé™¤äº†ç±»çš„ä¿¡æ¯ï¼Œæ–¹æ³•åŒºè¿˜ä¼šå­˜æ”¾è¿è¡Œæ—¶å¸¸é‡æ± çš„ä¿¡æ¯ï¼Œå¯èƒ½è¿˜åŒ…æ‹¬å­—ç¬¦ä¸²å­—é¢é‡å’Œæ•°å­—å¸¸é‡ï¼Œï¼ˆè¿™éƒ¨åˆ†å¸¸é‡ä¿¡æ¯æ˜¯Classæ–‡ä»¶ä¸­å¸¸é‡æ± éƒ¨åˆ†çš„å†…å­˜æ˜ å°„ï¼‰ã€‚</p>
</li>
</ul>
<h3 id="ClassLoaderï¼šç±»åŠ è½½å™¨"><a href="#ClassLoaderï¼šç±»åŠ è½½å™¨" class="headerlink" title="ClassLoaderï¼šç±»åŠ è½½å™¨"></a>ClassLoaderï¼šç±»åŠ è½½å™¨</h3><p>â€‹		Class file å­˜åœ¨äºç£ç›˜ä¸­ï¼Œé€šè¿‡ç±»åŠ è½½å™¨åŠ è½½åˆ° JVM ä¸­ï¼Œæ ¹æ®è¿™ä¸ªæ–‡ä»¶å®ä¾‹åŒ–å‡º n ä¸ªä¸€æ¨¡ä¸€æ ·çš„å®ä¾‹ï¼ŒClass fileåŠ è½½åˆ° JVMä¸­ï¼Œè¢«ç§°ä¸ºDNAå…ƒæ•°æ®æ¨¡æ¿ï¼Œæ”¾åœ¨æ–¹æ³•åŒºï¼Œè¯¥è¿‡ç¨‹éœ€è¦ ClassLoader æ¥å®Œæˆã€‚</p>
<p>class æ–‡ä»¶å¯ä»¥é€šè¿‡ getClassLoader()  è·å¾—ç±»åŠ è½½å™¨ã€‚</p>
<h3 id="ç±»çš„åŠ è½½è¿‡ç¨‹ï¼šLoading"><a href="#ç±»çš„åŠ è½½è¿‡ç¨‹ï¼šLoading" class="headerlink" title="ç±»çš„åŠ è½½è¿‡ç¨‹ï¼šLoading"></a>ç±»çš„åŠ è½½è¿‡ç¨‹ï¼šLoading</h3><p><img src="/images/%E7%B1%BB%E7%9A%84%E5%8A%A0%E8%BD%BD%E8%BF%87%E7%A8%8B%E7%AE%80%E5%8D%95%E7%89%88.png" alt="ç±»çš„åŠ è½½è¿‡ç¨‹ç®€å•ç‰ˆ.png"></p>
<p>è¿‡ç¨‹ï¼š</p>
<ul>
<li><p>é€šè¿‡ç±»çš„å…¨é™å®šåä»ç£ç›˜ä¸Šè·å–å®šä¹‰æ­¤ç±»çš„äºŒè¿›åˆ¶æµ</p>
</li>
<li><p>å°†è¿™ä¸ªå­—èŠ‚æµæ‰€ä»£è¡¨çš„é™æ€å­˜å‚¨ç»“æ„è½¬åŒ–ä¸ºæ–¹æ³•åŒºçš„è¿è¡Œæ—¶çš„æ•°æ®ç»“æ„</p>
</li>
<li><p><strong>åœ¨å†…å­˜ä¸­ç”Ÿæˆä¸€ä¸ªä»£è¡¨è¿™ä¸ªç±»çš„java.lang.Classå¯¹è±¡</strong>ï¼Œä½œä¸ºæ–¹æ³•åŒºè¿™ä¸ªç±»çš„å„ç§æ•°æ®è®¿é—®å…¥å£</p>
</li>
</ul>
<p>åŠ è½½ .class çš„æ–¹å¼ï¼š</p>
<ul>
<li>ä»æœ¬åœ°ç³»ç»Ÿä¸­åŠ è½½</li>
<li>é€šè¿‡ç½‘ç»œç³»ç»Ÿè·å–ï¼Œå…¸å‹çš„åœºæ™¯ï¼šWeb Applet</li>
<li>ä»Zipå‹ç¼©åŒ…ä¸­è¯»å–ï¼Œç§°ä¸ºjarã€waræ ¼å¼çš„åŸºç¡€</li>
<li>è¿è¡Œæ—¶è®¡ç®—ç”Ÿæˆï¼Œä½¿ç”¨æœ€å¤šçš„æ˜¯åŠ¨æ€ä»£ç†</li>
<li>æœ‰å…¶ä»–æ–‡ä»¶ç”Ÿæˆï¼Œå…¸å‹ï¼šJsp</li>
<li>ä»ä¸“æœ‰çš„æ•°æ®åº“ä¸­æå–ï¼Œå°‘è§</li>
<li>ä»åŠ å¯†æ–‡ä»¶ä¸­è·å–ï¼Œå…¸å‹çš„é˜²Classæ–‡ä»¶è¢«åç¼–è¯‘çš„ä¿æŠ¤æªæ–½</li>
</ul>
<h3 id="ç±»çš„é“¾æ¥è¿‡ç¨‹ï¼šLinking"><a href="#ç±»çš„é“¾æ¥è¿‡ç¨‹ï¼šLinking" class="headerlink" title="ç±»çš„é“¾æ¥è¿‡ç¨‹ï¼šLinking"></a>ç±»çš„é“¾æ¥è¿‡ç¨‹ï¼šLinking</h3><h4 id="éªŒè¯ï¼šVerify"><a href="#éªŒè¯ï¼šVerify" class="headerlink" title="éªŒè¯ï¼šVerify"></a>éªŒè¯ï¼šVerify</h4><p>â€‹		ç›®çš„åœ¨äºç¡®ä¿classæ–‡ä»¶çš„å­—èŠ‚æµä¸­åŒ…å«ä¿¡æ¯ç¬¦åˆå½“å‰è™šæ‹Ÿæœºè¦æ±‚ï¼Œä¿è¯è¢«åŠ è½½ç±»çš„æ­£ç¡®æ€§ï¼Œä¸ä¼šå±å®³è™šæ‹Ÿæœºè‡ªèº«å®‰å…¨ã€‚ä¸»è¦åŒ…æ‹¬å››ç§éªŒè¯ï¼Œ<strong>æ–‡ä»¶æ ¼å¼éªŒè¯ï¼Œå…ƒæ•°æ®éªŒè¯ï¼Œå­—èŠ‚ç éªŒè¯ï¼Œç¬¦å·å¼•ç”¨éªŒè¯</strong>ã€‚</p>
<p>classæ–‡ä»¶ä»¥ â€œCAFEâ€ å¼€å§‹ï¼š</p>
<h4 id="å‡†å¤‡ï¼šPrepare"><a href="#å‡†å¤‡ï¼šPrepare" class="headerlink" title="å‡†å¤‡ï¼šPrepare"></a>å‡†å¤‡ï¼šPrepare</h4><p><strong>1.</strong>   <strong>ä¸ºç±»å˜é‡åˆ†é…å†…å­˜å¹¶ä¸”è®¾ç½®è¯¥ç±»å˜é‡çš„é»˜è®¤åˆå§‹å€¼ï¼Œå³é›¶å€¼</strong></p>
<p><strong>2.</strong>   <strong>è¿™é‡Œä¸åŒ…å«ç”¨ final ä¿®é¥°çš„ staticï¼Œå› ä¸º final åœ¨ç¼–è¯‘çš„æ—¶å€™å°±ä¼šåˆ†é…äº†ï¼Œå‡†å¤‡é˜¶æ®µä¼šæ˜¾å¼åˆå§‹åŒ–</strong></p>
<p><strong>3.</strong>   <strong>è¿™é‡Œä¸ä¼šä¸ºå®ä¾‹å˜é‡åˆ†é…åˆå§‹åŒ–ï¼Œç±»å˜é‡ä¼šåˆ†é…åœ¨æ–¹æ³•åŒºä¸­ï¼Œè€Œå®ä¾‹å˜é‡æ˜¯ä¼šéšç€å¯¹è±¡ä¸€èµ·åˆ†é…åˆ°Javaå †ä¸­</strong></p>
<h4 id="è§£æï¼šResolve"><a href="#è§£æï¼šResolve" class="headerlink" title="è§£æï¼šResolve"></a>è§£æï¼šResolve</h4><ol>
<li><p>å°†å¸¸é‡æ± å†…çš„ç¬¦å·å¼•ç”¨è½¬æ¢ä¸ºç›´æ¥å¼•ç”¨çš„è¿‡ç¨‹ã€‚</p>
</li>
<li><p>äº‹å®ä¸Šï¼Œè§£ææ“ä½œå¾€å¾€ä¼šä¼´éšç€ JVM åœ¨æ‰§è¡Œå®Œåˆå§‹åŒ–ä¹‹åå†æ‰§è¡Œã€‚</p>
</li>
<li><p>ç¬¦å·å¼•ç”¨å°±æ˜¯ä¸€ç»„ç¬¦å·æ¥æè¿°æ‰€å¼•ç”¨çš„ç›®æ ‡ã€‚<strong>ç¬¦å·å¼•ç”¨</strong>çš„å­—é¢é‡å½¢å¼æ˜ç¡®å®šä¹‰åœ¨ã€Šjavaè™šæ‹Ÿæœºè§„èŒƒã€‹çš„classæ–‡ä»¶æ ¼å¼ä¸­ã€‚<strong>ç›´æ¥å¼•ç”¨</strong>å°±æ˜¯ç›´æ¥æŒ‡å‘ç›®æ ‡çš„æŒ‡é’ˆã€ç›¸å¯¹åç§»é‡æˆ–ä¸€ä¸ªé—´æ¥å®šä½åˆ°ç›®æ ‡çš„å¥æŸ„ã€‚</p>
</li>
<li><p>è§£æåŠ¨ä½œä¸»è¦é’ˆå¯¹ç±»æˆ–æ¥å£ã€å­—æ®µã€ç±»æ–¹æ³•ã€æ¥å£æ–¹æ³•ã€æ–¹æ³•ç±»å‹ç­‰ã€‚å¯¹åº”å¸¸é‡æ± ä¸­çš„ CONSTANT_Class_infoã€CONSTANT_Fieldref_infoã€CONSTANT_Methodref_infoç­‰ã€‚</p>
</li>
</ol>
<h3 id="ç±»çš„åˆå§‹åŒ–è¿‡ç¨‹ï¼šInitialization"><a href="#ç±»çš„åˆå§‹åŒ–è¿‡ç¨‹ï¼šInitialization" class="headerlink" title="ç±»çš„åˆå§‹åŒ–è¿‡ç¨‹ï¼šInitialization"></a>ç±»çš„åˆå§‹åŒ–è¿‡ç¨‹ï¼šInitialization</h3><ol>
<li><p>åˆå§‹åŒ–é˜¶æ®µå°±æ˜¯<strong>æ‰§è¡Œç±»æ„é€ å™¨æ–¹æ³•<clinit>()çš„è¿‡ç¨‹</clinit></strong>ã€‚</p>
</li>
<li><p>æ­¤æ–¹æ³•ä¸éœ€å®šä¹‰ï¼Œæ˜¯javacç¼–è¯‘å™¨è‡ªåŠ¨æ”¶é›†ç±»ä¸­çš„<strong>æ‰€æœ‰ç±»å˜é‡çš„èµ‹å€¼åŠ¨ä½œå’Œé™æ€ä»£ç å—</strong>ä¸­çš„è¯­å¥åˆå¹¶è€Œæ¥ã€‚</p>
</li>
<li><p>æ„é€ å™¨æ–¹æ³•ä¸­æŒ‡ä»¤æŒ‰è¯­å¥åœ¨æºæ–‡ä»¶ä¸­å‡ºç°çš„é¡ºåºæ‰§è¡Œã€‚</p>
</li>
<li><p><clinit>() ä¸åŒäºç±»çš„æ„é€ å™¨ã€‚(å…³è”ï¼šæ„é€ å™¨æ˜¯è™šæ‹Ÿæœºè§†è§’ä¸‹çš„<init>() )è‹¥è¯¥ç±»å…·æœ‰çˆ¶ç±»ï¼ŒJVMä¼šä¿è¯å­ç±»çš„<clinit>() æ‰§è¡Œå‰ï¼Œçˆ¶ç±»çš„<clinit> () å·²ç»æ‰§è¡Œå®Œæ¯•ã€‚</clinit></clinit></init></clinit></p>
</li>
<li><p>è™šæ‹Ÿæœºå¿…é¡»ä¿è¯ä¸€ä¸ªç±»çš„<clinit> () æ–¹æ³•åœ¨å¤šçº¿ç¨‹ä¸‹è¢«åŒæ­¥åŠ é”ã€‚</clinit></p>
</li>
<li><p>å¦‚æœæ²¡æœ‰ç±»å˜é‡ï¼Œä¸ä¼šç”Ÿæˆ<clinit>æ–¹æ³•ï¼Œæ„é€ å™¨å¯¹åº”<init>æ–¹æ³•ã€‚</init></clinit></p>
</li>
<li><p>JDK8çš„å…ƒç©ºé—´ä½¿ç”¨æœ¬åœ°å†…å­˜ï¼Œç±»çš„åŠ è½½è¢«ç›´æ¥å†…å­˜ç¼“å­˜ï¼ŒåªåŠ è½½ä¸€æ¬¡ï¼Œè°ƒç”¨ä¸€æ¬¡<clinit>æ–¹æ³•ã€‚</clinit></p>
</li>
</ol>
<h3 id="å‡ ç§ç±»åŠ è½½å™¨çš„è¯´æ˜"><a href="#å‡ ç§ç±»åŠ è½½å™¨çš„è¯´æ˜" class="headerlink" title="å‡ ç§ç±»åŠ è½½å™¨çš„è¯´æ˜"></a>å‡ ç§ç±»åŠ è½½å™¨çš„è¯´æ˜</h3><p>â€‹		JVM æ”¯æŒä¸¤ç§ç±»å‹çš„ç±»åŠ è½½å™¨ï¼Œåˆ†åˆ«ä¸ºå¼•å¯¼ç±»åŠ è½½å™¨ï¼ˆBootstrapClassLoaderï¼‰å’Œè‡ªå®šä¹‰ç±»åŠ è½½å™¨ï¼ˆUser-Defined ClassLoader)ã€‚ä»æ¦‚å¿µä¸Šæ¥è®²ï¼Œè‡ªå®šä¹‰ç±»åŠ è½½å™¨ä¸€èˆ¬æŒ‡çš„æ˜¯ç¨‹åºä¸­ç”±å¼€å‘äººå‘˜è‡ªå®šä¹‰çš„ä¸€ç±»ç±»åŠ è½½å™¨ï¼Œä½†æ˜¯Javaè™šæ‹Ÿæœºè§„èŒƒå´æ²¡æœ‰è¿™ä¹ˆå®šä¹‰ï¼Œè€Œæ˜¯å°†æ‰€æœ‰æ´¾ç”ŸäºæŠ½è±¡ç±»ClassLoaderçš„ç±»åŠ è½½å™¨éƒ½åˆ’åˆ†ä¸ºè‡ªå®šä¹‰ç±»åŠ è½½å™¨ã€‚æ— è®ºç±»åŠ è½½å™¨çš„ç±»å‹å¦‚ä½•åˆ’åˆ†ï¼Œåœ¨ç¨‹åºä¸­æˆ‘ä»¬æœ€å¸¸è§çš„ç±»åŠ è½½å™¨å§‹ç»ˆåªæœ‰3ä¸ªï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<ul>
<li>BootStrap ClassLoader</li>
<li>Extension ClassLoader</li>
<li>System ClassLoader</li>
<li>UserDefine ClassLoader</li>
</ul>
<p>è¿™å››è€…çš„å…³ç³»æ˜¯åŒ…å«å…³ç³»ï¼Œè€Œéç»§æ‰¿æˆ–ä¸Šä¸‹å±‚ç­‰ï¼Œä»å¦ä¸€è§’åº¦è¯´ï¼šå¼•å¯¼ç±»åŠ è½½å™¨ä¸æ˜¯Javaå†™çš„ï¼Œæ— æ³•è·å–å¯¹è±¡ã€‚</p>
<h3 id="ç±»åŠ è½½å™¨çš„åˆ†ç±»"><a href="#ç±»åŠ è½½å™¨çš„åˆ†ç±»" class="headerlink" title="ç±»åŠ è½½å™¨çš„åˆ†ç±»"></a>ç±»åŠ è½½å™¨çš„åˆ†ç±»</h3><h4 id="å¯åŠ¨-x2F-å¼•å¯¼ç±»åŠ è½½å™¨-Bootstrap-ClassLoader"><a href="#å¯åŠ¨-x2F-å¼•å¯¼ç±»åŠ è½½å™¨-Bootstrap-ClassLoader" class="headerlink" title="å¯åŠ¨&#x2F;å¼•å¯¼ç±»åŠ è½½å™¨ (Bootstrap ClassLoader)"></a>å¯åŠ¨&#x2F;å¼•å¯¼ç±»åŠ è½½å™¨ (Bootstrap ClassLoader)</h4><ol>
<li><p>è¿™ä¸ªç±»åŠ è½½ä½¿ç”¨C&#x2F;C++è¯­è¨€å®ç°çš„ï¼ŒåµŒå¥—åœ¨ JVM å†…éƒ¨ã€‚</p>
</li>
<li><p>å®ƒç”¨æ¥åŠ è½½ Java çš„æ ¸å¿ƒåº“ï¼ˆJAVA_HOME&#x2F;jre&#x2F;lib&#x2F;rt. jarã€resources.jar æˆ– sun.boot.class.path è·¯å¾„ä¸‹çš„å†…å®¹ï¼‰ï¼Œç”¨äºæä¾› JVM è‡ªèº«éœ€è¦çš„ç±»ã€‚</p>
</li>
<li><p>å¹¶ä¸ç»§æ‰¿è‡ª java.lang.ClassLoaderï¼Œæ²¡æœ‰çˆ¶åŠ è½½å™¨ã€‚</p>
</li>
<li><p>å¼•å¯¼ç±»åŠ è½½å™¨åŠ è½½æ‰©å±•ç±»å’Œåº”ç”¨ç¨‹åºç±»åŠ è½½å™¨ï¼Œå¹¶æŒ‡å®šä¸ºä»–ä»¬çš„çˆ¶ç±»åŠ è½½å™¨ã€‚</p>
</li>
<li><p>å‡ºäºå®‰å…¨è€ƒè™‘ï¼ŒBootstrapå¯åŠ¨ç±»åŠ è½½å™¨åªåŠ è½½åŒ…åä¸ºjavaã€ javaxã€sunç­‰å¼€å¤´çš„ç±»ã€‚</p>
</li>
</ol>
<h4 id="æ‰©å±•ç±»åŠ è½½å™¨-Extension-ClassLoader"><a href="#æ‰©å±•ç±»åŠ è½½å™¨-Extension-ClassLoader" class="headerlink" title="æ‰©å±•ç±»åŠ è½½å™¨(Extension ClassLoader)"></a>æ‰©å±•ç±»åŠ è½½å™¨(Extension ClassLoader)</h4><ol>
<li><p>Javaè¯­è¨€ç¼–å†™ï¼Œç”±sun.misc.Launcher$ExtClassLoaderå®ç°ã€‚</p>
</li>
<li><p>æ´¾ç”ŸäºclassLoaderç±»ï¼Œçˆ¶ç±»åŠ è½½å™¨ä¸ºå¯åŠ¨ç±»åŠ è½½å™¨</p>
</li>
<li><p>ä»java.ext.dirsç³»ç»Ÿå±æ€§æ‰€æŒ‡å®šçš„ç›®å½•ä¸­åŠ è½½ç±»åº“ï¼Œæˆ–ä»JDKçš„å®‰è£…ç›®å½•çš„jre&#x2F;lib&#x2F;extå­ç›®å½•ï¼ˆæ‰©å±•ç›®å½•ï¼‰ä¸‹åŠ è½½ç±»åº“ã€‚</p>
</li>
<li><p>å¦‚æœç”¨æˆ·åˆ›å»ºçš„JARæ”¾åœ¨æ­¤ç›®å½•ä¸‹ï¼Œä¹Ÿä¼šè‡ªåŠ¨ç”±æ‰©å±•ç±»åŠ è½½å™¨åŠ è½½ã€‚</p>
</li>
</ol>
<h4 id="ç”¨æˆ·è‡ªå®šä¹‰ç±»åŠ è½½å™¨"><a href="#ç”¨æˆ·è‡ªå®šä¹‰ç±»åŠ è½½å™¨" class="headerlink" title="ç”¨æˆ·è‡ªå®šä¹‰ç±»åŠ è½½å™¨"></a>ç”¨æˆ·è‡ªå®šä¹‰ç±»åŠ è½½å™¨</h4><p>â€‹		åœ¨ Java çš„æ—¥å¸¸åº”ç”¨ç¨‹åºå¼€å‘ä¸­ï¼Œç±»çš„åŠ è½½å‡ ä¹æ˜¯ç”±ä¸Šè¿°3ç§ç±»åŠ è½½å™¨ç›¸äº’é…åˆæ‰§è¡Œçš„ï¼Œåœ¨å¿…è¦æ—¶ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥è‡ªå®šä¹‰ç±»åŠ è½½å™¨ï¼Œæ¥å®šåˆ¶ç±»çš„åŠ è½½æ–¹å¼ã€‚</p>
<p>ä¸ºä»€ä¹ˆè¦è‡ªå®šä¹‰ç±»åŠ è½½å™¨?</p>
<ol>
<li><p>éš”ç¦»åŠ è½½ç±»ï¼ˆé¿å…å¤šä¸ªæ¡†æ¶å®šä¹‰ç›¸åŒçš„ç±»ï¼‰</p>
</li>
<li><p>ä¿®æ”¹ç±»åŠ è½½çš„æ–¹å¼</p>
</li>
<li><p>æ‰©å±•åŠ è½½æº</p>
</li>
<li><p>é˜²æ­¢æºç æ³„æ¼ï¼ˆå¯¹å­—èŠ‚ç è¿›è¡ŒåŠ å¯†å’Œè§£å¯†æ“ä½œï¼‰</p>
</li>
</ol>
<h4 id="ç”¨æˆ·è‡ªå®šä¹‰ç±»åŠ è½½å™¨å®ç°æ­¥éª¤"><a href="#ç”¨æˆ·è‡ªå®šä¹‰ç±»åŠ è½½å™¨å®ç°æ­¥éª¤" class="headerlink" title="ç”¨æˆ·è‡ªå®šä¹‰ç±»åŠ è½½å™¨å®ç°æ­¥éª¤"></a>ç”¨æˆ·è‡ªå®šä¹‰ç±»åŠ è½½å™¨å®ç°æ­¥éª¤</h4><ol>
<li><p>å¼€å‘äººå‘˜å¯ä»¥é€šè¿‡ç»§æ‰¿æŠ½è±¡ç±» java.lang.classLoader ç±»çš„æ–¹å¼ï¼Œå®ç°è‡ªå·±çš„ç±»åŠ è½½å™¨ï¼Œä»¥æ»¡è¶³ä¸€äº›ç‰¹æ®Šçš„éœ€æ±‚ã€‚</p>
</li>
<li><p>åœ¨ JDK1.2ä¹‹å‰ï¼Œåœ¨è‡ªå®šä¹‰ç±»åŠ è½½å™¨æ—¶ï¼Œæ€»ä¼šå»ç»§æ‰¿ classLoader ç±»å¹¶é‡å†™ loadclass() æ–¹æ³•ï¼Œä»è€Œå®ç°è‡ªå®šä¹‰çš„ç±»åŠ è½½ç±»ï¼Œä½†æ˜¯åœ¨ JDK1.2 ä¹‹åå·²ä¸å†å»ºè®®ç”¨æˆ·å»è¦†ç›– loadclass() æ–¹æ³•ï¼Œè€Œæ˜¯å»ºè®®æŠŠè‡ªå®šä¹‰çš„ç±»åŠ è½½é€»è¾‘å†™åœ¨ findclass() æ–¹æ³•ä¸­ã€‚</p>
</li>
<li><p>åœ¨ç¼–å†™è‡ªå®šä¹‰ç±»åŠ è½½å™¨æ—¶ï¼Œå¦‚æœæ²¡æœ‰å¤ªè¿‡äºå¤æ‚çš„éœ€æ±‚ï¼Œå¯ä»¥ç›´æ¥ç»§æ‰¿ URLClassLoader ç±»ï¼Œè¿™æ ·å°±å¯ä»¥é¿å…è‡ªå·±å»ç¼–å†™ findclass() æ–¹æ³•åŠå…¶è·å–å­—èŠ‚ç æµçš„æ–¹å¼ï¼Œä½¿è‡ªå®šä¹‰ç±»åŠ è½½å™¨ç¼–å†™æ›´åŠ ç®€æ´ã€‚</p>
</li>
</ol>
<h4 id="ClassLoaderç±»"><a href="#ClassLoaderç±»" class="headerlink" title="ClassLoaderç±»"></a>ClassLoaderç±»</h4><p>ClassLoader ç±»æ˜¯ä¸€ä¸ªæŠ½è±¡ç±»ï¼Œå…¶åæ‰€æœ‰çš„ç±»åŠ è½½å™¨éƒ½ç»§æ‰¿è‡ªClassLoaderï¼ˆä¸åŒ…æ‹¬å¯åŠ¨ç±»åŠ è½½å™¨ï¼‰ã€‚</p>
<table>
<thead>
<tr>
<th>æ–¹æ³•åç§°</th>
<th>æè¿°</th>
</tr>
</thead>
<tbody><tr>
<td>getParent()</td>
<td>è¿”å›è¯¥åŠ è½½å™¨çš„è¶…ç±»åŠ è½½å™¨</td>
</tr>
<tr>
<td>loadClass(String name)</td>
<td>åŠ è½½åä¸º name çš„ç±»ï¼Œè¿”å›ç»“æœä¸º Java.lang.Class ç±»çš„å®ä¾‹</td>
</tr>
<tr>
<td>findClass(String name)</td>
<td>åŠ è½½åä¸º name çš„ç±»ï¼Œè¿”å›ç»“æœä¸º Java.lang.Class ç±»çš„å®ä¾‹</td>
</tr>
<tr>
<td>findLoadClass(String name)</td>
<td>æŸ¥æ‰¾åç§°ä¸º name çš„å·²ç»è¢«åŠ è½½è¿‡çš„ç±»ï¼Œè¿”å›ç»“æœä¸ºjava.lang.Classçš„å®ä¾‹</td>
</tr>
<tr>
<td>defineClass(String nameï¼Œbyte[] bï¼Œint offï¼Œint  len)</td>
<td>å°†å­—èŠ‚æ•°ç»„ b çš„å†…å®¹è½¬ä¸ºä¸€ä¸ª Java ç±»ï¼Œè¿”å›ç»“æœä¸º java.lang.classçš„å®ä¾‹</td>
</tr>
<tr>
<td>resolveClass(Class&lt;?&gt; c)</td>
<td>è¿æ¥æŒ‡å®šçš„ä¸€ä¸ªjavaç±»</td>
</tr>
</tbody></table>
<h4 id="è·å–ClassLoaderçš„é€”å¾„"><a href="#è·å–ClassLoaderçš„é€”å¾„" class="headerlink" title="è·å–ClassLoaderçš„é€”å¾„"></a>è·å–ClassLoaderçš„é€”å¾„</h4><ul>
<li><p>æ–¹å¼ä¸€ï¼šè·å–å½“å‰ç±»çš„ClassLoader</p>
<p>clazz.getClassLoader()</p>
</li>
<li><p>æ–¹å¼äºŒï¼šè·å–å½“å‰ä¸Šä¸‹æ–‡çš„ClassLoader</p>
<p>Thread.currentThread().getContextClassLoader()</p>
</li>
<li><p>æ–¹å¼ä¸‰ï¼šè·å–ç³»ç»Ÿçš„ClassLoader</p>
<p>ClassLoader.getSystemClassLoader()</p>
</li>
<li><p>æ–¹å¼å››ï¼šè·å–è°ƒç”¨è€…çš„ClassLoader</p>
<p>DriverManager.getCallerClassLoader()</p>
</li>
</ul>
<h3 id="åŒäº²å§”æ´¾æœºåˆ¶"><a href="#åŒäº²å§”æ´¾æœºåˆ¶" class="headerlink" title="åŒäº²å§”æ´¾æœºåˆ¶"></a>åŒäº²å§”æ´¾æœºåˆ¶</h3><p>â€‹		Java è™šæ‹Ÿæœºå¯¹ class æ–‡ä»¶é‡‡ç”¨çš„æ˜¯æŒ‰éœ€åŠ è½½çš„æ–¹å¼ï¼Œä¹Ÿå°±æ˜¯è¯´å½“éœ€è¦ä½¿ç”¨è¯¥ç±»æ—¶æ‰ä¼šå°†å®ƒçš„ class æ–‡ä»¶åŠ è½½åˆ°å†…å­˜ç”Ÿæˆ class å¯¹è±¡ã€‚è€Œä¸”åŠ è½½æŸä¸ªç±»çš„ class æ–‡ä»¶æ—¶ï¼ŒJava è™šæ‹Ÿæœºé‡‡ç”¨çš„æ˜¯åŒäº²å§”æ´¾æ¨¡å¼ï¼Œå³æŠŠè¯·æ±‚äº¤ç”±çˆ¶ç±»å¤„ç†ï¼Œå®ƒæ˜¯ä¸€ç§ä»»åŠ¡å§”æ´¾æ¨¡å¼ã€‚</p>
<h4 id="å·¥ä½œåŸç†"><a href="#å·¥ä½œåŸç†" class="headerlink" title="å·¥ä½œåŸç†"></a>å·¥ä½œåŸç†</h4><ol>
<li><p>å¦‚æœä¸€ä¸ªç±»åŠ è½½å™¨æ”¶åˆ°äº†ç±»åŠ è½½è¯·æ±‚ï¼Œå®ƒå¹¶ä¸ä¼šè‡ªå·±å…ˆå»åŠ è½½ï¼Œè€Œæ˜¯æŠŠè¿™ä¸ªè¯·æ±‚å§”æ‰˜ç»™çˆ¶ç±»çš„åŠ è½½å™¨å»æ‰§è¡Œã€‚</p>
</li>
<li><p>å¦‚æœçˆ¶ç±»åŠ è½½å™¨è¿˜å­˜åœ¨å…¶çˆ¶ç±»åŠ è½½å™¨ï¼Œåˆ™è¿›ä¸€æ­¥å‘ä¸Šå§”æ‰˜ï¼Œä¾æ¬¡é€’å½’ï¼Œè¯·æ±‚æœ€ç»ˆå°†åˆ°è¾¾é¡¶å±‚çš„å¯åŠ¨ç±»åŠ è½½å™¨ã€‚</p>
</li>
<li><p>å¦‚æœçˆ¶ç±»åŠ è½½å™¨å¯ä»¥å®Œæˆç±»åŠ è½½ä»»åŠ¡ï¼Œå°±æˆåŠŸè¿”å›ï¼Œå€˜è‹¥çˆ¶ç±»åŠ è½½å™¨æ— æ³•å®Œæˆæ­¤åŠ è½½ä»»åŠ¡ï¼Œå­åŠ è½½å™¨æ‰ä¼šå°è¯•è‡ªå·±å»åŠ è½½ï¼Œè¿™å°±æ˜¯åŒäº²å§”æ´¾æ¨¡å¼ã€‚</p>
</li>
</ol>
<p>åŒäº²å§”æ´¾çš„ä¼˜åŠ¿</p>
<ul>
<li><p>é¿å…ç±»çš„é‡å¤åŠ è½½ï¼ˆå‘ä¸Šå¯ä»¥è¢«åŠ è½½å°±ä¸ä¼šç»§ç»­å§”æ´¾ï¼ŒåªåŠ è½½ä¸€æ¬¡ï¼‰</p>
</li>
<li><p>ä¿æŠ¤ç¨‹åºå®‰å…¨ï¼Œé˜²æ­¢éšæ„ç¯¡æ”¹æ ¸å¿ƒAPIï¼Œå¦‚ Java.lang.Stringå’Œjava.lang.SamStartã€‚å¦‚æœå¼•å¯¼ç±»åŠ è½½è¯¥ç±»ï¼Œå¯èƒ½å‡ºç°é—®é¢˜é€ æˆç ´åã€‚</p>
</li>
</ul>
<p><img src="/images/%E5%8F%8C%E4%BA%B2%E5%A7%94%E6%B4%BE.png" alt="åŒäº²å§”æ´¾.png"></p>
<p>ç¨‹åºè¯´æ˜ï¼š</p>
<p>â€‹		è‡ªå®šä¹‰çš„ java.lang.String å…ˆç”±åº”ç”¨ç±»åŠ è½½å™¨å§”æ‰˜æ‰©å±•ç±»åŠ è½½å™¨ï¼Œå†ç”±æ‰©å±•ç±»åŠ è½½å™¨å§”æ‰˜ç»™å¼•å¯¼ç±»åŠ è½½å™¨ï¼Œå¼•å¯¼ç±»åŠ è½½å™¨åªåŠ è½½åŒ…åä¸º javaã€ javaxã€sun ç­‰å¼€å¤´çš„ç±»ã€‚å› æ­¤çœŸæ­£åŠ è½½çš„æ˜¯Stringç±»ï¼Œè€Œä¸æ˜¯è‡ªå®šä¹‰çš„Stringã€‚</p>
<h4 id="æ²™ç®±å®‰å…¨æœºåˆ¶"><a href="#æ²™ç®±å®‰å…¨æœºåˆ¶" class="headerlink" title="æ²™ç®±å®‰å…¨æœºåˆ¶"></a>æ²™ç®±å®‰å…¨æœºåˆ¶</h4><p>â€‹		è‡ªå®šä¹‰ String ç±»ï¼Œä½†æ˜¯åœ¨åŠ è½½è‡ªå®šä¹‰ String ç±»çš„æ—¶å€™ä¼šç‡å…ˆä½¿ç”¨å¼•å¯¼ç±»åŠ è½½å™¨åŠ è½½ï¼Œè€Œå¼•å¯¼ç±»åŠ è½½å™¨åœ¨åŠ è½½çš„è¿‡ç¨‹ä¸­ä¼šå…ˆåŠ è½½ jdk è‡ªå¸¦çš„æ–‡ä»¶( rt.jaråŒ…ä¸­ java\lang\string.class )ï¼ŒæŠ¥é”™ä¿¡æ¯è¯´æ²¡æœ‰mainæ–¹æ³•ï¼Œå°±æ˜¯å› ä¸ºåŠ è½½çš„æ˜¯ rt.jar åŒ…ä¸­çš„String ç±»ã€‚è¿™æ ·å¯ä»¥ä¿è¯å¯¹ java æ ¸å¿ƒæºä»£ç çš„ä¿æŠ¤ï¼Œè¿™å°±æ˜¯æ²™ç®±å®‰å…¨æœºåˆ¶ã€‚</p>
<h4 id="åˆ¤æ–­ä¸¤ä¸ªClasså¯¹è±¡æ˜¯å¦ä¸ºåŒä¸€ç±»"><a href="#åˆ¤æ–­ä¸¤ä¸ªClasså¯¹è±¡æ˜¯å¦ä¸ºåŒä¸€ç±»" class="headerlink" title="åˆ¤æ–­ä¸¤ä¸ªClasså¯¹è±¡æ˜¯å¦ä¸ºåŒä¸€ç±»"></a>åˆ¤æ–­ä¸¤ä¸ªClasså¯¹è±¡æ˜¯å¦ä¸ºåŒä¸€ç±»</h4><ul>
<li><p>ç±»çš„å®Œæ•´ç±»åå¿…é¡»ä¸€è‡´ï¼ŒåŒ…æ‹¬åŒ…åã€‚</p>
</li>
<li><p>åŠ è½½è¿™ä¸ªç±»çš„classLoader(æŒ‡classLoaderå®ä¾‹å¯¹è±¡)å¿…é¡»ç›¸åŒã€‚</p>
<p>æ¢å¥è¯è¯´ï¼Œåœ¨JVMä¸­ï¼Œå³ä½¿è¿™ä¸¤ä¸ªç±»å¯¹è±¡(classå¯¹è±¡)æ¥æºåŒä¸€ä¸ªclassæ–‡ä»¶ï¼Œè¢«åŒä¸€ä¸ªè™šæ‹Ÿæœºæ‰€åŠ è½½ï¼Œä½†åªè¦åŠ è½½å®ƒä»¬çš„classLoaderå®ä¾‹å¯¹è±¡ä¸åŒï¼Œé‚£ä¹ˆè¿™ä¸¤ä¸ªç±»å¯¹è±¡ä¹Ÿæ˜¯ä¸ç›¸ç­‰çš„ã€‚</p>
</li>
</ul>
<h4 id="å¯¹ç±»åŠ è½½å™¨çš„å¼•ç”¨"><a href="#å¯¹ç±»åŠ è½½å™¨çš„å¼•ç”¨" class="headerlink" title="å¯¹ç±»åŠ è½½å™¨çš„å¼•ç”¨"></a>å¯¹ç±»åŠ è½½å™¨çš„å¼•ç”¨</h4><p>JVM å¿…é¡»çŸ¥é“ä¸€ä¸ªç±»å‹æ˜¯ç”±å¯åŠ¨åŠ è½½å™¨åŠ è½½çš„è¿˜æ˜¯ç”±ç”¨æˆ·ç±»åŠ è½½å™¨åŠ è½½çš„ã€‚å¦‚æœä¸€ä¸ªç±»å‹æ˜¯ç”±ç”¨æˆ·ç±»åŠ è½½å™¨åŠ è½½çš„ï¼Œé‚£ä¹ˆJVMä¼šå°†è¿™ä¸ªç±»åŠ è½½å™¨çš„ä¸€ä¸ªå¼•ç”¨ä½œä¸ºç±»å‹ä¿¡æ¯çš„ä¸€éƒ¨åˆ†ä¿å­˜åœ¨æ–¹æ³•åŒºä¸­ã€‚å½“è§£æä¸€ä¸ªç±»å‹åˆ°å¦ä¸€ä¸ªç±»å‹çš„å¼•ç”¨çš„æ—¶å€™ï¼ŒJVMéœ€è¦ä¿è¯è¿™ä¸¤ä¸ªç±»å‹çš„ç±»åŠ è½½å™¨æ˜¯ç›¸åŒçš„ã€‚</p>
<h4 id="ç±»çš„ä¸»åŠ¨ä½¿ç”¨å’Œè¢«åŠ¨ä½¿ç”¨"><a href="#ç±»çš„ä¸»åŠ¨ä½¿ç”¨å’Œè¢«åŠ¨ä½¿ç”¨" class="headerlink" title="ç±»çš„ä¸»åŠ¨ä½¿ç”¨å’Œè¢«åŠ¨ä½¿ç”¨"></a>ç±»çš„ä¸»åŠ¨ä½¿ç”¨å’Œè¢«åŠ¨ä½¿ç”¨</h4><p>Javaç¨‹åºå¯¹ç±»çš„ä½¿ç”¨æ–¹å¼åˆ†ä¸ºï¼šä¸»åŠ¨ä½¿ç”¨å’Œè¢«åŠ¨ä½¿ç”¨ã€‚</p>
<p>ä¸»åŠ¨ä½¿ç”¨ï¼Œåˆåˆ†ä¸ºä¸ƒç§æƒ…å†µï¼š</p>
<ol>
<li><p>åˆ›å»ºç±»çš„å®ä¾‹</p>
</li>
<li><p>è®¿é—®æŸä¸ªç±»æˆ–æ¥å£çš„é™æ€å˜é‡ï¼Œæˆ–è€…å¯¹è¯¥é™æ€å˜é‡èµ‹å€¼</p>
</li>
<li><p>è°ƒç”¨ç±»çš„é™æ€æ–¹æ³•</p>
</li>
<li><p>åå°„ï¼ˆæ¯”å¦‚ï¼šClass.forName(â€œcom.example. Testâ€) )</p>
</li>
<li><p>åˆå§‹åŒ–ä¸€ä¸ªç±»çš„å­ç±»</p>
</li>
<li><p>Javaè™šæ‹Ÿæœºå¯åŠ¨æ—¶è¢«æ ‡æ˜ä¸ºå¯åŠ¨ç±»çš„ç±»</p>
</li>
<li><p>JDK 7 å¼€å§‹æä¾›çš„åŠ¨æ€è¯­è¨€æ”¯æŒï¼š</p>
<ol>
<li><p>java.lang.invoke.MethodHandleå®ä¾‹çš„è§£æç»“æœ</p>
</li>
<li><p>REFgetStaticã€REF putstaticã€REF invokeStaticå¥æŸ„å¯¹åº”çš„ç±»æ²¡æœ‰åˆå§‹åŒ–ï¼Œåˆ™åˆå§‹åŒ–</p>
</li>
</ol>
</li>
</ol>
<p>é™¤äº†ä»¥ä¸Šä¸ƒç§æƒ…å†µï¼Œå…¶ä»–ä½¿ç”¨ Java ç±»çš„æ–¹å¼éƒ½è¢«çœ‹ä½œæ˜¯å¯¹ç±»çš„è¢«åŠ¨ä½¿ç”¨ï¼Œéƒ½<strong>ä¸ä¼šå¯¼è‡´ç±»çš„åˆå§‹åŒ–ã€‚</strong></p>
<h2 id="è¿è¡Œæ—¶æ•°æ®åŒºåŠæ¦‚è¿°åŠçº¿ç¨‹"><a href="#è¿è¡Œæ—¶æ•°æ®åŒºåŠæ¦‚è¿°åŠçº¿ç¨‹" class="headerlink" title="è¿è¡Œæ—¶æ•°æ®åŒºåŠæ¦‚è¿°åŠçº¿ç¨‹"></a>è¿è¡Œæ—¶æ•°æ®åŒºåŠæ¦‚è¿°åŠçº¿ç¨‹</h2><h3 id="è¿è¡Œæ—¶æ•°æ®åŒºç»“æ„æ¦‚è¿°"><a href="#è¿è¡Œæ—¶æ•°æ®åŒºç»“æ„æ¦‚è¿°" class="headerlink" title="è¿è¡Œæ—¶æ•°æ®åŒºç»“æ„æ¦‚è¿°"></a>è¿è¡Œæ—¶æ•°æ®åŒºç»“æ„æ¦‚è¿°</h3><p>â€‹		å†…å­˜æ˜¯éå¸¸é‡è¦çš„ç³»ç»Ÿèµ„æºï¼Œæ˜¯ç¡¬ç›˜å’ŒCPUçš„ä¸­é—´ä»“åº“åŠæ¡¥æ¢ï¼Œæ‰¿è½½ç€æ“ä½œç³»ç»Ÿå’Œåº”ç”¨ç¨‹åºçš„å®æ—¶è¿è¡Œã€‚ JVMå†…å­˜å¸ƒå±€è§„å®šäº†Javaåœ¨è¿è¡Œè¿‡ç¨‹ä¸­å†…å­˜ç”³è¯·ã€åˆ†é…ã€ç®¡ç†çš„ç­–ç•¥ï¼Œä¿è¯äº†JVMçš„é«˜æ•ˆç¨³å®šè¿è¡Œã€‚ä¸åŒçš„JVMå¯¹äºå†…å­˜çš„åˆ’åˆ†æ–¹å¼å’Œç®¡ç†æœºåˆ¶å­˜åœ¨ç€éƒ¨åˆ†å·®å¼‚ã€‚</p>
<p><img src="/images/%E8%BF%90%E8%A1%8C%E6%97%B6%E6%95%B0%E6%8D%AE%E5%8C%BA%E7%BB%93%E6%9E%84%E6%A6%82%E8%BF%B0.png" alt="è¿è¡Œæ—¶æ•°æ®åŒºç»“æ„æ¦‚è¿°.png"></p>
<p>è¯´æ˜ï¼š</p>
<ul>
<li><p>Javaè™šæ‹Ÿæœºå®šä¹‰äº†è‹¥å¹²ç§ç¨‹åºè¿è¡ŒæœŸé—´ä¼šä½¿ç”¨åˆ°çš„è¿è¡Œæ—¶æ•°æ®åŒºï¼Œå…¶ä¸­æœ‰ä¸€äº›ä¼šéšç€è™šæ‹Ÿæœºå¯åŠ¨è€Œåˆ›å»ºï¼Œéšç€è™šæ‹Ÿæœºé€€å‡ºè€Œé”€æ¯ã€‚</p>
</li>
<li><p>å¦å¤–ä¸€äº›åˆ™æ˜¯ä¸çº¿ç¨‹ä¸€ä¸€å¯¹åº”çš„ï¼Œè¿™äº›ä¸çº¿ç¨‹å¯¹åº”çš„æ•°æ®åŒºåŸŸä¼šéšç€çº¿ç¨‹å¼€å§‹å’Œç»“æŸè€Œåˆ›å»ºå’Œé”€æ¯ã€‚å³ï¼š</p>
<p>â€‹		<strong>æ¯ä¸ªçº¿ç¨‹ï¼šç‹¬ç«‹åŒ…æ‹¬ç¨‹åºè®¡æ•°å™¨ã€æ ˆã€æœ¬åœ°æ ˆã€‚</strong></p>
<p>â€‹		<strong>çº¿ç¨‹é—´å…±äº«ï¼šå †ã€å †å¤–å†…å­˜ï¼ˆæ°¸ä¹…ä»£æˆ–å…ƒç©ºé—´ã€ä»£ç ç¼“å­˜)</strong></p>
</li>
<li><p>å¦‚ä¸€ä¸ªè¿›ç¨‹åŒ…å« n ä¸ªçº¿ç¨‹ï¼Œåˆ™ä¼šæœ‰ n ä¸ªè™šæ‹Ÿæœºæ ˆã€æœ¬åœ°æ–¹æ³•æ ˆã€ç¨‹åºè®¡æ•°å™¨ï¼Œå®ƒä»¬å…±ç”¨ 1 ä¸ªæ–¹æ³•åŒºå’Œå †åŒºã€‚</p>
<p>ã€å¤§æ¦‚ï¼šå †ï¼ˆå ç”¨95%ç©ºé—´ï¼‰ï¼Œæ–¹æ³•åŒºï¼ˆ5%ç©ºé—´ï¼‰ã€‘</p>
</li>
<li><p>JDK8 æ–¹æ³•åŒºä¸ºå…ƒç©ºé—´ï¼Œä½¿ç”¨æœ¬åœ°å†…å­˜ã€‚ï¼ˆæœ¬åœ°å†…å­˜å¾ˆå¤§ï¼Œæ–¹æ³•åŒºåŸºæœ¬ä¸å‡ºç°æº¢å‡ºï¼‰</p>
</li>
<li><p>æ¯ä¸€ä¸ªJVMåªæœ‰ä¸€ä¸ªRuntimeå®ä¾‹ï¼Œä¸ºè¿è¡Œæ—¶ç¯å¢ƒã€‚</p>
</li>
</ul>
<h3 id="JVMä¸­çš„çº¿ç¨‹è¯´æ˜"><a href="#JVMä¸­çš„çº¿ç¨‹è¯´æ˜" class="headerlink" title="JVMä¸­çš„çº¿ç¨‹è¯´æ˜"></a>JVMä¸­çš„çº¿ç¨‹è¯´æ˜</h3><h4 id="è¯´æ˜ä¸€ï¼š"><a href="#è¯´æ˜ä¸€ï¼š" class="headerlink" title="è¯´æ˜ä¸€ï¼š"></a>è¯´æ˜ä¸€ï¼š</h4><ol>
<li><p>çº¿ç¨‹æ˜¯ä¸€ä¸ªç¨‹åºé‡Œçš„è¿è¡Œå•å…ƒã€‚JVMå…è®¸ä¸€ä¸ªåº”ç”¨æœ‰å¤šä¸ªçº¿ç¨‹å¹¶è¡Œçš„æ‰§è¡Œã€‚</p>
</li>
<li><p>&#x3D;&#x3D;åœ¨Hotspot JVMé‡Œï¼Œæ¯ä¸ªçº¿ç¨‹éƒ½ä¸æ“ä½œç³»ç»Ÿçš„æœ¬åœ°çº¿ç¨‹ç›´æ¥æ˜ å°„ã€‚&#x3D;&#x3D;</p>
</li>
<li><p>å½“ä¸€ä¸ª Java çº¿ç¨‹å‡†å¤‡å¥½æ‰§è¡Œä»¥åï¼Œæ­¤æ—¶ä¸€ä¸ªæ“ä½œç³»ç»Ÿçš„æœ¬åœ°çº¿ç¨‹ä¹ŸåŒæ—¶åˆ›å»ºã€‚Javaçº¿ç¨‹æ‰§è¡Œç»ˆæ­¢åï¼Œæœ¬åœ°çº¿ç¨‹ä¹Ÿä¼šå›æ”¶ã€‚</p>
</li>
<li><p>&#x3D;&#x3D;æ“ä½œç³»ç»Ÿè´Ÿè´£æ‰€æœ‰çº¿ç¨‹çš„å®‰æ’è°ƒåº¦åˆ°ä»»ä½•ä¸€ä¸ªå¯ç”¨çš„CPUä¸Šã€‚ä¸€æ—¦æœ¬åœ°çº¿ç¨‹åˆå§‹åŒ–æˆåŠŸï¼Œå®ƒå°±ä¼šè°ƒç”¨Javaçº¿ç¨‹ä¸­çš„run()æ–¹æ³•ã€‚&#x3D;&#x3D;</p>
</li>
<li><p>Javaçº¿ç¨‹çš„å‡†å¤‡ï¼šPCå¯„å­˜å™¨ã€æœ¬åœ°æ–¹æ³•æ ˆã€è™šæ‹Ÿæœºæ ˆ</p>
</li>
<li><p>å¦‚æœ run æ–¹æ³•æ­£å¸¸æ‰§è¡Œç»“æŸï¼Œé‚£ä¹ˆ Java çº¿ç¨‹æ‰§è¡Œç»ˆæ­¢åï¼Œæœ¬åœ°çº¿ç¨‹ä¹Ÿä¼šå›æ”¶ï¼Œä½†å¦‚æœå‡ºç°äº†å¼‚å¸¸ï¼Œæœ¬åœ°çº¿ç¨‹ä¼šè€ƒè™‘JVMæ˜¯å¦ç»ˆæ­¢ï¼ˆæ˜¯å¦å…¨ä¸ºå®ˆæŠ¤çº¿ç¨‹ï¼‰ã€‚</p>
</li>
</ol>
<h4 id="è¯´æ˜äºŒï¼š"><a href="#è¯´æ˜äºŒï¼š" class="headerlink" title="è¯´æ˜äºŒï¼š"></a>è¯´æ˜äºŒï¼š</h4><p>å¦‚æœä½ ä½¿ç”¨ jconsole æˆ–è€…æ˜¯ä»»ä½•ä¸€ä¸ªè°ƒè¯•å·¥å…·ï¼Œéƒ½èƒ½çœ‹åˆ°åœ¨åå°æœ‰è®¸å¤šçº¿ç¨‹åœ¨è¿è¡Œã€‚è¿™äº›åå°çº¿ç¨‹ä¸åŒ…æ‹¬è°ƒç”¨ public static void main(String [ ])çš„ main çº¿ç¨‹ä»¥åŠæ‰€æœ‰è¿™ä¸ª main çº¿ç¨‹è‡ªå·±åˆ›å»ºçš„çº¿ç¨‹ã€‚è¿™äº›ä¸»è¦çš„åå°ç³»ç»Ÿçº¿ç¨‹åœ¨Hotspot JVMé‡Œä¸»è¦æ˜¯ä»¥ä¸‹å‡ ç±»ï¼š</p>
<ol>
<li><p><strong>è™šæ‹Ÿæœºçº¿ç¨‹</strong>ï¸°è¿™ç§çº¿ç¨‹çš„æ“ä½œæ˜¯éœ€è¦ JVM è¾¾åˆ°&#x3D;&#x3D;å®‰å…¨ç‚¹&#x3D;&#x3D;æ‰ä¼šå‡ºç°ã€‚è¿™äº›æ“ä½œå¿…é¡»åœ¨ä¸åŒçš„çº¿ç¨‹ä¸­å‘ç”Ÿçš„åŸå› æ˜¯å®ƒä»¬éƒ½éœ€è¦JVMè¾¾åˆ°å®‰å…¨ç‚¹ï¼Œè¿™æ ·å †æ‰ä¸ä¼šå˜åŒ–ã€‚</p>
<p>è¿™ç§çº¿ç¨‹çš„æ‰§è¡Œç±»å‹åŒ…æ‹¬ â€œstop-the-worldâ€ çš„åƒåœ¾æ”¶é›†ï¼Œçº¿ç¨‹æ ˆæ”¶é›†ï¼Œçº¿ç¨‹æŒ‚èµ·ä»¥åŠåå‘é”æ’¤é”€ã€‚</p>
</li>
<li><p><strong>å‘¨æœŸä»»åŠ¡çº¿ç¨‹</strong>ï¼šè¿™ç§çº¿ç¨‹æ˜¯æ—¶é—´å‘¨æœŸäº‹ä»¶çš„ä½“ç°(æ¯”å¦‚ä¸­æ–­)ï¼Œä»–ä»¬ä¸€èˆ¬ç”¨äºå‘¨æœŸæ€§æ“ä½œçš„è°ƒåº¦æ‰§è¡Œã€‚</p>
</li>
<li><p><strong>GCçº¿ç¨‹</strong>ï¼šè¿™ç§çº¿ç¨‹å¯¹åœ¨JVMé‡Œä¸åŒç§ç±»çš„åƒåœ¾æ”¶é›†è¡Œä¸ºæä¾›äº†æ”¯æŒã€‚</p>
</li>
<li><p><strong>ç¼–è¯‘çº¿ç¨‹</strong>ï¼šè¿™ç§çº¿ç¨‹åœ¨è¿è¡Œæ—¶ä¼šå°†å­—èŠ‚ç ç¼–è¯‘æˆåˆ°æœ¬åœ°ä»£ç ã€‚</p>
</li>
<li><p><strong>ä¿¡å·è°ƒåº¦çº¿ç¨‹</strong>ï¼šè¿™ç§çº¿ç¨‹æ¥æ”¶ä¿¡å·å¹¶å‘é€ç»™JVMï¼Œåœ¨å®ƒå†…éƒ¨é€šè¿‡è°ƒç”¨é€‚å½“çš„æ–¹æ³•è¿›è¡Œå¤„ç†ã€‚</p>
</li>
</ol>
<h3 id="ç¨‹åºè®¡æ•°å™¨"><a href="#ç¨‹åºè®¡æ•°å™¨" class="headerlink" title="ç¨‹åºè®¡æ•°å™¨"></a>ç¨‹åºè®¡æ•°å™¨</h3><p>Oracleçš„ä»‹ç»ï¼š<a href="https://docs.oracle.com/en/java/javase/19/">https://docs.oracle.com/en/java/javase/19/</a></p>
<h4 id="PC-Register-ä»‹ç»"><a href="#PC-Register-ä»‹ç»" class="headerlink" title="PC Register ä»‹ç»"></a>PC Register ä»‹ç»</h4><p>JVMä¸­çš„ç¨‹åºè®¡æ•°å¯„å­˜å™¨(Program counter Register)ä¸­ï¼ŒRegister çš„å‘½åæºäºCPUçš„å¯„å­˜å™¨ï¼Œå¯„å­˜å™¨å­˜å‚¨æŒ‡ä»¤ç›¸å…³çš„ç°åœºä¿¡æ¯ã€‚CPUåªæœ‰æŠŠæ•°æ®è£…è½½åˆ°å¯„å­˜å™¨æ‰èƒ½å¤Ÿè¿è¡Œã€‚</p>
<p>è¿™é‡Œï¼Œå¹¶éæ˜¯å¹¿ä¹‰ä¸Šæ‰€æŒ‡çš„ç‰©ç†å¯„å­˜å™¨ï¼Œæˆ–è®¸å°†å…¶ç¿»è¯‘ä¸ºPCè®¡æ•°å™¨ï¼ˆæˆ–æŒ‡ä»¤è®¡æ•°å™¨ï¼‰ä¼šæ›´åŠ è´´åˆ‡(ä¹Ÿç§°ä¸ºç¨‹åºé’©å­)ï¼Œå¹¶ä¸”ä¹Ÿä¸å®¹æ˜“å¼•èµ·ä¸€äº›ä¸å¿…è¦çš„è¯¯ä¼šã€‚</p>
<p>&#x3D;&#x3D;JVMä¸­çš„PCå¯„å­˜å™¨æ˜¯å¯¹ç‰©ç†PCå¯„å­˜å™¨çš„ä¸€ç§æŠ½è±¡æ¨¡æ‹Ÿã€‚ï¼ˆè½¯ä»¶å±‚é¢ï¼‰&#x3D;&#x3D;</p>
<h4 id="PC-Register-ä½œç”¨"><a href="#PC-Register-ä½œç”¨" class="headerlink" title="PC Register ä½œç”¨"></a>PC Register ä½œç”¨</h4><p><strong>PCå¯„å­˜å™¨ç”¨æ¥å­˜å‚¨æŒ‡å‘ä¸‹ä¸€æ¡æŒ‡ä»¤çš„åœ°å€ï¼Œä¹Ÿå³å°†è¦æ‰§è¡Œçš„æŒ‡ä»¤ä»£ç ã€‚ç”±æ‰§è¡Œå¼•æ“è¯»å–ä¸‹ä¸€æ¡æŒ‡ä»¤ã€‚</strong></p>
<p><img src="/images/PC%E5%AF%84%E5%AD%98%E5%99%A8.png" alt="PCå¯„å­˜å™¨.png"></p>
<h4 id="PCå¯„å­˜å™¨çš„æ¦‚è¿°"><a href="#PCå¯„å­˜å™¨çš„æ¦‚è¿°" class="headerlink" title="PCå¯„å­˜å™¨çš„æ¦‚è¿°"></a>PCå¯„å­˜å™¨çš„æ¦‚è¿°</h4><ol>
<li><p><strong>å®ƒæ˜¯ä¸€å—å¾ˆå°çš„å†…å­˜ç©ºé—´ï¼Œå‡ ä¹å¯ä»¥å¿½ç•¥ä¸è®°ã€‚ä¹Ÿæ˜¯è¿è¡Œé€Ÿåº¦æœ€å¿«çš„å­˜å‚¨åŒºåŸŸã€‚åœ¨JVMè§„èŒƒä¸­ï¼Œæ¯ä¸ªçº¿ç¨‹éƒ½æœ‰å®ƒè‡ªå·±çš„ç¨‹åºè®¡æ•°å™¨ï¼Œæ˜¯çº¿ç¨‹ç§æœ‰çš„ï¼Œç”Ÿå‘½å‘¨æœŸä¸çº¿ç¨‹çš„ç”Ÿå‘½å‘¨æœŸä¿æŒä¸€è‡´ã€‚</strong></p>
</li>
<li><p><strong>ä»»ä½•æ—¶é—´ä¸€ä¸ªçº¿ç¨‹éƒ½åªæœ‰ä¸€ä¸ªæ–¹æ³•åœ¨æ‰§è¡Œï¼Œä¹Ÿå°±æ˜¯æ‰€è°“çš„å½“å‰æ–¹æ³•ã€‚ç¨‹åºè®¡æ•°å™¨ä¼šå­˜å‚¨å½“å‰çº¿ç¨‹æ­£åœ¨æ‰§è¡Œçš„Javaæ–¹æ³•çš„JVMæŒ‡ä»¤åœ°å€ï¼›æˆ–è€…ï¼Œå¦‚æœæ˜¯åœ¨æ‰§è¡Œnativeæ–¹æ³•(C&#x2F;C++)ï¼Œåˆ™æ˜¯æœªæŒ‡å®šå€¼ï¼ˆundefned) ã€‚</strong></p>
</li>
<li><p><strong>å®ƒæ˜¯ç¨‹åºæ§åˆ¶æµçš„æŒ‡ç¤ºå™¨ï¼Œåˆ†æ”¯ã€å¾ªç¯ã€è·³è½¬ã€å¼‚å¸¸å¤„ç†ã€çº¿ç¨‹æ¢å¤ç­‰åŸºç¡€åŠŸèƒ½éƒ½éœ€è¦ä¾èµ–è¿™ä¸ªè®¡æ•°å™¨æ¥å®Œæˆã€‚</strong></p>
</li>
<li><p><strong>å­—èŠ‚ç è§£é‡Šå™¨å·¥ä½œæ—¶å°±æ˜¯é€šè¿‡æ”¹å˜è¿™ä¸ªè®¡æ•°å™¨çš„å€¼æ¥é€‰å–ä¸‹ä¸€æ¡éœ€è¦æ‰§è¡Œçš„å­—èŠ‚ç æŒ‡ä»¤ã€‚</strong></p>
</li>
<li><p><strong>å®ƒæ˜¯å”¯ä¸€ä¸€ä¸ªåœ¨Javaè™šæ‹Ÿæœºè§„èŒƒä¸­æ²¡æœ‰è§„å®šä»»ä½• outOtMemoryError æƒ…å†µçš„åŒºåŸŸã€‚</strong></p>
</li>
</ol>
<ul>
<li><p><strong>å¯¹äºå †å’Œæ–¹æ³•åŒºï¼Œæœ‰GCå›æ”¶</strong></p>
</li>
<li><p><strong>å¯¹äºå †ã€æ–¹æ³•åŒºã€æ ˆï¼ˆè™šæ‹Ÿæœºæ ˆã€æœ¬åœ°æ–¹æ³•æ ˆæ²¡æœ‰GCï¼‰ï¼Œä¼šæœ‰OOM</strong></p>
</li>
<li><p><strong>ä½†PCå¯„å­˜å™¨ä¸ä¼šæœ‰GCå’ŒOOM</strong></p>
</li>
</ul>
<h4 id="PCå¯„å­˜å™¨çš„ä¸¤ä¸ªé—®é¢˜"><a href="#PCå¯„å­˜å™¨çš„ä¸¤ä¸ªé—®é¢˜" class="headerlink" title="PCå¯„å­˜å™¨çš„ä¸¤ä¸ªé—®é¢˜"></a>PCå¯„å­˜å™¨çš„ä¸¤ä¸ªé—®é¢˜</h4><ol>
<li><p>ä½¿ç”¨PCå¯„å­˜å™¨å­˜å‚¨å­—èŠ‚ç æŒ‡ä»¤åœ°å€çš„ä½œç”¨</p>
<p>ä¸ºä»€ä¹ˆä½¿ç”¨PCå¯„å­˜å™¨è®°å½•å½“å‰çº¿ç¨‹çš„æ‰§è¡Œåœ°å€å‘¢ï¼Ÿ</p>
<p>å› ä¸ºCPUéœ€è¦ä¸åœçš„åˆ‡æ¢å„ä¸ªçº¿ç¨‹ï¼Œè¿™æ—¶å€™åˆ‡æ¢å›æ¥ä»¥åï¼Œå°±å¾—çŸ¥é“æ¥ç€ä»å“ªå¼€å§‹ç»§ç»­æ‰§è¡Œã€‚JVMçš„å­—èŠ‚ç è§£é‡Šå™¨å°±éœ€è¦é€šè¿‡æ”¹å˜PCå¯„å­˜å™¨çš„å€¼æ¥æ˜ç¡®ä¸‹ä¸€æ¡åº”è¯¥æ‰§è¡Œä»€ä¹ˆæ ·çš„å­—èŠ‚ç æŒ‡ä»¤ã€‚</p>
</li>
<li><p>PCå¯„å­˜å™¨ä¸ºä»€ä¹ˆä¼šè¢«è®¾å®šä¸ºçº¿ç¨‹ç§æœ‰?</p>
<p>ï¼ˆè‚¯å®šä¸èƒ½å…±äº«ï¼‰æ‰€è°“çš„å¤šçº¿ç¨‹åœ¨ä¸€ä¸ªç‰¹å®šçš„æ—¶é—´æ®µå†…åªä¼šæ‰§è¡Œå…¶ä¸­æŸä¸€ä¸ªçº¿ç¨‹çš„æ–¹æ³•ï¼ŒCPUä¼šä¸åœåœ°åšä»»åŠ¡åˆ‡æ¢ï¼Œè¿™æ ·å¿…ç„¶å¯¼è‡´ç»å¸¸ä¸­æ–­æˆ–æ¢å¤ï¼Œå¦‚ä½•ä¿è¯åˆ†æ¯«æ— å·®å‘¢ï¹–</p>
<ul>
<li><p>ä¸ºäº†èƒ½å¤šå‡†ç¡®åœ°è®°å½•å„ä¸ªçº¿ç¨‹æ­£åœ¨æ‰§è¡Œçš„å½“å‰å­—èŠ‚ç æŒ‡ä»¤åœ°å€ï¼Œæœ€å¥½çš„åŠæ³•è‡ªç„¶æ˜¯ä¸ºæ¯ä¸€ä¸ªçº¿ç¨‹éƒ½åˆ†é…ä¸€ä¸ªPCå¯„å­˜å™¨ï¼Œè¿™æ ·ä¸€æ¥å„ä¸ªçº¿ç¨‹ä¹‹é—´ä¾¿å¯ä»¥è¿›è¡Œç‹¬ç«‹è®¡ç®—ï¼Œä»è€Œä¸ä¼šå‡ºç°ç›¸äº’å¹²æ‰°çš„æƒ…å†µã€‚</p>
</li>
<li><p>ç”±äºCPUæ—¶é—´ç‰‡è½®é™åˆ¶ï¼Œä¼—å¤šçº¿ç¨‹åœ¨å¹¶å‘æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œä»»ä½•ä¸€ä¸ªç¡®å®šçš„æ—¶åˆ»ï¼Œä¸€ä¸ªå¤„ç†å™¨æˆ–è€…å¤šæ ¸å¤„ç†å™¨ä¸­çš„ä¸€ä¸ªå†…æ ¸ï¼Œåªä¼šæ‰§è¡ŒæŸä¸ªçº¿ç¨‹ä¸­çš„ä¸€æ¡æŒ‡ä»¤ã€‚</p>
</li>
<li><p>æ¯ä¸ªçº¿ç¨‹åœ¨åˆ›å»ºåï¼Œéƒ½ä¼šäº§ç”Ÿè‡ªå·±çš„ç¨‹åºè®¡æ•°å™¨å’Œæ ˆå¸§ï¼Œç¨‹åºè®¡æ•°å™¨åœ¨å„ä¸ªçº¿ç¨‹ä¹‹é—´äº’ä¸å½±å“ã€‚</p>
<p>CPUæ—¶é—´ç‰‡ï¼šå³CPUåˆ†é…ç»™å„ä¸ªç¨‹åºçš„æ—¶é—´ï¼Œæ¯ä¸ªçº¿ç¨‹è¢«åˆ†é…ä¸€ä¸ªæ—¶é—´æ®µï¼Œç§°ä½œå®ƒçš„æ—¶é—´ç‰‡ã€‚</p>
</li>
</ul>
</li>
</ol>
<h2 id="è™šæ‹Ÿæœºæ ˆ"><a href="#è™šæ‹Ÿæœºæ ˆ" class="headerlink" title="è™šæ‹Ÿæœºæ ˆ"></a>è™šæ‹Ÿæœºæ ˆ</h2><h3 id="è™šæ‹Ÿæœºæ ˆçš„æ¦‚è¿°"><a href="#è™šæ‹Ÿæœºæ ˆçš„æ¦‚è¿°" class="headerlink" title="è™šæ‹Ÿæœºæ ˆçš„æ¦‚è¿°"></a>è™šæ‹Ÿæœºæ ˆçš„æ¦‚è¿°</h3><h4 id="è™šæ‹Ÿæœºæ ˆå‡ºç°çš„èƒŒæ™¯"><a href="#è™šæ‹Ÿæœºæ ˆå‡ºç°çš„èƒŒæ™¯" class="headerlink" title="è™šæ‹Ÿæœºæ ˆå‡ºç°çš„èƒŒæ™¯"></a>è™šæ‹Ÿæœºæ ˆå‡ºç°çš„èƒŒæ™¯</h4><p>&#x3D;&#x3D;ç”±äºè·¨å¹³å°æ€§çš„è®¾è®¡ï¼ŒJavaçš„æŒ‡ä»¤éƒ½æ˜¯æ ¹æ®æ ˆæ¥è®¾è®¡çš„ã€‚ä¸åŒå¹³å°CPUæ¶æ„ä¸åŒï¼Œæ‰€ä»¥ä¸èƒ½è®¾è®¡ä¸ºåŸºäºå¯„å­˜å™¨çš„ã€‚&#x3D;&#x3D;</p>
<p>&#x3D;&#x3D;ä¼˜ç‚¹æ˜¯è·¨å¹³å°ï¼ŒæŒ‡ä»¤é›†å°ï¼Œç¼–è¯‘å™¨å®¹æ˜“å®ç°ï¼Œç¼ºç‚¹æ˜¯æ€§èƒ½ä¸‹é™ï¼Œå®ç°åŒæ ·çš„åŠŸèƒ½éœ€è¦æ›´å¤šçš„æŒ‡ä»¤ã€‚&#x3D;&#x3D;</p>
<p><strong>æ ˆæ˜¯è¿è¡Œæ—¶çš„å•ä½ï¼Œè€Œå †æ˜¯å­˜å‚¨çš„å•ä½ã€‚</strong></p>
<p>å³ï¼šæ ˆè§£å†³ç¨‹åºçš„è¿è¡Œé—®é¢˜ï¼Œå³ç¨‹åºå¦‚ä½•æ‰§è¡Œï¼Œæˆ–è€…è¯´å¦‚ä½•å¤„ç†æ•°æ®ã€‚å †è§£å†³çš„æ˜¯æ•°æ®å­˜å‚¨çš„é—®é¢˜ï¼Œå³æ•°æ®æ€ä¹ˆæ”¾ã€æ”¾åœ¨å“ªå„¿ã€‚</p>
<h4 id="Javaè™šæ‹Ÿæœºæ ˆä»‹ç»"><a href="#Javaè™šæ‹Ÿæœºæ ˆä»‹ç»" class="headerlink" title="Javaè™šæ‹Ÿæœºæ ˆä»‹ç»"></a>Javaè™šæ‹Ÿæœºæ ˆä»‹ç»</h4><ol>
<li><p>Javaè™šæ‹Ÿæœºæ ˆæ˜¯ä»€ä¹ˆ</p>
<ul>
<li><p>Javaè™šæ‹Ÿæœºæ ˆï¼ˆJava virtual Machine stack)ï¼Œæ—©æœŸä¹Ÿå« Java æ ˆã€‚æ¯ä¸ªçº¿ç¨‹åœ¨åˆ›å»ºæ—¶éƒ½ä¼šåˆ›å»ºä¸€ä¸ªè™šæ‹Ÿæœºæ ˆï¼Œå…¶å†…éƒ¨ä¿å­˜æ¯ä¸€ä¸ªæ ˆå¸§ï¼ˆStack Frameï¼‰ï¼Œå¯¹åº”ç€æ¯ä¸€æ¬¡çš„ Javaæ–¹æ³•è°ƒç”¨ã€‚</p>
</li>
<li><p>æ˜¯çº¿ç¨‹ç§æœ‰çš„</p>
</li>
</ul>
</li>
<li><p>ç”Ÿå‘½å‘¨æœŸ</p>
<p>ç”Ÿå‘½å‘¨æœŸå’Œçº¿ç¨‹ä¸€è‡´ã€‚</p>
</li>
<li><p>ä½œç”¨</p>
<p>ä¸»è¦è´Ÿè´£ Java ç¨‹åºçš„è¿è¡Œï¼Œå®ƒä¿å­˜æ–¹æ³•çš„å±€éƒ¨å˜é‡ï¼ˆ8ç§åŸºæœ¬çš„æ•°æ®ç±»å‹å’Œå¯¹è±¡å¼•ç”¨åœ°å€ï¼‰ã€éƒ¨åˆ†ç»“æœï¼Œå¹¶å‚ä¸æ–¹æ³•çš„è°ƒç”¨å’Œè¿”å›ã€‚</p>
</li>
</ol>
<h4 id="æ ˆçš„ä¼˜ç‚¹"><a href="#æ ˆçš„ä¼˜ç‚¹" class="headerlink" title="æ ˆçš„ä¼˜ç‚¹"></a>æ ˆçš„ä¼˜ç‚¹</h4><ol>
<li><p><strong>æ ˆæ˜¯ä¸€ç§å¿«é€Ÿæœ‰æ•ˆçš„åˆ†é…å­˜å‚¨æ–¹å¼ï¼Œè®¿é—®é€Ÿåº¦ä»…æ¬¡äºç¨‹åºè®¡æ•°å™¨ã€‚</strong></p>
</li>
<li><p>JVMç›´æ¥å¯¹ Java æ ˆçš„æ“ä½œåªæœ‰ä¸¤ä¸ªï¼š</p>
<p>æ¯ä¸ªæ–¹æ³•æ‰§è¡Œï¼Œä¼´éšç€è¿›æ ˆï¼ˆå…¥æ ˆã€å‹æ ˆï¼‰ã€æ‰§è¡Œç»“æŸåçš„å‡ºæ ˆå·¥ä½œ</p>
</li>
<li><p>å¯¹äºæ ˆæ¥è¯´ä¸å­˜åœ¨åƒåœ¾å›æ”¶é—®é¢˜</p>
</li>
</ol>
<h4 id="æ ˆä¸­å¯èƒ½å‡ºç°çš„å¼‚å¸¸"><a href="#æ ˆä¸­å¯èƒ½å‡ºç°çš„å¼‚å¸¸" class="headerlink" title="æ ˆä¸­å¯èƒ½å‡ºç°çš„å¼‚å¸¸"></a>æ ˆä¸­å¯èƒ½å‡ºç°çš„å¼‚å¸¸</h4><ul>
<li><p>Java è™šæ‹Ÿæœºè§„èŒƒå…è®¸ Java æ ˆçš„å¤§å°æ˜¯åŠ¨æ€çš„æˆ–è€…æ˜¯å›ºå®šä¸å˜çš„ã€‚</p>
</li>
<li><p>å¦‚æœé‡‡ç”¨å›ºå®šå¤§å°çš„ Java è™šæ‹Ÿæœºæ ˆï¼Œé‚£æ¯ä¸€ä¸ªçº¿ç¨‹çš„ Java è™šæ‹Ÿæœºæ ˆå®¹é‡å¯ä»¥åœ¨çº¿ç¨‹åˆ›å»ºçš„æ—¶å€™ç‹¬ç«‹é€‰å®šã€‚å¦‚æœçº¿ç¨‹è¯·æ±‚åˆ†é…çš„æ ˆå®¹é‡è¶…è¿‡ Java è™šæ‹Ÿæœºæ ˆå…è®¸çš„æœ€å¤§å®¹é‡ï¼ŒJava è™šæ‹Ÿæœºå°†ä¼šæŠ›å‡ºä¸€ä¸ª StackOverflowError å¼‚å¸¸ã€‚</p>
</li>
<li><p>å¦‚æœ Java è™šæ‹Ÿæœºæ ˆå¯ä»¥åŠ¨æ€æ‰©å±•ï¼Œå¹¶ä¸”åœ¨å°è¯•æ‰©å±•çš„æ—¶å€™æ— æ³•ç”³è¯·åˆ°è¶³å¤Ÿçš„å†…å­˜ï¼Œæˆ–è€…åœ¨åˆ›å»ºæ–°çš„çº¿ç¨‹æ—¶æ²¡æœ‰è¶³å¤Ÿçš„å†…å­˜å»åˆ›å»ºå¯¹åº”çš„è™šæ‹Ÿæœºæ ˆï¼Œé‚£ Java è™šæ‹Ÿæœºå°†ä¼šæŠ›å‡ºä¸€ä¸ª OutofMemoryError å¼‚å¸¸ã€‚</p>
</li>
</ul>
<h4 id="è®¾ç½®æ ˆå†…å­˜å¤§å°"><a href="#è®¾ç½®æ ˆå†…å­˜å¤§å°" class="headerlink" title="è®¾ç½®æ ˆå†…å­˜å¤§å°"></a>è®¾ç½®æ ˆå†…å­˜å¤§å°</h4><p>å¯ä»¥ä½¿ç”¨å‚æ•° -Xss é€‰é¡¹æ¥è®¾ç½®çº¿ç¨‹çš„æœ€å¤§æ ˆç©ºé—´ï¼Œæ ˆçš„å¤§å°ç›´æ¥å†³å®šäº†å‡½æ•°è°ƒç”¨çš„æœ€å¤§å¯è¾¾æ·±åº¦ã€‚</p>
<p><a href="https://docs.oracle.com/en/java/javase/11/tools/java.html#GUID-3B1CE181-CD30-4178-9602-230B800D4FAE">https://docs.oracle.com/en/java/javase/11/tools/java.html#GUID-3B1CE181-CD30-4178-9602-230B800D4FAE</a></p>
<blockquote>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">-Xss size</span><br></pre></td></tr></table></figure>

<p>Sets the thread stack size (in bytes). Append the letter <code>k</code> or <code>K</code> to indicate KB, <code>m</code> or <code>M</code> to indicate MB, and <code>g</code> or <code>G</code> to indicate GB. The default value depends on the platform:</p>
<ul>
<li>Linux&#x2F;x64 (64-bit): 1024 KB</li>
<li>macOS (64-bit): 1024 KB</li>
<li>Oracle Solaris&#x2F;x64 (64-bit): 1024 KB</li>
<li>Windows: The default value depends on virtual memory</li>
</ul>
<p>The following examples set the thread stack size to 1024 KB in different units:</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Copy-Xss1m</span><br><span class="line">-Xss1024k</span><br><span class="line">-Xss1048576</span><br></pre></td></tr></table></figure>
</blockquote>
<h3 id="æ ˆçš„å­˜å‚¨ç»“æ„å’Œè¿è¡ŒåŸç†"><a href="#æ ˆçš„å­˜å‚¨ç»“æ„å’Œè¿è¡ŒåŸç†" class="headerlink" title="æ ˆçš„å­˜å‚¨ç»“æ„å’Œè¿è¡ŒåŸç†"></a>æ ˆçš„å­˜å‚¨ç»“æ„å’Œè¿è¡ŒåŸç†</h3><h4 id="æ ˆä¸­å­˜å‚¨ä»€ä¹ˆï¼Ÿ"><a href="#æ ˆä¸­å­˜å‚¨ä»€ä¹ˆï¼Ÿ" class="headerlink" title="æ ˆä¸­å­˜å‚¨ä»€ä¹ˆï¼Ÿ"></a>æ ˆä¸­å­˜å‚¨ä»€ä¹ˆï¼Ÿ</h4><ol>
<li><p>æ¯ä¸ªçº¿ç¨‹éƒ½æœ‰è‡ªå·±çš„æ ˆï¼Œæ ˆä¸­çš„æ•°æ®éƒ½æ˜¯ä»¥æ ˆå¸§(stack Frameï¼‰çš„æ ¼å¼å­˜åœ¨ã€‚</p>
</li>
<li><p>åœ¨è¿™ä¸ªçº¿ç¨‹ä¸Šæ­£åœ¨æ‰§è¡Œçš„æ¯ä¸ªæ–¹æ³•éƒ½å„è‡ªå¯¹åº”ä¸€ä¸ªæ ˆå¸§(stack Frameï¼‰ã€‚</p>
</li>
<li><p>æ ˆå¸§æ˜¯ä¸€ä¸ªå†…å­˜åŒºå—ï¼Œæ˜¯ä¸€ä¸ªæ•°æ®é›†ï¼Œç»´ç³»ç€æ–¹æ³•æ‰§è¡Œè¿‡ç¨‹ä¸­çš„å„ç§æ•°æ®ä¿¡æ¯ã€‚</p>
</li>
</ol>
<h4 id="æ ˆçš„è¿è¡ŒåŸç†"><a href="#æ ˆçš„è¿è¡ŒåŸç†" class="headerlink" title="æ ˆçš„è¿è¡ŒåŸç†"></a>æ ˆçš„è¿è¡ŒåŸç†</h4><ol>
<li><p>JVMç›´æ¥å¯¹Javaæ ˆçš„æ“ä½œåªæœ‰ä¸¤ä¸ªï¼Œå°±æ˜¯å¯¹æ ˆå¸§çš„å‹æ ˆå’Œå‡ºæ ˆï¼Œéµå¾ªâ€å…ˆè¿›åå‡ºâ€æˆ–â€åè¿›å…ˆå‡ºâ€åŸåˆ™ã€‚</p>
</li>
<li><p>åœ¨ä¸€æ¡æ´»åŠ¨çº¿ç¨‹ä¸­ï¼Œä¸€ä¸ªæ—¶é—´ç‚¹ä¸Šï¼Œåªä¼šæœ‰ä¸€ä¸ªæ´»åŠ¨çš„æ ˆå¸§ã€‚å³åªæœ‰å½“å‰æ­£åœ¨æ‰§è¡Œçš„æ–¹æ³•çš„æ ˆå¸§ï¼ˆæ ˆé¡¶æ ˆå¸§ï¼‰æ˜¯æœ‰æ•ˆçš„ï¼Œè¿™ä¸ªæ ˆå¸§è¢«ç§°ä¸ºå½“å‰æ ˆå¸§(Current Frame)ï¼Œä¸å½“å‰æ ˆå¸§ç›¸å¯¹åº”çš„æ–¹æ³•å°±æ˜¯å½“å‰æ–¹æ³•(currentMethod)ï¼Œå®šä¹‰è¿™ä¸ªæ–¹æ³•çš„ç±»å°±æ˜¯å½“å‰ç±»(current class)ã€‚</p>
</li>
<li><p>æ‰§è¡Œå¼•æ“è¿è¡Œçš„æ‰€æœ‰å­—èŠ‚ç æŒ‡ä»¤åªé’ˆå¯¹å½“å‰æ ˆå¸§è¿›è¡Œæ“ä½œã€‚</p>
</li>
<li><p>å¦‚æœåœ¨è¯¥æ–¹æ³•ä¸­è°ƒç”¨äº†å…¶ä»–æ–¹æ³•ï¼Œå¯¹åº”çš„æ–°çš„æ ˆå¸§ä¼šè¢«åˆ›å»ºå‡ºæ¥ï¼Œæ”¾åœ¨æ ˆçš„é¡¶ç«¯ï¼Œæˆä¸ºæ–°çš„å½“å‰å¸§ã€‚</p>
</li>
<li><p>ä¸åŒçº¿ç¨‹ä¸­æ‰€åŒ…å«çš„æ ˆå¸§æ˜¯ä¸å…è®¸å­˜åœ¨ç›¸äº’å¼•ç”¨çš„ï¼Œå³ä¸å¯èƒ½åœ¨ä¸€ä¸ªæ ˆå¸§ä¹‹ä¸­å¼•ç”²å¦å¤–ä¸€ä¸ªçº¿ç¨‹çš„æ ˆå¸§ã€‚</p>
</li>
<li><p>å¦‚æœå½“å‰æ–¹æ³•è°ƒç”¨äº†å…¶ä»–æ–¹æ³•ï¼Œæ–¹æ³•è¿”å›ä¹‹é™…ï¼Œå½“å‰æ ˆå¸§ä¼šä¼ å›æ­¤æ–¹æ³•çš„æ‰§è¡Œç»“æœç»™å‰ä¸€ä¸ªæ ˆå¸§ï¼Œæ¥ç€ï¼Œè™šæ‹Ÿæœºä¼šä¸¢å¼ƒå½“å‰æ ˆå¸§ï¼Œä½¿å¾—å‰ä¸€ä¸ªæ ˆå¸§é‡æ–°æˆä¸ºå½“å‰æ ˆå¸§ã€‚</p>
</li>
<li><p>Javaæ–¹æ³•æœ‰ä¸¤ç§è¿”å›å‡½æ•°çš„æ–¹å¼ï¼Œä¸€ç§æ˜¯æ­£å¸¸çš„å‡½æ•°è¿”å›ï¼Œä½¿ç”¨returnæŒ‡ä»¤ï¼›å¦å¤–ä¸€ç§æ˜¯æŠ›å‡ºå¼‚å¸¸ï¼ˆç”±ä¸Šä¸€ä¸ªæ ˆå¸§å¯¹åº”çš„æ–¹æ³•è¿›è¡Œå¤„ç†ï¼Œå¦åˆ™ç»§ç»­æŠ›å‡ºï¼‰ã€‚ä¸ç®¡ä½¿ç”¨å“ªç§æ–¹å¼ï¼Œéƒ½ä¼šå¯¼è‡´æ ˆå¸§è¢«å¼¹å‡ºã€‚</p>
</li>
</ol>
<h4 id="æ ˆå¸§çš„å†…éƒ¨ç»“æ„"><a href="#æ ˆå¸§çš„å†…éƒ¨ç»“æ„" class="headerlink" title="æ ˆå¸§çš„å†…éƒ¨ç»“æ„"></a>æ ˆå¸§çš„å†…éƒ¨ç»“æ„</h4><p>æ¯ä¸ªæ ˆå¸§ä¸­å­˜å‚¨ç€ï¼šï¼ˆå±€éƒ¨å˜é‡è¡¨å’Œæ“ä½œæ•°æ ˆä¸»è¦å½±å“æ ˆå¸§çš„å¤§å°ï¼‰</p>
<ol>
<li><p>å±€éƒ¨å˜é‡è¡¨ï¼ˆLocal variables)</p>
</li>
<li><p>æ“ä½œæ•°æ ˆï¼ˆoperand stack)(æˆ–è¡¨è¾¾å¼æ ˆ)</p>
</li>
<li><p>åŠ¨æ€é“¾æ¥(Dynamic Linking)(æˆ–æŒ‡å‘è¿è¡Œæ—¶å¸¸é‡æ± çš„æ–¹æ³•å¼•ç”¨)</p>
</li>
<li><p>æ–¹æ³•è¿”å›åœ°å€ï¼ˆReturn Addressï¼‰(æˆ–æ–¹æ³•æ­£å¸¸é€€å‡ºæˆ–è€…å¼‚å¸¸é€€å‡ºçš„å®šä¹‰)</p>
</li>
<li><p>ä¸€äº›é™„åŠ ä¿¡æ¯</p>
</li>
</ol>
<h3 id="å±€éƒ¨å˜é‡è¡¨"><a href="#å±€éƒ¨å˜é‡è¡¨" class="headerlink" title="å±€éƒ¨å˜é‡è¡¨"></a>å±€éƒ¨å˜é‡è¡¨</h3><h4 id="å‡ ç‚¹è¯´æ˜"><a href="#å‡ ç‚¹è¯´æ˜" class="headerlink" title="å‡ ç‚¹è¯´æ˜"></a>å‡ ç‚¹è¯´æ˜</h4><ol>
<li><p>å±€éƒ¨å˜é‡è¡¨ä¹Ÿè¢«ç§°ä¹‹ä¸º<strong>å±€éƒ¨å˜é‡æ•°ç»„</strong>æˆ–æœ¬åœ°å˜é‡è¡¨ã€‚</p>
</li>
<li><p>å®šä¹‰ä¸ºä¸€ä¸ªæ•°å­—æ•°ç»„ï¼Œä¸»è¦ç”¨äºå­˜å‚¨æ–¹æ³•å‚æ•°å’Œå®šä¹‰åœ¨æ–¹æ³•ä½“å†…çš„å±€éƒ¨å˜é‡è¿™äº›æ•°æ®ç±»å‹åŒ…æ‹¬å„ç±»åŸºæœ¬æ•°æ®ç±»å‹ã€å¯¹è±¡å¼•ç”¨ï¼ˆreference)ï¼Œä»¥åŠreturnAddressç±»å‹ã€‚</p>
</li>
<li><p>ç”±äºå±€éƒ¨å˜é‡è¡¨æ˜¯å»ºç«‹åœ¨çº¿ç¨‹çš„æ ˆä¸Šï¼Œæ˜¯çº¿ç¨‹çš„ç§æœ‰æ•°æ®ï¼Œå› æ­¤ä¸å­˜åœ¨æ•°æ®å®‰å…¨é—®é¢˜ã€‚</p>
</li>
<li><p><strong>å±€éƒ¨å˜é‡è¡¨æ‰€éœ€çš„å®¹é‡å¤§å°æ˜¯åœ¨ç¼–è¯‘æœŸç¡®å®šä¸‹æ¥çš„</strong>ï¼Œå¹¶ä¿å­˜åœ¨æ–¹æ³•çš„Codeå±æ€§çš„maximum local variablesæ•°æ®é¡¹ä¸­ã€‚åœ¨æ–¹æ³•è¿è¡ŒæœŸé—´æ˜¯ä¸ä¼šæ”¹å˜å±€éƒ¨å˜é‡è¡¨çš„å¤§å°çš„ã€‚</p>
</li>
<li><p>æ–¹æ³•åµŒå¥—è°ƒç”¨çš„æ¬¡æ•°ç”±æ ˆçš„å¤§å°å†³å®šã€‚ä¸€èˆ¬æ¥è¯´ï¼Œæ ˆè¶Šå¤§ï¼Œæ–¹æ³•åµŒå¥—è°ƒç”¨æ¬¡æ•°è¶Šå¤šã€‚å¯¹ä¸€ä¸ªå‡½æ•°è€Œè¨€ï¼Œå®ƒçš„å‚æ•°å’Œå±€éƒ¨å˜é‡è¶Šå¤šï¼Œä½¿å¾—å±€éƒ¨å˜é‡è¡¨è†¨èƒ€ï¼Œå®ƒçš„æ ˆå¸§å°±è¶Šå¤§ï¼Œä»¥æ»¡è¶³æ–¹æ³•è°ƒç”¨æ‰€éœ€ä¼ é€’çš„ä¿¡æ¯å¢å¤§çš„éœ€æ±‚ã€‚è¿›è€Œå‡½æ•°è°ƒç”¨å°±ä¼šå ç”¨æ›´å¤šçš„æ ˆç©ºé—´ï¼Œå¯¼è‡´å…¶åµŒå¥—è°ƒç”¨æ¬¡æ•°å°±ä¼šå‡å°‘ã€‚</p>
</li>
<li><p>å±€éƒ¨å˜é‡è¡¨ä¸­çš„å˜é‡åªåœ¨å½“å‰æ–¹æ³•è°ƒç”¨ä¸­æœ‰æ•ˆã€‚åœ¨æ–¹æ³•æ‰§è¡Œæ—¶ï¼Œè™šæ‹Ÿæœºé€šè¿‡ä½¿ç”¨å±€éƒ¨å˜é‡è¡¨å®Œæˆå‚æ•°å€¼åˆ°å‚æ•°å˜é‡åˆ—è¡¨çš„ä¼ é€’è¿‡ç¨‹ã€‚å½“æ–¹æ³•è°ƒç”¨ç»“æŸåï¼Œéšç€æ–¹æ³•æ ˆå¸§çš„é”€æ¯ï¼Œå±€éƒ¨å˜é‡è¡¨ä¹Ÿä¼šéšä¹‹é”€æ¯ã€‚</p>
</li>
</ol>
<h4 id="å­—èŠ‚ç ä¸­æ–¹æ³•çš„å†…éƒ¨ç»“æ„"><a href="#å­—èŠ‚ç ä¸­æ–¹æ³•çš„å†…éƒ¨ç»“æ„" class="headerlink" title="å­—èŠ‚ç ä¸­æ–¹æ³•çš„å†…éƒ¨ç»“æ„"></a>å­—èŠ‚ç ä¸­æ–¹æ³•çš„å†…éƒ¨ç»“æ„</h4><p>Vä»£è¡¨è¿”å›å€¼ç±»å‹ï¼švoid</p>
<h4 id="å…³äºSlotçš„ç†è§£"><a href="#å…³äºSlotçš„ç†è§£" class="headerlink" title="å…³äºSlotçš„ç†è§£"></a>å…³äºSlotçš„ç†è§£</h4><h5 id="å‡ ç‚¹è¯´æ˜-1"><a href="#å‡ ç‚¹è¯´æ˜-1" class="headerlink" title="å‡ ç‚¹è¯´æ˜"></a>å‡ ç‚¹è¯´æ˜</h5><ol>
<li><p>å‚æ•°å€¼çš„å­˜æ”¾æ€»æ˜¯åœ¨å±€éƒ¨å˜é‡æ•°ç»„çš„index0å¼€å§‹ï¼Œåˆ°æ•°ç»„é•¿åº¦-1çš„ç´¢å¼•ç»“æŸã€‚</p>
</li>
<li><p>å±€éƒ¨å˜é‡è¡¨ï¼Œæœ€åŸºæœ¬çš„å­˜å‚¨å•å…ƒæ˜¯slot(å˜é‡æ§½)</p>
</li>
<li><p>å±€éƒ¨å˜é‡è¡¨ä¸­å­˜æ”¾ç¼–è¯‘æœŸå¯çŸ¥çš„å„ç§åŸºæœ¬æ•°æ®ç±»å‹(8ç§)ï¼Œå¼•ç”¨ç±»å‹(reference) ï¼ŒreturnAddressç±»å‹çš„å˜é‡ã€‚</p>
</li>
<li><p>åœ¨å±€éƒ¨å˜é‡è¡¨é‡Œï¼Œ32ä½ä»¥å†…çš„ç±»å‹åªå ç”¨ä¸€ä¸ªslot(åŒ…æ‹¬returnAddressç±»å‹ï¼‰ï¼Œ64ä½çš„ç±»å‹(longå’Œdouble)å ç”¨ä¸¤ä¸ªslotã€‚</p>
<ul>
<li><p>byteã€shortã€charåœ¨å­˜å‚¨å‰è¢«è½¬æ¢ä¸ºintï¼Œbooleanä¹Ÿè¢«è½¬æ¢ä¸ºintï¼Œ0è¡¨ç¤ºfalseï¼Œé0è¡¨ç¤ºtrueã€‚</p>
</li>
<li><p>longå’Œdouble åˆ™å æ®ä¸¤ä¸ªslotã€‚</p>
</li>
</ul>
</li>
<li><p>JVMä¼šä¸ºå±€éƒ¨å˜é‡è¡¨ä¸­çš„æ¯ä¸€ä¸ªslotéƒ½åˆ†é…ä¸€ä¸ªè®¿é—®ç´¢å¼•ï¼Œé€šè¿‡è¿™ä¸ªç´¢å¼•å³å¯æˆåŠŸè®¿é—®åˆ°å±€éƒ¨å˜é‡è¡¨ä¸­æŒ‡å®šçš„å±€éƒ¨å˜é‡å€¼ã€‚</p>
</li>
<li><p>å½“ä¸€ä¸ªå®ä¾‹æ–¹æ³•è¢«è°ƒç”¨çš„æ—¶å€™ï¼Œå®ƒçš„æ–¹æ³•å‚æ•°å’Œæ–¹æ³•ä½“å†…éƒ¨å®šä¹‰çš„å±€éƒ¨å˜é‡å°†ä¼šæŒ‰ç…§é¡ºåºè¢«å¤åˆ¶åˆ°å±€éƒ¨å˜é‡è¡¨ä¸­çš„æ¯ä¸€ä¸ªslotä¸Šã€‚</p>
</li>
<li><p>å¦‚æœéœ€è¦è®¿é—®å±€éƒ¨å˜é‡è¡¨ä¸­ä¸€ä¸ª64bitçš„å±€éƒ¨å˜é‡å€¼æ—¶ï¼Œåªéœ€è¦ä½¿ç”¨å‰ä¸€ä¸ªç´¢å¼•å³å¯ã€‚(æ¯”å¦‚è®¿é—®longæˆ–doubleç±»å‹å˜é‡)</p>
</li>
<li><p>å¦‚æœå½“å‰å¸§æ˜¯ç”±æ„é€ æ–¹æ³•æˆ–è€…å®ä¾‹æ–¹æ³•åˆ›å»ºçš„ï¼Œé‚£ä¹ˆè¯¥å¯¹è±¡å¼•ç”¨thiså°†ä¼šå­˜æ”¾åœ¨indexä¸º0çš„slotå¤„ï¼Œå…¶ä½™çš„å‚æ•°æŒ‰ç…§å‚æ•°è¡¨é¡ºåºç»§ç»­æ’åˆ—ã€‚</p>
<p>å®ä¾‹æ–¹æ³•é»˜è®¤æ˜¯æœ‰thisçš„</p>
<p>å¦‚æœä¸ä½¿ç”¨å˜é‡æ¥æ”¶ä¸€ä¸ªæ–¹æ³•çš„è¿”å›å€¼ï¼Œé‚£ä¹ˆslotä¸­ä¸ä¼šå‡ºç°è¿”å›å€¼ã€‚</p>
</li>
<li><p>åœ¨æ ˆå¸§ä¸­ï¼Œä¸æ€§èƒ½è°ƒä¼˜å…³ç³»æœ€ä¸ºå¯†åˆ‡çš„éƒ¨åˆ†å°±æ˜¯å‰é¢æåˆ°çš„å±€éƒ¨å˜é‡è¡¨ã€‚åœ¨æ–¹æ³•æ‰§è¡Œæ—¶ï¼Œè™šæ‹Ÿæœºä½¿ç”¨å±€éƒ¨å˜é‡è¡¨å®Œæˆæ–¹æ³•çš„ä¼ é€’ã€‚</p>
</li>
<li><p>å±€éƒ¨å˜é‡è¡¨ä¸­çš„å˜é‡ä¹Ÿæ˜¯é‡è¦çš„åƒåœ¾å›æ”¶æ ¹èŠ‚ç‚¹ï¼Œåªè¦è¢«å±€éƒ¨å˜é‡è¡¨ä¸­ç›´æ¥æˆ–é—´æ¥å¼•ç”¨çš„å¯¹è±¡éƒ½ä¸ä¼šè¢«å›æ”¶ã€‚</p>
</li>
</ol>
<h5 id="Slotçš„é‡å¤åˆ©ç”¨"><a href="#Slotçš„é‡å¤åˆ©ç”¨" class="headerlink" title="Slotçš„é‡å¤åˆ©ç”¨"></a>Slotçš„é‡å¤åˆ©ç”¨</h5><p>â€‹		æ ˆå¸§ä¸­çš„å±€éƒ¨å˜é‡è¡¨ä¸­çš„æ§½ä½æ˜¯å¯ä»¥é‡ç”¨çš„ï¼Œå¦‚æœä¸€ä¸ªå±€éƒ¨å˜é‡è¿‡äº†å…¶ä½œç”¨åŸŸï¼Œé‚£ä¹ˆåœ¨å…¶ä½œç”¨åŸŸä¹‹åç”³æ˜çš„æ–°çš„å±€éƒ¨å˜é‡å°±å¾ˆæœ‰å¯èƒ½ä¼šå¤ç”¨è¿‡æœŸå±€éƒ¨å˜é‡çš„æ§½ä½ï¼Œä»è€Œè¾¾åˆ°èŠ‚çœèµ„æºçš„ç›®çš„ã€‚</p>
<p>å˜é‡cä½¿ç”¨ä¹‹å‰ä¼šå…ˆä½¿ç”¨å·²ç»é”€æ¯çš„å˜é‡bå æ®çš„slotçš„ä½ç½®ã€‚ï¼ˆåºå·ç›¸åŒï¼‰</p>
<p>åœ¨æ–¹æ³•æˆ–è¯­å¥ä¸­å‡ºç°çš„{}å°±ç§°ä¸ºæ™®é€šä»£ç å—ã€‚æ™®é€šä»£ç å—å’Œä¸€èˆ¬è¯­å¥çš„æ‰§è¡Œé¡ºåºç”±ä»–ä»¬åœ¨ä»£ç ä¸­å‡ºç°çš„æ¬¡åºå†³å®šï¼Œå…ˆå‡ºç°å…ˆæ‰§è¡Œã€‚</p>
<h4 id="é™æ€å˜é‡ä¸å±€éƒ¨å˜é‡çš„å¯¹æ¯”"><a href="#é™æ€å˜é‡ä¸å±€éƒ¨å˜é‡çš„å¯¹æ¯”" class="headerlink" title="é™æ€å˜é‡ä¸å±€éƒ¨å˜é‡çš„å¯¹æ¯”"></a>é™æ€å˜é‡ä¸å±€éƒ¨å˜é‡çš„å¯¹æ¯”</h4><p>å‚æ•°è¡¨åˆ†é…å®Œæ¯•ä¹‹åï¼Œå†æ ¹æ®æ–¹æ³•ä½“å†…å®šä¹‰çš„å˜é‡çš„é¡ºåºå’Œä½œç”¨åŸŸåˆ†é…ã€‚</p>
<p>æˆ‘ä»¬çŸ¥é“ç±»å˜é‡è¡¨æœ‰ä¸¤æ¬¡åˆå§‹åŒ–çš„æœºä¼šï¼Œç¬¬ä¸€æ¬¡æ˜¯åœ¨â€å‡†å¤‡é˜¶æ®µâ€ï¼Œæ‰§è¡Œç³»ç»Ÿåˆå§‹åŒ–ï¼Œå¯¹ç±»å˜é‡è®¾ç½®é›¶å€¼ï¼Œå¦ä¸€æ¬¡åˆ™æ˜¯åœ¨â€åˆå§‹åŒ–â€é˜¶æ®µï¼Œèµ‹äºˆç¨‹åºå‘˜åœ¨ä»£ç ä¸­å®šä¹‰çš„åˆå§‹å€¼ã€‚</p>
<p>å’Œç±»å˜é‡åˆå§‹åŒ–ä¸åŒçš„æ˜¯ï¼Œå±€éƒ¨å˜é‡è¡¨ä¸å­˜åœ¨ç³»ç»Ÿåˆå§‹åŒ–çš„è¿‡ç¨‹ï¼Œè¿™æ„å‘³ç€ä¸€æ—¦å®šä¹‰äº†å±€éƒ¨å˜é‡åˆ™å¿…é¡»äººä¸ºçš„åˆå§‹åŒ–ï¼Œå¦åˆ™æ— æ³•ä½¿ç”¨ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test5</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="type">int</span> num;</span><br><span class="line">    <span class="comment">//å¿…é¡»æ˜¾ç¤ºèµ‹å€¼</span></span><br><span class="line">    <span class="comment">// System.out.println(num);</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>åœ¨æ ˆå¸§ä¸­ï¼Œä¸æ€§èƒ½è°ƒä¼˜å…³ç³»æœ€ä¸ºå¯†åˆ‡çš„éƒ¨åˆ†å°±æ˜¯å‰é¢æåˆ°çš„å±€éƒ¨å˜é‡è¡¨ã€‚åœ¨æ–¹æ³•æ‰§è¡Œæ—¶ï¼Œè™šæ‹Ÿæœºä½¿ç”¨å±€éƒ¨å˜é‡è¡¨å®Œæˆæ–¹æ³•çš„ä¼ é€’ã€‚</p>
<p>å±€éƒ¨å˜é‡è¡¨ä¸­çš„å˜é‡ä¹Ÿæ˜¯é‡è¦çš„åƒåœ¾å›æ”¶æ ¹èŠ‚ç‚¹ï¼Œåªè¦è¢«å±€éƒ¨å˜é‡è¡¨ä¸­ç›´æ¥æˆ–é—´æ¥å¼•ç”¨çš„å¯¹è±¡éƒ½ä¸ä¼šè¢«å›æ”¶ã€‚</p>
<h3 id="æ“ä½œæ•°æ ˆ"><a href="#æ“ä½œæ•°æ ˆ" class="headerlink" title="æ“ä½œæ•°æ ˆ"></a>æ“ä½œæ•°æ ˆ</h3><p>æ“ä½œæ•°æ ˆä½¿ç”¨æ•°ç»„ï¼ˆé“¾è¡¨ï¼‰å®ç°</p>
<p>æ¯ä¸€ä¸ªç‹¬ç«‹çš„æ ˆå¸§ä¸­é™¤äº†åŒ…å«å±€éƒ¨å˜é‡è¡¨ä»¥å¤–ï¼Œè¿˜åŒ…å«ä¸€ä¸ªåè¿›å…ˆå‡º(Last-In-First-Out)çš„æ“ä½œæ•°æ ˆï¼Œä¹Ÿå¯ä»¥ç§°ä¹‹ä¸ºè¡¨è¾¾å¼æ ˆ(Expression Stack) ã€‚</p>
<p>æ“ä½œæ•°æ ˆï¼Œåœ¨æ–¹æ³•æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œæ ¹æ®å­—èŠ‚ç æŒ‡ä»¤ï¼Œå¾€æ ˆä¸­å†™å…¥æ•°æ®æˆ–æå–æ•°æ®ï¼Œå³å…¥æ ˆ(push) &#x2F;å‡ºæ ˆ(pop)ã€‚</p>
<p>æŸäº›å­—èŠ‚ç æŒ‡ä»¤å°†å€¼å‹å…¥æ“ä½œæ•°æ ˆï¼Œå…¶ä½™çš„å­—èŠ‚ç æŒ‡ä»¤å°†æ“ä½œæ•°å–å‡ºæ ˆã€‚ä½¿ç”¨å®ƒä»¬åå†æŠŠç»“æœå‹å…¥æ ˆã€‚</p>
<p>æ¯”å¦‚ï¼šæ‰§è¡Œå¤åˆ¶ã€äº¤æ¢ã€æ±‚å’Œç­‰æ“ä½œã€‚</p>
<p>æ“ä½œæ•°æ ˆï¼Œä¸»è¦ç”¨äºä¿å­˜è®¡ç®—è¿‡ç¨‹çš„ä¸­é—´ç»“æœï¼ŒåŒæ—¶ä½œä¸ºè®¡ç®—è¿‡ç¨‹ä¸­å˜é‡</p>
<p>ä¸´æ—¶çš„å­˜å‚¨ç©ºé—´ã€‚</p>
<p>æ“ä½œæ•°æ ˆå°±æ˜¯JVMæ‰§è¡Œå¼•æ“çš„ä¸€ä¸ªå·¥ä½œåŒºï¼Œå½“ä¸€ä¸ªæ–¹æ³•åˆšå¼€å§‹æ‰§è¡Œçš„æ—¶å€™ï¼Œä¸€ä¸ªæ–°çš„æ ˆå¸§ä¹Ÿä¼šéšä¹‹è¢«åˆ›å»ºå‡ºæ¥ï¼Œè¿™ä¸ªæ–¹æ³•çš„æ“ä½œæ•°æ ˆæ˜¯ç©ºçš„ã€‚</p>
<p>æ¯ä¸€ä¸ªæ“ä½œæ•°æ ˆéƒ½ä¼šæ‹¥æœ‰ä¸€ä¸ªæ˜ç¡®çš„æ ˆæ·±åº¦ç”¨äºå­˜å‚¨æ•°å€¼ï¼Œå…¶æ‰€éœ€çš„æœ€å¤§æ·±åº¦åœ¨ç¼–è¯‘æœŸå°±å®šä¹‰å¥½äº†ï¼Œä¿å­˜åœ¨æ–¹æ³•çš„Codeå±æ€§ä¸­ï¼Œä¸ºmax_stackçš„å€¼ã€‚</p>
<p>æ ˆä¸­çš„ä»»ä½•ä¸€ä¸ªå…ƒç´ éƒ½æ˜¯å¯ä»¥ä»»æ„çš„Javaæ•°æ®ç±»å‹ã€‚</p>
<p>32bitçš„ç±»å‹å ç”¨ä¸€ä¸ªæ ˆå•ä½æ·±åº¦</p>
<p>64bitçš„ç±»å‹å ç”¨ä¸¤ä¸ªæ ˆå•ä½æ·±åº¦</p>
<p>æ“ä½œæ•°æ ˆå¹¶éé‡‡ç”¨è®¿é—®ç´¢å¼•çš„æ–¹å¼æ¥è¿›è¡Œæ•°æ®è®¿é—®çš„ï¼Œè€Œæ˜¯åªèƒ½é€šè¿‡æ ‡å‡†çš„å…¥æ ˆ(push)å’Œå‡ºæ ˆ(pop)æ“ä½œæ¥å®Œæˆä¸€æ¬¡æ•°æ®è®¿é—®ã€‚</p>
<p>å¦‚æœè¢«è°ƒç”¨çš„æ–¹æ³•å¸¦æœ‰è¿”å›å€¼çš„è¯ï¼Œå…¶è¿”å›å€¼å°†ä¼šè¢«å‹å…¥å½“å‰æ ˆå¸§çš„æ“ä½œæ•°æ ˆä¸­ï¼Œå¹¶æ›´æ–°PCå¯„å­˜å™¨ä¸­ä¸‹ä¸€æ¡éœ€è¦æ‰§è¡Œçš„å­—èŠ‚ç æŒ‡ä»¤ã€‚</p>
<p>æ“ä½œæ•°æ ˆä¸­å…ƒç´ çš„æ•°æ®ç±»å‹å¿…é¡»ä¸å­—èŠ‚ç æŒ‡ä»¤çš„åºåˆ—ä¸¥æ ¼åŒ¹é…ï¼Œè¿™ç”±ç¼–è¯‘å™¨åœ¨ç¼–è¯‘å™¨æœŸé—´è¿›è¡ŒéªŒè¯ï¼ŒåŒæ—¶åœ¨ç±»åŠ è½½è¿‡ç¨‹ä¸­çš„ç±»æ£€éªŒé˜¶æ®µçš„æ•°æ®æµåˆ†æé˜¶æ®µè¦å†æ¬¡éªŒè¯ã€‚</p>
<p>å¦å¤–ï¼Œæˆ‘ä»¬è¯´Javaè™šæ‹Ÿæœºçš„è§£é‡Šå¼•æ“æ˜¯åŸºäºæ ˆçš„æ‰§è¡Œå¼•æ“ï¼Œå…¶ä¸­çš„æ ˆæŒ‡çš„å°±æ˜¯æ“ä½œæ•°æ ˆã€‚</p>
<p>æ²¡æœ‰è¿”å›å€¼çš„æ“ä½œæ•°æ ˆç¤ºä¾‹ï¼š</p>
<p>æœ‰è¿”å›å€¼çš„æ“ä½œæ•°æ ˆç¤ºä¾‹ï¼š</p>
<p>i++ä¸++içš„åŒºåˆ«ï¼š</p>
<h3 id="æ ˆé¡¶ç¼“å­˜æŠ€æœ¯"><a href="#æ ˆé¡¶ç¼“å­˜æŠ€æœ¯" class="headerlink" title="æ ˆé¡¶ç¼“å­˜æŠ€æœ¯"></a>æ ˆé¡¶ç¼“å­˜æŠ€æœ¯</h3><p>å‰è€Œæè¿‡ï¼ŒåŸºäºæ ˆå¼æ¶æ„çš„è™šæ‹Ÿæœºæ‰€ä½¿ç”¨çš„é›¶åœ°å€æŒ‡ä»¤æ›´åŠ ç´§å‡‘ï¼Œä½†å®Œæˆä¸€é¡¹æ“ä½œçš„æ—¶å€™å¿…ç„¶éœ€è¦ä½¿ç”¨æ›´å¤šçš„å…¥æ ˆå’Œå‡ºæ ˆæŒ‡ä»¤ï¼Œè¿™åŒæ—¶ä¹Ÿå°±æ„å‘³ç€å°†éœ€è¦æ›´å¤šçš„æŒ‡ä»¤åˆ†æ´¾(instruction dispatch) æ¬¡æ•°å’Œå†…å­˜è¯»&#x2F;å†™æ¬¡æ•°ã€‚</p>
<p>ç”±äºæ“ä½œæ•°æ˜¯å­˜å‚¨åœ¨å†…å­˜ä¸­çš„ï¼Œå› æ­¤é¢‘ç¹åœ°æ‰§è¡Œå†…å­˜è¯»&#x2F;å†™æ“ä½œå¿…ç„¶ä¼šå½±å“æ‰§è¡Œé€Ÿåº¦ã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼ŒHotspot JVMçš„è®¾è®¡è€…ä»¬æå‡ºäº†æ ˆé¡¶ç¼“å­˜(Tosï¼Œ Top-of-Stack Cashing) æŠ€æœ¯ï¼Œå°†æ ˆé¡¶å…ƒç´ å…¨éƒ¨ç¼“å­˜åœ¨ç‰©ç†CPUçš„å¯„å­˜å™¨ä¸­ï¼Œä»¥æ­¤é™ä½å¯¹å†…å­˜çš„è¯»&#x2F;å†™æ¬¡æ•°ï¼Œæå‡æ‰§è¡Œå¼•æ“çš„æ‰§è¡Œæ•ˆç‡ã€‚</p>
<h3 id="åŠ¨æ€é“¾æ¥"><a href="#åŠ¨æ€é“¾æ¥" class="headerlink" title="åŠ¨æ€é“¾æ¥"></a>åŠ¨æ€é“¾æ¥</h3><p>å¸§æ•°æ®åŒºï¼šæ–¹æ³•è¿”å›åœ°å€ + ä¸€äº›é™„åŠ ä¿¡æ¯</p>
<p>æ¯ä¸€ä¸ªæ ˆå¸§å†…éƒ¨éƒ½åŒ…å«ä¸€ä¸ªæŒ‡å‘è¿è¡Œæ—¶å¸¸é‡æ± ä¸­è¯¥æ ˆå¸§æ‰€å±æ–¹æ³•çš„å¼•ç”¨åŒ…å«è¿™ä¸ªå¼•ç”¨çš„ç›®çš„å°±æ˜¯ä¸ºäº†æ”¯æŒå½“å‰æ–¹æ³•çš„ä»£ç èƒ½å¤Ÿå®ç°åŠ¨æ€é“¾æ¥(Dynamic Linking)ã€‚æ¯”å¦‚: invokedynamicæŒ‡ä»¤ã€‚</p>
<p>åœ¨Javaæºæ–‡ä»¶è¢«ç¼–è¯‘åˆ°å­—èŠ‚ç æ–‡ä»¶ä¸­æ—¶ï¼Œæ‰€æœ‰çš„å˜é‡å’Œæ–¹æ³•å¼•ç”¨éƒ½ä½œä¸ºç¬¦å·å¼•ç”¨(symbolic Reference) ä¿å­˜åœ¨classæ–‡ä»¶çš„å¸¸é‡æ± é‡Œã€‚</p>
<p>æ¯”å¦‚ï¼šæè¿°ä¸€ä¸ªæ–¹æ³•è°ƒç”¨äº†å¦å¤–çš„å…¶ä»–æ–¹æ³•æ—¶ï¼Œå°±æ˜¯é€šè¿‡å¸¸é‡æ± ä¸­æŒ‡å‘æ–¹æ³•çš„ç¬¦å·å¼•ç”¨æ¥è¡¨ç¤ºçš„ï¼Œé‚£ä¹ˆåŠ¨æ€é“¾æ¥çš„ä½œç”¨å°±æ˜¯ä¸ºäº†å°†è¿™äº›ç¬¦å·å¼•ç”¨è½¬æ¢ä¸ºè°ƒç”¨æ–¹æ³•çš„ç›´æ¥å¼•ç”¨ã€‚</p>
<p>å­—èŠ‚ç ä¸­çš„å¸¸é‡æ± è¿è¡Œä»¥åå°±æ”¾åœ¨æ–¹æ³•åŒºã€‚ï¼ˆè¿è¡Œæ—¶å¸¸é‡æ± ï¼‰</p>
<p>ä¸ºä»€ä¹ˆéœ€è¦å¸¸é‡æ± ?</p>
<p>å¸¸é‡æ± çš„ä½œç”¨ï¼Œå°±æ˜¯ä¸ºäº†æä¾›- -äº›ç¬¦å·å’Œå¸¸é‡ï¼Œä¾¿äºæŒ‡ä»¤çš„è¯†åˆ«ã€‚</p>
<h3 id="æ–¹æ³•çš„è°ƒç”¨"><a href="#æ–¹æ³•çš„è°ƒç”¨" class="headerlink" title="æ–¹æ³•çš„è°ƒç”¨"></a>æ–¹æ³•çš„è°ƒç”¨</h3><h4 id="åŠ¨æ€é“¾æ¥ä¸é™æ€é“¾æ¥"><a href="#åŠ¨æ€é“¾æ¥ä¸é™æ€é“¾æ¥" class="headerlink" title="åŠ¨æ€é“¾æ¥ä¸é™æ€é“¾æ¥"></a>åŠ¨æ€é“¾æ¥ä¸é™æ€é“¾æ¥</h4><p>åœ¨JVMä¸­ï¼Œå°†ç¬¦å·å¼•ç”¨è½¬æ¢ä¸ºè°ƒç”¨æ–¹æ³•çš„ç›´æ¥å¼•ç”¨ä¸æ–¹æ³•çš„ç»‘å®šæœºåˆ¶ç›¸å…³ã€‚</p>
<p>é™æ€é“¾æ¥ï¼š</p>
<p>å½“ä¸€ä¸ªå­—èŠ‚ç æ–‡ä»¶è¢«è£…è½½è¿›JVMå†…éƒ¨æ—¶ï¼Œå¦‚æœè¢«è°ƒç”¨çš„ç›®æ ‡æ–¹æ³•åœ¨ç¼–è¯‘æœŸå¯çŸ¥ï¼Œä¸”è¿è¡ŒæœŸä¿æŒä¸å˜æ—¶ã€‚è¿™ç§æƒ…å†µä¸‹å°†è°ƒç”¨æ–¹æ³•çš„ç¬¦å·å¼•ç”¨è½¬æ¢ä¸ºç›´æ¥å¼•ç”¨çš„è¿‡ç¨‹ç§°ä¹‹ä¸ºé™æ€é“¾æ¥ã€‚</p>
<p>åŠ¨æ€é“¾æ¥ï¼š</p>
<p>å¦‚æœè¢«è°ƒç”¨çš„æ–¹æ³•åœ¨ç¼–è¯‘æœŸæ— æ³•è¢«ç¡®å®šä¸‹æ¥ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œåªèƒ½å¤Ÿåœ¨ç¨‹åºè¿è¡Œ</p>
<p>æœŸå°†è°ƒç”¨æ–¹æ³•çš„ç¬¦å·å¼•ç”¨è½¬æ¢ä¸ºç›´æ¥å¼•ç”¨ï¼Œç”±äºè¿™ç§å¼•ç”¨è½¬æ¢è¿‡ç¨‹å…·å¤‡åŠ¨æ€æ€§ï¼Œå› æ­¤ä¹Ÿå°±è¢«ç§°ä¹‹ä¸ºåŠ¨æ€é“¾æ¥ã€‚</p>
<p>å¯¹åº”çš„æ–¹æ³•çš„ç»‘å®šæœºåˆ¶ä¸ºï¼šæ—©æœŸç»‘å®š(Early Binding) å’Œæ™šæœŸç»‘å®š(Late Binding)ã€‚ç»‘å®šæ˜¯ä¸€ä¸ªå­—æ®µã€æ–¹æ³•æˆ–è€…ç±»åœ¨ç¬¦å·å¼•ç”¨è¢«æ›¿æ¢ä¸ºç›´æ¥å¼•ç”¨çš„è¿‡ç¨‹ï¼Œè¿™ä»…ä»…å‘ç”Ÿä¸€æ¬¡ã€‚</p>
<h4 id="æ—©æœŸç»‘å®šä¸æ™šæœŸç»‘å®š"><a href="#æ—©æœŸç»‘å®šä¸æ™šæœŸç»‘å®š" class="headerlink" title="æ—©æœŸç»‘å®šä¸æ™šæœŸç»‘å®š"></a>æ—©æœŸç»‘å®šä¸æ™šæœŸç»‘å®š</h4><p>æ—©æœŸç»‘å®šï¼š</p>
<p>æ—©æœŸç»‘å®šå°±æ˜¯æŒ‡è¢«è°ƒç”¨çš„ç›®æ ‡æ–¹æ³•å¦‚æœåœ¨ç¼–è¯‘æœŸå¯çŸ¥ï¼Œä¸”è¿è¡ŒæœŸä¿æŒä¸å˜æ—¶,</p>
<p>å³å¯å°†è¿™ä¸ªæ–¹æ³•ä¸æ‰€å±çš„ç±»å‹è¿›è¡Œç»‘å®šï¼Œè¿™æ ·ä¸€æ¥ï¼Œç”±äºæ˜ç¡®äº†è¢«è°ƒç”¨çš„ç›®æ ‡æ–¹æ³•ç©¶ç«Ÿæ˜¯å“ª-ä¸€ä¸ªï¼Œå› æ­¤ä¹Ÿå°±å¯ä»¥ä½¿ç”¨é™æ€é“¾æ¥çš„æ–¹å¼å°†ç¬¦å·å¼•ç”¨è½¬æ¢ä¸ºç›´æ¥å¼•ç”¨ã€‚</p>
<p>æ™šæœŸç»‘å®šï¼š</p>
<p>å¦‚æœè¢«è°ƒç”¨çš„æ–¹æ³•åœ¨ç¼–è¯‘æœŸæ— æ³•è¢«ç¡®å®šä¸‹æ¥ï¼Œåªèƒ½å¤Ÿåœ¨ç¨‹åºè¿è¡ŒæœŸæ ¹æ®å®é™…çš„ç±»å‹ç»‘å®šç›¸å…³çš„æ–¹æ³•ï¼Œè¿™ç§ç»‘å®šæ–¹å¼ä¹Ÿå°±è¢«ç§°ä¹‹ä¸ºæ™šæœŸç»‘å®šã€‚</p>
<p>éšç€é«˜çº§è¯­è¨€çš„æ¨ªç©ºå‡ºä¸–ï¼Œç±»ä¼¼äºJava-æ ·çš„åŸºäºé¢å‘å¯¹è±¡çš„ç¼–ç¨‹è¯­è¨€å¦‚ä»Š</p>
<p>è¶Šæ¥è¶Šå¤šï¼Œå°½ç®¡è¿™ç±»ç¼–ç¨‹è¯­è¨€åœ¨è¯­æ³•é£æ ¼ä¸Šå­˜åœ¨ä¸€å®šçš„å·®åˆ«ï¼Œä½†æ˜¯å®ƒä»¬å½¼æ­¤ä¹‹é—´å§‹ç»ˆä¿æŒç€ä¸€ä¸ªå…±æ€§ï¼Œé‚£å°±æ˜¯éƒ½æ”¯æŒå°è£…ã€ç»§æ‰¿å’Œå¤šæ€ç­‰é¢å‘å¯¹è±¡ç‰¹æ€§, æ—¢ç„¶è¿™ä¸€ç±»çš„ç¼–ç¨‹è¯­è¨€å…·å¤‡å¤šæ€ç‰¹æ€§ï¼Œé‚£ä¹ˆè‡ªç„¶ä¹Ÿå°±å…·å¤‡æ—©æœŸç»‘å®šå’Œæ™šæœŸç»‘å®šä¸¤ç§ç»‘å®šæ–¹å¼ã€‚</p>
<p>Javaä¸­ä»»ä½•ä¸€ä¸ªæ™®é€šçš„æ–¹æ³•å…¶å®éƒ½å…·å¤‡è™›å‡½æ•°çš„ç‰¹å¾ï¼Œå®ƒä»¬ç›¸å½“äºC++è¯­è¨€</p>
<p>ä¸­çš„è™šå‡½æ•°(C++ä¸­åˆ™éœ€è¦ä½¿ç”¨å…³é”®å­—virtualæ¥æ˜¾å¼å®šä¹‰)ã€‚å¦‚æœåœ¨Javaç¨‹åºä¸­ä¸å¸Œæœ›æŸä¸ªæ–¹æ³•æ‹¥æœ‰è™šå‡½æ•°çš„ç‰¹å¾æ—¶ï¼Œåˆ™å¯ä»¥ä½¿ç”¨å…³é”®å­—finalæ¥æ ‡ï¼Œè®°è¿™ä¸ªæ–¹æ³•ã€‚</p>
<h4 id="è™šæ–¹æ³•ä¸éè™šæ–¹æ³•"><a href="#è™šæ–¹æ³•ä¸éè™šæ–¹æ³•" class="headerlink" title="è™šæ–¹æ³•ä¸éè™šæ–¹æ³•"></a>è™šæ–¹æ³•ä¸éè™šæ–¹æ³•</h4><p>éè™šæ–¹æ³•ï¼š</p>
<p>å¦‚æœæ–¹æ³•åœ¨ç¼–è¯‘æœŸå°±ç¡®å®šäº†å…·ä½“çš„è°ƒç”¨ç‰ˆæœ¬ï¼Œè¿™ä¸ªç‰ˆæœ¬åœ¨è¿è¡Œæ—¶æ˜¯ä¸å¯å˜çš„ã€‚</p>
<p>è¿™æ ·çš„æ–¹æ³•ç§°ä¸ºéè™šæ–¹æ³•ã€‚</p>
<p>é™æ€æ–¹æ³•ã€ç§æœ‰æ–¹æ³•ã€finalæ–¹æ³•ã€å®ä¾‹æ„é€ å™¨ã€çˆ¶ç±»æ–¹æ³•éƒ½æ˜¯éè™šæ–¹æ³•ã€‚</p>
<p>å…¶ä»–æ–¹æ³•ç§°ä¸ºè™šæ–¹æ³•ã€‚</p>
<p>è™šæ‹Ÿæœºä¸­æä¾›äº†ä»¥ä¸‹å‡ æ¡æ–¹æ³•è°ƒç”¨æŒ‡ä»¤ï¼š</p>
<p>æ™®é€šè°ƒç”¨æŒ‡ä»¤ï¼š</p>
<p>\1.   invokestatic: è°ƒç”¨é™æ€æ–¹æ³•ï¼Œè§£æé˜¶æ®µç¡®å®šå”¯ä¸€æ–¹æ³•ç‰ˆæœ¬</p>
<p>\2.   invokespecial: è°ƒç”¨<init>æ–¹æ³•ã€ç§æœ‰åŠçˆ¶ç±»æ–¹æ³•ï¼Œè§£æé˜¶æ®µç¡®å®šå”¯ä¸€æ–¹æ³•ç‰ˆæœ¬</init></p>
<p>\3.   invokevirtual: è°ƒç”¨æ‰€æœ‰è™šæ–¹æ³•</p>
<p>\4.   invokeinterface: è°ƒç”¨æ¥å£æ–¹æ³•</p>
<p>åŠ¨æ€è°ƒç”¨æŒ‡ä»¤ï¼š</p>
<p>\5.   invokedynamic: åŠ¨æ€è§£æå‡ºéœ€è¦è°ƒç”¨çš„æ–¹æ³•ï¼Œç„¶åæ‰§è¡Œ</p>
<p>å‰å››æ¡æŒ‡ä»¤å›ºåŒ–åœ¨è™šæ‹Ÿæœºå†…éƒ¨ï¼Œæ–¹æ³•çš„è°ƒç”¨æ‰§è¡Œä¸å¯äººä¸ºå¹²é¢„ï¼Œè€ŒinvokedynamicæŒ‡ä»¤åˆ™æ”¯æŒç”±ç”¨æˆ·ç¡®å®šæ–¹æ³•ç‰ˆæœ¬ã€‚å…¶ä¸­invokestaticæŒ‡ä»¤å’ŒinvokespecialæŒ‡ä»¤è°ƒç”¨çš„æ–¹æ³•ç§°ä¸ºéè™šæ–¹æ³•ï¼Œå…¶ä½™çš„(finalä¿®é¥°çš„é™¤å¤–)ç§°ä¸ºè™šæ–¹æ³•ã€‚</p>
<p>å…³äºinvokedynamicæŒ‡ä»¤</p>
<p>JVMå­—èŠ‚ç æŒ‡ä»¤é›†ä¸€ç›´æ¯”è¾ƒç¨³å®šï¼Œä¸€ç›´åˆ°Java7ä¸­æ‰å¢åŠ äº†ä¸€ä¸ªinvokedynamicæŒ‡ä»¤ï¼Œè¿™æ˜¯Javaä¸ºäº†å®ç°ã€åŠ¨æ€ç±»å‹è¯­è¨€ã€‘æ”¯æŒè€Œåšçš„ä¸€ç§æ”¹è¿›ã€‚</p>
<p>ä½†æ˜¯åœ¨Java7ä¸­å¹¶æ²¡æœ‰æä¾›ç›´æ¥ç”ŸæˆinvokedynamicæŒ‡ä»¤çš„æ–¹æ³•ï¼Œéœ€è¦å€ŸåŠ©ASMè¿™ç§åº•å±‚å­—èŠ‚ç å·¥å…·æ¥äº§ç”ŸinvokedynamicæŒ‡ä»¤ã€‚ç›´åˆ°Java8çš„Lambdaè¡¨è¾¾å¼çš„å‡ºç°ï¼ŒinvokedynamicæŒ‡ä»¤çš„ç”Ÿæˆï¼Œåœ¨Javaä¸­æ‰æœ‰äº†ç›´æ¥çš„ç”Ÿæˆæ–¹å¼ã€‚</p>
<p>Java7ä¸­å¢åŠ çš„åŠ¨æ€è¯­è¨€ç±»å‹æ”¯æŒçš„æœ¬è´¨æ˜¯å¯¹Javaè™šæ‹Ÿæœºè§„èŒƒçš„ä¿®æ”¹ï¼Œè€Œä¸æ˜¯å¯¹Javaè¯­è¨€è§„åˆ™çš„ä¿®æ”¹ï¼Œè¿™ä¸€å—ç›¸å¯¹æ¥è®²æ¯”è¾ƒå¤æ‚ï¼Œå¢åŠ äº†è™šæ‹Ÿæœºä¸­çš„æ–¹æ³•è°ƒç”¨ï¼Œæœ€ç›´æ¥çš„å—ç›Šè€…å°±æ˜¯è¿è¡Œåœ¨Javaå¹³å°çš„åŠ¨æ€è¯­è¨€çš„ç¼–è¯‘å™¨ã€‚</p>
<p>åŠ¨æ€ç±»å‹è¯­è¨€å’Œé™æ€ç±»å‹è¯­è¨€ï¼š</p>
<p>åŠ¨æ€ç±»å‹è¯­è¨€å’Œé™æ€ç±»å‹è¯­è¨€ä¸¤è€…çš„åŒºåˆ«å°±åœ¨äºå¯¹ç±»å‹çš„æ£€æŸ¥æ˜¯åœ¨ç¼–è¯‘æœŸè¿˜æ˜¯åœ¨è¿è¡ŒæœŸï¼Œæ»¡è¶³å‰è€…å°±æ˜¯é™æ€ç±»å‹è¯­è¨€ï¼Œåä¹‹æ˜¯åŠ¨æ€ç±»å‹è¯­è¨€ã€‚</p>
<p>è¯´çš„å†ç›´ç™½ä¸€ç‚¹å°±æ˜¯ï¼Œé™æ€ç±»å‹è¯­è¨€æ˜¯åˆ¤æ–­å˜é‡è‡ªèº«çš„ç±»å‹ä¿¡æ¯ï¼›åŠ¨æ€ç±»å‹</p>
<p>è¯­è¨€æ˜¯åˆ¤æ–­å˜é‡å€¼çš„ç±»å‹ä¿¡æ¯ï¼Œå˜é‡æ²¡æœ‰ç±»å‹ä¿¡æ¯ï¼Œå˜é‡å€¼æ‰æœ‰ç±»å‹ä¿¡æ¯ï¼Œ</p>
<p>è¿™æ˜¯åŠ¨æ€è¯­è¨€çš„ä¸€ä¸ªé‡è¦ç‰¹å¾ã€‚</p>
<p>Javaæ˜¯é™æ€ç±»å‹è¯­è¨€</p>
<h4 id="æ–¹æ³•é‡å†™çš„æœ¬è´¨ä¸è™šæ–¹æ³•è¡¨çš„ä½¿ç”¨"><a href="#æ–¹æ³•é‡å†™çš„æœ¬è´¨ä¸è™šæ–¹æ³•è¡¨çš„ä½¿ç”¨" class="headerlink" title="æ–¹æ³•é‡å†™çš„æœ¬è´¨ä¸è™šæ–¹æ³•è¡¨çš„ä½¿ç”¨"></a>æ–¹æ³•é‡å†™çš„æœ¬è´¨ä¸è™šæ–¹æ³•è¡¨çš„ä½¿ç”¨</h4><p>Javaè¯­è¨€ä¸­æ–¹æ³•é‡å†™çš„æœ¬è´¨ï¼š</p>
<p>\1.   æ‰¾åˆ°æ“ä½œæ•°æ ˆé¡¶çš„ç¬¬ä¸€ä¸ªå…ƒç´ æ‰€æ‰§è¡Œçš„å¯¹è±¡çš„å®é™…ç±»å‹ï¼Œè®°ä½œCã€‚</p>
<p>\2.   å¦‚æœåœ¨ç±»å‹ä¸­æ‰¾åˆ°ä¸å¸¸é‡ä¸­çš„æè¿°ç¬¦åˆç®€å•åç§°éƒ½ç›¸ç¬¦çš„æ–¹æ³•ï¼Œåˆ™è¿›è¡Œè®¿é—®æƒé™æ¾éªŒï¼Œå¦‚æœé€šè¿‡åˆ™è¿”å›è¿™ä¸ªæ–¹æ³•çš„ç›´æ¥å¼•ç”¨ï¼ŒæŸ¥æ‰¾è¿‡ç¨‹ç»“æŸï¼›å¦‚æœä¸é€šè¿‡ï¼Œåˆ™è¿”å›java.lang.IllegalAccessErrorå¼‚å¸¸ã€‚</p>
<p>\3.   å¦åˆ™ï¼ŒæŒ‰ç…§ç»§æ‰¿å…³ç³»ä»ä¸‹å¾€ä¸Šä¾æ¬¡å¯¹Cçš„å„ä¸ªçˆ¶ç±»è¿›è¡Œç¬¬2æ­¥çš„æœç´¢å’ŒéªŒè¯è¿‡ç¨‹ã€‚</p>
<p>\4.   å¦‚æœå§‹ç»ˆæ²¡æœ‰æ‰¾åˆ°åˆé€‚çš„æ–¹æ³•ï¼Œåˆ™æŠ›å‡ºjava.lang.AbstractMethodErrorå¼‚å¸¸ã€‚</p>
<p>IllegalAccessErrorä»‹ç»ï¼š</p>
<p>ç¨‹åºè¯•å›¾è®¿é—®æˆ–ä¿®æ”¹ä¸€ä¸ªå±æ€§æˆ–è°ƒç”¨ä¸€ä¸ªæ–¹æ³•ï¼Œè¿™ä¸ªå±æ€§æˆ–æ–¹æ³•ï¼Œä½ æ²¡æœ‰æƒé™è®¿é—®ã€‚ä¸€èˆ¬çš„ï¼Œè¿™ä¸ªä¼šå¼•èµ·ç¼–è¯‘å™¨å¼‚å¸¸ã€‚è¿™ä¸ªé”™è¯¯å¦‚æœå‘ç”Ÿåœ¨è¿è¡Œæ—¶ï¼Œå°±è¯´æ˜ä¸€ä¸ªç±»å‘ç”Ÿäº†ä¸å…¼å®¹çš„æ”¹å˜ã€‚</p>
<p>ã€åœ¨å­ç±»å¯¹è±¡ä¸­æ‰¾åˆ°ä¸å¸¸é‡ä¸­æè¿°ç›¸ç¬¦çš„æ–¹æ³•ï¼Œåˆ™è¿›è¡Œæƒé™æ ¡éªŒã€‘</p>
<p>åœ¨é¢å‘å¯¹è±¡çš„ç¼–ç¨‹ä¸­ï¼Œä¼šå¾ˆé¢‘ç¹çš„ä½¿ç”¨åˆ°åŠ¨æ€åˆ†æ´¾ï¼Œå¦‚æœåœ¨æ¯æ¬¡åŠ¨æ€åˆ†æ´¾çš„è¿‡ç¨‹ä¸­éƒ½è¦é‡æ–°åœ¨ç±»çš„æ–¹æ³•å…ƒæ•°æ®ä¸­æœç´¢åˆé€‚çš„ç›®æ ‡çš„è¯å°±å¯èƒ½å½±å“åˆ°æ‰§è¡Œæ•ˆç‡ã€‚å› æ­¤ï¼Œä¸ºäº†æé«˜æ€§èƒ½ï¼ŒJVMé‡‡ç”¨åœ¨ç±»çš„æ–¹æ³•åŒºå»ºç«‹ä¸€ä¸ªè™šæ–¹æ³•è¡¨(virtual method table) (éè™šæ–¹æ³•ä¸ä¼šå‡ºç°åœ¨è¡¨ä¸­)æ¥å®ç°ã€‚ä½¿ç”¨ç´¢å¼•è¡¨æ¥ä»£æ›¿æŸ¥æ‰¾ã€‚</p>
<p>æ¯ä¸ªç±»ä¸­éƒ½æœ‰ä¸€ä¸ªè™šæ–¹æ³•è¡¨ï¼Œè¡¨ä¸­å­˜æ”¾ç€å„ä¸ªæ–¹æ³•çš„å®é™…å…¥å£ã€‚</p>
<p>é‚£ä¹ˆè™šæ–¹æ³•è¡¨ä»€ä¹ˆæ—¶å€™è¢«åˆ›å»º?</p>
<p>è™šæ–¹æ³•è¡¨ä¼šåœ¨ç±»åŠ è½½çš„é“¾æ¥é˜¶æ®µè¢«åˆ›å»ºå¹¶å¼€å§‹åˆå§‹åŒ–ï¼Œç±»çš„å˜é‡åˆå§‹å€¼å‡†å¤‡å®Œæˆä¹‹åï¼ŒJVMä¼šæŠŠè¯¥ç±»çš„æ–¹æ³•è¡¨ä¹Ÿåˆå§‹åŒ–å®Œæ¯•ã€‚</p>
<h3 id="æ–¹æ³•è¿”å›åœ°å€"><a href="#æ–¹æ³•è¿”å›åœ°å€" class="headerlink" title="æ–¹æ³•è¿”å›åœ°å€"></a>æ–¹æ³•è¿”å›åœ°å€</h3><p>å­˜æ”¾è°ƒç”¨è¯¥æ–¹æ³•çš„pcå¯„å­˜å™¨çš„å€¼ã€‚</p>
<p>ä¸€ä¸ªæ–¹æ³•çš„ç»“æŸï¼Œæœ‰ä¸¤ç§æ–¹å¼:</p>
<p>æ­£å¸¸æ‰§è¡Œå®Œæˆ</p>
<p>å‡ºç°æœªå¤„ç†çš„å¼‚å¸¸ï¼Œéæ­£å¸¸é€€å‡º</p>
<p>æ— è®ºé€šè¿‡å“ªç§æ–¹å¼é€€å‡ºï¼Œåœ¨æ–¹æ³•é€€å‡ºåéƒ½è¿”å›åˆ°è¯¥æ–¹æ³•è¢«è°ƒç”¨çš„ä½ç½®ã€‚æ–¹æ³•æ­£å¸¸é€€å‡ºæ—¶ï¼Œè°ƒç”¨è€…çš„pcè®¡æ•°å™¨çš„å€¼ä½œä¸ºè¿”å›åœ°å€ï¼Œå³è°ƒç”¨è¯¥æ–¹æ³•çš„æŒ‡ä»¤çš„ä¸‹ä¸€æ¡æŒ‡ä»¤çš„åœ°å€ã€‚è€Œé€šè¿‡å¼‚å¸¸é€€å‡ºçš„ï¼Œè¿”å›åœ°å€æ˜¯è¦é€šè¿‡å¼‚å¸¸è¡¨æ¥ç¡®å®šï¼Œæ ˆå¸§ä¸­ä¸€èˆ¬ä¸ä¼šä¿å­˜è¿™éƒ¨åˆ†ä¿¡æ¯ã€‚</p>
<p>å½“ä¸€ä¸ªæ–¹æ³•å¼€å§‹æ‰§è¡Œåï¼Œåªæœ‰ä¸¤ç§æ–¹å¼å¯ä»¥é€€å‡ºè¿™ä¸ªæ–¹æ³•ï¼š</p>
<p>1ã€æ‰§è¡Œå¼•æ“é‡åˆ°ä»»æ„ä¸€ä¸ªæ–¹æ³•è¿”å›çš„å­—èŠ‚ç æŒ‡ä»¤(return) ï¼Œä¼šæœ‰è¿”å›å€¼ä¼ é€’ç»™ä¸Šå±‚çš„æ–¹æ³•è°ƒç”¨è€…ï¼Œç®€ç§°æ­£å¸¸å®Œæˆå‡ºå£ï¼š</p>
<ol>
<li><p>ä¸€ä¸ªæ–¹æ³•åœ¨æ­£å¸¸è°ƒç”¨å®Œæˆä¹‹åç©¶ç«Ÿéœ€è¦ä½¿ç”¨å“ªä¸ªè¿”å›æŒ‡ä»¤è¿˜éœ€è¦æ ¹æ®æ–¹æ³•è¿”å›å€¼çš„å®é™…æ•°æ®ç±»å‹è€Œå®šã€‚</p>
</li>
<li><p>åœ¨å­—èŠ‚ç æŒ‡ä»¤ä¸­ï¼Œè¿”å›æŒ‡ä»¤åŒ…å«ireturn (å½“è¿”å›å€¼æ˜¯booleanã€ byteã€ charã€</p>
</li>
</ol>
<p>shortå’Œintç±»å‹æ—¶ä½¿ç”¨)ã€lreturnã€freturnã€dreturnä»¥åŠareturnï¼ˆå¼•ç”¨åœ°å€ï¼‰ï¼Œå¦å¤–è¿˜æœ‰ä¸€ä¸ªreturnæŒ‡ä»¤ä¾›å£°æ˜ä¸ºvoidçš„æ–¹æ³•ã€å®ä¾‹åˆå§‹åŒ–æ–¹æ³•ã€ç±»å’Œæ¥å£çš„åˆå§‹åŒ–æ–¹æ³•ä½¿ç”¨ã€‚</p>
<p>2ã€åœ¨æ–¹æ³•æ‰§è¡Œçš„è¿‡ç¨‹ä¸­é‡åˆ°äº†å¼‚å¸¸(Exception)ï¼Œå¹¶ä¸”è¿™ä¸ªå¼‚å¸¸æ²¡æœ‰åœ¨æ–¹æ³•å†…è¿›è¡Œå¤„ç†ï¼Œä¹Ÿå°±æ˜¯åªè¦åœ¨æœ¬æ–¹æ³•çš„å¼‚å¸¸è¡¨ä¸­æ²¡æœ‰æœç´¢åˆ°åŒ¹é…çš„å¼‚å¸¸å¤„ç†å™¨ï¼Œå°±ä¼šå¯¼è‡´æ–¹æ³•é€€å‡ºã€‚ç®€ç§°å¼‚å¸¸å®Œæˆå‡ºå£ã€‚</p>
<p>æ–¹æ³•æ‰§è¡Œè¿‡ç¨‹ä¸­æŠ›å‡ºå¼‚å¸¸æ—¶çš„å¼‚å¸¸å¤„ç†ï¼Œå­˜å‚¨åœ¨ä¸€ä¸ªå¼‚å¸¸å¤„ç†è¡¨ï¼Œæ–¹ä¾¿åœ¨å‘ç”Ÿå¼‚å¸¸çš„æ—¶å€™æ‰¾åˆ°å¤„ç†å¼‚å¸¸çš„ä»£ç ã€‚</p>
<p>ã€å­—èŠ‚ç æŒ‡ä»¤ä»4åˆ°8å‡ºç°å¼‚å¸¸è·³è½¬è‡³11è¿›è¡Œå¤„ç†ã€‘</p>
<p>æœ¬è´¨ä¸Šï¼Œæ–¹æ³•çš„é€€å‡ºå°±æ˜¯å½“å‰æ ˆå¸§å‡ºæ ˆçš„è¿‡ç¨‹ã€‚æ­¤æ—¶ï¼Œéœ€è¦æ¢å¤ä¸Šå±‚æ–¹æ³•çš„å±€éƒ¨å˜é‡è¡¨ã€æ“ä½œæ•°æ ˆã€å°†è¿”å›å€¼å‹å…¥è°ƒç”¨è€…æ ˆå¸§çš„æ“ä½œæ•°æ ˆã€è®¾ç½®PCå¯„å­˜å™¨å€¼ç­‰ï¼Œè®©è°ƒç”¨è€…æ–¹æ³•ç»§ç»­æ‰§è¡Œä¸‹å»ã€‚</p>
<p>æ­£å¸¸å®Œæˆå‡ºå£å’Œå¼‚å¸¸å®Œæˆå‡ºå£çš„åŒºåˆ«åœ¨äºï¼šé€šè¿‡å¼‚å¸¸å®Œæˆå‡ºå£é€€å‡ºçš„ä¸ä¼šç»™ä»–çš„ä¸Šå±‚è°ƒç”¨è€…äº§ç”Ÿä»»ä½•çš„è¿”å›å€¼ã€‚</p>
<h3 id="ä¸€äº›é™„åŠ ä¿¡æ¯"><a href="#ä¸€äº›é™„åŠ ä¿¡æ¯" class="headerlink" title="ä¸€äº›é™„åŠ ä¿¡æ¯"></a>ä¸€äº›é™„åŠ ä¿¡æ¯</h3><p>   æ ˆå¸§ä¸­è¿˜å…è®¸æºå¸¦ä¸Javaè™šæ‹Ÿæœºå®ç°ç›¸å…³çš„ä¸€äº›é™„åŠ ä¿¡æ¯ã€‚ä¾‹å¦‚ï¼Œå¯¹ç¨‹åºè°ƒè¯•æä¾›æ”¯æŒçš„ä¿¡æ¯ã€‚</p>
<h3 id="ç›¸å…³5ä¸ªé—®é¢˜"><a href="#ç›¸å…³5ä¸ªé—®é¢˜" class="headerlink" title="ç›¸å…³5ä¸ªé—®é¢˜"></a>ç›¸å…³5ä¸ªé—®é¢˜</h3><p>\1.   è®¾ç½®æ ˆçš„å¤§å°</p>
<p>é€šè¿‡-Xssè®¾ç½®å¤§å°</p>
<p>\2.   è°ƒæ•´æ ˆçš„å¤§å°ï¼Œå°±èƒ½ä¿è¯ä¸å‡ºç°æº¢å‡ºå—ï¼Ÿ</p>
<p>ä¸èƒ½ï¼Œå¾€å°çš„è°ƒã€‚</p>
<p>\3.   åˆ†é…çš„æ ˆå†…å­˜è¶Šå¤§è¶Šå¥½å—ï¼Ÿ</p>
<p>ä¸æ˜¯ï¼Œå¤§å°±ä¼šå ç”¨å…¶ä»–çš„è¿›ç¨‹</p>
<p>\4.   åƒåœ¾å›æ”¶æ˜¯å¦ä¼šæ¶‰åŠè™šæ‹Ÿæœºæ ˆï¼Ÿ</p>
<p>ä¸ä¼šã€‚</p>
<table>
<thead>
<tr>
<th></th>
<th>OOM</th>
<th>GC</th>
</tr>
</thead>
<tbody><tr>
<td>PCå¯„å­˜å™¨</td>
<td>æ²¡æœ‰</td>
<td>æ²¡æœ‰</td>
</tr>
<tr>
<td>è™šæ‹Ÿæœºæ ˆ</td>
<td>æœ‰</td>
<td>æ²¡æœ‰</td>
</tr>
<tr>
<td>æœ¬åœ°æ–¹æ³•æ ˆ</td>
<td>æœ‰</td>
<td>æ²¡æœ‰</td>
</tr>
<tr>
<td>å †</td>
<td>æœ‰</td>
<td>æœ‰</td>
</tr>
<tr>
<td>æ–¹æ³•åŒº</td>
<td>æœ‰</td>
<td>æœ‰</td>
</tr>
</tbody></table>
<p>\1.  æ–¹æ³•ä¸­å®šä¹‰çš„å±€éƒ¨å˜é‡æ˜¯å¦ä¸€å®šçº¿ç¨‹å®‰å…¨</p>
<h2 id="æœ¬åœ°æ–¹æ³•æ¥å£ï¼ˆJava-Method-Interfaceï¼‰"><a href="#æœ¬åœ°æ–¹æ³•æ¥å£ï¼ˆJava-Method-Interfaceï¼‰" class="headerlink" title="æœ¬åœ°æ–¹æ³•æ¥å£ï¼ˆJava Method Interfaceï¼‰"></a>æœ¬åœ°æ–¹æ³•æ¥å£ï¼ˆJava Method Interfaceï¼‰</h2><p>ä»€ä¹ˆæ˜¯æœ¬åœ°æ–¹æ³•?</p>
<p>ç®€å•åœ°è®²ï¼Œä¸€ä¸ªNative Methodå°±æ˜¯ä¸€ä¸ªJavaè°ƒç”¨éJavaä»£ç çš„æ¥å£ã€‚ä¸€ä¸ªNative Methodæ˜¯è¿™æ ·ä¸€ä¸ªJavaæ–¹æ³•:è¯¥æ–¹æ³•çš„å®ç°ç”±éJavaè¯­è¨€å®ç°ï¼Œæ¯”å¦‚</p>
<p>Cã€‚è¿™ä¸ªç‰¹å¾å¹¶éJavaæ‰€ç‰¹æœ‰ï¼Œå¾ˆå¤šå…¶å®ƒçš„ç¼–ç¨‹è¯­è¨€éƒ½æœ‰è¿™ä¸€æœºåˆ¶ï¼Œæ¯”å¦‚åœ¨C++ä¸­ï¼Œä½ å¯ä»¥ç”¨extern â€œCâ€ å‘ŠçŸ¥C++ç¼–è¯‘å™¨å»è°ƒç”¨ä¸€ä¸ªCçš„å‡½æ•°ã€‚</p>
<p>â€œA native method is a Java method whose implementation is provided by non-java code.â€</p>
<p>åœ¨å®šä¹‰ä¸€ä¸ªnative methodæ—¶ï¼Œå¹¶ä¸æä¾›å®ç°ä½“(æœ‰äº›åƒå®šä¹‰ä¸€ä¸ªJava interface)ï¼Œå› ä¸ºå…¶å®ç°ä½“æ˜¯ç”±éjavaè¯­è¨€åœ¨å¤–é¢å®ç°çš„ã€‚</p>
<p>æœ¬åœ°æ¥å£çš„ä½œç”¨æ˜¯èåˆä¸åŒçš„ç¼–ç¨‹è¯­è¨€ä¸ºJavaæ‰€ç”¨ï¼Œå®ƒçš„åˆè¡·æ˜¯èåˆC&#x2F;C++ç¨‹åºã€‚</p>
<h2 id="æœ¬åœ°æ–¹æ³•æ ˆï¼ˆNative-Method-Stackï¼‰"><a href="#æœ¬åœ°æ–¹æ³•æ ˆï¼ˆNative-Method-Stackï¼‰" class="headerlink" title="æœ¬åœ°æ–¹æ³•æ ˆï¼ˆNative Method Stackï¼‰"></a>æœ¬åœ°æ–¹æ³•æ ˆï¼ˆNative Method Stackï¼‰</h2><p>Javaè™šæ‹Ÿæœºæ ˆç”¨äºç®¡ç†Javaæ–¹æ³•çš„è°ƒç”¨ï¼Œè€Œæœ¬åœ°æ–¹æ³•æ ˆç”¨äºç®¡ç†æœ¬åœ°æ–¹æ³•</p>
<p>çš„è°ƒç”¨ã€‚</p>
<p>æœ¬åœ°æ–¹æ³•æ ˆï¼Œä¹Ÿæ˜¯çº¿ç¨‹ç§æœ‰çš„ã€‚</p>
<p>å…è®¸è¢«å®ç°æˆå›ºå®šæˆ–è€…æ˜¯å¯åŠ¨æ€æ‰©å±•çš„å†…å­˜å¤§å°ã€‚(åœ¨å†…å­˜æº¢å‡ºæ–¹é¢æ˜¯ç›¸åŒçš„)</p>
<p>Ã˜ å¦‚æœçº¿ç¨‹è¯·æ±‚åˆ†é…çš„æ ˆå®¹é‡è¶…è¿‡æœ¬åœ°æ–¹æ³•æ ˆå…è®¸çš„æœ€å¤§å®¹é‡ï¼ŒJavaè™šæ‹Ÿæœºå°†ä¼šæŠ›å‡ºä¸€ä¸ªstackoverflowError å¼‚å¸¸ã€‚</p>
<p>Ã˜ å¦‚æœæœ¬åœ°æ–¹æ³•æ ˆå¯ä»¥åŠ¨æ€æ‰©å±•ï¼Œå¹¶ä¸”åœ¨å°è¯•æ‰©å±•çš„æ—¶å€™æ— æ³•ç”³è¯·åˆ°è¶³å¤Ÿçš„å†…å­˜ï¼Œæˆ–è€…åœ¨åˆ›å»ºæ–°çš„çº¿ç¨‹æ—¶æ²¡æœ‰è¶³å¤Ÿçš„å†…å­˜å»åˆ›å»ºå¯¹åº”çš„æœ¬åœ°æ–¹æ³•æ ˆï¼Œé‚£ä¹ˆJavaè™šæ‹Ÿæœºå°†ä¼šæŠ›å‡ºä¸€ä¸ªoutofMemoryError å¼‚å¸¸ã€‚</p>
<p>æœ¬åœ°æ–¹æ³•æ˜¯ä½¿ç”¨Cè¯­è¨€å®ç°çš„ã€‚</p>
<p>å®ƒçš„å…·ä½“åšæ³•æ˜¯Native Method stackä¸­ç™»è®°nativeæ–¹æ³•ï¼Œåœ¨Execution Engineæ‰§è¡Œæ—¶åŠ è½½æœ¬åœ°æ–¹æ³•åº“ã€‚</p>
<p>å½“æŸä¸ªçº¿ç¨‹è°ƒç”¨ä¸€ä¸ªæœ¬åœ°æ–¹æ³•æ—¶ï¼Œå®ƒå°±è¿›å…¥äº†ä¸€ä¸ªå…¨æ–°çš„å¹¶ä¸”ä¸å†å—è™šæ‹Ÿ</p>
<p>æœºé™åˆ¶çš„ä¸–ç•Œã€‚å®ƒå’Œè™šæ‹Ÿæœºæ‹¥æœ‰åŒæ ·çš„æƒé™ã€‚</p>
<p>Ã˜ æœ¬åœ°æ–¹æ³•å¯ä»¥é€šè¿‡æœ¬åœ°æ–¹æ³•æ¥å£æ¥è®¿é—®è™šæ‹Ÿæœºå†…éƒ¨çš„è¿è¡Œæ—¶æ•°æ®åŒºã€‚</p>
<p>Ã˜ å®ƒç”šè‡³å¯ä»¥ç›´æ¥ä½¿ç”¨æœ¬åœ°å¤„ç†å™¨ä¸­çš„å¯„å­˜å™¨</p>
<p>Ã˜ ç›´æ¥ä»æœ¬åœ°å†…å­˜çš„å †ä¸­åˆ†é…ä»»æ„æ•°é‡çš„å†…å­˜ã€‚</p>
<p>å¹¶ä¸æ˜¯æ‰€æœ‰çš„JVMéƒ½æ”¯æŒæœ¬åœ°æ–¹æ³•ã€‚å› ä¸ºJavaè™šæ‹Ÿæœºè§„èŒƒå¹¶æ²¡æœ‰æ˜ç¡®è¦æ±‚</p>
<p>æœ¬åœ°æ–¹æ³•æ ˆçš„ä½¿ç”¨è¯­è¨€ã€å…·ä½“å®ç°æ–¹å¼ã€æ•°æ®ç»“æ„ç­‰ã€‚å¦‚æœJVMäº§å“ä¸æ‰“ç®—æ”¯æŒnativeæ–¹æ³•ï¼Œä¹Ÿå¯ä»¥æ— éœ€å®ç°æœ¬åœ°æ–¹æ³•æ ˆã€‚</p>
<p>åœ¨Hotspot JVMä¸­ï¼Œ ç›´æ¥å°†æœ¬åœ°æ–¹æ³•æ ˆå’Œè™šæ‹Ÿæœºæ ˆåˆäºŒä¸ºä¸€ã€‚</p>
<h2 id="å †"><a href="#å †" class="headerlink" title="å †"></a>å †</h2><h3 id="å †çš„æ ¸å¿ƒæè¿°"><a href="#å †çš„æ ¸å¿ƒæè¿°" class="headerlink" title="å †çš„æ ¸å¿ƒæè¿°"></a>å †çš„æ ¸å¿ƒæè¿°</h3><ol>
<li><p>ä¸€ä¸ªJVMå®ä¾‹åªå­˜åœ¨ä¸€ä¸ªå †å†…å­˜ï¼Œå †ä¹Ÿæ˜¯ Java å†…å­˜ç®¡ç†çš„æ ¸å¿ƒåŒºåŸŸã€‚</p>
</li>
<li><p>Java å †åŒºåœ¨ JVM å¯åŠ¨çš„æ—¶å€™å³è¢«åˆ›å»ºï¼Œå…¶ç©ºé—´å¤§å°ä¹Ÿå°±ç¡®å®šäº†ã€‚æ˜¯ JVM ç®¡ç†çš„æœ€å¤§ä¸€å—å†…å­˜ç©ºé—´ã€‚</p>
</li>
<li><p>å †å†…å­˜çš„å¤§å°æ˜¯å¯ä»¥è°ƒèŠ‚çš„ã€‚</p>
</li>
<li><p>ã€ŠJavaè™šæ‹Ÿæœºè§„èŒƒã€‹è§„å®šï¼Œå †å¯ä»¥å¤„äºç‰©ç†ä¸Šä¸è¿ç»­çš„å†…å­˜ç©ºé—´ä¸­ï¼Œä½†åœ¨é€»è¾‘ä¸Šå®ƒåº”è¯¥è¢«è§†ä¸ºè¿ç»­çš„ã€‚</p>
</li>
<li><p><strong>æ‰€æœ‰çš„çº¿ç¨‹å…±äº«Javaå †ï¼Œå…±äº«æ•°æ®å¹¶å‘æ€§ä¸å¥½ï¼Œå› æ­¤åœ¨è¿™é‡Œè¿˜å¯ä»¥åˆ’åˆ†çº¿ç¨‹ç§æœ‰çš„ç¼“å†²åŒºï¼ˆThread Local Allocation Buffer, TLAB ã€‚</strong></p>
</li>
</ol>
<p><strong>ï¼ˆå³å †ä¸æ˜¯å…¨éƒ¨å…±äº«çš„ï¼‰</strong></p>
<p>â€‹	<strong>è®¾ç½®å †å†…å­˜ï¼šåˆå§‹ï¼ˆ-Xms20mï¼‰æœ€å¤§ï¼ˆ-Xmx20mï¼‰</strong></p>
<p>Ideaä¸­åœ¨vm options ä¸­è®¾ç½® -Xms å’Œ -Xmxï¼Œè¿è¡Œç¨‹åºï¼Œä½¿ç”¨ Jdk è‡ªå¸¦çš„ jvisualvm.exe æŸ¥çœ‹å †å†…å­˜çš„å¤§å°ã€‚</p>
<p>ç¤ºä¾‹ï¼šæ¯ä¸ªè¿›ç¨‹æ‹¥æœ‰ç‹¬ç«‹çš„ä¸€ä»½å †ç©ºé—´ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * å †å†…å­˜å¤§å°è®¾ç½®ï¼š</span></span><br><span class="line"><span class="comment"> * -Xms10m -Xmx10m</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HeadDemo01</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;start...&quot;</span>);</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            TimeUnit.SECONDS.sleep(<span class="number">1000</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(<span class="string">&quot;shutdown....&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * å †å†…å­˜å¤§å°è®¾ç½®ï¼š</span></span><br><span class="line"><span class="comment"> * -Xms15m -Xmx15m</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HeadDemo02</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;start...&quot;</span>);</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            TimeUnit.SECONDS.sleep(<span class="number">1000</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(<span class="string">&quot;shutdown....&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä½¿ç”¨ Jdk è‡ªå¸¦çš„ jvisualvm.exe æŸ¥çœ‹å †å†…å­˜çš„å¤§å°ï¼š</p>
<p>ã€æ³¨æ„ï¼šä½¿ç”¨ç®¡ç†å‘˜æƒé™è¿è¡Œï¼Œå¦åˆ™ä¼šæŠ¥ï¼š jvisualvm æ— æ³•æ£€æµ‹åˆ°æœ¬åœ°javaåº”ç”¨ç¨‹åºã€‘</p>
<p><img src="/images/%E4%BD%BF%E7%94%A8jvisualvm%E6%9F%A5%E7%9C%8B%E5%A0%86%E5%86%85%E5%AD%98%E5%A4%A7%E5%B0%8F.png" alt="ä½¿ç”¨jvisualvmæŸ¥çœ‹å †å†…å­˜å¤§å°.png"></p>
<ol start="6">
<li>ã€ŠJavaè™›æ‹Ÿæœºè§„èŒƒã€‹ä¸­å¯¹ Java å †çš„æè¿°æ˜¯ï¼š<strong>æ‰€æœ‰çš„å¯¹è±¡å®ä¾‹ä»¥åŠæ•°ç»„éƒ½åº”å½“åœ¨è¿è¡Œæ—¶åˆ†é…åœ¨å †ä¸Š</strong>ã€‚(The heap is the run-time data area from which memory for all cla3s instances and arrays is allocated )</li>
</ol>
<p>æ³¨æ„: â€œå‡ ä¹â€æ‰€æœ‰çš„å¯¹è±¡å®ä¾‹éƒ½åœ¨è¿™é‡Œåˆ†é…å†…å­˜ã€‚â€”â€”ä»å®é™…ä½¿ç”¨è§’åº¦çœ‹çš„ã€‚</p>
<ol start="7">
<li><strong>æ•°ç»„å’Œå¯¹è±¡å¯èƒ½æ°¸è¿œä¸ä¼šå­˜å‚¨åœ¨æ ˆä¸Šï¼Œå› ä¸ºæ ˆå¸§ä¸­ä¿å­˜å¼•ç”¨ï¼Œè¿™ä¸ªå¼•ç”¨æŒ‡å‘å¯¹è±¡æˆ–è€…æ•°ç»„åœ¨å †ä¸­çš„ä½ç½®ã€‚</strong></li>
</ol>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * å¯¹è±¡å¼•ç”¨æ¶ˆå¤±ï¼Œå †é‡Œé¢çš„å¯¹è±¡ä¸ä¼šç«‹å³GC</span></span><br><span class="line"><span class="comment"> * å¦‚æœGCè¿‡äºé¢‘ç¹ï¼Œå°±ä¼šå½±å“ç”¨æˆ·çº¿ç¨‹ï¼Œå¿…è¦æ—¶å¯ä»¥å°†å †å†…å­˜å¢å¤§</span></span><br><span class="line"><span class="comment"> * å…ˆè¿›è¡Œç¼–è¯‘ï¼Œå†ä½¿ç”¨jclasslibæŸ¥çœ‹è¯¦æƒ…</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SimpleHeap</span> &#123;</span><br><span class="line">    <span class="type">int</span> id;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">SimpleHeap</span><span class="params">(<span class="type">int</span> id)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.id = id;</span><br><span class="line">    &#125;</span><br><span class="line">	</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">SimpleHeap</span> <span class="variable">simpleHeap01</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SimpleHeap</span>(<span class="number">1</span>);</span><br><span class="line">        <span class="type">SimpleHeap</span> <span class="variable">simpleHeap02</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SimpleHeap</span>(<span class="number">1</span>);</span><br><span class="line">        <span class="type">int</span>[] arr01 = <span class="keyword">new</span> <span class="title class_">int</span>[<span class="number">10</span>];</span><br><span class="line">        Object[] arr02 = <span class="keyword">new</span> <span class="title class_">Object</span>[<span class="number">10</span>];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å­—èŠ‚ç ä¿¡æ¯ï¼šnew åˆ›å»ºå¯¹è±¡</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"> <span class="number">0</span> <span class="keyword">new</span> #<span class="number">3</span> &lt;com/example/java/SimpleHeap&gt;</span><br><span class="line"> <span class="number">3</span> dup</span><br><span class="line"> <span class="number">4</span> iconst_1</span><br><span class="line"> <span class="number">5</span> invokespecial #<span class="number">4</span> &lt;com/example/java/SimpleHeap.&lt;init&gt; : (I)V&gt;</span><br><span class="line"> <span class="number">8</span> astore_1</span><br><span class="line"> <span class="number">9</span> <span class="keyword">new</span> #<span class="number">3</span> &lt;com/example/java/SimpleHeap&gt;</span><br><span class="line"><span class="number">12</span> dup</span><br><span class="line"><span class="number">13</span> iconst_1</span><br><span class="line"><span class="number">14</span> invokespecial #<span class="number">4</span> &lt;com/example/java/SimpleHeap.&lt;init&gt; : (I)V&gt;</span><br><span class="line"><span class="number">17</span> astore_2</span><br><span class="line"><span class="number">18</span> bipush <span class="number">10</span></span><br><span class="line"><span class="number">20</span> newarray <span class="number">10</span> (<span class="type">int</span>)</span><br><span class="line"><span class="number">22</span> astore_3</span><br><span class="line"><span class="number">23</span> bipush <span class="number">10</span></span><br><span class="line"><span class="number">25</span> anewarray #<span class="number">5</span> &lt;java/lang/Object&gt;</span><br><span class="line"><span class="number">28</span> astore <span class="number">4</span></span><br><span class="line"><span class="number">30</span> <span class="keyword">return</span></span><br></pre></td></tr></table></figure>

<ol start="8">
<li><p>åœ¨æ–¹æ³•ç»“æŸåï¼Œå †ä¸­çš„å¯¹è±¡ä¸ä¼šé©¬ä¸Šè¢«ç§»é™¤ï¼Œä»…ä»…åœ¨åƒåœ¾æ”¶é›†çš„æ—¶å€™æ‰ä¼šè¢«ç§»é™¤ã€‚<strong>ã€é¢‘ç¹GCå½±å“ç”¨æˆ·è¿›ç¨‹çš„æ‰§è¡Œã€‘</strong></p>
</li>
<li><p>å †ï¼Œæ˜¯GCï¼ˆGarbage Collection, åƒåœ¾æ”¶é›†å™¨ï¼‰æ‰§è¡Œåƒåœ¾å›æ”¶çš„é‡ç‚¹åŒºåŸŸã€‚</p>
</li>
</ol>
<h3 id="å †çš„æ ¸å¿ƒæè¿°ï¼šå†…å­˜ç»†åˆ†"><a href="#å †çš„æ ¸å¿ƒæè¿°ï¼šå†…å­˜ç»†åˆ†" class="headerlink" title="å †çš„æ ¸å¿ƒæè¿°ï¼šå†…å­˜ç»†åˆ†"></a>å †çš„æ ¸å¿ƒæè¿°ï¼šå†…å­˜ç»†åˆ†</h3><p>ç°ä»£åƒåœ¾æ”¶é›†å™¨å¤§éƒ¨åˆ†åŸºäºåˆ†ä»£æ”¶é›†ç†è®ºè®¾è®¡ï¼Œå †ç©ºé—´ç»†åˆ†ä¸ºï¼š</p>
<p>Java 7 åŠä¹‹å‰å †å†…å­˜é€»è¾‘ä¸Šåˆ†ä¸ºä¸‰éƒ¨åˆ†ï¼šæ–°ç”ŸåŒº + å…»è€åŒº + &#x3D;&#x3D;æ°¸ä¹…åŒº&#x3D;&#x3D;</p>
<blockquote>
<p>Young Generation Space      æ–°ç”ŸåŒº    Young&#x2F;New	ã€åˆè¢«åˆ’åˆ†ä¸ºEdenåŒºå’ŒSurvivoråŒºã€‘</p>
<p>Tenure generation space      å…»è€åŒº    old&#x2F;Tenure</p>
<p>Permanent Space           æ°¸ä¹…åŒº    Perm</p>
</blockquote>
<p>Java 8åŠä¹‹åå †å†…å­˜é€»è¾‘ä¸Šåˆ†ä¸ºä¸‰éƒ¨åˆ†ï¼šæ–°ç”ŸåŒº + å…»è€åŒº + &#x3D;&#x3D;å…ƒç©ºé—´&#x3D;&#x3D;</p>
<blockquote>
<p>Young Generation Space      æ–°ç”ŸåŒº    Young&#x2F;New	ã€åˆè¢«åˆ’åˆ†ä¸ºEdenåŒºå’ŒSurvivoråŒºã€‘</p>
<p>Tenure generation space      å…»è€åŒº    old&#x2F;Tenure</p>
<p>Meta Space               å…ƒç©ºé—´    Meta</p>
</blockquote>
<p>ä¸€èˆ¬çº¦å®šï¼šã€æ–°ç”ŸåŒº &#x3D; æ–°ç”Ÿä»£ &#x3D; å¹´è½»ä»£		å…»è€åŒº &#x3D; è€å¹´åŒº &#x3D; è€å¹´ä»£		æ°¸ä¹…åŒº &#x3D; æ°¸ä¹…ä»£ã€‘</p>
<p><strong>Visual GC æ’ä»¶å®‰è£…ï¼š</strong></p>
<p>ä½¿ç”¨ jvisualvm æŸ¥çœ‹å †å†…å­˜è¯¦ç»†ä¿¡æ¯ï¼Œå®‰è£… Visual GC æ’ä»¶ã€ç›¸å½“äºä¸€ä¸ªå¯è§†åŒ–æ’ä»¶ã€‘ï¼šå·¥å…·|æ’ä»¶|æœç´¢|å®‰è£…|é‡å¯</p>
<p>å¦‚æœå®‰è£…å‡ºç°ç½‘ç»œé—®é¢˜ï¼Œåˆ™ä¿®æ”¹ URLï¼š<a href="https://visualvm.github.io/archive/uc/8u40/updates.xml.gz">https://visualvm.github.io/archive/uc/8u40/updates.xml.gz</a></p>
<p>ä½¿ç”¨ç¤ºä¾‹ï¼š</p>
<p>ä¿®æ”¹HeapDemo01ï¼š-Xms10m -Xmx10mï¼Œä½¿ç”¨  Visual GC æŸ¥çœ‹ï¼š</p>
<p>æ³¨æ„ï¼š<strong>ã€å…ƒç©ºé—´&#x2F;æ°¸ä¹…ä»£åªæ˜¯é€»è¾‘åŒºåŸŸã€‘</strong></p>
<p>![ä½¿ç”¨Visual GCæŸ¥çœ‹å †å†…å­˜ç©ºé—´å¤§å°.png](images&#x2F;ä½¿ç”¨Visual GCæŸ¥çœ‹å †å†…å­˜ç©ºé—´å¤§å°.png)</p>
<p>ä¸Šå›¾è¯´æ˜ï¼š</p>
<p><strong>Survivor 0å’ŒSurvivor 1å¯¹äºåƒåœ¾å›æ”¶åªèƒ½æœ‰ä¸€ä¸ªåŒºåŸŸå­˜å‚¨æ•°æ®ï¼Œæ–°ç”Ÿä»£çš„å¤§å°æ˜¯Eden Space+ Survivor0&#x2F;1ã€‚</strong></p>
<p>ä¹Ÿå¯ä»¥åœ¨æ§åˆ¶å°æ‰“å°<strong>ã€æ³¨æ„è¯¥å‚æ•°åœ¨ç¨‹åºè¿è¡Œå®Œæˆä»¥åæ‰ä¼šæ‰“å°ã€‘</strong>ï¼Œå¢åŠ  vm å‚æ•°ï¼š-XX:+PringGCDetails</p>
<p>ä¿®æ”¹ SimpleHeapï¼š-Xms10m -Xmx10m -XX:+PrintGCDetails</p>
<p>åˆ‡æ¢ä¸åŒçš„ jdk ç‰ˆæœ¬ï¼ŒæŸ¥çœ‹ Metaspace&#x2F;</p>
<p>å¯¹äºjdk8ï¼Œå¯¹åº”å…ƒç©ºé—´ Metaspaceï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Heap</span><br><span class="line"> PSYoungGen      total 2560K, used 1703K [<span class="number">0x00000000ffd00000</span>, <span class="number">0x0000000100000000</span>, <span class="number">0x0000000100000000</span>)</span><br><span class="line">  eden space 2048K, <span class="number">83</span>% used [<span class="number">0x00000000ffd00000</span>,<span class="number">0x00000000ffea9d50</span>,<span class="number">0x00000000fff00000</span>)</span><br><span class="line">  from space 512K, <span class="number">0</span>% used [<span class="number">0x00000000fff80000</span>,<span class="number">0x00000000fff80000</span>,<span class="number">0x0000000100000000</span>)</span><br><span class="line">  to   space 512K, <span class="number">0</span>% used [<span class="number">0x00000000fff00000</span>,<span class="number">0x00000000fff00000</span>,<span class="number">0x00000000fff80000</span>)</span><br><span class="line"> ParOldGen       total 7168K, used 0K [<span class="number">0x00000000ff600000</span>, <span class="number">0x00000000ffd00000</span>, <span class="number">0x00000000ffd00000</span>)</span><br><span class="line">  object space 7168K, <span class="number">0</span>% used [<span class="number">0x00000000ff600000</span>,<span class="number">0x00000000ff600000</span>,<span class="number">0x00000000ffd00000</span>)</span><br><span class="line"> Metaspace       used 3241K, capacity 4496K, committed 4864K, reserved 1056768K</span><br><span class="line">  <span class="keyword">class</span> <span class="title class_">space</span>    used 352K, capacity 388K, committed 512K, reserved 1048576K</span><br></pre></td></tr></table></figure>

<p>å¯¹äºjdk7ï¼Œå¯¹åº”å…ƒç©ºé—´ PSPermGenï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">PSYoungGen      total 3072K, used 1381K [<span class="number">0x00000000ffc80000</span>, <span class="number">0x0000000100000000</span>, <span class="number">0x0000000100000000</span>)</span><br><span class="line"> eden space 2560K, <span class="number">53</span>% used [<span class="number">0x00000000ffc80000</span>,<span class="number">0x00000000ffdd9710</span>,<span class="number">0x00000000fff00000</span>)</span><br><span class="line"> from space 512K, <span class="number">0</span>% used [<span class="number">0x00000000fff80000</span>,<span class="number">0x00000000fff80000</span>,<span class="number">0x0000000100000000</span>)</span><br><span class="line"> to   space 512K, <span class="number">0</span>% used [<span class="number">0x00000000fff00000</span>,<span class="number">0x00000000fff00000</span>,<span class="number">0x00000000fff80000</span>)</span><br><span class="line">ParOldGen       total 7168K, used 0K [<span class="number">0x00000000ff580000</span>, <span class="number">0x00000000ffc80000</span>, <span class="number">0x00000000ffc80000</span>)</span><br><span class="line"> object space 7168K, <span class="number">0</span>% used [<span class="number">0x00000000ff580000</span>,<span class="number">0x00000000ff580000</span>,<span class="number">0x00000000ffc80000</span>)</span><br><span class="line">PSPermGen       total 21504K, used 2905K [<span class="number">0x00000000fa380000</span>, <span class="number">0x00000000fb880000</span>, <span class="number">0x00000000ff580000</span>)</span><br><span class="line"> object space 21504K, <span class="number">13</span>% used [<span class="number">0x00000000fa380000</span>,<span class="number">0x00000000fa656538</span>,<span class="number">0x00000000fb880000</span>)</span><br></pre></td></tr></table></figure>

<h3 id="è®¾ç½®å †å†…å­˜çš„å¤§å°ä¸OOM"><a href="#è®¾ç½®å †å†…å­˜çš„å¤§å°ä¸OOM" class="headerlink" title="è®¾ç½®å †å†…å­˜çš„å¤§å°ä¸OOM"></a>è®¾ç½®å †å†…å­˜çš„å¤§å°ä¸OOM</h3><p>Javaå †åŒºç”¨äºå­˜å‚¨Javaå¯¹è±¡å®ä¾‹ï¼Œé‚£ä¹ˆå †çš„å¤§å°åœ¨ JVM å¯åŠ¨æ—¶å°±å·²ç»è®¾å®šå¥½äº†ï¼Œå¯ä»¥é€šè¿‡é€‰é¡¹ â€œ-Xmxâ€ å’Œ â€œ-Xmsâ€ æ¥è¿›è¡Œè®¾ç½®ã€‚</p>
<ul>
<li><p>â€œ-Xmsâ€ç”¨äºè¡¨ç¤ºå †åŒºçš„èµ·å§‹å†…å­˜<strong>ï¼ˆmemory startï¼‰</strong>ï¼Œç­‰ä»·äº -XX: InitialHeapSize</p>
</li>
<li><p>â€œ-Xmxâ€åˆ™ç”¨äºè¡¨ç¤ºå †åŒºçš„æœ€å¤§å†…å­˜ï¼Œç­‰ä»·äºï¼š-XX :MaxHeapSize</p>
</li>
</ul>
<p>ä¸€æ—¦å †åŒºä¸­çš„å†…å­˜å¤§å°è¶…è¿‡ â€œ-Xmxâ€ æ‰€æŒ‡å®šçš„æœ€å¤§å†…å­˜æ—¶ï¼Œå°†ä¼šæŠ›å‡º OutOfMemoryError å¼‚å¸¸ã€‚</p>
<p><strong>é€šå¸¸ä¼šå°† -Xms å’Œ -Xmx ä¸¤ä¸ªå‚æ•°é…ç½®ç›¸åŒçš„å€¼ï¼Œå…¶ç›®çš„æ˜¯ä¸ºäº†èƒ½å¤Ÿåœ¨ java åƒåœ¾å›æ”¶æœºåˆ¶æ¸…ç†å®Œå †åŒºåä¸éœ€è¦é‡æ–°åˆ†éš”è®¡ç®—å †åŒºçš„å¤§å°ï¼Œä»è€Œæé«˜æ€§èƒ½ã€‚</strong>ï¼ˆæ¯”å¦‚ä¸æ–­æ‰©å®¹å’Œç¼©å®¹ï¼Œé€ æˆç³»ç»Ÿå‹åŠ›ï¼‰</p>
<p>é»˜è®¤æƒ…å†µä¸‹ï¼Œ<strong>åˆå§‹å†…å­˜å¤§å°ï¼šç‰©ç†ç”µè„‘å†…å­˜å¤§å°&#x2F; 64ï¼Œæœ€å¤§å†…å­˜å¤§å°ï¼šç‰©ç†ç”µè„‘å†…å­˜å¤§å°&#x2F; 4</strong></p>
<p><strong>Runtimeå®ä¾‹ï¼šå•ä¾‹ï¼ˆè¿è¡Œæ—¶æ•°æ®åŒºï¼‰</strong></p>
<p>å‚æ•°è®¾ç½®ç½‘å€æŸ¥çœ‹ï¼š</p>
<p><a href="https://docs.oracle.com/javase/8/docs/technotes/tools/unix/java.html">https://docs.oracle.com/javase/8/docs/technotes/tools/unix/java.html</a></p>
<p>ç¨‹åºé»˜è®¤å †å†…å­˜å¤§å°ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * è®¾ç½®å †ç©ºé—´å¤§å°çš„å‚æ•°</span></span><br><span class="line"><span class="comment"> *      -Xms è®¾ç½®å †ç©ºé—´ï¼ˆæ–°ç”Ÿä»£+è€å¹´ä»£ï¼‰çš„åˆå§‹å†…å­˜å¤§å°</span></span><br><span class="line"><span class="comment"> *      -Xï¼šJVMè¿è¡Œå‚æ•°</span></span><br><span class="line"><span class="comment"> *      msï¼šmemory start</span></span><br><span class="line"><span class="comment"> * -Xmxï¼šç”¨æ¥è®¾ç½®å †ç©ºé—´ï¼ˆæ–°ç”Ÿä»£+è€å¹´ä»£ï¼‰çš„æœ€å¤§å†…å­˜å¤§å°</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * é»˜è®¤å†…å­˜å¤§å°ï¼š</span></span><br><span class="line"><span class="comment"> *      é»˜è®¤æƒ…å†µä¸‹ï¼Œåˆå§‹å†…å­˜å¤§å°ï¼šç‰©ç†ç”µè„‘å†…å­˜å¤§å°/ 64</span></span><br><span class="line"><span class="comment"> *      æœ€å¤§å†…å­˜å¤§å°ï¼šç‰©ç†ç”µè„‘å†…å­˜å¤§å°/ 4</span></span><br><span class="line"><span class="comment"> * é€šå¸¸ä¼šå°†-Xmså’Œ-Xmxä¸¤ä¸ªå‚æ•°é…ç½®ç›¸åŒçš„å€¼</span></span><br><span class="line"><span class="comment"> *      å…¶ç›®çš„æ˜¯ä¸ºäº†èƒ½å¤Ÿåœ¨javaåƒåœ¾å›æ”¶æœºåˆ¶æ¸…ç†å®Œå †åŒºåä¸éœ€è¦é‡æ–°åˆ†éš”è®¡ç®—å †åŒºçš„å¤§å°ï¼Œä»è€Œæé«˜æ€§èƒ½ã€‚</span></span><br><span class="line"><span class="comment"> *  æŸ¥çœ‹è®¾ç½®çš„å‚æ•°ï¼š</span></span><br><span class="line"><span class="comment"> *      æ–¹å¼ä¸€ï¼šjps     jstat -gc pid</span></span><br><span class="line"><span class="comment"> *      æ–¹å¼äºŒï¼š-XX:+PrintGCDetails</span></span><br><span class="line"><span class="comment"> * ä¿®æ”¹å †å†…å­˜ç©ºé—´å¤§å°ï¼š</span></span><br><span class="line"><span class="comment"> *  -Xms600m -Xmx600m</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HeapSpaceInitial</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">// è¿”å›Javaè™šæ‹Ÿæœºä¸­çš„å †å†…å­˜æ€»é‡</span></span><br><span class="line">        <span class="type">long</span> <span class="variable">initialMemory</span> <span class="operator">=</span> Runtime.getRuntime().totalMemory() / <span class="number">1024</span> / <span class="number">1024</span>;</span><br><span class="line">        <span class="comment">// è¿”å›Javaè™šæ‹Ÿæœºè¯•å›¾ä½¿ç”¨çš„æœ€å¤§å †å†…å­˜é‡</span></span><br><span class="line">        <span class="type">long</span> <span class="variable">maxMemory</span> <span class="operator">=</span> Runtime.getRuntime().maxMemory() / <span class="number">1024</span> / <span class="number">1024</span>;</span><br><span class="line">        System.out.println(<span class="string">&quot;initialMemory: &quot;</span> + initialMemory); <span class="comment">//575</span></span><br><span class="line">        System.out.println(<span class="string">&quot;maxMemory &quot;</span> + maxMemory); <span class="comment">//575</span></span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">&quot;ç³»ç»Ÿå†…å­˜å¤§å°ï¼š&quot;</span> + initialMemory * <span class="number">64</span> / <span class="number">1024</span> + <span class="string">&quot;G&quot;</span>);</span><br><span class="line">        <span class="comment">//7G    æ“ä½œç³»ç»Ÿä¼šå ç”¨ä¸€äº›å†…å­˜</span></span><br><span class="line">        System.out.println(<span class="string">&quot;ç³»ç»Ÿå†…å­˜å¤§å°ï¼š&quot;</span> + maxMemory * <span class="number">4</span> / <span class="number">1024</span> + <span class="string">&quot;G&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// é…åˆjstat -gc pid</span></span><br><span class="line">        <span class="comment">// ç¨‹åºè¿è¡Œå®Œæˆä»¥åï¼Œ-XX:+PrintGCDetailsæ‰ä¼šç”Ÿæ•ˆ</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Thread.sleep(<span class="number">1000000</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æŸ¥çœ‹è®¾ç½®çš„å‚æ•°ï¼š</p>
<p>æ–¹å¼ä¸€ï¼šä½¿ç”¨ jps + jstat æŸ¥çœ‹</p>
<p>jpsï¼šæŸ¥çœ‹ç¨‹åºè¿è¡Œçš„è¿›ç¨‹</p>
<p>jstat -gc 9581ï¼šæŸ¥çœ‹è¿›ç¨‹idä¸º 9581çš„å†…å­˜ä½¿ç”¨æƒ…å†µ</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">D:\Software\Java\jdk1<span class="number">.8</span><span class="number">.0_181</span>\bin&gt;jps</span><br><span class="line"><span class="number">18440</span> Jps</span><br><span class="line"><span class="number">15388</span> HeapSpaceInitial</span><br><span class="line"><span class="number">18908</span> Launcher</span><br><span class="line"></span><br><span class="line">D:\Software\Java\jdk1<span class="number">.8</span><span class="number">.0_181</span>\bin&gt;jstat -gc <span class="number">15388</span></span><br><span class="line"> S0C    S1C    S0U    S1U      EC       EU        OC         OU       MC     MU    CCSC   CCSU   YGC     YGCT    FGC    FGCT     GCT</span><br><span class="line"><span class="number">25600.0</span> <span class="number">25600.0</span>  <span class="number">0.0</span>    <span class="number">0.0</span>   <span class="number">153600.0</span> <span class="number">18432.1</span>   <span class="number">409600.0</span>     <span class="number">0.0</span>     <span class="number">4480.0</span> <span class="number">775.1</span>  <span class="number">384.0</span>   <span class="number">76.4</span>       <span class="number">0</span>    <span class="number">0.000</span>   <span class="number">0</span>      <span class="number">0.000</span>    <span class="number">0.000</span></span><br></pre></td></tr></table></figure>

<p><strong>è¯´æ˜ï¼šè™½ç„¶è®¾ç½®äº† -Xms600mï¼Œä½†æ˜¯æ‰“å°ç»“æœä¸º 575mï¼Œæ˜¯å› ä¸ºS0 å’Œ S1å¯¹äºåƒåœ¾å›æ”¶æ¥è¯´åªèƒ½æœ‰ä¸€ä¸ªå­˜å‚¨æ•°æ®ã€‚</strong></p>
<p>æ–¹å¼äºŒï¼š-XX:+PrintGCDetails</p>
<p>æ³¨æ„ï¼šç¨‹åºè¿è¡Œå®Œæˆä»¥åï¼Œ-XX:+PrintGCDetailsæ‰ä¼šç”Ÿæ•ˆ</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Heap</span><br><span class="line"> PSYoungGen      total 179200K, used 24576K [<span class="number">0x00000000f3800000</span>, <span class="number">0x0000000100000000</span>, <span class="number">0x0000000100000000</span>)</span><br><span class="line">  eden space 153600K, <span class="number">16</span>% used [<span class="number">0x00000000f3800000</span>,<span class="number">0x00000000f50000b8</span>,<span class="number">0x00000000fce00000</span>)</span><br><span class="line">  from space 25600K, <span class="number">0</span>% used [<span class="number">0x00000000fe700000</span>,<span class="number">0x00000000fe700000</span>,<span class="number">0x0000000100000000</span>)</span><br><span class="line">  to   space 25600K, <span class="number">0</span>% used [<span class="number">0x00000000fce00000</span>,<span class="number">0x00000000fce00000</span>,<span class="number">0x00000000fe700000</span>)</span><br><span class="line"> ParOldGen       total 409600K, used 0K [<span class="number">0x00000000da800000</span>, <span class="number">0x00000000f3800000</span>, <span class="number">0x00000000f3800000</span>)</span><br><span class="line">  object space 409600K, <span class="number">0</span>% used [<span class="number">0x00000000da800000</span>,<span class="number">0x00000000da800000</span>,<span class="number">0x00000000f3800000</span>)</span><br><span class="line"> Metaspace       used 3751K, capacity 4536K, committed 4864K, reserved 1056768K</span><br><span class="line">  <span class="keyword">class</span> <span class="title class_">space</span>    used 412K, capacity 428K, committed 512K, reserved 1048576K</span><br></pre></td></tr></table></figure>

<p>OOMæµ‹è¯•ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æµ‹è¯•OOM</span></span><br><span class="line"><span class="comment"> * -Xms200m -Xmx200m</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OOMTest</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        ArrayList&lt;BigDecimal&gt; pics = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                Thread.sleep(<span class="number">0</span>);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">            pics.add(<span class="keyword">new</span> <span class="title class_">BigDecimal</span>(<span class="keyword">new</span> <span class="title class_">Random</span>().nextInt(<span class="number">1024</span> * <span class="number">1024</span>)));</span><br><span class="line">            System.out.println(pics.size());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="å¹´è½»ä»£ä¸è€å¹´ä»£"><a href="#å¹´è½»ä»£ä¸è€å¹´ä»£" class="headerlink" title="å¹´è½»ä»£ä¸è€å¹´ä»£"></a>å¹´è½»ä»£ä¸è€å¹´ä»£</h3><p>å­˜å‚¨åœ¨ JVM ä¸­çš„ Java å¯¹è±¡å¯ä»¥è¢«åˆ’åˆ†ä¸ºä¸¤ç±»ï¼š</p>
<ul>
<li><p>ä¸€ç±»æ˜¯ç”Ÿå‘½å‘¨æœŸè¾ƒçŸ­çš„ç¬æ—¶å¯¹è±¡ï¼Œè¿™ç±»å¯¹è±¡çš„åˆ›å»ºå’Œæ¶ˆäº¡éƒ½éå¸¸è¿…é€Ÿã€‚</p>
</li>
<li><p>å¦å¤–ä¸€ç±»å¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸå´éå¸¸é•¿ï¼Œåœ¨æŸäº›æç«¯çš„æƒ…å†µä¸‹è¿˜èƒ½å¤Ÿä¸JVMçš„ç”Ÿå‘½å‘¨æœŸä¿æŒä¸€è‡´ã€‚ï¼ˆå¦‚è¿æ¥æ± ç­‰ï¼‰</p>
</li>
</ul>
<p>Java å †åŒºè¿›ä¸€æ­¥ç»†åˆ†çš„è¯ï¼Œå¯ä»¥åˆ’åˆ†ä¸ºå¹´è½»ä»£ï¼ˆYoungGenï¼‰å’Œè€å¹´ä»£ï¼ˆoldGenï¼‰</p>
<p>å…¶ä¸­å¹´è½»ä»£åˆå¯ä»¥åˆ’åˆ†ä¸º Eden ç©ºé—´ã€Survivor 0 ç©ºé—´å’Œ Survivor 1 ç©ºé—´ (æœ‰æ—¶ä¹Ÿå«åš from åŒºã€to åŒº)ã€‚</p>
<p>æ³¨æ„ï¼šæ°¸ä¹…ä»£å’Œå…ƒç©ºé—´åªæ˜¯é€»è¾‘å­˜å‚¨ã€‚åªèƒ½ä¿è¯ä¸€ä¸ª Survivor æœ‰æ•°æ®ï¼Œå¦ä¸€ä¸ª Survivor æœ‰ä¸€ä¸ªæ˜¯ä¸æ”¾æ•°æ®çš„ã€‚</p>
<p><img src="/images/%E5%B9%B4%E8%BD%BB%E4%BB%A3%E4%B8%8E%E8%80%81%E5%B9%B4%E4%BB%A3.png" alt="å¹´è½»ä»£ä¸è€å¹´ä»£.png"></p>
<p><strong>ï¼ˆ1ï¼‰è°ƒæ•´æ–°ç”Ÿä»£ä¸è€å¹´ä»£çš„å æ¯”ï¼š</strong></p>
<p>é…ç½®æ–°ç”Ÿä»£ä¸è€å¹´ä»£åœ¨å †ç»“æ„çš„å æ¯”ã€‚<strong>ã€ä¸€èˆ¬ä¸ä¼šè¿›è¡Œä¿®æ”¹ï¼Œé™¤éç”Ÿå‘½å‘¨æœŸé•¿çš„å¯¹è±¡å æ¯”å¾ˆå¤§ã€‘</strong></p>
<p>é»˜è®¤ -XX:NewRatio&#x3D;2ï¼Œè¡¨ç¤ºæ–°ç”Ÿä»£å 1ï¼Œè€å¹´ä»£å 2ï¼Œæ–°ç”Ÿä»£å æ•´ä¸ªå †çš„1&#x2F;3</p>
<p>å¯ä»¥ä¿®æ”¹ -XX:NewRatio&#x3D;4ï¼Œè¡¨ç¤ºæ–°ç”Ÿä»£å 1ï¼Œè€å¹´ä»£å 4ï¼Œæ–°ç”Ÿä»£å æ•´ä¸ªå †çš„1&#x2F;5ã€‚</p>
<p>ç¤ºä¾‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * è®¾ç½®æ–°ç”Ÿä»£ã€è€å¹´ä»£çš„å æ¯”</span></span><br><span class="line"><span class="comment"> * -XX:NewRation    è®¾ç½®æ–°ç”Ÿä»£ä¸è€å¹´ä»£çš„æ¯”ä¾‹ï¼Œé»˜è®¤æ˜¯2ï¼ˆ1:2ï¼‰</span></span><br><span class="line"><span class="comment"> * -XX:SurvivorRatio    è®¾ç½®æ–°ç”Ÿä»£ä¸­ Eden åŒºä¸ Survivor åŒºçš„æ¯”ä¾‹</span></span><br><span class="line"><span class="comment"> * -XX:-UseAdaptiveSizePolicy   å…³é—­è‡ªé€‚åº”å¾·å°”å†…å­˜åˆ†é…ç­–ç•¥</span></span><br><span class="line"><span class="comment"> * -Xmn300m     è®¾ç½®æ–°ç”Ÿä»£çš„ç©ºé—´çš„å¤§å°ï¼ˆä¸€èˆ¬ä¸è®¾ç½®ï¼‰</span></span><br><span class="line"><span class="comment"> * ä¿®æ”¹å‚æ•°ï¼š-Xms600m -Xmx600m -XX:NewRatio=4</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SurvivorTest</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;start&quot;</span>);</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Thread.sleep(<span class="number">1000000</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>ï¼ˆ2ï¼‰æŸ¥çœ‹æ–°ç”Ÿä»£è€å¹´ä»£çš„å æ¯”ï¼š</strong></p>
<ul>
<li>æ–¹å¼ä¸€ï¼šVisual GCæŸ¥çœ‹</li>
</ul>
<p><img src="/images/%E6%96%B0%E7%94%9F%E4%BB%A3%E8%80%81%E5%B9%B4%E4%BB%A3%E9%BB%98%E8%AE%A4%E5%8D%A0%E6%AF%94.png" alt="æ–°ç”Ÿä»£è€å¹´ä»£é»˜è®¤å æ¯”.png"></p>
<ul>
<li>æ–¹å¼äºŒï¼šjstat -gc pid</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">D:\Software\Java\jdk1.8.0_181\bin&gt;jps</span><br><span class="line">4980 Jps</span><br><span class="line">10024 Launcher</span><br><span class="line">3112 SurvivorTest</span><br><span class="line"></span><br><span class="line">D:\Software\Java\jdk1.8.0_181\bin&gt;jstat -gc 3112</span><br><span class="line"> S0C    S1C    S0U    S1U      EC       EU        OC         OU       MC     MU    CCSC   CCSU   YGC     YGCT    FGC    FGCT     GCT</span><br><span class="line">25600.0 25600.0  0.0    0.0   153600.0 73728.8   409600.0     0.0     4480.0 775.1  384.0   76.4       0    0.000   0      0.000    0.000</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ul>
<li>æ–¹å¼ä¸‰ï¼šjinfo -flag NewRatio pid</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">D:\Software\Java\jdk1.8.0_181\bin&gt;jinfo -flag NewRatio 3112</span><br><span class="line">-XX:NewRatio=2</span><br></pre></td></tr></table></figure>

<p><strong>ï¼ˆ3ï¼‰è°ƒæ•´æ–°ç”Ÿä»£ä¸­ Eden å’Œ Survivor çš„å æ¯”</strong></p>
<ul>
<li><p>åœ¨HotSpotä¸­ï¼ŒEdenç©ºé—´å’Œå¦å¤–ä¸¤ä¸ªSurvivorç©ºé—´ç¼ºçœæ‰€å çš„æ¯”ä¾‹æ˜¯ <strong>8:1:1</strong></p>
</li>
<li><p>å¼€å‘äººå‘˜å¯ä»¥é€šè¿‡é€‰é¡¹ <strong>â€œ-XX:SurvivorRatioâ€</strong> è°ƒæ•´è¿™ä¸ªç©ºé—´æ¯”ä¾‹ã€‚<strong>æ¯”å¦‚-XX:SurvivorRatio&#x3D;8</strong></p>
</li>
<li><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼šå‡ ä¹æ‰€æœ‰çš„Javaå¯¹è±¡éƒ½æ˜¯åœ¨EdenåŒºè¢«newå‡ºæ¥çš„ã€‚ç»å¤§éƒ¨åˆ†çš„Javaå¯¹è±¡çš„é”€æ¯éƒ½åœ¨æ–°ç”Ÿä»£è¿›è¡Œäº†ã€‚IBMå…¬å¸çš„ä¸“é—¨ç ”ç©¶è¡¨æ˜ï¼Œæ–°ç”Ÿä»£ä¸­80%çš„å¯¹è±¡éƒ½æ˜¯ â€œæœç”Ÿå¤•æ­»â€ çš„ã€‚</p>
</li>
<li><p>å¯ä»¥ä½¿ç”¨é€‰é¡¹ â€œ-Xmnâ€ è®¾ç½®æ–°ç”Ÿä»£æœ€å¤§å†…å­˜å¤§å°ï¼Œè¿™ä¸ªå‚æ•°ä¸€èˆ¬ä½¿ç”¨é»˜è®¤å€¼å°±å¯ä»¥ã€‚</p>
</li>
<li><p>è¿è¡Œç¨‹åºï¼Œç»“æœä¸æ˜¯ 8:1:1ï¼Œè€Œæ˜¯ 6:1:1</p>
<p>åŸå› ï¼š**-XX:SurvivorRatio** é»˜è®¤ä¸º8ï¼Œå•ç‹¬ä½¿ç”¨åˆå§‹æ—¶ç”Ÿæ•ˆï¼Œä½†æ˜¯ç”±äº <strong>-XX:+UseAdaptiveSizePolicy</strong>  é»˜è®¤å¼€å¯ï¼ŒåæœŸä¼šè‡ªåŠ¨è°ƒèŠ‚SurvivoråŒºçš„å¤§å°ï¼Œå–æ¶ˆè‡ªé€‚åº”ï¼ˆ-XX:-UseAdaptiveSizePolicyï¼‰å³å¯ä½¿å¾— -XX:SurvivorRatio ç”Ÿæ•ˆï¼</p>
<p><strong>æ³¨æ„ï¼šå¿…é¡»å¼ºåˆ¶æŒ‡å®š -XX:SurvivorRatio&#x3D;8ï¼Œå¦åˆ™å³ä½¿è®¾ç½® -XX:-UseAdaptiveSizePolicy ä¹Ÿä¸ç”Ÿæ•ˆã€‚</strong></p>
</li>
</ul>
<p><img src="/images/Eden%E4%B8%8ESurvivor%E5%8D%A0%E6%AF%94.png" alt="Edenä¸Survivorå æ¯”.png"></p>
<ul>
<li>ä½¿ç”¨ã€-Xmn300mã€‘è®¾ç½®æ–°ç”Ÿä»£å†…å­˜å¤§å°ï¼šå¦‚æœä½¿ç”¨-Xmn300må’Œ-XX:NewRatio&#x3D;8,åˆ™ä»¥-Xmn300mä¸ºå‡†</li>
</ul>
<p>ï¼ˆ4ï¼‰<strong>å‡ ç‚¹è¯´æ˜</strong></p>
<p><strong>å…³äºAdaptiveSizePolicy(è‡ªé€‚åº”å¤§å°ç­–ç•¥) çš„è¯´æ˜</strong></p>
<p>â€‹		JDK 1.8 é»˜è®¤ä½¿ç”¨ UseParallelGC åƒåœ¾å›æ”¶å™¨ï¼Œè¯¥åƒåœ¾å›æ”¶å™¨é»˜è®¤å¯åŠ¨äº† AdaptiveSizePolicyï¼Œä¼šæ ¹æ®GCçš„æƒ…å†µè‡ªåŠ¨è®¡ç®—è®¡ç®— Edenã€From å’Œ To åŒºçš„å¤§å°ï¼›</p>
<p>å‚æ•°é…ç½®ï¼š</p>
<p>â€‹		å¼€å¯ï¼š-XX:+UseAdaptiveSizePolicy<br>â€‹		å…³é—­ï¼š-XX:-UseAdaptiveSizePolicy</p>
<p><strong>&#x3D;&#x3D;æ³¨æ„äº‹é¡¹ï¼š&#x3D;&#x3D;</strong></p>
<ol>
<li><p>åœ¨ JDK 1.8 ä¸­ï¼Œå¦‚æœä½¿ç”¨ CMSï¼Œæ— è®º UseAdaptiveSizePolicy å¦‚ä½•è®¾ç½®ï¼Œéƒ½ä¼šå°† UseAdaptiveSizePolicy è®¾ç½®ä¸º falseï¼›ä¸è¿‡ä¸åŒç‰ˆæœ¬çš„JDKå­˜åœ¨å·®å¼‚ï¼›</p>
</li>
<li><p>UseAdaptiveSizePolicyä¸è¦å’ŒSurvivorRatioå‚æ•°æ˜¾ç¤ºè®¾ç½®æ­é…ä½¿ç”¨ï¼Œä¸€èµ·ä½¿ç”¨ä¼šå¯¼è‡´å‚æ•°å¤±æ•ˆï¼›</p>
</li>
<li><p>ç”±äºAdaptiveSizePolicyä¼šåŠ¨æ€è°ƒæ•´ Edenã€Survivor çš„å¤§å°ï¼Œæœ‰äº›æƒ…å†µå­˜åœ¨Survivor è¢«è‡ªåŠ¨è°ƒä¸ºå¾ˆå°ï¼Œæ¯”å¦‚åå‡ MBç”šè‡³å‡ MBçš„å¯èƒ½ï¼Œè¿™ä¸ªæ—¶å€™YGCå›æ”¶æ‰ EdenåŒºåï¼Œè¿˜å­˜æ´»çš„å¯¹è±¡è¿›å…¥Survivor è£…ä¸ä¸‹ï¼Œå°±ä¼šç›´æ¥æ™‹å‡åˆ°è€å¹´ä»£ï¼Œå¯¼è‡´è€å¹´ä»£å ç”¨ç©ºé—´é€æ¸å¢åŠ ï¼Œä»è€Œè§¦å‘FULL GCï¼Œå¦‚æœä¸€æ¬¡FULL GCçš„è€—æ—¶å¾ˆé•¿ï¼ˆæ¯”å¦‚åˆ°è¾¾å‡ ç™¾æ¯«ç§’ï¼‰ï¼Œé‚£ä¹ˆåœ¨è¦æ±‚é«˜å“åº”çš„ç³»ç»Ÿå°±æ˜¯ä¸å¯å–çš„ã€‚</p>
</li>
</ol>
<h3 id="å›¾åƒå¯¹è±¡çš„åˆ†é…è¿‡ç¨‹"><a href="#å›¾åƒå¯¹è±¡çš„åˆ†é…è¿‡ç¨‹" class="headerlink" title="å›¾åƒå¯¹è±¡çš„åˆ†é…è¿‡ç¨‹"></a>å›¾åƒå¯¹è±¡çš„åˆ†é…è¿‡ç¨‹</h3><h4 id="å¯¹è±¡åˆ†é…è¿‡ç¨‹æ¦‚è¿°"><a href="#å¯¹è±¡åˆ†é…è¿‡ç¨‹æ¦‚è¿°" class="headerlink" title="å¯¹è±¡åˆ†é…è¿‡ç¨‹æ¦‚è¿°"></a>å¯¹è±¡åˆ†é…è¿‡ç¨‹æ¦‚è¿°</h4><p>â€‹		ä¸ºæ–°å¯¹è±¡åˆ†é…å†…å­˜æ˜¯ä¸€ä»¶éå¸¸ä¸¥è°¨å’Œå¤æ‚çš„ä»»åŠ¡ï¼ŒJVMçš„è®¾è®¡è€…ä»¬ä¸ä»…éœ€è¦è€ƒè™‘å†…å­˜å¦‚ä½•åˆ†é…ã€åœ¨å“ªé‡Œåˆ†é…ç­‰é—®é¢˜ï¼Œå¹¶ä¸”ç”±äºå†…å­˜åˆ†é…ç®—æ³•ä¸å†…å­˜å›æ”¶ç®—æ³•å¯†åˆ‡ç›¸å…³ï¼Œæ‰€ä»¥è¿˜éœ€è¦è€ƒè™‘GCæ‰§è¡Œå®Œå†…å­˜å›æ”¶åæ˜¯å¦ä¼šåœ¨å†…å­˜ç©ºé—´ä¸­äº§ç”Ÿå†…å­˜ç¢ç‰‡ã€‚</p>
<p><strong>ï¼ˆ1ï¼‰åˆ†é…å›¾ç¤ºï¼š</strong></p>
<p><img src="/images/%E5%9B%BE%E8%A7%A3%E5%AF%B9%E8%B1%A1%E5%88%86%E9%85%8D%E8%BF%87%E7%A8%8B01.png" alt="å›¾è§£å¯¹è±¡åˆ†é…è¿‡ç¨‹01.png"></p>
<p>â€‹		ç¬¬ä¸€æ¬¡åˆ›å»ºçš„å¯¹è±¡ä¼šæ”¾åœ¨EdenåŒºï¼Œç­‰ Eden åŒºæ»¡ä¹‹å YGC ï¼ˆYoung GCï¼‰ä¼šå›æ”¶åƒåœ¾å¯¹è±¡ï¼Œå°†éåƒåœ¾å¯¹è±¡æ”¾åœ¨S0åŒºï¼Œæ ‡è®°æ¬¡æ•°ï¼ˆå¹´é¾„ï¼‰ä¸º1ã€‚</p>
<p><img src="/images/%E5%9B%BE%E8%A7%A3%E5%AF%B9%E8%B1%A1%E5%88%86%E9%85%8D%E8%BF%87%E7%A8%8B02.png" alt="å›¾è§£å¯¹è±¡åˆ†é…è¿‡ç¨‹02.png"></p>
<p>â€‹		ç¬¬äºŒæ¬¡EdenåŒºæ»¡ä¹‹åï¼ŒYGCä¼šå°†Edenå’ŒFromåŒºè¿›è¡Œåƒåœ¾å›æ”¶ï¼Œå°†éåƒåœ¾å¯¹è±¡æ”¾åœ¨ToåŒºï¼Œæ ‡è®°æ¬¡æ•°ï¼ˆageï¼‰ä¸º2ã€‚</p>
<p><img src="/images/%E5%9B%BE%E8%A7%A3%E5%AF%B9%E8%B1%A1%E5%88%86%E9%85%8D%E8%BF%87%E7%A8%8B03.png" alt="å›¾è§£å¯¹è±¡åˆ†é…è¿‡ç¨‹03.png"></p>
<p>â€‹		ä¾æ¬¡åå¤ï¼Œå½“å¯¹è±¡çš„æ ‡è®°æ¬¡æ•°è¾¾åˆ°é˜ˆå€¼ä»¥åï¼Œå°±ä¼šæ”¾å…¥è€å¹´ä»£ã€‚</p>
<p><strong>ï¼ˆ2ï¼‰æ³¨æ„äº‹é¡¹ï¼š</strong></p>
<ol>
<li><p>åªæœ‰Edenæ»¡äº†ä¹‹åæ‰ä¼šè§¦å‘åƒåœ¾å›æ”¶ï¼ŒS0å’ŒS1ä¸ä¼šè§¦å‘GCæœºåˆ¶ã€‚</p>
</li>
<li><p>ä¸ä¸€å®šéè¦ç­‰åˆ°é˜ˆå€¼æ‰ä¼šæ”¾åœ¨è€å¹´ä»£ï¼ŒEdenå’ŒSurvivorä¹Ÿå¯ä»¥ä¸è¾¾åˆ°é˜ˆå€¼å°±æ”¾åœ¨è€å¹´ä»£ã€‚</p>
</li>
<li><p>å¯¹å¹¸å­˜è€…s0,s1åŒºçš„æ€»ç»“ï¼šå¤åˆ¶ä¹‹åæœ‰äº¤æ¢ï¼Œè°ç©ºè°æ˜¯ to åŒºã€‚</p>
</li>
<li><p>å…³äºåƒåœ¾å›æ”¶ï¼šé¢‘ç¹åœ¨æ–°ç”ŸåŒºæ”¶é›†ï¼Œå¾ˆå°‘åœ¨å…»è€åŒºæ”¶é›†ï¼Œå‡ ä¹ä¸åœ¨æ°¸ä¹…åŒº &#x2F; å…ƒç©ºé—´æ”¶é›†ã€‚</p>
</li>
</ol>
<p><strong>ï¼ˆ3ï¼‰åˆ†é…æ­¥éª¤ï¼š</strong></p>
<p><img src="/images/%E5%9B%BE%E8%A7%A3%E5%AF%B9%E8%B1%A1%E5%88%86%E9%85%8D%E6%B5%81%E7%A8%8B.png" alt="å›¾è§£å¯¹è±¡åˆ†é…æµç¨‹.png"></p>
<ul>
<li><p>newçš„å¯¹è±¡å…ˆæ”¾ä¼Šç”¸å›­ï¼ˆEdenï¼‰åŒºï¼Œæ­¤åŒºæœ‰å¤§å°é™åˆ¶ã€‚</p>
</li>
<li><p>å½“ä¼Šç”¸å›­çš„ç©ºé—´å¡«æ»¡æ—¶ï¼Œç¨‹åºåˆéœ€è¦åˆ›å»ºå¯¹è±¡ï¼ŒJVMçš„åƒåœ¾å›æ”¶å™¨å°†å¯¹ä¼Šç”¸å›­åŒºè¿›è¡Œåƒåœ¾å›æ”¶ï¼ˆMinorGCï¼‰ã€‚</p>
<ul>
<li><p>å°†ä¼Šç”¸å›­åŒºä¸­çš„ä¸å†è¢«å…¶ä»–å¯¹è±¡æ‰€å¼•ç”¨çš„å¯¹è±¡è¿›è¡Œé”€æ¯ï¼Œç„¶åå°†ä¼Šç”¸å›­ä¸­çš„å‰©ä½™å¯¹è±¡ç§»åŠ¨åˆ°å¹¸å­˜è€…S0åŒºã€‚</p>
</li>
<li><p>æœŸé—´ç»å†è§¦å‘å¤šæ¬¡åƒåœ¾å›æ”¶ï¼Œæ­¤æ—¶ä¸Šæ¬¡å¹¸å­˜ä¸‹æ¥çš„æ”¾åˆ°å¹¸å­˜è€…0åŒºçš„ï¼Œå¦‚æœæ²¡æœ‰å›æ”¶ï¼Œå°±ä¼šæ”¾åˆ°å¹¸å­˜è€…1åŒºï¼Œä¾æ¬¡å¾€å¤ã€‚</p>
</li>
<li><p>å¦‚æœS0åŒºæ”¾ä¸ä¸‹å¯¹è±¡ï¼Œåˆ™æ–°åŠ å…¥çš„å¯¹è±¡ç›´æ¥æ”¾å…¥è€å¹´ä»£ã€‚å½“S0æˆ–S1ä¸­çš„å¯¹è±¡å­˜æ´»è¶…è¿‡é˜ˆå€¼ï¼ˆé»˜è®¤15æ¬¡ï¼‰æ—¶ï¼Œä¹Ÿä¼šæ™‹å‡ä¸ºè€å¹´ä»£ã€‚</p>
</li>
<li><p>å¯ä»¥è®¾ç½®å‚æ•°: -XX : MaxTenuringThreshold&#x3D;<N>è¿›è¡Œè®¾ç½®ã€‚</N></p>
</li>
</ul>
</li>
<li><p>Minor GCå®Œæˆåï¼Œå†åŠ è½½æ–°çš„å¯¹è±¡æ”¾åˆ°ä¼Šç”¸å›­åŒºï¼Œå¦‚æœ Eden æ”¾å¾—ä¸‹ï¼Œåˆ™åˆ†é…å†…å­˜ç©ºé—´ï¼Œæ”¾ä¸ä¸‹å°±ä¼šæ”¾å…¥è€å¹´ä»£iï¼Œå¦‚æœè€å¹´ä»£ä¹Ÿæ”¾ä¸ä¸‹ï¼Œæ¥ä¸‹æ¥å°±ä¼šè¿›è¡ŒFull GCï¼ŒFull GC å®Œæˆåï¼Œè€å¹´ä»£ä¾æ—§æ”¾ä¸ä¸‹ï¼Œå°±ä¼š OOMã€‚</p>
</li>
</ul>
<p>ç¨‹åºç¤ºä¾‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ¼”ç¤ºå†…å­˜åˆ†é…è¿‡ç¨‹</span></span><br><span class="line"><span class="comment"> * -Xms600m  -Xmx600m</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HeapInstanceTest</span> &#123;</span><br><span class="line">    <span class="type">byte</span>[] buffer =  <span class="keyword">new</span> <span class="title class_">byte</span>[<span class="keyword">new</span> <span class="title class_">Random</span>().nextInt(<span class="number">1024</span>*<span class="number">1024</span>)];</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">// listä¸€ç›´æœªè¢«å›æ”¶</span></span><br><span class="line">        ArrayList&lt;HeapInstanceTest&gt; list = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        <span class="keyword">while</span>(<span class="literal">true</span>)&#123;</span><br><span class="line">            list.add(<span class="keyword">new</span> <span class="title class_">HeapInstanceTest</span>());</span><br><span class="line">            <span class="keyword">try</span>&#123;</span><br><span class="line">                Thread.sleep(<span class="number">30</span>);</span><br><span class="line">            &#125;<span class="keyword">catch</span> (InterruptedException e)&#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>ä½¿ç”¨Visual GCæ¼”ç¤ºå†…å­˜åˆ†é…è¿‡ç¨‹ï¼š</strong></p>
<p><img src="/images/%E7%A8%8B%E5%BA%8F%E6%BC%94%E7%A4%BA%E5%86%85%E5%AD%98%E5%88%86%E9%85%8D%E8%BF%87%E7%A8%8B.png" alt="ç¨‹åºæ¼”ç¤ºå†…å­˜åˆ†é…è¿‡ç¨‹.png"></p>
<p><strong>ä½¿ç”¨å†…å­˜åˆ†æå·¥å…· jprofileræŸ¥çœ‹å†…å­˜åˆ†é…æƒ…å†µï¼š</strong></p>
<p>å®‰è£…ï¼šä¸‹è½½ jprofilerç¨‹åºï¼Œå®‰è£…å®Œæˆåï¼Œå†åœ¨ideaæ’ä»¶ä¸­å®‰è£…ï¼Œé€‰æ‹©å®‰è£…ä½ç½®å³å¯ã€‚</p>
<p>ä½¿ç”¨ç¤ºä¾‹ï¼š</p>
<p><img src="/images/%E5%86%85%E5%AD%98%E5%88%86%E6%9E%90%E5%B7%A5%E5%85%B7jprofiler%E4%BD%BF%E7%94%A8%E7%A4%BA%E4%BE%8B.png" alt="å†…å­˜åˆ†æå·¥å…·jprofilerä½¿ç”¨ç¤ºä¾‹.png"></p>
<p><strong>å¸¸ç”¨è°ƒä¼˜å·¥å…·</strong></p>
<p><strong>è°ƒä¼˜ï¼šå‡å°‘GC</strong></p>
<ul>
<li>JDKå‘½ä»¤è¡Œ</li>
<li>Eclipse:Memory Analyzer Tool</li>
<li>Jconsole</li>
<li>Visua1VM]</li>
<li>Jprofiler</li>
<li>Java Flight Recorder</li>
<li>GCViewer</li>
<li>GC Easy</li>
<li>Jprofilerçš„ä½¿ç”¨ï¼šä¸‹è½½Jprofilerï¼Œå®‰è£…jprofileræ’ä»¶</li>
</ul>
<h3 id="Minor-GCã€Major-GCã€Full-GC"><a href="#Minor-GCã€Major-GCã€Full-GC" class="headerlink" title="Minor GCã€Major GCã€Full GC"></a>Minor GCã€Major GCã€Full GC</h3><h4 id="éƒ¨åˆ†æ”¶é›†å’Œæ•´å †æ”¶é›†"><a href="#éƒ¨åˆ†æ”¶é›†å’Œæ•´å †æ”¶é›†" class="headerlink" title="éƒ¨åˆ†æ”¶é›†å’Œæ•´å †æ”¶é›†"></a>éƒ¨åˆ†æ”¶é›†å’Œæ•´å †æ”¶é›†</h4><p>â€‹		JVMåœ¨è¿›è¡ŒGCæ—¶ï¼Œå¹¶éæ¯æ¬¡éƒ½å¯¹ä¸Šé¢ä¸‰ä¸ªå†…å­˜(æ–°ç”Ÿä»£ã€è€å¹´ä»£ï¼›æ–¹æ³•åŒº)åŒºåŸŸä¸€èµ·å›æ”¶çš„ï¼Œå¤§éƒ¨åˆ†æ—¶å€™å›æ”¶çš„éƒ½æ˜¯æŒ‡æ–°ç”Ÿä»£ã€‚é’ˆå¯¹HotSpot VMçš„å®ç°ï¼Œå®ƒé‡Œé¢çš„GCæŒ‰ç…§å›æ”¶åŒºåŸŸåˆåˆ†ä¸ºä¸¤å¤§ç§ç±»å‹ï¼šä¸€ç§æ˜¯éƒ¨åˆ†æ”¶é›†(Partial GC)ï¼Œä¸€ç§æ˜¯æ•´å †æ”¶é›†(Full GC)ã€‚</p>
<ul>
<li><p>éƒ¨åˆ†æ”¶é›†ï¼šä¸æ˜¯å®Œæ•´æ”¶é›†æ•´ä¸ªJavaå †çš„åƒåœ¾æ”¶é›†ã€‚å…¶ä¸­åˆåˆ†ä¸ºï¼š</p>
<ul>
<li><p>æ–°ç”Ÿä»£æ”¶é›†(Minor GC &#x2F; Young GC) ï¼šåªæ˜¯æ–°ç”Ÿä»£(Eden\S0,S1) çš„åƒåœ¾æ”¶é›†ã€‚</p>
</li>
<li><p>è€å¹´ä»£æ”¶é›†(Major GC &#x2F; 0ld GC) ï¼šåªæ˜¯è€å¹´ä»£çš„åƒåœ¾æ”¶é›†ã€‚</p>
<p>â€‹	ç›®å‰ï¼Œåªæœ‰CMS GCä¼šæœ‰å•ç‹¬æ”¶é›†è€å¹´ä»£çš„è¡Œä¸ºã€‚</p>
<p>â€‹	æ³¨æ„ï¼Œå¾ˆå¤šæ—¶å€™ Major GC ä¼šå’Œ Full GC æ··æ·†ä½¿ç”¨ï¼Œéœ€è¦å…·ä½“åˆ†è¾¨æ˜¯è€å¹´ä»£å›æ”¶è¿˜æ˜¯æ•´å †å›æ”¶ã€‚</p>
</li>
<li><p>æ··åˆæ”¶é›†(Mixed GC)ï¼šæ”¶é›†æ•´ä¸ªæ–°ç”Ÿä»£ä»¥åŠéƒ¨åˆ†è€å¹´ä»£çš„åƒåœ¾æ”¶é›†ã€‚</p>
<p>ç›®å‰ï¼Œåªæœ‰G1 GCä¼šæœ‰è¿™ç§è¡Œä¸º</p>
</li>
</ul>
</li>
<li><p>æ•´å †æ”¶é›†(Full GC)ï¼šæ”¶é›†æ•´ä¸ªjavaå †å’Œæ–¹æ³•åŒºçš„åƒåœ¾æ”¶é›†ã€‚</p>
</li>
</ul>
<p><strong>&#x3D;&#x3D;è°ƒä¼˜ï¼šå‡å°‘GCæ¬¡æ•°ï¼ŒGCé¢‘ç¹ä¼šé˜»æ–­ç”¨æˆ·çº¿ç¨‹çš„æ‰§è¡Œã€‚&#x3D;&#x3D;</strong></p>
<h4 id="å¹´è½»ä»£GC-Minor-GC-è§¦å‘æœºåˆ¶"><a href="#å¹´è½»ä»£GC-Minor-GC-è§¦å‘æœºåˆ¶" class="headerlink" title="å¹´è½»ä»£GC(Minor GC) è§¦å‘æœºåˆ¶"></a>å¹´è½»ä»£GC(Minor GC) è§¦å‘æœºåˆ¶</h4><ol>
<li><p>å½“å¹´è½»ä»£ç©ºé—´ä¸è¶³æ—¶ï¼Œå°±ä¼šè§¦å‘ Minor GCï¼Œè¿™é‡Œçš„å¹´è½»ä»£æ»¡æŒ‡çš„æ˜¯ Eden ä»£æ»¡ï¼ŒSurvivor æ»¡ä¸ä¼šå¼•å‘ GCã€‚(æ¯æ¬¡ Minor GC ä¼šæ¸…ç†å¹´è½»ä»£çš„å†…å­˜ã€‚)</p>
</li>
<li><p>å› ä¸º Java å¯¹è±¡å¤§å¤šéƒ½å…·å¤‡æœç”Ÿå¤•ç­çš„ç‰¹æ€§ï¼Œæ‰€ä»¥ Minor GC éå¸¸é¢‘ç¹ï¼Œä¸€èˆ¬å›æ”¶é€Ÿåº¦ä¹Ÿæ¯”è¾ƒå¿«ã€‚è¿™ä¸€å®šä¹‰æ—¢æ¸…æ™°åˆæ˜“äºç†è§£ã€‚</p>
</li>
<li><p>Minor GC ä¼šå¼•å‘ STWï¼Œ æš‚åœå…¶å®ƒç”¨æˆ·çš„çº¿ç¨‹ï¼Œç­‰åƒåœ¾å›æ”¶ç»“æŸï¼Œç”¨æˆ·çº¿ç¨‹æ‰æ¢å¤è¿è¡Œã€‚</p>
</li>
</ol>
<h4 id="è€å¹´ä»£GC-Major-GC-x2F-Fu11-GC-è§¦å‘æœºåˆ¶"><a href="#è€å¹´ä»£GC-Major-GC-x2F-Fu11-GC-è§¦å‘æœºåˆ¶" class="headerlink" title="è€å¹´ä»£GC (Major GC&#x2F;Fu11 GC) è§¦å‘æœºåˆ¶"></a>è€å¹´ä»£GC (Major GC&#x2F;Fu11 GC) è§¦å‘æœºåˆ¶</h4><ol>
<li><p>æŒ‡å‘ç”Ÿåœ¨è€å¹´ä»£çš„GCï¼Œå¯¹è±¡ä»è€å¹´ä»£æ¶ˆå¤±æ—¶ï¼Œæˆ‘ä»¬è¯´ â€œMajor GCâ€ æˆ– â€œFull GCâ€ å‘ç”Ÿäº†ã€‚</p>
</li>
<li><p>å‡ºç°äº† Major GCï¼Œ ç»å¸¸ä¼šä¼´éšè‡³å°‘ä¸€æ¬¡çš„ Minor GC (ä½†éç»å¯¹çš„ï¼Œåœ¨Parallel Scavengeæ”¶é›†å™¨çš„æ”¶é›†ç­–ç•¥é‡Œå°±æœ‰ç›´æ¥è¿›è¡ŒMajor GCçš„ç­–ç•¥é€‰æ‹©è¿‡ç¨‹)ã€‚</p>
</li>
<li><p>ä¹Ÿå°±æ˜¯åœ¨è€å¹´ä»£ç©ºé—´ä¸è¶³æ—¶ï¼Œä¼šå…ˆå°è¯•è§¦å‘ Minor GCã€‚å¦‚æœä¹‹åç©ºé—´è¿˜ä¸è¶³ï¼Œåˆ™è§¦å‘ Major GCã€‚</p>
</li>
<li><p>Major GC çš„é€Ÿåº¦ä¸€èˆ¬ä¼šæ¯” Minor GC æ…¢10å€ä»¥ä¸Šï¼ŒSTW çš„æ—¶é—´æ›´é•¿ã€‚</p>
</li>
<li><p>å¦‚æœ Major GC åï¼Œå†…å­˜è¿˜ä¸è¶³ï¼Œå°±æŠ¥ OOM äº†ã€‚</p>
</li>
</ol>
<h4 id="Full-GCè§¦å‘æœºåˆ¶"><a href="#Full-GCè§¦å‘æœºåˆ¶" class="headerlink" title="Full GCè§¦å‘æœºåˆ¶"></a>Full GCè§¦å‘æœºåˆ¶</h4><p>è§¦å‘Full GCæ‰§è¡Œçš„æƒ…å†µæœ‰å¦‚ä¸‹äº”ç§ï¼š</p>
<p>(1) è°ƒç”¨ System. gc() æ—¶ï¼Œç³»ç»Ÿå»ºè®®æ‰§è¡Œ Full GCï¼Œä½†æ˜¯ä¸å¿…ç„¶æ‰§è¡Œã€‚</p>
<p>(2) è€å¹´ä»£ç©ºé—´ä¸è¶³</p>
<p>(3) æ–¹æ³•åŒºç©ºé—´ä¸è¶³</p>
<p>(4) é€šè¿‡ Minor GC åè¿›å…¥è€å¹´ä»£çš„å¹³å‡å¤§å°å¤§äºè€å¹´ä»£çš„å¯ç”¨å†…å­˜ã€‚</p>
<p>(5) ç”± Eden åŒºã€Survivors pacee (From Space) åŒºå‘ Survivor space1 (ToSpace) åŒºå¤åˆ¶æ—¶ï¼Œå¯¹è±¡å¤§å°å¤§äº To Spaceå¯ç”¨å†…å­˜ï¼Œåˆ™æŠŠè¯¥å¯¹è±¡è½¬å­˜åˆ°è€å¹´ä»£ï¼Œä¸”è€å¹´ä»£çš„å¯ç”¨å†…å­˜å°äºè¯¥å¯¹è±¡å¤§å°ã€‚</p>
<p>è¯´æ˜ï¼šfull gc æ˜¯å¼€å‘æˆ–è°ƒä¼˜ä¸­å°½é‡è¦é¿å…çš„ã€‚è¿™æ ·æš‚æ—¶æ—¶é—´ä¼šçŸ­ä¸€äº›ã€‚</p>
<h3 id="å¯¹è±¡åˆ†é…è¿‡ç¨‹ï¼šTLAB"><a href="#å¯¹è±¡åˆ†é…è¿‡ç¨‹ï¼šTLAB" class="headerlink" title="å¯¹è±¡åˆ†é…è¿‡ç¨‹ï¼šTLAB"></a>å¯¹è±¡åˆ†é…è¿‡ç¨‹ï¼šTLAB</h3><p><strong>TLABï¼ˆThread Local Allocation Bufferï¼‰</strong></p>
<p>ä¸ºä»€ä¹ˆä¼šæœ‰ TLABï¼Ÿ</p>
<ul>
<li>å †åŒºæ˜¯çº¿ç¨‹å…±äº«åŒºåŸŸï¼Œä»»ä½•çº¿ç¨‹éƒ½å¯ä»¥è®¿é—®åˆ°å †åŒºä¸­çš„å…±äº«æ•°æ®</li>
<li>ç”±äºå¯¹è±¡å®ä¾‹çš„åˆ›å»ºåœ¨JVMä¸­éå¸¸é¢‘ç¹ï¼Œå› æ­¤åœ¨å¹¶å‘ç¯å¢ƒä¸‹ä»å †åŒºä¸­åˆ’åˆ†å†…å­˜ç©ºé—´æ˜¯çº¿ç¨‹ä¸å®‰å…¨çš„</li>
<li>ä¸ºé¿å…å¤šä¸ªçº¿ç¨‹æ“ä½œåŒä¸€åœ°å€ï¼Œéœ€è¦ä½¿ç”¨åŠ é”ç­‰æœºåˆ¶ï¼Œè¿›è€Œå½±å“åˆ†é…é€Ÿåº¦</li>
</ul>
<p>jRocket æ²¡æœ‰æ°¸ä¹…ä»£</p>
<h2 id="åƒåœ¾å›æ”¶æ¦‚è¿°"><a href="#åƒåœ¾å›æ”¶æ¦‚è¿°" class="headerlink" title="åƒåœ¾å›æ”¶æ¦‚è¿°"></a>åƒåœ¾å›æ”¶æ¦‚è¿°</h2><h3 id="ä»€ä¹ˆæ˜¯åƒåœ¾"><a href="#ä»€ä¹ˆæ˜¯åƒåœ¾" class="headerlink" title="ä»€ä¹ˆæ˜¯åƒåœ¾"></a>ä»€ä¹ˆæ˜¯åƒåœ¾</h3><p>Javaç›¸æ¯”äºC++ï¼Œå¢åŠ äº†å†…å­˜åŠ¨æ€åˆ†é…ä»¥åŠåƒåœ¾å›æ”¶æœºåˆ¶ã€‚</p>
<p>åƒåœ¾æ”¶é›†ï¼Œä¸æ˜¯Javaè¯­è¨€çš„ä¼´ç”Ÿäº§ç‰©ã€‚æ—©åœ¨1960å¹´ï¼Œç¬¬ä¸€é—¨å¼€å§‹ä½¿ç”¨å†…å­˜åŠ¨æ€åˆ†é…å’Œåƒåœ¾æ”¶é›†æŠ€æœ¯çš„Lispè¯­è¨€è¯ç”Ÿã€‚<br>å…³äºåƒåœ¾æ”¶é›†æœ‰ä¸‰ä¸ªç»å…¸é—®é¢˜ï¼š</p>
<ul>
<li>å“ªäº›å†…å­˜éœ€è¦å›æ”¶?</li>
<li>ä»€ä¹ˆæ—¶å€™å›æ”¶?</li>
<li>å¦‚ä½•å›æ”¶ï¼Ÿ</li>
</ul>
<p>åƒåœ¾æ”¶é›†æœºåˆ¶æ˜¯ Java çš„æ‹›ç‰Œèƒ½åŠ›ï¼Œæå¤§åœ°æé«˜äº†å¼€å‘æ•ˆç‡ã€‚å¦‚ä»Šï¼Œåƒåœ¾æ”¶é›†å‡ ä¹æˆä¸ºç°ä»£è¯­è¨€çš„æ ‡é…ï¼Œå³ä½¿ç»è¿‡å¦‚æ­¤é•¿æ—¶é—´çš„å‘å±•ï¼ŒJavaçš„åƒåœ¾æ”¶é›†æœºåˆ¶ä»ç„¶åœ¨ä¸æ–­çš„æ¼”è¿›ä¸­ï¼Œä¸åŒå¤§å°çš„è®¾å¤‡ã€ä¸åŒç‰¹å¾çš„åº”ç”¨åœºæ™¯ï¼Œå¯¹åƒåœ¾æ”¶é›†æå‡ºäº†æ–°çš„æŒ‘æˆ˜ã€‚</p>
<p>ä»€ä¹ˆæ˜¯åƒåœ¾ï¼ˆGarbageï¼‰ï¼Ÿ</p>
<blockquote>
<p>åƒåœ¾æ˜¯æŒ‡åœ¨è¿è¡Œç¨‹åºä¸­æ²¡æœ‰ä»»ä½•æŒ‡é’ˆæŒ‡å‘çš„å¯¹è±¡ï¼Œè¿™ä¸ªå¯¹è±¡å°±æ˜¯éœ€è¦è¢«å›æ”¶çš„åƒåœ¾ã€‚<br>å¤–æ–‡:An object is considered garbage when it can no longer be reached from any pointer in the runningprogram.<br>å¦‚æœä¸åŠæ—¶å¯¹å†…å­˜ä¸­çš„åƒåœ¾è¿›è¡Œæ¸…ç†ï¼Œé‚£ä¹ˆï¼Œè¿™äº›åƒåœ¾å¯¹è±¡æ‰€å çš„å†…å­˜ç©ºé—´ä¼šä¸€ç›´ä¿ç•™åˆ°åº”ç”¨ç¨‹åºç»“æŸï¼Œè¢«ä¿ç•™çš„ç©ºé—´æ— æ³•è¢«å…¶ä»–å¯¹è±¡ä½¿ç”¨ã€‚ç”šè‡³å¯èƒ½å¯¼è‡´å†…å­˜æº¢å‡ºã€‚</p>
</blockquote>
<h3 id="ä¸ºä»€ä¹ˆéœ€è¦GC"><a href="#ä¸ºä»€ä¹ˆéœ€è¦GC" class="headerlink" title="ä¸ºä»€ä¹ˆéœ€è¦GC"></a>ä¸ºä»€ä¹ˆéœ€è¦GC</h3><ul>
<li>å¯¹äºé«˜çº§è¯­è¨€æ¥è¯´ï¼Œä¸€ä¸ªåŸºæœ¬è®¤çŸ¥æ˜¯å¦‚æœä¸è¿›è¡Œåƒåœ¾å›æ”¶ï¼Œ&#x3D;&#x3D;å†…å­˜è¿Ÿæ—©éƒ½ä¼šè¢«æ¶ˆè€—å®Œã€‚&#x3D;&#x3D;</li>
<li>é™¤äº†é‡Šæ”¾æ²¡ç”¨çš„å¯¹è±¡ï¼Œåƒåœ¾å›æ”¶ä¹Ÿå¯ä»¥æ¸…é™¤å†…å­˜é‡Œçš„è®°å½•ç¢ç‰‡ã€‚ç¢ç‰‡æ•´ç†å°†æ‰€å ç”¨çš„å †å†…å­˜ç§»åˆ°å †çš„ä¸€ç«¯ï¼Œä»¥ä¾¿ &#x3D;&#x3D;JVM å°†æ•´ç†å‡ºçš„å†…å­˜åˆ†é…ç»™æ–°çš„å¯¹è±¡ã€‚&#x3D;&#x3D;</li>
<li>éšç€åº”ç”¨ç¨‹åºæ‰€åº”ä»˜çš„ä¸šåŠ¡è¶Šæ¥è¶Šåºå¤§ã€å¤æ‚ï¼Œç”¨æˆ·è¶Šæ¥è¶Šå¤šï¼Œ&#x3D;&#x3D;æ²¡æœ‰ GC å°±ä¸èƒ½ä¿è¯åº”ç”¨ç¨‹åºçš„æ­£å¸¸è¿›è¡Œã€‚&#x3D;&#x3D;è€Œç»å¸¸é€ æˆSTW çš„ GC åˆè·Ÿä¸ä¸Šå®é™…çš„éœ€æ±‚ï¼Œæ‰€ä»¥æ‰ä¼šä¸æ–­åœ°å°è¯•å¯¹ GC è¿›è¡Œä¼˜åŒ–ã€‚</li>
</ul>
<h3 id="æ—©æœŸåƒåœ¾å›æ”¶"><a href="#æ—©æœŸåƒåœ¾å›æ”¶" class="headerlink" title="æ—©æœŸåƒåœ¾å›æ”¶"></a>æ—©æœŸåƒåœ¾å›æ”¶</h3><ul>
<li>åœ¨æ—©æœŸçš„C&#x2F;C++æ—¶ä»£ï¼Œåƒåœ¾å›æ”¶åŸºæœ¬ä¸Šæ˜¯æ‰‹å·¥è¿›è¡Œçš„ã€‚å¼€å‘äººå‘˜å¯ä»¥ä½¿ç”¨ new å…³é”®å­—è¿›è¡Œå†…å­˜ç”³è¯·ï¼Œå¹¶ä½¿ç”¨ delete å…³é”®å­—è¿›è¡Œå†…å­˜é‡Šæ”¾ã€‚æ¯”å¦‚ä»¥ä¸‹ä»£ç ï¼š</li>
</ul>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line">MibBridge *pBridge = <span class="keyword">new</span> <span class="built_in">cmBaseGroupBridge</span> ();</span><br><span class="line"><span class="comment">//å¦‚æœæ³¨å†Œå¤±è´¥ï¼Œä½¿ç”¨Deleteé‡Šæ”¾è¯¥å¯¹è±¡æ‰€å å†…å­˜åŒºåŸŸ</span></span><br><span class="line"><span class="keyword">if</span>(pBridge-&gt;<span class="built_in">Register</span> (kDestroy) != NO_ ERROR)</span><br><span class="line"><span class="keyword">delete</span> pBridge;</span><br></pre></td></tr></table></figure>

<ul>
<li>è¿™ç§æ–¹å¼å¯ä»¥çµæ´»æ§åˆ¶å†…å­˜é‡Šæ”¾çš„æ—¶é—´ï¼Œä½†æ˜¯ä¼šç»™å¼€å‘äººå‘˜å¸¦æ¥é¢‘ç¹ç”³è¯·å’Œé‡Šæ”¾å†…å­˜çš„ç®¡ç†è´Ÿæ‹…ã€‚å€˜è‹¥æœ‰ä¸€å¤„å†…å­˜åŒºé—´ç”±äºç¨‹åºå‘˜ç¼–ç çš„é—®é¢˜å¿˜è®°è¢«å›æ”¶ï¼Œé‚£ä¹ˆå°±ä¼šäº§ç”Ÿ&#x3D;&#x3D;å†…å­˜æ³„æ¼&#x3D;&#x3D;ï¼Œåƒåœ¾å¯¹è±¡æ°¸è¿œæ— æ³•è¢«æ¸…é™¤ï¼Œéšç€ç³»ç»Ÿè¿è¡Œæ—¶é—´çš„ä¸æ–­å¢é•¿ï¼Œåƒåœ¾å¯¹è±¡æ‰€è€—å†…å­˜å¯èƒ½æŒç»­ä¸Šå‡ï¼Œç›´åˆ°å‡ºç°å†…å­˜æº¢å‡ºå¹¶é€ æˆåº”ç”¨ç¨‹åºå´©æºƒã€‚</li>
</ul>
<p>åœ¨æœ‰äº†åƒåœ¾å›æ”¶æœºåˆ¶åï¼Œä¸Šè¿°ä»£ç å—ææœ‰å¯èƒ½å˜æˆè¿™æ ·ï¼š</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line">MibBridge *pBridge = <span class="keyword">new</span> <span class="built_in">cmBaseGroupBridge</span> ();</span><br><span class="line">pBridge-&gt;<span class="built_in">Register</span> (kDestroy);</span><br></pre></td></tr></table></figure>

<ul>
<li>ç°åœ¨ï¼Œé™¤äº†Javaä»¥å¤–ï¼ŒC#ã€Pythonã€Rubyç­‰è¯­è¨€éƒ½ä½¿ç”¨äº†è‡ªåŠ¨åƒåœ¾å›æ”¶çš„æ€æƒ³ï¼Œä¹Ÿæ˜¯æœªæ¥å‘å±•è¶‹åŠ¿ã€‚å¯ä»¥è¯´ï¼Œè¿™ç§è‡ªåŠ¨åŒ–çš„å†…å­˜åˆ†é…å’Œåƒåœ¾å›æ”¶çš„æ–¹å¼å·±ç»æˆä¸ºç°ä»£å¼€å‘è¯­è¨€å¿…å¤‡çš„æ ‡å‡†ã€‚</li>
</ul>
<h3 id="Java-è‡ªåŠ¨å†…å­˜ç®¡ç†ä»‹ç»"><a href="#Java-è‡ªåŠ¨å†…å­˜ç®¡ç†ä»‹ç»" class="headerlink" title="Java è‡ªåŠ¨å†…å­˜ç®¡ç†ä»‹ç»"></a>Java è‡ªåŠ¨å†…å­˜ç®¡ç†ä»‹ç»</h3><p>ä¼˜ç‚¹ï¼š</p>
<ul>
<li>è‡ªåŠ¨å†…å­˜ç®¡ç†ï¼Œæ— éœ€å¼€å‘äººå‘˜æ‰‹åŠ¨å‚ä¸å†…å­˜çš„åˆ†é…ä¸å›æ”¶ï¼Œè¿™æ ·é™ä½å†…å­˜æ³„æ¼å’Œå†…å­˜æº¢å‡ºçš„é£é™©ã€‚</li>
<li>æ²¡æœ‰åƒåœ¾å›æ”¶å™¨ï¼Œjavaä¹Ÿä¼šå’Œcppä¸€æ ·ï¼Œå„ç§æ‚¬å‚æŒ‡é’ˆï¼Œé‡æŒ‡é’ˆï¼Œæ³„éœ²é—®é¢˜ã€‚</li>
<li>è‡ªåŠ¨å†…å­˜ç®¡ç†æœºåˆ¶ï¼Œå°†ç¨‹åºå‘˜ä»ç¹é‡çš„å†…å­˜ç®¡ç†ä¸­é‡Šæ”¾å‡ºæ¥ï¼Œå¯ä»¥æ›´ä¸“å¿ƒåœ°ä¸“æ³¨äºä¸šåŠ¡å¼€å‘</li>
<li>oracleå®˜ç½‘å…³äºåƒåœ¾å›æ”¶çš„ä»‹ç»ï¼š<a href="https://docs.oracle.com/javase/8/docs/technotes/guides/vm/gctuning/toc.html">https://docs.oracle.com/javase/8/docs/technotes/guides/vm/gctuning/toc.html</a></li>
</ul>
<p>ç¼ºç‚¹ï¼š</p>
<ul>
<li>å¯¹äºJavaå¼€å‘äººå‘˜è€Œè¨€ï¼Œè‡ªåŠ¨å†…å­˜ç®¡ç†å°±åƒæ˜¯ä¸€ä¸ªé»‘åŒ£å­ï¼Œå¦‚æœè¿‡åº¦ä¾èµ–äºâ€œè‡ªåŠ¨â€ï¼Œé‚£ä¹ˆè¿™å°†ä¼šæ˜¯ä¸€åœºç¾éš¾ï¼Œæœ€ä¸¥é‡çš„å°±ä¼šå¼±åŒ–Javaå¼€å‘äººå‘˜åœ¨ç¨‹åºå‡ºç°å†…å­˜æº¢å‡ºæ—¶å®šä½é—®é¢˜å’Œè§£å†³é—®é¢˜çš„èƒ½åŠ›ã€‚</li>
<li>æ­¤æ—¶ï¼Œäº†è§£ JVM çš„è‡ªåŠ¨å†…å­˜åˆ†é…å’Œå†…å­˜å›æ”¶åŸç†å°±æ˜¾å¾—éå¸¸é‡è¦ï¼Œåªæœ‰åœ¨çœŸæ­£äº†è§£ JVM æ˜¯å¦‚ä½•ç®¡ç†å†…å­˜åï¼Œæˆ‘ä»¬æ‰èƒ½å¤Ÿåœ¨é‡è§ outofMemoryErroræ—¶ï¼Œå¿«é€Ÿåœ°æ ¹æ®é”™è¯¯å¼‚å¸¸æ—¥å¿—å®šä½é—®é¢˜å’Œè§£å†³é—®é¢˜ã€‚</li>
<li>å½“éœ€è¦æ’æŸ¥å„ç§å†…å­˜æº¢å‡ºã€å†…å­˜æ³„æ¼é—®é¢˜æ—¶ï¼Œå½“åƒåœ¾æ”¶é›†æˆä¸ºç³»ç»Ÿè¾¾åˆ°æ›´é«˜å¹¶å‘é‡çš„ç“¶é¢ˆæ—¶ï¼Œæˆ‘ä»¬å°±å¿…é¡»å¯¹è¿™äº›â€œè‡ªåŠ¨åŒ–â€çš„æŠ€æœ¯å®æ–½å¿…è¦çš„ç›‘æ§å’Œè°ƒèŠ‚ã€‚</li>
</ul>
<h2 id="åƒåœ¾å›æ”¶ç®—æ³•"><a href="#åƒåœ¾å›æ”¶ç®—æ³•" class="headerlink" title="åƒåœ¾å›æ”¶ç®—æ³•"></a>åƒåœ¾å›æ”¶ç®—æ³•</h2><h3 id="æ ‡è®°é˜¶æ®µï¼šå¼•ç”¨è®¡æ•°ç®—æ³•"><a href="#æ ‡è®°é˜¶æ®µï¼šå¼•ç”¨è®¡æ•°ç®—æ³•" class="headerlink" title="æ ‡è®°é˜¶æ®µï¼šå¼•ç”¨è®¡æ•°ç®—æ³•"></a>æ ‡è®°é˜¶æ®µï¼šå¼•ç”¨è®¡æ•°ç®—æ³•</h3><h4 id="å¯¹è±¡å­˜æ´»åˆ¤æ–­"><a href="#å¯¹è±¡å­˜æ´»åˆ¤æ–­" class="headerlink" title="å¯¹è±¡å­˜æ´»åˆ¤æ–­"></a>å¯¹è±¡å­˜æ´»åˆ¤æ–­</h4><p>åœ¨å †é‡Œå­˜æ”¾ç€å‡ ä¹æ‰€æœ‰çš„ Java å¯¹è±¡å®ä¾‹ï¼Œåœ¨ GC æ‰§è¡Œåƒåœ¾å›æ”¶ä¹‹å‰ï¼Œé¦–å…ˆéœ€è¦åŒºåˆ†å‡ºå†…å­˜ä¸­å“ªäº›æ˜¯å­˜æ´»å¯¹è±¡ï¼Œå“ªäº›æ˜¯å·²ç»æ­»äº¡çš„å¯¹è±¡ã€‚åªæœ‰è¢«æ ‡è®°ä¸ºå·±ç»æ­»äº¡çš„å¯¹è±¡ï¼ŒGC æ‰ä¼šåœ¨æ‰§è¡Œåƒåœ¾å›æ”¶æ—¶ï¼Œé‡Šæ”¾æ‰å…¶æ‰€å ç”¨çš„å†…å­˜ç©ºé—´ï¼Œå› æ­¤è¿™ä¸ªè¿‡ç¨‹æˆ‘ä»¬å¯ä»¥ç§°ä¸ºåƒåœ¾æ ‡è®°é˜¶æ®µã€‚<br>é‚£ä¹ˆåœ¨ JVM ä¸­ç©¶ç«Ÿæ˜¯å¦‚ä½•æ ‡è®°ä¸€ä¸ªæ­»äº¡å¯¹è±¡å‘¢ï¼Ÿ&#x3D;&#x3D;ç®€å•æ¥è¯´ï¼Œå½“ä¸€ä¸ªå¯¹è±¡å·²ç»ä¸å†è¢«ä»»ä½•çš„å­˜æ´»å¯¹è±¡ç»§ç»­å¼•ç”¨æ—¶ï¼Œå°±å¯ä»¥å®£åˆ¤ä¸ºå·²ç»æ­»äº¡ã€‚&#x3D;&#x3D;<br>åˆ¤æ–­å¯¹è±¡å­˜æ´»ä¸€èˆ¬æœ‰ä¸¤ç§æ–¹å¼ï¼š<strong>å¼•ç”¨è®¡æ•°ç®—æ³•å’Œå¯è¾¾æ€§åˆ†æç®—æ³•ã€‚</strong></p>
<h4 id="å¼•ç”¨è®¡æ•°ç®—æ³•çš„åŸç†ä¸ä¼˜ç¼ºç‚¹"><a href="#å¼•ç”¨è®¡æ•°ç®—æ³•çš„åŸç†ä¸ä¼˜ç¼ºç‚¹" class="headerlink" title="å¼•ç”¨è®¡æ•°ç®—æ³•çš„åŸç†ä¸ä¼˜ç¼ºç‚¹"></a>å¼•ç”¨è®¡æ•°ç®—æ³•çš„åŸç†ä¸ä¼˜ç¼ºç‚¹</h4><p>å¼•ç”¨è®¡æ•°ç®—æ³•ï¼ˆReference Countingï¼‰æ¯”è¾ƒç®€å•ï¼Œå¯¹æ¯ä¸ªå¯¹è±¡ä¿å­˜ä¸€ä¸ªæ•´å‹çš„å¼•ç”¨è®¡æ•°å™¨å±æ€§ã€‚ç”¨äºè®°å½•å¯¹è±¡è¢«å¼•ç”¨çš„æƒ…å†µã€‚<br>å¯¹äºä¸€ä¸ªå¯¹è±¡ Aï¼Œåªè¦æœ‰ä»»ä½•ä¸€ä¸ªå¯¹è±¡å¼•ç”¨äº† Aï¼Œåˆ™ A çš„å¼•ç”¨è®¡æ•°å™¨å°±åŠ  1ï¼›å½“å¼•ç”¨å¤±æ•ˆæ—¶ï¼Œå¼•ç”¨è®¡æ•°å™¨å°±å‡ 1ã€‚åªè¦å¯¹è±¡ A çš„å¼•ç”¨è®¡æ•°å™¨çš„å€¼ä¸º 0ï¼Œå³è¡¨ç¤ºå¯¹è±¡ A ä¸å¯èƒ½å†è¢«ä½¿ç”¨ï¼Œå¯è¿›è¡Œå›æ”¶ã€‚<br>ä¼˜ç‚¹ï¼šå®ç°ç®€å•ï¼Œåƒåœ¾å¯¹è±¡ä¾¿äºè¾¨è¯†ï¼›åˆ¤å®šæ•ˆç‡é«˜ï¼Œå›æ”¶æ²¡æœ‰å»¶è¿Ÿæ€§ã€‚<br>ç¼ºç‚¹ï¼š</p>
<ul>
<li><p>å®ƒéœ€è¦å•ç‹¬çš„å­—æ®µå­˜å‚¨è®¡æ•°å™¨ï¼Œè¿™æ ·çš„åšæ³•å¢åŠ äº†å­˜å‚¨ç©ºé—´çš„å¼€é”€ã€‚</p>
</li>
<li><p>æ¯æ¬¡èµ‹å€¼éƒ½éœ€è¦æ›´æ–°è®¡æ•°å™¨ï¼Œä¼´éšç€åŠ æ³•å’Œå‡æ³•æ“ä½œï¼Œè¿™å¢åŠ äº†æ—¶é—´å¼€é”€ã€‚</p>
</li>
<li><p>å¼•ç”¨è®¡æ•°å™¨æœ‰ä¸€ä¸ªä¸¥é‡çš„é—®é¢˜ï¼Œå³æ— æ³•å¤„ç†å¾ªç¯å¼•ç”¨çš„æƒ…å†µã€‚è¿™æ˜¯ä¸€æ¡è‡´å‘½ç¼ºé™·ï¼Œå¯¼è‡´åœ¨Javaçš„åƒåœ¾å›æ”¶å™¨ä¸­æ²¡æœ‰ä½¿ç”¨è¿™ç±»ç®—æ³•ã€‚</p>
<p><img src="/images/%E5%BC%95%E7%94%A8%E8%AE%A1%E6%95%B0%E7%AE%97%E6%B3%95-%E5%BE%AA%E7%8E%AF%E5%BC%95%E7%94%A8%E9%97%AE%E9%A2%98.png" alt="å¼•ç”¨è®¡æ•°ç®—æ³•-å¾ªç¯å¼•ç”¨é—®é¢˜.png"></p>
</li>
</ul>
<p>Java æ²¡æœ‰ä½¿ç”¨å¼•ç”¨è®¡æ•°ç®—æ³•ç¤ºä¾‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Javaæ²¡æœ‰ä½¿ç”¨å¼•ç”¨è®¡æ•°æ³•çš„éªŒè¯ï¼š</span></span><br><span class="line"><span class="comment"> * ä½¿ç”¨ -XX:+PrintGCDetails</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RefCountGC</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">byte</span>[] bigSize = <span class="keyword">new</span> <span class="title class_">byte</span>[<span class="number">5</span> * <span class="number">1024</span> * <span class="number">1024</span>];</span><br><span class="line"></span><br><span class="line">    <span class="type">Object</span> <span class="variable">reference</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">RefCountGC</span> <span class="variable">refCountGC01</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">RefCountGC</span>();</span><br><span class="line">        <span class="type">RefCountGC</span> <span class="variable">refCountGC02</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">RefCountGC</span>();</span><br><span class="line"></span><br><span class="line">        refCountGC01.reference = refCountGC02;</span><br><span class="line">        refCountGC02.reference = refCountGC01;</span><br><span class="line"></span><br><span class="line">        refCountGC01 = <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">        refCountGC02 = <span class="literal">null</span>;</span><br><span class="line">        <span class="comment">// æ˜¾å¼æ‰§è¡Œåƒåœ¾å›æ”¶è¡Œä¸º</span></span><br><span class="line"><span class="comment">//        System.gc();</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>â€‹		åœ¨ä½¿ç”¨ System.gc(); å’Œä¸ä½¿ç”¨çš„ä¸¤ç§æƒ…å†µä¸‹ï¼Œå†…å­˜å ç”¨çš„ç©ºé—´ä¸åŒï¼Œå› æ­¤æ²¡æœ‰ä½¿ç”¨å¼•ç”¨è®¡æ•°ï¼Œå¦‚æœä½¿ç”¨äº†å¼•ç”¨è®¡æ•°ï¼Œåˆ™å†…å­˜ä¸ä¼šè¢«å›æ”¶ï¼Œå› ä¸º refCountGC01 å’Œ refCountGC02 çš„ reference ç›¸äº’å¼•ç”¨ã€‚</p>
<p>æ€»ç»“ï¼š</p>
<blockquote>
<p>å¼•ç”¨è®¡æ•°ç®—æ³•ï¼Œæ˜¯å¾ˆå¤šè¯­è¨€çš„èµ„æºå›æ”¶é€‰æ‹©ï¼Œä¾‹å¦‚Pythonï¼Œå®ƒæ›´æ˜¯åŒæ—¶æ”¯æŒå¼•ç”¨è®¡æ•°å’Œåƒåœ¾æ”¶é›†æœºåˆ¶ã€‚<br>å…·ä½“å“ªç§æœ€ä¼˜æ˜¯è¦çœ‹åœºæ™¯çš„ï¼Œä¸šç•Œæœ‰å¤§è§„æ¨¡å®è·µä¸­ä»…ä¿ç•™å¼•ç”¨è®¡æ•°æœºåˆ¶ï¼Œä»¥æé«˜ååé‡çš„å°è¯•ã€‚<br>Javaå¹¶æ²¡æœ‰é€‰æ‹©å¼•ç”¨è®¡æ•°ï¼Œæ˜¯å› ä¸ºå…¶å­˜åœ¨ä¸€ä¸ªåŸºæœ¬çš„éš¾é¢˜ï¼Œä¹Ÿå°±æ˜¯å¾ˆéš¾å¤„ç†å¾ªç¯å¼•ç”¨å…³ç³»ã€‚<br>Pythonå¦‚ä½•è§£å†³å¾ªç¯å¼•ç”¨?</p>
<ol>
<li><p>æ‰‹åŠ¨è§£é™¤ï¼Œåœ¨åˆé€‚çš„æ—¶æœºï¼Œè§£é™¤å¼•ç”¨å…³ç³»ã€‚</p>
</li>
<li><p>ä½¿ç”¨å¼±å¼•ç”¨weakrefï¼Œ weakrefæ˜¯Pythonæä¾›çš„æ ‡å‡†åº“ï¼Œæ—¨åœ¨è§£å†³å¾ªç¯å¼•ç”¨ã€‚</p>
</li>
</ol>
</blockquote>
<h3 id="æ ‡è®°é˜¶æ®µï¼šå¯è¾¾æ€§åˆ†æç®—æ³•"><a href="#æ ‡è®°é˜¶æ®µï¼šå¯è¾¾æ€§åˆ†æç®—æ³•" class="headerlink" title="æ ‡è®°é˜¶æ®µï¼šå¯è¾¾æ€§åˆ†æç®—æ³•"></a>æ ‡è®°é˜¶æ®µï¼šå¯è¾¾æ€§åˆ†æç®—æ³•</h3><p>å¯è¾¾æ€§åˆ†æç®—æ³•ä¹Ÿç§°ä¸º æ ¹æœç´¢ç®—æ³•ã€å¯è¿½è¸ªæ€§ç®—æ³•ã€‚</p>
<p>ç›¸å¯¹äºå¼•ç”¨è®¡æ•°ç®—æ³•è€Œè¨€ï¼Œå¯è¾¾æ€§åˆ†æç®—æ³•ä¸ä»…åŒæ ·å…·å¤‡å®ç°ç®€å•å’Œæ‰§è¡Œé«˜æ•ˆç­‰ç‰¹ç‚¹ï¼Œæ›´é‡è¦çš„æ˜¯è¯¥ç®—æ³•å¯ä»¥æœ‰æ•ˆåœ°è§£å†³åœ¨å¼•ç”¨è®¡æ•°ç®—æ³•ä¸­å¾ªç¯å¼•ç”¨çš„é—®é¢˜ï¼Œé˜²æ­¢å†…å­˜æ³„æ¼çš„å‘ç”Ÿã€‚<br>ç›¸è¾ƒäºå¼•ç”¨è®¡æ•°ç®—æ³•ï¼Œè¿™é‡Œçš„å¯è¾¾æ€§åˆ†æå°±æ˜¯Javaã€C#é€‰æ‹©çš„ã€‚è¿™ç§ç±»å‹çš„åƒåœ¾æ”¶é›†é€šå¸¸ä¹Ÿå«ä½œè¿½è¸ªæ€§åƒåœ¾æ”¶é›†ï¼ˆTracing Garbage Collection) ã€‚</p>
<h4 id="GC-ROSTS"><a href="#GC-ROSTS" class="headerlink" title="GC ROSTS"></a>GC ROSTS</h4><p> æ‰€è°“â€GC Rootsâ€æ ¹é›†åˆå°±æ˜¯ä¸€ç»„å¿…é¡»æ´»è·ƒçš„å¼•ç”¨ã€‚<br>åŸºæœ¬æ€è·¯:<br>å¯è¾¾æ€§åˆ†æç®—æ³•æ˜¯ä»¥æ ¹å¯¹è±¡é›†åˆ(GC Roots)ä¸ºèµ·å§‹ç‚¹ï¼ŒæŒ‰ç…§ä»ä¸Šè‡³ä¸‹<br>çš„æ–¹å¼æœç´¢è¢«æ ¹å¯¹è±¡é›†åˆæ‰€è¿æ¥çš„ç›®æ ‡å¯¹è±¡æ˜¯å¦å¯è¾¾ã€‚</p>
<p>ä½¿ç”¨å¯è¾¾æ€§åˆ†æç®—æ³•åï¼Œå†…å­˜ä¸­çš„å­˜æ´»å¯¹è±¡éƒ½ä¼šè¢«æ ¹å¯¹è±¡é›†åˆç›´æ¥æˆ–é—´<br>æ¥è¿æ¥ç€ï¼Œæœç´¢æ‰€èµ°è¿‡çš„è·¯å¾„ç§°ä¸ºå¼•ç”¨é“¾(Reference Chain)<br>å¦‚æœç›®æ ‡å¯¹è±¡æ²¡æœ‰ä»»ä½•å¼•ç”¨é“¾ç›¸è¿ï¼Œåˆ™æ˜¯ä¸å¯è¾¾çš„ï¼Œå°±æ„å‘³ç€è¯¥å¯¹è±¡å·±ç»æ­»äº¡ï¼Œå¯ä»¥æ ‡è®°ä¸ºåƒåœ¾å¯¹è±¡ã€‚<br>åœ¨å¯è¾¾æ€§åˆ†æç®—æ³•ä¸­ï¼Œåªæœ‰èƒ½å¤Ÿè¢«æ ¹å¯¹è±¡é›†åˆç›´æ¥æˆ–è€…é—´æ¥è¿æ¥çš„å¯¹è±¡æ‰æ˜¯å­˜æ´»å¯¹è±¡ã€‚</p>
<p>åœ¨Javaè¯­è¨€ä¸­ï¼ŒG RootsåŒ…æ‹¬ä»¥ä¸‹å‡ ç±»å…ƒç´ :Â·è™šæ‹Ÿæœºæ ˆä¸­å¼•ç”¨çš„å¯¹è±¡</p>
<blockquote>
<p>æ¯”å¦‚:å„ä¸ªçº¿ç¨‹è¢«è°ƒç”¨çš„æ–¹æ³•ä¸­ä½¿ç”¨åˆ°çš„å‚æ•°ã€å±€éƒ¨å˜é‡ç­‰ã€‚æœ¬åœ°æ–¹æ³•æ ˆå†…JNI(é€šå¸¸è¯´çš„æœ¬åœ°æ–¹æ³•)å¼•ç”¨çš„å¯¹è±¡<br>Â·æ–¹æ³•åŒºä¸­ç±»é™æ€å±æ€§å¼•ç”¨çš„å¯¹è±¡<br>æ¯”å¦‚: Javaç±»çš„å¼•ç”¨ç±»å‹é™æ€å˜é‡.æ–¹æ³•åŒºä¸­å¸¸é‡å¼•ç”¨çš„å¯¹è±¡<br>æ¯”å¦‚:å­—ç¬¦ä¸²å¸¸é‡æ± (Sstring Tableï¼‰é‡Œçš„å¼•ç”¨æ‰€æœ‰è¢«åŒæ­¥é”synchronizedæŒæœ‰çš„å¯¹è±¡<br>Javaè™šæ‹Ÿæœºå†…éƒ¨çš„å¼•ç”¨ã€‚<br>åŸºæœ¬æ•°æ®ç±»å‹å¯¹åº”çš„Classå¯¹è±¡ï¼Œä¸€äº›å¸¸é©»çš„å¼‚å¸¸å¯¹è±¡ï¼ˆå¦‚:<br>NullPointerExceptionã€OutOfMemoryErrorï¼‰ï¼Œç³»ç»Ÿç±»åŠ è½½å™¨ã€‚<br>Â·åæ˜ iavaè™šæ‹Ÿæœºå†…éƒ¨æƒ…å†µçš„JMXBeanã€JVMTIä¸­æ³¨å†Œçš„å›è°ƒã€æœ¬åœ°ä»£ç ç¼“å­˜ç­‰ã€‚</p>
</blockquote>
<p>é™¤äº†è¿™äº›å›ºå®šçš„GC Rootsé›†åˆä»¥å¤–ï¼Œæ ¹æ®ç”¨æˆ·æ‰€é€‰ç”¨çš„åƒåœ¾æ”¶é›†å™¨ä»¥åŠå½“å‰å›æ”¶çš„å†…å­˜åŒºåŸŸä¸åŒï¼Œè¿˜å¯ä»¥æœ‰å…¶ä»–å¯¹è±¡â€œä¸´æ—¶æ€§â€åœ°åŠ å…¥ï¼Œå…±åŒæ„æˆå®Œæ•´GC Rootsé›†åˆã€‚æ¯”å¦‚ï¼šåˆ†ä»£æ”¶é›†å’Œå±€éƒ¨å›æ”¶(Partial GCï¼‰ã€‚</p>
<blockquote>
<p>å¦‚æœåªé’ˆå¯¹Javaå †ä¸­çš„æŸä¸€å—åŒºåŸŸè¿›è¡Œåƒåœ¾å›æ”¶ï¼ˆæ¯”å¦‚:å…¸å‹çš„åªé’ˆ<br>å¯¹æ–°ç”Ÿä»£ï¼‰ï¼Œå¿…é¡»è€ƒè™‘åˆ°å†…å­˜åŒºåŸŸæ˜¯è™šæ‹Ÿæœºè‡ªå·±çš„å®ç°ç»†èŠ‚ï¼Œæ›´ä¸æ˜¯å­¤ç«‹å°é—­çš„ï¼Œè¿™ä¸ªåŒºåŸŸçš„å¯¹è±¡å®Œå…¨æœ‰å¯èƒ½è¢«å…¶ä»–åŒºåŸŸçš„å¯¹è±¡æ‰€å¼•ç”¨ï¼Œè¿™æ—¶å€™å°±éœ€è¦ä¸€å¹¶å°†å…³è”çš„åŒºåŸŸå¯¹è±¡ä¹ŸåŠ å…¥GC Rootsé›†åˆä¸­å»è€ƒè™‘ï¼Œæ‰èƒ½ä¿è¯å¯è¾¾æ€§åˆ†æçš„å‡†ç¡®æ€§ã€‚<br>.å°æŠ€å·§ï¼š<br>ç”±äºRooté‡‡ç”¨æ ˆæ–¹å¼å­˜æ”¾å˜é‡å’ŒæŒ‡é’ˆï¼Œæ‰€ä»¥å¦‚æœä¸€ä¸ªæŒ‡é’ˆï¼Œå®ƒä¿å­˜äº†å †å†…å­˜é‡Œé¢çš„å¯¹è±¡ï¼Œä½†æ˜¯è‡ªå·±åˆä¸å­˜æ”¾åœ¨å †å†…å­˜é‡Œé¢ï¼Œé‚£å®ƒå°±æ˜¯ä¸€ä¸ªRoot ã€‚</p>
</blockquote>
<p>å¦‚æœè¦ä½¿åºœå¯è¾¾æ€§åˆ†æç®—æ³•æ¥åˆ¤æ–­å†…å­˜æ˜¯å¦å¯å›æ”¶ï¼Œé‚£ä¹ˆåˆ†æå·¥ä½œå¿…é¡»åœ¨ä¸€ä¸ªèƒ½ä¿éšœä¸€è‡´æ€§çš„å¿«ç…§ä¸­è¿›è¡Œã€‚è¿™ç‚¹ä¸æ»¡è¶³çš„è¯åˆ†æç»“æœçš„å‡†ç¡®æ€§å°±æ— æ³•ä¿è¯ã€‚<br>è¿™ç‚¹ä¹Ÿæ˜¯å¯¼è‡´Gcè¿›è¡Œæ—¶å¿…é¡» â€œStop The worldâ€ çš„ä¸€ä¸ªé‡è¦åŸå› ã€‚&gt;å³ä½¿æ˜¯å·ç§°ï¼ˆå‡ ä¹ï¼‰ä¸ä¼šå‘ç”Ÿåœé¡¿çš„CMs æ”¶é›†å™¨ä¸­ï¼Œæšä¸¾æ ¹èŠ‚ç‚¹æ—¶ä¹Ÿæ˜¯å¿…é¡»è¦åœé¡¿çš„ã€‚</p>
<h3 id="å¯¹è±¡çš„-finalization-æœºåˆ¶"><a href="#å¯¹è±¡çš„-finalization-æœºåˆ¶" class="headerlink" title="å¯¹è±¡çš„ finalization æœºåˆ¶"></a>å¯¹è±¡çš„ finalization æœºåˆ¶</h3><ul>
<li>Javaè¯­è¨€æä¾›äº†å¯¹è±¡ç»ˆæ­¢ï¼ˆfinalizationï¼‰æœºåˆ¶æ¥å…è®¸å¼€å‘äººå‘˜æä¾›å¯¹è±¡è¢«é”€æ¯ä¹‹å‰çš„è‡ªå®šä¹‰å¤„ç†é€»è¾‘ã€‚</li>
<li>å½“åƒåœ¾å›æ”¶å™¨å‘ç°æ²¡æœ‰å¼•ç”¨æŒ‡å‘ä¸€ä¸ªå¯¹è±¡ï¼Œå³ï¼šåƒåœ¾å›æ”¶æ­¤å¯¹è±¡ä¹‹å‰ï¼Œæ€»ä¼šå…ˆè°ƒç”¨è¿™ä¸ªå¯¹è±¡çš„ finalize() æ–¹æ³•ã€‚</li>
<li>finalize () æ–¹æ³•å…è®¸åœ¨å­ç±»ä¸­è¢«é‡å†™ï¼Œç”¨äºåœ¨å¯¹è±¡è¢«å›æ”¶æ—¶è¿›è¡Œèµ„æºé‡Šæ”¾ã€‚&#x3D;&#x3D;é€šå¸¸åœ¨è¿™ä¸ªæ–¹æ³•ä¸­è¿›è¡Œä¸€äº›èµ„æºé‡Šæ”¾å’Œæ¸…ç†çš„å·¥ä½œï¼Œæ¯”å¦‚å…³é—­æ–‡ä»¶ã€å¥—æ¥å­—å’Œæ•°æ®åº“è¿æ¥ç­‰ã€‚&#x3D;&#x3D;</li>
</ul>
<p><strong>æ³¨æ„äº‹é¡¹ï¼š</strong></p>
<ol>
<li>æ°¸è¿œä¸è¦ä¸»åŠ¨è°ƒç”¨æŸä¸ªå¯¹è±¡çš„finalize()æ–¹æ³•ï¼Œåº”è¯¥äº¤ç»™åƒåœ¾å›æ”¶æœºåˆ¶è°ƒç”¨ã€‚ç†ç”±åŒ…æ‹¬ä¸‹é¢ä¸‰ç‚¹ï¼š<ul>
<li>åœ¨finalize ()æ—¶å¯èƒ½ä¼šå¯¼è‡´å¯¹è±¡å¤æ´»ã€‚</li>
<li>finalize ()æ–¹æ³•çš„æ‰§è¡Œæ—¶é—´æ˜¯æ²¡æœ‰ä¿éšœçš„ï¼Œå®ƒå®Œå…¨ç”±Gcçº¿ç¨‹å†³å®šï¼Œæç«¯æƒ…å†µä¸‹ï¼Œè‹¥ä¸å‘ç”ŸGCï¼Œåˆ™ finalize () æ–¹æ³•å°†æ²¡æœ‰æ‰§è¡Œæœºä¼šã€‚</li>
<li>ä¸€ä¸ªç³Ÿç³•çš„ finalize () ä¼šä¸¥é‡å½±å“ GC çš„æ€§èƒ½ã€‚</li>
</ul>
</li>
<li>ä»åŠŸèƒ½ä¸Šæ¥è¯´ï¼Œfinalize ()æ–¹æ³•ä¸ C++ ä¸­çš„ææ„å‡½æ•°æ¯”è¾ƒç›¸ä¼¼ï¼Œä½†æ˜¯ Javaé‡‡ç”¨çš„æ˜¯åŸºäºåƒåœ¾å›æ”¶å™¨çš„è‡ªåŠ¨å†…å­˜ç®¡ç†æœºåˆ¶ï¼Œæ‰€ä»¥ finalize ()æ–¹æ³•åœ¨æœ¬è´¨ä¸Šä¸åŒäº C++ä¸­çš„ææ„å‡½æ•°ã€‚</li>
<li>ç”±äºfinalize ()æ–¹æ³•çš„å­˜åœ¨ï¼Œè™šæ‹Ÿæœºä¸­çš„å¯¹è±¡ä¸€èˆ¬å¤„äºä¸‰ç§å¯èƒ½çš„çŠ¶æ€ã€‚</li>
</ol>
<p>ä¸‰ç§çŠ¶æ€ï¼š</p>
<p>å¦‚æœä»æ‰€æœ‰çš„æ ¹èŠ‚ç‚¹éƒ½æ— æ³•è®¿é—®åˆ°æŸä¸ªå¯¹è±¡ï¼Œè¯´æ˜å¯¹è±¡å·±ç»ä¸å†ä½¿ç”¨äº†ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œæ­¤å¯¹è±¡éœ€è¦è¢«å›æ”¶ã€‚ä½†äº‹å®ä¸Šï¼Œä¹Ÿå¹¶éæ˜¯â€œéæ­»ä¸å¯â€çš„ï¼Œè¿™æ—¶å€™å®ƒä»¬æš‚æ—¶å¤„äºâ€œç¼“åˆ‘â€é˜¶æ®µã€‚ä¸€ä¸ªæ— æ³•è§¦åŠçš„å¯¹è±¡æœ‰å¯èƒ½åœ¨æŸä¸€ä¸ªæ¡ä»¶ä¸‹â€œå¤æ´»â€è‡ªå·±ï¼Œå¦‚æœè¿™æ ·ï¼Œé‚£ä¹ˆå¯¹å®ƒçš„å›æ”¶å°±æ˜¯ä¸åˆç†çš„ï¼Œä¸ºæ­¤ï¼Œå®šä¹‰è™šæ‹Ÿæœºä¸­çš„å¯¹è±¡å¯èƒ½çš„ä¸‰ç§çŠ¶æ€å¦‚ä¸‹:</p>
<ul>
<li><p>å¯è§¦åŠçš„ï¼šä»æ ¹èŠ‚ç‚¹å¼€å§‹ï¼Œå¯ä»¥åˆ°è¾¾è¿™ä¸ªå¯¹è±¡ã€‚</p>
</li>
<li><p>å¯å¤æ´»çš„ï¼šå¯¹è±¡çš„æ‰€æœ‰å¼•ç”¨éƒ½è¢«é‡Šæ”¾ï¼Œä½†æ˜¯å¯¹è±¡æœ‰å¯èƒ½åœ¨ finalize() ä¸­å¤æ´»ã€‚</p>
</li>
<li><p>ä¸å¯è§¦åŠçš„ï¼šå¯¹è±¡çš„finalize () è¢«è°ƒç”¨ï¼Œå¹¶ä¸”æ²¡æœ‰å¤æ´»ï¼Œé‚£ä¹ˆå°±ä¼šè¿›å…¥ä¸å¯è§¦åŠçŠ¶æ€ã€‚ä¸å¯è§¦åŠçš„å¯¹è±¡ä¸å¯èƒ½è¢«å¤æ´»ï¼Œå› ä¸º finalize() åªä¼šè¢«è°ƒç”¨ä¸€æ¬¡ã€‚</p>
<p>ä»¥ä¸Š3ç§çŠ¶æ€ä¸­ï¼Œæ˜¯ç”±äºfinalize ()æ–¹æ³•çš„å­˜åœ¨ï¼Œè¿›è¡Œçš„åŒºåˆ†ã€‚åªæœ‰åœ¨å¯¹è±¡ä¸å¯è§¦åŠæ—¶æ‰å¯ä»¥è¢«å›æ”¶ã€‚</p>
</li>
</ul>
<p>å…·ä½“è¿‡ç¨‹ï¼š</p>
<p>åˆ¤å®šä¸€ä¸ªå¯¹è±¡objAæ˜¯å¦å¯å›æ”¶ï¼Œè‡³å°‘è¦ç»å†ä¸¤æ¬¡æ ‡è®°è¿‡ç¨‹:ï¼Œ<br>1.å¦‚æœå¯¹è±¡objAåˆ°GC Rootsæ²¡æœ‰å¼•ç”¨é“¾ï¼Œåˆ™è¿›è¡Œç¬¬Tæ¬¡æ ‡è®°ã€‚<br>2.è¿›è¡Œç­›é€‰ï¼Œåˆ¤æ–­æ­¤å¯¹è±¡æ˜¯å¦æœ‰å¿…è¦æ‰§è¡Œfinalize()æ–¹æ³•<br>â‘ å¦‚æœå¯¹è±¡objAæ²¡æœ‰é‡ å†™finalize()æ–¹æ³•ï¼Œæˆ–è€…finalize ()æ–¹æ³•å·²ç»è¢«è™šæ‹Ÿæœºè°ƒç”¨è¿‡ï¼Œ<br>åˆ™è™šæ‹Ÿæœºè§†ä¸ºâ€œæ²¡æœ‰å¿…è¦æ‰§è¡Œâ€ï¼Œobj Aè¢«åˆ¤å®šä¸ºä¸å¯è§¦åŠçš„ã€‚<br>â‘¡å¦‚æœå¯¹è±¡objAé‡å†™äº† finalize()æ–¹æ³•ï¼Œä¸”è¿˜æœªæ‰§è¡Œè¿‡ï¼Œé‚£ä¹ˆobjAä¼šè¢«æ’å…¥åˆ°F- Queue<br>é˜Ÿåˆ—ä¸­ï¼Œç”±ä¸€ä¸ªè™šæ‹Ÿæœºè‡ªåŠ¨åˆ›å»ºçš„ã€ä½ä¼˜å…ˆçº§çš„F inalizerçº¿ç¨‹è§¦å‘å…¶finalize ()æ–¹<br>æ³•æ‰§è¡Œã€‚<br>â‘¢finalize() æ–¹æ³•æ˜¯å¯¹è±¡é€ƒè„±æ­»äº¡çš„æœ€åæœºä¼šï¼Œç¨åGcä¼šå¯¹F-Queueé˜Ÿåˆ—ä¸­çš„å¯¹è±¡è¿›è¡Œ<br>ç¬¬äºŒæ¬¡æ ‡è®°ã€‚å¦‚æœobjAåœ¨finalize()æ–¹æ³•ä¸­ä¸å¼•ç”¨é“¾ä¸Šçš„ä»»ä½•ä¸€ä¸ªå¯¹è±¡å»ºç«‹äº†è”ç³»ï¼Œ<br>é‚£ä¹ˆåœ¨ç¬¬äºŒæ¬¡æ ‡è®°æ—¶ï¼ŒobjAä¼šè¢«ç§»å‡ºâ€œå³å°†å›æ”¶â€é›†åˆã€‚ä¹‹åï¼Œå¯¹è±¡ä¼šå†æ¬¡å‡ºç°æ²¡æœ‰å¼•<br>ç”¨å­˜åœ¨çš„æƒ…å†µã€‚åœ¨è¿™ä¸ªæƒ…å†µä¸‹ï¼Œfinalizeæ–¹æ³•ä¸ä¼šè¢«å†æ¬¡è°ƒç”¨ï¼Œå¯¹è±¡ä¼šç›´æ¥å˜æˆä¸å¯è§¦<br>åŠçš„çŠ¶æ€ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œä¸€ä¸ªå¯¹è±¡çš„finalizeæ–¹æ³•åªä¼šè¢«è°ƒç”¨ä¸€æ¬¡ã€‚</p>
<h3 id="MAT-ä¸-jprofiler-çš„-GC-ROSTS-æº¯æº"><a href="#MAT-ä¸-jprofiler-çš„-GC-ROSTS-æº¯æº" class="headerlink" title="MAT ä¸ jprofiler çš„ GC ROSTS æº¯æº"></a>MAT ä¸ jprofiler çš„ GC ROSTS æº¯æº</h3><h3 id="æ¸…é™¤é˜¶æ®µï¼šæ ‡è®°-æ¸…é™¤ç®—æ³•"><a href="#æ¸…é™¤é˜¶æ®µï¼šæ ‡è®°-æ¸…é™¤ç®—æ³•" class="headerlink" title="æ¸…é™¤é˜¶æ®µï¼šæ ‡è®°-æ¸…é™¤ç®—æ³•"></a>æ¸…é™¤é˜¶æ®µï¼šæ ‡è®°-æ¸…é™¤ç®—æ³•</h3><h3 id="æ¸…é™¤é˜¶æ®µï¼šå¤åˆ¶ç®—æ³•"><a href="#æ¸…é™¤é˜¶æ®µï¼šå¤åˆ¶ç®—æ³•" class="headerlink" title="æ¸…é™¤é˜¶æ®µï¼šå¤åˆ¶ç®—æ³•"></a>æ¸…é™¤é˜¶æ®µï¼šå¤åˆ¶ç®—æ³•</h3><h3 id="æ¸…é™¤é˜¶æ®µï¼šæ ‡è®°-å‹ç¼©ç®—æ³•"><a href="#æ¸…é™¤é˜¶æ®µï¼šæ ‡è®°-å‹ç¼©ç®—æ³•" class="headerlink" title="æ¸…é™¤é˜¶æ®µï¼šæ ‡è®°-å‹ç¼©ç®—æ³•"></a>æ¸…é™¤é˜¶æ®µï¼šæ ‡è®°-å‹ç¼©ç®—æ³•</h3><h3 id="å°ç»“"><a href="#å°ç»“" class="headerlink" title="å°ç»“"></a>å°ç»“</h3><h3 id="åˆ†ä»£æ”¶é›†ç®—æ³•"><a href="#åˆ†ä»£æ”¶é›†ç®—æ³•" class="headerlink" title="åˆ†ä»£æ”¶é›†ç®—æ³•"></a>åˆ†ä»£æ”¶é›†ç®—æ³•</h3><h3 id="å¢é‡æ”¶é›†ç®—æ³•ã€åˆ†åŒºç®—æ³•"><a href="#å¢é‡æ”¶é›†ç®—æ³•ã€åˆ†åŒºç®—æ³•" class="headerlink" title="å¢é‡æ”¶é›†ç®—æ³•ã€åˆ†åŒºç®—æ³•"></a>å¢é‡æ”¶é›†ç®—æ³•ã€åˆ†åŒºç®—æ³•</h3><h2 id="åƒåœ¾å›æ”¶æ¦‚å¿µ"><a href="#åƒåœ¾å›æ”¶æ¦‚å¿µ" class="headerlink" title="åƒåœ¾å›æ”¶æ¦‚å¿µ"></a>åƒåœ¾å›æ”¶æ¦‚å¿µ</h2><h2 id="åƒåœ¾å›æ”¶å™¨"><a href="#åƒåœ¾å›æ”¶å™¨" class="headerlink" title="åƒåœ¾å›æ”¶å™¨"></a>åƒåœ¾å›æ”¶å™¨</h2>]]></content>
  </entry>
  <entry>
    <title>Html/Css</title>
    <url>/2023/02/28/HtmlCSS/</url>
    <content><![CDATA[<h1 id><a href="#" class="headerlink" title></a></h1><h1 id="Html-x2F-CSS"><a href="#Html-x2F-CSS" class="headerlink" title="Html&#x2F;CSS"></a>Html&#x2F;CSS</h1><h1 id="Html"><a href="#Html" class="headerlink" title="Html"></a>Html</h1><h2 id="ç½‘é¡µæ¦‚è¿°"><a href="#ç½‘é¡µæ¦‚è¿°" class="headerlink" title="ç½‘é¡µæ¦‚è¿°"></a>ç½‘é¡µæ¦‚è¿°</h2><p>â€‹		HTMLï¼š<strong>è¶…æ–‡æœ¬æ ‡è®°è¯­è¨€ï¼ˆHyperText Markup Languageï¼‰</strong></p>
<p>ç½‘é¡µç»“æ„ï¼š</p>
<p>ä¸€ä¸ªç½‘é¡µç”±ä¸‰éƒ¨åˆ†ç»„æˆï¼Œç»“æ„ã€è¡¨ç°ã€è¡Œä¸ºã€‚</p>
<p>ç»“æ„ï¼šä½¿ç”¨HTMLç¼–å†™ï¼Œé¡µé¢çš„æ•´ä½“çš„ç»“æ„ï¼Œå¦‚æ ‡é¢˜ã€æ®µè½ã€å›¾ç‰‡ã€éŸ³è§†é¢‘ç­‰ã€‚</p>
<p>è¡¨ç°ï¼šä½¿ç”¨CSSç¼–å†™ï¼Œé¡µé¢çš„å¤–åœ¨æ ·å¼ï¼Œå­—ä½“ã€é¢œè‰²ã€èƒŒæ™¯ç­‰ã€‚</p>
<p>è¡Œä¸ºï¼šä½¿ç”¨JavaScriptç¼–å†™ï¼Œé¡µé¢ä¸ç”¨æˆ·ä¹‹é—´çš„äº¤äº’è¡Œä¸ºã€‚</p>
<p>ä¸€èˆ¬è¦æ±‚ç»“æ„ã€è¡¨ç°ã€è¡Œä¸ºä¸‰è€…åˆ†ç¦»ã€‚</p>
<p>HTMLä½¿ç”¨æ ‡ç­¾çš„çš„å½¢å¼æ¥æ ‡è¯†ç½‘é¡µä¸­çš„ä¸åŒç»„æˆéƒ¨åˆ†ã€‚   </p>
<p>ç½‘é¡µçš„åŸºæœ¬ç»“æ„ï¼š</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!--DOCTYPEå£°æ˜HTMLçš„ç‰ˆæœ¬--&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--htmlæ ‡ç­¾ä¸åŒºåˆ†å¤§å°å†™ï¼Œå°½é‡å…¨éƒ¨å°å†™--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">	<span class="comment">&lt;!--headæ ‡ç­¾,æ˜¯å¯¹ç½‘é¡µå…ƒæ•°æ®çš„è¯´æ˜ï¼Œä¸€ä¸ªç½‘é¡µåªèƒ½æœ‰ä¸€ä¸ªæ ‡ç­¾--&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">		<span class="comment">&lt;!--titleæ ‡ç­¾ä¸­çš„æ–‡å­—ï¼Œæ˜¯é¡µé¢ä¼˜åŒ–çš„æœ€é‡è¦å› ç´ ã€‚åœ¨æœç´¢å¼•æ“çš„æœç´¢æ—¶æœ€å…ˆçœ‹åˆ°çš„ã€æœ€é†’ç›®çš„å†…å®¹--&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">title</span>&gt;</span>HTMLå…¥é—¨ç¤ºä¾‹<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">		<span class="comment">&lt;!--ä½¿ç”¨metaæ ‡ç­¾å¯ä»¥è®¾ç½®ç½‘é¡µçš„å…³é”®å­—--&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;keywords&quot;</span> <span class="attr">content</span>=<span class="string">&quot;HTMLï¼ŒCSSï¼ŒJavaScriptï¼ŒjQuery,Vue&quot;</span>/&gt;</span></span><br><span class="line">		<span class="comment">&lt;!--æŒ‡å®šç½‘é¡µçš„æè¿°ï¼Œæœç´¢å¼•æ“åœ¨æ£€ç´¢é¡µé¢æ—¶ï¼Œä¼šåŒæ—¶æ£€ç´¢é¡µé¢ä¸­çš„å…³é”®è¯å’Œæè¿°ï¼Œä½†æ˜¯è¿™ä¸¤ä¸ªå€¼ä¸ä¼šå½±å“é¡µé¢åœ¨æœç´¢å¼•æ“ä¸­çš„æ’å--&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;description&quot;</span> <span class="attr">content</span>=<span class="string">&quot;HTMLé¡µé¢çš„åŸºæœ¬ç¤ºä¾‹&quot;</span>&gt;</span></span><br><span class="line">		<span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">			ä½¿ç”¨metaå¯ä»¥ç”¨æ¥åšè¯·æ±‚çš„é‡å®šå‘,æŒ‡å®šç§’æ•°ä¹‹åä¼šè·³è½¬åˆ°æŒ‡å®šçš„ç›®æ ‡è·¯å¾„ã€‚</span></span><br><span class="line"><span class="comment">			&lt;meta http-equiv=&quot;refresh&quot; content=&quot;ç§’æ•°;url=ç›®æ ‡è·¯å¾„&quot; /&gt;</span></span><br><span class="line"><span class="comment">		--&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">&quot;refresh&quot;</span> <span class="attr">content</span>=<span class="string">&quot;3;url=http://www.baidu.com&quot;</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">		<span class="comment">&lt;!--bodyæ ‡ç­¾ä¸­æ˜¯HTMLé¡µé¢çš„å†…å®¹éƒ¨åˆ†--&gt;</span></span><br><span class="line">		<span class="comment">&lt;!--h1æ ‡ç­¾ï¼šæ ‡é¢˜æ ‡ç­¾ï¼Œæ˜¯æœç´¢å¼•æ“æ£€ç´¢çš„é‡è¦æ ‡ç­¾ï¼Œé‡è¦æ€§ä»…æ¬¡äºtitle--&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">h1</span>&gt;</span>Hello World!<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>



<h2 id="å¸¸ç”¨æ ‡ç­¾"><a href="#å¸¸ç”¨æ ‡ç­¾" class="headerlink" title="å¸¸ç”¨æ ‡ç­¾"></a>å¸¸ç”¨æ ‡ç­¾</h2><table>
<thead>
<tr>
<th><strong>æ ‡ç­¾å</strong></th>
<th><strong>å®šä¹‰</strong></th>
</tr>
</thead>
<tbody><tr>
<td><strong><hx></hx></strong></td>
<td>æ ‡é¢˜æ ‡ç­¾</td>
</tr>
<tr>
<td><strong><p></p></strong></td>
<td>æ®µè½æ ‡ç­¾</td>
</tr>
<tr>
<td><strong><hr></strong></td>
<td>æ°´å¹³çº¿æ ‡ç­¾</td>
</tr>
<tr>
<td><br></td>
<td>æ¢è¡Œæ ‡ç­¾</td>
</tr>
<tr>
<td><strong><div></div></strong></td>
<td>divæ ‡ç­¾</td>
</tr>
<tr>
<td><strong><span></span></strong></td>
<td>spanæ ‡ç­¾ï¼Œä¸€è¡Œä¸Šå¯ä»¥æ”¾å¤šä¸ªspanï¼Œä¸»è¦ç”¨ä½œæ–‡æœ¬å¤„ç†</td>
</tr>
<tr>
<td><strong><img></strong></td>
<td>å¼•å…¥å›¾ç‰‡</td>
</tr>
<tr>
<td><strong><a></a></strong></td>
<td>è¶…é“¾æ¥æ ‡ç­¾</td>
</tr>
<tr>
<td><strong><pre></pre></strong></td>
<td>é¢„æ ¼å¼åŒ–æ–‡æœ¬ï¼Œä¿ç•™ç©ºæ ¼å’Œæ¢è¡Œï¼Œç‹¬å ä¸€è¡Œ</td>
</tr>
<tr>
<td><strong><center></center></strong></td>
<td>å…ƒç´ å±…ä¸­æ˜¾ç¤º</td>
</tr>
</tbody></table>
<h2 id="å›¾åƒæ ‡ç­¾"><a href="#å›¾åƒæ ‡ç­¾" class="headerlink" title="å›¾åƒæ ‡ç­¾"></a>å›¾åƒæ ‡ç­¾</h2><table>
<thead>
<tr>
<th><strong>å±æ€§</strong></th>
<th><strong>å±æ€§å€¼æè¿°</strong></th>
</tr>
</thead>
<tbody><tr>
<td><strong>src</strong></td>
<td>å›¾ç‰‡çš„è·¯å¾„URI</td>
</tr>
<tr>
<td><strong>alt</strong></td>
<td>æ–‡æœ¬ï¼Œå›¾ç‰‡ä¸èƒ½æ˜¾ç¤ºæ—¶çš„æ›¿æ¢æ–‡æœ¬</td>
</tr>
<tr>
<td><strong>title</strong></td>
<td>é¼ æ ‡æ‚¬åœæ—¶æ˜¾ç¤ºçš„å†…å®¹</td>
</tr>
<tr>
<td><strong>border</strong></td>
<td>å›¾ç‰‡çš„è¾¹æ¡†</td>
</tr>
<tr>
<td><strong>width</strong></td>
<td>å›¾ç‰‡çš„å®½åº¦</td>
</tr>
<tr>
<td><strong>height</strong></td>
<td>å›¾ç‰‡çš„é«˜åº¦</td>
</tr>
</tbody></table>
<h2 id="æ–‡æœ¬æ ‡ç­¾"><a href="#æ–‡æœ¬æ ‡ç­¾" class="headerlink" title="æ–‡æœ¬æ ‡ç­¾"></a>æ–‡æœ¬æ ‡ç­¾</h2><table>
<thead>
<tr>
<th><strong>æ ‡ç­¾&#x2F;è¯­ä¹‰åŒ–æ ‡ç­¾</strong></th>
<th><strong>è¯­ä¹‰</strong></th>
</tr>
</thead>
<tbody><tr>
<td><strong><b></b><strong></strong></strong></td>
<td>æ–‡å­—ä»¥ç²—ä½“æ˜¾ç¤ºï¼ŒXHTMLæ¨èstrong</td>
</tr>
<tr>
<td><strong><i></i><em></em></strong></td>
<td>æ–‡å­—ä»¥æ–œä½“æ˜¾ç¤ºï¼ŒXHTMLæ¨èem</td>
</tr>
<tr>
<td><strong><s></s><del></del></strong></td>
<td>æ–‡å­—ä»¥åˆ é™¤çº¿æ˜¾ç¤ºï¼ŒXHTMLæ¨èdel</td>
</tr>
<tr>
<td><strong><u></u><ins></ins></strong></td>
<td>ä¸‹åˆ’çº¿ï¼ŒXHTMLæ¨èins</td>
</tr>
</tbody></table>
<p>ç¤ºä¾‹ï¼š</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">title</span>&gt;</span>å¸¸ç”¨æ ‡ç­¾ç¤ºä¾‹<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">span</span> <span class="attr">id</span>=<span class="string">&quot;head&quot;</span>&gt;</span>é”šç‚¹head<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">span</span> <span class="attr">name</span>=<span class="string">&quot;head&quot;</span>&gt;</span>é”šç‚¹head<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">h1</span>&gt;</span>h1æ ‡é¢˜æ ‡ç­¾<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">h2</span>&gt;</span>h2æ ‡é¢˜æ ‡ç­¾<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">h3</span>&gt;</span>h3æ ‡é¢˜æ ‡ç­¾<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">h6</span>&gt;</span>h6æ ‡é¢˜æ ‡ç­¾<span class="tag">&lt;/<span class="name">h6</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">p</span>&gt;</span>æ®µè½æ ‡ç­¾<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">hr</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">span</span>&gt;</span>æ–‡æœ¬æ ‡ç­¾span<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span>æ–‡æœ¬æ ‡ç­¾span<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">pre</span>&gt;</span></span><br><span class="line">			pre			é¢„æ ¼å¼æ–‡æœ¬ã€‚</span><br><span class="line">			å®ƒä¿ç•™äº†      ç©ºæ ¼</span><br><span class="line">			å’Œæ¢è¡Œã€‚</span><br><span class="line">		<span class="tag">&lt;/<span class="name">pre</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">center</span>&gt;</span>centerå±…ä¸­æ˜¾ç¤º<span class="tag">&lt;/<span class="name">center</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;../img/girl_0.jpeg&quot;</span> </span></span><br><span class="line"><span class="tag">             <span class="attr">alt</span>=<span class="string">&quot;alt:å›¾ç‰‡ä¸èƒ½æ˜¾ç¤ºæ—¶çš„æ›¿æ¢æ–‡æœ¬&quot;</span> </span></span><br><span class="line"><span class="tag">             <span class="attr">title</span>=<span class="string">&quot;titleï¼šé¼ æ ‡æ‚¬åœæ—¶çš„æ˜¾ç¤ºå†…å®¹&quot;</span> </span></span><br><span class="line"><span class="tag">             <span class="attr">border</span>=<span class="string">&quot;1&quot;</span> </span></span><br><span class="line"><span class="tag">             <span class="attr">width</span>=<span class="string">&quot;300px&quot;</span> </span></span><br><span class="line"><span class="tag">             <span class="attr">height</span>=<span class="string">&quot;200px&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">		<span class="tag">&lt;<span class="name">hr</span> /&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">b</span>&gt;</span>b åŠ ç²—<span class="tag">&lt;/<span class="name">b</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">i</span>&gt;</span>i å€¾æ–œ<span class="tag">&lt;/<span class="name">i</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">s</span>&gt;</span>s åˆ é™¤çº¿<span class="tag">&lt;/<span class="name">s</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">u</span>&gt;</span>u ä¸‹åˆ’çº¿<span class="tag">&lt;/<span class="name">u</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">strong</span>&gt;</span>strong åŠ ç²—<span class="tag">&lt;/<span class="name">strong</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">em</span>&gt;</span>em å€¾æ–œ<span class="tag">&lt;/<span class="name">em</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">del</span>&gt;</span>del åˆ é™¤çº¿<span class="tag">&lt;/<span class="name">del</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">ins</span>&gt;</span>ins ä¸‹åˆ’çº¿<span class="tag">&lt;/<span class="name">ins</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">hr</span>&gt;</span> 1+1<span class="symbol">&amp;lt;</span><span class="symbol">&amp;gt;</span>2<span class="symbol">&amp;nbsp;</span><span class="symbol">&amp;nbsp;</span><span class="symbol">&amp;quot;</span><span class="symbol">&amp;copy;</span>china<span class="symbol">&amp;quot;</span><span class="symbol">&amp;nbsp;</span>2<span class="symbol">&amp;times;</span>3<span class="symbol">&amp;divide;</span>1=6</span><br><span class="line">		<span class="tag">&lt;<span class="name">br</span> /&gt;</span></span><br><span class="line">		<span class="comment">&lt;!-- </span></span><br><span class="line"><span class="comment">			aæ ‡ç­¾ä¸­çš„targetå±æ€§å¯ä»¥ç”¨æ¥æŒ‡å®šæ‰“å¼€é“¾æ¥çš„ä½ç½®</span></span><br><span class="line"><span class="comment">				å¯é€‰å€¼ï¼š</span></span><br><span class="line"><span class="comment">					_selfï¼Œè¡¨ç¤ºåœ¨å½“å‰çª—å£ä¸­æ‰“å¼€ï¼ˆé»˜è®¤å€¼ï¼‰</span></span><br><span class="line"><span class="comment">					_blankï¼Œåœ¨æ–°çš„çª—å£ä¸­æ‰“å¼€é“¾æ¥</span></span><br><span class="line"><span class="comment">					å¯ä»¥è®¾ç½®ä¸€ä¸ªå†…è”æ¡†æ¶çš„nameå±æ€§å€¼ï¼Œé“¾æ¥å°†ä¼šåœ¨æŒ‡å®šçš„å†…è”æ¡†æ¶ä¸­æ‰“å¼€</span></span><br><span class="line"><span class="comment">		--&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;htmlé¡µé¢ç¤ºä¾‹.html&quot;</span> <span class="attr">target</span>=<span class="string">&quot;_blank&quot;</span>&gt;</span>è·³è½¬è‡³htmlé¡µé¢ç¤ºä¾‹.html<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;#head&quot;</span>&gt;</span>é”šç‚¹ï¼Œè·³è½¬è‡³ç½‘é¡µé¦–éƒ¨<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;<span class="name">br</span> /&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;&quot;</span> <span class="attr">target</span>=<span class="string">&quot;head&quot;</span>&gt;</span>é”šç‚¹ï¼Œè·³è½¬è‡³ç½‘é¡µé¦–éƒ¨<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;<span class="name">br</span> /&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>



<h2 id="é“¾æ¥æ ‡ç­¾"><a href="#é“¾æ¥æ ‡ç­¾" class="headerlink" title="é“¾æ¥æ ‡ç­¾"></a>é“¾æ¥æ ‡ç­¾</h2><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;è·³è½¬ç›®æ ‡&quot;</span> <span class="attr">target</span>=<span class="string">&quot;ç›®æ ‡çª—å£çš„å¼¹å‡ºæ–¹å¼&quot;</span>&gt;</span>æ–‡æœ¬æˆ–å›¾åƒ<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>hrefï¼šæŒ‡å®šé“¾æ¥ç›®æ ‡çš„ url åœ°å€ã€‚</p>
<p>targetï¼šæŒ‡å®šé“¾æ¥é¡µé¢çš„æ‰“å¼€æ–¹å¼ï¼Œå…¶å–å€¼æœ‰ self å’Œ blank ä¸¤ç§ï¼Œå…¶ä¸­ _self ä¸ºé»˜è®¤å€¼ï¼Œ__blankä¸ºåœ¨æ–°çª—å£ä¸­æ‰“å¼€æ–¹å¼ã€‚</p>
<p>â€‹				åŒæ—¶å¯ä»¥è®¾ç½®ä¸€ä¸ªå†…è”æ¡†æ¶çš„ name å±æ€§å€¼ï¼Œé“¾æ¥å°†ä¼šåœ¨æŒ‡å®šçš„å†…è”æ¡†æ¶ä¸­æ‰“å¼€ã€‚</p>
<p>é”šç‚¹å®šä½ï¼šé€šè¿‡åˆ›å»ºé”šç‚¹é“¾æ¥ï¼Œç”¨æˆ·èƒ½å¤Ÿå¿«é€Ÿå®šä½åˆ°ç›®æ ‡å†…å®¹ã€‚</p>
<p>å¯ä»¥åˆ†ä¸ºä¸¤ç§æ–¹å¼ï¼š<strong>ä¸€ç§ä½¿ç”¨idå’Œidé€‰æ‹©å™¨ï¼Œå¦ä¸€ç§ä½¿ç”¨nameå’Œtargetè·³è½¬ã€‚</strong></p>
<p>ç¤ºä¾‹ï¼š</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">	1.	ä½¿ç”¨ç›¸åº”çš„idåæ ‡æ³¨è·³è½¬ç›®æ ‡çš„ä½ç½®ã€‚</span></span><br><span class="line"><span class="comment">	2.	ä½¿ç”¨&lt;a href=&quot;#idå&quot;&gt;é“¾æ¥æ–‡æœ¬&lt;/a&gt;åˆ›å»ºé“¾æ¥æ–‡æœ¬ã€‚</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h3</span> <span class="attr">id</span>=<span class="string">&quot;head&quot;</span>&gt;</span>HEAD<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h3</span> <span class="attr">name</span>=<span class="string">&quot;head&quot;</span>&gt;</span>HEAD<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;#head&quot;</span>&gt;</span>To HEAD</span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;#&quot;</span> <span class="attr">target</span>=<span class="string">&quot;head &quot;</span>&gt;</span>To HEAD</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h2 id="åˆ—è¡¨"><a href="#åˆ—è¡¨" class="headerlink" title="åˆ—è¡¨"></a>åˆ—è¡¨</h2><p>æ— åºåˆ—è¡¨ï¼š</p>
<p>å±æ€§ï¼š<strong>type</strong></p>
<p>æ ‡è®°çš„æ ·å¼ï¼šç©ºå¿ƒåœ†ã€å®å¿ƒåœ†ã€çŸ©å½¢ã€‚</p>
<p>æœ‰åºåˆ—è¡¨ olï¼š</p>
<p>å±æ€§ï¼š<strong>type</strong></p>
<p>æ ‡è®°çš„æ ·å¼ï¼šæ•°å­—ã€å­—æ¯ã€ç½—é©¬æ•°å­—ã€‚</p>
<p>è‡ªå®šä¹‰åˆ—è¡¨dlï¼š</p>
<p>ç¤ºä¾‹ï¼š</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span><span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">ul</span> <span class="attr">type</span>=<span class="string">&quot;square&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">li</span>&gt;</span>Lemon<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">li</span>&gt;</span>Orange<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">li</span>&gt;</span>Apple<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">li</span>&gt;</span>Banana<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">ol</span> <span class="attr">type</span>=<span class="string">&quot;A&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">li</span>&gt;</span>æŸ æª¬<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">li</span>&gt;</span>æ©˜å­<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">li</span>&gt;</span>è‹¹æœ<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">li</span>&gt;</span>é¦™è•‰<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">ol</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">        å®šä¹‰åˆ—è¡¨ç”¨æ¥å¯¹ä¸€äº›è¯æ±‡æˆ–å†…å®¹è¿›è¡Œå®šä¹‰</span></span><br><span class="line"><span class="comment">        ä½¿ç”¨dlæ¥åˆ›å»ºä¸€ä¸ªå®šä¹‰åˆ—è¡¨</span></span><br><span class="line"><span class="comment">            dlä¸­æœ‰ä¸¤ä¸ªå­æ ‡ç­¾</span></span><br><span class="line"><span class="comment">                dt ï¼š è¢«å®šä¹‰çš„å†…å®¹ï¼Œtitle</span></span><br><span class="line"><span class="comment">                dd ï¼š å¯¹å®šä¹‰å†…å®¹çš„æè¿°ï¼Œdescription</span></span><br><span class="line"><span class="comment">        åŒæ ·dlå’Œulå’Œolä¹‹é—´éƒ½å¯ä»¥äº’ç›¸åµŒå¥—		</span></span><br><span class="line"><span class="comment">    --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dl</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dt</span>&gt;</span>é¢œè‰²<span class="tag">&lt;/<span class="name">dt</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dd</span>&gt;</span>çº¢<span class="tag">&lt;/<span class="name">dd</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dd</span>&gt;</span>ç»¿<span class="tag">&lt;/<span class="name">dd</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dt</span>&gt;</span>çˆ±å¥½<span class="tag">&lt;/<span class="name">dt</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dd</span>&gt;</span>Java<span class="tag">&lt;/<span class="name">dd</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dd</span>&gt;</span>JavaScript<span class="tag">&lt;/<span class="name">dd</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dl</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>



<h2 id="è¡¨æ ¼"><a href="#è¡¨æ ¼" class="headerlink" title="è¡¨æ ¼"></a>è¡¨æ ¼</h2><p><strong>ä½œç”¨ï¼šæ˜¾ç¤ºæ•°æ®ã€‚åŒ…æ‹¬<table>ã€<tr>ã€<td>ã€<th>ã€<caption>ã€<thead>ã€<tbody>ã€<tfoot>ã€‚</tfoot></tbody></thead></caption></th></td></tr></table></strong></p>
<p>â€‹		é¦–å…ˆ<caption>å’Œ<th>åˆ†åˆ«è¡¨ç¤ºè¡¨æ ¼çš„æ ‡é¢˜å’Œè¡¨å¤´ï¼Œ</th><th><strong>ä¸€èˆ¬è¡¨å¤´å•å…ƒæ ¼ä½äºè¡¨æ ¼çš„ç¬¬ä¸€è¡Œæˆ–ç¬¬ä¸€åˆ—ï¼Œå¹¶ä¸”æ–‡æœ¬åŠ ç²—å±…ä¸­ã€‚</strong></th></caption></p>
<p>å¯¹äºæ¯”è¾ƒå¤æ‚çš„è¡¨æ ¼ï¼Œåˆå°†è¡¨æ ¼åˆ†å‰²æˆä¸‰ä¸ªéƒ¨åˆ†ï¼šé¢˜å¤´ã€æ­£æ–‡å’Œè„šæ³¨ã€‚åˆ†åˆ«ç”¨ï¼š theadï¼Œtbodyï¼Œtfootæ¥æ ‡æ³¨ï¼Œè¿™æ ·æ›´å¥½çš„åˆ†æ¸…è¡¨æ ¼ç»“æ„ã€‚</p>
<thead>ï¼š ç”¨äºå®šä¹‰è¡¨æ ¼çš„å¤´éƒ¨ã€‚ç”¨æ¥æ”¾æ ‡é¢˜ä¹‹ç±»çš„ä¸œè¥¿ã€‚**<thead> å†…éƒ¨å¿…é¡»æ‹¥æœ‰<tr> æ ‡ç­¾ã€‚**

<tbody>ï¼šç”¨äºå®šä¹‰è¡¨æ ¼çš„ä¸»ä½“ã€‚

<tfoot>ï¼šæ”¾è¡¨æ ¼çš„è„šæ³¨ä¹‹ç±»ã€‚

<p><strong>è¡¨æ ¼å±æ€§:</strong></p>
<table>
<thead>
<tr>
<th><strong>å±æ€§å</strong></th>
<th><strong>å«ä¹‰</strong></th>
</tr>
</thead>
<tbody><tr>
<td><strong>border</strong></td>
<td>è®¾ç½®è¾¹æ¡†</td>
</tr>
<tr>
<td><strong>bordercolor</strong></td>
<td>è¾¹æ¡†é¢œè‰²</td>
</tr>
<tr>
<td><strong>cellspacing</strong></td>
<td>è®¾ç½®å•å…ƒæ ¼ä¸å•å…ƒæ ¼è¾¹æ¡†ä¹‹é—´çš„è·ç¦»ï¼Œé»˜è®¤2åƒç´ ã€‚</td>
</tr>
<tr>
<td><strong>cellpadding</strong></td>
<td>è®¾ç½®å•å…ƒæ ¼å†…å®¹ä¸å•å…ƒæ ¼ä¹‹é—´çš„è·ç¦»ï¼Œé»˜è®¤1åƒç´ ã€‚</td>
</tr>
<tr>
<td><strong>width</strong></td>
<td>è®¾ç½®è¡¨æ ¼çš„å®½åº¦</td>
</tr>
<tr>
<td><strong>height</strong></td>
<td>è®¾ç½®è¡¨æ ¼çš„é«˜åº¦</td>
</tr>
<tr>
<td><strong>align</strong></td>
<td>tdï¼šå•å…ƒæ ¼å†…å®¹å¯¹é½æ–¹å¼  trï¼šå½“å‰è¡Œå†…å®¹çš„å¯¹é½æ–¹å¼  tableï¼šè¡¨ç¤ºå•å…ƒæ ¼çš„å¯¹é½æ–¹å¼</td>
</tr>
<tr>
<td><strong>bgcolor</strong></td>
<td>èƒŒæ™¯é¢œè‰²ï¼Œtableï¼Œtrï¼Œtd</td>
</tr>
<tr>
<td><strong>background</strong></td>
<td>èƒŒæ™¯ï¼Œtableï¼Œtrï¼Œtdï¼Œå»ºè®®åœ¨CSSä¸­è®¾ç½®ã€‚background-size: 100%;</td>
</tr>
<tr>
<td><strong>colspan</strong></td>
<td>åˆå¹¶åˆ—</td>
</tr>
<tr>
<td><strong>rowspan</strong></td>
<td>åˆå¹¶è¡Œ</td>
</tr>
<tr>
<td><strong>text-align</strong></td>
<td>è®¾ç½®æ–‡æœ¬çš„æ°´å¹³å¯¹é½ã€‚å¯é€‰å€¼ï¼štopã€baselineã€middleã€bottomã€‚</td>
</tr>
<tr>
<td><strong>vertical-align</strong></td>
<td>è®¾ç½®æ–‡æœ¬çš„å‚ç›´å¯¹é½ã€‚</td>
</tr>
<tr>
<td><strong>border-spacing</strong></td>
<td>è¾¹æ¡†é—´è·</td>
</tr>
<tr>
<td><strong>border-collapse</strong></td>
<td>collapseï¼šåˆå¹¶è¾¹æ¡†ï¼Œseparateï¼šä¸åˆå¹¶è¾¹æ¡†ï¼Œ<strong>åœ¨CSSä¸­è®¾ç½®</strong>ã€‚</td>
</tr>
</tbody></table>
<p>è¡¨æ ¼ç¤ºä¾‹ï¼š</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">&quot;X-UA-Compatible&quot;</span> <span class="attr">content</span>=<span class="string">&quot;IE=edge&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css">        <span class="selector-id">#t</span> &#123;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">border-collapse</span>: collapse;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">background</span>: <span class="built_in">url</span>(<span class="string">./img/01.jpeg</span>);</span></span><br><span class="line"><span class="language-css">            <span class="comment">/* ä½¿å›¾ç‰‡æŒ‰è¡¨æ ¼å°ºå¯¸å¡«å…… */</span></span></span><br><span class="line"><span class="language-css">            <span class="attribute">background-size</span>: <span class="number">100%</span> ;</span></span><br><span class="line"><span class="language-css">        &#125;</span></span><br><span class="line"><span class="language-css">    </span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">table</span> <span class="attr">border</span>=<span class="string">&quot;1&quot;</span> <span class="attr">cellspacing</span>=<span class="string">&quot;0&quot;</span> <span class="attr">cellpadding</span>=<span class="string">&quot;2&quot;</span> <span class="attr">width</span>=<span class="string">&quot;500px&quot;</span> <span class="attr">height</span>=<span class="string">&quot;300px&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">caption</span>&gt;</span>æ ‡ é¢˜<span class="tag">&lt;/<span class="name">caption</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">thead</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">tr</span>&gt;</span>HEAD A<span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">tr</span>&gt;</span>HEAD B<span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">tr</span>&gt;</span>HEAD C<span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">tr</span>&gt;</span>HEAD D<span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">thead</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">tbody</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">td</span>&gt;</span>Cell AA<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">td</span>&gt;</span>Cell AB<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">td</span>&gt;</span>Cell AC<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">td</span>&gt;</span>Cell AD<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">td</span>&gt;</span>Cell BA<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">td</span>&gt;</span>Cell BB<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">td</span>&gt;</span>Cell BC<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">td</span>&gt;</span>Cell BD<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">td</span>&gt;</span>Cell CA<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">td</span>&gt;</span>Cell CB<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">td</span>&gt;</span>Cell CC<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">td</span>&gt;</span>Cell CD<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">td</span>&gt;</span>Cell DA<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">td</span>&gt;</span>Cell DB<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">td</span>&gt;</span>Cell DC<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">td</span>&gt;</span>Cell DD<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">tbody</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">tfoot</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">th</span>&gt;</span>æ€»è®¡<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">th</span> <span class="attr">colspan</span>=<span class="string">&quot;3&quot;</span>&gt;</span>10000.00å…ƒ<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">tfoot</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">hr</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">table</span> <span class="attr">id</span>=<span class="string">&quot;t&quot;</span> <span class="attr">border</span>=<span class="string">&quot;1&quot;</span> <span class="attr">width</span>=<span class="string">&quot;500px&quot;</span> <span class="attr">height</span>=<span class="string">&quot;200px&quot;</span> <span class="attr">align</span>=<span class="string">&quot;center&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">caption</span>&gt;</span>å•å…ƒæ ¼çš„åˆå¹¶<span class="tag">&lt;/<span class="name">caption</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">tbody</span> <span class="attr">align</span>=<span class="string">&quot;center&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">td</span> <span class="attr">rowspan</span>=<span class="string">&quot;2&quot;</span>&gt;</span>Cell AA<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">td</span>&gt;</span>Cell AB<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">td</span> <span class="attr">colspan</span>=<span class="string">&quot;2&quot;</span>&gt;</span>Cell AC<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">td</span> <span class="attr">colspan</span>=<span class="string">&quot;2&quot;</span>&gt;</span>Cell BB<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">td</span>&gt;</span>Cell BD<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">td</span>&gt;</span>Cell CA<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">td</span> <span class="attr">colspan</span>=<span class="string">&quot;2&quot;</span>&gt;</span>Cell CB<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">td</span> <span class="attr">rowspan</span>=<span class="string">&quot;2&quot;</span>&gt;</span>Cell CD<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">td</span> <span class="attr">colspan</span>=<span class="string">&quot;2&quot;</span>&gt;</span>Cell DA<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">td</span>&gt;</span>Cell DC<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">tbody</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>



<h2 id="è¡¨å•"><a href="#è¡¨å•" class="headerlink" title="è¡¨å•"></a>è¡¨å•</h2><h3 id="form"><a href="#form" class="headerlink" title="form"></a>form</h3><table>
<thead>
<tr>
<th><strong>å±æ€§</strong></th>
<th><strong>å±æ€§å€¼</strong></th>
<th><strong>è¯´æ˜</strong></th>
</tr>
</thead>
<tbody><tr>
<td><strong>action</strong></td>
<td>URL</td>
<td>è¡¨å•æ•°æ®çš„æäº¤åœ°å€</td>
</tr>
<tr>
<td><strong>method</strong></td>
<td></td>
<td>è§„å®šå¦‚ä½•å‘é€è¡¨å•æ•°æ®</td>
</tr>
<tr>
<td><strong>target</strong></td>
<td>_blank  _self  framename</td>
<td>è§„å®šåœ¨ä½•å¤„æ‰“å¼€  action URL</td>
</tr>
<tr>
<td><strong>enctype</strong></td>
<td></td>
<td>æ–‡ä»¶ä¸Šä¼ ä¹‹å‰è¿›è¡Œç¼–ç </td>
</tr>
<tr>
<td><strong>name</strong></td>
<td></td>
<td>ç”¨äºæŒ‡å®šè¡¨å•çš„åç§°ï¼Œä»¥åŒºåˆ†åŒä¸€ä¸ªé¡µé¢ä¸­çš„å¤šä¸ªè¡¨å•ã€‚</td>
</tr>
</tbody></table>
<p><strong>methodçš„è¯´æ˜ï¼š</strong></p>
<p>getï¼šå£°æ˜æœ¬æ¬¡è¯·æ±‚çš„ç›®çš„æ˜¯ä»æœåŠ¡å™¨è·å–æ•°æ®ã€‚</p>
<p>postï¼šå£°æ˜æœ¬æ¬¡è¯·æ±‚çš„ç›®çš„æ˜¯å‘æœåŠ¡å™¨æ¨é€æ•°æ®ã€‚</p>
<p>ä¸¤è€…åŒºåˆ«ï¼š</p>
<ol>
<li><p>å®‰å…¨æ€§ï¼šgetè¯·æ±‚åœ¨åœ°å€æ æ˜¾ç¤ºä¿¡æ¯ï¼Œä¸å®‰å…¨ã€‚</p>
</li>
<li><p>æäº¤æ•°æ®çš„é•¿åº¦ä¸åŒï¼šgetä¸è¶…è¿‡255ä¸ªå­—ç¬¦ï¼Œpostä¸å—é™åˆ¶ã€‚</p>
</li>
<li><p>ç¼“å­˜æœºåˆ¶ï¼šgetçš„è¯·æ±‚åœ°å€ä¼šä¿å­˜åœ¨æµè§ˆå™¨çš„è®¿é—®å†å²è®°å½•ä¸­ã€‚</p>
</li>
</ol>
<p><strong>enctypeçš„è¯´æ˜ï¼š</strong></p>
<table>
<thead>
<tr>
<th><strong>å€¼</strong></th>
<th><strong>æè¿°</strong></th>
</tr>
</thead>
<tbody><tr>
<td>application&#x2F;x-www-form-urlencoded</td>
<td>åœ¨å‘é€å‰ç¼–ç æ‰€æœ‰å­—ç¬¦ï¼ˆé»˜è®¤ï¼‰ï¼Œä½¿ç”¨URLç¼–ç æ–¹å¼è¿›è¡Œç¼–ç ï¼ŒæœåŠ¡å™¨é€šè¿‡URLæ–¹å¼è§£ç å³å¯ï¼Œ<strong>è¡¨å•ä¸­ä¸éœ€è¦ä¼ é€’æ–‡ä»¶æ—¶ä½¿ç”¨</strong></td>
</tr>
<tr>
<td>multipart&#x2F;form-data</td>
<td>ä¸å¯¹å­—ç¬¦ç¼–ç ã€‚å› æ­¤åœ¨æœåŠ¡å™¨ç«¯éœ€è¦è¿›è¡Œç‰¹æ®Šçš„è§£ç ã€‚  <strong>åœ¨ä½¿ç”¨åŒ…å«æ–‡ä»¶ä¸Šä¼ æ§ä»¶çš„è¡¨å•æ—¶ï¼Œå¿…é¡»ä½¿ç”¨è¯¥å€¼ã€‚</strong></td>
</tr>
<tr>
<td>text&#x2F;plain</td>
<td>ç©ºæ ¼è½¬æ¢ä¸º â€œ+â€ åŠ å·ï¼Œä½†ä¸å¯¹ç‰¹æ®Šå­—ç¬¦ç¼–ç ã€‚</td>
</tr>
</tbody></table>
<h3 id="input"><a href="#input" class="headerlink" title="input"></a>input</h3><table>
<thead>
<tr>
<th><strong>å±æ€§</strong></th>
<th><strong>å±æ€§å€¼</strong></th>
<th><strong>æè¿°</strong></th>
</tr>
</thead>
<tbody><tr>
<td><strong>type</strong></td>
<td>text</td>
<td>æ–‡æœ¬</td>
</tr>
<tr>
<td>password</td>
<td>å¯†ç </td>
<td></td>
</tr>
<tr>
<td>radio</td>
<td>å•é€‰æ¡†</td>
<td></td>
</tr>
<tr>
<td>checkbox</td>
<td>å¤é€‰æ¡†</td>
<td></td>
</tr>
<tr>
<td>button</td>
<td>æ™®é€šæŒ‰é’®</td>
<td></td>
</tr>
<tr>
<td>submit</td>
<td>æäº¤</td>
<td></td>
</tr>
<tr>
<td>reset</td>
<td>é‡ç½®</td>
<td></td>
</tr>
<tr>
<td>image</td>
<td>å›¾åƒ</td>
<td></td>
</tr>
<tr>
<td>file</td>
<td>æ–‡ä»¶åŸŸ</td>
<td></td>
</tr>
<tr>
<td><strong>name</strong></td>
<td></td>
<td>æ§ä»¶åç§°</td>
</tr>
<tr>
<td><strong>value</strong></td>
<td></td>
<td>æ§ä»¶çš„é»˜è®¤å€¼</td>
</tr>
<tr>
<td><strong>size</strong></td>
<td></td>
<td>æ§ä»¶çš„æ˜¾ç¤ºå®½åº¦</td>
</tr>
<tr>
<td><strong>checked</strong></td>
<td></td>
<td>æ§ä»¶æ˜¯å¦æ˜¾ç¤º</td>
</tr>
<tr>
<td><strong>maxlength</strong></td>
<td></td>
<td>æ§ä»¶çš„æœ€å¤§å®½åº¦</td>
</tr>
<tr>
<td><strong>placeholder</strong></td>
<td></td>
<td>è¾“å…¥æ¡†çš„æç¤ºæ–‡å­—ï¼Œå½“æ²¡æœ‰valueæ—¶æ˜¾ç¤º</td>
</tr>
<tr>
<td><strong>required</strong></td>
<td></td>
<td>éç©ºæ ¡éªŒï¼Œå¿…é¡»å¡«å†™</td>
</tr>
<tr>
<td><strong>list</strong></td>
<td></td>
<td>æ­é…datalistï¼Œé¢„å®šä¹‰çš„æ•°æ®</td>
</tr>
<tr>
<td><strong>color</strong></td>
<td></td>
<td>åŒæ‹¾è‰²å™¨</td>
</tr>
<tr>
<td><strong>email</strong></td>
<td></td>
<td>æ•°æ®çš„åˆæ³•æ€§éªŒè¯</td>
</tr>
<tr>
<td><strong>datetime-local</strong></td>
<td></td>
<td>æ—¥æœŸ</td>
</tr>
<tr>
<td><strong>image</strong></td>
<td></td>
<td>ä½¿ç”¨å›¾ç‰‡æäº¤è¡¨å•</td>
</tr>
<tr>
<td><strong>number</strong></td>
<td></td>
<td>æ ¡éªŒã€å¿…é¡»æ˜¯çº¯æ•°å­—</td>
</tr>
<tr>
<td><strong>file</strong></td>
<td></td>
<td>æ–‡ä»¶åŸŸ</td>
</tr>
<tr>
<td><strong>hidden</strong></td>
<td></td>
<td>éšè—åŸŸï¼Œå¯ä»¥æäº¤ä¸å¸Œæœ›ç”¨æˆ·çœ‹åˆ°çš„æ•°æ®</td>
</tr>
<tr>
<td><strong>readonlyã€disabled</strong></td>
<td></td>
<td>ä¸èƒ½ä¿®æ”¹</td>
</tr>
</tbody></table>
<p><strong>è¡¨å•å±æ€§çš„æ¯”è¾ƒï¼š</strong></p>
<p><strong>readonlyï¼šä¸èƒ½ä¿®æ”¹ï¼Œreadonlyæ²¡æœ‰å˜åŒ–ï¼Œå¯ä»¥è¢«è¡¨å•æäº¤ã€‚</strong></p>
<p><strong>disabledï¼šä¸èƒ½ä¿®æ”¹ï¼Œdisabledæ˜¾ç¤ºç°è‰²ï¼Œä¸ä¼šç»è¿‡è¡¨å•çš„æäº¤ã€‚</strong></p>
<p><strong>å±æ€§ä¸ºimageæ—¶ï¼Œç±»ä¼¼äºsubmitæŒ‰é’®ã€‚</strong></p>
<p>Imageï¼š<input type="image" src="../img/girl_0.jpeg" width="80px" height="60px"></p>
<p>list å±æ€§ï¼Œå’Œ datalist æ ‡ç­¾æ­é…ä½¿ç”¨ï¼Œåªèƒ½é€‰æ‹©é¢„å®šä¹‰çš„å€¼ã€‚</p>
<p>value å’Œ placeholder ä¸è¦åŒæ—¶ä½¿ç”¨ï¼Œä»¥ value ä¸ºå‡†ã€‚</p>
<h3 id="datalist"><a href="#datalist" class="headerlink" title="datalist"></a>datalist</h3><figure class="highlight html"><table><tr><td class="code"><pre><span class="line">å§“åï¼š<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">list</span>=<span class="string">&quot;nameList&quot;</span> /&gt;</span><span class="tag">&lt;<span class="name">br</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">datalist</span> <span class="attr">id</span>=<span class="string">&quot;nameList&quot;</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">option</span>&gt;</span>tom<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">option</span>&gt;</span>jerry<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">option</span>&gt;</span>jack<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">option</span>&gt;</span>rose<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">datalist</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="select"><a href="#select" class="headerlink" title="select"></a>select</h3><p><strong>option</strong>è¡¨ç¤ºä¸‹æ‹‰åˆ—è¡¨ä¸­çš„åˆ—è¡¨é¡¹ã€‚<strong>optgroup</strong>ç”¨äºä¸ºåˆ—è¡¨é¡¹åˆ†ç»„ã€‚</p>
<p>å¯ä»¥æŒ‡å®šé¢„é€‰å€¼ï¼šselected&#x3D;â€selectedâ€ã€‚</p>
<table>
<thead>
<tr>
<th><strong>å±æ€§</strong></th>
<th><strong>æè¿°</strong></th>
</tr>
</thead>
<tbody><tr>
<td><strong>size</strong></td>
<td>æ§åˆ¶ä¸‹æ‹‰æ¡†ä¸€æ¬¡æ˜¾ç¤ºçš„è¡Œæ•°</td>
</tr>
<tr>
<td><strong>name</strong></td>
<td>æäº¤çš„æ•°æ®</td>
</tr>
<tr>
<td><strong>multiple</strong></td>
<td>æ˜¯optionå¤šé€‰</td>
</tr>
</tbody></table>
<p>ç¤ºä¾‹ï¼š</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">span</span>&gt;</span>åœ°å€ï¼š<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--æ³¨æ„ï¼š åŠ ä¸Šmultiple=&quot;multiple&quot;ï¼Œä¸ä¼šéšè—ä¸‹æ‹‰æ¡†--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">name</span>=<span class="string">&quot;address&quot;</span> <span class="attr">multiple</span>=<span class="string">&quot;multiple&quot;</span> <span class="attr">size</span>=<span class="string">&quot;2&quot;</span> &gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">&quot;0&quot;</span>&gt;</span>è¯·é€‰æ‹©<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">&quot;1&quot;</span> <span class="attr">selected</span>=<span class="string">&quot;selected&quot;</span>&gt;</span>shanxi<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">&quot;2&quot;</span>&gt;</span>gansu<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">&quot;3&quot;</span>&gt;</span>henan<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="file"><a href="#file" class="headerlink" title="file"></a>file</h3><p>â€‹		æ–‡ä»¶çš„ä¸Šä¼ <strong>æ”¯æŒå¤šé€‰</strong>ã€‚formè¡¨å•çš„æäº¤æ–¹å¼ä¸ºmultipart&#x2F;form-dataã€‚</p>
<h3 id="textarea"><a href="#textarea" class="headerlink" title="textarea"></a>textarea</h3><p>â€‹		ä¸æ”¯æŒvalueå±æ€§ï¼Œå¯æŒ‡å®šcolså’Œrowså±æ€§ã€‚</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css">	<span class="selector-tag">span</span>&#123;</span></span><br><span class="line"><span class="language-css">		<span class="attribute">vertical-align</span>: top;</span></span><br><span class="line"><span class="language-css">	&#125;</span></span><br><span class="line"><span class="language-css"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">span</span>&gt;</span>ä»‹ç»ï¼š<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;<span class="name">textarea</span> <span class="attr">rows</span>=<span class="string">&quot;5&quot;</span> <span class="attr">cols</span>=<span class="string">&quot;30&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;å¤‡æ³¨&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">textarea</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="label"><a href="#label" class="headerlink" title="label"></a>label</h3><p>labelæ ‡ç­¾ä¸»è¦ç›®çš„æ˜¯ä¸ºäº†æé«˜ç”¨æˆ·ä½“éªŒã€‚</p>
<p>ç¬¬ä¸€ç§ç”¨æ³•å°±æ˜¯ç”¨labelç›´æ¥åŒ…æ‹¬inputè¡¨å•ã€‚</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">label</span>&gt;</span> ç”¨æˆ·åï¼š <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;radio&quot;</span> <span class="attr">name</span>=<span class="string">&quot;usename&quot;</span> <span class="attr">value</span>=<span class="string">&quot;è¯·è¾“å…¥ç”¨æˆ·å&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>ç¬¬äºŒç§ç”¨æ³• for å±æ€§è§„å®š label ä¸å“ªä¸ªè¡¨å•å…ƒç´ ç»‘å®šã€‚</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">&quot;sex&quot;</span>&gt;</span>ç”·<span class="tag">&lt;/<span class="name">label</span>&gt;</span><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;radio&quot;</span> <span class="attr">name</span>=<span class="string">&quot;sex&quot;</span> <span class="attr">id</span>=<span class="string">&quot;sex&quot;</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="fieldset"><a href="#fieldset" class="headerlink" title="fieldset"></a>fieldset</h3><p>fieldset ç”¨æ¥ä¸ºè¡¨å•é¡¹è¿›è¡Œåˆ†ç»„ã€‚</p>
<p>legend ç”¨äºæŒ‡å®šæ¯ç»„çš„åå­—ï¼Œæ­é… legend å®šä¹‰ fieldset çš„åˆ†ç±»æ ‡é¢˜ã€‚</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">fieldset</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">legend</span>&gt;</span>ä¸ªäººä¿¡æ¯<span class="tag">&lt;/<span class="name">legend</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">&quot;name&quot;</span>&gt;</span>å§“åï¼š<span class="tag">&lt;/<span class="name">label</span>&gt;</span><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">id</span>=<span class="string">&quot;name&quot;</span>/&gt;</span><span class="tag">&lt;<span class="name">br</span> /&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">label</span>&gt;</span>ç”µè¯ï¼š<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">fieldset</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">fieldset</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">legend</span>&gt;</span>å·¥ä½œç»å†<span class="tag">&lt;/<span class="name">legend</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">&quot;username&quot;</span>&gt;</span>èŒä½ï¼š<span class="tag">&lt;/<span class="name">label</span>&gt;</span><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">id</span>=<span class="string">&quot;username&quot;</span> /&gt;</span><span class="tag">&lt;<span class="name">br</span> /&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">label</span>&gt;</span>ç»©æ•ˆï¼š<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">fieldset</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>ç¤ºä¾‹ï¼š</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">title</span>&gt;</span><span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css">			<span class="selector-tag">span</span>&#123;</span></span><br><span class="line"><span class="language-css">				<span class="attribute">vertical-align</span>: top;</span></span><br><span class="line"><span class="language-css">			&#125;</span></span><br><span class="line"><span class="language-css">		</span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">		<span class="comment">&lt;!--é»˜è®¤æäº¤æ–¹å¼ä¸ºgetè¯·æ±‚--&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">form</span> <span class="attr">name</span>=<span class="string">&quot;registform&quot;</span> <span class="attr">action</span>=<span class="string">&quot;/servletdemo/registServlet&quot;</span> <span class="attr">method</span>=<span class="string">&quot;get&quot;</span> <span class="attr">enctype</span>=<span class="string">&quot;multipart/form-data&quot;</span>&gt;</span></span><br><span class="line">			<span class="comment">&lt;!--valueå’Œplaceholderä¸è¦åŒæ—¶ä½¿ç”¨ï¼Œä»¥valueä¸ºå‡†--&gt;</span></span><br><span class="line">			å§“åï¼š<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;name&quot;</span> <span class="attr">value</span>=<span class="string">&quot;&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;è¯·è¾“å…¥å§“å&quot;</span> <span class="attr">required</span>=<span class="string">&quot;required&quot;</span> /&gt;</span><span class="tag">&lt;<span class="name">br</span> /&gt;</span> </span><br><span class="line">			å¯†ç ï¼š<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;password&quot;</span> <span class="attr">name</span>=<span class="string">&quot;passwd&quot;</span> <span class="attr">value</span>=<span class="string">&quot;&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;è¯·è¾“å…¥å¯†ç &quot;</span> <span class="attr">required</span>=<span class="string">&quot;required&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">br</span> /&gt;</span> </span><br><span class="line">			æ€§åˆ«ï¼š<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;radio&quot;</span> <span class="attr">name</span>=<span class="string">&quot;gender&quot;</span> <span class="attr">value</span>=<span class="string">&quot;0&quot;</span> <span class="attr">checked</span>=<span class="string">&quot;checked&quot;</span> &gt;</span>ç”·</span><br><span class="line">				<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;radio&quot;</span> <span class="attr">name</span>=<span class="string">&quot;gender&quot;</span> <span class="attr">value</span>=<span class="string">&quot;1&quot;</span>&gt;</span>å¥³ <span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line">			çˆ±å¥½ï¼š<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;checkbox&quot;</span> <span class="attr">checked</span> <span class="attr">name</span>=<span class="string">&quot;hobby&quot;</span> <span class="attr">value</span>=<span class="string">&quot;1&quot;</span>&gt;</span>Java</span><br><span class="line">				<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;checkbox&quot;</span> <span class="attr">name</span>=<span class="string">&quot;hobby&quot;</span> <span class="attr">value</span>=<span class="string">&quot;2&quot;</span>&gt;</span>Go</span><br><span class="line">				<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;checkbox&quot;</span> <span class="attr">name</span>=<span class="string">&quot;hobby&quot;</span> <span class="attr">value</span>=<span class="string">&quot;3&quot;</span>&gt;</span>Python</span><br><span class="line">				<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;checkbox&quot;</span> <span class="attr">name</span>=<span class="string">&quot;hobby&quot;</span> <span class="attr">value</span>=<span class="string">&quot;4&quot;</span>&gt;</span>C++</span><br><span class="line">				<span class="tag">&lt;<span class="name">br</span> /&gt;</span> </span><br><span class="line">			<span class="tag">&lt;<span class="name">span</span>&gt;</span>åœ°å€ï¼š<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">			<span class="comment">&lt;!--æ³¨æ„ï¼š åŠ ä¸Šmultiple=&quot;multiple&quot;ï¼Œä¸ä¼šéšè—ä¸‹æ‹‰æ¡†--&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">select</span> <span class="attr">name</span>=<span class="string">&quot;address&quot;</span> <span class="attr">multiple</span>=<span class="string">&quot;multiple&quot;</span> <span class="attr">size</span>=<span class="string">&quot;2&quot;</span> &gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">&quot;0&quot;</span>&gt;</span>è¯·é€‰æ‹©<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">&quot;1&quot;</span> <span class="attr">selected</span>=<span class="string">&quot;selected&quot;</span>&gt;</span>shanxi<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">&quot;2&quot;</span>&gt;</span>gansu<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">&quot;3&quot;</span>&gt;</span>henan<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;/<span class="name">select</span>&gt;</span><span class="tag">&lt;<span class="name">br</span> /&gt;</span></span><br><span class="line">			ç”Ÿæ—¥ï¼š<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;date&quot;</span> <span class="attr">name</span>=<span class="string">&quot;birthday&quot;</span> <span class="attr">value</span>=<span class="string">&quot;&quot;</span> /&gt;</span><span class="tag">&lt;<span class="name">br</span> /&gt;</span></span><br><span class="line">			é¢œè‰²ï¼š<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;color&quot;</span> <span class="attr">name</span>=<span class="string">&quot;color&quot;</span> /&gt;</span><span class="tag">&lt;<span class="name">br</span> /&gt;</span></span><br><span class="line">			å¹´é¾„ï¼š<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;number&quot;</span> <span class="attr">name</span>=<span class="string">&quot;age&quot;</span>/&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">			é‚®ç®±ï¼š<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;email&quot;</span> <span class="attr">name</span>=<span class="string">&quot;email&quot;</span> /&gt;</span><span class="tag">&lt;<span class="name">br</span> /&gt;</span></span><br><span class="line">			<span class="comment">&lt;!--type=imageï¼Œç‚¹å‡»å›¾åƒä¼šæäº¤è¡¨å•ï¼Œç±»ä¼¼äºsubmit--&gt;</span></span><br><span class="line">			Imageï¼š<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;image&quot;</span> <span class="attr">src</span>=<span class="string">&quot;../img/girl_0.jpeg&quot;</span> <span class="attr">width</span>=<span class="string">&quot;80px&quot;</span> <span class="attr">height</span>=<span class="string">&quot;60px&quot;</span>/&gt;</span><span class="tag">&lt;<span class="name">br</span> /&gt;</span></span><br><span class="line">			å¤´åƒï¼š<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;file&quot;</span> <span class="attr">name</span>=<span class="string">&quot;file&quot;</span> /&gt;</span><span class="tag">&lt;<span class="name">br</span> /&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;hidden&quot;</span> <span class="attr">name</span>=<span class="string">&quot;hidden&quot;</span> <span class="attr">value</span>=<span class="string">&quot;id&quot;</span> /&gt;</span><span class="tag">&lt;<span class="name">br</span> /&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">span</span>&gt;</span>ä»‹ç»ï¼š<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;<span class="name">textarea</span> <span class="attr">rows</span>=<span class="string">&quot;5&quot;</span> <span class="attr">cols</span>=<span class="string">&quot;30&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;å¤‡æ³¨&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">textarea</span>&gt;</span><span class="tag">&lt;<span class="name">br</span> /&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;button&quot;</span> <span class="attr">value</span>=<span class="string">&quot;æ™®é€šæŒ‰é’®&quot;</span>&gt;</span><span class="symbol">&amp;nbsp;</span><span class="symbol">&amp;nbsp;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;reset&quot;</span> <span class="attr">value</span>=<span class="string">&quot;é‡ç½®&quot;</span>&gt;</span><span class="symbol">&amp;nbsp;</span><span class="symbol">&amp;nbsp;</span></span><br><span class="line">					<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">value</span>=<span class="string">&quot;æäº¤&quot;</span> /&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">hr</span> /&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">form</span>&gt;</span></span><br><span class="line">			å§“åï¼š<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">list</span>=<span class="string">&quot;nameList&quot;</span> /&gt;</span><span class="tag">&lt;<span class="name">br</span> /&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">datalist</span> <span class="attr">id</span>=<span class="string">&quot;nameList&quot;</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">option</span>&gt;</span>tom<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">option</span>&gt;</span>jerry<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">option</span>&gt;</span>jack<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">option</span>&gt;</span>rose<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;/<span class="name">datalist</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">fieldset</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">legend</span>&gt;</span>ä¸ªäººä¿¡æ¯<span class="tag">&lt;/<span class="name">legend</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">&quot;name&quot;</span>&gt;</span>å§“åï¼š<span class="tag">&lt;/<span class="name">label</span>&gt;</span><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">id</span>=<span class="string">&quot;name&quot;</span>/&gt;</span><span class="tag">&lt;<span class="name">br</span> /&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">label</span>&gt;</span>ç”µè¯ï¼š<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;/<span class="name">fieldset</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">fieldset</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">legend</span>&gt;</span>å·¥ä½œç»å†<span class="tag">&lt;/<span class="name">legend</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">&quot;username&quot;</span>&gt;</span>èŒä½ï¼š<span class="tag">&lt;/<span class="name">label</span>&gt;</span><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">id</span>=<span class="string">&quot;username&quot;</span> /&gt;</span><span class="tag">&lt;<span class="name">br</span> /&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">label</span>&gt;</span>ç»©æ•ˆï¼š<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;/<span class="name">fieldset</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>





<h2 id="Frame"><a href="#Frame" class="headerlink" title="Frame"></a>Frame</h2><h1 id="CSS"><a href="#CSS" class="headerlink" title="CSS"></a>CSS</h1><h2 id="ä¸‰ç§å¼•å…¥æ–¹å¼"><a href="#ä¸‰ç§å¼•å…¥æ–¹å¼" class="headerlink" title="ä¸‰ç§å¼•å…¥æ–¹å¼"></a>ä¸‰ç§å¼•å…¥æ–¹å¼</h2><p>å†…åµŒå¼ï¼š</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!--å†…åµŒæ ·å¼è¡¨--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span> <span class="attr">style</span>=<span class="string">&quot;border: 1px dashed;&quot;</span>&gt;</span></span><br><span class="line">	Hello World!</span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>å†…è”å¼ï¼š</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css">	<span class="comment">/*å†…è”æ ·å¼è¡¨*/</span></span></span><br><span class="line"><span class="language-css">	<span class="selector-id">#app</span> &#123;</span></span><br><span class="line"><span class="language-css">		<span class="attribute">width</span>: <span class="number">100px</span>;</span></span><br><span class="line"><span class="language-css">		<span class="attribute">height</span>: <span class="number">100px</span>;</span></span><br><span class="line"><span class="language-css">		<span class="attribute">background-color</span>: greenyellow;</span></span><br><span class="line"><span class="language-css">	&#125;</span></span><br><span class="line"><span class="language-css"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>å¤–è”å¼ï¼š</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!--å¤–éƒ¨æ ·å¼è¡¨--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">type</span>=<span class="string">&quot;text/css&quot;</span> <span class="attr">href</span>=<span class="string">&quot;outer.css&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th><strong>å±æ€§</strong></th>
<th><strong>ä½œç”¨</strong></th>
</tr>
</thead>
<tbody><tr>
<td><strong>rel</strong></td>
<td>å®šä¹‰å½“å‰æ–‡æ¡£ä¸è¢«é“¾æ¥æ–‡æ¡£ä¹‹é—´çš„å…³ç³»ï¼Œåœ¨è¿™é‡Œéœ€è¦æŒ‡å®šä¸ºâ€œstylesheetâ€ï¼Œè¡¨ç¤ºè¢«é“¾æ¥çš„æ–‡æ¡£æ˜¯ä¸€ä¸ªæ ·å¼è¡¨æ–‡ä»¶ã€‚</td>
</tr>
<tr>
<td><strong>type</strong></td>
<td>å®šä¹‰æ‰€é“¾æ¥æ–‡æ¡£çš„ç±»å‹ï¼Œåœ¨è¿™é‡Œéœ€è¦æŒ‡å®šä¸ºâ€œtext&#x2F;cssâ€ï¼Œè¡¨ç¤ºé“¾æ¥çš„å¤–éƒ¨æ–‡ä»¶ä¸ºCSSæ ·å¼è¡¨ã€‚éƒ½å¯ä»¥çœç•¥</td>
</tr>
<tr>
<td><strong>href</strong></td>
<td>å®šä¹‰æ‰€é“¾æ¥å¤–éƒ¨æ ·å¼è¡¨æ–‡ä»¶çš„URLï¼Œå¯ä»¥æ˜¯ç›¸å¯¹è·¯å¾„ï¼Œä¹Ÿå¯ä»¥æ˜¯ç»å¯¹è·¯å¾„ã€‚</td>
</tr>
</tbody></table>
<h2 id="é€‰æ‹©å™¨"><a href="#é€‰æ‹©å™¨" class="headerlink" title="é€‰æ‹©å™¨"></a>é€‰æ‹©å™¨</h2><h3 id="æ ‡ç­¾é€‰æ‹©å™¨"><a href="#æ ‡ç­¾é€‰æ‹©å™¨" class="headerlink" title="æ ‡ç­¾é€‰æ‹©å™¨"></a>æ ‡ç­¾é€‰æ‹©å™¨</h3><figure class="highlight html"><table><tr><td class="code"><pre><span class="line">/* æ ‡ç­¾é€‰æ‹©å™¨ */</span><br><span class="line"></span><br><span class="line">h1 &#123;</span><br><span class="line">  color: red;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="IDé€‰æ‹©å™¨"><a href="#IDé€‰æ‹©å™¨" class="headerlink" title="IDé€‰æ‹©å™¨"></a>IDé€‰æ‹©å™¨</h3><figure class="highlight html"><table><tr><td class="code"><pre><span class="line">/* idé€‰æ‹©å™¨ */</span><br><span class="line"></span><br><span class="line">#p1 &#123;</span><br><span class="line">  color: salmon; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="ç±»é€‰æ‹©å™¨"><a href="#ç±»é€‰æ‹©å™¨" class="headerlink" title="ç±»é€‰æ‹©å™¨"></a>ç±»é€‰æ‹©å™¨</h3><figure class="highlight html"><table><tr><td class="code"><pre><span class="line">/* ç±»é€‰æ‹©å™¨ */</span><br><span class="line"></span><br><span class="line">.p2 &#123;</span><br><span class="line">  color: green;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="é€šé…ç¬¦é€‰æ‹©å™¨"><a href="#é€šé…ç¬¦é€‰æ‹©å™¨" class="headerlink" title="é€šé…ç¬¦é€‰æ‹©å™¨"></a>é€šé…ç¬¦é€‰æ‹©å™¨</h3><figure class="highlight html"><table><tr><td class="code"><pre><span class="line">/* é€šé…ç¬¦é€‰æ‹©å™¨ */</span><br><span class="line"></span><br><span class="line">* &#123;</span><br><span class="line">  color: red;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="å¤åˆ-x2F-å¹¶é›†é€‰æ‹©å™¨"><a href="#å¤åˆ-x2F-å¹¶é›†é€‰æ‹©å™¨" class="headerlink" title="å¤åˆ&#x2F;å¹¶é›†é€‰æ‹©å™¨"></a>å¤åˆ&#x2F;å¹¶é›†é€‰æ‹©å™¨</h3><figure class="highlight html"><table><tr><td class="code"><pre><span class="line">/* å¤åˆé€‰æ‹©å™¨ */</span><br><span class="line"></span><br><span class="line">#p1,</span><br><span class="line">.p2,</span><br><span class="line">h1 &#123;</span><br><span class="line">  background-color: yellowgreen;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="äº¤é›†é€‰æ‹©å™¨ï¼ˆä¸éœ€è¦ç©ºæ ¼éš”å¼€ï¼‰"><a href="#äº¤é›†é€‰æ‹©å™¨ï¼ˆä¸éœ€è¦ç©ºæ ¼éš”å¼€ï¼‰" class="headerlink" title="äº¤é›†é€‰æ‹©å™¨ï¼ˆä¸éœ€è¦ç©ºæ ¼éš”å¼€ï¼‰"></a>äº¤é›†é€‰æ‹©å™¨ï¼ˆä¸éœ€è¦ç©ºæ ¼éš”å¼€ï¼‰</h3><figure class="highlight html"><table><tr><td class="code"><pre><span class="line">/* äº¤é›†é€‰æ‹©å™¨ï¼šæ²¡æœ‰ç©ºæ ¼ï¼Œidä¸º p3 çš„span */</span><br><span class="line"></span><br><span class="line">span.p3 &#123;</span><br><span class="line">  background-color: red;</span><br><span class="line">  color: green;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">p#p1 &#123;</span><br><span class="line">  background-color: hotpink;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="åä»£é€‰æ‹©å™¨"><a href="#åä»£é€‰æ‹©å™¨" class="headerlink" title="åä»£é€‰æ‹©å™¨"></a>åä»£é€‰æ‹©å™¨</h3><figure class="highlight html"><table><tr><td class="code"><pre><span class="line">/* åä»£é€‰æ‹©å™¨ */</span><br><span class="line">#d1 span &#123;</span><br><span class="line">    color: black;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="å­å…ƒç´ é€‰æ‹©å™¨ï¼ˆIE6åŠä»¥ä¸‹ä¸æ”¯æŒï¼‰"><a href="#å­å…ƒç´ é€‰æ‹©å™¨ï¼ˆIE6åŠä»¥ä¸‹ä¸æ”¯æŒï¼‰" class="headerlink" title="å­å…ƒç´ é€‰æ‹©å™¨ï¼ˆIE6åŠä»¥ä¸‹ä¸æ”¯æŒï¼‰"></a>å­å…ƒç´ é€‰æ‹©å™¨ï¼ˆIE6åŠä»¥ä¸‹ä¸æ”¯æŒï¼‰</h3><figure class="highlight html"><table><tr><td class="code"><pre><span class="line">/* å­å…ƒç´ é€‰æ‹©å™¨</span><br><span class="line">    IE6åŠä»¥ä¸‹çš„æµè§ˆå™¨ä¸æ”¯æŒå­å…ƒç´ é€‰æ‹©å™¨</span><br><span class="line">*/</span><br><span class="line">div&gt;span &#123;</span><br><span class="line">    background-color: yellowgreen;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="å±æ€§é€‰æ‹©å™¨"><a href="#å±æ€§é€‰æ‹©å™¨" class="headerlink" title="å±æ€§é€‰æ‹©å™¨"></a>å±æ€§é€‰æ‹©å™¨</h3><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css">   <span class="comment">/*</span></span></span><br><span class="line"><span class="comment"><span class="language-css">        * ä¸ºæ‰€æœ‰å…·æœ‰titleå±æ€§çš„på…ƒç´ ï¼Œè®¾ç½®ä¸€ä¸ªèƒŒæ™¯é¢œè‰²ä¸ºé»„è‰²</span></span></span><br><span class="line"><span class="comment"><span class="language-css">        * titleå±æ€§,é¼ æ ‡ç§»å…¥æ˜¾ç¤ºå†…å®¹</span></span></span><br><span class="line"><span class="comment"><span class="language-css">        * å±æ€§é€‰æ‹©å™¨</span></span></span><br><span class="line"><span class="comment"><span class="language-css">        *    ä½œç”¨ï¼šå¯ä»¥æ ¹æ®å…ƒç´ ä¸­çš„å±æ€§æˆ–å±æ€§å€¼æ¥é€‰å–æŒ‡å®šå…ƒç´ </span></span></span><br><span class="line"><span class="comment"><span class="language-css">        *    è¯­æ³•ï¼š</span></span></span><br><span class="line"><span class="comment"><span class="language-css">        *      [å±æ€§å] é€‰å–å«æœ‰æŒ‡å®šå±æ€§çš„å…ƒç´ </span></span></span><br><span class="line"><span class="comment"><span class="language-css">        *      [å±æ€§å=&quot;å±æ€§å€¼&quot;] é€‰å–å«æœ‰æŒ‡å®šå±æ€§å€¼çš„å…ƒç´ </span></span></span><br><span class="line"><span class="comment"><span class="language-css">        *      [å±æ€§å^=&quot;å±æ€§å€¼&quot;] é€‰å–å±æ€§å€¼ä»¥æŒ‡å®šå†…å®¹å¼€å¤´çš„å…ƒç´ </span></span></span><br><span class="line"><span class="comment"><span class="language-css">        *      [å±æ€§å$=&quot;å±æ€§å€¼&quot;] é€‰å–å±æ€§å€¼ä»¥æŒ‡å®šå†…å®¹ç»“å°¾çš„å…ƒç´ </span></span></span><br><span class="line"><span class="comment"><span class="language-css">        *      [å±æ€§å*=&quot;å±æ€§å€¼&quot;] é€‰å–å±æ€§å€¼ä»¥åŒ…å«æŒ‡å®šå†…å®¹çš„å…ƒç´ </span></span></span><br><span class="line"><span class="comment"><span class="language-css">   */</span></span></span><br><span class="line"><span class="language-css">   <span class="selector-tag">p</span><span class="selector-attr">[title]</span> &#123;</span></span><br><span class="line"><span class="language-css">       <span class="attribute">background-color</span>: yellowgreen;</span></span><br><span class="line"><span class="language-css">   &#125;</span></span><br><span class="line"><span class="language-css">   <span class="selector-tag">p</span><span class="selector-attr">[title=<span class="string">&quot;hello&quot;</span>]</span> &#123;</span></span><br><span class="line"><span class="language-css">       <span class="attribute">background-color</span>: yellow;</span></span><br><span class="line"><span class="language-css">   &#125;</span></span><br><span class="line"><span class="language-css">   <span class="selector-tag">p</span><span class="selector-attr">[title^=<span class="string">&quot;ab&quot;</span>]</span> &#123;</span></span><br><span class="line"><span class="language-css">       <span class="attribute">background-color</span>: yellow;</span></span><br><span class="line"><span class="language-css">   &#125;</span></span><br><span class="line"><span class="language-css">   <span class="selector-tag">p</span><span class="selector-attr">[title$=<span class="string">&quot;c&quot;</span>]</span> &#123;</span></span><br><span class="line"><span class="language-css">       <span class="attribute">background-color</span>: turquoise;</span></span><br><span class="line"><span class="language-css">   &#125;</span></span><br><span class="line"><span class="language-css">   <span class="selector-tag">p</span><span class="selector-attr">[title*=<span class="string">&quot;c&quot;</span>]</span> &#123;</span></span><br><span class="line"><span class="language-css">       <span class="attribute">color</span>: red;</span></span><br><span class="line"><span class="language-css">   &#125;</span></span><br><span class="line"><span class="language-css"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">title</span>=<span class="string">&quot;hello&quot;</span>&gt;</span>æˆ‘æ˜¯ä¸€ä¸ªæ®µè½<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>æˆ‘æ˜¯ä¸€ä¸ªæ®µè½<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">title</span>=<span class="string">&quot;hello&quot;</span>&gt;</span>æˆ‘æ˜¯ä¸€ä¸ªæ®µè½<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">title</span>=<span class="string">&quot;abbc&quot;</span>&gt;</span>æˆ‘æ˜¯ä¸€ä¸ªæ®µè½<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">title</span>=<span class="string">&quot;abccd&quot;</span>&gt;</span>æˆ‘æ˜¯ä¸€ä¸ªæ®µè½<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">title</span>=<span class="string">&quot;abc&quot;</span>&gt;</span>æˆ‘æ˜¯ä¸€ä¸ªæ®µè½<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="ä¼ªç±»é€‰æ‹©å™¨"><a href="#ä¼ªç±»é€‰æ‹©å™¨" class="headerlink" title="ä¼ªç±»é€‰æ‹©å™¨"></a>ä¼ªç±»é€‰æ‹©å™¨</h3><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"> <span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css">        <span class="comment">/*</span></span></span><br><span class="line"><span class="comment"><span class="language-css">            * ä¼ªç±»ä¸“é—¨ç”¨æ¥è¡¨ç¤ºå…ƒç´ çš„ä¸€ç§çš„ç‰¹æ®Šçš„çŠ¶æ€ï¼Œ</span></span></span><br><span class="line"><span class="comment"><span class="language-css">            *   æ¯”å¦‚ï¼šè®¿é—®è¿‡çš„è¶…é“¾æ¥ï¼Œæ¯”å¦‚æ™®é€šçš„è¶…é“¾æ¥ï¼Œæ¯”å¦‚è·å–ç„¦ç‚¹çš„æ–‡æœ¬æ¡†</span></span></span><br><span class="line"><span class="comment"><span class="language-css">            * å½“æˆ‘ä»¬éœ€è¦ä¸ºå¤„åœ¨è¿™äº›ç‰¹æ®ŠçŠ¶æ€çš„å…ƒç´ è®¾ç½®æ ·å¼æ—¶ï¼Œå°±å¯ä»¥ä½¿ç”¨ä¼ªç±»</span></span></span><br><span class="line"><span class="comment"><span class="language-css">        */</span></span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">        <span class="comment">/* </span></span></span><br><span class="line"><span class="comment"><span class="language-css">            ç»™æœªè®¿é—®çš„é“¾æ¥è®¾ç½®é¢œè‰²</span></span></span><br><span class="line"><span class="comment"><span class="language-css">        */</span></span></span><br><span class="line"><span class="language-css">        <span class="selector-tag">a</span><span class="selector-pseudo">:link</span> &#123;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">color</span>: yellowgreen;</span></span><br><span class="line"><span class="language-css">        &#125;</span></span><br><span class="line"><span class="language-css">        <span class="comment">/* </span></span></span><br><span class="line"><span class="comment"><span class="language-css">            ä¸ºè®¿é—®è¿‡çš„é“¾æ¥è®¾ç½®é¢œè‰²</span></span></span><br><span class="line"><span class="comment"><span class="language-css">        */</span></span></span><br><span class="line"><span class="language-css">        <span class="selector-tag">a</span><span class="selector-pseudo">:visited</span> &#123;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">color</span>: red;</span></span><br><span class="line"><span class="language-css">        &#125;</span></span><br><span class="line"><span class="language-css">        <span class="comment">/* </span></span></span><br><span class="line"><span class="comment"><span class="language-css">            é¼ æ ‡ç§»å…¥æ—¶çš„çŠ¶æ€</span></span></span><br><span class="line"><span class="comment"><span class="language-css">        */</span></span></span><br><span class="line"><span class="language-css">        <span class="selector-tag">a</span><span class="selector-pseudo">:hover</span> &#123;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">color</span>: skyblue;</span></span><br><span class="line"><span class="language-css">        &#125;</span></span><br><span class="line"><span class="language-css">        <span class="comment">/* </span></span></span><br><span class="line"><span class="comment"><span class="language-css">            è¶…é“¾æ¥è¢«ç‚¹å‡»æ—¶çš„çŠ¶æ€</span></span></span><br><span class="line"><span class="comment"><span class="language-css">        */</span></span></span><br><span class="line"><span class="language-css">        <span class="selector-tag">a</span><span class="selector-pseudo">:active</span> &#123;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">color</span>: black;</span></span><br><span class="line"><span class="language-css">        &#125;</span></span><br><span class="line"><span class="language-css">        <span class="comment">/*</span></span></span><br><span class="line"><span class="comment"><span class="language-css">             * :hoverå’Œ:activeä¹Ÿå¯ä»¥ä¸ºå…¶ä»–å…ƒç´ è®¾ç½®</span></span></span><br><span class="line"><span class="comment"><span class="language-css">             * IE6ä¸­ï¼Œä¸æ”¯æŒå¯¹è¶…é“¾æ¥ä»¥å¤–çš„å…ƒç´ è®¾ç½®:hoverå’Œ:active</span></span></span><br><span class="line"><span class="comment"><span class="language-css">             */</span></span></span><br><span class="line"><span class="language-css">        <span class="comment">/*</span></span></span><br><span class="line"><span class="comment"><span class="language-css">            p:hover&#123;</span></span></span><br><span class="line"><span class="comment"><span class="language-css">                background-color: yellow;</span></span></span><br><span class="line"><span class="comment"><span class="language-css">            &#125;</span></span></span><br><span class="line"><span class="comment"><span class="language-css">            </span></span></span><br><span class="line"><span class="comment"><span class="language-css">            p:active&#123;</span></span></span><br><span class="line"><span class="comment"><span class="language-css">                background-color: orange;</span></span></span><br><span class="line"><span class="comment"><span class="language-css">            &#125;</span></span></span><br><span class="line"><span class="comment"><span class="language-css">        */</span></span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">        <span class="comment">/*</span></span></span><br><span class="line"><span class="comment"><span class="language-css">            * æ–‡æœ¬æ¡†è·å–ç„¦ç‚¹ä»¥åï¼Œä¿®æ”¹èƒŒæ™¯é¢œè‰²ä¸ºé»„è‰²</span></span></span><br><span class="line"><span class="comment"><span class="language-css">        */</span></span></span><br><span class="line"><span class="language-css">        <span class="selector-tag">input</span><span class="selector-pseudo">:focus</span> &#123;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">background-color</span>: yellowgreen;</span></span><br><span class="line"><span class="language-css">        &#125;</span></span><br><span class="line"><span class="language-css">        <span class="comment">/**</span></span></span><br><span class="line"><span class="comment"><span class="language-css">             * ä¸ºpæ ‡ç­¾ä¸­é€‰ä¸­çš„å†…å®¹ã€é¼ æ ‡é€‰ä¸­ã€‘ä½¿ç”¨æ ·å¼</span></span></span><br><span class="line"><span class="comment"><span class="language-css">             *  å¯ä»¥ä½¿ç”¨::selectionä¸ºç±»</span></span></span><br><span class="line"><span class="comment"><span class="language-css">             *  æ³¨æ„ï¼šè¿™ä¸ªä¼ªç±»åœ¨ç«ç‹ä¸­éœ€è¦é‡‡ç”¨å¦ä¸€ç§æ–¹å¼ç¼–å†™::-moz-selection</span></span></span><br><span class="line"><span class="comment"><span class="language-css">        */</span></span></span><br><span class="line"><span class="language-css">        <span class="comment">/**</span></span></span><br><span class="line"><span class="comment"><span class="language-css">            * å…¼å®¹å¤§éƒ¨åˆ†æµè§ˆå™¨çš„</span></span></span><br><span class="line"><span class="comment"><span class="language-css">        */</span></span></span><br><span class="line"><span class="language-css">        <span class="selector-tag">p</span><span class="selector-pseudo">::selection</span>&#123;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">background-color</span>: orange;</span></span><br><span class="line"><span class="language-css">        &#125;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">        <span class="comment">/* p::-moz-selection &#123;</span></span></span><br><span class="line"><span class="comment"><span class="language-css">            background-color: orange;</span></span></span><br><span class="line"><span class="comment"><span class="language-css">        &#125; */</span></span></span><br><span class="line"><span class="language-css">    </span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;http://www.baidu.com&quot;</span>&gt;</span>é“¾æ¥1<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;http://www.jd.com&quot;</span>&gt;</span>é“¾æ¥2<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>æ®µè½<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="ä¼ªå…ƒç´ ä¸å¦å®šä¼ªç±»ï¼ˆè¡¥å……ä¼ªç±»ï¼‰"><a href="#ä¼ªå…ƒç´ ä¸å¦å®šä¼ªç±»ï¼ˆè¡¥å……ä¼ªç±»ï¼‰" class="headerlink" title="ä¼ªå…ƒç´ ä¸å¦å®šä¼ªç±»ï¼ˆè¡¥å……ä¼ªç±»ï¼‰"></a>ä¼ªå…ƒç´ ä¸å¦å®šä¼ªç±»ï¼ˆè¡¥å……ä¼ªç±»ï¼‰</h3><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">title</span>&gt;</span><span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css">        <span class="comment">/*</span></span></span><br><span class="line"><span class="comment"><span class="language-css">         * ä¸ºpä¸­ç¬¬ä¸€ä¸ªå­—ç¬¦æ¥è®¾ç½®ä¸€ä¸ªç‰¹æ®Šçš„æ ·å¼</span></span></span><br><span class="line"><span class="comment"><span class="language-css">        */</span></span></span><br><span class="line"><span class="language-css">        <span class="selector-tag">p</span><span class="selector-pseudo">:first</span>-letter&#123;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">color</span>:red;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">font-size</span>: <span class="number">20px</span>;</span></span><br><span class="line"><span class="language-css">        &#125;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">        <span class="comment">/*</span></span></span><br><span class="line"><span class="comment"><span class="language-css">         * ä¸ºpä¸­çš„ç¬¬ä¸€è¡Œè®¾ç½®ä¸€ä¸ªèƒŒæ™¯é¢œè‰²ä¸ºé»„è‰²</span></span></span><br><span class="line"><span class="comment"><span class="language-css">        */</span></span></span><br><span class="line"><span class="language-css">        <span class="selector-tag">p</span><span class="selector-pseudo">:first</span>-line&#123;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">background-color</span>: yellowgreen;</span></span><br><span class="line"><span class="language-css">        &#125;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">        <span class="comment">/*</span></span></span><br><span class="line"><span class="comment"><span class="language-css">         * :beforeè¡¨ç¤ºå…ƒç´ &quot;æœ€å‰é¢&quot;çš„éƒ¨åˆ†</span></span></span><br><span class="line"><span class="comment"><span class="language-css">         *  ä¸€èˆ¬beforeéƒ½éœ€è¦ç»“åˆcontentè¿™ä¸ªæ ·å¼ä¸€èµ·ä½¿ç”¨ï¼Œ</span></span></span><br><span class="line"><span class="comment"><span class="language-css">         *  é€šè¿‡contentå¯ä»¥å‘beforeæˆ–afterçš„ä½ç½®æ·»åŠ ä¸€äº›å†…å®¹ </span></span></span><br><span class="line"><span class="comment"><span class="language-css">         * :afterè¡¨ç¤ºå…ƒç´ çš„æœ€åè¾¹çš„éƒ¨åˆ†</span></span></span><br><span class="line"><span class="comment"><span class="language-css">        */</span></span></span><br><span class="line"><span class="language-css">        <span class="selector-tag">p</span><span class="selector-pseudo">:before</span>&#123;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">content</span>: <span class="string">&quot;æœ€å‰é¢&quot;</span>;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">color</span>: red;</span></span><br><span class="line"><span class="language-css">        &#125;</span></span><br><span class="line"><span class="language-css">        <span class="selector-tag">p</span><span class="selector-pseudo">:after</span>&#123;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">content</span>: <span class="string">&quot;æœ€åé¢&quot;</span>;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">color</span>: red;</span></span><br><span class="line"><span class="language-css">        &#125;</span></span><br><span class="line"><span class="language-css">        <span class="comment">/*å¦å®šä¼ªç±»ï¼š*/</span></span></span><br><span class="line"><span class="language-css">        <span class="selector-tag">p</span><span class="selector-pseudo">:not</span>(<span class="selector-class">.hello</span>)&#123;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">background-color</span>: deepskyblue;</span></span><br><span class="line"><span class="language-css">        &#125;</span></span><br><span class="line"><span class="language-css">    </span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span></span><br><span class="line">        åœ¨æˆ‘çš„åå›­ï¼Œå¯ä»¥çœ‹è§å¢™å¤–æœ‰ä¸¤æ ªæ ‘ï¼Œä¸€æ ªæ˜¯æ£æ ‘ï¼Œè¿˜æœ‰ä¸€æ ªä¹Ÿæ˜¯æ£æ ‘ã€‚ è¿™ä¸Šé¢çš„å¤œçš„å¤©ç©ºï¼Œå¥‡æ€ªè€Œé«˜ï¼Œæˆ‘ç”Ÿå¹³æ²¡æœ‰è§è¿‡è¿™æ ·å¥‡æ€ªè€Œé«˜çš„å¤©ç©ºã€‚ä»–ä»¿ä½›è¦ç¦»å¼€äººé—´è€Œå»ï¼Œä½¿äººä»¬ä»°é¢ä¸å†çœ‹è§ã€‚ç„¶è€Œç°åœ¨å´éå¸¸ä¹‹è“ï¼Œé—ªé—ªåœ°ä€¹ç€å‡ åä¸ªæ˜Ÿæ˜Ÿçš„çœ¼ï¼Œå†·çœ¼ã€‚</span><br><span class="line">    <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">p</span>&gt;</span>æˆ‘æ˜¯ä¸€ä¸ªpæ ‡ç­¾<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span>&gt;</span>æˆ‘æ˜¯ä¸€ä¸ªpæ ‡ç­¾<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span>&gt;</span>æˆ‘æ˜¯ä¸€ä¸ªpæ ‡ç­¾<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;hello&quot;</span>&gt;</span>æˆ‘æ˜¯ä¸€ä¸ªpæ ‡ç­¾<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span>&gt;</span>æˆ‘æ˜¯ä¸€ä¸ªpæ ‡ç­¾<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span>&gt;</span>æˆ‘æ˜¯ä¸€ä¸ªpæ ‡ç­¾<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="å…„å¼Ÿå…ƒç´ é€‰æ‹©å™¨"><a href="#å…„å¼Ÿå…ƒç´ é€‰æ‹©å™¨" class="headerlink" title="å…„å¼Ÿå…ƒç´ é€‰æ‹©å™¨"></a>å…„å¼Ÿå…ƒç´ é€‰æ‹©å™¨</h3><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">title</span>&gt;</span><span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css">        <span class="comment">/* spanåé¢çš„ä¸€ä¸ªpæ ‡ç­¾ */</span></span></span><br><span class="line"><span class="language-css">         <span class="selector-tag">span</span> +<span class="selector-tag">p</span>&#123;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">color</span>: red;</span></span><br><span class="line"><span class="language-css">        &#125; </span></span><br><span class="line"><span class="language-css">        <span class="comment">/* spanåé¢çš„æ‰€æœ‰æ ‡ç­¾ */</span></span></span><br><span class="line"><span class="language-css">        <span class="selector-tag">span</span>~<span class="selector-tag">p</span> &#123;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">background-color</span>: yellowgreen;</span></span><br><span class="line"><span class="language-css">        &#125;</span></span><br><span class="line"><span class="language-css">    </span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>æˆ‘æ˜¯ä¸€ä¸ªpæ ‡ç­¾<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>æˆ‘æ˜¯ä¸€ä¸ªpæ ‡ç­¾<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>æˆ‘æ˜¯ä¸€ä¸ªpæ ‡ç­¾<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">span</span>&gt;</span>æˆ‘æ˜¯ä¸€ä¸ªspan<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>æˆ‘æ˜¯ä¸€ä¸ªpæ ‡ç­¾<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>æˆ‘æ˜¯ä¸€ä¸ªpæ ‡ç­¾<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>æˆ‘æ˜¯ä¸€ä¸ªpæ ‡ç­¾<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="å­å…ƒç´ é€‰æ‹©å™¨"><a href="#å­å…ƒç´ é€‰æ‹©å™¨" class="headerlink" title="å­å…ƒç´ é€‰æ‹©å™¨"></a>å­å…ƒç´ é€‰æ‹©å™¨</h3><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">title</span>&gt;</span><span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">style</span> <span class="attr">type</span>=<span class="string">&quot;text/css&quot;</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css">		<span class="comment">/*</span></span></span><br><span class="line"><span class="comment"><span class="language-css">         * ä¸ºç¬¬ä¸€ä¸ªpæ ‡ç­¾è®¾ç½®ä¸€ä¸ªèƒŒæ™¯é¢œè‰²ä¸ºé»„è‰²</span></span></span><br><span class="line"><span class="comment"><span class="language-css">         *  :first-child å¯ä»¥é€‰ä¸­ç¬¬ä¸€ä¸ªå­å…ƒç´ </span></span></span><br><span class="line"><span class="comment"><span class="language-css">         *  :last-child å¯ä»¥é€‰ä¸­æœ€åä¸€ä¸ªå­å…ƒç´ </span></span></span><br><span class="line"><span class="comment"><span class="language-css">         */</span></span></span><br><span class="line"><span class="language-css">        </span></span><br><span class="line"><span class="language-css">		<span class="comment">/* body&gt;p:first-child &#123;</span></span></span><br><span class="line"><span class="comment"><span class="language-css">            background-color: yellow;</span></span></span><br><span class="line"><span class="comment"><span class="language-css">        &#125;</span></span></span><br><span class="line"><span class="comment"><span class="language-css"></span></span></span><br><span class="line"><span class="comment"><span class="language-css">        p:last-child &#123;</span></span></span><br><span class="line"><span class="comment"><span class="language-css">            background-color: yellow;</span></span></span><br><span class="line"><span class="comment"><span class="language-css">        &#125; */</span></span></span><br><span class="line"><span class="language-css">		<span class="comment">/*</span></span></span><br><span class="line"><span class="comment"><span class="language-css">         * :nth-child å¯ä»¥é€‰ä¸­ä»»æ„ä½ç½®çš„å­å…ƒç´ </span></span></span><br><span class="line"><span class="comment"><span class="language-css">         *      è¯¥é€‰æ‹©å™¨åè¾¹å¯ä»¥æŒ‡å®šä¸€ä¸ªå‚æ•°ï¼ŒæŒ‡å®šè¦é€‰ä¸­ç¬¬å‡ ä¸ªå­å…ƒç´ </span></span></span><br><span class="line"><span class="comment"><span class="language-css">         *      even è¡¨ç¤ºå¶æ•°ä½ç½®çš„å­å…ƒç´ </span></span></span><br><span class="line"><span class="comment"><span class="language-css">         *      odd è¡¨ç¤ºå¥‡æ•°ä½ç½®çš„å­å…ƒç´ </span></span></span><br><span class="line"><span class="comment"><span class="language-css">         */</span></span></span><br><span class="line"><span class="language-css">        </span></span><br><span class="line"><span class="language-css">		<span class="comment">/* p:nth-child(odd) &#123;</span></span></span><br><span class="line"><span class="comment"><span class="language-css">            background-color: yellow;</span></span></span><br><span class="line"><span class="comment"><span class="language-css">        &#125; */</span></span></span><br><span class="line"><span class="language-css">       </span></span><br><span class="line"><span class="language-css">		<span class="comment">/*</span></span></span><br><span class="line"><span class="comment"><span class="language-css">        * :first-of-type</span></span></span><br><span class="line"><span class="comment"><span class="language-css">        * :last-of-type</span></span></span><br><span class="line"><span class="comment"><span class="language-css">        * :nth-of-type</span></span></span><br><span class="line"><span class="comment"><span class="language-css">        *      å’Œ:first-childè¿™äº›éå¸¸çš„ç±»ä¼¼ï¼Œ</span></span></span><br><span class="line"><span class="comment"><span class="language-css">        *      åªä¸è¿‡childï¼Œæ˜¯åœ¨æ‰€æœ‰çš„å­å…ƒç´ ä¸­æ’åˆ—</span></span></span><br><span class="line"><span class="comment"><span class="language-css">        *      è€Œtypeï¼Œæ˜¯åœ¨å½“å‰ç±»å‹(æ¯ä¸ªå—å…ƒç´ å†…éƒ¨)çš„å­å…ƒç´ ä¸­æ’åˆ—</span></span></span><br><span class="line"><span class="comment"><span class="language-css">        */</span></span></span><br><span class="line"><span class="language-css">		</span></span><br><span class="line"><span class="language-css">		<span class="selector-tag">p</span><span class="selector-pseudo">:first</span>-of-type &#123;</span></span><br><span class="line"><span class="language-css">			<span class="attribute">background-color</span>: yellowgreen;</span></span><br><span class="line"><span class="language-css">		&#125;</span></span><br><span class="line"><span class="language-css">		</span></span><br><span class="line"><span class="language-css">		<span class="selector-tag">p</span><span class="selector-pseudo">:last-of-type</span> &#123;</span></span><br><span class="line"><span class="language-css">			<span class="attribute">background-color</span>: red;</span></span><br><span class="line"><span class="language-css">		&#125;</span></span><br><span class="line"><span class="language-css">	</span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">span</span>&gt;</span>æˆ‘æ˜¯span<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">p</span>&gt;</span>æˆ‘æ˜¯ä¸€ä¸ªpæ ‡ç­¾<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">p</span>&gt;</span>æˆ‘æ˜¯ä¸€ä¸ªpæ ‡ç­¾<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">p</span>&gt;</span>æˆ‘æ˜¯ä¸€ä¸ªpæ ‡ç­¾<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">p</span>&gt;</span>æˆ‘æ˜¯ä¸€ä¸ªpæ ‡ç­¾<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">p</span>&gt;</span>æˆ‘æ˜¯ä¸€ä¸ªpæ ‡ç­¾<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">p</span>&gt;</span>æˆ‘æ˜¯ä¸€ä¸ªpæ ‡ç­¾<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">span</span>&gt;</span>hello<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line"></span><br><span class="line">		<span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">p</span>&gt;</span>æˆ‘æ˜¯DIVä¸­çš„pæ ‡ç­¾<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">p</span>&gt;</span>æˆ‘æ˜¯DIVä¸­çš„pæ ‡ç­¾<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="é€‰æ‹©å™¨çš„ä¼˜å…ˆçº§"><a href="#é€‰æ‹©å™¨çš„ä¼˜å…ˆçº§" class="headerlink" title="é€‰æ‹©å™¨çš„ä¼˜å…ˆçº§"></a>é€‰æ‹©å™¨çš„ä¼˜å…ˆçº§</h3><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">title</span>&gt;</span><span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css">		<span class="comment">/*</span></span></span><br><span class="line"><span class="comment"><span class="language-css">		 * å½“ä½¿ç”¨ä¸åŒçš„é€‰æ‹©å™¨ï¼Œé€‰ä¸­åŒä¸€ä¸ªå…ƒç´ æ—¶å¹¶ä¸”è®¾ç½®ç›¸åŒçš„æ ·å¼æ—¶ï¼Œ</span></span></span><br><span class="line"><span class="comment"><span class="language-css">		 *  è¿™æ—¶æ ·å¼ä¹‹é—´äº§ç”Ÿäº†å†²çªï¼Œæœ€ç»ˆåˆ°åº•é‡‡ç”¨å“ªä¸ªé€‰æ‹©å™¨å®šä¹‰çš„æ ·å¼ï¼Œç”±é€‰æ‹©å™¨çš„ä¼˜å…ˆçº§ï¼ˆæƒé‡ï¼‰å†³å®š</span></span></span><br><span class="line"><span class="comment"><span class="language-css">		 *  ä¼˜å…ˆçº§é«˜çš„ä¼˜å…ˆæ˜¾ç¤ºã€‚</span></span></span><br><span class="line"><span class="comment"><span class="language-css">		 * </span></span></span><br><span class="line"><span class="comment"><span class="language-css">		 * ä¼˜å…ˆçº§çš„è§„åˆ™</span></span></span><br><span class="line"><span class="comment"><span class="language-css">		 *      å†…è”æ ·å¼ ï¼Œ ä¼˜å…ˆçº§  1000</span></span></span><br><span class="line"><span class="comment"><span class="language-css">		 *      idé€‰æ‹©å™¨ï¼Œä¼˜å…ˆçº§   100</span></span></span><br><span class="line"><span class="comment"><span class="language-css">		 *      ç±»å’Œä¼ªç±»ï¼Œ ä¼˜å…ˆçº§   10</span></span></span><br><span class="line"><span class="comment"><span class="language-css">		 *      å…ƒç´ é€‰æ‹©å™¨ï¼Œä¼˜å…ˆçº§ 1 </span></span></span><br><span class="line"><span class="comment"><span class="language-css">		 *      é€šé…* ï¼Œ    ä¼˜å…ˆçº§ 0</span></span></span><br><span class="line"><span class="comment"><span class="language-css">		 *      ç»§æ‰¿çš„æ ·å¼ï¼Œæ²¡æœ‰ä¼˜å…ˆçº§</span></span></span><br><span class="line"><span class="comment"><span class="language-css">		 * </span></span></span><br><span class="line"><span class="comment"><span class="language-css">		 * å½“é€‰æ‹©å™¨ä¸­åŒ…å«å¤šç§é€‰æ‹©å™¨æ—¶ï¼Œéœ€è¦å°†å¤šç§é€‰æ‹©å™¨çš„ä¼˜å…ˆçº§ç›¸åŠ ç„¶ååœ¨æ¯”è¾ƒï¼Œ</span></span></span><br><span class="line"><span class="comment"><span class="language-css">		 *  ä½†æ˜¯æ³¨æ„ï¼Œé€‰æ‹©å™¨ä¼˜å…ˆçº§è®¡ç®—ä¸ä¼šè¶…è¿‡ä»–çš„æœ€å¤§çš„æ•°é‡çº§ï¼Œå¦‚æœé€‰æ‹©å™¨çš„ä¼˜å…ˆçº§ä¸€æ ·ï¼Œåˆ™ä½¿ç”¨é åçš„æ ·å¼ã€‚å¯¹äºå…¨æ˜¯ç±»é€‰æ‹©å™¨ï¼Œå…ƒç´ çš„è·¯å¾„è¦å†™å…¨ã€‚</span></span></span><br><span class="line"><span class="comment"><span class="language-css">		 *  å¹¶é›†é€‰æ‹©å™¨çš„ä¼˜å…ˆçº§æ˜¯å•ç‹¬è®¡ç®—</span></span></span><br><span class="line"><span class="comment"><span class="language-css">		 *  div , p , #p1 , .hello&#123;&#125;    </span></span></span><br><span class="line"><span class="comment"><span class="language-css">		 * </span></span></span><br><span class="line"><span class="comment"><span class="language-css">		 *  å¯ä»¥åœ¨æ ·å¼çš„æœ€åï¼Œæ·»åŠ ä¸€ä¸ª!importantï¼Œåˆ™æ­¤æ—¶è¯¥æ ·å¼å°†ä¼šè·å¾—ä¸€ä¸ªæœ€é«˜çš„ä¼˜å…ˆçº§ï¼Œ</span></span></span><br><span class="line"><span class="comment"><span class="language-css">		 *  å°†ä¼šä¼˜å…ˆäºæ‰€æœ‰çš„æ ·å¼æ˜¾ç¤ºç”šè‡³è¶…è¿‡å†…è”æ ·å¼ï¼Œä½†æ˜¯åœ¨å¼€å‘ä¸­å°½é‡é¿å…ä½¿ç”¨!important</span></span></span><br><span class="line"><span class="comment"><span class="language-css">		 * </span></span></span><br><span class="line"><span class="comment"><span class="language-css">		 */</span></span></span><br><span class="line"><span class="language-css">		* &#123;</span></span><br><span class="line"><span class="language-css">			<span class="attribute">font-size</span>: <span class="number">30px</span>;</span></span><br><span class="line"><span class="language-css">		&#125;</span></span><br><span class="line"><span class="language-css">		</span></span><br><span class="line"><span class="language-css">		<span class="selector-tag">p</span> &#123;</span></span><br><span class="line"><span class="language-css">			<span class="attribute">font-size</span>: <span class="number">20px</span>;</span></span><br><span class="line"><span class="language-css">		&#125;</span></span><br><span class="line"><span class="language-css">		</span></span><br><span class="line"><span class="language-css">		<span class="selector-id">#p2</span> &#123;</span></span><br><span class="line"><span class="language-css">			<span class="attribute">background-color</span>: yellowgreen;</span></span><br><span class="line"><span class="language-css">		&#125;</span></span><br><span class="line"><span class="language-css">		<span class="comment">/* på’Œ#p2ä¹‹é—´æ²¡æœ‰ç©ºæ ¼ï¼šäº¤é›†é€‰æ‹©å™¨ */</span></span></span><br><span class="line"><span class="language-css">		</span></span><br><span class="line"><span class="language-css">		<span class="selector-tag">p</span><span class="selector-id">#p2</span> &#123;</span></span><br><span class="line"><span class="language-css">			<span class="attribute">background-color</span>: red;</span></span><br><span class="line"><span class="language-css">		&#125;</span></span><br><span class="line"><span class="language-css">		</span></span><br><span class="line"><span class="language-css">		<span class="selector-class">.p3</span> &#123;</span></span><br><span class="line"><span class="language-css">			<span class="attribute">color</span>: green;</span></span><br><span class="line"><span class="language-css">		&#125;</span></span><br><span class="line"><span class="language-css">		</span></span><br><span class="line"><span class="language-css">		<span class="selector-class">.p1</span> &#123;</span></span><br><span class="line"><span class="language-css">			<span class="attribute">color</span>: green;</span></span><br><span class="line"><span class="language-css">			<span class="attribute">background-color</span>: greenyellow <span class="meta">!important</span>;</span></span><br><span class="line"><span class="language-css">		&#125;</span></span><br><span class="line"><span class="language-css">	</span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;p1 p3&quot;</span> <span class="attr">id</span>=<span class="string">&quot;p2&quot;</span> <span class="attr">style</span>=<span class="string">&quot;background-color: orange;&quot;</span>&gt;</span>æˆ‘æ˜¯ä¸€ä¸ªæ®µè½</span><br><span class="line">			<span class="tag">&lt;<span class="name">span</span>&gt;</span>æˆ‘æ˜¯pæ ‡ç­¾ä¸­çš„span<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>



<h2 id="æ˜¾ç¤ºæ¨¡å¼"><a href="#æ˜¾ç¤ºæ¨¡å¼" class="headerlink" title="æ˜¾ç¤ºæ¨¡å¼"></a>æ˜¾ç¤ºæ¨¡å¼</h2><h2 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h2><h2 id="ä¸‰å¤§ç‰¹æ€§"><a href="#ä¸‰å¤§ç‰¹æ€§" class="headerlink" title="ä¸‰å¤§ç‰¹æ€§"></a>ä¸‰å¤§ç‰¹æ€§</h2><h3 id="å±‚å æ€§"><a href="#å±‚å æ€§" class="headerlink" title="å±‚å æ€§"></a>å±‚å æ€§</h3><h3 id="ç»§æ‰¿æ€§"><a href="#ç»§æ‰¿æ€§" class="headerlink" title="ç»§æ‰¿æ€§"></a>ç»§æ‰¿æ€§</h3><h3 id="ä¼˜å…ˆçº§"><a href="#ä¼˜å…ˆçº§" class="headerlink" title="ä¼˜å…ˆçº§"></a>ä¼˜å…ˆçº§</h3><h2 id="ç›’å­æ¨¡å‹"><a href="#ç›’å­æ¨¡å‹" class="headerlink" title="ç›’å­æ¨¡å‹"></a>ç›’å­æ¨¡å‹</h2><h2 id="æµ®åŠ¨"><a href="#æµ®åŠ¨" class="headerlink" title="æµ®åŠ¨"></a>æµ®åŠ¨</h2><h2 id="å®šä½"><a href="#å®šä½" class="headerlink" title="å®šä½"></a>å®šä½</h2><h2 id="å¸¸è§æ˜¾ç¤ºæ•ˆæœ"><a href="#å¸¸è§æ˜¾ç¤ºæ•ˆæœ" class="headerlink" title="å¸¸è§æ˜¾ç¤ºæ•ˆæœ"></a>å¸¸è§æ˜¾ç¤ºæ•ˆæœ</h2><h1 id="HTML5"><a href="#HTML5" class="headerlink" title="HTML5"></a>HTML5</h1><h1 id="CSS3"><a href="#CSS3" class="headerlink" title="CSS3"></a>CSS3</h1></tfoot></tbody></tr></thead></thead>]]></content>
  </entry>
  <entry>
    <title>JavaSE</title>
    <url>/2023/02/27/JavaSE/</url>
    <content><![CDATA[]]></content>
  </entry>
  <entry>
    <title>JavaBasic</title>
    <url>/2023/02/28/JavaBasic/</url>
    <content><![CDATA[<h1 id><a href="#" class="headerlink" title></a></h1><h1 id="Javaå…¥é—¨"><a href="#Javaå…¥é—¨" class="headerlink" title="Javaå…¥é—¨"></a>Javaå…¥é—¨</h1><h1 id="å¤šçº¿ç¨‹"><a href="#å¤šçº¿ç¨‹" class="headerlink" title="å¤šçº¿ç¨‹"></a>å¤šçº¿ç¨‹</h1><h2 id="JUC"><a href="#JUC" class="headerlink" title="JUC"></a>JUC</h2><h3 id="JUCç®€ä»‹"><a href="#JUCç®€ä»‹" class="headerlink" title="JUCç®€ä»‹"></a>JUCç®€ä»‹</h3><h3 id="volatileå…³é”®å­—ï¼šå†…å­˜å¯è§æ€§"><a href="#volatileå…³é”®å­—ï¼šå†…å­˜å¯è§æ€§" class="headerlink" title="volatileå…³é”®å­—ï¼šå†…å­˜å¯è§æ€§"></a>volatileå…³é”®å­—ï¼šå†…å­˜å¯è§æ€§</h3><p>é—®é¢˜ç¤ºä¾‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.basic.thread.juc.volatiletest;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">VolatileTest01</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">ThreadDemo</span> <span class="variable">t1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ThreadDemo</span>();</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(t1).start();</span><br><span class="line">        <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (t1.isFlag()) &#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;--------------------&quot;</span>);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ThreadDemo</span> <span class="keyword">implements</span> <span class="title class_">Runnable</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">boolean</span> <span class="variable">flag</span> <span class="operator">=</span> <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Thread.sleep(<span class="number">200</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        flag = <span class="literal">true</span>;</span><br><span class="line">        System.out.println(<span class="string">&quot;flag: &quot;</span> + isFlag());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setFlag</span><span class="params">(<span class="type">boolean</span> flag)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.flag = flag;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isFlag</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> flag;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿è¡Œç»“æœï¼š</p>
<p>flag: true</p>
<p>å¹¶æ²¡æœ‰æ‰“å° â€”â€”â€”-mainâ€”â€”â€”-</p>
<p>åŸå› ï¼š</p>
<ol>
<li><p><strong>JVMå¯¹äºæ¯ä¸ªçº¿ç¨‹ï¼Œéƒ½ä¼šåˆ†é…ä¸€ä»½ç‹¬ç«‹çš„ç¼“å­˜ç”¨äºæ“ä½œæ•°æ®ï¼ŒçœŸæ­£çš„å…±äº«æ•°æ®ä½äºä¸»å­˜ä¸­ï¼Œæ¯ä¸€ä¸ªçº¿ç¨‹æ“ä½œæ•°æ®æ—¶ä¼šä»ä¸»å­˜ä¸­å–å‡ºæ•°æ®æ”¾å…¥è‡ªå·±çš„ç¼“å­˜ï¼Œä¿®æ”¹å®Œæˆåï¼Œå†å°†ç¼“å­˜ä¸­çš„æ•°æ®åˆ·æ–°åˆ°ä¸»å­˜ã€‚mainçº¿ç¨‹é€šè¿‡ while(true) ä¸æ–­è¯»å–æ•°æ®ï¼Œå®é™…è¯»å–çš„æ˜¯ç¬¬ä¸€æ¬¡æ”¾å…¥è‡ªå·±ç¼“å­˜çš„æ•°æ®ï¼Œä»è€Œå¼•å‘äº†ã€å†…å­˜å¯è§æ€§ã€‘çš„é—®é¢˜ã€‚</strong></p>
</li>
<li><p><strong>å†…å­˜å¯è§æ€§ï¼šå¤šä¸ªçº¿ç¨‹æ“ä½œå…±äº«æ•°æ®æ—¶ï¼Œå½¼æ­¤ä¸å¯è§</strong></p>
<p> ï¼ˆ1ï¼‰<strong>ä½¿ç”¨volatileè§£å†³å†…å­˜å¯è§æ€§é—®é¢˜ï¼Œä½¿ç”¨volatileåï¼Œç³»ç»Ÿçš„å†…å­˜æ …æ ä¼šæ—¶åˆ»çš„å°†çº¿ç¨‹ç¼“å­˜çš„æ•°æ®åˆ·æ–°åˆ°ä¸»å­˜ï¼Œå¯ä»¥è®¤ä¸ºå¤šä¸ªçº¿ç¨‹ç›´æ¥æ“ä½œçš„æ˜¯ä¸»å­˜çš„æ•°æ®ã€‚</strong></p>
<p> ï¼ˆ2ï¼‰<strong>ä½†æ˜¯ï¼Œvolatileä¸å…·æœ‰äº’æ–¥æ€§ï¼Œå³å½“å‰çº¿ç¨‹è®¿é—®å…±äº«æ•°æ®æ—¶ï¼Œå…¶ä»–çº¿ç¨‹ä¾ç„¶å¯ä»¥è®¿é—®ï¼›åŒæ—¶volatileä¸èƒ½ä¿è¯åŸå­æ€§ã€‚</strong></p>
</li>
</ol>
<p>è§£å†³æ–¹æ¡ˆï¼š</p>
<ol>
<li><p>åŠ é”ï¼Œä¿è¯çº¿ç¨‹æ¯æ¬¡éƒ½ä»ä¸»å­˜ä¸­è¯»å–æ•°æ®ï¼Œä½†æ•ˆç‡å¤ªä½ã€‚</p>
<p> å…¶ä»–çº¿ç¨‹æ²¡æœ‰è·å–åˆ°é”ï¼Œå°±ä¼šé˜»å¡ï¼Œé‡æ–°ç­‰å¾…CPUåˆ†é…æ—¶é—´ç‰‡ï¼Œæ•ˆç‡ä½ã€‚</p>
 <figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">    <span class="keyword">synchronized</span> (t1) &#123;</span><br><span class="line">        <span class="keyword">if</span> (t1.isFlag()) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;--------------------&quot;</span>);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>ä½¿ç”¨volatileå…³é”®å­—ä¿®é¥°</p>
 <figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">volatile</span> <span class="type">boolean</span> <span class="variable">flag</span> <span class="operator">=</span> <span class="literal">false</span>;</span><br></pre></td></tr></table></figure>

<p> è¿è¡Œç»“æœï¼š</p>
<p> â€”â€”â€”-mainâ€”â€”â€”-<br> flag: true</p>
</li>
</ol>
<h3 id="åŸå­å˜é‡ä¸CASç®—æ³•"><a href="#åŸå­å˜é‡ä¸CASç®—æ³•" class="headerlink" title="åŸå­å˜é‡ä¸CASç®—æ³•"></a>åŸå­å˜é‡ä¸CASç®—æ³•</h3><p>é—®é¢˜ç¤ºä¾‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AtomicTest</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">AtomicDemo</span> <span class="variable">atomicDemo</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AtomicDemo</span>();</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">Thread</span>(atomicDemo).start();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">AtomicDemo</span> <span class="keyword">implements</span> <span class="title class_">Runnable</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">volatile</span> <span class="type">int</span> <span class="variable">serialNumber</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Thread.sleep(<span class="number">200</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(Thread.currentThread().getName() + <span class="string">&quot; : &quot;</span> + getSerialNumber());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> <span class="title function_">getSerialNumber</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> serialNumber++;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¾“å‡ºç»“æœï¼š</p>
<p>Thread-1 : 0<br>Thread-0 : 0<br>Thread-3 : 1<br>Thread-2 : 1<br>Thread-9 : 2<br>Thread-8 : 3<br>Thread-7 : 4<br>Thread-6 : 5<br>Thread-5 : 6<br>Thread-4 : 7</p>
<p>é—®é¢˜åŸå› ï¼š</p>
<p><strong>i++ çš„åŸå­æ€§é—®é¢˜</strong></p>
<p>i++çš„æ“ä½œå®é™…åˆ†ä¸ºä¸‰æ­¥ï¼šè¯» æ”¹ å†™</p>
<p>int i &#x3D; 10;</p>
<p>i &#x3D; i++;</p>
<p>ç›¸å½“äºä¸‰æ­¥ï¼š</p>
<p>int temp &#x3D; i;</p>
<p>i &#x3D; i + 1;</p>
<p>i &#x3D; temp;</p>
<p>åŸå­å˜é‡ï¼š</p>
<p>jdk1.5å java.concurrent.atomic åŒ…ä¸‹æä¾›äº†åŸå­å˜é‡</p>
<p>å…¶ä¸­æ‰€æœ‰çš„å˜é‡ä½¿ç”¨ volatile ä¿®é¥°ï¼Œä¿è¯å†…å­˜å¯è§æ€§ã€‚</p>
<p>é€šè¿‡ CAS ï¼ˆCompare And Swapï¼‰ç®—æ³•ä¿è¯æ•°æ®çš„åŸå­æ€§ï¼ŒCASæ˜¯ç¡¬ä»¶å¯¹äºå¹¶å‘æ“ä½œå…±äº«æ•°æ®çš„æ”¯æŒï¼ŒJVM åŒæ ·ä¹Ÿåšäº†æ”¯æŒã€‚</p>
<p>CAS åŒ…å«ä¸‰ä¸ªæ“ä½œæ•°ï¼šå†…å­˜å€¼ Vï¼Œé¢„ä¼°å€¼ Aï¼Œæ›´æ–°å€¼ Bï¼Œå½“ä¸”ä»…å½“ V&#x3D;&#x3D;A æ—¶ï¼ŒV &#x3D; Bï¼Œå¦åˆ™ä¸ä½œä»»ä½•æ“ä½œã€‚</p>
<p>æ­¥éª¤è¯´æ˜ï¼š</p>
<p>å¦‚ä¸¤ä¸ªçº¿ç¨‹æ‰§è¡Œ serialNumber++ æ“ä½œï¼š</p>
<p>serialNumberåˆå§‹å€¼ä¸º0ï¼Œä¸¤ä¸ªçº¿ç¨‹éƒ½å°†ä¸»å­˜ä¸­çš„æ•°æ®æ‹·è´è‡³å½“å‰çº¿ç¨‹çš„ç¼“å­˜ï¼Œæ­¤æ—¶å†…å­˜å€¼ä¸º 0ï¼Œçº¿ç¨‹ä¸€ä¿®æ”¹ä¸»å­˜å€¼æ—¶ï¼Œå¾—åˆ°é¢„ä¼°å€¼ä¸º 0ï¼Œä¿®æ”¹å€¼ä¸º 1ï¼Œæ­¤æ—¶ V&#x3D;&#x3D;Aï¼Œè¿›è¡Œä¿®æ”¹æ²¡æœ‰é—®é¢˜ï¼›ä½†çº¿ç¨‹äºŒè·å–çš„å†…å­˜å€¼ä¸º0ï¼Œé¢„ä¼°å€¼ A&#x3D;1ï¼Œæ›´æ–°å€¼ä¸º 1ï¼Œæ­¤æ—¶ V!&#x3D;Aï¼Œä¸è¿›è¡Œæ›´æ–°ï¼Œä»¥æ­¤ä¿è¯åŸå­æ€§ï¼Œæœ‰ä¸”ä»…æœ‰ä¸€ä¸ªçº¿ç¨‹æ›´æ–°æˆåŠŸã€‚</p>
<p>CASç®—æ³•æ•ˆç‡æ¯”é”çš„æ•ˆç‡é«˜ï¼Œå› ä¸ºä¸ä¼šæ”¾å¼ƒCPUç»™çš„æ‰§è¡Œæƒï¼Œä¸ä¼šé˜»å¡ï¼Œè€Œæ˜¯å†æ¬¡å°è¯•æ›´æ–°ã€‚ç¼ºç‚¹å¯ä»¥è¯´æ˜¯ä»£ç å†™çš„å¤šã€‚</p>
<p><strong>CASæ— é”ï¼Œä¸ä¼šé˜»å¡ï¼Œæ²¡æœ‰ä¸Šä¸‹æ–‡åˆ‡æ¢é—®é¢˜ã€‚</strong></p>
<p>é—®é¢˜è§£å†³ï¼šä½¿ç”¨åŸå­å˜é‡</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AtomicTest</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">AtomicDemo</span> <span class="variable">atomicDemo</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AtomicDemo</span>();</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">Thread</span>(atomicDemo).start();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">AtomicDemo</span> <span class="keyword">implements</span> <span class="title class_">Runnable</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//private volatile int serialNumber = 0;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">AtomicInteger</span> <span class="variable">serialNumber</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AtomicInteger</span>();</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Thread.sleep(<span class="number">200</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(Thread.currentThread().getName() + <span class="string">&quot; : &quot;</span> + getSerialNumber());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> <span class="title function_">getSerialNumber</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> serialNumber.getAndIncrement();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¾“å‡ºç»“æœï¼š</p>
<p>Thread-0 : 0<br>Thread-6 : 1<br>Thread-5 : 2<br>Thread-4 : 3<br>Thread-3 : 4<br>Thread-2 : 5<br>Thread-1 : 6<br>Thread-7 : 7<br>Thread-9 : 8<br>Thread-8 : 9</p>
<p>volatile ä¸èƒ½ä¿è¯äº’æ–¥æ€§ï¼Œå¤šä¸ªçº¿ç¨‹å¯ä»¥åŒæ—¶æ“ä½œæ•°æ®ï¼Œä¸èƒ½ä¿è¯åŸå­æ€§ã€‚</p>
<p>æ¨¡æ‹ŸCASç®—æ³•ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.basic.thread.juc.atomic;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ¨¡æ‹ŸCASç®—æ³•</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CompareAndSwapTest</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">CompareAndSwap</span> <span class="variable">cas</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CompareAndSwap</span>();</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">                <span class="type">int</span> <span class="variable">expectedValue</span> <span class="operator">=</span> cas.getValue();</span><br><span class="line">                <span class="type">boolean</span> <span class="variable">result</span> <span class="operator">=</span> cas.compareAndSet(expectedValue, (<span class="type">int</span>) (Math.random() * <span class="number">10</span>));</span><br><span class="line">                System.out.println(<span class="string">&quot;result: &quot;</span> + result);</span><br><span class="line">            &#125;).start();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">CompareAndSwap</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> value;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getValue</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> value;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="type">int</span> <span class="title function_">compareAndSwap</span><span class="params">(<span class="type">int</span> expectedValue, <span class="type">int</span> newValue)</span> &#123;</span><br><span class="line">        <span class="comment">//æ¨¡æ‹Ÿä»å†…å­˜ä¸­å–å€¼</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">oldValue</span> <span class="operator">=</span> getValue();</span><br><span class="line">        <span class="keyword">if</span> (expectedValue == oldValue) &#123;</span><br><span class="line">            <span class="built_in">this</span>.value = newValue;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> oldValue;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è®¾ç½®å€¼</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="type">boolean</span> <span class="title function_">compareAndSet</span><span class="params">(<span class="type">int</span> expectedValue, <span class="type">int</span> newValue)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> expectedValue == compareAndSwap(expectedValue, newValue);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="ConcurrentHashMapé”åˆ†æ®µæœºåˆ¶"><a href="#ConcurrentHashMapé”åˆ†æ®µæœºåˆ¶" class="headerlink" title="ConcurrentHashMapé”åˆ†æ®µæœºåˆ¶"></a>ConcurrentHashMapé”åˆ†æ®µæœºåˆ¶</h3><p>Hashtableçš„é—®é¢˜ï¼š</p>
<ol>
<li>å•ç‹¬æ–¹æ³•åŠ é”ï¼Œæ•ˆç‡ä½</li>
<li>å¤åˆæ“ä½œä»ç„¶æ˜¯çº¿ç¨‹ä¸å®‰å…¨çš„ï¼Œå¦‚ä¸å­˜åœ¨åˆ™æ·»åŠ æ“ä½œã€‚</li>
</ol>
<p>Java8ä»¥åï¼ŒConcurrentHashMapé‡‡ç”¨CASä»£æ›¿ï¼Œä¸å†ä½¿ç”¨åˆ†æ®µé”ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.basic.thread.juc.concurrent;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.Collections;</span><br><span class="line"><span class="keyword">import</span> java.util.Iterator;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * CopyOnWriteArrayList/Set</span></span><br><span class="line"><span class="comment"> * å†™æ—¶å¤åˆ¶ï¼Œé¿å…äº†å¹¶å‘ä¿®æ”¹é—®é¢˜ï¼Œä½†æ˜¯å†™å…¥æ•°æ®æ—¶ä¼šå¤åˆ¶ä¸€ä»½List/Setï¼Œæ•ˆç‡ä½</span></span><br><span class="line"><span class="comment"> * é€‚åˆäºå¤šè¯»å°‘äº›ï¼Œä½†åˆæœ‰å¹¶å‘ä¿®æ”¹éœ€æ±‚çš„åœºæ™¯</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CopyOnWriteArrayListTest</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">CopyOnWriteArrayListDemo</span> <span class="variable">thread</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CopyOnWriteArrayListDemo</span>();</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">Thread</span>(thread).start();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">CopyOnWriteArrayListDemo</span> <span class="keyword">implements</span> <span class="title class_">Runnable</span> &#123;</span><br><span class="line">    <span class="comment">// ä½¿ç”¨CollectionsåŒ…è£…ä¸ºåŒæ­¥List</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> List&lt;String&gt; list =</span><br><span class="line">            Collections.synchronizedList(<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;());</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        list.add(<span class="string">&quot;A&quot;</span>);</span><br><span class="line">        list.add(<span class="string">&quot;B&quot;</span>);</span><br><span class="line">        list.add(<span class="string">&quot;C&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">        Iterator&lt;String&gt; iterator = list.iterator();</span><br><span class="line">        <span class="keyword">while</span> (iterator.hasNext()) &#123;</span><br><span class="line">            System.out.println(iterator.next());</span><br><span class="line">            <span class="comment">//è¿­ä»£æ—¶æ·»åŠ æ•°æ®ä¼šæŠ¥java.util.ConcurrentModificationException</span></span><br><span class="line">            list.add(<span class="string">&quot;D&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è§£å†³æ–¹æ¡ˆï¼š</p>
<p>ä½¿ç”¨ CopyOnWriteArrayList ä»£æ›¿ List</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> CopyOnWriteArrayList&lt;String&gt; list = <span class="keyword">new</span> <span class="title class_">CopyOnWriteArrayList</span>&lt;&gt;();</span><br></pre></td></tr></table></figure>



<h3 id="è¾…åŠ©ç±»"><a href="#è¾…åŠ©ç±»" class="headerlink" title="è¾…åŠ©ç±»"></a>è¾…åŠ©ç±»</h3><h4 id="CountDownLatché—­é”"><a href="#CountDownLatché—­é”" class="headerlink" title="CountDownLatché—­é”"></a>CountDownLatché—­é”</h4><p>åŒæ­¥è¾…åŠ©ç±»</p>
<p>ä»£ç ç¤ºä¾‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.basic.thread.juc.concurrent;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.CountDownLatch;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * CountDownLatchï¼š</span></span><br><span class="line"><span class="comment"> * é—­é”ï¼Œåœ¨å®ŒæˆæŸäº›è¿ç®—æ—¶ï¼Œåªæœ‰å…¶ä»–çº¿ç¨‹çš„è¿ç®—å…¨éƒ¨å®Œæˆï¼Œå½“å‰è¿ç®—æ‰ç»§ç»­æ‰§è¡Œ</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CountDownLatchTest</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> <span class="number">5</span>;</span><br><span class="line">        <span class="type">CountDownLatch</span> <span class="variable">countDownLatch</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CountDownLatch</span>(count);</span><br><span class="line">        <span class="type">CountDownLatchThread</span> <span class="variable">thread</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CountDownLatchThread</span>(countDownLatch);</span><br><span class="line">        <span class="type">long</span> <span class="variable">start</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; count; i++) &#123;</span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">Thread</span>(thread).start();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            countDownLatch.await();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">long</span> <span class="variable">end</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line">        System.out.println(<span class="string">&quot;Times: &quot;</span> + (end - start));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">CountDownLatchThread</span> <span class="keyword">implements</span> <span class="title class_">Runnable</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> CountDownLatch countDownLatch;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">CountDownLatchThread</span><span class="params">(CountDownLatch latch)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.countDownLatch = latch;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">1000</span>; i++) &#123;</span><br><span class="line">                <span class="keyword">if</span> (i % <span class="number">2</span> == <span class="number">0</span>) &#123;</span><br><span class="line">                    System.out.println(i);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            <span class="comment">// å¿…é¡»æ‰§è¡Œï¼Œå¦åˆ™é˜»å¡</span></span><br><span class="line">            countDownLatch.countDown();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="CyclicBarrierå¾ªç¯æ …æ "><a href="#CyclicBarrierå¾ªç¯æ …æ " class="headerlink" title="CyclicBarrierå¾ªç¯æ …æ "></a>CyclicBarrierå¾ªç¯æ …æ </h4><h4 id="Semaphoreä¿¡å·ç¯"><a href="#Semaphoreä¿¡å·ç¯" class="headerlink" title="Semaphoreä¿¡å·ç¯"></a>Semaphoreä¿¡å·ç¯</h4><h3 id="å®ç°Callableæ¥å£"><a href="#å®ç°Callableæ¥å£" class="headerlink" title="å®ç°Callableæ¥å£"></a>å®ç°Callableæ¥å£</h3><h3 id="LockåŒæ­¥é”"><a href="#LockåŒæ­¥é”" class="headerlink" title="LockåŒæ­¥é”"></a>LockåŒæ­¥é”</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.basic.thread.juc.lock;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.locks.Lock;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.locks.ReentrantLock;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LockTest</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">Ticket</span> <span class="variable">t</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Ticket</span>();</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt;= <span class="number">3</span>; i++) &#123;</span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">Thread</span>(t, i + <span class="string">&quot;å·çª—å£&quot;</span>).start();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Ticket</span> <span class="keyword">implements</span> <span class="title class_">Runnable</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> <span class="variable">tickets</span> <span class="operator">=</span> <span class="number">100</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">Lock</span> <span class="variable">lock</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ReentrantLock</span>();</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">            lock.lock(); <span class="comment">//ä¸Šé”</span></span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="keyword">if</span> (tickets &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                    <span class="keyword">try</span> &#123;</span><br><span class="line">                        Thread.sleep(<span class="number">200</span>);</span><br><span class="line">                    &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                        e.printStackTrace();</span><br><span class="line">                    &#125;</span><br><span class="line">                    System.out.println(Thread.currentThread().getName() + <span class="string">&quot; : &quot;</span> + (--tickets));</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">                lock.unlock(); <span class="comment">//å¿…é¡»é‡Šæ”¾é”</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="ç”Ÿäº§è€…æ¶ˆè´¹è€…"><a href="#ç”Ÿäº§è€…æ¶ˆè´¹è€…" class="headerlink" title="ç”Ÿäº§è€…æ¶ˆè´¹è€…"></a>ç”Ÿäº§è€…æ¶ˆè´¹è€…</h3><p>é€šè¿‡wait()å’ŒnotifyAll()æ§åˆ¶</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.basic.thread.juc.lock;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ç”Ÿäº§è€…æ¶ˆè´¹è€…æ¡ˆä¾‹</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ProducerAndConsumerTest</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">Clerk</span> <span class="variable">clerk</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Clerk</span>();</span><br><span class="line">        <span class="type">Producer</span> <span class="variable">producer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Producer</span>(clerk);</span><br><span class="line">        <span class="type">Consumer</span> <span class="variable">consumer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Consumer</span>(clerk);</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(producer, <span class="string">&quot;ç”Ÿäº§è€…ä¸€&quot;</span>).start();</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(consumer, <span class="string">&quot;æ¶ˆè´¹è€…ä¸€&quot;</span>).start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Clerk</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> <span class="variable">product</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è¿›è´§</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title function_">get</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (product &gt;= <span class="number">10</span>) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;äº§å“å·²æ»¡&quot;</span>);</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="built_in">this</span>.wait();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            System.out.println(Thread.currentThread().getName() + <span class="string">&quot; : &quot;</span> + (++product));</span><br><span class="line">            <span class="built_in">this</span>.notifyAll();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å–è´§</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title function_">sale</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (product &lt;= <span class="number">0</span>) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;ç¼ºè´§&quot;</span>);</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="built_in">this</span>.wait();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            System.out.println(Thread.currentThread().getName() + <span class="string">&quot; : &quot;</span> + (--product));</span><br><span class="line">            <span class="built_in">this</span>.notifyAll();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ç”Ÿäº§è€…</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Producer</span> <span class="keyword">implements</span> <span class="title class_">Runnable</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Clerk clerk;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Producer</span><span class="params">(Clerk clerk)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.clerk = clerk;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">20</span>; i++) &#123;</span><br><span class="line">            clerk.get();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ¶ˆè´¹è€…</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Consumer</span> <span class="keyword">implements</span> <span class="title class_">Runnable</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Clerk clerk;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Consumer</span><span class="params">(Clerk clerk)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.clerk = clerk;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">20</span>; i++) &#123;</span><br><span class="line">            clerk.sale();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å­˜åœ¨é—®é¢˜ï¼š</p>
<p>ä¿®æ”¹product&gt;&#x3D;1ï¼Œå»¶é•¿æ—¶é—´</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.basic.thread.juc.lock;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ç”Ÿäº§è€…æ¶ˆè´¹è€…æ¡ˆä¾‹</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ProducerAndConsumerTest</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">Clerk</span> <span class="variable">clerk</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Clerk</span>();</span><br><span class="line">        <span class="type">Producer</span> <span class="variable">producer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Producer</span>(clerk);</span><br><span class="line">        <span class="type">Consumer</span> <span class="variable">consumer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Consumer</span>(clerk);</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(producer, <span class="string">&quot;ç”Ÿäº§è€…ä¸€&quot;</span>).start();</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(consumer, <span class="string">&quot;æ¶ˆè´¹è€…ä¸€&quot;</span>).start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Clerk</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> <span class="variable">product</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è¿›è´§</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title function_">get</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (product &gt;= <span class="number">1</span>) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;äº§å“å·²æ»¡&quot;</span>);</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="built_in">this</span>.wait();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            System.out.println(Thread.currentThread().getName() + <span class="string">&quot; : &quot;</span> + (++product));</span><br><span class="line">            <span class="built_in">this</span>.notifyAll();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å–è´§</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title function_">sale</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (product &lt;= <span class="number">0</span>) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;ç¼ºè´§&quot;</span>);</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="built_in">this</span>.wait();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            System.out.println(Thread.currentThread().getName() + <span class="string">&quot; : &quot;</span> + (--product));</span><br><span class="line">            <span class="built_in">this</span>.notifyAll();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ç”Ÿäº§è€…</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Producer</span> <span class="keyword">implements</span> <span class="title class_">Runnable</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Clerk clerk;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Producer</span><span class="params">(Clerk clerk)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.clerk = clerk;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">20</span>; i++) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                Thread.sleep(<span class="number">200</span>);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">            clerk.get();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ¶ˆè´¹è€…</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Consumer</span> <span class="keyword">implements</span> <span class="title class_">Runnable</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Clerk clerk;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Consumer</span><span class="params">(Clerk clerk)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.clerk = clerk;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">20</span>; i++) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                Thread.sleep(<span class="number">200</span>);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">            clerk.sale();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>çº¿ç¨‹é˜»å¡ï¼Œç¨‹åºæ— æ³•ç»“æŸ</p>
<p>ç”Ÿäº§è€…ä¸€ : 1<br>æ¶ˆè´¹è€…ä¸€ : 0<br>ç¼ºè´§<br>ç”Ÿäº§è€…ä¸€ : 1<br>æ¶ˆè´¹è€…ä¸€ : 0<br>ç¼ºè´§<br>ç”Ÿäº§è€…ä¸€ : 1<br>æ¶ˆè´¹è€…ä¸€ : 0<br>ç¼ºè´§<br>ç”Ÿäº§è€…ä¸€ : 1<br>äº§å“å·²æ»¡<br>æ¶ˆè´¹è€…ä¸€ : 0</p>
<p>åŸå› ï¼šè™šå‡å”¤é†’</p>
<p>å½“sale()æ–¹æ³•å¾ªç¯æ¬¡æ•°åªå‰©ä¸€æ¬¡ï¼Œget()æ–¹æ³•å¾ªç¯æ¬¡æ•°åªå‰©äºŒæ¬¡ï¼Œproduct&#x3D;0æ—¶ï¼š</p>
<p>sale()æ–¹æ³•å…ˆæ‰§è¡Œï¼Œä¹‹åwait()ï¼Œæ­¤æ—¶ç”Ÿäº§è€…æ‹¿åˆ°é”èµ„æºï¼Œå¾ªç¯ä¸€æ¬¡ï¼Œ++prodcutï¼Œä¹‹ånotifyAll() ï¼Œæ¶ˆè´¹è€…æ‹¿åˆ°é”èµ„æºï¼Œwait()ç»“æŸï¼Œå¾ªç¯æ¬¡æ•°ç»“æŸï¼Œæ­¤æ—¶ç”Ÿäº§è€…æ‹¿åˆ°é”èµ„æºï¼Œæ­¤æ—¶product&#x3D;&#x3D;1ï¼Œwait()ä¹‹åï¼Œä¾¿æ²¡æœ‰äººå”¤é†’ï¼Œç¨‹åºä¾¿ä¸ä¼šç»ˆæ­¢ã€‚</p>
<p>è§£å†³æ–¹å¼ï¼šå»æ‰ else åˆ¤æ–­</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.basic.thread.juc.lock;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ç”Ÿäº§è€…æ¶ˆè´¹è€…æ¡ˆä¾‹</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ProducerAndConsumerTest</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">Clerk</span> <span class="variable">clerk</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Clerk</span>();</span><br><span class="line">        <span class="type">Producer</span> <span class="variable">producer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Producer</span>(clerk);</span><br><span class="line">        <span class="type">Consumer</span> <span class="variable">consumer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Consumer</span>(clerk);</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(producer, <span class="string">&quot;ç”Ÿäº§è€…ä¸€&quot;</span>).start();</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(consumer, <span class="string">&quot;æ¶ˆè´¹è€…ä¸€&quot;</span>).start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Clerk</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> <span class="variable">product</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è¿›è´§</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title function_">get</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (product &gt;= <span class="number">1</span>) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;äº§å“å·²æ»¡&quot;</span>);</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="built_in">this</span>.wait();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(Thread.currentThread().getName() + <span class="string">&quot; : &quot;</span> + (++product));</span><br><span class="line">        <span class="built_in">this</span>.notifyAll();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å–è´§</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title function_">sale</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (product &lt;= <span class="number">0</span>) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;ç¼ºè´§&quot;</span>);</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="built_in">this</span>.wait();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(Thread.currentThread().getName() + <span class="string">&quot; : &quot;</span> + (--product));</span><br><span class="line">        <span class="built_in">this</span>.notifyAll();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ç”Ÿäº§è€…</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Producer</span> <span class="keyword">implements</span> <span class="title class_">Runnable</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Clerk clerk;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Producer</span><span class="params">(Clerk clerk)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.clerk = clerk;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">20</span>; i++) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                Thread.sleep(<span class="number">200</span>);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">            clerk.get();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ¶ˆè´¹è€…</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Consumer</span> <span class="keyword">implements</span> <span class="title class_">Runnable</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Clerk clerk;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Consumer</span><span class="params">(Clerk clerk)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.clerk = clerk;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">20</span>; i++) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                Thread.sleep(<span class="number">200</span>);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">            clerk.sale();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ­¤æ—¶ç¨‹åºæ­£å¸¸æ‰§è¡Œç»“æŸï¼Œä½†æ˜¯å†å¢åŠ æ¶ˆè´¹è€…å’Œç”Ÿäº§è€…æ—¶ï¼Œå‡ºç°é—®é¢˜ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">new</span> <span class="title class_">Thread</span>(producer, <span class="string">&quot;ç”Ÿäº§è€…ä¸€&quot;</span>).start();</span><br><span class="line"><span class="keyword">new</span> <span class="title class_">Thread</span>(consumer, <span class="string">&quot;æ¶ˆè´¹è€…ä¸€&quot;</span>).start();</span><br><span class="line"></span><br><span class="line"><span class="keyword">new</span> <span class="title class_">Thread</span>(producer, <span class="string">&quot;ç”Ÿäº§è€…äºŒ&quot;</span>).start();</span><br><span class="line"><span class="keyword">new</span> <span class="title class_">Thread</span>(consumer, <span class="string">&quot;æ¶ˆè´¹è€…äºŒ&quot;</span>).start();</span><br><span class="line"></span><br><span class="line"><span class="keyword">new</span> <span class="title class_">Thread</span>(producer, <span class="string">&quot;ç”Ÿäº§è€…ä¸‰&quot;</span>).start();</span><br><span class="line"><span class="keyword">new</span> <span class="title class_">Thread</span>(consumer, <span class="string">&quot;æ¶ˆè´¹è€…ä¸‰&quot;</span>).start();</span><br></pre></td></tr></table></figure>

<p>è¾“å‡ºç»“æœï¼š</p>
<p>ç”Ÿäº§è€…ä¸€ : 1<br>äº§å“å·²æ»¡<br>æ¶ˆè´¹è€…ä¸€ : 0<br>æ¶ˆè´¹è€…ä¸‰ : -1<br>ç”Ÿäº§è€…äºŒ : 0<br>ç”Ÿäº§è€…ä¸€ : 1</p>
<p>åŸå› ï¼š</p>
<p>å¦‚ç¬¬ä¸€ä¸ªæ¶ˆè´¹è€…æŠ¢åˆ°èµ„æºï¼Œé˜»å¡åœ¨ wait() æ–¹æ³•å¤„ï¼Œç¬¬äºŒä¸ªæ¶ˆè´¹è€…åˆæŠ¢åˆ°èµ„æºï¼Œé˜»å¡åœ¨ wait() æ–¹æ³•å¤„ï¼Œæ­¤æ—¶ç”Ÿäº§è€… notiyfAll() ï¼Œä¸¤ä¸ªæ¶ˆè´¹è€…åŒæ—¶æ‰§è¡Œ â€“product ä¾¿ä¼šå‡ºè´Ÿå€¼ã€‚</p>
<p>è§£å†³æ–¹å¼ï¼šä½¿ç”¨whileä»£æ›¿if</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title function_">wait</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException</span><br></pre></td></tr></table></figure>

<p>å¯¼è‡´å½“å‰çº¿ç¨‹ç­‰å¾…ï¼Œç›´åˆ°å¦ä¸€ä¸ªçº¿ç¨‹è°ƒç”¨è¯¥å¯¹è±¡çš„<a href="../../java/lang/Object.html#notify--"><code>notify()</code></a>æ–¹æ³•æˆ–<a href="../../java/lang/Object.html#notifyAll--"><code>notifyAll()</code></a>æ–¹æ³•ã€‚æ¢å¥è¯è¯´ï¼Œè¿™ä¸ªæ–¹æ³•çš„è¡Œä¸ºå°±å¥½åƒç®€å•åœ°æ‰§è¡Œå‘¼å«<code>wait(0)</code> ã€‚</p>
<p>å½“å‰çš„çº¿ç¨‹å¿…é¡»æ‹¥æœ‰è¯¥å¯¹è±¡çš„æ˜¾ç¤ºå™¨ã€‚  è¯¥çº¿ç¨‹é‡Šæ”¾æ­¤ç›‘è§†å™¨çš„æ‰€æœ‰æƒï¼Œå¹¶ç­‰å¾…å¦ä¸€ä¸ªçº¿ç¨‹é€šçŸ¥ç­‰å¾…è¯¥å¯¹è±¡ç›‘è§†å™¨çš„çº¿ç¨‹é€šè¿‡è°ƒç”¨<code>notify</code>æ–¹æ³•æˆ–<code>notifyAll</code>æ–¹æ³•<code>notifyAll</code>  ã€‚ ç„¶åçº¿ç¨‹ç­‰å¾…ï¼Œç›´åˆ°å®ƒå¯ä»¥é‡æ–°è·å¾—ç›‘è§†å™¨çš„æ‰€æœ‰æƒå¹¶æ¢å¤æ‰§è¡Œã€‚ </p>
<p>åƒåœ¨ä¸€ä¸ªå‚æ•°ç‰ˆæœ¬ä¸­ï¼Œä¸­æ–­å’Œè™šå‡å”¤é†’æ˜¯å¯èƒ½çš„ï¼Œå¹¶ä¸”è¯¥æ–¹æ³•åº”è¯¥å§‹ç»ˆåœ¨å¾ªç¯ä¸­ä½¿ç”¨ï¼š </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">synchronized</span> (obj) &#123;</span><br><span class="line">       <span class="keyword">while</span> (&lt;condition does not hold&gt;)</span><br><span class="line">           obj.wait();</span><br><span class="line">       ... <span class="comment">// Perform action appropriate to condition</span></span><br><span class="line">   &#125; </span><br></pre></td></tr></table></figure>

<p>è¯¥æ–¹æ³•åªèƒ½ç”±ä½œä¸ºè¯¥å¯¹è±¡çš„ç›‘è§†å™¨çš„æ‰€æœ‰è€…çš„çº¿ç¨‹è°ƒç”¨ã€‚ </p>
<p>å®Œæ•´ä»£ç ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.basic.thread.juc.lock;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ç”Ÿäº§è€…æ¶ˆè´¹è€…æ¡ˆä¾‹</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ProducerAndConsumerTest</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">Clerk</span> <span class="variable">clerk</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Clerk</span>();</span><br><span class="line">        <span class="type">Producer</span> <span class="variable">producer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Producer</span>(clerk);</span><br><span class="line">        <span class="type">Consumer</span> <span class="variable">consumer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Consumer</span>(clerk);</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(producer, <span class="string">&quot;ç”Ÿäº§è€…ä¸€&quot;</span>).start();</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(consumer, <span class="string">&quot;æ¶ˆè´¹è€…ä¸€&quot;</span>).start();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(producer, <span class="string">&quot;ç”Ÿäº§è€…äºŒ&quot;</span>).start();</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(consumer, <span class="string">&quot;æ¶ˆè´¹è€…äºŒ&quot;</span>).start();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(producer, <span class="string">&quot;ç”Ÿäº§è€…ä¸‰&quot;</span>).start();</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(consumer, <span class="string">&quot;æ¶ˆè´¹è€…ä¸‰&quot;</span>).start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Clerk</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> <span class="variable">product</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è¿›è´§</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title function_">get</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">while</span> (product &gt;= <span class="number">1</span>) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;äº§å“å·²æ»¡&quot;</span>);</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="built_in">this</span>.wait();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(Thread.currentThread().getName() + <span class="string">&quot; : &quot;</span> + (++product));</span><br><span class="line">        <span class="built_in">this</span>.notifyAll();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å–è´§</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title function_">sale</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">while</span> (product &lt;= <span class="number">0</span>) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;ç¼ºè´§&quot;</span>);</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="built_in">this</span>.wait();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(Thread.currentThread().getName() + <span class="string">&quot; : &quot;</span> + (--product));</span><br><span class="line">        <span class="built_in">this</span>.notifyAll();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ç”Ÿäº§è€…</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Producer</span> <span class="keyword">implements</span> <span class="title class_">Runnable</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Clerk clerk;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Producer</span><span class="params">(Clerk clerk)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.clerk = clerk;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">20</span>; i++) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                Thread.sleep(<span class="number">200</span>);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">            clerk.get();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ¶ˆè´¹è€…</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Consumer</span> <span class="keyword">implements</span> <span class="title class_">Runnable</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Clerk clerk;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Consumer</span><span class="params">(Clerk clerk)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.clerk = clerk;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">20</span>; i++) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                Thread.sleep(<span class="number">200</span>);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">            clerk.sale();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<h3 id="Conditionæ§åˆ¶çº¿ç¨‹é€šä¿¡"><a href="#Conditionæ§åˆ¶çº¿ç¨‹é€šä¿¡" class="headerlink" title="Conditionæ§åˆ¶çº¿ç¨‹é€šä¿¡"></a>Conditionæ§åˆ¶çº¿ç¨‹é€šä¿¡</h3><h3 id="çº¿ç¨‹å…«é”"><a href="#çº¿ç¨‹å…«é”" class="headerlink" title="çº¿ç¨‹å…«é”"></a>çº¿ç¨‹å…«é”</h3><h3 id="çº¿ç¨‹æŒ‰åºäº¤æ›¿æ‰§è¡Œ"><a href="#çº¿ç¨‹æŒ‰åºäº¤æ›¿æ‰§è¡Œ" class="headerlink" title="çº¿ç¨‹æŒ‰åºäº¤æ›¿æ‰§è¡Œ"></a>çº¿ç¨‹æŒ‰åºäº¤æ›¿æ‰§è¡Œ</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.basic.thread.juc.lock;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.locks.Condition;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.locks.Lock;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.locks.ReentrantLock;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ä¸‰ä¸ªçº¿ç¨‹äº¤æ›¿æ‰“å°ABCï¼Œç¤ºä¾‹ï¼šAABBBCCCCAABBBCCCC...</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AlternatePrintABCTest</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">AlternatePrintABC</span> <span class="variable">alternatePrintABC</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AlternatePrintABC</span>();</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt;= <span class="number">20</span>; i++) &#123;</span><br><span class="line">                alternatePrintABC.loopA(i);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;, <span class="string">&quot;T1&quot;</span>).start();</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt;= <span class="number">20</span>; i++) &#123;</span><br><span class="line">                alternatePrintABC.loopB(i);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;, <span class="string">&quot;T2&quot;</span>).start();</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt;= <span class="number">20</span>; i++) &#123;</span><br><span class="line">                alternatePrintABC.loopC(i);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;, <span class="string">&quot;T3&quot;</span>).start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">AlternatePrintABC</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> <span class="variable">number</span> <span class="operator">=</span> <span class="number">1</span>; <span class="comment">//çº¿ç¨‹æ ‡è®°</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">Lock</span> <span class="variable">lock</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ReentrantLock</span>();</span><br><span class="line">    <span class="keyword">private</span> <span class="type">Condition</span> <span class="variable">condition1</span> <span class="operator">=</span> lock.newCondition();</span><br><span class="line">    <span class="keyword">private</span> <span class="type">Condition</span> <span class="variable">condition2</span> <span class="operator">=</span> lock.newCondition();</span><br><span class="line">    <span class="keyword">private</span> <span class="type">Condition</span> <span class="variable">condition3</span> <span class="operator">=</span> lock.newCondition();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">loopA</span><span class="params">(<span class="type">int</span> loop)</span> &#123;</span><br><span class="line">        lock.lock();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (number != <span class="number">1</span>) &#123;</span><br><span class="line">                condition1.await();</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt;= <span class="number">2</span>; i++) &#123;</span><br><span class="line">                System.out.println(Thread.currentThread().getName() + <span class="string">&quot;\t&quot;</span> + i + <span class="string">&quot;\t&quot;</span> + loop);</span><br><span class="line">            &#125;</span><br><span class="line">            number = <span class="number">2</span>;</span><br><span class="line">            condition2.signal();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            lock.unlock();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">loopB</span><span class="params">(<span class="type">int</span> loop)</span> &#123;</span><br><span class="line">        lock.lock();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (number != <span class="number">2</span>) &#123;</span><br><span class="line">                condition2.await();</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt;= <span class="number">3</span>; i++) &#123;</span><br><span class="line">                System.out.println(Thread.currentThread().getName() + <span class="string">&quot;\t&quot;</span> + i + <span class="string">&quot;\t&quot;</span> + loop);</span><br><span class="line">            &#125;</span><br><span class="line">            number = <span class="number">3</span>;</span><br><span class="line">            condition3.signal();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            lock.unlock();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">loopC</span><span class="params">(<span class="type">int</span> loop)</span> &#123;</span><br><span class="line">        lock.lock();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (number != <span class="number">3</span>) &#123;</span><br><span class="line">                condition3.await();</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt;= <span class="number">4</span>; i++) &#123;</span><br><span class="line">                System.out.println(Thread.currentThread().getName() + <span class="string">&quot;\t&quot;</span> + i + <span class="string">&quot;\t&quot;</span> + loop);</span><br><span class="line">            &#125;</span><br><span class="line">            number = <span class="number">1</span>;</span><br><span class="line">            condition1.signal();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            lock.unlock();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="ReadWriteLockè¯»å†™é”"><a href="#ReadWriteLockè¯»å†™é”" class="headerlink" title="ReadWriteLockè¯»å†™é”"></a>ReadWriteLockè¯»å†™é”</h3><h3 id="çº¿ç¨‹å…«é”-1"><a href="#çº¿ç¨‹å…«é”-1" class="headerlink" title="çº¿ç¨‹å…«é”"></a>çº¿ç¨‹å…«é”</h3><h4 id="ç¬¬ä¸€ç§"><a href="#ç¬¬ä¸€ç§" class="headerlink" title="ç¬¬ä¸€ç§"></a>ç¬¬ä¸€ç§</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.basic.thread.juc.lock;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * éé™æ€æ–¹æ³•çš„é”thisï¼Œé™æ€æ–¹æ³•çš„é”ä¸ºå¯¹åº”çš„Classå®ä¾‹</span></span><br><span class="line"><span class="comment"> * åŒä¸€æ—¶åˆ»ï¼Œåªèƒ½æœ‰ä¸€ä¸ªçº¿ç¨‹æŒæœ‰é”</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Thread8MonitorTest</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">T</span> <span class="variable">t</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">T</span>();</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; t.printA()).start();</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; t.printB()).start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 1. ä¸¤ä¸ªæ™®é€šåŒæ­¥æ–¹æ³•ï¼Œä¸¤ä¸ªçº¿ç¨‹ï¼Œè¾“å‡ºA B</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">T</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title function_">printA</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;A&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title function_">printB</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;B&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="ç¬¬äºŒç§"><a href="#ç¬¬äºŒç§" class="headerlink" title="ç¬¬äºŒç§"></a>ç¬¬äºŒç§</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 2. æ–°å¢Thread.sleep()æ–¹æ³•ç»™printA()ï¼Œè¾“å‡º A B</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">T</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title function_">printA</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Thread.sleep(<span class="number">2000</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(<span class="string">&quot;A&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title function_">printB</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;B&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Thread8MonitorTest</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">T</span> <span class="variable">t</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">T</span>();</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; t.printA()).start();</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; t.printB()).start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="ç¬¬ä¸‰ç§"><a href="#ç¬¬ä¸‰ç§" class="headerlink" title="ç¬¬ä¸‰ç§"></a>ç¬¬ä¸‰ç§</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 3. æ–°å¢æ™®é€šæ–¹æ³•printC()ï¼Œè¾“å‡º C A B</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">T</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title function_">printA</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Thread.sleep(<span class="number">2000</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(<span class="string">&quot;A&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title function_">printB</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;B&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">printC</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;C&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Thread8MonitorTest</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">T</span> <span class="variable">t</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">T</span>();</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; t.printA()).start();</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; t.printB()).start();</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; t.printC()).start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="ç¬¬å››ç§"><a href="#ç¬¬å››ç§" class="headerlink" title="ç¬¬å››ç§"></a>ç¬¬å››ç§</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 4. ä¸¤ä¸ªTå¯¹è±¡ï¼Œç¬¬ä¸€ä¸ªå¯¹è±¡è°ƒç”¨printA()æ–¹æ³•ï¼Œç¬¬äºŒä¸ªè°ƒç”¨printB()æ–¹æ³•ï¼Œè¾“å‡ºB C A</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">T</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title function_">printA</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Thread.sleep(<span class="number">2000</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(<span class="string">&quot;A&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title function_">printB</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;B&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">printC</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;C&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Thread8MonitorTest</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">T</span> <span class="variable">t</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">T</span>();</span><br><span class="line">        <span class="type">T</span> <span class="variable">t2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">T</span>();</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; t.printA()).start();</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; t2.printB()).start();</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; t.printC()).start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="ç¬¬äº”ç§"><a href="#ç¬¬äº”ç§" class="headerlink" title="ç¬¬äº”ç§"></a>ç¬¬äº”ç§</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 5. ä¿®æ”¹printA()ä¸ºé™æ€æ–¹æ³•ï¼ŒåŒä¸€ä¸ªTå¯¹è±¡ï¼Œè¾“å‡ºB A</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">T</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title function_">printA</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Thread.sleep(<span class="number">2000</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(<span class="string">&quot;A&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title function_">printB</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;B&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">printC</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;C&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Thread8MonitorTest</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">T</span> <span class="variable">t</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">T</span>();</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; t.printA()).start();</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; t.printB()).start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="ç¬¬å…­ç§"><a href="#ç¬¬å…­ç§" class="headerlink" title="ç¬¬å…­ç§"></a>ç¬¬å…­ç§</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 6. ä¿®æ”¹printA()å’ŒprintB()éƒ½ä¸ºé™æ€æ–¹æ³•ï¼ŒåŒä¸€ä¸ªTå¯¹è±¡ï¼Œè¾“å‡ºA B</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">T</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title function_">printA</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Thread.sleep(<span class="number">2000</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(<span class="string">&quot;A&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title function_">printB</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;B&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">printC</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;C&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Thread8MonitorTest</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">T</span> <span class="variable">t</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">T</span>();</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; t.printA()).start();</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; t.printB()).start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="ç¬¬ä¸ƒç§"><a href="#ç¬¬ä¸ƒç§" class="headerlink" title="ç¬¬ä¸ƒç§"></a>ç¬¬ä¸ƒç§</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 7. ä¿®æ”¹printA()ä¸ºé™æ€æ–¹æ³•,printB()ä¸ºéé™æ€æ–¹æ³•ï¼Œä¸¤ä¸ªTå¯¹è±¡ï¼Œè¾“å‡º B A</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">T</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title function_">printA</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Thread.sleep(<span class="number">2000</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(<span class="string">&quot;A&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title function_">printB</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;B&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">printC</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;C&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Thread8MonitorTest</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">T</span> <span class="variable">t</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">T</span>();</span><br><span class="line">        <span class="type">T</span> <span class="variable">t2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">T</span>();</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; t.printA()).start();</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; t2.printB()).start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="ç¬¬å…«ç§"><a href="#ç¬¬å…«ç§" class="headerlink" title="ç¬¬å…«ç§"></a>ç¬¬å…«ç§</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 8. ä¿®æ”¹printA()å’ŒprintB()éƒ½ä¸ºé™æ€æ–¹æ³•ï¼Œä¸¤ä¸ªTå¯¹è±¡ï¼Œè¾“å‡ºA B</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">T</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title function_">printA</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Thread.sleep(<span class="number">2000</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(<span class="string">&quot;A&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title function_">printB</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;B&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">printC</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;C&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Thread8MonitorTest</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">T</span> <span class="variable">t</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">T</span>();</span><br><span class="line">        <span class="type">T</span> <span class="variable">t2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">T</span>();</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; t.printA()).start();</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; t2.printB()).start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Callableæ¥å£"><a href="#Callableæ¥å£" class="headerlink" title="Callableæ¥å£"></a>Callableæ¥å£</h3><h3 id="çº¿ç¨‹æ± "><a href="#çº¿ç¨‹æ± " class="headerlink" title="çº¿ç¨‹æ± "></a>çº¿ç¨‹æ± </h3><p>æä¾›äº†ä¸€ç»„çº¿ç¨‹é˜Ÿåˆ—ï¼Œä¿å­˜ç€æ‰€æœ‰ç­‰å¾…çŠ¶æ€çš„çº¿ç¨‹ï¼Œé¿å…äº†çº¿ç¨‹çš„åˆ›å»ºä¸é”€æ¯é¢å¤–å¼€é”€ï¼Œæé«˜äº†å“åº”çš„é€Ÿåº¦ã€‚</p>
<p>ä½“ç³»ç»“æ„ï¼š</p>
<p>java.util.concurrent.Executorï¼šçº¿ç¨‹ä½¿ç”¨ä¸è°ƒåº¦çš„æ€»æ¥å£</p>
<p>â€‹		|â€“**ExecutorServiceå­æ¥å£ï¼šçº¿ç¨‹æ± çš„ä¸»è¦æ¥å£</p>
<p>â€‹				|â€“ThreadPoolExecutorï¼šçº¿ç¨‹æ± çš„å®ç°ç±»</p>
<p>â€‹				|â€“ScheduledExecutorServiceï¼šçº¿ç¨‹è°ƒåº¦ï¼ˆå»¶æ—¶æˆ–å®šæ—¶æ‰§è¡Œï¼‰æ¥å£</p>
<p>â€‹						|â€“ScheduledThreadPoolExecutorï¼šç»§æ‰¿ThreadPoolExecutor</p>
<p>å·¥å…·ç±»ï¼šExecutors</p>
<p>ExecutorService newFixedThreadPool()ï¼šåˆ›å»ºå›ºå®šå¤§å°çš„çº¿ç¨‹æ± </p>
<p>ExecutorService newCachedThreadPool()ï¼šåˆ›å»ºå¯å˜å¤§å°çš„çº¿ç¨‹æ± </p>
<p>ExecutorService newSingleThreadExecutor()ï¼šåˆ›å»ºå•ä¸€å¤§å°çš„çº¿ç¨‹æ± </p>
<p>ScheduledExecutorService newScheduledThreadPool()ï¼šåˆ›å»ºå›ºå®šå¤§å°çš„çº¿ç¨‹ï¼Œå¯ä»¥å»¶æ—¶æˆ–å®šæ—¶æ‰§è¡Œä»»åŠ¡</p>
<h3 id="çº¿ç¨‹è°ƒåº¦"><a href="#çº¿ç¨‹è°ƒåº¦" class="headerlink" title="çº¿ç¨‹è°ƒåº¦"></a>çº¿ç¨‹è°ƒåº¦</h3><h3 id="ForkJoinPoolåˆ†æ”¯ã€åˆå¹¶æ¡†æ¶"><a href="#ForkJoinPoolåˆ†æ”¯ã€åˆå¹¶æ¡†æ¶" class="headerlink" title="ForkJoinPoolåˆ†æ”¯ã€åˆå¹¶æ¡†æ¶"></a>ForkJoinPoolåˆ†æ”¯ã€åˆå¹¶æ¡†æ¶</h3><h1 id="ç‰ˆæœ¬ç‰¹æ€§"><a href="#ç‰ˆæœ¬ç‰¹æ€§" class="headerlink" title="ç‰ˆæœ¬ç‰¹æ€§"></a>ç‰ˆæœ¬ç‰¹æ€§</h1><h2 id="Java8"><a href="#Java8" class="headerlink" title="Java8"></a>Java8</h2><h3 id="æ–°ç‰¹æ€§ç®€ä»‹"><a href="#æ–°ç‰¹æ€§ç®€ä»‹" class="headerlink" title="æ–°ç‰¹æ€§ç®€ä»‹"></a>æ–°ç‰¹æ€§ç®€ä»‹</h3><p>å‡½æ•°å¼æ¥å£</p>
<p>Lambdaè¡¨è¾¾å¼</p>
<p>æ–¹æ³•æ„é€ ã€å¼•ç”¨æ„é€ </p>
<p>StreamAPI</p>
<p>Optionalç±»</p>
<p>æ—¥æœŸæ—¶é—´API</p>
<p>æ³¨è§£ï¼šé‡å¤æ³¨è§£ã€ç±»å‹æ³¨è§£ã€ç›®æ ‡ç±»å‹æ¨æ–­</p>
<p>JDKï¼šStringï¼ˆjoinæ–¹æ³•ï¼‰Filesã€Arraysã€Reflectionè·å–å½¢å‚ç­‰</p>
<p>JVMä¸­MetaSpaceå–ä»£Permgen</p>
<p>æ”¹è¿›ç‰¹ç‚¹ï¼š</p>
<ol>
<li><p>é€Ÿåº¦æ›´å¿«</p>
</li>
<li><p>ä»£ç æ›´å°‘(å¢åŠ äº†æ–°çš„è¯­æ³•ï¼šLambda è¡¨è¾¾å¼)</p>
</li>
<li><p>å¼ºå¤§çš„ Stream API</p>
</li>
<li><p>ä¾¿äºå¹¶è¡Œ</p>
</li>
<li><p>æœ€å¤§åŒ–å‡å°‘ç©ºæŒ‡é’ˆå¼‚å¸¸ï¼šOptional</p>
</li>
<li><p>Nashornå¼•æ“ï¼Œå…è®¸åœ¨JVMä¸Šè¿è¡ŒJSåº”ç”¨</p>
</li>
</ol>
<h3 id="Lambdaè¡¨è¾¾å¼"><a href="#Lambdaè¡¨è¾¾å¼" class="headerlink" title="Lambdaè¡¨è¾¾å¼"></a>Lambdaè¡¨è¾¾å¼</h3><blockquote>
<ol>
<li><p>Lambda æ˜¯ä¸€ä¸ªåŒ¿åå‡½æ•°ï¼Œå¯ä»¥æŠŠ Lambda è¡¨è¾¾å¼ç†è§£ä¸ºæ˜¯ä¸€æ®µå¯ä»¥ä¼ é€’çš„ä»£ç ã€‚</p>
</li>
<li><p>ä½¿ç”¨å®ƒå¯ä»¥å†™å‡ºæ›´ç®€æ´ã€æ›´çµæ´»çš„ä»£ç ï¼Œä½¿Javaçš„è¯­è¨€è¡¨è¾¾èƒ½åŠ›å¾—åˆ°äº†æå‡ã€‚</p>
</li>
<li><p>åœ¨Java 8 è¯­è¨€ä¸­å¼•å…¥çš„ä¸€ç§æ–°çš„è¯­æ³•å…ƒç´ å’Œæ“ä½œç¬¦ä¸º â€œ-&gt;â€ ï¼Œ è¯¥æ“ä½œç¬¦è¢«ç§°ä¸º Lambda æ“ä½œç¬¦æˆ–ç®­å¤´æ“ä½œç¬¦ã€‚å®ƒå°† Lambda åˆ†ä¸ºä¸¤ä¸ªéƒ¨åˆ†ï¼š</p>
<p> â€‹	å·¦ä¾§ï¼šæŒ‡å®šäº† Lambda è¡¨è¾¾å¼éœ€è¦çš„å‚æ•°åˆ—è¡¨</p>
<p> â€‹	å³ä¾§ï¼šæŒ‡å®šäº† Lambda ä½“ï¼Œæ˜¯æŠ½è±¡æ–¹æ³•çš„å®ç°é€»è¾‘ï¼Œä¹Ÿå³Lambda è¡¨è¾¾å¼è¦æ‰§è¡Œçš„åŠŸèƒ½ã€‚</p>
</li>
</ol>
</blockquote>
<h4 id="Lambdaè¯­æ³•ç¤ºä¾‹"><a href="#Lambdaè¯­æ³•ç¤ºä¾‹" class="headerlink" title="Lambdaè¯­æ³•ç¤ºä¾‹"></a>Lambdaè¯­æ³•ç¤ºä¾‹</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.basic.versionfeature.java8.lambda;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.Comparator;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.TreeSet;</span><br><span class="line"><span class="keyword">import</span> java.util.function.Consumer;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * lambdaè¯­æ³•ç¤ºä¾‹</span></span><br><span class="line"><span class="comment"> * æ“ä½œç¬¦ï¼š-&gt;</span></span><br><span class="line"><span class="comment"> * æ ¼å¼ï¼šå‚æ•°åˆ—è¡¨ -&gt; æ–¹æ³•å®ç°</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LambdaTest01</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * lambdaä½¿ç”¨ç¤ºä¾‹</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test01</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="comment">// åŒ¿åå†…éƒ¨ç±»</span></span><br><span class="line">        <span class="type">Runnable</span> <span class="variable">r</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Runnable</span>() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;runnable...&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">        <span class="comment">// ä½¿ç”¨lambdaè¡¨è¾¾å¼æ›¿æ¢åŒ¿åå†…éƒ¨ç±»</span></span><br><span class="line">        <span class="type">Runnable</span> <span class="variable">r2</span> <span class="operator">=</span> ()-&gt; System.out.println(<span class="string">&quot;runnable...&quot;</span>);</span><br><span class="line"></span><br><span class="line">        TreeSet&lt;String&gt; treeSet = <span class="keyword">new</span> <span class="title class_">TreeSet</span>&lt;&gt;(<span class="keyword">new</span> <span class="title class_">Comparator</span>&lt;String&gt;() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">compare</span><span class="params">(String o1, String o2)</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> o1.compareTo(o2);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        TreeSet&lt;String&gt; treeSet2 = <span class="keyword">new</span> <span class="title class_">TreeSet</span>&lt;&gt;((o1,o2)-&gt;o1.compareTo(o2));</span><br><span class="line">        <span class="comment">// TreeSet&lt;String&gt; treeSet3 = new TreeSet&lt;&gt;(String::compareTo);</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * lambdaè¯­æ³•ç¤ºä¾‹</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test02</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">//è¯­æ³•æ ¼å¼ä¸€ï¼šæ— å‚ï¼Œæ— è¿”å›å€¼</span></span><br><span class="line">        <span class="type">Runnable</span> <span class="variable">r</span> <span class="operator">=</span> () -&gt; System.out.println(<span class="string">&quot;runnable....&quot;</span>);</span><br><span class="line">    </span><br><span class="line">        <span class="comment">//è¯­æ³•æ ¼å¼äºŒï¼šLambda éœ€è¦ä¸€ä¸ªå‚æ•°ï¼Œä½†æ˜¯æ²¡æœ‰è¿”å›å€¼</span></span><br><span class="line">        Consumer&lt;String&gt; consumer = (String str) -&gt; System.out.println(str);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//è¯­æ³•æ ¼å¼ä¸‰ï¼šæ•°æ®ç±»å‹å¯ä»¥çœç•¥ï¼Œå› ä¸ºå¯ç”±ç¼–è¯‘å™¨æ¨æ–­å¾—å‡ºï¼Œç§°ä¸º&quot;ç±»å‹æ¨æ–­&quot;</span></span><br><span class="line">        Consumer&lt;String&gt; con1 = (str) -&gt; System.out.println(str);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//è¯­æ³•æ ¼å¼å››ï¼šLambda è‹¥åªéœ€è¦ä¸€ä¸ªå‚æ•°æ—¶ï¼Œå‚æ•°çš„å°æ‹¬å·å¯ä»¥çœç•¥</span></span><br><span class="line">        Consumer&lt;String&gt; con2 = str -&gt; System.out.println(str);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//è¯­æ³•æ ¼å¼äº”ï¼šLambda éœ€è¦ä¸¤ä¸ªæˆ–ä»¥ä¸Šçš„å‚æ•°ï¼Œå¤šæ¡æ‰§è¡Œè¯­å¥ï¼Œå¹¶ä¸”å¯ä»¥æœ‰è¿”å›å€¼</span></span><br><span class="line">        Comparator&lt;Integer&gt; con3 = (x, y) -&gt; &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;comparator....&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span> Integer.compare(x, y);</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//è¯­æ³•æ ¼å¼å…­ï¼šå½“ Lambda ä½“åªæœ‰ä¸€æ¡è¯­å¥æ—¶ï¼Œreturn ä¸å¤§æ‹¬å·è‹¥æœ‰ï¼Œéƒ½å¯ä»¥çœç•¥</span></span><br><span class="line">        Comparator&lt;Integer&gt; con4 = (x, y) -&gt; Integer.compare(x, y);</span><br><span class="line">        Comparator&lt;Integer&gt; con5 = Integer::compare;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ç±»å‹æ¨æ–­ï¼šLambdaè¡¨è¾¾å¼ä¸­æ— éœ€æŒ‡å®šç±»å‹ï¼Œç¨‹åºä¾ç„¶å¯ä»¥ç¼–è¯‘ï¼Œjavacæ¨æ–­å‡ºäº†å‚æ•°çš„ç±»å‹</span></span><br><span class="line">        List&lt;Integer&gt; arrayList = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        <span class="comment">// int[] arr = &#123;1,2,3&#125;;ä¹Ÿæ˜¯ç±»å‹æ¨æ–­ã€‚</span></span><br><span class="line">        <span class="type">int</span>[] arr = &#123;<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>&#125;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="å‡½æ•°å¼ï¼ˆFunctionalï¼‰æ¥å£"><a href="#å‡½æ•°å¼ï¼ˆFunctionalï¼‰æ¥å£" class="headerlink" title="å‡½æ•°å¼ï¼ˆFunctionalï¼‰æ¥å£"></a>å‡½æ•°å¼ï¼ˆFunctionalï¼‰æ¥å£</h3><h4 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h4><p>â€‹		åœ¨Javaä¸­ï¼Œéšç€æ–°å…´è¯­è¨€çš„æŒ‘æˆ˜ï¼ŒJavaè¿˜åº”è¯¥æ”¯æŒé¢å‘å‡½æ•°ç¼–ç¨‹ï¼ŒLambdaè¡¨è¾¾å¼æ˜¯å¯¹è±¡ï¼Œè€Œä¸æ˜¯å‡½æ•°ï¼Œå®ƒä»¬å¿…é¡»ä¾é™„äºä¸€ç±»ç‰¹åˆ«çš„å¯¹è±¡ç±»å‹ï¼Œå³å‡½æ•°å¼æ¥å£ã€‚Lambdaè¡¨è¾¾å¼å°±æ˜¯ä¸€ä¸ªå‡½æ•°å¼æ¥å£çš„å®ä¾‹ã€‚</p>
<blockquote>
<p>å®šä¹‰ï¼š</p>
<ol>
<li><p>åªåŒ…å«ä¸€ä¸ªæŠ½è±¡æ–¹æ³•çš„æ¥å£ï¼Œç§°ä¸ºå‡½æ•°å¼æ¥å£ã€‚</p>
</li>
<li><p>å‡½æ•°å¼æ¥å£å¯ä»¥æœ‰é»˜è®¤æ–¹æ³•ã€‚</p>
</li>
<li><p>å¯ä»¥é€šè¿‡ Lambda è¡¨è¾¾å¼æ¥åˆ›å»ºè¯¥æ¥å£çš„å¯¹è±¡ã€‚ï¼ˆè‹¥ Lambda è¡¨è¾¾å¼æŠ›å‡ºä¸€ä¸ªå—æ£€å¼‚å¸¸ï¼Œé‚£ä¹ˆè¯¥å¼‚å¸¸éœ€è¦åœ¨ç›®æ ‡æ¥å£çš„æŠ½è±¡æ–¹æ³•ä¸Šè¿›è¡Œå£°æ˜ï¼‰ã€‚</p>
</li>
<li><p>å¯ä»¥åœ¨ä¸€ä¸ªæ¥å£ä¸Šä½¿ç”¨ <strong>@FunctionalInterface æ³¨è§£</strong>ï¼Œå¯ä»¥æ£€æŸ¥å®ƒæ˜¯å¦æ˜¯ä¸€ä¸ªå‡½æ•°å¼æ¥å£ã€‚åŒæ—¶ javadoc ä¹Ÿä¼šåŒ…å«ä¸€æ¡å£°æ˜ï¼Œè¯´æ˜è¿™ä¸ªæ¥å£æ˜¯ä¸€ä¸ªå‡½æ•°å¼æ¥å£ã€‚</p>
</li>
<li><p>åœ¨<strong>java.util.function</strong>åŒ…ä¸‹å®šä¹‰äº†Java 8 çš„ä¸°å¯Œçš„å‡½æ•°å¼æ¥å£ã€‚</p>
</li>
<li><p><strong>Lambda è¡¨è¾¾å¼ä½œä¸ºå‚æ•°ä¼ é€’</strong>ï¼Œæ¥æ”¶Lambdaè¡¨è¾¾å¼çš„å‚æ•°ç±»å‹å¿…é¡»æ˜¯ä¸è¯¥ Lambda è¡¨è¾¾å¼å…¼å®¹çš„å‡½æ•°å¼æ¥å£çš„ç±»å‹ã€‚</p>
</li>
<li><p>å‡½æ•°å¼æ¥å£ç¤ºä¾‹ï¼š</p>
 <figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@FunctionalInterface</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Runnable</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * When an object implementing interface &lt;code&gt;Runnable&lt;/code&gt; is used</span></span><br><span class="line"><span class="comment">     * to create a thread, starting the thread causes the object&#x27;s</span></span><br><span class="line"><span class="comment">     * &lt;code&gt;run&lt;/code&gt; method to be called in that separately executing</span></span><br><span class="line"><span class="comment">     * thread.</span></span><br><span class="line"><span class="comment">     * &lt;p&gt;</span></span><br><span class="line"><span class="comment">     * The general contract of the method &lt;code&gt;run&lt;/code&gt; is that it may</span></span><br><span class="line"><span class="comment">     * take any action whatsoever.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@see</span>     java.lang.Thread#run()</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ol>
</blockquote>
<h4 id="è‡ªå®šä¹‰å‡½æ•°å¼æ¥å£"><a href="#è‡ªå®šä¹‰å‡½æ•°å¼æ¥å£" class="headerlink" title="è‡ªå®šä¹‰å‡½æ•°å¼æ¥å£"></a>è‡ªå®šä¹‰å‡½æ•°å¼æ¥å£</h4><blockquote>
<ol>
<li><p>åªæœ‰ä¸€ä¸ªæŠ½è±¡æ–¹æ³•ï¼Œå¯ä»¥æœ‰å¤šä¸ªé»˜è®¤æ–¹æ³•</p>
</li>
<li><p>ä½¿ç”¨@FunctionalInterfaceæ ‡æ³¨</p>
</li>
<li><p>è‡ªå®šä¹‰å‡½æ•°å¼æ¥å£ç¤ºä¾‹</p>
 <figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * è‡ªå®šä¹‰å‡½æ•°å¼æ¥å£ï¼š</span></span><br><span class="line"><span class="comment"> * 1.åªæœ‰ä¸€ä¸ªã€æŠ½è±¡æ–¹æ³•ã€‘ï¼Œå¯ä»¥æœ‰å¤šä¸ªé»˜è®¤æ–¹æ³•</span></span><br><span class="line"><span class="comment"> * 2.ä½¿ç”¨ <span class="doctag">@FunctionalInterface</span> æ³¨è§£æ ‡æ³¨</span></span><br><span class="line"><span class="comment"> * 3.åªè¦ä¸€ä¸ªå¯¹è±¡æ˜¯å‡½æ•°å¼æ¥å£çš„å®ä¾‹ï¼Œé‚£ä¹ˆè¯¥å¯¹è±¡å°±å¯ä»¥ç”¨Lambdaè¡¨è¾¾å¼æ¥è¡¨ç¤º</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@FunctionalInterface</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">FunctionalInterfaceCustom</span>&lt;T&gt; &#123;</span><br><span class="line">    T <span class="title function_">getValue</span><span class="params">(T t)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>Lambdaè¡¨è¾¾å¼ä½œä¸ºå‚æ•°ä¼ é€’</p>
 <figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Lambda è¡¨è¾¾å¼ä½œä¸ºå‚æ•°ä¼ é€’</span></span><br><span class="line"><span class="comment"> * 1. ä¼ é€’çš„æ˜¯ä¸€ä¸ªå‡½æ•°å‹æ¥å£çš„å®ç°ç±»</span></span><br><span class="line"><span class="comment"> * 2. æ¥æ”¶Lambdaè¡¨è¾¾å¼çš„å‚æ•°ç±»å‹å¿…é¡»æ˜¯ä¸è¯¥ Lambda è¡¨è¾¾å¼å…¼å®¹çš„å‡½æ•°å¼æ¥å£çš„ç±»å‹</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">FunctionalInterfaceCustomTest</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">changeString</span><span class="params">(</span></span><br><span class="line"><span class="params">            String source,</span></span><br><span class="line"><span class="params">            FunctionalInterfaceCustom&lt;String&gt; functionalInterface)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> functionalInterface.getValue(source);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">dest</span> <span class="operator">=</span> changeString(<span class="string">&quot;HelloWorld&quot;</span>, str -&gt; str.toUpperCase(Locale.ROOT));</span><br><span class="line">        System.out.println(<span class="string">&quot;dest: &quot;</span>+dest);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ol>
</blockquote>
<h4 id="Java-å†…ç½®å››å¤§æ ¸å¿ƒå‡½æ•°å¼æ¥å£"><a href="#Java-å†…ç½®å››å¤§æ ¸å¿ƒå‡½æ•°å¼æ¥å£" class="headerlink" title="Java å†…ç½®å››å¤§æ ¸å¿ƒå‡½æ•°å¼æ¥å£"></a>Java å†…ç½®å››å¤§æ ¸å¿ƒå‡½æ•°å¼æ¥å£</h4><table>
<thead>
<tr>
<th>å‡½æ•°å¼æ¥å£</th>
<th>å‚æ•°ç±»å‹</th>
<th>è¿”å›ç±»å‹</th>
<th>è¯´æ˜</th>
</tr>
</thead>
<tbody><tr>
<td>Consumer<T></T></td>
<td>T</td>
<td>void</td>
<td>æ¶ˆè´¹å‹æ¥å£ï¼švoid accept(T t) å¯¹ç±»å‹ä¸º T çš„å¯¹è±¡è¿›è¡Œæ“ä½œ</td>
</tr>
<tr>
<td>Supplier<T></T></td>
<td>æ— </td>
<td>T</td>
<td>ä¾›ç»™å‹æ¥å£ï¼šT get() è¿”å›ç±»å‹ä¸º T çš„æ¥å£</td>
</tr>
<tr>
<td>Function&lt;T,R&gt;</td>
<td>T</td>
<td>R</td>
<td>å‡½æ•°å‹æ¥å£ï¼šR apply(T t) å¯¹ç±»å‹ä¸º T çš„å¯¹è±¡æ“ä½œï¼Œè¿”å› R ç±»å‹</td>
</tr>
<tr>
<td>Predicate<T></T></td>
<td>T</td>
<td>Boolean</td>
<td>æ–­è¨€å‹æ¥å£ï¼šboolean test(T t) æ–­è¨€ç±»å‹ä¸º T çš„å¯¹è±¡æ˜¯å¦æ»¡è¶³çº¦æŸ&#x2F;æ¡ä»¶</td>
</tr>
</tbody></table>
<p>å…¶ä»–æ¥å£ï¼š</p>
<table>
<thead>
<tr>
<th>å‡½æ•°å¼æ¥å£</th>
<th>å‚æ•°ç±»å‹</th>
<th>è¿”å›ç±»å‹</th>
<th>è¯´æ˜</th>
</tr>
</thead>
<tbody><tr>
<td>BiFunction&lt;T,U,R&gt;</td>
<td>T,U</td>
<td>R</td>
<td>R apply(T t,U u) å¯¹å‚æ•° Tï¼ŒUæ“ä½œï¼Œè¿”å› R</td>
</tr>
<tr>
<td>UnaryOperator<T></T></td>
<td>T</td>
<td>T</td>
<td>T apply(T t) å¯¹ç±»å‹ä¸º T çš„å¯¹è±¡è¿›è¡Œä¸€å…ƒè¿ç®—ï¼Œè¿”å› T ç±»å‹</td>
</tr>
<tr>
<td>BinaryOperator<T></T></td>
<td>T</td>
<td>T</td>
<td>T apply(T t1,T t2) å¯¹ç±»å‹ä¸º T çš„å¯¹è±¡è¿›è¡ŒäºŒå…ƒè¿ç®—ï¼Œè¿”å› T ç±»å‹</td>
</tr>
<tr>
<td>BiConsumer&lt;T,U&gt;</td>
<td>T,U</td>
<td>void</td>
<td>void accept(T t,U u) å¯¹ç±»å‹ä¸º T,U çš„å‚æ•°è¿›è¡Œæ“ä½œ</td>
</tr>
<tr>
<td>BiPredicate&lt;T,U&gt;</td>
<td>T,U</td>
<td>boolean</td>
<td>å¯¹ç±»å‹ä¸ºT,Uçš„å‚æ•°è¿›è¡Œæ–­è¨€</td>
</tr>
<tr>
<td>ToIntFunction<T><br>ToLongFunction<T><br>ToDoubleFunction<T></T></T></T></td>
<td>T</td>
<td>int&#x2F;long&#x2F;double</td>
<td>åˆ†åˆ«è®¡ç®— int&#x2F;long&#x2F;double ç±»å‹çš„å‡½æ•°</td>
</tr>
<tr>
<td>IntFunction<T><br>LongFunction<T><br>DoubleFunction<T></T></T></T></td>
<td>int&#x2F;long&#x2F;double</td>
<td>R</td>
<td>å‚æ•°åˆ†åˆ«ä¸ºint&#x2F;long&#x2F;double çš„å‡½æ•°</td>
</tr>
</tbody></table>
<h4 id="å‡½æ•°å¼æ¥å£ç¤ºä¾‹"><a href="#å‡½æ•°å¼æ¥å£ç¤ºä¾‹" class="headerlink" title="å‡½æ•°å¼æ¥å£ç¤ºä¾‹"></a>å‡½æ•°å¼æ¥å£ç¤ºä¾‹</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.basic.versionfeature.java8.functional;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.Arrays;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.function.*;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Javaå†…ç½®æ ¸å¿ƒå‡½æ•°å¼æ¥å£æµ‹è¯•</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">FunctionInterfaceTest02</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ¶ˆè´¹å‹æ¥å£</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * public interface Consumer&lt;T&gt; è¡¨ç¤ºæ¥å—å•ä¸ªè¾“å…¥å‚æ•°å¹¶ä¸”ä¸è¿”å›ç»“æœçš„æ“ä½œ</span></span><br><span class="line"><span class="comment">     * æ–¹æ³•ï¼š</span></span><br><span class="line"><span class="comment">     *      void accept(T t) å¯¹ç»™å®šçš„å‚æ•°æ‰§è¡Œæ­¤æ“ä½œã€‚</span></span><br><span class="line"><span class="comment">     *      default Consumer&lt;T&gt; andThen(Consumer&lt;? super T&gt; after)</span></span><br><span class="line"><span class="comment">     *          è¿”å›ä¸€ä¸ªç»„åˆçš„ Consumer ï¼ŒæŒ‰é¡ºåºæ‰§è¡Œè¯¥æ“ä½œï¼Œç„¶åæ‰§è¡Œafteræ“ä½œ</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">toConsume</span><span class="params">(<span class="type">double</span> money, Consumer&lt;Double&gt; consuemr)</span> &#123;</span><br><span class="line">        consuemr.accept(money);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test01</span><span class="params">()</span> &#123;</span><br><span class="line">        toConsume(<span class="number">100</span>, m -&gt; System.out.println(<span class="string">&quot;money = &quot;</span> + m));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ–­è¨€å‹æ¥å£</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * public interface Predicate&lt;T&gt; è¡¨ç¤ºä¸€ä¸ªå‚æ•°çš„è°“è¯ï¼ˆå¸ƒå°”å€¼å‡½æ•°ï¼‰</span></span><br><span class="line"><span class="comment">     * æ–¹æ³•ï¼š</span></span><br><span class="line"><span class="comment">     *      boolean test(T t)</span></span><br><span class="line"><span class="comment">     *          åœ¨ç»™å®šçš„å‚æ•°ä¸Šè¯„ä¼°è¿™ä¸ªè°“è¯</span></span><br><span class="line"><span class="comment">     *      default Predicate&lt;T&gt; and(Predicate&lt;? super T&gt; other)</span></span><br><span class="line"><span class="comment">     *          è¿”å›ä¸€ä¸ªç»„åˆçš„è°“è¯ï¼Œè¡¨ç¤ºè¯¥è°“è¯ä¸å¦ä¸€ä¸ªè°“è¯çš„çŸ­è·¯é€»è¾‘AND</span></span><br><span class="line"><span class="comment">     *      static &lt;T&gt; Predicate&lt;T&gt; isEqual(Object targetRef)</span></span><br><span class="line"><span class="comment">     *          è¿”å›æ ¹æ® Objects.equals(Object, Object)æµ‹è¯•ä¸¤ä¸ªå‚æ•°æ˜¯å¦ç›¸ç­‰çš„è°“è¯</span></span><br><span class="line"><span class="comment">     *      default Predicate&lt;T&gt; negate()</span></span><br><span class="line"><span class="comment">     *          è¿”å›è¡¨ç¤ºæ­¤è°“è¯çš„é€»è¾‘å¦å®šçš„è°“è¯</span></span><br><span class="line"><span class="comment">     *      default Predicate&lt;T&gt; or(Predicate&lt;? super T&gt; other)</span></span><br><span class="line"><span class="comment">     *          è¿”å›ä¸€ä¸ªç»„åˆçš„è°“è¯ï¼Œè¡¨ç¤ºè¯¥è°“è¯ä¸å¦ä¸€ä¸ªè°“è¯çš„çŸ­è·¯é€»è¾‘æˆ–</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;String&gt; <span class="title function_">filterString</span><span class="params">(List&lt;String&gt; list, Predicate&lt;String&gt; predicate)</span> &#123;</span><br><span class="line">        List&lt;String&gt; result = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        <span class="keyword">for</span> (String s : list) &#123;</span><br><span class="line">            <span class="keyword">if</span> (predicate.test(s)) &#123;</span><br><span class="line">                result.add(s);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test02</span><span class="params">()</span> &#123;</span><br><span class="line">        List&lt;String&gt; result = filterString(</span><br><span class="line">                Arrays.asList(<span class="string">&quot;ä¸œäº¬&quot;</span>, <span class="string">&quot;è¥¿äº¬&quot;</span>, <span class="string">&quot;å—äº¬&quot;</span>, <span class="string">&quot;beijing&quot;</span>),</span><br><span class="line">                s -&gt; s.contains(<span class="string">&quot;äº¬&quot;</span>));</span><br><span class="line">        result.forEach(System.out::println);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ä¾›ç»™å‹æ¥å£</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * public interface Supplier&lt;T&gt; ä»£è¡¨ç»“æœä¾›åº”å•†</span></span><br><span class="line"><span class="comment">     *      æ²¡æœ‰è¦æ±‚æ¯æ¬¡è°ƒç”¨ä¾›åº”å•†æ—¶éƒ½ä¼šè¿”å›æ–°çš„æˆ–ä¸åŒçš„ç»“æœ</span></span><br><span class="line"><span class="comment">     * æ–¹æ³•ï¼š</span></span><br><span class="line"><span class="comment">     *      T get() è·å¾—ç»“æœ</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test03</span><span class="params">()</span> &#123;</span><br><span class="line">        Supplier&lt;Employee&gt; supplier = () -&gt; Employee.getAllEmployee().get(<span class="number">0</span>);</span><br><span class="line">        System.out.println(supplier.get());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å‡½æ•°å‹æ¥å£</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * public interface Function&lt;T,R&gt; è¡¨ç¤ºæ¥å—ä¸€ä¸ªå‚æ•°å¹¶äº§ç”Ÿç»“æœçš„å‡½æ•°ã€‚</span></span><br><span class="line"><span class="comment">     * æ–¹æ³•ï¼š</span></span><br><span class="line"><span class="comment">     *      default &lt;V&gt; Function&lt;T,V&gt; andThen(Function&lt;? super R,? extends V&gt; after)</span></span><br><span class="line"><span class="comment">     *          è¿”å›ä¸€ä¸ªç»„åˆå‡½æ•°ï¼Œé¦–å…ˆå°†è¯¥å‡½æ•°åº”ç”¨äºå…¶è¾“å…¥ï¼Œç„¶åå°† afterå‡½æ•°åº”ç”¨äºç»“æœã€‚</span></span><br><span class="line"><span class="comment">     *      R apply(T t) å°†æ­¤å‡½æ•°åº”ç”¨äºç»™å®šçš„å‚æ•°ã€‚</span></span><br><span class="line"><span class="comment">     *      default &lt;V&gt; Function&lt;V,R&gt; compose(Function&lt;? super V,? extends T&gt; before)</span></span><br><span class="line"><span class="comment">     *          è¿”å›ä¸€ä¸ªç»„åˆå‡½æ•°ï¼Œé¦–å…ˆå°† beforeå‡½æ•°åº”ç”¨äºå…¶è¾“å…¥ï¼Œç„¶åå°†æ­¤å‡½æ•°åº”ç”¨äºç»“æœã€‚</span></span><br><span class="line"><span class="comment">     *      static &lt;T&gt; Function&lt;T,T&gt; identity() è¿”å›ä¸€ä¸ªæ€»æ˜¯è¿”å›å…¶è¾“å…¥å‚æ•°çš„å‡½æ•°ã€‚</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test04</span><span class="params">()</span> &#123;</span><br><span class="line">        Function&lt;String, Employee&gt; function = (name) -&gt; <span class="keyword">new</span> <span class="title class_">Employee</span>(name);</span><br><span class="line">        System.out.println(function.apply(<span class="string">&quot;John&quot;</span>));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * BiFunction&lt;T,U,R&gt;</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * public interface BiFunction&lt;T,U,R&gt;è¡¨ç¤ºæ¥å—ä¸¤ä¸ªå‚æ•°å¹¶äº§ç”Ÿç»“æœçš„å‡½æ•°ã€‚</span></span><br><span class="line"><span class="comment">     * æ–¹æ³•ï¼š</span></span><br><span class="line"><span class="comment">     *      default &lt;V&gt; BiFunction&lt;T,U,V&gt; andThen(Function&lt;? super R,? extends V&gt; after)</span></span><br><span class="line"><span class="comment">     *          è¿”å›ä¸€ä¸ªç»„åˆå‡½æ•°ï¼Œé¦–å…ˆå°†æ­¤å‡½æ•°åº”ç”¨äºå…¶è¾“å…¥ï¼Œç„¶åå°† afterå‡½æ•°åº”ç”¨äºç»“æœã€‚</span></span><br><span class="line"><span class="comment">     *      R apply(T t, U u) å°†æ­¤å‡½æ•°åº”ç”¨äºç»™å®šçš„å‚æ•°ã€‚</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test05</span><span class="params">()</span> &#123;</span><br><span class="line">        BiFunction&lt;String, Character, Employee&gt; function = (name, sex) -&gt; <span class="keyword">new</span> <span class="title class_">Employee</span>(name, sex);</span><br><span class="line">        System.out.println(function.apply(<span class="string">&quot;Jane&quot;</span>, <span class="string">&#x27;W&#x27;</span>));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.basic.versionfeature.java8.functional;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.AllArgsConstructor;</span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"><span class="keyword">import</span> lombok.NoArgsConstructor;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.Arrays;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Employee</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> age;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">char</span> sex;</span><br><span class="line">    <span class="keyword">private</span> String address;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> List&lt;Employee&gt; <span class="title function_">getAllEmployee</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;(Arrays.asList(</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">Employee</span>(<span class="string">&quot;Tom&quot;</span>, <span class="number">24</span>, <span class="string">&#x27;M&#x27;</span>, <span class="string">&quot;NewYork&quot;</span>),</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">Employee</span>(<span class="string">&quot;Jerry&quot;</span>, <span class="number">19</span>, <span class="string">&#x27;W&#x27;</span>, <span class="string">&quot;ShangHai&quot;</span>),</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">Employee</span>(<span class="string">&quot;Rose&quot;</span>, <span class="number">24</span>, <span class="string">&#x27;W&#x27;</span>, <span class="string">&quot;Beijing&quot;</span>),</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">Employee</span>(<span class="string">&quot;Jack&quot;</span>, <span class="number">18</span>, <span class="string">&#x27;M&#x27;</span>, <span class="string">&quot;Xian&quot;</span>)));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Employee</span><span class="params">(String name)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Employee</span><span class="params">(String name, <span class="type">char</span> sex)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">        <span class="built_in">this</span>.sex = sex;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Employee</span><span class="params">(String name, <span class="type">char</span> sex, String address)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">        <span class="built_in">this</span>.sex = sex;</span><br><span class="line">        <span class="built_in">this</span>.address = address;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="æ–¹æ³•å¼•ç”¨ä¸æ„é€ å™¨å¼•ç”¨"><a href="#æ–¹æ³•å¼•ç”¨ä¸æ„é€ å™¨å¼•ç”¨" class="headerlink" title="æ–¹æ³•å¼•ç”¨ä¸æ„é€ å™¨å¼•ç”¨"></a>æ–¹æ³•å¼•ç”¨ä¸æ„é€ å™¨å¼•ç”¨</h3><h4 id="æ–¹æ³•å¼•ç”¨"><a href="#æ–¹æ³•å¼•ç”¨" class="headerlink" title="æ–¹æ³•å¼•ç”¨"></a>æ–¹æ³•å¼•ç”¨</h4><blockquote>
<ol>
<li><p>å½“è¦ä¼ é€’ç»™ Lambda ä½“çš„æ“ä½œï¼Œå·²ç»æœ‰å®ç°çš„æ–¹æ³•äº†ï¼Œä¸éœ€è¦è‡ªå·±å®ç°æ–¹æ³•ï¼Œå¯ä»¥ä½¿ç”¨æ–¹æ³•å¼•ç”¨ã€‚</p>
</li>
<li><p>æ–¹æ³•å¼•ç”¨å¯ä»¥çœ‹åšæ˜¯ Lambda è¡¨è¾¾å¼æ·±å±‚æ¬¡çš„è¡¨è¾¾ã€‚æ¢å¥è¯è¯´ï¼Œæ–¹æ³•å¼•ç”¨å°±æ˜¯Lambdaè¡¨è¾¾å¼ï¼Œä¹Ÿå°±æ˜¯å‡½æ•°å¼æ¥å£çš„ä¸€ä¸ªå®ä¾‹ï¼Œé€šè¿‡æ–¹æ³•çš„åå­—æ¥æŒ‡å‘ä¸€ä¸ªæ–¹æ³•ã€‚</p>
</li>
<li><p>è¦æ±‚ï¼šå®ç°æ¥å£çš„æŠ½è±¡æ–¹æ³•çš„å‚æ•°åˆ—è¡¨å’Œè¿”å›å€¼ç±»å‹ï¼Œå¿…é¡»ä¸æ–¹æ³•å¼•ç”¨çš„æ–¹æ³•çš„å‚æ•°åˆ—è¡¨å’Œè¿”å›å€¼ç±»å‹ä¿æŒä¸€è‡´ã€‚</p>
</li>
<li><p>æ ¼å¼ï¼šä½¿ç”¨æ“ä½œç¬¦ <strong>â€œ::â€</strong> å°†ç±»(æˆ–å¯¹è±¡) ä¸æ–¹æ³•ååˆ†éš”å¼€æ¥</p>
<p> å¦‚ä¸‹ä¸‰ç§ä¸»è¦ä½¿ç”¨æƒ…å†µï¼š</p>
<p> ï¼ˆ1ï¼‰å¯¹è±¡ <strong>::</strong> å®ä¾‹æ–¹æ³•å</p>
<p> ï¼ˆ2ï¼‰ç±» <strong>::</strong> é™æ€æ–¹æ³•å</p>
<p> ï¼ˆ3ï¼‰ç±» <strong>::</strong> å®ä¾‹æ–¹æ³•å</p>
</li>
</ol>
</blockquote>
<h4 id="æ–¹æ³•å¼•ç”¨ç¤ºä¾‹"><a href="#æ–¹æ³•å¼•ç”¨ç¤ºä¾‹" class="headerlink" title="æ–¹æ³•å¼•ç”¨ç¤ºä¾‹"></a>æ–¹æ³•å¼•ç”¨ç¤ºä¾‹</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.basic.versionfeature.java8.methodreference;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.example.basic.versionfeature.java8.bean.Employee;</span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Comparator;</span><br><span class="line"><span class="keyword">import</span> java.util.function.BiPredicate;</span><br><span class="line"><span class="keyword">import</span> java.util.function.Consumer;</span><br><span class="line"><span class="keyword">import</span> java.util.function.Function;</span><br><span class="line"><span class="keyword">import</span> java.util.function.Supplier;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * è¦æ±‚ï¼šå®ç°æ¥å£çš„æŠ½è±¡æ–¹æ³•çš„å‚æ•°åˆ—è¡¨å’Œè¿”å›å€¼ç±»å‹ï¼Œå¿…é¡»ä¸æ–¹æ³•å¼•ç”¨çš„æ–¹æ³•çš„å‚æ•°åˆ—è¡¨å’Œè¿”å›å€¼ç±»å‹ä¿æŒä¸€è‡´ã€‚</span></span><br><span class="line"><span class="comment"> * æ ¼å¼ï¼šä½¿ç”¨æ“ä½œç¬¦ &quot;::&quot; å°†ç±»(æˆ–å¯¹è±¡) ä¸æ–¹æ³•ååˆ†éš”å¼€æ¥ã€‚</span></span><br><span class="line"><span class="comment"> * å¦‚ä¸‹ä¸‰ç§ä¸»è¦ä½¿ç”¨æƒ…å†µï¼š</span></span><br><span class="line"><span class="comment"> * 1. å¯¹è±¡ :: å®ä¾‹æ–¹æ³•å</span></span><br><span class="line"><span class="comment"> * 2. ç±» :: é™æ€æ–¹æ³•å</span></span><br><span class="line"><span class="comment"> * 3. ç±» :: å®ä¾‹æ–¹æ³•å</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MethodReferenceTest</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æƒ…å†µä¸€ï¼šå¯¹è±¡::å®ä¾‹æ–¹æ³•</span></span><br><span class="line"><span class="comment">     * Consumer ä¸­çš„void accept(T t)</span></span><br><span class="line"><span class="comment">     * PrintStream void println(T t)</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test01</span><span class="params">()</span> &#123;</span><br><span class="line">        Consumer&lt;String&gt; consumer = str -&gt; System.out.println(str);</span><br><span class="line">        consumer.accept(<span class="string">&quot;China&quot;</span>);</span><br><span class="line">        Consumer&lt;String&gt; consumer2 = System.out::println;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Supplier T get()</span></span><br><span class="line"><span class="comment">     * Employee String getName()</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test02</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">Employee</span> <span class="variable">employee</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Employee</span>(<span class="string">&quot;Tony&quot;</span>, <span class="string">&#x27;M&#x27;</span>, <span class="string">&quot;XinJiang&quot;</span>);</span><br><span class="line">        Supplier&lt;String&gt; sup = () -&gt; employee.getName();</span><br><span class="line">        System.out.println(sup.get());</span><br><span class="line">        Supplier&lt;String&gt; supplier = employee::getName;</span><br><span class="line">        System.out.println(supplier.get());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æƒ…å†µäºŒï¼šç±»::é™æ€æ–¹æ³•</span></span><br><span class="line"><span class="comment">     * Comparator ä¸­çš„ int compare(T t)</span></span><br><span class="line"><span class="comment">     * Integer int compare(T t)</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test03</span><span class="params">()</span> &#123;</span><br><span class="line">        Comparator&lt;Integer&gt; com = (o1, o2) -&gt; Integer.compare(o1, o2);</span><br><span class="line">        System.out.println(com.compare(<span class="number">10</span>, <span class="number">9</span>));<span class="comment">//1</span></span><br><span class="line">        Comparator&lt;Integer&gt; comparator = Integer::compare;</span><br><span class="line">        System.out.println(comparator.compare(<span class="number">1</span>, <span class="number">3</span>));<span class="comment">//-1</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Function ä¸­çš„ R apply(T t)</span></span><br><span class="line"><span class="comment">     * Math Long round(Double d)</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test04</span><span class="params">()</span> &#123;</span><br><span class="line">        Function&lt;Double, Long&gt; fun = d -&gt; Math.round(d);</span><br><span class="line">        System.out.println(fun.apply(<span class="number">1.2</span>));</span><br><span class="line">        Function&lt;Double, Long&gt; fun2 = Math::round;</span><br><span class="line">        System.out.println(fun2.apply(<span class="number">1.2</span>));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æƒ…å†µä¸‰ï¼šç±»ï¼šå®ä¾‹æ–¹æ³•</span></span><br><span class="line"><span class="comment">     * Comparatorä¸­çš„int compare(T t1,T t2)</span></span><br><span class="line"><span class="comment">     * String ä¸­çš„ int t1.compareTo(t2)</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test05</span><span class="params">()</span> &#123;</span><br><span class="line">        Comparator&lt;String&gt; com1 = (s1, s2) -&gt; s1.compareTo(s2);</span><br><span class="line">        System.out.println(com1.compare(<span class="string">&quot;abc&quot;</span>, <span class="string">&quot;abd&quot;</span>));</span><br><span class="line">        <span class="comment">// ç¬¬ä¸€ä¸ªå‚æ•°ç›¸å½“äºè°ƒç”¨æ–¹ï¼šs1è°ƒç”¨compareTo</span></span><br><span class="line">        <span class="comment">// Stringé‡å†™äº†compareToæ–¹æ³•</span></span><br><span class="line">        Comparator&lt;String&gt; com2 = String::compareTo;</span><br><span class="line">        System.out.println(com2.compare(<span class="string">&quot;abc&quot;</span>, <span class="string">&quot;abe&quot;</span>));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * BigPredicateä¸­çš„boolean test(T t2,T t2)</span></span><br><span class="line"><span class="comment">     * String boolean t1.equals(t2)</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test06</span><span class="params">()</span> &#123;</span><br><span class="line">        BiPredicate&lt;String, String&gt; pre1 = (s1, s2) -&gt; s1.equals(s2);</span><br><span class="line">        System.out.println(pre1.test(<span class="string">&quot;abc&quot;</span>, <span class="string">&quot;abc&quot;</span>));</span><br><span class="line">        BiPredicate&lt;String, String&gt; pre2 = String::equals;</span><br><span class="line">        System.out.println(pre2.test(<span class="string">&quot;abd&quot;</span>, <span class="string">&quot;abc&quot;</span>));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Function ä¸­çš„R apply(T t)</span></span><br><span class="line"><span class="comment">     * Employee ä¸­çš„String getName() ç›¸å½“äº t.getName()</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * æ²¡æœ‰å‚æ•°ï¼ŒSupplier&lt;String&gt; s = å¯¹è±¡::getName();</span></span><br><span class="line"><span class="comment">     * å«å‚ï¼šFunction&lt;Employee,String&gt; s = ç±»::getName();</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test07</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">Employee</span> <span class="variable">emp</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Employee</span>(<span class="string">&quot;John&quot;</span>, <span class="string">&#x27;M&#x27;</span>, <span class="string">&quot;YunNan&quot;</span>);</span><br><span class="line">        Function&lt;Employee, String&gt; fun1 = e -&gt; e.getName();</span><br><span class="line">        System.out.println(fun1.apply(emp));</span><br><span class="line">        <span class="comment">// public String getName(Employee employee) &#123;&#125;</span></span><br><span class="line">        <span class="comment">// Function&lt;Employee,String&gt; fun2 = emp::getName;</span></span><br><span class="line">        Function&lt;Employee, String&gt; fun2 = Employee::getName;</span><br><span class="line">        System.out.println(fun2.apply(emp));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="æ„é€ å™¨å¼•ç”¨"><a href="#æ„é€ å™¨å¼•ç”¨" class="headerlink" title="æ„é€ å™¨å¼•ç”¨"></a>æ„é€ å™¨å¼•ç”¨</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.basic.versionfeature.java8.methodreference;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.example.basic.versionfeature.java8.bean.Employee;</span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.function.BiFunction;</span><br><span class="line"><span class="keyword">import</span> java.util.function.Function;</span><br><span class="line"><span class="keyword">import</span> java.util.function.Supplier;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ ¼å¼ï¼š ClassName::new</span></span><br><span class="line"><span class="comment"> * ä¸å‡½æ•°å¼æ¥å£ç›¸ç»“åˆï¼Œè‡ªåŠ¨ä¸å‡½æ•°å¼æ¥å£ä¸­æ–¹æ³•å…¼å®¹ã€‚</span></span><br><span class="line"><span class="comment"> * å¯ä»¥æŠŠæ„é€ å™¨å¼•ç”¨èµ‹å€¼ç»™å®šä¹‰çš„æ–¹æ³•ï¼Œè¦æ±‚æ„é€ å™¨å‚æ•°åˆ—è¡¨è¦ä¸æ¥å£ä¸­æŠ½è±¡</span></span><br><span class="line"><span class="comment"> * æ–¹æ³•çš„å‚æ•°åˆ—è¡¨ä¸€è‡´ï¼Œä¸”æ–¹æ³•çš„è¿”å›å€¼å³ä¸ºæ„é€ å™¨å¯¹åº”ç±»çš„å¯¹è±¡ã€‚</span></span><br><span class="line"><span class="comment"> * ä¾‹å¦‚</span></span><br><span class="line"><span class="comment"> *      Function&lt;Integer,MyClass&gt; fun = (n)-&gt;new MyClass(n);</span></span><br><span class="line"><span class="comment"> * ç­‰ä»·äº</span></span><br><span class="line"><span class="comment"> *      Function&lt;Integer,MyClass&gt; fun1 = MyClass::new;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ConstructorReferenceTest</span> &#123;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test01</span><span class="params">()</span> &#123;</span><br><span class="line">        Supplier&lt;Employee&gt; employeeSupplier = <span class="keyword">new</span> <span class="title class_">Supplier</span>&lt;Employee&gt;() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> Employee <span class="title function_">get</span><span class="params">()</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Employee</span>();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">        Supplier&lt;Employee&gt; employeeSupplier2 = () -&gt; <span class="keyword">new</span> <span class="title class_">Employee</span>();</span><br><span class="line">        Supplier&lt;Employee&gt; employeeSupplier3 = Employee::<span class="keyword">new</span>;</span><br><span class="line">        System.out.println(<span class="string">&quot;employee: &quot;</span> + employeeSupplier3.get());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test02</span><span class="params">()</span> &#123;</span><br><span class="line">        Function&lt;String, Employee&gt; employeeFunction = <span class="keyword">new</span> <span class="title class_">Function</span>&lt;String, Employee&gt;() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> Employee <span class="title function_">apply</span><span class="params">(String s)</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Employee</span>(s);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">        Function&lt;String, Employee&gt; employeeFunction2 = name -&gt; <span class="keyword">new</span> <span class="title class_">Employee</span>(name);</span><br><span class="line">        Function&lt;String, Employee&gt; employeeFunction3 = Employee::<span class="keyword">new</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test03</span><span class="params">()</span> &#123;</span><br><span class="line">        BiFunction&lt;String, Character, Employee&gt; fun = (t, u) -&gt; <span class="keyword">new</span> <span class="title class_">Employee</span>(t, u);</span><br><span class="line">        BiFunction&lt;String, Character, Employee&gt; fun1 = Employee::<span class="keyword">new</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="æ•°ç»„å¼•ç”¨"><a href="#æ•°ç»„å¼•ç”¨" class="headerlink" title="æ•°ç»„å¼•ç”¨"></a>æ•°ç»„å¼•ç”¨</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.basic.versionfeature.java8.methodreference;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.function.Function;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ•°ç»„å¼•ç”¨</span></span><br><span class="line"><span class="comment"> * æ ¼å¼ï¼š type[] :: new</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ArrayReferenceTest</span> &#123;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test01</span><span class="params">()</span> &#123;</span><br><span class="line">        Function&lt;Integer, String[]&gt; arrayFunction = n -&gt; <span class="keyword">new</span> <span class="title class_">String</span>[n];</span><br><span class="line">        Function&lt;Integer, String[]&gt; arrayFunction2 = String[]::<span class="keyword">new</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Stream"><a href="#Stream" class="headerlink" title="Stream"></a>Stream</h3><h4 id="å¹¶è¡Œæµä¸ä¸²è¡Œæµ"><a href="#å¹¶è¡Œæµä¸ä¸²è¡Œæµ" class="headerlink" title="å¹¶è¡Œæµä¸ä¸²è¡Œæµ"></a>å¹¶è¡Œæµä¸ä¸²è¡Œæµ</h4><blockquote>
<ol>
<li><p>å¹¶è¡Œæµå°±æ˜¯æŠŠä¸€ä¸ªå†…å®¹åˆ†æˆå¤šä¸ªæ•°æ®å—ï¼Œå¹¶ç”¨ä¸åŒçš„çº¿ç¨‹åˆ†åˆ«å¤„ç†æ¯ä¸ªæ•°æ®å—çš„æµã€‚ç›¸æ¯”è¾ƒä¸²è¡Œçš„æµï¼Œå¹¶è¡Œçš„æµå¯ä»¥å¾ˆå¤§ç¨‹åº¦ä¸Šæé«˜ç¨‹åºçš„æ‰§è¡Œæ•ˆç‡ã€‚</p>
</li>
<li><p>Java 8 ä¸­å°†å¹¶è¡Œè¿›è¡Œäº†ä¼˜åŒ–ï¼Œå¯ä»¥å¾ˆå®¹æ˜“çš„å¯¹æ•°æ®è¿›è¡Œå¹¶è¡Œæ“ä½œã€‚Stream API å¯ä»¥å£°æ˜æ€§åœ°é€šè¿‡parallel() ä¸ sequential() åœ¨å¹¶è¡Œæµä¸é¡ºåºæµä¹‹é—´è¿›è¡Œåˆ‡æ¢ã€‚</p>
</li>
</ol>
</blockquote>
<h4 id="Streamç®€ä»‹"><a href="#Streamç®€ä»‹" class="headerlink" title="Streamç®€ä»‹"></a>Streamç®€ä»‹</h4><blockquote>
<ol>
<li><p>Stream API ( java.util.stream) æŠŠçœŸæ­£çš„å‡½æ•°å¼ç¼–ç¨‹é£æ ¼å¼•å…¥åˆ°Javaä¸­ã€‚</p>
</li>
<li><p>Stream æ˜¯ Java8 ä¸­å¤„ç†é›†åˆçš„å…³é”®æŠ½è±¡æ¦‚å¿µï¼Œå®ƒå¯ä»¥æŒ‡å®šä½ å¸Œæœ›å¯¹é›†åˆè¿›è¡Œçš„æ“ä½œï¼Œå¯ä»¥æ‰§è¡Œéå¸¸å¤æ‚çš„<strong>æŸ¥æ‰¾ã€è¿‡æ»¤å’Œæ˜ å°„</strong>æ•°æ®ç­‰æ“ä½œã€‚ </p>
</li>
<li><p>Stream API æä¾›äº†ä¸€ç§é«˜æ•ˆä¸”æ˜“äºä½¿ç”¨çš„å¤„ç†æ•°æ®çš„æ–¹å¼ï¼ŒStreamæ˜¯Javaå±‚é¢çš„æ•°æ®å¤„ç†ã€‚</p>
</li>
<li><p>Stream å’Œ Collection é›†åˆçš„åŒºåˆ«ï¼š Collection æ˜¯ä¸€ç§é™æ€çš„å†…å­˜æ•°æ®ç»“æ„ï¼Œè€Œ Stream æ˜¯æœ‰å…³è®¡ç®—çš„ã€‚å‰è€…æ˜¯ä¸»è¦é¢å‘å†…å­˜ï¼Œå­˜å‚¨åœ¨å†…å­˜ä¸­ï¼Œåè€…ä¸»è¦æ˜¯é¢å‘ CPUï¼Œé€šè¿‡ CPU å®ç°è®¡ç®—ã€‚</p>
</li>
<li><p>Streamæ˜¯æ•°æ®æ¸ é“ï¼Œç”¨äºæ“ä½œæ•°æ®æºï¼ˆé›†åˆã€æ•°ç»„ç­‰ï¼‰æ‰€ç”Ÿæˆçš„å…ƒç´ åºåˆ—ã€‚</p>
</li>
<li><p>æ³¨æ„ï¼š</p>
<p> ï¼ˆ1ï¼‰Stream è‡ªå·±ä¸ä¼šå­˜å‚¨å…ƒç´ ã€‚</p>
<p> ï¼ˆ2ï¼‰Stream ä¸ä¼šæ”¹å˜æºå¯¹è±¡ã€‚ç›¸åï¼Œä»–ä»¬ä¼šè¿”å›ä¸€ä¸ªæŒæœ‰ç»“æœçš„æ–°Streamã€‚</p>
<p> ï¼ˆ3ï¼‰Stream æ“ä½œæ˜¯å»¶è¿Ÿæ‰§è¡Œçš„ã€‚è¿™æ„å‘³ç€ä»–ä»¬ä¼šç­‰åˆ°éœ€è¦ç»“æœçš„æ—¶å€™æ‰æ‰§è¡Œã€‚</p>
</li>
<li><p>Streamæ“ä½œæ•°æ®çš„ä¸‰ä¸ªæ­¥éª¤ï¼š</p>
<p> ï¼ˆ1ï¼‰åˆ›å»º Streamï¼Œ ä¸€ä¸ªæ•°æ®æºï¼ˆå¦‚ï¼šé›†åˆã€æ•°ç»„ï¼‰ï¼Œè·å–ä¸€ä¸ªæµ</p>
<p> ï¼ˆ2ï¼‰ä¸­é—´æ“ä½œï¼Œä¸€ä¸ªä¸­é—´æ“ä½œé“¾ï¼Œå¯¹æ•°æ®æºçš„æ•°æ®è¿›è¡Œå¤„ç†</p>
<p> ï¼ˆ3ï¼‰ ç»ˆæ­¢æ“ä½œï¼Œä¸€æ—¦æ‰§è¡Œç»ˆæ­¢æ“ä½œï¼Œå°±æ‰§è¡Œä¸­é—´æ“ä½œé“¾ï¼Œå¹¶äº§ç”Ÿç»“æœã€‚ä¹‹åï¼Œä¸ä¼šå†è¢«ä½¿ç”¨ã€‚</p>
</li>
</ol>
</blockquote>
<h4 id="Streamçš„åˆ›å»ºæ–¹å¼"><a href="#Streamçš„åˆ›å»ºæ–¹å¼" class="headerlink" title="Streamçš„åˆ›å»ºæ–¹å¼"></a>Streamçš„åˆ›å»ºæ–¹å¼</h4><h5 id="æ–¹å¼ä¸€ï¼šé€šè¿‡é›†åˆ"><a href="#æ–¹å¼ä¸€ï¼šé€šè¿‡é›†åˆ" class="headerlink" title="æ–¹å¼ä¸€ï¼šé€šè¿‡é›†åˆ"></a>æ–¹å¼ä¸€ï¼šé€šè¿‡é›†åˆ</h5><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Java8 ä¸­çš„ Collection æ¥å£è¢«æ‰©å±•ï¼Œæä¾›äº†ä¸¤ä¸ªè·å–æµçš„æ–¹æ³•ï¼š</span><br><span class="line"><span class="keyword">default</span> Stream&lt;E&gt; <span class="title function_">stream</span><span class="params">()</span> : è¿”å›ä¸€ä¸ªé¡ºåºæµ</span><br><span class="line"><span class="keyword">default</span> Stream&lt;E&gt; <span class="title function_">parallelStream</span><span class="params">()</span> : è¿”å›ä¸€ä¸ªå¹¶è¡Œæµ</span><br></pre></td></tr></table></figure>

<h5 id="æ–¹å¼äºŒï¼šé€šè¿‡æ•°ç»„Arrays"><a href="#æ–¹å¼äºŒï¼šé€šè¿‡æ•°ç»„Arrays" class="headerlink" title="æ–¹å¼äºŒï¼šé€šè¿‡æ•°ç»„Arrays"></a>æ–¹å¼äºŒï¼šé€šè¿‡æ•°ç»„Arrays</h5><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Java8 ä¸­çš„ Arrays çš„é™æ€æ–¹æ³• stream() å¯ä»¥è·å–æ•°ç»„æµï¼š</span><br><span class="line"><span class="keyword">static</span> &lt;T&gt; Stream&lt;T&gt; <span class="title function_">stream</span><span class="params">(T[] array)</span>: è¿”å›ä¸€ä¸ªæµé‡è½½å½¢å¼ï¼Œèƒ½å¤Ÿå¤„ç†å¯¹åº”åŸºæœ¬ç±»å‹çš„æ•°ç»„ï¼š</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> IntStream <span class="title function_">stream</span><span class="params">(<span class="type">int</span>[] array)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> LongStream <span class="title function_">stream</span><span class="params">(<span class="type">long</span>[] array)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> DoubleStream <span class="title function_">stream</span><span class="params">(<span class="type">double</span>[] array)</span></span><br></pre></td></tr></table></figure>

<h5 id="æ–¹å¼ä¸‰ï¼šé€šè¿‡Streamçš„of"><a href="#æ–¹å¼ä¸‰ï¼šé€šè¿‡Streamçš„of" class="headerlink" title="æ–¹å¼ä¸‰ï¼šé€šè¿‡Streamçš„of()"></a>æ–¹å¼ä¸‰ï¼šé€šè¿‡Streamçš„of()</h5><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">å¯ä»¥è°ƒç”¨Streamç±»é™æ€æ–¹æ³• of(), é€šè¿‡æ˜¾å¼çš„åˆ›å»ºä¸€ä¸ªæµã€‚å®ƒå¯ä»¥æ¥æ”¶ä»»æ„æ•°é‡çš„å‚æ•°ã€‚</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span>&lt;T&gt; Stream&lt;T&gt; <span class="title function_">of</span><span class="params">(T... values)</span> : è¿”å›ä¸€ä¸ªæµ</span><br></pre></td></tr></table></figure>

<h5 id="æ–¹å¼å››ï¼šåˆ›å»ºæ— é™æµ"><a href="#æ–¹å¼å››ï¼šåˆ›å»ºæ— é™æµ" class="headerlink" title="æ–¹å¼å››ï¼šåˆ›å»ºæ— é™æµ"></a>æ–¹å¼å››ï¼šåˆ›å»ºæ— é™æµ</h5><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">å¯ä»¥ä½¿ç”¨é™æ€æ–¹æ³• Stream.iterate() å’Œ Stream.generate()åˆ›å»ºæ— é™æµã€‚</span><br><span class="line">è¿­ä»£ï¼š<span class="keyword">public</span> <span class="keyword">static</span>&lt;T&gt; Stream&lt;T&gt; <span class="title function_">iterate</span><span class="params">(<span class="keyword">final</span> T seed, <span class="keyword">final</span> UnaryOperator&lt;T&gt; f)</span></span><br><span class="line">ç”Ÿæˆï¼š<span class="keyword">public</span> <span class="keyword">static</span>&lt;T&gt; Stream&lt;T&gt; <span class="title function_">generate</span><span class="params">(Supplier&lt;T&gt; s)</span></span><br></pre></td></tr></table></figure>

<h5 id="Streamçš„åˆ›å»ºç¤ºä¾‹"><a href="#Streamçš„åˆ›å»ºç¤ºä¾‹" class="headerlink" title="Streamçš„åˆ›å»ºç¤ºä¾‹"></a>Streamçš„åˆ›å»ºç¤ºä¾‹</h5><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.basic.versionfeature.java8.stream;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.example.basic.versionfeature.java8.bean.Employee;</span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Arrays;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.stream.IntStream;</span><br><span class="line"><span class="keyword">import</span> java.util.stream.Stream;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Streamçš„åˆ›å»ºæ–¹å¼</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">StreamCreateWayTest</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Streamåˆ›å»ºæ–¹å¼ä¸€ï¼šé€šè¿‡é›†åˆ</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test01</span><span class="params">()</span> &#123;</span><br><span class="line">        List&lt;Employee&gt; employeeList = Employee.getAllEmployee();</span><br><span class="line">        Stream&lt;Employee&gt; stream = employeeList.stream();</span><br><span class="line">        Stream&lt;Employee&gt; parallelStream = employeeList.parallelStream();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Streamçš„åˆ›å»ºæ–¹å¼äºŒï¼šé€šè¿‡æ•°ç»„Arrays.stream()</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test02</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">int</span>[] array = <span class="keyword">new</span> <span class="title class_">int</span>[]&#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>&#125;;</span><br><span class="line">        <span class="type">IntStream</span> <span class="variable">intStream</span> <span class="operator">=</span> Arrays.stream(array);</span><br><span class="line">        Employee[] employees = <span class="literal">null</span>;</span><br><span class="line">        Employee.getAllEmployee().toArray(employees);</span><br><span class="line">        Stream&lt;Employee&gt; stream = Arrays.stream(employees);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Streamçš„åˆ›å»ºæ–¹å¼ä¸‰ï¼šé€šè¿‡Stream.of</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test03</span><span class="params">()</span> &#123;</span><br><span class="line">        Stream&lt;Integer&gt; integerStream = Stream.of(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Streamçš„åˆ›å»ºæ–¹å¼å››ï¼šåˆ›å»ºæ— é™æµ</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test04</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// ç”Ÿæˆ</span></span><br><span class="line">        Stream.generate(Math::random).limit(<span class="number">10</span>).forEach(System.out::println);</span><br><span class="line">        <span class="comment">// è¿­ä»£</span></span><br><span class="line">        Stream.iterate(<span class="number">0</span>, t -&gt; t + <span class="number">2</span>).limit(<span class="number">10</span>).forEach(System.out::println);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="Stream-çš„ä¸­é—´æ“ä½œ"><a href="#Stream-çš„ä¸­é—´æ“ä½œ" class="headerlink" title="Stream çš„ä¸­é—´æ“ä½œ"></a>Stream çš„ä¸­é—´æ“ä½œ</h4><p>â€‹		å¤šä¸ªä¸­é—´æ“ä½œå¯ä»¥è¿æ¥èµ·æ¥å½¢æˆä¸€ä¸ªæµæ°´çº¿ï¼Œé™¤éæµæ°´çº¿ä¸Šè§¦å‘ç»ˆæ­¢æ“ä½œï¼Œå¦åˆ™ä¸­é—´æ“ä½œä¸ä¼šæ‰§è¡Œä»»ä½•çš„å¤„ç†ï¼Œè€Œåœ¨ç»ˆæ­¢æ“ä½œæ—¶ä¸€æ¬¡æ€§å…¨éƒ¨å¤„ç†ï¼Œç§°ä¸ºâ€œæƒ°æ€§æ±‚å€¼â€ã€‚</p>
<h5 id="ç­›é€‰ä¸åˆ‡ç‰‡"><a href="#ç­›é€‰ä¸åˆ‡ç‰‡" class="headerlink" title="ç­›é€‰ä¸åˆ‡ç‰‡"></a>ç­›é€‰ä¸åˆ‡ç‰‡</h5><table>
<thead>
<tr>
<th>æ–¹æ³•</th>
<th>æè¿°</th>
</tr>
</thead>
<tbody><tr>
<td>filter(Predicate p)</td>
<td>æ¥å—Lambdaï¼Œä»æµä¸­æ’é™¤æŸäº›å…ƒç´ </td>
</tr>
<tr>
<td>distinct()</td>
<td>ç­›é€‰ï¼Œæ ¹æ®æµä¸­å…ƒç´ çš„hashCode()å’Œequals()å»é™¤é‡å¤å…ƒç´ </td>
</tr>
<tr>
<td>limit(long maxSize)</td>
<td>æˆªæ–­æµï¼Œä½¿å…ƒç´ ä¸è¶…è¿‡ç»™å®šæ•°é‡</td>
</tr>
<tr>
<td>skip(long n)</td>
<td>è·³è¿‡æŒ‡å®šæ•°é‡ä¸ªå…ƒç´ </td>
</tr>
</tbody></table>
<h5 id="æ˜ -å°„"><a href="#æ˜ -å°„" class="headerlink" title="æ˜  å°„"></a>æ˜  å°„</h5><table>
<thead>
<tr>
<th>æ–¹æ³•</th>
<th>æè¿°</th>
</tr>
</thead>
<tbody><tr>
<td>map(Function f)</td>
<td>æ¥å—ä¸€ä¸ªå‡½æ•°ä½œä¸ºä¸€ä¸ªå‚æ•°ï¼Œè¯¥å‡½æ•°åº”ç”¨åˆ°æ¯ä¸ªå…ƒç´ ä¸Šï¼Œå¹¶å°†å…¶æ˜ å°„æˆä¸€ä¸ªæ–°çš„å…ƒç´ </td>
</tr>
<tr>
<td>flatMap(Function f)</td>
<td>æ¥å—ä¸€ä¸ªå‡½æ•°ä½œä¸ºä¸€ä¸ªå‚æ•°ï¼Œå°†æµä¸­æ¯ä¸€ä¸ªå€¼éƒ½æ¢æˆå¦ä¸€ä¸ªæµï¼Œç„¶åæŠŠæ‰€æœ‰æµè¿æ¥æˆä¸€ä¸ªæµ</td>
</tr>
<tr>
<td>mapToInt(ToIntFunction f)</td>
<td>æ¥å—ä¸€ä¸ªå‡½æ•°ä½œä¸ºä¸€ä¸ªå‚æ•°ï¼Œè¯¥å‡½æ•°åº”ç”¨åˆ°æ¯ä¸ªå…ƒç´ ä¸Šï¼Œå¹¶å°†å…¶æ˜ å°„æˆä¸€ä¸ªæ–°çš„ IntStream</td>
</tr>
<tr>
<td>mapToLong(ToLongFunction f)</td>
<td>æ¥å—ä¸€ä¸ªå‡½æ•°ä½œä¸ºä¸€ä¸ªå‚æ•°ï¼Œè¯¥å‡½æ•°åº”ç”¨åˆ°æ¯ä¸ªå…ƒç´ ä¸Šï¼Œå¹¶å°†å…¶æ˜ å°„æˆä¸€ä¸ªæ–°çš„ LongStream</td>
</tr>
<tr>
<td>mapToDouble(ToDoubleFunction f)</td>
<td>æ¥å—ä¸€ä¸ªå‡½æ•°ä½œä¸ºä¸€ä¸ªå‚æ•°ï¼Œè¯¥å‡½æ•°åº”ç”¨åˆ°æ¯ä¸ªå…ƒç´ ä¸Šï¼Œå¹¶å°†å…¶æ˜ å°„æˆä¸€ä¸ªæ–°çš„ DoubleStream</td>
</tr>
</tbody></table>
<h5 id="æ’åº"><a href="#æ’åº" class="headerlink" title="æ’åº"></a>æ’åº</h5><table>
<thead>
<tr>
<th>æ–¹æ³•</th>
<th>æè¿°</th>
</tr>
</thead>
<tbody><tr>
<td>sorted()</td>
<td>äº§ç”Ÿä¸€ä¸ªæ–°æµï¼ŒæŒ‰è‡ªç„¶é¡ºåºæ’åº</td>
</tr>
<tr>
<td>sorted(Comparator c)</td>
<td>äº§ç”Ÿä¸€ä¸ªæ–°æµï¼ŒæŒ‰ Comparator æ’åº</td>
</tr>
</tbody></table>
<h5 id="æµçš„ä¸­é—´æ“ä½œç¤ºä¾‹"><a href="#æµçš„ä¸­é—´æ“ä½œç¤ºä¾‹" class="headerlink" title="æµçš„ä¸­é—´æ“ä½œç¤ºä¾‹"></a>æµçš„ä¸­é—´æ“ä½œç¤ºä¾‹</h5><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æµ‹è¯•æµçš„ä¸­é—´æ“ä½œ</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">StreamMiddleOperateTest</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æµ‹è¯•æµçš„ç­›é€‰ä¸åˆ‡ç‰‡</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test01</span><span class="params">()</span> &#123;</span><br><span class="line">        List&lt;Employee&gt; employeeList = Employee.getAllEmployee();</span><br><span class="line">        employeeList.stream().filter(e -&gt; e.getName().contains(<span class="string">&quot;T&quot;</span>)).forEach(System.out::println);</span><br><span class="line">        employeeList.stream().limit(<span class="number">2</span>).forEach(System.out::println);</span><br><span class="line">        employeeList.stream().skip(<span class="number">2</span>).forEach(System.out::println);</span><br><span class="line">        employeeList.add(<span class="keyword">new</span> <span class="title class_">Employee</span>(<span class="string">&quot;Jack&quot;</span>, <span class="number">18</span>, <span class="string">&#x27;M&#x27;</span>, <span class="string">&quot;Xian&quot;</span>));</span><br><span class="line">        employeeList.stream().distinct().forEach(System.out::println);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æµ‹è¯•æµçš„æ˜ å°„</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test02</span><span class="params">()</span> &#123;</span><br><span class="line">        List&lt;String&gt; list = Arrays.asList(<span class="string">&quot;AA&quot;</span>, <span class="string">&quot;BB&quot;</span>, <span class="string">&quot;CC&quot;</span>, <span class="string">&quot;DD&quot;</span>);</span><br><span class="line">        list.stream().map(str -&gt; str.toLowerCase(Locale.ROOT)).forEach(System.out::println);</span><br><span class="line">        Employee.getAllEmployee().stream().map(Employee::getName)</span><br><span class="line">                .filter(name -&gt; name.length() &gt; <span class="number">3</span>).forEach(System.out::println);</span><br><span class="line">        <span class="comment">// flatMap(function f) ç±»ä¼¼äºlist.add() list.addAll()</span></span><br><span class="line">        Stream&lt;Stream&lt;Character&gt;&gt; stream = list.stream().map(StreamMiddleOperateTest::fromStringToCharacterStream);</span><br><span class="line">        stream.forEach(s -&gt; &#123;</span><br><span class="line">            s.forEach(System.out::println);</span><br><span class="line">        &#125;);</span><br><span class="line">        Stream&lt;Character&gt; flatMap = list.stream().flatMap(StreamMiddleOperateTest::fromStringToCharacterStream);</span><br><span class="line">        flatMap.forEach(System.out::println);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Stream&lt;Character&gt; <span class="title function_">fromStringToCharacterStream</span><span class="params">(String str)</span> &#123;</span><br><span class="line">        List&lt;Character&gt; list = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;(str.length());</span><br><span class="line">        <span class="keyword">for</span> (Character c : str.toCharArray()) &#123;</span><br><span class="line">            list.add(c);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> list.stream();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æµ‹è¯•æµçš„æ’åº</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test03</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// sort() è‡ªç„¶æ’åºï¼Œæ’åºå¯¹è±¡éœ€è¦å®ç°Comparableæ¥å£</span></span><br><span class="line">        List&lt;Integer&gt; list = Arrays.asList(<span class="number">23</span>, <span class="number">24</span>, -<span class="number">12</span>, <span class="number">112</span>, <span class="number">81</span>);</span><br><span class="line">        list.stream().sorted().forEach(System.out::println);</span><br><span class="line">        <span class="comment">// sorted(Comparator com) å®šåˆ¶æ’åº</span></span><br><span class="line">        Employee.getAllEmployee().stream()</span><br><span class="line">                .sorted(Comparator.comparingInt(Employee::getAge))</span><br><span class="line">                .forEach(System.out::println);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="Stream-çš„ç»ˆæ­¢æ“ä½œ"><a href="#Stream-çš„ç»ˆæ­¢æ“ä½œ" class="headerlink" title="Stream çš„ç»ˆæ­¢æ“ä½œ"></a>Stream çš„ç»ˆæ­¢æ“ä½œ</h4><p>â€‹		ç»ˆæ­¢æ“ä½œä¼šä»æµçš„æµæ°´çº¿ç”Ÿæˆç»“æœã€‚å…¶ç»“æœå¯ä»¥æ˜¯ä»»ä½•ä¸æ˜¯æµçš„å€¼ï¼Œä¾‹å¦‚ï¼š Listã€Integerï¼Œç”šè‡³æ˜¯ void ã€‚<strong>æµè¿›è¡Œäº†ç»ˆæ­¢æ“ä½œåï¼Œä¸èƒ½å†æ¬¡ä½¿ç”¨</strong>ã€‚</p>
<h5 id="åŒ¹é…ä¸æŸ¥æ‰¾"><a href="#åŒ¹é…ä¸æŸ¥æ‰¾" class="headerlink" title="åŒ¹é…ä¸æŸ¥æ‰¾"></a>åŒ¹é…ä¸æŸ¥æ‰¾</h5><table>
<thead>
<tr>
<th>æ–¹æ³•</th>
<th>è¯´æ˜</th>
</tr>
</thead>
<tbody><tr>
<td>allMatch(Predicate p)</td>
<td>æ£€æŸ¥æ˜¯å¦åŒ¹é…æ‰€æœ‰å…ƒç´ </td>
</tr>
<tr>
<td>anyMatch(Predicate p)</td>
<td>æ£€æŸ¥æ˜¯å¦è‡³å°‘åŒ¹é…å…¶ä¸­ä¸€ä¸ªå…ƒç´ </td>
</tr>
<tr>
<td>nonoMatch(Predicate p)</td>
<td>æ£€æŸ¥æ˜¯å¦æ²¡æœ‰åŒ¹é…æ‰€æœ‰å…ƒç´ </td>
</tr>
<tr>
<td>findFirst()</td>
<td>è¿”å›ç¬¬ä¸€ä¸ªå…ƒç´ </td>
</tr>
<tr>
<td>findAny()</td>
<td>è¿”å›ä»»æ„å…ƒç´ </td>
</tr>
<tr>
<td>count()</td>
<td>è¿”å›æµä¸­ä»»æ„å…ƒç´ </td>
</tr>
<tr>
<td>max(Comparator c)</td>
<td>è¿”å›æµä¸­æœ€å¤§å€¼</td>
</tr>
<tr>
<td>min(Comparator c)</td>
<td>è¿”å›æµä¸­æœ€å°å€¼</td>
</tr>
<tr>
<td>forEach(Consumer C)</td>
<td>å†…éƒ¨è¿­ä»£ï¼ˆä½¿ç”¨Collectionæ¥å£éœ€è¦ç”¨æˆ·åšè¿­ä»£ï¼šå¤–éƒ¨è¿­ä»£ï¼‰</td>
</tr>
</tbody></table>
<h5 id="å½’çº¦"><a href="#å½’çº¦" class="headerlink" title="å½’çº¦"></a>å½’çº¦</h5><table>
<thead>
<tr>
<th>æ–¹æ³•</th>
<th>è¯´æ˜</th>
</tr>
</thead>
<tbody><tr>
<td>reduce(T iden,BinaryOperator b)</td>
<td>å°†æµä¸­çš„å…ƒç´ åå¤ç»“åˆèµ·æ¥ï¼Œå¾—åˆ°ä¸€ä¸ªæ–°å€¼ï¼Œè¿”å›T</td>
</tr>
<tr>
<td>reduce(BinaryOperator b)</td>
<td>å°†æµä¸­çš„å…ƒç´ åå¤ç»“åˆèµ·æ¥ï¼Œå¾—åˆ°ä¸€ä¸ªæ–°å€¼ï¼Œè¿”å›Optional<T></T></td>
</tr>
</tbody></table>
<h5 id="æ”¶é›†"><a href="#æ”¶é›†" class="headerlink" title="æ”¶é›†"></a>æ”¶é›†</h5><table>
<thead>
<tr>
<th>æ–¹æ³•</th>
<th>è¯´æ˜</th>
</tr>
</thead>
<tbody><tr>
<td>collect(Collector c)</td>
<td>å°†æµè½¬åŒ–ä¸ºå…¶ä»–å½¢å¼ï¼Œæ¥æ”¶ä¸€ä¸ªCollectoræ¥å£çš„å®ç°ï¼Œç”¨äºç»™Streamä¸­å…ƒç´ åšæ±‡æ€»</td>
</tr>
</tbody></table>
<p>Collector æ¥å£ä¸­æ–¹æ³•çš„å®ç°å†³å®šäº†å¦‚ä½•å¯¹æµæ‰§è¡Œæ”¶é›†çš„æ“ä½œ(å¦‚æ”¶é›†åˆ° Listã€Setã€Map)ã€‚å¦å¤–ï¼Œ Collectors å®ç”¨ç±»æä¾›äº†å¾ˆå¤šé™æ€æ–¹æ³•ï¼Œå¯ä»¥æ–¹ä¾¿åœ°åˆ›å»ºå¸¸è§æ”¶é›†å™¨å®ä¾‹ï¼Œå…·ä½“æ–¹æ³•ä¸å®ä¾‹å¦‚ä¸‹è¡¨ï¼š</p>
<table>
<thead>
<tr>
<th>æ–¹æ³•</th>
<th>è¿”å›ç±»å‹</th>
<th>ä½œç”¨</th>
</tr>
</thead>
<tbody><tr>
<td>toList</td>
<td>List<T></T></td>
<td>å°†æµä¸­å…ƒç´ æ”¶é›†åˆ°List</td>
</tr>
<tr>
<td>toSet</td>
<td>Set<T></T></td>
<td>å°†æµä¸­å…ƒç´ æ”¶é›†åˆ°Set</td>
</tr>
<tr>
<td>toCollection</td>
<td>Collection<T></T></td>
<td>å°†æµæ”¶é›†åˆ°åˆ›å»ºçš„é›†åˆ</td>
</tr>
<tr>
<td>counting</td>
<td>Long</td>
<td>è®¡ç®—æµä¸­çš„ä¸ªæ•°</td>
</tr>
<tr>
<td>summingInt</td>
<td>Integer</td>
<td>å¯¹æµä¸­å…ƒç´ çš„æ•´æ•°å±æ€§æ±‚å’Œ</td>
</tr>
<tr>
<td>averagingInt</td>
<td>Double</td>
<td>è®¡ç®—æµä¸­å…ƒç´ Integerå±æ€§çš„å¹³å‡å€¼</td>
</tr>
<tr>
<td>summarizingInt</td>
<td>IntSummaryStatics</td>
<td>æ”¶é›†æµä¸­Integerå±æ€§çš„ç»Ÿè®¡å€¼</td>
</tr>
<tr>
<td>joining</td>
<td>String</td>
<td>è¿æ¥æµä¸­æ¯ä¸ªå­—ç¬¦ä¸²</td>
</tr>
<tr>
<td>maxBy</td>
<td>Optional<T></T></td>
<td>æ ¹æ®æ¯”è¾ƒå™¨é€‰æ‹©æœ€å¤§å€¼</td>
</tr>
<tr>
<td>minBy</td>
<td>Optional<T></T></td>
<td>æ ¹æ®æ¯”è¾ƒå™¨é€‰æ‹©æœ€å°å€¼</td>
</tr>
<tr>
<td>reducing</td>
<td>å½’çº¦äº§ç”Ÿçš„ç±»å‹</td>
<td>ä»ç´¯åŠ å™¨çš„åˆå§‹å€¼å¼€å§‹ï¼Œåˆ©ç”¨BinaryOPeratorä¸æµä¸­å…ƒç´ é€ä¸ªç»“åˆï¼Œä»è€Œå½’çº¦æˆå•ä¸ªå€¼</td>
</tr>
<tr>
<td>collectingAndThen</td>
<td>è½¬æ¢å‡½æ•°è¿”å›çš„ç±»å‹</td>
<td>åŒ…è£¹å¦ä¸€ä¸ªæ”¶é›†å™¨ï¼Œå¯¹å…¶ç»“æœè½¬æ¢å‡½æ•°</td>
</tr>
<tr>
<td>groupingBy</td>
<td>Map&lt;K,List<V>&gt;</V></td>
<td>æ ¹æ®æŸå±æ€§å€¼è¿›è¡Œåˆ†ç»„ï¼Œå±æ€§ä¸ºKï¼Œç»“æœä¸ºV</td>
</tr>
<tr>
<td>partitioningBy</td>
<td>Map&lt;Boolean,List<T>&gt;</T></td>
<td>æ ¹æ®trueæˆ–è€…falseè¿›è¡Œåˆ†åŒº</td>
</tr>
</tbody></table>
<p>ç¤ºä¾‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">List&lt;Employee&gt; employeeList = list.stream().collect(Collectors.toList());</span><br><span class="line">Set&lt;Employee&gt; employeeSet = list.stream().collect(Collectors.toSet());</span><br><span class="line">Collection&lt;Employee&gt; employees = 		   			list.stream().collect(Collectors.toCollection(ArrayList::<span class="keyword">new</span>));</span><br><span class="line"></span><br><span class="line"><span class="type">long</span> <span class="variable">count</span> <span class="operator">=</span> list.stream().collect(Collectors.counting());</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="variable">total</span> <span class="operator">=</span> list.stream().collect(summingInt(Employee::getSalary));</span><br><span class="line"></span><br><span class="line"><span class="type">double</span> <span class="variable">avg</span> <span class="operator">=</span> list.stream().collect(Collectors.summingInt(Employee::getSalary());</span><br><span class="line"><span class="type">int</span> <span class="variable">summaryStaticsiss</span> <span class="operator">=</span> list.stream().collect(Collectors.summarizingINt(Employee::getSalary());</span><br><span class="line">                                              </span><br><span class="line"><span class="type">String</span> <span class="variable">str</span> <span class="operator">=</span> list.stream().map(Employee::getName).collect(Collectors.joining());</span><br><span class="line">Optional&lt;Employee&gt; max =list.stream().collect(Collectors.maxBy(comparingInt(Employee::getSalary)));</span><br><span class="line">                                              </span><br><span class="line">Optional&lt;Employee&gt; min =list.stream().collect(Collectors.minBy(comparingInt(Employee::getSalary)));</span><br><span class="line">                                              </span><br><span class="line"><span class="type">int</span> <span class="variable">total</span> <span class="operator">=</span> list.stream().collect(Collectors.reducing(<span class="number">0</span>,Employee::getSalary,Integer::sum));</span><br><span class="line"><span class="type">int</span> <span class="variable">how</span> <span class="operator">=</span> list.stream().collect(Collectors.collectingAndThen(Collectors.toList(),List::size));</span><br><span class="line">Map&lt;Employee.STATUS,List&lt;Employee&gt; list&gt; map = </span><br><span class="line">data.stream().collect(Collectors.groupingBy(Employee::getStatus);</span><br><span class="line">Map&lt;Boolean,List&lt;Employee&gt; list&gt; map = </span><br><span class="line">data.stream().collect(Collectors.partitioningBy(Employee::getManage);</span><br></pre></td></tr></table></figure>

<h5 id="Streamçš„ç»ˆæ­¢æ“ä½œç¤ºä¾‹"><a href="#Streamçš„ç»ˆæ­¢æ“ä½œç¤ºä¾‹" class="headerlink" title="Streamçš„ç»ˆæ­¢æ“ä½œç¤ºä¾‹"></a>Streamçš„ç»ˆæ­¢æ“ä½œç¤ºä¾‹</h5><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æµ‹è¯•æµçš„ç»ˆæ­¢æ“ä½œ</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">StreamTerminalOperateTest</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æµ‹è¯•æµçš„åŒ¹é…ä¸æŸ¥æ‰¾</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test01</span><span class="params">()</span> &#123;</span><br><span class="line">        List&lt;Employee&gt; allEmployee = Employee.getAllEmployee();</span><br><span class="line">        <span class="type">boolean</span> <span class="variable">allMatch</span> <span class="operator">=</span> allEmployee.stream().allMatch(e -&gt; e.getAge() &gt; <span class="number">18</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;allMatch: &quot;</span> + allMatch);</span><br><span class="line">        <span class="type">boolean</span> <span class="variable">anyMatch</span> <span class="operator">=</span> allEmployee.stream().anyMatch(e -&gt; e.getAge() &gt; <span class="number">20</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;anyMatch: &quot;</span> + anyMatch);</span><br><span class="line">        <span class="type">boolean</span> <span class="variable">noneMatch</span> <span class="operator">=</span> allEmployee.stream().noneMatch(e -&gt; e.getName().contains(<span class="string">&quot;L&quot;</span>));</span><br><span class="line">        System.out.println(<span class="string">&quot;noneMatch: &quot;</span> + noneMatch);</span><br><span class="line">        Optional&lt;Employee&gt; findFirst = allEmployee.stream().findFirst();</span><br><span class="line">        System.out.println(<span class="string">&quot;findFirst: &quot;</span> + findFirst);</span><br><span class="line">        Optional&lt;Employee&gt; findAny = allEmployee.stream().findAny();</span><br><span class="line">        System.out.println(<span class="string">&quot;findAny: &quot;</span> + findAny);</span><br><span class="line">        Optional&lt;Employee&gt; findAny2 = allEmployee.parallelStream().findAny();</span><br><span class="line">        System.out.println(<span class="string">&quot;findAny2: &quot;</span> + findAny2);</span><br><span class="line">        <span class="type">long</span> <span class="variable">count</span> <span class="operator">=</span> allEmployee.stream().filter(e -&gt; e.getAge() &gt; <span class="number">18</span>).count();</span><br><span class="line">        System.out.println(count);</span><br><span class="line">        Stream&lt;Integer&gt; map = allEmployee.stream().map(e -&gt; e.getAge());</span><br><span class="line">        Optional&lt;Integer&gt; max = map.max(Double::compare);</span><br><span class="line">        System.out.println(<span class="string">&quot;max: &quot;</span> + max.get());</span><br><span class="line">        Stream&lt;Integer&gt; map2 = allEmployee.stream().map(e -&gt; e.getAge());</span><br><span class="line">        Optional&lt;Integer&gt; min = map2.min(Double::compare);</span><br><span class="line">        System.out.println(<span class="string">&quot;min: &quot;</span> + min.get());</span><br><span class="line">        <span class="comment">//å†…éƒ¨è¿­ä»£</span></span><br><span class="line">        allEmployee.stream().forEach(System.out::println);</span><br><span class="line">        System.out.println();</span><br><span class="line">        <span class="comment">//å¤–éƒ¨è¿­ä»£(ä½¿ç”¨Collectionæ¥å£è¿­ä»£)</span></span><br><span class="line">        allEmployee.forEach(System.out::println);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æµ‹è¯•æµçš„å½’çº¦</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test02</span><span class="params">()</span> &#123;</span><br><span class="line">        List&lt;Integer&gt; list = Arrays.asList(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>, <span class="number">10</span>);</span><br><span class="line">        <span class="type">Integer</span> <span class="variable">reduce</span> <span class="operator">=</span> list.stream().reduce(<span class="number">1</span>, Integer::sum);</span><br><span class="line">        List&lt;Employee&gt; allEmployee = Employee.getAllEmployee();</span><br><span class="line">        Stream&lt;Integer&gt; map = allEmployee.stream().map(Employee::getAge);</span><br><span class="line">        <span class="comment">// Optional&lt;Integer&gt; reduce2 = map.reduce(Integer::sum);</span></span><br><span class="line">        Optional&lt;Integer&gt; reduce2 = map.reduce((d1, d2) -&gt; d1 + d2);</span><br><span class="line">        System.out.println(reduce2.get());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æµ‹è¯•æµçš„æ”¶é›†</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test06</span><span class="params">()</span> &#123;</span><br><span class="line">        List&lt;Employee&gt; result = Employee.getAllEmployee().stream()</span><br><span class="line">                .filter(e -&gt; e.getSex() == <span class="string">&#x27;W&#x27;</span>)</span><br><span class="line">                .collect(Collectors.toList());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="Optional"><a href="#Optional" class="headerlink" title="Optional"></a>Optional</h4><h5 id="ç®€ä»‹-1"><a href="#ç®€ä»‹-1" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h5><blockquote>
<ol>
<li><p>åˆ°ç›®å‰ä¸ºæ­¢ï¼Œè‡­åæ˜­è‘—çš„ç©ºæŒ‡é’ˆå¼‚å¸¸æ˜¯å¯¼è‡´Javaåº”ç”¨ç¨‹åºå¤±è´¥çš„æœ€å¸¸è§åŸå› ã€‚ä»¥å‰ï¼Œä¸ºäº†è§£å†³ç©ºæŒ‡é’ˆå¼‚å¸¸ï¼ŒGoogleå…¬å¸è‘—åçš„Guavaé¡¹ç›®å¼•å…¥äº†Optionalç±»ï¼ŒGuavaé€šè¿‡ä½¿ç”¨æ£€æŸ¥ç©ºå€¼çš„æ–¹å¼æ¥é˜²æ­¢ä»£ç æ±¡æŸ“ï¼Œå®ƒé¼“åŠ±ç¨‹åºå‘˜å†™æ›´å¹²å‡€çš„ä»£ç ã€‚å—åˆ°Google Guavaçš„å¯å‘ï¼ŒOptionalç±»å·²ç»æˆä¸ºJava 8ç±»åº“çš„ä¸€éƒ¨åˆ†ã€‚</p>
</li>
<li><p>Optional<T> ç±»ï¼ˆjava.util.Optionalï¼‰æ˜¯ä¸€ä¸ªå®¹å™¨ç±»ï¼Œå®ƒå¯ä»¥ä¿å­˜ç±»å‹Tçš„å€¼ï¼Œä»£è¡¨è¿™ä¸ªå€¼å­˜åœ¨ã€‚æˆ–è€…ä»…ä»…ä¿å­˜ nullï¼Œè¡¨ç¤ºè¿™ä¸ªå€¼ä¸å­˜åœ¨ã€‚åŸæ¥ç”¨ null è¡¨ç¤ºä¸€ä¸ªå€¼ä¸å­˜åœ¨ï¼Œç°åœ¨ Optional å¯ä»¥æ›´å¥½çš„è¡¨è¾¾è¿™ä¸ªæ¦‚å¿µã€‚å¹¶ä¸”å¯ä»¥é¿å…ç©ºæŒ‡é’ˆå¼‚å¸¸ã€‚</T></p>
</li>
<li><p>Optional ç±»çš„ Javadoc æè¿°å¦‚ä¸‹ï¼šè¿™æ˜¯ä¸€ä¸ªå¯ä»¥ä¸º null çš„å®¹å™¨å¯¹è±¡ã€‚å¦‚æœå€¼å­˜åœ¨åˆ™ isPresent() æ–¹æ³•ä¼šè¿”å› trueï¼Œè°ƒç”¨ get() æ–¹æ³•ä¼šè¿”å›è¯¥å¯¹è±¡ã€‚</p>
</li>
</ol>
</blockquote>
<h5 id="åˆ›å»ºOptionalç±»å¯¹è±¡çš„æ–¹æ³•"><a href="#åˆ›å»ºOptionalç±»å¯¹è±¡çš„æ–¹æ³•" class="headerlink" title="åˆ›å»ºOptionalç±»å¯¹è±¡çš„æ–¹æ³•"></a>åˆ›å»ºOptionalç±»å¯¹è±¡çš„æ–¹æ³•</h5><blockquote>
<p>Optional.of(T t) : åˆ›å»ºä¸€ä¸ª Optional å®ä¾‹ï¼Œtå¿…é¡»éç©ºï¼›</p>
<p>Optional.empty() : åˆ›å»ºä¸€ä¸ªç©ºçš„ Optional å®ä¾‹</p>
<p>Optional.ofNullable(T t)ï¼štå¯ä»¥ä¸ºnull</p>
</blockquote>
<h5 id="åˆ¤æ–­Optionalå®¹å™¨ä¸­æ˜¯å¦åŒ…å«å¯¹è±¡"><a href="#åˆ¤æ–­Optionalå®¹å™¨ä¸­æ˜¯å¦åŒ…å«å¯¹è±¡" class="headerlink" title="åˆ¤æ–­Optionalå®¹å™¨ä¸­æ˜¯å¦åŒ…å«å¯¹è±¡"></a>åˆ¤æ–­Optionalå®¹å™¨ä¸­æ˜¯å¦åŒ…å«å¯¹è±¡</h5><blockquote>
<p>boolean isPresent() : åˆ¤æ–­æ˜¯å¦åŒ…å«å¯¹è±¡</p>
<p>void ifPresent(Consumer&lt;? super T&gt; consumer) ï¼šå¦‚æœæœ‰å€¼ï¼Œå°±æ‰§è¡ŒConsumeræ¥å£çš„å®ç°ä»£ç ï¼Œå¹¶ä¸”è¯¥å€¼ä¼šä½œä¸ºå‚æ•°ä¼ ç»™å®ƒã€‚</p>
</blockquote>
<h5 id="è·å–Optionalå®¹å™¨çš„å¯¹è±¡"><a href="#è·å–Optionalå®¹å™¨çš„å¯¹è±¡" class="headerlink" title="è·å–Optionalå®¹å™¨çš„å¯¹è±¡"></a>è·å–Optionalå®¹å™¨çš„å¯¹è±¡</h5><blockquote>
<p>T get() : å¦‚æœè°ƒç”¨å¯¹è±¡åŒ…å«å€¼ï¼Œè¿”å›è¯¥å€¼ï¼Œå¦åˆ™æŠ›å¼‚å¸¸</p>
<p>T orElse(T other) ï¼šå¦‚æœæœ‰å€¼åˆ™å°†å…¶è¿”å›ï¼Œå¦åˆ™è¿”å›æŒ‡å®šçš„otherå¯¹è±¡ã€‚</p>
<p>T orElseGet(Supplier&lt;? extends T&gt; other) ï¼šå¦‚æœæœ‰å€¼åˆ™å°†å…¶è¿”å›ï¼Œå¦åˆ™è¿”å›ç”±Supplieræ¥å£å®ç°æä¾›çš„å¯¹è±¡ã€‚</p>
<p>T orElseThrow(Supplier&lt;? extends X&gt; exceptionSupplier) ï¼šå¦‚æœæœ‰å€¼åˆ™å°†å…¶è¿”å›ï¼Œå¦åˆ™æŠ›å‡ºç”±Supplieræ¥å£å®ç°æä¾›çš„å¼‚å¸¸ã€‚</p>
</blockquote>
<h5 id="ä½¿ç”¨ç¤ºä¾‹"><a href="#ä½¿ç”¨ç¤ºä¾‹" class="headerlink" title="ä½¿ç”¨ç¤ºä¾‹"></a>ä½¿ç”¨ç¤ºä¾‹</h5><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.basic.versionfeature.java8.optional;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Optional;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Optionalç±»ï¼šä¸ºäº†åœ¨ç¨‹åºä¸­é¿å…å‡ºç°ç©ºæŒ‡é’ˆå¼‚å¸¸è€Œåˆ›å»ºçš„ã€‚</span></span><br><span class="line"><span class="comment"> * å¸¸ç”¨çš„æ–¹æ³•ï¼šofNullable(T t)</span></span><br><span class="line"><span class="comment"> *      orElse(T t)</span></span><br><span class="line"><span class="comment"> * å…¶ä»–æ–¹æ³•ï¼š</span></span><br><span class="line"><span class="comment"> *      Optional.of(T t) : åˆ›å»ºä¸€ä¸ª Optional å®ä¾‹ï¼Œtå¿…é¡»éç©ºï¼›</span></span><br><span class="line"><span class="comment"> *      Optional.empty() : åˆ›å»ºä¸€ä¸ªç©ºçš„ Optional å®ä¾‹</span></span><br><span class="line"><span class="comment"> *      Optional.ofNullable(T t)ï¼štå¯ä»¥ä¸ºnull</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OptionalTest</span> &#123;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test01</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">Girl</span> <span class="variable">girl</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Girl</span>();</span><br><span class="line">        girl = <span class="literal">null</span>;</span><br><span class="line">        <span class="comment">// java.lang.NullPointerException</span></span><br><span class="line">        Optional&lt;Girl&gt; optionalGirl = Optional.of(girl);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test02</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">Girl</span> <span class="variable">girl</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Girl</span>();</span><br><span class="line">        girl = <span class="literal">null</span>;</span><br><span class="line">        Optional&lt;Girl&gt; optionalGirl = Optional.ofNullable(girl);</span><br><span class="line">        <span class="type">Girl</span> <span class="variable">tingting</span> <span class="operator">=</span> optionalGirl.orElse(<span class="keyword">new</span> <span class="title class_">Girl</span>(<span class="string">&quot;liutingting&quot;</span>));</span><br><span class="line">        System.out.println(<span class="string">&quot;girl: &quot;</span> + tingting);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test03</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">Boy</span> <span class="variable">boy</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Boy</span>();</span><br><span class="line">        boy = <span class="literal">null</span>;</span><br><span class="line">        <span class="type">String</span> <span class="variable">girlName</span> <span class="operator">=</span> getGirlName3(boy);</span><br><span class="line">        System.out.println(girlName);</span><br><span class="line">    &#125;</span><br><span class="line">	</span><br><span class="line">    <span class="keyword">private</span> String <span class="title function_">getGirlName</span><span class="params">(Boy boy)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> boy.getGirl().getName();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ä¼˜åŒ–ä»¥åçš„getGirlName()</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getGirlName2</span><span class="params">(Boy boy)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (boy != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="type">Girl</span> <span class="variable">girl</span> <span class="operator">=</span> boy.getGirl();</span><br><span class="line">            <span class="keyword">if</span> (girl != <span class="literal">null</span>) &#123;</span><br><span class="line">                <span class="keyword">return</span> girl.getName();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ä½¿ç”¨optionalä¼˜åŒ–</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getGirlName3</span><span class="params">(Boy boy)</span> &#123;</span><br><span class="line">        Optional&lt;Boy&gt; boyOptional = Optional.ofNullable(boy);</span><br><span class="line">        <span class="type">Boy</span> <span class="variable">liufei</span> <span class="operator">=</span> boyOptional.orElse(<span class="keyword">new</span> <span class="title class_">Boy</span>());</span><br><span class="line">        <span class="type">Girl</span> <span class="variable">girl</span> <span class="operator">=</span> liufei.getGirl();</span><br><span class="line">        Optional&lt;Girl&gt; girlOptional = Optional.ofNullable(girl);</span><br><span class="line">        <span class="type">Girl</span> <span class="variable">liutingting</span> <span class="operator">=</span> girlOptional.orElse(<span class="keyword">new</span> <span class="title class_">Girl</span>(<span class="string">&quot;liutingting&quot;</span>));</span><br><span class="line">        <span class="keyword">return</span> liutingting.getName();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Girl</span> &#123;</span><br><span class="line">    String name;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Girl</span><span class="params">()</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Girl</span><span class="params">(String name)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getName</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Boy</span> &#123;</span><br><span class="line">    Girl girl;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Boy</span><span class="params">()</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Boy</span><span class="params">(Girl girl)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.girl = girl;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Girl <span class="title function_">getGirl</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> girl;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>







<table>
<thead>
<tr>
<th></th>
<th></th>
<th></th>
<th></th>
</tr>
</thead>
<tbody><tr>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody></table>
]]></content>
  </entry>
  <entry>
    <title>JavaScript</title>
    <url>/2023/02/28/JavaScript/</url>
    <content><![CDATA[<h1 id><a href="#" class="headerlink" title></a></h1><h1 id="JavaScript"><a href="#JavaScript" class="headerlink" title="JavaScript"></a>JavaScript</h1><h1 id="JavaScriptç®€ä»‹ï¼ˆç•¥ï¼‰"><a href="#JavaScriptç®€ä»‹ï¼ˆç•¥ï¼‰" class="headerlink" title="JavaScriptç®€ä»‹ï¼ˆç•¥ï¼‰"></a>JavaScriptç®€ä»‹ï¼ˆç•¥ï¼‰</h1><h1 id="JavaScript-æ•°æ®ç±»å‹"><a href="#JavaScript-æ•°æ®ç±»å‹" class="headerlink" title="JavaScript æ•°æ®ç±»å‹"></a>JavaScript æ•°æ®ç±»å‹</h1><p>â€‹		ä¸€èˆ¬è®¤ä¸ºå…­ç§æ•°æ®ç±»å‹ï¼š5ç§åŸºæœ¬æ•°æ®ç±»å‹å’ŒObjectç±»å‹ï¼Œå…¶ä¸­Objectç±»å‹åŒ…æ‹¬å¯¹è±¡ã€æ•°ç»„ã€å‡½æ•°ç­‰ã€‚</p>
<p>åŸºæœ¬æ•°æ®ç±»å‹ï¼šStringã€Numberã€Nullã€Booleanã€Undefined</p>
<p>å¼•ç”¨ç±»å‹ï¼šObjectï¼ˆArrayã€Objectã€Functionï¼‰</p>
<p>å¯ä»¥ä½¿ç”¨typeofæ“ä½œç¬¦æ£€æŸ¥å˜é‡çš„æ•°æ®ç±»å‹ã€‚</p>
]]></content>
  </entry>
  <entry>
    <title>Kafka</title>
    <url>/2023/02/28/Kafka/</url>
    <content><![CDATA[<h1 id><a href="#" class="headerlink" title></a></h1><h1 id="Kafka"><a href="#Kafka" class="headerlink" title="Kafka"></a>Kafka</h1><h1 id="ç¬¬ä¸€ç« -Kafka-å…¥é—¨ä½¿ç”¨"><a href="#ç¬¬ä¸€ç« -Kafka-å…¥é—¨ä½¿ç”¨" class="headerlink" title="ç¬¬ä¸€ç«  Kafka å…¥é—¨ä½¿ç”¨"></a>ç¬¬ä¸€ç«  Kafka å…¥é—¨ä½¿ç”¨</h1><p>ç¬¬ä¸€ç« </p>
<p>æˆ‘å…·æœ‰å¼ºçƒˆçš„å±€é™æ€§ï¼Œå¤ªè¿‡äºå±€é™è‡ªæˆ‘ã€‚</p>
<p>äº•åº•ä¹‹è›™</p>
<p>åæ€ï¼šä¸€ç›´ä»¥æ¥ï¼Œè§‰å¾—è‡ªå·±å…·æœ‰å¼ºçƒˆçš„è®¤çŸ¥çš„å±€é™æ€§ï¼Œæ— è®ºä½ åšä»€ä¹ˆä¸åšä»€ä¹ˆï¼Œéƒ½ä¸è¦ä¼¤å®³æœ‹å‹ï¼Œè°‹ç”Ÿè·¯ä¸Šçš„æœ‹å‹æœ€å¤šç§°ä¸ºåˆä½œä¼™ä¼´ã€‚</p>
]]></content>
  </entry>
  <entry>
    <title>Kubernetes</title>
    <url>/2023/02/27/Kubernetes/</url>
    <content><![CDATA[]]></content>
  </entry>
  <entry>
    <title>Linux</title>
    <url>/2023/02/28/Linux/</url>
    <content><![CDATA[<h1 id="Linux-åŸºç¡€"><a href="#Linux-åŸºç¡€" class="headerlink" title="Linux åŸºç¡€"></a>Linux åŸºç¡€</h1><p>ä½¿ç”¨å‘½ä»¤è®¾ç½®ä¸»æœºå</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">hostnamectl set-hostname xxx</span><br><span class="line">cat /etc/hostname</span><br></pre></td></tr></table></figure>

<h1 id="Linux-å¸¸ç”¨å‘½ä»¤"><a href="#Linux-å¸¸ç”¨å‘½ä»¤" class="headerlink" title="Linux å¸¸ç”¨å‘½ä»¤"></a>Linux å¸¸ç”¨å‘½ä»¤</h1><h2 id="å¸®åŠ©ç±»"><a href="#å¸®åŠ©ç±»" class="headerlink" title="å¸®åŠ©ç±»"></a>å¸®åŠ©ç±»</h2><h3 id="æ¸…å±"><a href="#æ¸…å±" class="headerlink" title="æ¸…å±"></a>æ¸…å±</h3><p>â€‹		clear	CTRL+L		resetï¼ˆå½»åº•æ¸…å±ï¼‰</p>
<p>â€‹		<strong>æ¸…ç©ºæ–‡ä»¶å†…å®¹ï¼šecho â€œâ€ &gt; sources.list</strong></p>
<h3 id="man"><a href="#man" class="headerlink" title="man"></a>man</h3><p>â€‹		å¸®åŠ©å‘½ä»¤ï¼šman [å‘½ä»¤]</p>
<h3 id="help"><a href="#help" class="headerlink" title="help"></a>help</h3><p>â€‹		å¸®åŠ©å‘½ä»¤ï¼šhelp [å‘½ä»¤]</p>
<h2 id="æ–‡ä»¶ç›®å½•ç±»"><a href="#æ–‡ä»¶ç›®å½•ç±»" class="headerlink" title="æ–‡ä»¶ç›®å½•ç±»"></a>æ–‡ä»¶ç›®å½•ç±»</h2><h3 id="pwdï¼šæ˜¾ç¤ºå½“å‰ç›®å½•"><a href="#pwdï¼šæ˜¾ç¤ºå½“å‰ç›®å½•" class="headerlink" title="pwdï¼šæ˜¾ç¤ºå½“å‰ç›®å½•"></a>pwdï¼šæ˜¾ç¤ºå½“å‰ç›®å½•</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@root ~]# pwd</span><br><span class="line">/root</span><br></pre></td></tr></table></figure>

<h3 id="lsï¼šåˆ—å‡ºç›®å½•å†…å®¹"><a href="#lsï¼šåˆ—å‡ºç›®å½•å†…å®¹" class="headerlink" title="lsï¼šåˆ—å‡ºç›®å½•å†…å®¹"></a>lsï¼šåˆ—å‡ºç›®å½•å†…å®¹</h3><p>åŸºæœ¬è¯­æ³•ï¼šls 	[é€‰é¡¹] 	[ç›®å½•æˆ–æ˜¯æ–‡ä»¶]</p>
<p>å¸¸ç”¨é€‰é¡¹</p>
<p>-a ï¼šæ˜¾ç¤ºå½“å‰ç›®å½•æ‰€æœ‰çš„æ–‡ä»¶å’Œç›®å½•ï¼ŒåŒ…æ‹¬éšè—çš„æ–‡ä»¶</p>
<p>-l ï¼šä»¥åˆ—è¡¨çš„æ–¹å¼æ˜¾ç¤ºä¿¡æ¯ã€‚ï¼ˆç­‰ä»·äº ll ï¼‰</p>
<p><strong>-hï¼šhumanäººæ€§åŒ–ï¼Œå¯ä»¥æŸ¥çœ‹æ–‡ä»¶å¤§å°ã€‚</strong></p>
<p><strong>-Rï¼šæ˜¾ç¤ºæ‰€æœ‰æ–‡ä»¶ã€‚</strong></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@root ~]# ls -lah</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æ–‡ä»¶ç±»å‹ä¸æƒé™ é“¾æ¥æ•° æ–‡ä»¶å±ä¸» æ–‡ä»¶å±ç»„ æ–‡ä»¶å¤§å°ç”¨byteæ¥è¡¨ç¤º å»ºç«‹æˆ–æœ€è¿‘ä¿®æ”¹çš„æ—¶é—´ åå­—</span></span><br><span class="line">dr-xr-x---. 16 root root 4.0K 4æœˆ  24 22:17 .</span><br><span class="line">dr-xr-xr-x. 17 root root  224 4æœˆ   9 18:25 ..</span><br><span class="line">-rw-------.  1 root root 1.8K 4æœˆ   9 18:26 anaconda-ks.cfg</span><br><span class="line">drwxr-xr-x.  3 root root   53 4æœˆ  24 17:57 archive</span><br><span class="line">-rw-------.  1 root root  11K 4æœˆ  24 22:17 .bash_history</span><br><span class="line">-rw-r--r--.  1 root root   18 12æœˆ 29 2013 .bash_logout</span><br><span class="line">-rw-r--r--.  1 root root  176 12æœˆ 29 2013 .bash_profile</span><br><span class="line">-rw-r--r--.  1 root root  176 12æœˆ 29 2013 .bashrc</span><br><span class="line">drwx------. 15 root root 4.0K 4æœˆ   9 18:51 .cache</span><br><span class="line">drwxr-xr-x. 14 root root  261 4æœˆ   9 18:44 .config</span><br></pre></td></tr></table></figure>

<h3 id="cdï¼šåˆ‡æ¢ç›®å½•"><a href="#cdï¼šåˆ‡æ¢ç›®å½•" class="headerlink" title="cdï¼šåˆ‡æ¢ç›®å½•"></a>cdï¼šåˆ‡æ¢ç›®å½•</h3><p>cdï¼šChange Directory åˆ‡æ¢è·¯å¾„</p>
<p>cd ~ æˆ– cd å›åˆ°è‡ªå·±å®¶ç›®å½•</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@root shell]# pwd</span><br><span class="line">/opt/shell</span><br><span class="line">[root@root shell]# cd</span><br><span class="line">[root@root ~]# cd /opt/shell</span><br><span class="line">[root@root shell]# cd ~</span><br></pre></td></tr></table></figure>

<h3 id="mkdirï¼šåˆ›å»ºç›®å½•"><a href="#mkdirï¼šåˆ›å»ºç›®å½•" class="headerlink" title="mkdirï¼šåˆ›å»ºç›®å½•"></a>mkdirï¼šåˆ›å»ºç›®å½•</h3><p>mkdir [é€‰é¡¹] è¦åˆ›å»ºçš„ç›®å½•</p>
<p>å‚æ•°ï¼š-p  åˆ›å»ºå¤šçº§ç›®å½•</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@root opt]# mkdir ./linux/dir</span><br><span class="line">mkdir: æ— æ³•åˆ›å»ºç›®å½•&quot;./linux/dir&quot;: æ²¡æœ‰é‚£ä¸ªæ–‡ä»¶æˆ–ç›®å½•</span><br><span class="line">[root@root opt]# mkdir ./linux/dir -p</span><br><span class="line">[root@root opt]# ls</span><br><span class="line">linux  rh</span><br></pre></td></tr></table></figure>

<h3 id="rmdirï¼šåˆ é™¤ç©ºç›®å½•"><a href="#rmdirï¼šåˆ é™¤ç©ºç›®å½•" class="headerlink" title="rmdirï¼šåˆ é™¤ç©ºç›®å½•"></a>rmdirï¼šåˆ é™¤ç©ºç›®å½•</h3><p>æ³¨æ„ï¼š<strong>å¦‚æœéœ€è¦åˆ é™¤éç©ºç›®å½•ï¼Œéœ€è¦ä½¿ç”¨ rm -rf è¦åˆ é™¤çš„ç›®å½•ã€‚</strong></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@root opt]# rmdir ./linux</span><br><span class="line">rmdir: åˆ é™¤ &quot;./linux&quot; å¤±è´¥: ç›®å½•éç©º</span><br><span class="line">[root@root opt]# rm -rf ./linux</span><br><span class="line">[root@root opt]# ls</span><br><span class="line">rh</span><br></pre></td></tr></table></figure>

<h3 id="touchï¼šåˆ›å»ºä¸€ä¸ªæˆ–å¤šä¸ªç©ºæ–‡ä»¶"><a href="#touchï¼šåˆ›å»ºä¸€ä¸ªæˆ–å¤šä¸ªç©ºæ–‡ä»¶" class="headerlink" title="touchï¼šåˆ›å»ºä¸€ä¸ªæˆ–å¤šä¸ªç©ºæ–‡ä»¶"></a>touchï¼šåˆ›å»ºä¸€ä¸ªæˆ–å¤šä¸ªç©ºæ–‡ä»¶</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@root dir]# touch test test2 &amp;&amp; ls</span><br><span class="line">test test2</span><br></pre></td></tr></table></figure>

<h3 id="cp-ï¼šæ‹·è´æ–‡ä»¶æˆ–æ–‡ä»¶å¤¹"><a href="#cp-ï¼šæ‹·è´æ–‡ä»¶æˆ–æ–‡ä»¶å¤¹" class="headerlink" title="cp ï¼šæ‹·è´æ–‡ä»¶æˆ–æ–‡ä»¶å¤¹"></a>cp ï¼šæ‹·è´æ–‡ä»¶æˆ–æ–‡ä»¶å¤¹</h3><p>åŸºæœ¬è¯­æ³•ï¼š cp [é€‰é¡¹] source destation</p>
<p>å¸¸ç”¨é€‰é¡¹ï¼š</p>
<p>â€‹		-r ï¼šé€’å½’å¤åˆ¶æ•´ä¸ªæ–‡ä»¶å¤¹ï¼Œ<strong>å•ç‹¬æ‹·è´æ–‡ä»¶æˆ–å‹ç¼©åŒ…ä¸éœ€è¦åŠ  -r ï¼Œå¯¹äºæ–‡ä»¶å¤¹éœ€è¦æ·»åŠ  -r</strong></p>
<p>ç¤ºä¾‹ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">1. å°†ä¸€ä¸ªæ–‡ä»¶å¤¹ä¸‹å¤åˆ¶åˆ°å¦ä¸€ä¸ªæ–‡ä»¶å¤¹ä¸‹</span></span><br><span class="line">cp -r srcDir/ destDir/</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">2. å°†ä¸€ä¸ªæ–‡ä»¶å¤¹ä¸‹çš„æ‰€æœ‰å†…å®¹å¤åˆ¶åˆ°å¦ä¸€ä¸ªæ–‡ä»¶å¤¹ä¸‹</span></span><br><span class="line">cp -r srcDir/* destDir/</span><br><span class="line">cp -r srcDir/. destDir/</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æ³¨æ„æ‹·è´å¤šçº§ç›®å½•æ—¶éœ€è¦åŠ é€’å½’å‚æ•° -rï¼Œå¦åˆ™ä¸ç”Ÿæ•ˆï¼Œæç¤ºï¼š<span class="built_in">cp</span>: ç•¥è¿‡ç›®å½•<span class="string">&quot;apache-tomcat-8.5.70&quot;</span></span></span><br></pre></td></tr></table></figure>

<p>æ³¨æ„ï¼šå¦‚æœç›®çš„ç›®å½•ä¸‹æœ‰ç›¸åŒçš„æ–‡ä»¶åˆ™ä¼šæç¤ºæ˜¯å¦è¿›è¡Œè¦†ç›–ï¼Œ<strong>å¼ºåˆ¶è¦†ç›–ä¸æç¤ºçš„æ–¹æ³•ï¼š\cpï¼ˆåœ¨å‰é¢åŠ \ï¼‰</strong></p>
<h3 id="rm-ï¼šç§»é™¤æ–‡ä»¶æˆ–ç›®å½•"><a href="#rm-ï¼šç§»é™¤æ–‡ä»¶æˆ–ç›®å½•" class="headerlink" title="rm ï¼šç§»é™¤æ–‡ä»¶æˆ–ç›®å½•"></a>rm ï¼šç§»é™¤æ–‡ä»¶æˆ–ç›®å½•</h3><p>åŸºæœ¬è¯­æ³•ï¼šrm [é€‰é¡¹] è¦åˆ é™¤çš„æ–‡ä»¶æˆ–ç›®å½•ã€‚</p>
<p>å¸¸ç”¨é€‰é¡¹</p>
<p><strong>-r ï¼šé€’å½’åˆ é™¤æ•´ä¸ªæ–‡ä»¶å¤¹ã€‚</strong></p>
<p><strong>-f ï¼šå¼ºåˆ¶åˆ é™¤ä¸æç¤ºã€‚</strong></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@root dir]# rm -rf test</span><br></pre></td></tr></table></figure>

<h3 id="mv-ï¼šç§»åŠ¨æ–‡ä»¶ä¸ç›®å½•æˆ–é‡å‘½å"><a href="#mv-ï¼šç§»åŠ¨æ–‡ä»¶ä¸ç›®å½•æˆ–é‡å‘½å" class="headerlink" title="mv ï¼šç§»åŠ¨æ–‡ä»¶ä¸ç›®å½•æˆ–é‡å‘½å"></a><strong>mv ï¼šç§»åŠ¨æ–‡ä»¶ä¸ç›®å½•æˆ–é‡å‘½å</strong></h3><p>åŸºæœ¬è¯­æ³•</p>
<p>é‡å‘½åï¼šmv oldNameFile newNameFile</p>
<p>ç§»åŠ¨æ–‡ä»¶ï¼šmv &#x2F;temp&#x2F;movefile &#x2F;targetFolder</p>
<p>ç¤ºä¾‹ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@root dir]# touch config.txt</span><br><span class="line">[root@root dir]# mv config.txt config.txt.bak</span><br><span class="line">[root@root dir]# ls</span><br><span class="line">config.txt.bak</span><br><span class="line">[root@root dir]# mv config.txt.bak /opt/linux/ &amp;&amp; ls /opt/linux/</span><br><span class="line">config.txt.bak  dir</span><br></pre></td></tr></table></figure>

<h3 id="cat-ï¼šæŸ¥çœ‹æ–‡ä»¶å†…å®¹"><a href="#cat-ï¼šæŸ¥çœ‹æ–‡ä»¶å†…å®¹" class="headerlink" title="cat ï¼šæŸ¥çœ‹æ–‡ä»¶å†…å®¹"></a>cat ï¼šæŸ¥çœ‹æ–‡ä»¶å†…å®¹</h3><p>åŸºæœ¬è¯­æ³•ï¼š cat [é€‰é¡¹] è¦æŸ¥çœ‹çš„æ–‡ä»¶ã€‚</p>
<p>æ³¨æ„ï¼šä¼šæ˜¾ç¤ºå…¨éƒ¨æ–‡ä»¶å†…å®¹ï¼Œä¸€èˆ¬ä¼šå¸¦ä¸Šç®¡é“å‘½ä»¤ | moreã€‚ç®¡é“ç¬¦ <strong>|</strong> ä½œä¸ºè¿æ¥ä½¿ç”¨ã€‚</p>
<p>å¸¸ç”¨é€‰é¡¹</p>
<p><strong>-n ï¼šæ˜¾ç¤ºè¡Œå·</strong></p>
<p>ç¤ºä¾‹ï¼š &#x2F;etc&#x2F;profile æ–‡ä»¶å†…å®¹ï¼Œå¹¶æ˜¾ç¤ºè¡Œå·ã€‚</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@root ~]# cat -n /etc/profile</span><br><span class="line">     1  # /etc/profile</span><br><span class="line">     2</span><br><span class="line">     3  # System wide environment and startup programs, for login setup</span><br><span class="line">     4  # Functions and aliases go in /etc/bashrc</span><br><span class="line">     5</span><br><span class="line">     6  # It&#x27;s NOT a good idea to change this file unless you know what you</span><br><span class="line">     7  # are doing. It&#x27;s much better to create a custom.sh shell script in</span><br><span class="line">     8  # /etc/profile.d/ to make custom changes to your environment, as this</span><br><span class="line">     9  # will prevent the need for merging in future updates.</span><br><span class="line">    10</span><br><span class="line">    11  pathmunge () &#123;</span><br><span class="line">    12      case &quot;:$&#123;PATH&#125;:&quot; in</span><br><span class="line">    13          *:&quot;$1&quot;:*)</span><br><span class="line">    14              ;;</span><br><span class="line">    15          *)</span><br><span class="line">    16              if [ &quot;$2&quot; = &quot;after&quot; ] ; then</span><br><span class="line">    17                  PATH=$PATH:$1</span><br><span class="line">    18              else</span><br><span class="line">    19                  PATH=$1:$PATH</span><br><span class="line">    20              fi</span><br><span class="line">    21      esac</span><br><span class="line">    22  &#125;</span><br><span class="line">    23</span><br></pre></td></tr></table></figure>

<h3 id="moreï¼šä¸€æ¬¡æ€§åŠ è½½"><a href="#moreï¼šä¸€æ¬¡æ€§åŠ è½½" class="headerlink" title="moreï¼šä¸€æ¬¡æ€§åŠ è½½"></a>moreï¼šä¸€æ¬¡æ€§åŠ è½½</h3><p>â€‹		moreæŒ‡ä»¤æ˜¯ä¸€ä¸ªåŸºäº VI ç¼–è¾‘å™¨çš„æ–‡æœ¬è¿‡æ»¤å™¨ï¼Œå®ƒä»¥å…¨å±å¹•çš„æ–¹å¼æŒ‰é¡µæ˜¾ç¤ºæ–‡æœ¬æ–‡ä»¶çš„å†…å®¹ï¼ˆä¸€æ¬¡æ€§åŠ è½½å…¨éƒ¨æ–‡ä»¶å†…å®¹ï¼‰ã€‚moreæŒ‡ä»¤ä¸­å†…ç½®äº†è‹¥å¹²å¿«æ·é”®ï¼Œè¯¦è§æ“ä½œè¯´æ˜ã€‚</p>
<p>åŸºæœ¬è¯­æ³•ï¼šmore è¦æŸ¥çœ‹çš„æ–‡ä»¶</p>
<p>æ“ä½œè¯´æ˜ï¼š</p>
<table>
<thead>
<tr>
<th><strong>æ“ä½œ</strong></th>
<th><strong>åŠŸèƒ½è¯´æ˜</strong></th>
</tr>
</thead>
<tbody><tr>
<td><strong>ç©ºç™½é”®ï¼ˆspaceï¼‰</strong></td>
<td>ä»£è¡¨å‘ä¸‹ç¿»ä¸€é¡µ</td>
</tr>
<tr>
<td><strong>Enter</strong></td>
<td>ä»£è¡¨å‘ä¸‹ç¿»ä¸€è¡Œ</td>
</tr>
<tr>
<td><strong>q</strong></td>
<td>ç«‹å³ç¦»å¼€ï¼Œä¸å†æ˜¾ç¤ºæ–‡ä»¶å†…å®¹</td>
</tr>
<tr>
<td><strong>Ctrl+F</strong></td>
<td>å‘ä¸‹æ»šåŠ¨ä¸€å±</td>
</tr>
<tr>
<td><strong>Ctrl+B</strong></td>
<td>è¿”å›ä¸Šä¸€å±</td>
</tr>
<tr>
<td><strong>&#x3D;</strong></td>
<td>è¾“å‡ºå½“å‰è¡Œå·</td>
</tr>
<tr>
<td><strong>:f</strong></td>
<td>è¾“å‡ºæ–‡ä»¶åå’Œå½“å‰è¡Œå·</td>
</tr>
</tbody></table>
<h3 id="lessï¼šæŒ‰éœ€åŠ è½½ï¼Œæ—¥å¿—æ¨è"><a href="#lessï¼šæŒ‰éœ€åŠ è½½ï¼Œæ—¥å¿—æ¨è" class="headerlink" title="lessï¼šæŒ‰éœ€åŠ è½½ï¼Œæ—¥å¿—æ¨è"></a><strong>lessï¼šæŒ‰éœ€åŠ è½½ï¼Œæ—¥å¿—æ¨è</strong></h3><p>â€‹		less æŒ‡ä»¤ç”¨æ¥åˆ†å±æŸ¥çœ‹æ–‡ä»¶å†…å®¹ï¼Œå®ƒçš„åŠŸèƒ½ä¸ more æŒ‡ä»¤ç±»ä¼¼ï¼Œä½†æ˜¯<strong>æ¯” more æŒ‡ä»¤æ›´åŠ å¼ºå¤§ï¼Œæ”¯æŒå„ç§æ˜¾ç¤ºç»ˆç«¯ã€‚</strong>lessæŒ‡ä»¤åœ¨æ˜¾ç¤ºæ–‡ä»¶å†…å®¹æ—¶ï¼Œå¹¶ä¸æ˜¯ä¸€æ¬¡å°†æ•´ä¸ªæ–‡ä»¶åŠ è½½ä¹‹åæ‰æ˜¾ç¤ºï¼Œè€Œæ˜¯æ ¹æ®æ˜¾ç¤ºéœ€è¦åŠ è½½å†…å®¹ï¼Œå¯¹äºæ˜¾ç¤ºå¤§å‹æ–‡ä»¶å…·æœ‰è¾ƒé«˜çš„æ•ˆç‡ã€‚<strong>ï¼ˆæ—¥å¿—æ¨èä½¿ç”¨lessï¼‰</strong></p>
<p>æ“ä½œè¯´æ˜ï¼š</p>
<table>
<thead>
<tr>
<th><strong>æ“ä½œ</strong></th>
<th><strong>åŠŸèƒ½è¯´æ˜</strong></th>
</tr>
</thead>
<tbody><tr>
<td><strong>ç©ºæ ¼</strong></td>
<td>å‘ä¸‹ç¿»åŠ¨ä¸€é¡µ</td>
</tr>
<tr>
<td><strong>ã€pagedownã€‘</strong></td>
<td>å‘ä¸‹ç¿»åŠ¨ä¸€é¡µ</td>
</tr>
<tr>
<td><strong>ã€pageupã€‘</strong></td>
<td>å‘ä¸Šç¿»åŠ¨ä¸€é¡µ</td>
</tr>
<tr>
<td><strong>&#x2F;å­—ç¬¦ä¸²</strong></td>
<td>å‘ä¸‹æœå¯»ã€å­—ç¬¦ä¸²ã€‘ï¼Œnï¼šå‘ä¸‹æŸ¥æ‰¾ï¼ŒNï¼šå‘ä¸ŠæŸ¥æ‰¾</td>
</tr>
<tr>
<td><strong>?å­—ç¬¦ä¸²</strong></td>
<td>å‘ä¸Šæœå¯»ã€å­—ç¬¦ä¸²ã€‘ï¼Œnï¼šå‘ä¸ŠæŸ¥æ‰¾ï¼ŒNï¼šå‘ä¸‹æŸ¥æ‰¾</td>
</tr>
<tr>
<td><strong>q</strong></td>
<td>ç¦»å¼€less</td>
</tr>
</tbody></table>
<h3 id="gt-è¾“å‡ºé‡å®šå‘å’Œ-gt-gt-è¿½åŠ "><a href="#gt-è¾“å‡ºé‡å®šå‘å’Œ-gt-gt-è¿½åŠ " class="headerlink" title="&gt; è¾“å‡ºé‡å®šå‘å’Œ &gt;&gt; è¿½åŠ "></a>&gt; è¾“å‡ºé‡å®šå‘å’Œ &gt;&gt; è¿½åŠ </h3><p>ç¤ºä¾‹ï¼š</p>
<p>â€‹		ls -l &gt; æ–‡ä»¶ ï¼ˆåŠŸèƒ½æè¿°ï¼šåˆ—è¡¨çš„å†…å®¹å†™å…¥æ–‡ä»¶appendTest.txtä¸­ï¼ˆè¦†ç›–å†™ï¼‰ï¼‰</p>
<p>â€‹		cat æ–‡ä»¶1 &gt; æ–‡ä»¶2 ï¼ˆåŠŸèƒ½æè¿°ï¼šå°†æ–‡ä»¶1çš„å†…å®¹è¦†ç›–åˆ°æ–‡ä»¶2ï¼‰</p>
<p>â€‹		echo â€œå†…å®¹â€&gt;&gt; æ–‡ä»¶</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">echo &quot;Hello Wolrd&quot; &gt;&gt; a.txt</span><br><span class="line">cat /etc/profile &gt;&gt; global.cof</span><br><span class="line">echo &quot;&quot; &gt; a.txt</span><br></pre></td></tr></table></figure>

<h3 id="headï¼šé»˜è®¤æ˜¾ç¤ºå‰-10-è¡Œ"><a href="#headï¼šé»˜è®¤æ˜¾ç¤ºå‰-10-è¡Œ" class="headerlink" title="headï¼šé»˜è®¤æ˜¾ç¤ºå‰ 10 è¡Œ"></a>headï¼šé»˜è®¤æ˜¾ç¤ºå‰ 10 è¡Œ</h3><p>â€‹		head ç”¨äºæ˜¾ç¤ºæ–‡ä»¶çš„å¼€å¤´éƒ¨åˆ†å†…å®¹ï¼Œé»˜è®¤æƒ…å†µä¸‹headæŒ‡ä»¤æ˜¾ç¤ºæ–‡ä»¶çš„å‰10è¡Œå†…å®¹ã€‚</p>
<p>åŸºæœ¬è¯­æ³•ï¼š</p>
<p>â€‹		head æ–‡ä»¶ (åŠŸèƒ½æè¿°ï¼šé»˜è®¤æŸ¥çœ‹æ–‡ä»¶å¤´10è¡Œå†…å®¹) </p>
<p>â€‹		head -n 5 æ–‡ä»¶ (åŠŸèƒ½æè¿°ï¼šæŸ¥çœ‹æ–‡ä»¶å¤´5è¡Œå†…å®¹ï¼Œ5å¯ä»¥æ˜¯ä»»æ„è¡Œæ•°)</p>
<h3 id="tailï¼šé»˜è®¤æ˜¾ç¤ºå10è¡Œ"><a href="#tailï¼šé»˜è®¤æ˜¾ç¤ºå10è¡Œ" class="headerlink" title="tailï¼šé»˜è®¤æ˜¾ç¤ºå10è¡Œ"></a>tailï¼šé»˜è®¤æ˜¾ç¤ºå10è¡Œ</h3><p>â€‹		tailç”¨äºè¾“å‡ºæ–‡ä»¶ä¸­å°¾éƒ¨çš„å†…å®¹ï¼Œé»˜è®¤æƒ…å†µä¸‹tailæŒ‡ä»¤æ˜¾ç¤ºæ–‡ä»¶çš„å10è¡Œå†…å®¹ã€‚ </p>
<p>åŸºæœ¬è¯­æ³•</p>
<ol>
<li>tail æ–‡ä»¶ ï¼ˆåŠŸèƒ½æè¿°ï¼šæŸ¥çœ‹æ–‡ä»¶å10è¡Œå†…å®¹ï¼‰</li>
<li>tail -n 5 æ–‡ä»¶ ï¼ˆåŠŸèƒ½æè¿°ï¼šæŸ¥çœ‹æ–‡ä»¶å5è¡Œå†…å®¹ï¼Œ5å¯ä»¥æ˜¯ä»»æ„è¡Œæ•°ï¼‰</li>
<li><strong>tail -f æ–‡ä»¶ ï¼ˆåŠŸèƒ½æè¿°ï¼šå®æ—¶è¿½è¸ªè¯¥æ–‡æ¡£çš„æ‰€æœ‰æ›´æ–°ï¼‰CTRL + Cé€€å‡º</strong></li>
</ol>
<h3 id="wcï¼šç»Ÿè®¡å­—æ•°"><a href="#wcï¼šç»Ÿè®¡å­—æ•°" class="headerlink" title="wcï¼šç»Ÿè®¡å­—æ•°"></a>wcï¼šç»Ÿè®¡å­—æ•°</h3><p>â€‹		åˆ©ç”¨ wc æŒ‡ä»¤æˆ‘ä»¬å¯ä»¥è®¡ç®—æ–‡ä»¶çš„ Byte æ•°ã€å­—æ•°ã€æˆ–æ˜¯è¡Œæ•°ï¼Œè‹¥ä¸æŒ‡å®šæ–‡ä»¶åç§°ã€æˆ–æ˜¯æ‰€ç»™äºˆçš„æ–‡ä»¶åä¸ºâ€-â€œï¼Œåˆ™wcæŒ‡ä»¤ä¼šä»æ ‡å‡†è¾“å…¥è®¾å¤‡è¯»å–æ•°æ®ã€‚</p>
<p>è¯­æ³•ï¼š<strong>wc [-clw][â€“help][â€“version][æ–‡ä»¶â€¦]</strong></p>
<p><strong>å¯ä»¥ç»Ÿè®¡å¤šä¸ªæ–‡ä»¶ã€‚</strong></p>
<p><strong>å‚æ•°è¯´æ˜ï¼š</strong></p>
<ol>
<li><strong>-cæˆ–â€“bytesæˆ–â€“chars åªæ˜¾ç¤ºBytesæ•°ã€‚</strong></li>
<li><strong>-læˆ–â€“lines æ˜¾ç¤ºè¡Œæ•°ã€‚</strong></li>
<li><strong>-wæˆ–â€“words åªæ˜¾ç¤ºå­—æ•°ã€‚</strong></li>
<li>â€“help åœ¨çº¿å¸®åŠ©ã€‚</li>
<li>â€“version æ˜¾ç¤ºç‰ˆæœ¬ä¿¡æ¯ã€‚</li>
</ol>
<p><strong>ç¤ºä¾‹ï¼šç»Ÿè®¡æ–‡ä»¶å­—æ•°</strong></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@root testCommand]# vim testWC.txt</span><br><span class="line">[root@root testCommand]# wc testWC.txt</span><br><span class="line">  5  12 110 testWC.txt</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">5 è¡Œ 12 å­—æ•° 110 å­—èŠ‚æ•°</span></span><br></pre></td></tr></table></figure>

<h3 id="ln-ï¼šè½¯é“¾æ¥"><a href="#ln-ï¼šè½¯é“¾æ¥" class="headerlink" title="ln ï¼šè½¯é“¾æ¥"></a>ln ï¼šè½¯é“¾æ¥</h3><p>åŸºæœ¬è¯­æ³•</p>
<p>â€‹		ln -s [åŸæ–‡ä»¶æˆ–ç›®å½•] [è½¯é“¾æ¥å] ï¼ˆåŠŸèƒ½æè¿°ï¼šç»™åŸæ–‡ä»¶åˆ›å»ºä¸€ä¸ªè½¯é“¾æ¥ï¼‰</p>
<p>ç¤ºä¾‹ï¼š åœ¨ &#x2F;home ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªè½¯è¿æ¥ linkToRootï¼Œè¿æ¥åˆ° &#x2F;root ç›®å½•ï¼Œåˆ é™¤è½¯è¿æ¥ linkToRoot</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@root home]# ln -s /root homeToRoot</span><br><span class="line">[root@root home]# ll</span><br><span class="line">æ€»ç”¨é‡ 0</span><br><span class="line">lrwxrwxrwx. 1 root   root    5 4æœˆ  24 23:10 homeToRoot -&gt; /root</span><br><span class="line">drwx------. 3 liufei liufei 78 4æœˆ   9 18:14 liufei</span><br><span class="line">[root@root home]# cd homeToRoot/</span><br><span class="line">[root@root homeToRoot]# ls</span><br><span class="line">anaconda-ks.cfg  archive  initial-setup-ks.cfg  shell  testCommand  å…¬å…±  æ¨¡æ¿  è§†é¢‘  å›¾ç‰‡  æ–‡æ¡£  ä¸‹è½½  éŸ³ä¹  æ¡Œé¢</span><br><span class="line">[root@root homeToRoot]# pwd</span><br><span class="line">/home/homeToRoot</span><br></pre></td></tr></table></figure>

<p>æ³¨æ„äº‹é¡¹ï¼šå½“æˆ‘ä»¬ä½¿ç”¨ pwd æŒ‡ä»¤æŸ¥çœ‹ç›®å½•æ—¶ï¼Œä»ç„¶çœ‹åˆ°çš„æ˜¯è½¯é“¾æ¥æ‰€åœ¨ç›®å½•ã€‚</p>
<h3 id="historyï¼šæ˜¾ç¤ºå†å²æŒ‡ä»¤"><a href="#historyï¼šæ˜¾ç¤ºå†å²æŒ‡ä»¤" class="headerlink" title="historyï¼šæ˜¾ç¤ºå†å²æŒ‡ä»¤"></a>historyï¼šæ˜¾ç¤ºå†å²æŒ‡ä»¤</h3><p>â€‹		æŸ¥çœ‹å·²ç»æ‰§è¡Œè¿‡å†å²å‘½ä»¤ï¼Œä¹Ÿå¯ä»¥æ‰§è¡Œå†å²æŒ‡ä»¤ã€‚</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æ˜¾ç¤ºæ‰€æœ‰çš„å†å²å‘½ä»¤</span></span><br><span class="line">history</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æ˜¾ç¤ºæœ€è¿‘ä½¿ç”¨è¿‡çš„10ä¸ªæŒ‡ä»¤</span></span><br><span class="line">history 10</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æ‰§è¡Œå†å²ç¼–å·ä¸º10çš„æŒ‡ä»¤</span></span><br><span class="line">! 10</span><br></pre></td></tr></table></figure>

<h2 id="æ—¶é—´æ—¥æœŸç±»"><a href="#æ—¶é—´æ—¥æœŸç±»" class="headerlink" title="æ—¶é—´æ—¥æœŸç±»"></a>æ—¶é—´æ—¥æœŸç±»</h2><h3 id="dateï¼šæ˜¾ç¤ºæ—¥æœŸ"><a href="#dateï¼šæ˜¾ç¤ºæ—¥æœŸ" class="headerlink" title="dateï¼šæ˜¾ç¤ºæ—¥æœŸ"></a>dateï¼šæ˜¾ç¤ºæ—¥æœŸ</h3><p>åŸºæœ¬è¯­æ³•</p>
<ol>
<li><p>date ï¼ˆåŠŸèƒ½æè¿°ï¼šæ˜¾ç¤ºå½“å‰æ—¶é—´ï¼‰</p>
</li>
<li><p>date +%Y ï¼ˆåŠŸèƒ½æè¿°ï¼šæ˜¾ç¤ºå½“å‰å¹´ä»½ï¼‰</p>
</li>
<li><p>date +%m ï¼ˆåŠŸèƒ½æè¿°ï¼šæ˜¾ç¤ºå½“å‰æœˆä»½ï¼‰</p>
</li>
<li><p>date +%d ï¼ˆåŠŸèƒ½æè¿°ï¼šæ˜¾ç¤ºå½“å‰æ˜¯å“ªä¸€å¤©ï¼‰</p>
</li>
<li><p>date â€œ+%Y-%m-%d %Hï¼š%Mï¼š%Sâ€ï¼ˆåŠŸèƒ½æè¿°ï¼šæ˜¾ç¤ºå¹´æœˆæ—¥æ—¶åˆ†ç§’ï¼‰</p>
</li>
</ol>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@root homeToRoot]# date +%Y</span><br><span class="line">2022</span><br><span class="line">[root@root homeToRoot]# date +%y</span><br><span class="line">22</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æ³¨æ„Mè¡¨ç¤ºåˆ†é’Ÿï¼Œmè¡¨ç¤ºæœˆä»½ï¼ˆä»1å¼€å§‹ï¼‰</span></span><br><span class="line">[root@root homeToRoot]# date +%M</span><br><span class="line">17</span><br><span class="line">[root@root homeToRoot]# date +%m</span><br><span class="line">04</span><br><span class="line">[root@root homeToRoot]# date &quot;+%Yå¹´-%mæœˆ-%dæ—¥ %H:%M:%S&quot;</span><br><span class="line">2022å¹´-04æœˆ-24æ—¥ 23:19:31</span><br><span class="line">[root@root homeToRoot]#</span><br></pre></td></tr></table></figure>

<h3 id="calï¼šæŸ¥çœ‹æ—¥å†"><a href="#calï¼šæŸ¥çœ‹æ—¥å†" class="headerlink" title="calï¼šæŸ¥çœ‹æ—¥å†"></a>calï¼šæŸ¥çœ‹æ—¥å†</h3><p>ç¤ºä¾‹ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@root homeToRoot]# cal</span><br><span class="line">      å››æœˆ 2022</span><br><span class="line">æ—¥ ä¸€ äºŒ ä¸‰ å›› äº” å…­</span><br><span class="line">                1  2</span><br><span class="line"> 3  4  5  6  7  8  9</span><br><span class="line">10 11 12 13 14 15 16</span><br><span class="line">17 18 19 20 21 22 23</span><br><span class="line">24 25 26 27 28 29 30</span><br><span class="line"></span><br><span class="line">[root@root homeToRoot]# cal 2022</span><br><span class="line">                               2022</span><br><span class="line"></span><br><span class="line">        ä¸€æœˆ                   äºŒæœˆ                   ä¸‰æœˆ</span><br><span class="line">æ—¥ ä¸€ äºŒ ä¸‰ å›› äº” å…­   æ—¥ ä¸€ äºŒ ä¸‰ å›› äº” å…­   æ—¥ ä¸€ äºŒ ä¸‰ å›› äº” å…­</span><br><span class="line">                   1          1  2  3  4  5          1  2  3  4  5</span><br><span class="line"> 2  3  4  5  6  7  8    6  7  8  9 10 11 12    6  7  8  9 10 11 12</span><br><span class="line"> 9 10 11 12 13 14 15   13 14 15 16 17 18 19   13 14 15 16 17 18 19</span><br><span class="line">16 17 18 19 20 21 22   20 21 22 23 24 25 26   20 21 22 23 24 25 26</span><br><span class="line">23 24 25 26 27 28 29   27 28                  27 28 29 30 31</span><br><span class="line">30 31</span><br><span class="line">......</span><br></pre></td></tr></table></figure>

<h2 id="æœç´¢æŸ¥æ‰¾ç±»"><a href="#æœç´¢æŸ¥æ‰¾ç±»" class="headerlink" title="æœç´¢æŸ¥æ‰¾ç±»"></a>æœç´¢æŸ¥æ‰¾ç±»</h2><h3 id="whichï¼šæŸ¥çœ‹å¯æ‰§è¡Œæ–‡ä»¶çš„ä½ç½®"><a href="#whichï¼šæŸ¥çœ‹å¯æ‰§è¡Œæ–‡ä»¶çš„ä½ç½®" class="headerlink" title="whichï¼šæŸ¥çœ‹å¯æ‰§è¡Œæ–‡ä»¶çš„ä½ç½®"></a>whichï¼šæŸ¥çœ‹å¯æ‰§è¡Œæ–‡ä»¶çš„ä½ç½®</h3><p>â€‹		æŸ¥çœ‹å¯æ‰§è¡Œæ–‡ä»¶çš„ä½ç½®ã€‚åœ¨PATHå˜é‡æŒ‡å®šçš„è·¯å¾„ä¸­ï¼Œæœç´¢æŸä¸ªç³»ç»Ÿå‘½ä»¤çš„ä½ç½®ï¼Œå¹¶ä¸”è¿”å›ç¬¬ä¸€ä¸ªæœç´¢ç»“æœã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œä½¿ç”¨whichå‘½ä»¤ï¼Œå°±å¯ä»¥çœ‹åˆ°æŸä¸ªç³»ç»Ÿå‘½ä»¤æ˜¯å¦å­˜åœ¨ï¼Œä»¥åŠæ‰§è¡Œçš„åˆ°åº•æ˜¯å“ªä¸€ä¸ªä½ç½®çš„å‘½ä»¤ã€‚</p>
<p>å‘½ä»¤åŠŸèƒ½ï¼š</p>
<p>â€‹		whichæŒ‡ä»¤ä¼šåœ¨PATHå˜é‡æŒ‡å®šçš„è·¯å¾„ä¸­ï¼Œæœç´¢æŸä¸ªç³»ç»Ÿå‘½ä»¤çš„ä½ç½®ï¼Œå¹¶ä¸”è¿”å›ç¬¬ä¸€ä¸ªæœç´¢ç»“æœã€‚</p>
<p>å‘½ä»¤å‚æ•°ï¼š</p>
<p>-n ã€€æŒ‡å®šæ–‡ä»¶åé•¿åº¦ï¼ŒæŒ‡å®šçš„é•¿åº¦å¿…é¡»å¤§äºæˆ–ç­‰äºæ‰€æœ‰æ–‡ä»¶ä¸­æœ€é•¿çš„æ–‡ä»¶åã€‚</p>
<p>-p ã€€ä¸-nå‚æ•°ç›¸åŒï¼Œä½†æ­¤å¤„çš„åŒ…æ‹¬äº†æ–‡ä»¶çš„è·¯å¾„ã€‚</p>
<p>-w ã€€æŒ‡å®šè¾“å‡ºæ—¶æ ä½çš„å®½åº¦ã€‚</p>
<p>-V ã€€æ˜¾ç¤ºç‰ˆæœ¬ä¿¡æ¯</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@root homeToRoot]# which firefox</span><br><span class="line">/usr/bin/firefox</span><br></pre></td></tr></table></figure>

<h3 id="findï¼šæŸ¥æ‰¾æ–‡ä»¶ç›®å½•"><a href="#findï¼šæŸ¥æ‰¾æ–‡ä»¶ç›®å½•" class="headerlink" title="findï¼šæŸ¥æ‰¾æ–‡ä»¶ç›®å½•"></a>findï¼šæŸ¥æ‰¾æ–‡ä»¶ç›®å½•</h3><p>â€‹		find æŒ‡ä»¤å°†ä»æŒ‡å®šç›®å½•å‘ä¸‹é€’å½’åœ°éå†å…¶å„ä¸ªå­ç›®å½•ï¼Œå°†æ»¡è¶³æ¡ä»¶çš„æ–‡ä»¶æˆ–è€…ç›®å½•æ˜¾ç¤ºåœ¨ç»ˆç«¯ã€‚</p>
<p>åŸºæœ¬è¯­æ³•ï¼š<strong>find [æœç´¢èŒƒå›´] [é€‰é¡¹]</strong></p>
<p>é€‰é¡¹è¯´æ˜</p>
<table>
<thead>
<tr>
<th><strong>é€‰é¡¹</strong></th>
<th><strong>åŠŸèƒ½</strong></th>
</tr>
</thead>
<tbody><tr>
<td><strong>-name&lt;æŸ¥è¯¢æ–¹å¼&gt;</strong></td>
<td>æŒ‰ç…§æŒ‡å®šçš„æ–‡ä»¶åæŸ¥æ‰¾æ¨¡å¼æŸ¥æ‰¾æ–‡ä»¶</td>
</tr>
<tr>
<td><strong>-user&lt;ç”¨æˆ·å&gt;</strong></td>
<td>æŸ¥æ‰¾å±äºæŒ‡å®šç”¨æˆ·åçš„æ‰€æœ‰æ–‡ä»¶</td>
</tr>
<tr>
<td><strong>-size&lt;æ–‡ä»¶å¤§å°&gt;</strong></td>
<td>æŒ‰ç…§æŒ‡å®šçš„æ–‡ä»¶å¤§å°æŸ¥æ‰¾æ–‡ä»¶</td>
</tr>
</tbody></table>
<p>ç¤ºä¾‹ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æ ¹æ®åç§°æŸ¥æ‰¾/home ç›®å½•ä¸‹çš„hello.txtæ–‡ä»¶</span></span><br><span class="line">find /home -name hello.txt</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">ä½¿ç”¨é€šé…ç¬¦æ—¶éœ€è¦æ·»åŠ å¼•å·</span></span><br><span class="line">find /home -name &quot;hello*&quot;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æŸ¥æ‰¾/optç›®å½•ä¸‹ï¼Œç”¨æˆ·åç§°ä¸º nobodyçš„æ–‡ä»¶ã€‚</span></span><br><span class="line">find /opt -user nobody</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æŸ¥æ‰¾æ•´ä¸ªLinuxç³»ç»Ÿä¸‹å¤§äº200Mçš„æ–‡ä»¶ï¼ˆ+n å¤§äº -nå°äº nç­‰äºï¼‰</span></span><br><span class="line">find / -size +20M</span><br></pre></td></tr></table></figure>

<h3 id="locateï¼šå¿«é€Ÿå®šä½æ–‡ä»¶è·¯å¾„"><a href="#locateï¼šå¿«é€Ÿå®šä½æ–‡ä»¶è·¯å¾„" class="headerlink" title="locateï¼šå¿«é€Ÿå®šä½æ–‡ä»¶è·¯å¾„"></a>locateï¼šå¿«é€Ÿå®šä½æ–‡ä»¶è·¯å¾„</h3><p>â€‹		locate æŒ‡ä»¤å¯ä»¥å¿«é€Ÿå®šä½æ–‡ä»¶è·¯å¾„ã€‚locate æŒ‡ä»¤åˆ©ç”¨äº‹å…ˆå»ºç«‹çš„ç³»ç»Ÿä¸­æ‰€æœ‰æ–‡ä»¶åç§°åŠè·¯å¾„çš„ locate æ•°æ®åº“å®ç°å¿«é€Ÿå®šä½ç»™å®šçš„æ–‡ä»¶ã€‚locate æŒ‡ä»¤æ— éœ€éå†æ•´ä¸ªæ–‡ä»¶ç³»ç»Ÿï¼ŒæŸ¥è¯¢é€Ÿåº¦è¾ƒå¿«ã€‚ä¸ºäº†ä¿è¯æŸ¥è¯¢ç»“æœçš„å‡†ç¡®åº¦ï¼Œç®¡ç†å‘˜å¿…é¡»å®šæœŸæ›´æ–°locateã€‚</p>
<p>ç‰¹åˆ«è¯´æ˜ï¼šç”±äº locate æŒ‡ä»¤åŸºäºæ•°æ®åº“è¿›è¡ŒæŸ¥è¯¢ï¼Œæ‰€ä»¥ç¬¬ä¸€æ¬¡è¿è¡Œå‰ï¼Œå¿…é¡»ä½¿ç”¨ updatedb æŒ‡ä»¤åˆ›å»º locate æ•°æ®åº“ã€‚</p>
<p>ç¤ºä¾‹ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">è¯·ä½¿ç”¨locate æŒ‡ä»¤å¿«é€Ÿå®šä½ helloæ–‡ä»¶æ‰€åœ¨ç›®å½•</span></span><br><span class="line">updatedb</span><br><span class="line">locate hello</span><br></pre></td></tr></table></figure>

<h3 id="grep-æŒ‡ä»¤å’Œç®¡é“ç¬¦å·"><a href="#grep-æŒ‡ä»¤å’Œç®¡é“ç¬¦å·" class="headerlink" title="grep æŒ‡ä»¤å’Œç®¡é“ç¬¦å·  |"></a>grep æŒ‡ä»¤å’Œç®¡é“ç¬¦å·  |</h3><p>â€‹		grep è¿‡æ»¤æŸ¥æ‰¾ï¼Œ<strong>ç®¡é“ç¬¦ï¼Œâ€œ|â€ï¼Œè¡¨ç¤ºå°†å‰ä¸€ä¸ªå‘½ä»¤çš„å¤„ç†ç»“æœè¾“å‡ºä¼ é€’ç»™åé¢çš„å‘½ä»¤å¤„ç†ã€‚</strong></p>
<p>åŸºæœ¬è¯­æ³•ï¼š<strong>grep [é€‰é¡¹] æŸ¥æ‰¾å†…å®¹ æºæ–‡ä»¶</strong></p>
<p>å¸¸ç”¨é€‰é¡¹</p>
<table>
<thead>
<tr>
<th><strong>é€‰é¡¹</strong></th>
<th><strong>åŠŸèƒ½</strong></th>
</tr>
</thead>
<tbody><tr>
<td><strong>-n</strong></td>
<td>æ˜¾ç¤ºåŒ¹é…è¡ŒåŠè¡Œå·</td>
</tr>
<tr>
<td><strong>-i</strong></td>
<td>å¿½ç•¥å­—æ¯å¤§å°å†™</td>
</tr>
</tbody></table>
<p>ç¤ºä¾‹ï¼šæŸ¥æ‰¾ &#x2F;etc&#x2F;profileä¸‹çš„ HOSTNAME æ‰€åœ¨è¡Œã€‚</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@root homeToRoot]# cat /etc/profile | grep -ni HostName</span><br><span class="line">45:HOSTNAME=`/usr/bin/hostname 2&gt;/dev/null`</span><br><span class="line">53:export PATH USER LOGNAME MAIL HOSTNAME HISTSIZE HISTCONTROL</span><br></pre></td></tr></table></figure>

<h2 id="æ–‡ä»¶å‹ç¼©ç±»"><a href="#æ–‡ä»¶å‹ç¼©ç±»" class="headerlink" title="æ–‡ä»¶å‹ç¼©ç±»"></a>æ–‡ä»¶å‹ç¼©ç±»</h2><h3 id="gzip-x2F-gunzip"><a href="#gzip-x2F-gunzip" class="headerlink" title="gzip&#x2F;gunzip"></a>gzip&#x2F;gunzip</h3><p>â€‹		gzip ç”¨äºå‹ç¼©<strong>æ–‡ä»¶</strong>ï¼ˆ<strong>ä¸ä¼šä¿ç•™åŸæ–‡ä»¶</strong>ï¼‰ï¼Œgunzip ç”¨äºè§£å‹çš„ã€‚</p>
<p>åŸºæœ¬è¯­æ³•ï¼š</p>
<p>gzip æ–‡ä»¶ ï¼ˆåŠŸèƒ½æè¿°ï¼šå‹ç¼©æ–‡ä»¶ï¼Œåªèƒ½å°†æ–‡ä»¶å‹ç¼©ä¸º *.gz æ–‡ä»¶ï¼‰</p>
<p>gunzip æ–‡ä»¶ .gz ï¼ˆåŠŸèƒ½æè¿°ï¼šè§£å‹ç¼©æ–‡ä»¶å‘½ä»¤ï¼‰</p>
<p><strong>è¯´æ˜ï¼šä¸ä¼šä¿ç•™åŸæ–‡ä»¶ã€‚</strong></p>
<p><strong>å‚æ•° â€“rï¼šå¯¹æ–‡ä»¶åˆ†åˆ«å‹ç¼©</strong></p>
<p>ç¤ºä¾‹ï¼š gzip å‹ç¼©ï¼Œå°† &#x2F;home ä¸‹çš„ hello.txt æ–‡ä»¶å…ˆè¿›è¡Œå‹ç¼©å†è§£å‹ã€‚</p>
<h3 id="zip-x2F-unzip"><a href="#zip-x2F-unzip" class="headerlink" title="zip&#x2F;unzip"></a>zip&#x2F;unzip</h3><p>zip ç”¨äºå‹ç¼©æ–‡ä»¶ï¼Œunzip ç”¨äºè§£å‹çš„ï¼Œè¿™ä¸ªåœ¨é¡¹ç›®æ‰“åŒ…å‘å¸ƒä¸­å¾ˆæœ‰ç”¨çš„ã€‚</p>
<p>åŸºæœ¬è¯­æ³•</p>
<p>zip  [é€‰é¡¹]  XXX.zip å°†è¦å‹ç¼©çš„å†…å®¹ï¼ˆåŠŸèƒ½æè¿°ï¼šå‹ç¼©æ–‡ä»¶å’Œç›®å½•çš„å‘½ä»¤ï¼‰</p>
<p>unzip  [é€‰é¡¹]  XXX.zip ï¼ˆåŠŸèƒ½æè¿°ï¼šè§£å‹ç¼©æ–‡ä»¶ï¼‰</p>
<p>zipå¸¸ç”¨é€‰é¡¹</p>
<p>-rï¼šé€’å½’å‹ç¼©ï¼Œå³å‹ç¼©ç›®å½•</p>
<p>unzipçš„å¸¸ç”¨é€‰é¡¹</p>
<p>-d ï¼šæŒ‡å®šè§£å‹åæ–‡ä»¶çš„å­˜æ”¾ç›®å½•</p>
<p>ç¤ºä¾‹1ï¼š å°† &#x2F;homeä¸‹çš„æ‰€æœ‰æ–‡ä»¶è¿›è¡Œå‹ç¼©æˆ mypackage.zipï¼Œå¯¹äºå•ç‹¬çš„æ–‡ä»¶å¯ä»¥æ˜¾ç¤ºå‹ç¼©ç‡ã€‚</p>
<h3 id="tarï¼šæ‰“åŒ…"><a href="#tarï¼šæ‰“åŒ…" class="headerlink" title="tarï¼šæ‰“åŒ…"></a>tarï¼šæ‰“åŒ…</h3><p><strong>tar</strong> æŒ‡ä»¤æ˜¯æ‰“åŒ…æŒ‡ä»¤ï¼Œæœ€åæ‰“åŒ…åçš„æ–‡ä»¶æ˜¯ <strong>.tar.gz</strong> çš„æ–‡ä»¶ã€‚</p>
<p>æ‰“åŒ…å’Œå‹ç¼©ï¼šæ‰“åŒ…æ˜¯æŒ‡å°†ä¸€å¤§å †æ–‡ä»¶æˆ–ç›®å½•ä»€ä¹ˆçš„å˜æˆä¸€ä¸ªæ€»çš„æ–‡ä»¶ï¼Œå‹ç¼©åˆ™æ˜¯å°†ä¸€ä¸ªå¤§çš„æ–‡ä»¶é€šè¿‡ä¸€äº›å‹ç¼©ç®—æ³•å˜æˆä¸€ä¸ªå°æ–‡ä»¶ã€‚</p>
<p>åŸºæœ¬è¯­æ³•ï¼š<strong>tar [é€‰é¡¹]  XXX.tar.gz æ‰“åŒ…çš„å†…å®¹</strong> </p>
<p>åŠŸèƒ½æè¿°ï¼šæ‰“åŒ…ç›®å½•ï¼Œå‹ç¼©åçš„æ–‡ä»¶æ ¼å¼ <strong>.tar.gzã€‚</strong></p>
<p>é€‰é¡¹è¯´æ˜</p>
<table>
<thead>
<tr>
<th><strong>é€‰é¡¹</strong></th>
<th><strong>åŠŸèƒ½</strong></th>
</tr>
</thead>
<tbody><tr>
<td><strong>-c</strong></td>
<td>äº§ç”Ÿ <strong>.tar</strong> æ‰“åŒ…æ–‡ä»¶</td>
</tr>
<tr>
<td>-z</td>
<td><strong>æ‰“åŒ…åŒæ—¶å‹ç¼©</strong></td>
</tr>
<tr>
<td><strong>-x</strong></td>
<td>è§£å‹  .tar æ–‡ä»¶</td>
</tr>
<tr>
<td><strong>-f</strong></td>
<td>æŒ‡å®šå‹ç¼©åçš„æ–‡ä»¶å</td>
</tr>
<tr>
<td><strong>-v</strong></td>
<td>æ˜¾ç¤ºè¯¦ç»†ä¿¡æ¯</td>
</tr>
</tbody></table>
<p>ç¤ºä¾‹ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æ‰“åŒ…</span></span><br><span class="line">tar -zcvf testTar.tar.gz a.txt b.txt</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">è§£å‹,-C æŒ‡å®šè§£å‹ç›®å½•</span></span><br><span class="line">tar -zxvf testTar.tar.gz -C /root/testTar</span><br></pre></td></tr></table></figure>

<h2 id="å…¶ä»–"><a href="#å…¶ä»–" class="headerlink" title="å…¶ä»–"></a>å…¶ä»–</h2><h3 id="wgetï¼šä¸‹è½½èµ„æº"><a href="#wgetï¼šä¸‹è½½èµ„æº" class="headerlink" title="wgetï¼šä¸‹è½½èµ„æº"></a>wgetï¼šä¸‹è½½èµ„æº</h3><p>ç¤ºä¾‹ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">wget http://nginx.org/download/nginx-1.6.2.tar.gz</span><br></pre></td></tr></table></figure>







<h1 id="VmWare-ç½‘ç»œè®¾ç½®"><a href="#VmWare-ç½‘ç»œè®¾ç½®" class="headerlink" title="VmWare ç½‘ç»œè®¾ç½®"></a>VmWare ç½‘ç»œè®¾ç½®</h1><h2 id="Vmwareä¸‰ç§ç½‘ç»œæ¨¡å¼"><a href="#Vmwareä¸‰ç§ç½‘ç»œæ¨¡å¼" class="headerlink" title="Vmwareä¸‰ç§ç½‘ç»œæ¨¡å¼"></a>Vmwareä¸‰ç§ç½‘ç»œæ¨¡å¼</h2><p>Vmware æä¾›äº†ä¸‰ç§è™šæ‹Ÿäº¤æ¢æœºå’Œä¸¤å¼ è™šæ‹Ÿç½‘å¡ï¼š</p>
<blockquote>
<p>VMnet0ï¼šç”¨äºè™šæ‹Ÿæ¡¥æ¥ç½‘ç»œä¸‹çš„è™šæ‹Ÿäº¤æ¢æœº</p>
<p>VMnet1ï¼šç”¨äºè™šæ‹ŸHost-Onlyç½‘ç»œä¸‹çš„è™šæ‹Ÿäº¤æ¢æœº</p>
<p>VMnet8ï¼šç”¨äºè™šæ‹ŸNATç½‘ç»œä¸‹çš„è™šæ‹Ÿäº¤æ¢æœº</p>
<p>VMware Network Adepter VMnet1ï¼šHostç”¨äºä¸Host-Onlyè™šæ‹Ÿç½‘ç»œè¿›è¡Œé€šä¿¡çš„è™šæ‹Ÿç½‘å¡</p>
<p>VMware Network Adepter VMnet8ï¼šHostç”¨äºä¸NATè™šæ‹Ÿç½‘ç»œè¿›è¡Œé€šä¿¡çš„è™šæ‹Ÿç½‘å¡</p>
</blockquote>
<h3 id="æ¡¥æ¥ç½‘ç»œ"><a href="#æ¡¥æ¥ç½‘ç»œ" class="headerlink" title="æ¡¥æ¥ç½‘ç»œ"></a>æ¡¥æ¥ç½‘ç»œ</h3><p>æ¡¥æ¥ç½‘ç»œæ˜¯æŒ‡è™šæ‹Ÿç½‘å¡é€šè¿‡ VMnet0 è™šæ‹Ÿäº¤æ¢æœºå’Œæœ¬åœ°ç‰©ç†ç½‘å¡è¿›è¡Œæ¡¥æ¥ï¼Œé‚£ä¹ˆç‰©ç†ç½‘å¡å’Œè™šæ‹Ÿç½‘å¡å°±ç›¸å½“äºå¤„äºåŒä¸€ä¸ªç½‘æ®µï¼Œè™šæ‹Ÿäº¤æ¢æœºå°±ç›¸å½“äºä¸€å°ç°å®ç½‘ç»œä¸­çš„äº¤æ¢æœºã€‚æ‰€ä»¥è¦æƒ³è™šæ‹Ÿæœºä¹Ÿå¯ä»¥è¿æ¥åˆ°äº’è”ç½‘ä¸­ï¼Œé‚£ ä¹ˆä¸¤ä¸ªç½‘å¡çš„IPåœ°å€ä¹Ÿè¦è®¾ç½®ä¸ºåŒä¸€ç½‘æ®µã€‚</p>
<p>ç‰¹ç‚¹ï¼š</p>
<blockquote>
<p>é»˜è®¤æƒ…å†µä¸‹å¯ä»¥è®¿é—®äº’è”ç½‘</p>
<p>æ¡¥æ¥ç½‘ç»œçš„è™šæ‹ŸæœºIPåœ°å€å’Œç‰©ç†çœŸæœºåœ¨åŒä¸€ä¸ªç½‘æ®µ</p>
<p>ä¸»æœºBåŠå…¶è™šæ‹ŸæœºB1å¯ä»¥å’Œä¸»æœºA1ï¼ŒA2ç›¸äº’é€šä¿¡</p>
</blockquote>
<img src="/2023/02/28/Linux/Java\Document\Linux\Linux åŸºç¡€.assets\image-20220922225327132.png" alt="image-20220922225327132" style="zoom:80%;">



<h3 id="NATç½‘ç»œ"><a href="#NATç½‘ç»œ" class="headerlink" title="NATç½‘ç»œ"></a>NATç½‘ç»œ</h3><p>åœ¨NATç½‘ç»œä¸­ï¼Œä¼šç”¨åˆ°VMware Network Adepter VMnet8è™šæ‹Ÿç½‘å¡ï¼Œä¸»æœºä¸Šçš„VMware Network Adepter VMnet8è™šæ‹Ÿç½‘å¡è¢«ç›´æ¥è¿æ¥åˆ°VMnet8è™šæ‹Ÿäº¤æ¢æœºä¸Šä¸è™šæ‹Ÿç½‘å¡è¿›è¡Œé€šä¿¡ã€‚</p>
<p>VMware Network Adepter VMnet8è™šæ‹Ÿç½‘å¡çš„ä½œç”¨ä»…é™äºå’ŒVMnet8ç½‘æ®µè¿›è¡Œé€šä¿¡ï¼Œå®ƒä¸ç»™VMnet8ç½‘æ®µæä¾›è·¯ç”±åŠŸèƒ½ï¼Œæ‰€ä»¥è™šæ‹Ÿæœºè™šæ‹Ÿ ä¸€ä¸ªNATæœåŠ¡å™¨ï¼Œä½¿è™šæ‹Ÿç½‘å¡å¯ä»¥è¿ æ¥åˆ°Internetã€‚</p>
<p> VMware Network Adepter VMnet8è™šæ‹Ÿç½‘å¡çš„IPåœ°å€æ˜¯åœ¨å®‰è£…VMwareæ—¶ç”±ç³»ç»ŸæŒ‡å®šç”Ÿæˆçš„ï¼Œæˆ‘ä»¬å°½é‡ä¸è¦ä¿®æ”¹è¿™ä¸ªæ•°å€¼ï¼Œå¦åˆ™å¯èƒ½ä¼šä½¿ä¸»æœºå’Œè™šæ‹Ÿæœºæ— æ³•é€šä¿¡ã€‚</p>
<p>ç‰¹ç‚¹ï¼š</p>
<blockquote>
<p>é»˜è®¤æƒ…å†µä¸‹å¯ä»¥è®¿é—®äº’è”ç½‘</p>
<p>NATç½‘ç»œçš„è™šæ‹ŸIPåœ°å€å’Œç‰©ç†çœŸæœºä¸åœ¨åŒä¸€ä¸ªç½‘æ®µ</p>
<p>ä¸ºä»€ä¹ˆNATç½‘ç»œå¯ä»¥è®¿é—®äº’è”ç½‘ï¼Ÿå› ä¸ºNATè·¯ç”±è½¬æ¢åŠŸèƒ½ï¼ˆåœ°å€è½¬æ¢æŠ€æœ¯ï¼‰</p>
<p>ä¸»æœºBä¸èƒ½è®¿é—®ä¸»æœºA1å’Œä¸»æœºA2</p>
</blockquote>
<img src="/2023/02/28/Linux/Java\Document\Linux\Linux åŸºç¡€.assets\image-20220922230454021.png" alt="image-20220922230454021" style="zoom:80%;">

<h3 id="ä»…ä¸»æœºç½‘ç»œ"><a href="#ä»…ä¸»æœºç½‘ç»œ" class="headerlink" title="ä»…ä¸»æœºç½‘ç»œ"></a>ä»…ä¸»æœºç½‘ç»œ</h3><p>åœ¨Host-Onlyæ¨¡å¼ä¸‹ï¼Œè™šæ‹Ÿç½‘ç»œæ˜¯ä¸€ä¸ªå…¨å°é—­çš„ç½‘ç»œï¼Œå®ƒå”¯ä¸€èƒ½å¤Ÿè®¿é—®çš„å°±æ˜¯ç‰©ç†çœŸæœºã€‚å…¶å®Host-Onlyç½‘ç»œå’Œ NATç½‘ç»œå¾ˆç›¸ä¼¼ï¼Œä¸åŒçš„åœ°æ–¹å°±æ˜¯Host-Onlyç½‘ç»œæ²¡æœ‰NATæœåŠ¡ï¼Œæ‰€ä»¥è™šæ‹Ÿç½‘ç»œä¸èƒ½è¿æ¥åˆ°Internetã€‚ä¸»æœºå’Œè™š æ‹Ÿæœºä¹‹é—´çš„é€šä¿¡æ˜¯é€šè¿‡VMware Network Adepter VMnet1è™šæ‹Ÿç½‘å¡æ¥å®ç°çš„ã€‚</p>
<p>ç‰¹ç‚¹ï¼š</p>
<blockquote>
<p>é»˜è®¤æƒ…å†µä¸‹ä¸å¯ä»¥è®¿é—®äº’è”ç½‘</p>
<p>ä»…ä¸»æœºæ¨¡å¼ä¸‹è™šæ‹ŸæœºIPåœ°å€å’Œç‰©ç†çœŸæœºä¸åœ¨åŒä¸€ä¸ªç½‘æ®µ</p>
<p>ä¸»æœºAå’Œä¸»æœºA1ï¼ŒA2å¯ä»¥ç›¸äº’è®¿é—®ï¼Œå› ä¸ºæœ‰VMnet1è™šæ‹Ÿç½‘å¡</p>
</blockquote>
<img src="/2023/02/28/Linux/Java\Document\Linux\Linux åŸºç¡€.assets\image-20220922231330161.png" alt="image-20220922231330161" style="zoom:80%;">

<h2 id="Vmwareè™šæ‹Ÿç½‘ç»œç¼–è¾‘å™¨"><a href="#Vmwareè™šæ‹Ÿç½‘ç»œç¼–è¾‘å™¨" class="headerlink" title="Vmwareè™šæ‹Ÿç½‘ç»œç¼–è¾‘å™¨"></a>Vmwareè™šæ‹Ÿç½‘ç»œç¼–è¾‘å™¨</h2><h3 id="å…¨å±€ç½‘ç»œé…ç½®"><a href="#å…¨å±€ç½‘ç»œé…ç½®" class="headerlink" title="å…¨å±€ç½‘ç»œé…ç½®"></a>å…¨å±€ç½‘ç»œé…ç½®</h3><h4 id="æ¡¥æ¥ç½‘ç»œ-1"><a href="#æ¡¥æ¥ç½‘ç»œ-1" class="headerlink" title="æ¡¥æ¥ç½‘ç»œ"></a>æ¡¥æ¥ç½‘ç»œ</h4><p>æ³¨æ„ï¼š</p>
<blockquote>
<p>æ¡¥æ¥æ¨¡å¼ï¼Œè‡ªåŠ¨ï¼šä¼šè‡ªåŠ¨è¿æ¥è‡³ç½‘çº¿æˆ–æ— çº¿ç½‘ç»œ</p>
</blockquote>
<p>![image-20220923002339728](C:\Java\Document\Linux\Linux åŸºç¡€.assets\image-20220923002339728.png)</p>
<h4 id="ä»…ä¸»æœºæ¨¡å¼"><a href="#ä»…ä¸»æœºæ¨¡å¼" class="headerlink" title="ä»…ä¸»æœºæ¨¡å¼"></a>ä»…ä¸»æœºæ¨¡å¼</h4><p>æ³¨æ„ï¼š</p>
<blockquote>
<p>ä»…ä¸»æœºæ¨¡å¼ï¼Œé€‰æ‹©å­ç½‘IPï¼ŒDHCPè¡¨ç¤ºåŠ¨æ€è·å–ç½‘ç»œ</p>
</blockquote>
<p>![image-20220923002512674](C:\Java\Document\Linux\Linux åŸºç¡€.assets\image-20220923002512674.png)</p>
<h4 id="NATæ¨¡å¼"><a href="#NATæ¨¡å¼" class="headerlink" title="NATæ¨¡å¼"></a>NATæ¨¡å¼</h4><p>![image-20220923002631240](C:\Java\Document\Linux\Linux åŸºç¡€.assets\image-20220923002631240.png)</p>
<h3 id="å•ä¸ªè™šæ‹Ÿæœºè®¾ç½®"><a href="#å•ä¸ªè™šæ‹Ÿæœºè®¾ç½®" class="headerlink" title="å•ä¸ªè™šæ‹Ÿæœºè®¾ç½®"></a>å•ä¸ªè™šæ‹Ÿæœºè®¾ç½®</h3><h2 id="é™æ€-IP-åœ°å€é…ç½®"><a href="#é™æ€-IP-åœ°å€é…ç½®" class="headerlink" title="é™æ€ IP åœ°å€é…ç½®"></a>é™æ€ IP åœ°å€é…ç½®</h2><h3 id="æ–¹æ³•ä¸€ï¼šä¿®æ”¹ç½‘å¡é…ç½®æ–‡ä»¶"><a href="#æ–¹æ³•ä¸€ï¼šä¿®æ”¹ç½‘å¡é…ç½®æ–‡ä»¶" class="headerlink" title="æ–¹æ³•ä¸€ï¼šä¿®æ”¹ç½‘å¡é…ç½®æ–‡ä»¶"></a>æ–¹æ³•ä¸€ï¼šä¿®æ”¹ç½‘å¡é…ç½®æ–‡ä»¶</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@localhost ~]# cd /etc/sysconfig/network-scripts/</span><br><span class="line">[root@localhost network-scripts]# cp ifcfg-ens33 ifcfg-ens33.bak</span><br><span class="line">[root@localhost network-scripts]# vim ifcfg-ens33</span><br></pre></td></tr></table></figure>

<p>å¢åŠ é…ç½®ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">TYPE=&quot;Ethernet&quot;</span><br><span class="line">PROXY_METHOD=&quot;none&quot;</span><br><span class="line">BROWSER_ONLY=&quot;no&quot;</span><br><span class="line">DEFROUTE=&quot;yes&quot;</span><br><span class="line">IPV4_FAILURE_FATAL=&quot;no&quot;</span><br><span class="line">IPV6INIT=&quot;yes&quot;</span><br><span class="line">IPV6_AUTOCONF=&quot;yes&quot;</span><br><span class="line">IPV6_DEFROUTE=&quot;yes&quot;</span><br><span class="line">IPV6_FAILURE_FATAL=&quot;no&quot;</span><br><span class="line">IPV6_ADDR_GEN_MODE=&quot;stable-privacy&quot;</span><br><span class="line"></span><br><span class="line">NAME=&quot;ens33&quot;					# ç½‘å¡å</span><br><span class="line">UUID=&quot;7525fa8a-a069-47fc-bd45-0d2eb148bef8&quot;		# ç½‘å¡UUIDï¼Œå”¯ä¸€æ ‡è¯†</span><br><span class="line">DEVICE=&quot;ens33&quot;					# ç½‘å¡è®¾å¤‡å</span><br><span class="line">ONBOOT=&quot;yes&quot;					# æ¿€æ´»ç½‘å¡</span><br><span class="line">BOOTPROTO=&quot;static&quot;				# IPè·å–æ–¹å¼ï¼Œnoneå’Œstaticè¡¨ç¤ºé™æ€ï¼ŒdhcpåŠ¨æ€</span><br><span class="line">IPADDR=192.168.100.100			# IPåœ°å€</span><br><span class="line">PREFIX=24						# å­ç½‘æ©ç ï¼Œç­‰åŒäºNETMASK=255.255.255.0</span><br><span class="line">NETMASK=255.255.255.0</span><br><span class="line">GATEWAY=192.168.100.2			# ç½‘å…³ï¼Œé»˜è®¤ .2ï¼ŒVmnetç½‘å¡é»˜è®¤ .1ï¼Œå…¶ä»–çš„å¯ä½œä¸ºIP</span><br><span class="line">DNS1=8.8.8.8					# dnsæœåŠ¡å™¨</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="é‡å¯ç½‘ç»œæœåŠ¡"><a href="#é‡å¯ç½‘ç»œæœåŠ¡" class="headerlink" title="é‡å¯ç½‘ç»œæœåŠ¡"></a>é‡å¯ç½‘ç»œæœåŠ¡</h3><p>Redhat6ï¼šservice network restart</p>
<p>Redhat7ï¼šsystemctl restart network.service</p>
<p>Redhat8ï¼šnmcli connection reload ens160</p>
<p>â€‹					nmcli connection up ens160</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@localhost network-scripts]# systemctl restart network.service</span><br><span class="line">[root@localhost network-scripts]# ifconfig</span><br><span class="line">ens33: flags=4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu 1500</span><br><span class="line">        inet 192.168.100.100  netmask 255.255.255.0  broadcast 192.168.100.255</span><br><span class="line">        inet6 fe80::5416:4001:661d:1ada  prefixlen 64  scopeid 0x20&lt;link&gt;</span><br><span class="line">        ether 00:0c:29:ad:84:bb  txqueuelen 1000  (Ethernet)</span><br><span class="line">        RX packets 457746  bytes 654018153 (623.7 MiB)</span><br><span class="line">        RX errors 0  dropped 0  overruns 0  frame 0</span><br><span class="line">        TX packets 105694  bytes 6433985 (6.1 MiB)</span><br><span class="line">        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h1 id="Shell"><a href="#Shell" class="headerlink" title="Shell"></a>Shell</h1><h2 id="Shellæ¦‚è¿°"><a href="#Shellæ¦‚è¿°" class="headerlink" title="Shellæ¦‚è¿°"></a>Shellæ¦‚è¿°</h2><p>Shellæ˜¯ä¸€ä¸ªå‘½ä»¤è¡Œè§£é‡Šå™¨ï¼Œä¸ºç”¨æˆ·æä¾›äº†ä¸€ä¸ªå‘ Linux å‘é€è¯·æ±‚ä»¥ä¾¿è¿è¡Œç¨‹åºçš„ç•Œé¢ç³»ç»Ÿçº§ç¨‹åºï¼Œç”¨æˆ·å¯ä»¥ç”¨ Shell æ¥å¯åŠ¨ã€æŒ‚èµ·ã€åœæ­¢ç”šè‡³æ˜¯ç¼–å†™ä¸€äº›ç¨‹åºæ¥æ”¶ç”¨æˆ·æŒ‡ä»¤ï¼Œç„¶åè°ƒç”¨ç³»ç»Ÿå†…æ ¸ï¼ŒShellæœ‰å¾ˆå¤šç‰ˆæœ¬ã€‚</p>
<p>Linuxæä¾›çš„è§£æå™¨ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@root shell]# cat /etc/shells</span><br><span class="line">/bin/sh</span><br><span class="line">/bin/bash</span><br><span class="line">/usr/bin/sh</span><br><span class="line">/usr/bin/bash</span><br><span class="line">/bin/tcsh</span><br><span class="line">/bin/csh</span><br></pre></td></tr></table></figure>

<p>bash å’Œ sh çš„å…³ç³»ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@root shell]# ll /bin/ |grep bash</span><br><span class="line">-rwxr-xr-x. 1 root root      964536 4æœˆ   1 2020 bash</span><br><span class="line">lrwxrwxrwx. 1 root root          10 4æœˆ   9 18:14 bashbug -&gt; bashbug-64</span><br><span class="line">-rwxr-xr-x. 1 root root        6964 4æœˆ   1 2020 bashbug-64</span><br><span class="line">lrwxrwxrwx. 1 root root           4 4æœˆ   9 18:14 sh -&gt; bash</span><br></pre></td></tr></table></figure>

<p>Centos é»˜è®¤çš„è§£æå™¨æ˜¯ bashï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@root shell]# echo $SHELL</span><br><span class="line">/bin/bash</span><br></pre></td></tr></table></figure>

<h2 id="Shellè„šæœ¬å…¥é—¨"><a href="#Shellè„šæœ¬å…¥é—¨" class="headerlink" title="Shellè„šæœ¬å…¥é—¨"></a>Shellè„šæœ¬å…¥é—¨</h2><p>è„šæœ¬æ ¼å¼çš„è¦æ±‚ï¼š</p>
<p>â€‹		**#!&#x2F;bin&#x2F;sh **æ˜¯æŒ‡æ­¤è„šæœ¬ä½¿ç”¨ &#x2F;bin&#x2F;sh æ¥è§£é‡Šæ‰§è¡Œï¼Œ#! æ˜¯ç‰¹æ®Šçš„è¡¨ç¤ºç¬¦ï¼Œå…¶åé¢è·Ÿçš„æ˜¯æ­¤è§£é‡Šæ­¤è„šæœ¬çš„shellçš„è·¯å¾„ã€‚</p>
<p>ç¤ºä¾‹ï¼šç¼–å†™ Shell è„šæœ¬ helloworld.sh è¾“å‡º Hello World</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">mkdir /opt/shell</span><br><span class="line">cd /opt/shell</span><br><span class="line">vim helloworld.sh</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/bin/bash</span></span><br><span class="line">echo &#x27;Hello World&#x27;</span><br></pre></td></tr></table></figure>

<p>Shellè„šæœ¬çš„æ‰§è¡Œæ–¹å¼ï¼š</p>
<p>æ–¹å¼ä¸€ï¼šä½¿ç”¨å‘½ä»¤ sh&#x2F;bash helloworld.sh æ‰§è¡Œï¼Œæ–‡ä»¶è·¯å¾„å¯ä»¥ä½¿ç”¨ç»å¯¹è·¯å¾„å’Œç›¸å¯¹è·¯å¾„ã€‚</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@localhost shell]# bash helloworld.sh</span><br><span class="line">Hello World</span><br><span class="line">[root@localhost shell]# sh helloworld.sh</span><br><span class="line">Hello World</span><br><span class="line">[root@localhost shell]# bash /opt/shell/helloworld.sh</span><br><span class="line">Hello World</span><br><span class="line">[root@localhost shell]# sh /opt/shell/helloworld.sh</span><br><span class="line">Hello World</span><br><span class="line">[root@localhost shell]#</span><br></pre></td></tr></table></figure>

<p>æ–¹å¼äºŒï¼šèµ‹äºˆæ–‡ä»¶å¯æ‰§è¡Œæƒé™ï¼Œç›´æ¥ä½¿ç”¨ç›¸å¯¹è·¯å¾„å’Œç»å¯¹è·¯å¾„æ‰§è¡Œæ–‡ä»¶ã€‚</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@localhost shell]# helloworld.sh</span><br><span class="line">bash: helloworld.sh: æœªæ‰¾åˆ°å‘½ä»¤...</span><br><span class="line">[root@localhost shell]# chmod +x helloworld.sh</span><br><span class="line">[root@localhost shell]# ./helloworld.sh</span><br><span class="line">Hello World</span><br><span class="line">[root@localhost shell]# /opt/shell/helloworld.sh</span><br><span class="line">Hello World</span><br></pre></td></tr></table></figure>

<p>æ–¹å¼ä¸‰ï¼šåœ¨è„šæœ¬çš„è·¯å¾„å‰é¢åŠ ä¸Šç‚¹  .  æˆ–è€… source</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@localhost shell]# chmod -x helloworld.sh</span><br><span class="line">[root@localhost shell]# . helloworld.sh</span><br><span class="line">Hello World</span><br><span class="line">[root@localhost shell]# source helloworld.sh</span><br><span class="line">Hello World</span><br><span class="line">[root@localhost shell]#</span><br></pre></td></tr></table></figure>

<p><strong>æ³¨æ„ï¼š</strong></p>
<p>å¦‚æœåœ¨ shell è„šæœ¬ç›®å½•æ‰§è¡Œ helloworld.shï¼Œåˆ™ shell ä¼šå°† helloworld.sh å½“ä½œä¸€ä¸ªå‘½ä»¤ï¼ŒæŠ¥é”™ï¼šæœªæ‰¾åˆ°å‘½ä»¤</p>
<p>å…³äº â€œ.â€ å’Œ source çš„åŒºåˆ«ï¼š</p>
<ol>
<li>source å‘½ä»¤æ˜¯ shell å†…åµŒçš„ä¸€ç§å‘½ä»¤ï¼Œç”± cshell&#x2F;csh æ¼”å˜è€Œæ¥ã€‚</li>
<li>â€œ.â€  å‘½ä»¤ç”± bash å‘½ä»¤æ¼”å˜è€Œæ¥ã€‚</li>
</ol>
<p>æ³¨æ„æ–¹å¼ä¸‰å’Œå‰ä¸¤ç§æ–¹å¼çš„åŒºåˆ«ï¼š</p>
<ol>
<li>å‰ä¸¤ç§æ–¹å¼éƒ½æ˜¯åœ¨å½“å‰ shell ä¸­æ‰“å¼€ä¸€ä¸ªå­ shell æ¥æ‰§è¡Œè„šæœ¬å†…å®¹ï¼Œå½“è„šæœ¬å†…å®¹ç»“æŸï¼Œåˆ™å­ shell å…³é—­ï¼Œå›åˆ°çˆ¶ shell ä¸­ã€‚ </li>
<li>ç¬¬ä¸‰ç§æ–¹å¼ï¼Œåœ¨è„šæœ¬è·¯å¾„å‰åŠ   â€œ.â€  æˆ–è€… source çš„æ–¹å¼ï¼Œå¯ä»¥ä½¿è„šæœ¬å†…å®¹åœ¨å½“å‰ shell é‡Œæ‰§è¡Œï¼Œè€Œæ— éœ€æ‰“å¼€å­ shellã€‚ç›¸å½“äºè¯»å–æ–‡ä»¶çš„æ¯ä¸€è¡Œå‘½ä»¤ï¼Œç„¶åå†å½“å‰ shell ä¸­æ‰§è¡Œã€‚å¦‚ä¿®æ”¹ &#x2F;etc&#x2F;profile æ–‡ä»¶ä»¥åï¼Œéœ€è¦ source ä¸€ä¸‹çš„åŸå› ã€‚ </li>
<li>æ‰“å¼€å­ shell ä¸ä¸æ‰“å¼€å­ shell çš„åŒºåˆ«å°±åœ¨äºï¼Œç¯å¢ƒå˜é‡çš„ç»§æ‰¿å…³ç³»ï¼Œå¦‚åœ¨å­ shell ä¸­è®¾ç½®çš„å½“å‰å˜é‡ï¼Œçˆ¶ shell æ˜¯ä¸å¯è§çš„ã€‚</li>
</ol>
<p>æŸ¥çœ‹å­bashè¿›ç¨‹ï¼šï¼ˆ-bashè¡¨ç¤ºçˆ¶bashï¼‰</p>
<p>ä½¿ç”¨ bash å‘½ä»¤å¼€å¯ä¸€ä¸ªæ–°çš„è¿›ç¨‹ã€‚</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@root shell]# bash</span><br><span class="line">[root@root shell]# ps -f</span><br><span class="line">UID         PID   PPID  C STIME TTY          TIME CMD</span><br><span class="line">root       9873   9865  0 08:34 pts/4    00:00:00 -bash</span><br><span class="line">root      10766   9873  1 09:51 pts/4    00:00:00 bash</span><br><span class="line">root      10799  10766  0 09:52 pts/4    00:00:00 ps -f</span><br><span class="line">[root@root shell]# exit</span><br></pre></td></tr></table></figure>

<p>ps -ef |grep bash ç›¸å½“äºåœ¨å­ shell ä¸­æ‰§è¡Œ ps å‘½ä»¤ï¼Œä½¿ç”¨ exit é€€å‡ºå­shellã€‚</p>
<p>bash ä½œä¸ºä¸€ä¸ªè¿›ç¨‹å­˜åœ¨ï¼Œå¼€å¯ bash å°±éœ€è¦å…³é—­ exitã€‚</p>
<p>æ³¨æ„å•å¼•å·ä¸åŒå¼•å·çš„åŒºåˆ«ï¼š</p>
<p>å•å¼•å·ï¼šå•å¼•å·ä¸­çš„å†…å®¹ä¸ä¼šè½¬ä¹‰æˆ–å–å€¼</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@root shell]# echo &#x27;----$USER----&#x27;</span><br><span class="line"><span class="meta prompt_">----$</span><span class="language-bash">USER----</span></span><br><span class="line">[root@root shell]# echo &quot;----$USER----&quot;</span><br><span class="line">----root---</span><br></pre></td></tr></table></figure>

<h2 id="Shellå˜é‡"><a href="#Shellå˜é‡" class="headerlink" title="Shellå˜é‡"></a>Shellå˜é‡</h2><p>Shellå˜é‡åˆ†ä¸ºç³»ç»Ÿå˜é‡å’Œç”¨æˆ·è‡ªå®šä¹‰å˜é‡ï¼Œä¹Ÿå¯ä»¥åˆ†ä¸ºå…¨å±€å˜é‡å’Œå±€éƒ¨å˜é‡ã€‚</p>
<p>å¯¹äºå…¨å±€å˜é‡å’Œå±€éƒ¨å˜é‡ï¼šå¦‚åœ¨ bash è¿›ç¨‹ä¸­å†å¼€å¯ bashï¼Œå…¨å±€å˜é‡å¯¹äºå­ bash æ˜¯å¯è§çš„ã€‚</p>
<h3 id="ç³»ç»Ÿå˜é‡"><a href="#ç³»ç»Ÿå˜é‡" class="headerlink" title="ç³»ç»Ÿå˜é‡"></a>ç³»ç»Ÿå˜é‡</h3><p>å¦‚ $HOMEã€$PWDã€$SHELLã€$USERã€‚</p>
<p>æŸ¥çœ‹å˜é‡çš„æ–¹å¼ï¼š</p>
<ul>
<li><p>env</p>
</li>
<li><p>printenv</p>
</li>
<li><p>echo $HOME</p>
</li>
<li><p>printenv HOME</p>
</li>
<li><p>set</p>
</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@root shell]# env |less</span><br><span class="line">[root@root shell]# env</span><br><span class="line">XDG_SESSION_ID=84</span><br><span class="line">HOSTNAME=root</span><br><span class="line">SELINUX_ROLE_REQUESTED=</span><br><span class="line">TERM=xterm</span><br><span class="line">SHELL=/bin/bash</span><br><span class="line">HISTSIZE=1000</span><br><span class="line">SSH_CLIENT=192.168.1.5 6921 22</span><br><span class="line">SELINUX_USE_CURRENT_RANGE=</span><br><span class="line">SSH_TTY=/dev/pts/4</span><br><span class="line">USER=root</span><br><span class="line">LS_COLORS=rs=0:di=01;34:ln=01;36:mh=00:pi=40;33:so=01;35:do=01;35:bd=40;33;01:cd=40;33;01:or=40;31;01:mi=01;05;37;41:su=37;41:sg=30;43:ca=30;41:tw=30;42:ow=34;42:st=37;44:ex=01;32:*.tar=01;31:*.tgz=01;31:*.arc=01;31:*.arj=01;31:*.taz=01;31:*.lha=01;31:*.lz4=01;31:*.lzh=01;31:*.lzma=01;31:*.tlz=01;31:*.txz=01;31:*.tzo=01;31:*.t7z=01;31:*.zip=01;31:*.z=01;31:*.Z=01;31:*.dz=01;31:*.gz=01;31:*.lrz=01;31:*.lz=01;31:*.lzo=01;31:*.xz=01;31:*.bz2=01;31:*.bz=01;31:*.tbz=01;31:*.tbz2=01;31:*.tz=01;31:*.deb=01;31:*.rpm=01;31:*.jar=01;31:*.war=01;31:*.ear=01;31:*.sar=01;31:*.rar=01;31:*.alz=01;31:*.ace=01;31:*.zoo=01;31:*.cpio=01;31:*.7z=01;31:*.rz=01;31:*.cab=01;31:*.jpg=01;35:*.jpeg=01;35:*.gif=01;35:*.bmp=01;35:*.pbm=01;35:*.pgm=01;35:*.ppm=01;35:*.tga=01;35:*.xbm=01;35:*.xpm=01;35:*.tif=01;35:*.tiff=01;35:*.png=01;35:*.svg=01;35:*.svgz=01;35:*.mng=01;35:*.pcx=01;35:*.mov=01;35:*.mpg=01;35:*.mpeg=01;35:*.m2v=01;35:*.mkv=01;35:*.webm=01;35:*.ogm=01;35:*.mp4=01;35:*.m4v=01;35:*.mp4v=01;35:*.vob=01;35:*.qt=01;35:*.nuv=01;35:*.wmv=01;35:*.asf=01;35:*.rm=01;35:*.rmvb=01;35:*.flc=01;35:*.avi=01;35:*.fli=01;35:*.flv=01;35:*.gl=01;35:*.dl=01;35:*.xcf=01;35:*.xwd=01;35:*.yuv=01;35:*.cgm=01;35:*.emf=01;35:*.axv=01;35:*.anx=01;35:*.ogv=01;35:*.ogx=01;35:*.aac=01;36:*.au=01;36:*.flac=01;36:*.mid=01;36:*.midi=01;36:*.mka=01;36:*.mp3=01;36:*.mpc=01;36:*.ogg=01;36:*.ra=01;36:*.wav=01;36:*.axa=01;36:*.oga=01;36:*.spx=01;36:*.xspf=01;36:</span><br><span class="line">MAIL=/var/spool/mail/root</span><br><span class="line">PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/root/bin</span><br><span class="line">PWD=/root/shell</span><br><span class="line">LANG=zh_CN.UTF-8</span><br><span class="line">SELINUX_LEVEL_REQUESTED=</span><br><span class="line">HISTCONTROL=ignoredups</span><br><span class="line">SHLVL=1</span><br><span class="line">HOME=/root</span><br><span class="line">LOGNAME=root</span><br><span class="line">XDG_DATA_DIRS=/root/.local/share/flatpak/exports/share:/var/lib/flatpak/exports/share:/usr/local/share:/usr/share</span><br><span class="line">SSH_CONNECTION=192.168.1.5 6921 192.168.1.130 22</span><br><span class="line">LESSOPEN=||/usr/bin/lesspipe.sh %s</span><br><span class="line">XDG_RUNTIME_DIR=/run/user/0</span><br><span class="line">DISPLAY=localhost:11.0</span><br><span class="line">_=/usr/bin/env</span><br><span class="line">OLDPWD=/root</span><br><span class="line">[root@root shell]# printenv</span><br><span class="line">XDG_SESSION_ID=84</span><br><span class="line">HOSTNAME=root</span><br><span class="line">...åŒä¸Šæ‰€è¿°</span><br><span class="line">[root@root shell]# printenv USER</span><br><span class="line">root</span><br><span class="line">[root@root shell]# echo $HOME</span><br><span class="line">/root</span><br><span class="line">[root@root shell]# ls $HOME</span><br><span class="line">anaconda-ks.cfg  initial-setup-ks.cfg  shell  å…¬å…±  æ¨¡æ¿  è§†é¢‘  å›¾ç‰‡  æ–‡æ¡£  ä¸‹è½½  éŸ³ä¹  æ¡Œé¢</span><br><span class="line">[root@root shell]#</span><br><span class="line">[root@root shell]# set</span><br><span class="line">ABRT_DEBUG_LOG=/dev/null</span><br><span class="line">BASH=/bin/bash</span><br><span class="line">BASHOPTS=checkwinsize:cmdhist:expand_aliases:extglob:extquote:force_fignore:histappend:interactive_comments:login_shell:progcomp:promptvars:sourcepath</span><br><span class="line">BASH_ALIASES=()</span><br><span class="line">BASH_ARGC=()</span><br><span class="line">BASH_ARGV=()</span><br><span class="line">......</span><br></pre></td></tr></table></figure>

<h3 id="è‡ªå®šä¹‰å˜é‡"><a href="#è‡ªå®šä¹‰å˜é‡" class="headerlink" title="è‡ªå®šä¹‰å˜é‡"></a>è‡ªå®šä¹‰å˜é‡</h3><p>å®šä¹‰å˜é‡ï¼šå˜é‡å&#x3D;å˜é‡å€¼ï¼Œ &#x3D; å‰åä¸èƒ½ä½¿ç”¨ç©ºæ ¼ã€‚</p>
<p>æ’¤é”€å˜é‡ï¼šunset å˜é‡åã€‚</p>
<p>å£°æ˜é™æ€å˜é‡ï¼šreadonly å˜é‡ï¼Œæ³¨æ„ï¼šä¸èƒ½ unsetã€‚</p>
<p><strong>è¯»å–å˜é‡ï¼š$å˜é‡åï¼Œ${ç‰¹æ®Šå˜é‡å}</strong></p>
<p>å˜é‡å®šä¹‰è§„åˆ™ ï¼š</p>
<ol>
<li>å˜é‡åç§°å¯ä»¥ç”±å­—æ¯ã€æ•°å­—å’Œä¸‹åˆ’çº¿ç»„æˆï¼Œä½†æ˜¯ä¸èƒ½ä»¥æ•°å­—å¼€å¤´ï¼Œç¯å¢ƒå˜é‡åå»ºè®®å¤§å†™ã€‚</li>
<li>ç­‰å·ä¸¤ä¾§ä¸èƒ½æœ‰ç©ºæ ¼ã€‚</li>
<li>åœ¨ bash ä¸­ï¼Œå˜é‡é»˜è®¤ç±»å‹éƒ½æ˜¯å­—ç¬¦ä¸²ç±»å‹ï¼Œæ— æ³•ç›´æ¥è¿›è¡Œæ•°å€¼è¿ç®—ã€‚</li>
<li>å˜é‡çš„å€¼å¦‚æœæœ‰ç©ºæ ¼ï¼Œéœ€è¦ä½¿ç”¨åŒå¼•å·æˆ–å•å¼•å·æ‹¬èµ·æ¥ã€‚</li>
</ol>
<p>æ³¨é‡Šè¯´æ˜ï¼š</p>
<p># å•è¡Œæ³¨é‡Š</p>
<p>:&gt;&gt;! å¤šè¡Œæ³¨é‡Š !</p>
<p>ç¤ºä¾‹ï¼šå˜é‡çš„èµ‹å€¼åŠä¿®æ”¹</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@root shell]# A=1</span><br><span class="line">[root@root shell]# echo $A</span><br><span class="line">1</span><br><span class="line">[root@root shell]# A=2</span><br><span class="line">[root@root shell]# echo $A</span><br><span class="line">2</span><br><span class="line">[root@root shell]# unset A</span><br><span class="line">[root@root shell]# echo $A</span><br><span class="line"></span><br><span class="line">[root@root shell]# readonly B=2</span><br><span class="line">[root@root shell]# echo $B</span><br><span class="line">2</span><br><span class="line">[root@root shell]# unset B</span><br><span class="line">-bash: unset: B: æ— æ³•åè®¾å®š: åªè¯» variable</span><br></pre></td></tr></table></figure>

<h3 id="æ³¨æ„äº‹é¡¹-x2F-x2F"><a href="#æ³¨æ„äº‹é¡¹-x2F-x2F" class="headerlink" title="æ³¨æ„äº‹é¡¹ $[ ]&#x2F;$( )&#x2F;$(( ))"></a>æ³¨æ„äº‹é¡¹ $[ ]&#x2F;$( )&#x2F;$(( ))</h3><p>åœ¨ bash ä¸­ï¼Œå˜é‡é»˜è®¤ç±»å‹éƒ½æ˜¯å­—ç¬¦ä¸²ç±»å‹ï¼Œæ— æ³•ç›´æ¥è¿›è¡Œæ•°å€¼è¿ç®—ã€‚</p>
<p><strong>å¦‚æœè¦å‚ä¸æ•°å€¼è¿ç®—ï¼š</strong></p>
<p>æ–¹å¼ä¸€ï¼š$((è¡¨è¾¾å¼))</p>
<p>æ–¹å¼äºŒï¼š$[è¡¨è¾¾å¼]</p>
<p><strong>å°†å‘½ä»¤çš„è¿”å›å€¼èµ‹å€¼ç»™å˜é‡</strong></p>
<p><strong>A&#x3D;<code>ls -la</code> å°†å‘½ä»¤çš„ç»“æœèµ‹å€¼è¿”å›ç»™å˜é‡A</strong></p>
<p><strong>A&#x3D;$(ls -la)ç­‰ä»·äºåå¼•å·</strong></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@root shell]# C=1+2</span><br><span class="line">[root@root shell]# echo $C</span><br><span class="line">1+2</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æ–¹å¼ä¸€</span></span><br><span class="line">[root@root shell]# C=$((1+2))</span><br><span class="line">[root@root shell]# echo $C</span><br><span class="line">3</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æ–¹å¼äºŒ</span></span><br><span class="line">[root@root shell]# C=$[1+2]</span><br><span class="line">[root@root shell]# echo $C</span><br><span class="line">3</span><br></pre></td></tr></table></figure>

<p>å˜é‡çš„å€¼å¦‚æœæœ‰ç©ºæ ¼ï¼Œéœ€è¦ä½¿ç”¨åŒå¼•å·æˆ–å•å¼•å·æ‹¬èµ·æ¥ã€‚</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@root shell]# D=Hello World</span><br><span class="line">bash: World: æœªæ‰¾åˆ°å‘½ä»¤...</span><br><span class="line">[root@root shell]# D=&#x27;Hello World&#x27;</span><br><span class="line">[root@root shell]# echo $D</span><br><span class="line">Hello World</span><br></pre></td></tr></table></figure>

<p>å¯æŠŠå˜é‡æå‡ä¸ºå…¨å±€ç¯å¢ƒå˜é‡ï¼Œå¯ä¾›å…¶ä»– Shell ç¨‹åºä½¿ç”¨ã€‚</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@root shell]# export D</span><br><span class="line">[root@root shell]# bash</span><br><span class="line">[root@root shell]# ps -f</span><br><span class="line">UID         PID   PPID  C STIME TTY          TIME CMD</span><br><span class="line">root       9873   9865  0 08:34 pts/4    00:00:00 -bash</span><br><span class="line">root      10819   9873  0 09:54 pts/4    00:00:00 bash</span><br><span class="line">root      10855  10819  0 09:54 pts/4    00:00:00 ps -f</span><br><span class="line">[root@root shell]# echo $D</span><br><span class="line">Hello World</span><br></pre></td></tr></table></figure>

<p>å­shellä¸ä¼šæ”¹å˜å…¨å±€å˜é‡ã€‚</p>
<p>ç¤ºä¾‹ï¼š(ä½¿ç”¨ â€œ.â€ &#x2F; sourceä¼šåœ¨å½“å‰ bash ä¸­æ‰§è¡Œï¼Œå°†å˜é‡å¯¼å‡ºåæ‰èƒ½åœ¨å­ shell ä¸­ä½¿ç”¨)</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@root shell]# E=&#x27;Hello Shell&#x27;</span><br><span class="line">[root@root shell]# vim helloworld.sh</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/bin/bash</span></span><br><span class="line">echo &#x27;Hello World&#x27;</span><br><span class="line">echo $E</span><br><span class="line">[root@root shell]# ./helloworld.sh</span><br><span class="line">Hello World</span><br><span class="line"></span><br><span class="line">[root@root shell]# . helloworld.sh</span><br><span class="line">Hello World</span><br><span class="line">Hello Shell</span><br><span class="line">[root@root shell]# export E</span><br><span class="line">[root@root shell]# ./helloworld.sh</span><br><span class="line">Hello World</span><br><span class="line">Hello Shell</span><br><span class="line">[root@root shell]#</span><br></pre></td></tr></table></figure>

<p><strong>å°†å‘½ä»¤çš„è¿”å›å€¼èµ‹å€¼ç»™å˜é‡</strong></p>
<p><strong>A&#x3D;<code>ls -la</code> å°†å‘½ä»¤çš„ç»“æœèµ‹å€¼è¿”å›ç»™å˜é‡A</strong></p>
<p><strong>A&#x3D;$(ls -la)ç­‰ä»·äºåå¼•å·</strong></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@localhost shell]# R=`ls -a /`</span><br><span class="line">[root@localhost shell]# echo $R</span><br><span class="line">. .. bin boot dev etc home lib lib64 media mnt opt proc root run sbin srv sys tmp usr var</span><br><span class="line">[root@localhost shell]# R=$(ls -a /)</span><br><span class="line">[root@localhost shell]# echo $R</span><br><span class="line">. .. bin boot dev etc home lib lib64 media mnt opt proc root run sbin srv sys tmp usr var</span><br><span class="line">[root@localhost shell]#</span><br></pre></td></tr></table></figure>

<h3 id="ç‰¹æ®Šå˜é‡"><a href="#ç‰¹æ®Šå˜é‡" class="headerlink" title="ç‰¹æ®Šå˜é‡"></a>ç‰¹æ®Šå˜é‡</h3><p>$PATHï¼šç¯å¢ƒå˜é‡</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@root shell]# helloworld.sh</span><br><span class="line">bash: helloworld.sh: æœªæ‰¾åˆ°å‘½ä»¤...</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">ä¸å»ºè®®ç›´æ¥æ‹·è´.shæ–‡ä»¶åˆ°/binç›®å½•</span></span><br><span class="line">[root@root shell]# cp helloworld.sh /bin/</span><br><span class="line">[root@root shell]# helloworld.sh</span><br><span class="line">Hello World</span><br><span class="line">Hello Shell</span><br><span class="line">[root@root shell]# rm -rf /bin/helloworld.sh</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">è¾“å‡ºç¯å¢ƒå˜é‡</span></span><br><span class="line">[root@root shell]# echo $PATH</span><br><span class="line">/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/root/bin</span><br></pre></td></tr></table></figure>

<h3 id="ä½ç½®å‚æ•°"><a href="#ä½ç½®å‚æ•°" class="headerlink" title="ä½ç½®å‚æ•°"></a>ä½ç½®å‚æ•°</h3><h4 id="n-ä½ç½®å‚æ•°"><a href="#n-ä½ç½®å‚æ•°" class="headerlink" title="$n  ä½ç½®å‚æ•°"></a>$n  ä½ç½®å‚æ•°</h4><p>â€‹		$n åŠŸèƒ½æè¿°ï¼šn ä¸ºæ•°å­—ï¼Œ$0 ä»£è¡¨è¯¥è„šæœ¬åç§°ï¼Œ$1-$9 ä»£è¡¨ç¬¬ä¸€åˆ°ç¬¬ä¹ä¸ªå‚æ•°ï¼Œåä»¥ä¸Šçš„å‚æ•°ï¼Œåä»¥ä¸Šçš„å‚æ•°éœ€è¦ç”¨å¤§æ‹¬å·åŒ…å«ï¼Œå¦‚${10}ã€‚</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@root shell]# vim parameter.sh</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/bin/bash</span></span><br><span class="line">echo &#x27;====ä½ç½®å‚æ•°====&#x27;</span><br><span class="line">echo $0</span><br><span class="line">echo $1</span><br><span class="line">echo $2</span><br><span class="line">[root@root shell]# chmod +x parameter.sh</span><br><span class="line">[root@root shell]# ./parameter.sh p1 p2</span><br><span class="line">====ä½ç½®å‚æ•°====</span><br><span class="line">parameter.sh</span><br><span class="line">p1</span><br><span class="line">p2</span><br></pre></td></tr></table></figure>

<h4 id="å‚æ•°ä¸ªæ•°"><a href="#å‚æ•°ä¸ªæ•°" class="headerlink" title="$#  å‚æ•°ä¸ªæ•°"></a>$#  å‚æ•°ä¸ªæ•°</h4><p>â€‹		$#  	åŠŸèƒ½æè¿°ï¼šè·å–æ‰€æœ‰è¾“å…¥å‚æ•°ä¸ªæ•°ï¼Œå¸¸ç”¨äºå¾ªç¯ï¼Œåˆ¤æ–­å‚æ•°çš„ä¸ªæ•°æ˜¯å¦æ­£ç¡®ã€‚</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@root shell]# vim parameter.sh</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/bin/bash</span></span><br><span class="line">echo &#x27;====ä½ç½®å‚æ•°====&#x27;</span><br><span class="line">echo $1</span><br><span class="line">echo $2</span><br><span class="line">echo &#x27;====å‚æ•°ä¸ªæ•°====&#x27;</span><br><span class="line">echo $#</span><br><span class="line">[root@root shell]# ./parameter.sh a b c</span><br><span class="line">====ä½ç½®å‚æ•°====</span><br><span class="line">a</span><br><span class="line">b</span><br><span class="line">====å‚æ•°ä¸ªæ•°====</span><br><span class="line">3</span><br></pre></td></tr></table></figure>

<h4 id="ä¸-å…·ä½“å‚æ•°"><a href="#ä¸-å…·ä½“å‚æ•°" class="headerlink" title="$* ä¸ $@  å…·ä½“å‚æ•°"></a>$* ä¸ $@  å…·ä½“å‚æ•°</h4><p>â€‹		$* ï¼ˆåŠŸèƒ½æè¿°ï¼šè¿™ä¸ªå˜é‡ä»£è¡¨å‘½ä»¤è¡Œä¸­æ‰€æœ‰çš„å‚æ•°ï¼Œ$* æŠŠæ‰€æœ‰çš„å‚æ•°çœ‹æˆä¸€ä¸ªæ•´ä½“ï¼‰</p>
<p>â€‹		$@ ï¼ˆåŠŸèƒ½æè¿°ï¼šè¿™ä¸ªå˜é‡ä¹Ÿä»£è¡¨å‘½ä»¤è¡Œä¸­æ‰€æœ‰çš„å‚æ•°ï¼Œä¸è¿‡ $@ æŠŠæ¯ä¸ªå‚æ•°åŒºåˆ†å¯¹å¾…ï¼‰</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@root shell]# vim parameter.sh</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/bin/bash</span></span><br><span class="line">echo &quot;ä½ç½®å˜é‡ï¼š&quot;</span><br><span class="line">echo $1</span><br><span class="line">echo $2</span><br><span class="line">echo &quot;å‚æ•°ä¸ªæ•°ï¼š&quot;</span><br><span class="line">echo $#</span><br><span class="line">echo &#x27;å˜é‡$*ï¼š&#x27;</span><br><span class="line">echo $*</span><br><span class="line">echo &#x27;å˜é‡$@ï¼š&#x27;</span><br><span class="line">echo $@</span><br><span class="line">[root@root shell]# ./parameter.sh a b c</span><br><span class="line">ä½ç½®å˜é‡ï¼š</span><br><span class="line">a</span><br><span class="line">b</span><br><span class="line">å‚æ•°ä¸ªæ•°ï¼š</span><br><span class="line">3</span><br><span class="line">å˜é‡$*ï¼š</span><br><span class="line">a b c</span><br><span class="line">å˜é‡$@ï¼š</span><br><span class="line">a b c</span><br></pre></td></tr></table></figure>

<h3 id="é¢„å®šä¹‰å˜é‡"><a href="#é¢„å®šä¹‰å˜é‡" class="headerlink" title="é¢„å®šä¹‰å˜é‡"></a>é¢„å®šä¹‰å˜é‡</h3><p>â€‹		shell äº‹å…ˆå·²ç»å®šä¹‰å¥½çš„å˜é‡ï¼Œå¯ä»¥ç›´æ¥åœ¨shellè„šæœ¬ä¸­ä½¿ç”¨ã€‚</p>
<table>
<thead>
<tr>
<th align="center"><strong>$$</strong></th>
<th><strong>å½“å‰è¿›ç¨‹çš„è¿›ç¨‹å·(PID)</strong></th>
</tr>
</thead>
<tbody><tr>
<td align="center"><strong>$!</strong></td>
<td>åå°è¿è¡Œçš„æœ€åä¸€ä¸ªè¿›ç¨‹çš„è¿›ç¨‹å·(PID)</td>
</tr>
<tr>
<td align="center"><strong>$?</strong></td>
<td>æœ€åä¸€æ¬¡æ‰§è¡Œçš„å‘½ä»¤çš„è¿”å›çŠ¶æ€ã€‚å¦‚æœè¿™ä¸ªå˜é‡çš„å€¼ä¸º0ï¼Œè¯æ˜ä¸Šä¸€ä¸ªå‘½ä»¤æ­£ç¡®æ‰§è¡Œï¼›å¦‚æœè¿™ä¸ªå˜é‡çš„å€¼ä¸ºé0 (å…·ä½“æ˜¯å“ªä¸ªæ•°ï¼Œç”±å‘½ä»¤è‡ªå·±æ¥å†³å®š)ï¼Œåˆ™è¯æ˜ä¸Šä¸€ä¸ªå‘½ä»¤æ‰§è¡Œä¸æ­£ç¡®äº†ã€‚</td>
</tr>
</tbody></table>
<p><strong>$?  å‘½ä»¤çŠ¶æ€</strong></p>
<p>â€‹		$ï¼Ÿ ï¼ˆåŠŸèƒ½æè¿°ï¼šæœ€åä¸€æ¬¡æ‰§è¡Œçš„å‘½ä»¤çš„è¿”å›çŠ¶æ€ã€‚å¦‚æœè¿™ä¸ªå˜é‡çš„å€¼ä¸º0ï¼Œè¯æ˜ä¸Šä¸€ä¸ªå‘½ä»¤æ­£ç¡®æ‰§è¡Œï¼›å¦‚æœè¿™ä¸ªå˜é‡çš„å€¼ä¸ºé 0ï¼ˆå…·ä½“æ˜¯å“ªä¸ªæ•°ï¼Œç”±å‘½ä»¤è‡ªå·±æ¥å†³å®šï¼‰ï¼Œåˆ™ä¸Šä¸€ä¸ªå‘½ä»¤æ‰§è¡Œé”™è¯¯ï¼‰ã€‚</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@root shell]# echo $?</span><br><span class="line">0</span><br><span class="line">[root@root shell]# parameter.sh</span><br><span class="line">bash: parameter.sh: æœªæ‰¾åˆ°å‘½ä»¤...</span><br><span class="line">[root@root shell]# echo $?</span><br><span class="line">127</span><br></pre></td></tr></table></figure>

<h2 id="è¿ç®—ç¬¦"><a href="#è¿ç®—ç¬¦" class="headerlink" title="è¿ç®—ç¬¦"></a>è¿ç®—ç¬¦</h2><p>åŸºæœ¬è¯­æ³•ï¼š</p>
<p>æ–¹å¼ä¸€ï¼šexpr å‚æ•°1ï¼Œå‚æ•°2ï¼Œâ€¦â€¦ã€ä¸æ¨èã€‘</p>
<p>expr ä¼šå°†åé¢çš„å†…å®¹å½“ä½œå‚æ•°ï¼Œæ³¨æ„ï¼šéœ€è¦ä½¿ç”¨ç©ºæ ¼åˆ†å¼€</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@root shell]# expr 1+2</span><br><span class="line">1+2</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">ä¼ å…¥ä¸‰ä¸ªå‚æ•°, 1,+,2</span></span><br><span class="line">[root@root shell]# expr 1 + 2</span><br><span class="line">3</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">* è¡¨ç¤ºé€šé…ç¬¦ï¼Œéœ€è¦è¿›è¡Œè½¬ä¹‰</span></span><br><span class="line">[root@root shell]# expr 1 * 2</span><br><span class="line">expr: è¯­æ³•é”™è¯¯</span><br><span class="line">[root@root shell]# expr 1 \* 2</span><br><span class="line">2</span><br></pre></td></tr></table></figure>

<p>æ–¹å¼äºŒï¼š$((è¿ç®—å¼)) æˆ– $[è¿ç®—å¼]</p>
<p>ç¤ºä¾‹ï¼šè®¡ç®—ï¼ˆ2+3ï¼‰* 4 çš„å€¼</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@root shell]# echo $(((2+3)*4))</span><br><span class="line">20</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æ¨èä½¿ç”¨</span></span><br><span class="line">[root@root shell]# echo $[(2+3)*4]</span><br><span class="line">20</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">ç©ºæ ¼ä¸å½±å“</span></span><br><span class="line">[root@root shell]# A=$[ ( 2 + 3 ) * 4]</span><br><span class="line">[root@root shell]# echo $A</span><br><span class="line">20</span><br></pre></td></tr></table></figure>

<p>æ–¹å¼ä¸‰ï¼šä½¿ç”¨å˜é‡æ¥æ”¶ expr å‘½ä»¤çš„å€¼ï¼š<strong>ï¼ˆå‘½ä»¤æ›¿æ¢ï¼‰</strong></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@root shell]# B=&quot;expr 1 + 2&quot;</span><br><span class="line">[root@root shell]# echo $B</span><br><span class="line">expr 1 + 2</span><br><span class="line">[root@root shell]# B=$(expr 1 \* 2)</span><br><span class="line">[root@root shell]# echo $B</span><br><span class="line">2</span><br><span class="line">[root@root shell]# B=`expr 2 \* 3`</span><br><span class="line">[root@root shell]# echo $B</span><br><span class="line">6</span><br><span class="line">[root@localhost shell]# R=$(ls -a /)</span><br><span class="line">[root@localhost shell]# echo $R</span><br><span class="line">. .. bin boot dev etc home lib lib64 media mnt opt proc root run sbin srv sys tmp usr var</span><br></pre></td></tr></table></figure>

<p>ç¤ºä¾‹ï¼šç¼–å†™add.shï¼Œè¾“å‡ºä¸¤æ•°ä¹‹å’Œã€‚</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@root shell]# vim add.sh</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/bin/bash</span></span><br><span class="line">sum=$[$1+$2]</span><br><span class="line">echo sum=$sum</span><br><span class="line">[root@root shell]# chmod +x add.sh</span><br><span class="line">[root@root shell]# ./add.sh 2 3</span><br><span class="line">sum=5</span><br></pre></td></tr></table></figure>

<h2 id="æ¡ä»¶åˆ¤æ–­"><a href="#æ¡ä»¶åˆ¤æ–­" class="headerlink" title="æ¡ä»¶åˆ¤æ–­"></a>æ¡ä»¶åˆ¤æ–­</h2><h3 id="åŸºæœ¬è¯­æ³•"><a href="#åŸºæœ¬è¯­æ³•" class="headerlink" title="åŸºæœ¬è¯­æ³•"></a>åŸºæœ¬è¯­æ³•</h3><p>æ–¹å¼ä¸€ï¼štest conditionï¼ˆå¦‚æœconditionæœ‰å€¼åˆ™ä¸ºtrueï¼‰</p>
<p>æ–¹å¼äºŒï¼š[ condition ]ï¼ˆæ³¨æ„ condition å‰åè¦æœ‰ç©ºæ ¼ï¼Œ<strong>æ¡ä»¶éç©ºå³ä¸ºtrueï¼Œå¦åˆ™ä¸ºfalse</strong>)</p>
<p>â€‹				éç©ºè¿”å›trueï¼Œå¯ä»¥ä½¿ç”¨ $? è¿›è¡ŒéªŒè¯ï¼Œ0 ä¸º trueï¼Œ1 ä¸º falseã€‚</p>
<p>â€‹				[ condition ]&amp;&amp;echo ok||echo notok æ¡ä»¶æ»¡è¶³ï¼Œæ‰§è¡Œåé¢çš„è¯­å¥ã€‚</p>
<p>ä½¿ç”¨ [ condition ] æ›¿æ¢ test condition</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@root shell]# a=hello</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">å¦‚æœ=å‰åæ²¡æœ‰ç©ºæ ¼ï¼Œå°±ä¼šè¢«å½“ä½œä¸€ä¸ªæ•´ä½“ï¼Œä¼šè¿”å›<span class="literal">true</span></span></span><br><span class="line">[root@root shell]# test $a=hello</span><br><span class="line">[root@root shell]# echo $?</span><br><span class="line">0</span><br><span class="line">[root@root shell]# test $a=Hello</span><br><span class="line">[root@root shell]# echo $?</span><br><span class="line">0</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">= å‰åå¿…é¡»æœ‰ç©ºæ ¼</span></span><br><span class="line">[root@root shell]# test $a = Hello</span><br><span class="line">[root@root shell]# echo $?</span><br><span class="line">1</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">ä½¿ç”¨ [ condition ] ä»£æ›¿<span class="built_in">test</span> condition</span></span><br><span class="line">[root@root shell]# [ $a = abc ]</span><br><span class="line">[root@root shell]# echo $?</span><br><span class="line">1</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">å¿…é¡»æœ‰ç©ºæ ¼ï¼Œ<span class="variable">$a</span>=helloè¢«å½“ä½œä¸€ä¸ªå­—ç¬¦ä¸²äº†</span></span><br><span class="line">[root@root shell]# [ $a=abc ]</span><br><span class="line">[root@root shell]# echo $?</span><br><span class="line">0</span><br><span class="line">[root@root shell]# [ abcd ]</span><br><span class="line">[root@root shell]# echo $?</span><br><span class="line">0</span><br><span class="line">[root@root shell]# [  ]</span><br><span class="line">[root@root shell]# echo $?</span><br><span class="line">1</span><br></pre></td></tr></table></figure>

<h3 id="å¸¸ç”¨åˆ¤æ–­æ¡ä»¶"><a href="#å¸¸ç”¨åˆ¤æ–­æ¡ä»¶" class="headerlink" title="å¸¸ç”¨åˆ¤æ–­æ¡ä»¶"></a>å¸¸ç”¨åˆ¤æ–­æ¡ä»¶</h3><p>ï¼ˆ1ï¼‰ä¸¤ä¸ªæ•´æ•°ä¹‹é—´æ¯”è¾ƒ </p>
<p>â€‹	æ³¨æ„ï¼šä½¿ç”¨ &gt; ä¼šé‡å®šå‘ï¼Œä½†åœ¨ for å¾ªç¯è¯­å¥ä¸­ä¸ä¼šï¼Œå¯ä»¥ä½¿ç”¨</p>
<ul>
<li>-eq ç­‰äºï¼ˆequalï¼‰ </li>
<li>-ne ä¸ç­‰äºï¼ˆnot equalï¼‰ </li>
<li>-lt å°äºï¼ˆless thanï¼‰ </li>
<li>-le å°äºç­‰äºï¼ˆless equalï¼‰</li>
<li>-gt å¤§äºï¼ˆgreater thanï¼‰</li>
<li>-ge å¤§äºç­‰äºï¼ˆgreater equalï¼‰</li>
</ul>
<p>æ³¨æ„ï¼šå¦‚æœæ˜¯å­—ç¬¦ä¸²ä¹‹é—´çš„æ¯”è¾ƒ ï¼Œç”¨ç­‰å· â€œ&#x3D;â€ åˆ¤æ–­ç›¸ç­‰ï¼›ç”¨ â€œ!&#x3D;â€ åˆ¤æ–­ä¸ç­‰äº</p>
<p>ï¼ˆ2ï¼‰æŒ‰ç…§æ–‡ä»¶æƒé™è¿›è¡Œåˆ¤æ–­</p>
<ul>
<li>-r   æœ‰è¯»çš„æƒé™ï¼ˆreadï¼‰</li>
<li>-w  æœ‰å†™çš„æƒé™ï¼ˆwriteï¼‰</li>
<li>-x  æœ‰æ‰§è¡Œçš„æƒé™ï¼ˆexecuteï¼‰</li>
</ul>
<p>ï¼ˆ3ï¼‰æŒ‰ç…§æ–‡ä»¶ç±»å‹è¿›è¡Œåˆ¤æ–­ </p>
<ul>
<li><p>-e  æ–‡ä»¶å­˜åœ¨ï¼ˆexistenceï¼‰</p>
</li>
<li><p>-f  æ–‡ä»¶å­˜åœ¨å¹¶ä¸”æ˜¯ä¸€ä¸ªå¸¸è§„çš„æ–‡ä»¶ï¼ˆfileï¼‰ </p>
</li>
<li><p>-d  æ–‡ä»¶å­˜åœ¨å¹¶ä¸”æ˜¯ä¸€ä¸ªç›®å½•ï¼ˆdirectoryï¼‰</p>
<p> (4) å¤šæ¡ä»¶åˆ¤æ–­</p>
</li>
</ul>
<p>â€‹		&amp;&amp; è¡¨ç¤ºå‰ä¸€æ¡å‘½ä»¤æ‰§è¡ŒæˆåŠŸæ—¶ï¼Œæ‰æ‰§è¡Œåä¸€æ¡å‘½ä»¤ï¼Œ|| è¡¨ç¤ºä¸Šä¸€æ¡å‘½ä»¤æ‰§è¡Œå¤±è´¥åï¼Œæ‰æ‰§è¡Œä¸‹ä¸€æ¡å‘½ä»¤</p>
<p>ç¤ºä¾‹ä¸€ï¼šåˆ¤æ–­æ•´æ•°å¤§å°å…³ç³»</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@root shell]# [ 2 = 3 ]</span><br><span class="line">[root@root shell]# echo $?</span><br><span class="line">1</span><br><span class="line">[root@root shell]# [ 2 = 2 ]</span><br><span class="line">[root@root shell]# echo $?</span><br><span class="line">0</span><br><span class="line">[root@root shell]# A=hello</span><br><span class="line">[root@root shell]# [ $A = abc ]</span><br><span class="line">[root@root shell]# echo $?</span><br><span class="line">1</span><br><span class="line">[root@root shell]# [ $A=abc ]</span><br><span class="line">[root@root shell]# echo $?</span><br><span class="line">0</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">2 ä¼šè¾“å‡ºé‡å®šå‘åˆ°æ–‡ä»¶ 3 ä¸­</span></span><br><span class="line">[root@root shell]# [ 2  &gt;  3 ]</span><br><span class="line">[root@root shell]# ll</span><br><span class="line">æ€»ç”¨é‡ 12</span><br><span class="line">-rw-r--r--. 1 root root   0 4æœˆ  24 11:25 3</span><br><span class="line">-rwxr-xr-x. 1 root root  39 4æœˆ  24 10:59 add.sh</span><br><span class="line">-rwxr-xr-x. 1 root root  39 4æœˆ  24 09:59 helloworld.sh</span><br><span class="line">-rwxr-xr-x. 1 root root 161 4æœˆ  24 10:37 parameter.sh</span><br><span class="line">[root@root shell]# [ 2  &lt;  3 ]</span><br><span class="line">[root@root shell]# [ 2 -lt 3 ]</span><br><span class="line">[root@root shell]# echo $?</span><br><span class="line">0</span><br><span class="line">[root@root shell]#</span><br></pre></td></tr></table></figure>

<p>ç¤ºä¾‹äºŒï¼šåˆ¤æ–­æ–‡ä»¶æƒé™</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@root shell]# touch test</span><br><span class="line">[root@root shell]# [ -x test ]</span><br><span class="line">[root@root shell]# echo $?</span><br><span class="line">1</span><br><span class="line">[root@root shell]# [ -x helloworld.sh ]</span><br><span class="line">[root@root shell]# echo $?</span><br><span class="line">0</span><br></pre></td></tr></table></figure>

<p>ç¤ºä¾‹ä¸‰ï¼šåˆ¤æ–­æ–‡ä»¶ç±»å‹</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@root shell]# [ -d test ]</span><br><span class="line">[root@root shell]# echo $?</span><br><span class="line">1</span><br><span class="line">[root@root shell]# [ -f test ]</span><br><span class="line">[root@root shell]# echo $?</span><br><span class="line">0</span><br><span class="line">[root@root shell]#</span><br></pre></td></tr></table></figure>

<p>ç¤ºä¾‹å››ï¼šå¤šæ¡ä»¶åˆ¤æ–­ï¼ˆ&amp;&amp; è¡¨ç¤ºå‰ä¸€æ¡å‘½ä»¤æ‰§è¡ŒæˆåŠŸæ—¶ï¼Œæ‰æ‰§è¡Œåä¸€æ¡å‘½ä»¤ï¼Œ|| è¡¨ç¤ºä¸Šä¸€æ¡å‘½ä»¤æ‰§è¡Œå¤±è´¥åï¼Œæ‰æ‰§è¡Œä¸‹ä¸€æ¡å‘½ä»¤ï¼‰</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@root shell]# [ condition ] &amp;&amp; echo ok ||echo error</span><br><span class="line">ok</span><br><span class="line">[root@root shell]# [  ] &amp;&amp; echo ok ||echo error</span><br><span class="line">error</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">ç¤ºä¾‹2</span></span><br><span class="line">[root@root shell]# A=18</span><br><span class="line">[root@root shell]# [ $A -le 20 ] &amp;&amp; echo &quot;$A &lt;= 20&quot; || echo &quot;$A &gt;= 20&quot;</span><br><span class="line">18 &lt;= 20</span><br><span class="line">[root@root shell]# A=25</span><br><span class="line">[root@root shell]# [ $A -le 20 ] &amp;&amp; echo &quot;$A &lt;= 20&quot; || echo &quot;$A &gt;= 20&quot;</span><br><span class="line">25 &gt;= 20</span><br></pre></td></tr></table></figure>

<h2 id="æµç¨‹æ§åˆ¶"><a href="#æµç¨‹æ§åˆ¶" class="headerlink" title="æµç¨‹æ§åˆ¶"></a>æµç¨‹æ§åˆ¶</h2><h3 id="if-åˆ¤æ–­"><a href="#if-åˆ¤æ–­" class="headerlink" title="if åˆ¤æ–­"></a>if åˆ¤æ–­</h3><p>ï¼ˆ1ï¼‰å•åˆ†æ”¯</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">;è¡¨ç¤ºè¯­å¥åœ¨ä¸€è¡Œ,å¦‚<span class="built_in">cd</span> /etc;<span class="built_in">ls</span></span></span><br><span class="line">if [ æ¡ä»¶ ];then</span><br><span class="line">	ç¨‹åº</span><br><span class="line">fi</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">if [ æ¡ä»¶ ]</span><br><span class="line">then</span><br><span class="line">	ç¨‹åº</span><br><span class="line">fi</span><br></pre></td></tr></table></figure>

<p>ï¼ˆ2ï¼‰å¤šåˆ†æ”¯	</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">if [ æ¡ä»¶åˆ¤æ–­å¼ ]</span><br><span class="line">then</span><br><span class="line">	ç¨‹åº</span><br><span class="line">elif [ æ¡ä»¶ ]</span><br><span class="line">then</span><br><span class="line">	ç¨‹åº</span><br><span class="line">else</span><br><span class="line">	ç¨‹åº</span><br><span class="line">fi</span><br></pre></td></tr></table></figure>

<p>æ³¨æ„äº‹é¡¹ï¼š</p>
<p> â‘  [ æ¡ä»¶åˆ¤æ–­å¼ ]ï¼Œä¸­æ‹¬å·å’Œæ¡ä»¶åˆ¤æ–­å¼ä¹‹é—´å¿…é¡»æœ‰ç©ºæ ¼</p>
<p> â‘¡ if åè¦æœ‰ç©ºæ ¼</p>
<p>â€‹	å¯ä»¥ä½¿ç”¨ exit é€€å‡ºåˆ¤æ–­</p>
<p>ç¤ºä¾‹ï¼šæ ¹æ®è¾“å‡ºçš„æ•°åˆ¤æ–­å¤§å°</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@root shell]# vim if.sh</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/bin/bash</span></span><br><span class="line">if [ $1 -eq 2 ];then</span><br><span class="line">        echo &quot;$1 ç­‰äº 2&quot;</span><br><span class="line">elif [ $1 -lt 2 ]</span><br><span class="line">then</span><br><span class="line">        echo &quot;$1 å°äº 2&quot;</span><br><span class="line">else</span><br><span class="line">        echo &quot;$1 å¤§äº 2&quot;</span><br><span class="line">fi</span><br><span class="line">[root@root shell]# chmod +x if.sh</span><br><span class="line">[root@root shell]# ./if.sh 3</span><br><span class="line">3 å¤§äº 2</span><br><span class="line">[root@root shell]# ./if.sh 1</span><br><span class="line">1 å°äº 2</span><br><span class="line">[root@root shell]# ./if.sh 2</span><br><span class="line">2 ç­‰äº 2</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">å¦‚æœä¸ä¼ é€’å‚æ•°</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/bin/bash</span></span><br><span class="line">if [ &quot;$1&quot;x -eq &quot;2&quot;x ];then</span><br><span class="line">        echo &quot;$1 ç­‰äº 2&quot;</span><br><span class="line">fi</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">ä¹Ÿå¯ä»¥å†™åœ¨ä¸€è¡Œ</span></span><br><span class="line">[root@root shell]# a=19</span><br><span class="line">[root@root shell]# if [ $a -ge 18 ] &amp;&amp; [ $a -le 20 ];then echo ok;fi</span><br><span class="line">ok</span><br><span class="line">[root@root shell]# a=21</span><br><span class="line">[root@root shell]# if [ $a -ge 18 ] &amp;&amp; [ $a -le 20 ];then echo ok;fi</span><br><span class="line">[root@root shell]</span><br></pre></td></tr></table></figure>

<h3 id="case-è¯­å¥"><a href="#case-è¯­å¥" class="headerlink" title="case è¯­å¥"></a>case è¯­å¥</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">case $å˜é‡å in</span><br><span class="line">&quot;å€¼ 1&quot;ï¼‰</span><br><span class="line">	å¦‚æœå˜é‡çš„å€¼ç­‰äºå€¼ 1ï¼Œåˆ™æ‰§è¡Œç¨‹åº 1,å¯¹äºæ•°å­—å¯ä»¥çœç•¥å¼•å·</span><br><span class="line">;;</span><br><span class="line">&quot;å€¼ 2&quot;ï¼‰</span><br><span class="line">	å¦‚æœå˜é‡çš„å€¼ç­‰äºå€¼ 2ï¼Œåˆ™æ‰§è¡Œç¨‹åº 2</span><br><span class="line">;;</span><br><span class="line">	......å…¶ä»–åˆ†æ”¯......</span><br><span class="line">*ï¼‰</span><br><span class="line">	å¦‚æœå˜é‡çš„å€¼éƒ½ä¸æ˜¯ä»¥ä¸Šçš„å€¼ï¼Œåˆ™æ‰§è¡Œæ­¤ç¨‹åº</span><br><span class="line">;;</span><br><span class="line">esac</span><br></pre></td></tr></table></figure>

<p>æ³¨æ„äº‹é¡¹ï¼š</p>
<p>ï¼ˆ1ï¼‰case è¡Œå°¾å¿…é¡»ä¸ºå•è¯ â€œinâ€ï¼Œæ¯ä¸€ä¸ªæ¨¡å¼åŒ¹é…å¿…é¡»ä»¥å³æ‹¬å· â€œ)â€ ç»“æŸã€‚</p>
<p>ï¼ˆ2ï¼‰åŒåˆ†å· â€œ;;â€ è¡¨ç¤ºå‘½ä»¤åºåˆ—ç»“æŸï¼Œç›¸å½“äº java ä¸­çš„ breakã€‚</p>
<p>ï¼ˆ3ï¼‰æœ€åçš„ â€œ*)â€ è¡¨ç¤ºé»˜è®¤æ¨¡å¼ï¼Œç›¸å½“äº java ä¸­çš„ defaultã€‚</p>
<p>ç¤ºä¾‹ï¼šè¾“å…¥ä¸€ä¸ªæ•°è¿›è¡Œåˆ¤æ–­</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@root etc]# vim case.sh</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/bin/bash</span></span><br><span class="line">case $1 in</span><br><span class="line">&quot;1&quot;)</span><br><span class="line">        echo ok</span><br><span class="line">;;</span><br><span class="line">&quot;2&quot;)</span><br><span class="line">        echo warning</span><br><span class="line">;;</span><br><span class="line">*)</span><br><span class="line">        echo error</span><br><span class="line">esac</span><br><span class="line">[root@root etc]# chmod +x case.sh</span><br><span class="line">[root@root etc]# ./case.sh 1</span><br><span class="line">ok</span><br><span class="line">[root@root etc]# ./case.sh 2</span><br><span class="line">warning</span><br><span class="line">[root@root etc]# ./case.sh 3</span><br><span class="line">error</span><br><span class="line">[root@root etc]#</span><br></pre></td></tr></table></figure>

<h3 id="forå¾ªç¯"><a href="#forå¾ªç¯" class="headerlink" title="forå¾ªç¯"></a>forå¾ªç¯</h3><p>è¯­æ³•ä¸€ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">for (( åˆå§‹å€¼;å¾ªç¯æ§åˆ¶æ¡ä»¶;å˜é‡å˜åŒ– ))</span><br><span class="line">do</span><br><span class="line">ç¨‹åº</span><br><span class="line">done</span><br></pre></td></tr></table></figure>

<p>è¯­æ³•äºŒï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">for å˜é‡ in å€¼ 1 å€¼ 2 å€¼ 3â€¦</span><br><span class="line">do</span><br><span class="line">ç¨‹åº</span><br><span class="line">done</span><br></pre></td></tr></table></figure>

<p>{1..100}è¡¨ç¤ºåºåˆ—</p>
<p>ç¤ºä¾‹ï¼š1+2+â€¦â€¦+100</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@root shell]# vim for01.sh</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/bin/bash</span></span><br><span class="line">sum=0</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æ­¤å¤„ä½¿ç”¨(())ï¼Œå¯ä»¥ä½¿ç”¨&lt;==,&lt;ï¼Œä¸æ˜¯é‡å®šå‘</span></span><br><span class="line">for((i=0;i&lt;=100;i++))</span><br><span class="line">do</span><br><span class="line">        sum=$[$sum+$i]</span><br><span class="line">done</span><br><span class="line">echo $sum</span><br><span class="line">[root@root shell]# chmod +x for01.sh</span><br><span class="line">[root@root shell]# ./for01.sh</span><br><span class="line">5050</span><br></pre></td></tr></table></figure>

<p>ç¤ºä¾‹ï¼šç»“åˆ$*ï¼Œ$@ä½¿ç”¨ï¼Œå¦‚æœä¸åŠ å¼•å·ï¼Œåˆ™æ§åˆ¶å°è¾“å‡ºæ²¡æœ‰åŒºåˆ«ã€‚</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">&#123;1..100&#125;è¡¨ç¤ºåºåˆ—</span></span><br><span class="line">[root@root shell]# for i in &#123;1..100&#125;;do sum=$[$sum+$i];done;echo $sum;</span><br><span class="line">5050</span><br><span class="line">[root@root shell]# vim for02.sh</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/bin/bash</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">$*å’Œ<span class="variable">$@</span>éƒ½è¡¨ç¤ºä¼ é€’ç»™å‡½æ•°æˆ–è„šæœ¬çš„æ‰€æœ‰å‚æ•°ï¼Œä¸è¢«åŒå¼•å· <span class="string">&quot;&quot;</span> åŒ…å«æ—¶ï¼Œéƒ½ä»¥<span class="variable">$1</span> <span class="variable">$2</span> â€¦<span class="variable">$n</span>çš„å½¢å¼è¾“å‡ºæ‰€æœ‰å‚æ•°</span></span><br><span class="line">echo &quot;======ä¸ä½¿ç”¨å¼•å·========&quot;</span><br><span class="line">echo &#x27;$*: &#x27;</span><br><span class="line">for para in $*</span><br><span class="line">do</span><br><span class="line">        echo $para</span><br><span class="line">done</span><br><span class="line"></span><br><span class="line">echo &#x27;$@: &#x27;</span><br><span class="line">for para in $@</span><br><span class="line">do</span><br><span class="line">        echo $para</span><br><span class="line">done</span><br><span class="line"></span><br><span class="line">echo &quot;======ä½¿ç”¨å¼•å·========&quot;</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æ·»åŠ å¼•å·</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">å½“å®ƒä»¬è¢«åŒå¼•å· <span class="string">&quot;&quot;</span> åŒ…å«æ—¶ï¼Œ$*ä¼šå°†æ‰€æœ‰çš„å‚æ•°ä½œä¸ºä¸€ä¸ªæ•´ä½“ï¼Œä»¥ <span class="string">&quot;<span class="variable">$1</span> <span class="variable">$2</span>...<span class="variable">$n</span>&quot;</span> çš„å½¢å¼è¾“å‡ºæ‰€æœ‰å‚æ•°ï¼›<span class="variable">$@</span>ä¼šå°†å„ä¸ªå‚æ•°åˆ†å¼€ï¼Œä»¥<span class="string">&quot;<span class="variable">$1</span>&quot;</span> <span class="string">&quot;<span class="variable">$2</span>&quot;</span>...<span class="string">&quot;<span class="variable">$n</span>&quot;</span>çš„å½¢å¼è¾“å‡ºæ‰€æœ‰å‚æ•°ã€‚</span></span><br><span class="line">echo &#x27;$*: &#x27;</span><br><span class="line">for para in &quot;$*&quot;</span><br><span class="line">do</span><br><span class="line">        echo $para</span><br><span class="line">done</span><br><span class="line"></span><br><span class="line">echo &#x27;$@: &#x27;</span><br><span class="line">for para in &quot;$@&quot;</span><br><span class="line">do</span><br><span class="line">        echo $para</span><br><span class="line">done</span><br><span class="line">[root@root shell]# chmod 777 for02.sh</span><br><span class="line">[root@root shell]# ./for02.sh a b c</span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">*:</span></span><br><span class="line">a</span><br><span class="line">b</span><br><span class="line">c</span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">@:</span></span><br><span class="line">a</span><br><span class="line">b</span><br><span class="line">c</span><br><span class="line">======ä½¿ç”¨å¼•å·======</span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">*:</span></span><br><span class="line">a b c</span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">@:</span></span><br><span class="line">a</span><br><span class="line">b</span><br><span class="line">c</span><br></pre></td></tr></table></figure>

<h3 id="whileå¾ªç¯"><a href="#whileå¾ªç¯" class="headerlink" title="whileå¾ªç¯"></a>whileå¾ªç¯</h3><p>åŸºæœ¬è¯­æ³•</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">while [ æ¡ä»¶åˆ¤æ–­å¼ ]</span><br><span class="line">do</span><br><span class="line">ç¨‹åº</span><br><span class="line">done</span><br></pre></td></tr></table></figure>

<p>ç¤ºä¾‹ï¼š1+2+â€¦â€¦+100</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@root shell]# vim while.sh</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/bin/bash</span></span><br><span class="line">sum=0</span><br><span class="line">count=1</span><br><span class="line">while [ $count -le 100 ]</span><br><span class="line">do</span><br><span class="line">        sum=$[$sum+$count]</span><br><span class="line">        count=$[$count+1]</span><br><span class="line">        # ä¹Ÿå¯ä»¥é‡‡ç”¨let</span><br><span class="line">        # let sum+=count</span><br><span class="line">        # let count++</span><br><span class="line">done</span><br><span class="line">echo &quot;count: $count, sum: $sum&quot;</span><br><span class="line">[root@root shell]# ./while.sh</span><br><span class="line">count: 101, sum: 5050</span><br></pre></td></tr></table></figure>

<h2 id="read-è¯»å–æ§åˆ¶å°è¾“å…¥"><a href="#read-è¯»å–æ§åˆ¶å°è¾“å…¥" class="headerlink" title="read è¯»å–æ§åˆ¶å°è¾“å…¥"></a>read è¯»å–æ§åˆ¶å°è¾“å…¥</h2><p>åŸºæœ¬è¯­æ³•</p>
<p>read (é€‰é¡¹) (å‚æ•°) </p>
<p>â‘  é€‰é¡¹ï¼š</p>
<p>â€‹		 -pï¼šæŒ‡å®šè¯»å–å€¼æ—¶çš„æç¤ºç¬¦ï¼› </p>
<p>â€‹		-tï¼šæŒ‡å®šè¯»å–å€¼æ—¶ç­‰å¾…çš„æ—¶é—´ï¼ˆç§’ï¼‰å¦‚æœä¸åŠ  -t è¡¨ç¤ºä¸€ç›´ç­‰å¾…</p>
<p>â‘¡ å‚æ•° å˜é‡ï¼šæŒ‡å®šè¯»å–å€¼çš„å˜é‡å</p>
<p>ç¤ºä¾‹ï¼šæç¤º 7 ç§’å†…ï¼Œè¯»å–æ§åˆ¶å°è¾“å…¥çš„åç§°</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@root shell]# vim read.sh</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/bin/bash</span></span><br><span class="line">read -t 7 -p &quot;è¯·è¾“å…¥å†…å®¹: &quot; R</span><br><span class="line">echo $R</span><br><span class="line">[root@root shell]# chmod +x read.sh</span><br><span class="line">[root@root shell]# ./read.sh</span><br><span class="line">è¯·è¾“å…¥å†…å®¹: root</span><br><span class="line">root</span><br></pre></td></tr></table></figure>

<h2 id="å‡½æ•°"><a href="#å‡½æ•°" class="headerlink" title="å‡½æ•°"></a>å‡½æ•°</h2><h3 id="ç³»ç»Ÿå‡½æ•°"><a href="#ç³»ç»Ÿå‡½æ•°" class="headerlink" title="ç³»ç»Ÿå‡½æ•°"></a>ç³»ç»Ÿå‡½æ•°</h3><p><strong>basename</strong></p>
<p>basename [string &#x2F; pathname] [suffix] </p>
<p>basename å‘½ä»¤ä¼šåˆ æ‰æ‰€æœ‰çš„å‰ç¼€åŒ…æ‹¬æœ€åä¸€ä¸ª â€œ&#x2F;â€œ å­—ç¬¦ï¼Œç„¶åå°†å­—ç¬¦ä¸²æ˜¾ç¤ºå‡ºæ¥ã€‚ </p>
<p>basename å¯ä»¥ç†è§£ä¸ºï¼šå–è·¯å¾„é‡Œçš„æ–‡ä»¶åç§°ã€‚</p>
<p>é€‰é¡¹ï¼š suffix ä¸ºåç¼€ï¼Œå¦‚æœ suffix è¢«æŒ‡å®šï¼Œbasename ä¼šå°† pathname æˆ–string ä¸­çš„suffix å»æ‰ã€‚</p>
<p>ç¤ºä¾‹ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@root shell]# basename /root/shell/read.sh</span><br><span class="line">read.sh</span><br><span class="line">[root@root shell]# basename /root/shell/read.sh .sh</span><br><span class="line">read</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">è·å–å½“å‰è„šæœ¬æ‰€åœ¨è·¯å¾„</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="built_in">basename</span> <span class="variable">$0</span></span></span><br></pre></td></tr></table></figure>

<p><strong>dirname</strong></p>
<p>dirname æ–‡ä»¶ç»å¯¹è·¯å¾„</p>
<p>è·å–æ–‡ä»¶è·¯å¾„çš„ç»å¯¹è·¯å¾„åç§°</p>
<p>ç¤ºä¾‹ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@root shell]# dirname /root/shell/read.sh</span><br><span class="line">/root/shell</span><br></pre></td></tr></table></figure>

<h3 id="è‡ªå®šä¹‰å‡½æ•°"><a href="#è‡ªå®šä¹‰å‡½æ•°" class="headerlink" title="è‡ªå®šä¹‰å‡½æ•°"></a>è‡ªå®šä¹‰å‡½æ•°</h3><p>åŸºæœ¬è¯­æ³•</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">å®šä¹‰</span></span><br><span class="line">[ function ] funname[()]</span><br><span class="line">&#123;</span><br><span class="line">	Action;</span><br><span class="line">	[return int;]</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">ä½¿ç”¨$(æ¥æ”¶è¿”å›çš„å€¼)</span></span><br><span class="line">funname param1 param2...</span><br></pre></td></tr></table></figure>

<p>ï¼ˆ1ï¼‰å¿…é¡»åœ¨è°ƒç”¨å‡½æ•°åœ°æ–¹ä¹‹å‰ï¼Œå…ˆå£°æ˜å‡½æ•°ï¼Œshell è„šæœ¬æ˜¯é€è¡Œè¿è¡Œã€‚ä¸ä¼šåƒå…¶å®ƒè¯­è¨€ä¸€æ ·å…ˆç¼–è¯‘ã€‚ </p>
<p>ï¼ˆ2ï¼‰å‡½æ•°è¿”å›å€¼ï¼Œåªèƒ½é€šè¿‡ $? ç³»ç»Ÿå˜é‡è·å¾—ï¼Œå¯ä»¥æ˜¾å¼åŠ ï¼šreturn è¿”å›ï¼Œå¦‚æœä¸åŠ ï¼Œå°†ä»¥æœ€åä¸€æ¡å‘½ä»¤è¿è¡Œç»“æœï¼Œä½œä¸ºè¿”å›å€¼ã€‚return 		 åè·Ÿæ•°å€¼ n(0-255)</p>
<p>ç¤ºä¾‹ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@root shell]# vim fun.sh</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/bin/bash</span></span><br><span class="line">function add()&#123;</span><br><span class="line">        s=$[$1+$2]</span><br><span class="line">        echo $s</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">read -p &quot;please input number1: &quot; num1</span><br><span class="line">read -p &quot;please input number2: &quot; num2</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">ä½¿ç”¨$(æ¥æ”¶è¿”å›çš„å€¼)</span></span><br><span class="line">sum=$(add $num1 $num2)</span><br><span class="line">echo &quot;sum: &quot;$sum</span><br><span class="line">echo &quot;square: &quot;$[$sum * $sum]</span><br><span class="line">[root@root shell]# ./fun.sh</span><br></pre></td></tr></table></figure>



<h2 id="æ­£åˆ™è¡¨è¾¾å¼"><a href="#æ­£åˆ™è¡¨è¾¾å¼" class="headerlink" title="æ­£åˆ™è¡¨è¾¾å¼"></a>æ­£åˆ™è¡¨è¾¾å¼</h2><p>â€‹		æ­£åˆ™è¡¨è¾¾å¼ä½¿ç”¨å•ä¸ªå­—ç¬¦ä¸²æ¥æè¿°ã€åŒ¹é…ä¸€ç³»åˆ—ç¬¦åˆæŸä¸ªè¯­æ³•è§„åˆ™çš„å­—ç¬¦ä¸²ã€‚åœ¨å¾ˆå¤šæ–‡æœ¬ç¼–è¾‘å™¨é‡Œï¼Œæ­£åˆ™è¡¨è¾¾å¼é€šå¸¸è¢«ç”¨æ¥æ£€ç´¢ã€æ›¿æ¢é‚£äº›ç¬¦åˆæŸä¸ªæ¨¡å¼çš„æ–‡æœ¬ã€‚åœ¨Linux ä¸­ï¼Œ<strong>grepï¼Œsedï¼Œawk</strong> ç­‰æ–‡æœ¬å¤„ç†å·¥å…·éƒ½æ”¯æŒé€šè¿‡æ­£åˆ™è¡¨è¾¾å¼è¿›è¡Œæ¨¡å¼åŒ¹é…ã€‚</p>
<p>ç¤ºä¾‹ï¼šåŒ¹é… &#x2F;etc&#x2F;passwd&#x2F; ä¸‹çš„æ‰€æœ‰åŒ…å«bashçš„è¡Œ</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@root archive]# cat /etc/passwd |grep bash</span><br><span class="line">root:x:0:0:root:/root:/bin/bash</span><br><span class="line">liufei:x:1000:1000:liufei:/home/liufei:/bin/bash</span><br></pre></td></tr></table></figure>

<h3 id="å¸¸ç”¨çš„ç‰¹æ®Šå­—ç¬¦"><a href="#å¸¸ç”¨çš„ç‰¹æ®Šå­—ç¬¦" class="headerlink" title="å¸¸ç”¨çš„ç‰¹æ®Šå­—ç¬¦"></a>å¸¸ç”¨çš„ç‰¹æ®Šå­—ç¬¦</h3><h4 id="ï¼šåŒ¹é…ä¸€è¡Œçš„å¼€å¤´"><a href="#ï¼šåŒ¹é…ä¸€è¡Œçš„å¼€å¤´" class="headerlink" title="^ï¼šåŒ¹é…ä¸€è¡Œçš„å¼€å¤´"></a>^ï¼šåŒ¹é…ä¸€è¡Œçš„å¼€å¤´</h4><p>ç¤ºä¾‹ï¼šä»¥ a å¼€å¤´</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@root archive]# cat /etc/passwd|grep ^a</span><br><span class="line">adm:x:3:4:adm:/var/adm:/sbin/nologin</span><br><span class="line">abrt:x:173:173::/etc/abrt:/sbin/nologin</span><br><span class="line">avahi:x:70:70:Avahi mDNS/DNS-SD Stack:/var/run/avahi-daemon:/sbin/nologin</span><br></pre></td></tr></table></figure>

<h4 id="ï¼šåŒ¹é…ä¸€è¡Œçš„ç»“æŸ"><a href="#ï¼šåŒ¹é…ä¸€è¡Œçš„ç»“æŸ" class="headerlink" title="$ï¼šåŒ¹é…ä¸€è¡Œçš„ç»“æŸ"></a>$ï¼šåŒ¹é…ä¸€è¡Œçš„ç»“æŸ</h4><p>ç¤ºä¾‹ï¼šä»¥ t ç»“æŸ</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@root archive]# cat /etc/passwd|grep t$</span><br><span class="line">halt:x:7:0:halt:/sbin:/sbin/halt</span><br></pre></td></tr></table></figure>

<h4 id="ç‚¹-ï¼šåŒ¹é…ä¸€ä¸ªä»»æ„çš„å­—ç¬¦"><a href="#ç‚¹-ï¼šåŒ¹é…ä¸€ä¸ªä»»æ„çš„å­—ç¬¦" class="headerlink" title="ç‚¹ . ï¼šåŒ¹é…ä¸€ä¸ªä»»æ„çš„å­—ç¬¦"></a>ç‚¹ <strong>.</strong> ï¼šåŒ¹é…ä¸€ä¸ªä»»æ„çš„å­—ç¬¦</h4><p>ç¤ºä¾‹ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@root archive]# cat /etc/passwd|grep r..t</span><br><span class="line">root:x:0:0:root:/root:/bin/bash</span><br><span class="line">operator:x:11:0:operator:/root:/sbin/nologin</span><br><span class="line">ftp:x:14:50:FTP User:/var/ftp:/sbin/nologin</span><br></pre></td></tr></table></figure>

<h4 id="ï¼šåŒ¹é…0æ¬¡æˆ–å¤šæ¬¡"><a href="#ï¼šåŒ¹é…0æ¬¡æˆ–å¤šæ¬¡" class="headerlink" title="*ï¼šåŒ¹é…0æ¬¡æˆ–å¤šæ¬¡"></a>*ï¼šåŒ¹é…0æ¬¡æˆ–å¤šæ¬¡</h4><p>â€‹		ä¸å•ç‹¬ä½¿ç”¨ï¼Œä»–å’Œä¸Šä¸€ä¸ªå­—ç¬¦è¿ç”¨ï¼Œè¡¨ç¤ºåŒ¹é…ä¸Šä¸€ä¸ªå­—ç¬¦ 0 æ¬¡æˆ–å¤šæ¬¡ã€‚</p>
<p>ç¤ºä¾‹ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@root archive]# cat /etc/passwd|grep ro*t</span><br><span class="line">root:x:0:0:root:/root:/bin/bash</span><br><span class="line">operator:x:11:0:operator:/root:/sbin/nologin</span><br></pre></td></tr></table></figure>

<h4 id="ï¼šåŒ¹é…æŸä¸ªèŒƒå›´å†…çš„ä¸€ä¸ªå­—ç¬¦"><a href="#ï¼šåŒ¹é…æŸä¸ªèŒƒå›´å†…çš„ä¸€ä¸ªå­—ç¬¦" class="headerlink" title="[ ]ï¼šåŒ¹é…æŸä¸ªèŒƒå›´å†…çš„ä¸€ä¸ªå­—ç¬¦"></a>[ ]ï¼šåŒ¹é…æŸä¸ªèŒƒå›´å†…çš„ä¸€ä¸ªå­—ç¬¦</h4><p>[ ] è¡¨ç¤ºåŒ¹é…æŸä¸ªèŒƒå›´å†…çš„ä¸€ä¸ªå­—ç¬¦ï¼Œä¾‹å¦‚</p>
<p>[6,8]			åŒ¹é… 6 æˆ–è€… 8 </p>
<p>[0-9]			åŒ¹é…ä¸€ä¸ª 0-9 çš„æ•°å­— </p>
<p>[0-9]*			åŒ¹é…ä»»æ„é•¿åº¦çš„æ•°å­—å­—ç¬¦ä¸²</p>
<p>[a-z]*			åŒ¹é…ä»»æ„é•¿åº¦ a-z ä¹‹é—´çš„å­—ç¬¦</p>
<p>[a-z]			åŒ¹é…ä»»æ„é•¿åº¦çš„å­—æ¯å­—ç¬¦ä¸² </p>
<p>[a-c, e-f]		åŒ¹é… a-c æˆ–è€… e-f ä¹‹é—´çš„ä»»æ„å­—ç¬¦</p>
<p>ç¤ºä¾‹ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@root archive]# cat /etc/passwd|grep r[a,b,c]*t</span><br><span class="line">operator:x:11:0:operator:/root:/sbin/nologin</span><br><span class="line">abrt:x:173:173::/etc/abrt:/sbin/nologin</span><br><span class="line">rtkit:x:172:172:RealtimeKit:/proc:/sbin/nologin</span><br><span class="line">sshd:x:74:74:Privilege-separated SSH:/var/empty/sshd:/sbin/nologin</span><br></pre></td></tr></table></figure>

<h4 id="ï¼šè½¬ä¹‰å­—ç¬¦"><a href="#ï¼šè½¬ä¹‰å­—ç¬¦" class="headerlink" title="\ï¼šè½¬ä¹‰å­—ç¬¦"></a>\ï¼šè½¬ä¹‰å­—ç¬¦</h4><p>â€‹		\ è¡¨ç¤ºè½¬ä¹‰ï¼Œå¹¶ä¸ä¼šå•ç‹¬ä½¿ç”¨ã€‚åŒ¹é…ç‰¹æ®Šå­—ç¬¦ï¼Œå¦‚$ã€^ç­‰ã€‚ã€éœ€è¦ä½¿ç”¨å•å¼•å·å°†è¡¨è¾¾å¼å¼•èµ·æ¥ã€‘</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@root archive]# cat /etc/passwd|grep &#x27;a\$b&#x27;</span><br></pre></td></tr></table></figure>

<h3 id="æ–‡æœ¬å¤„ç†å·¥å…·"><a href="#æ–‡æœ¬å¤„ç†å·¥å…·" class="headerlink" title="æ–‡æœ¬å¤„ç†å·¥å…·"></a>æ–‡æœ¬å¤„ç†å·¥å…·</h3><h4 id="grep"><a href="#grep" class="headerlink" title="grep"></a>grep</h4><p>â€‹		è¿‡æ»¤æ–‡æœ¬çš„è¡Œ</p>
<h4 id="cut"><a href="#cut" class="headerlink" title="cut"></a>cut</h4><p>â€‹		åœ¨æ–‡ä»¶ä¸­è´Ÿè´£å‰ªåˆ‡æ•°æ®ç”¨çš„ã€‚cut å‘½ä»¤ä»æ–‡ä»¶çš„æ¯ä¸€è¡Œå‰ªåˆ‡å­—èŠ‚ã€å­—ç¬¦å’Œå­—æ®µå¹¶å°†è¿™äº›å­—èŠ‚ã€å­—ç¬¦å’Œå­—æ®µè¾“å‡ºã€‚</p>
<p>åŸºæœ¬ç”¨æ³•</p>
<p>åŸºæœ¬è¯­æ³•</p>
<p>â€‹		cut [é€‰é¡¹å‚æ•°] filename</p>
<p>é€‰é¡¹å‚æ•°è¯´æ˜</p>
<table>
<thead>
<tr>
<th>é€‰é¡¹å‚æ•°</th>
<th>åŠŸèƒ½</th>
</tr>
</thead>
<tbody><tr>
<td>-f</td>
<td>åˆ—å·ï¼Œæå–ç¬¬å‡ åˆ—</td>
</tr>
<tr>
<td>-d</td>
<td>åˆ†éš”ç¬¦ï¼ŒæŒ‰ç…§æŒ‡å®šåˆ†éš”ç¬¦æœ‰è¿›è¡Œåˆ†éš”ï¼Œé»˜è®¤åˆ†éš”ç¬¦æ˜¯åˆ¶è¡¨ç¬¦</td>
</tr>
<tr>
<td>-c</td>
<td>æŒ‰å­—ç¬¦è¿›è¡Œåˆ‡å‰²ååŠ  n è¡¨ç¤ºå–ç¬¬å‡ åˆ— æ¯”å¦‚ -c 1</td>
</tr>
</tbody></table>
<p>ç¤ºä¾‹ï¼šé€‰å–ç³»ç»Ÿ PATH å˜é‡å€¼ï¼Œç¬¬äºŒä¸ª : åå¼€å§‹çš„æ‰€æœ‰è·¯å¾„ã€‚</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@root archive]# echo $PATH</span><br><span class="line">/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/root/bin</span><br><span class="line">[root@root archive]# echo $PATH | cut -d &quot;:&quot; -f 3-</span><br><span class="line">/usr/sbin:/usr/bin:/root/bin</span><br></pre></td></tr></table></figure>

<p>ç¤ºä¾‹ï¼šåˆ‡å‰² ifconfig åæ‰“å°çš„ IP åœ°å€ã€‚</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@root archive]# ifconfig</span><br><span class="line">ens33: flags=4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu 1500</span><br><span class="line">        inet 192.168.1.130  netmask 255.255.255.0  broadcast 192.168.1.255</span><br><span class="line">        inet6 fe80::46be:b086:81c7:b3b2  prefixlen 64  scopeid 0x20&lt;link&gt;</span><br><span class="line">        ether 00:0c:29:15:3a:b3  txqueuelen 1000  (Ethernet)</span><br><span class="line">        RX packets 40674  bytes 3071986 (2.9 MiB)</span><br><span class="line">        RX errors 0  dropped 0  overruns 0  frame 0</span><br><span class="line">        TX packets 14352  bytes 1922281 (1.8 MiB)</span><br><span class="line">        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0</span><br><span class="line"></span><br><span class="line">lo: flags=73&lt;UP,LOOPBACK,RUNNING&gt;  mtu 65536</span><br><span class="line">        inet 127.0.0.1  netmask 255.0.0.0</span><br><span class="line">        inet6 ::1  prefixlen 128  scopeid 0x10&lt;host&gt;</span><br><span class="line">        loop  txqueuelen 1000  (Local Loopback)</span><br><span class="line">        RX packets 68  bytes 5912 (5.7 KiB)</span><br><span class="line">        RX errors 0  dropped 0  overruns 0  frame 0</span><br><span class="line">        TX packets 68  bytes 5912 (5.7 KiB)</span><br><span class="line">        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0</span><br><span class="line"></span><br><span class="line">virbr0: flags=4099&lt;UP,BROADCAST,MULTICAST&gt;  mtu 1500</span><br><span class="line">        inet 192.168.122.1  netmask 255.255.255.0  broadcast 192.168.122.255</span><br><span class="line">        ether 52:54:00:0f:e3:ff  txqueuelen 1000  (Ethernet)</span><br><span class="line">        RX packets 0  bytes 0 (0.0 B)</span><br><span class="line">        RX errors 0  dropped 0  overruns 0  frame 0</span><br><span class="line">        TX packets 0  bytes 0 (0.0 B)</span><br><span class="line">        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0</span><br><span class="line"></span><br><span class="line">[root@root archive]# ifconfig ens33 |grep netmask |cut -d &quot; &quot; -f 10</span><br><span class="line">192.168.1.130</span><br><span class="line">[root@root archive]# ifconfig |grep netmask |cut -d &quot; &quot; -f 10</span><br><span class="line">192.168.1.130</span><br><span class="line">127.0.0.1</span><br><span class="line">192.168.122.1</span><br></pre></td></tr></table></figure>

<h4 id="awk"><a href="#awk" class="headerlink" title="awk"></a>awk</h4><p>â€‹		ä¸€ä¸ªå¼ºå¤§çš„æ–‡æœ¬åˆ†æå·¥å…·ï¼ŒæŠŠæ–‡ä»¶é€è¡Œçš„è¯»å…¥ï¼Œä»¥ç©ºæ ¼ä¸ºé»˜è®¤åˆ†éš”ç¬¦å°†æ¯è¡Œåˆ‡ç‰‡ï¼Œåˆ‡å¼€çš„éƒ¨åˆ†å†è¿›è¡Œåˆ†æå¤„ç†ã€‚</p>
<h5 id="åŸºæœ¬ç”¨æ³•"><a href="#åŸºæœ¬ç”¨æ³•" class="headerlink" title="åŸºæœ¬ç”¨æ³•"></a>åŸºæœ¬ç”¨æ³•</h5><p>â€‹		awk   [é€‰é¡¹å‚æ•°]   <strong>â€˜&#x2F;pattern1&#x2F;{action1} &#x2F;pattern2&#x2F;{action2}â€¦â€¦â€™ filename</strong> </p>
<p>â€‹		patternï¼šè¡¨ç¤º awk åœ¨æ•°æ®ä¸­æŸ¥æ‰¾çš„å†…å®¹ï¼Œå°±æ˜¯åŒ¹é…æ¨¡å¼</p>
<p>â€‹		actionï¼šåœ¨æ‰¾åˆ°åŒ¹é…å†…å®¹æ—¶æ‰€æ‰§è¡Œçš„ä¸€ç³»åˆ—å‘½ä»¤</p>
<p>é€‰é¡¹å‚æ•°è¯´æ˜</p>
<p>â€‹		-F		æŒ‡å®šè¾“å…¥æ–‡ä»¶åˆ†éš”ç¬¦</p>
<p>â€‹		-v		èµ‹å€¼ä¸€ä¸ªç”¨æˆ·å®šä¹‰å˜é‡</p>
<p>ç¤ºä¾‹ï¼šæœç´¢ passwd æ–‡ä»¶ä»¥ root å…³é”®å­—å¼€å¤´çš„æ‰€æœ‰è¡Œï¼Œå¹¶è¾“å‡ºè¯¥è¡Œçš„ç¬¬7 åˆ—ã€‚</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@root shell]# awk -F : &#x27;/^root/&#123;print $7&#125;&#x27; /etc/passwd</span><br><span class="line">/bin/bash</span><br></pre></td></tr></table></figure>

<p>ç¤ºä¾‹ï¼šæœç´¢ passwd æ–‡ä»¶ä»¥ root å…³é”®å­—å¼€å¤´çš„æ‰€æœ‰è¡Œï¼Œå¹¶è¾“å‡ºè¯¥è¡Œçš„ç¬¬1 åˆ—å’Œç¬¬7 åˆ—ï¼Œä¸­é—´ä»¥ â€œ,â€ å·åˆ†å‰²</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@root shell]# awk -F : &#x27;/^root/&#123;print $1&quot;,&quot;$7&#125;&#x27; /etc/passwd</span><br><span class="line">root,/bin/bash</span><br></pre></td></tr></table></figure>

<p>ç¤ºä¾‹ï¼šåªæ˜¾ç¤º&#x2F;etc&#x2F;passwd çš„ç¬¬ä¸€åˆ—å’Œç¬¬ä¸ƒåˆ—ï¼Œä»¥é€—å·åˆ†å‰²ï¼Œä¸”åœ¨æ‰€æœ‰è¡Œå‰é¢æ·»åŠ åˆ—åuserï¼Œshell åœ¨æœ€åä¸€è¡Œæ·»åŠ â€endï¼Œ			shellâ€ã€‚</p>
<p>æ³¨æ„ï¼šBEGIN åœ¨æ‰€æœ‰æ•°æ®è¯»å–è¡Œä¹‹å‰æ‰§è¡Œï¼›END åœ¨æ‰€æœ‰æ•°æ®æ‰§è¡Œä¹‹åæ‰§è¡Œã€‚</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@root shell]# awk -F : &#x27;BEGIN&#123;print &quot;user,shell&quot;&#125; &#123;print $1&quot;,&quot;$7&#125; END&#123;print &quot;shell end&quot;&#125;&#x27; /etc/passwd</span><br><span class="line">user,shell</span><br><span class="line">root,/bin/bash</span><br><span class="line">bin,/sbin/nologin</span><br><span class="line">......</span><br><span class="line">liufei,/bin/bash</span><br><span class="line">mysql,/bin/false</span><br><span class="line">shell end</span><br></pre></td></tr></table></figure>

<p>ç¤ºä¾‹ï¼šå°† passwd æ–‡ä»¶ä¸­çš„ç”¨æˆ· id å¢åŠ æ•°å€¼ 1 å¹¶è¾“å‡ºã€‚</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@root shell]# awk -F : -v i=1 &#x27;&#123;print $3+i&#125;&#x27; /etc/passwd</span><br><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">......</span><br><span class="line">100</span><br><span class="line">193</span><br><span class="line">82</span><br><span class="line">1000</span><br></pre></td></tr></table></figure>

<h5 id="awk-çš„å†…ç½®å˜é‡"><a href="#awk-çš„å†…ç½®å˜é‡" class="headerlink" title="awk çš„å†…ç½®å˜é‡"></a>awk çš„å†…ç½®å˜é‡</h5><table>
<thead>
<tr>
<th>å˜é‡</th>
<th>è¯´æ˜</th>
</tr>
</thead>
<tbody><tr>
<td>FILENAME</td>
<td>æ–‡ä»¶å</td>
</tr>
<tr>
<td>NR</td>
<td>å·²è¯»çš„è®°å½•æ•°ï¼ˆè¡Œå·ï¼‰</td>
</tr>
<tr>
<td>NF</td>
<td>æµè§ˆè®°å½•çš„åŸŸçš„ä¸ªæ•°ï¼ˆåˆ‡å‰²åï¼Œåˆ—çš„ä¸ªæ•°ï¼‰</td>
</tr>
</tbody></table>
<p>ç¤ºä¾‹ï¼šç»Ÿè®¡ passwd æ–‡ä»¶åï¼Œæ¯è¡Œçš„è¡Œå·ï¼Œæ¯è¡Œçš„åˆ—æ•°ã€‚</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@root shell]# awk -F : &#x27;&#123;print &quot;filename: &quot;FILENAME&quot;, lineNum: &quot;NR&quot;, column: &quot;NF&#125;&#x27; /etc/passwd</span><br><span class="line">filename: /etc/passwd, lineNum: 1, column: 7</span><br><span class="line">filename: /etc/passwd, lineNum: 2, column: 7</span><br><span class="line">filename: /etc/passwd, lineNum: 3, column: 7</span><br><span class="line">......</span><br></pre></td></tr></table></figure>

<p>ç¤ºä¾‹ï¼šæŸ¥è¯¢ ifconfig å‘½ä»¤è¾“å‡ºç»“æœä¸­çš„ç©ºè¡Œæ‰€åœ¨çš„è¡Œå·ã€‚</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@root shell]# ifconfig |awk &#x27;/^$/&#123;print NR&#125;&#x27;</span><br><span class="line">9</span><br><span class="line">18</span><br><span class="line">26	</span><br></pre></td></tr></table></figure>

<p>ç¤ºä¾‹ï¼šåˆ‡å‰²IPï¼Œé»˜è®¤ä»¥ç©ºæ ¼åˆ†å‰²</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@root shell]# ifconfig |awk &#x27;/netmask/&#123;print $2&#125;&#x27;</span><br><span class="line">192.168.1.130</span><br><span class="line">127.0.0.1</span><br><span class="line">192.168.122.1</span><br></pre></td></tr></table></figure>

<h2 id="Shellç¤ºä¾‹"><a href="#Shellç¤ºä¾‹" class="headerlink" title="Shellç¤ºä¾‹"></a>Shellç¤ºä¾‹</h2><h3 id="æ–‡ä»¶å½’æ¡£"><a href="#æ–‡ä»¶å½’æ¡£" class="headerlink" title="æ–‡ä»¶å½’æ¡£"></a>æ–‡ä»¶å½’æ¡£</h3><p>ç¤ºä¾‹ï¼š</p>
<p>â€‹		å®ç°ä¸€ä¸ªæ¯å¤©å¯¹æŒ‡å®šç›®å½•å½’æ¡£å¤‡ä»½çš„è„šæœ¬ï¼Œè¾“å…¥ä¸€ä¸ªç›®å½•åç§°ï¼ˆæœ«å°¾ä¸å¸¦&#x2F;ï¼‰ï¼Œå°†ç›®å½•ä¸‹æ‰€æœ‰æ–‡ä»¶æŒ‰å¤©å½’æ¡£ä¿å­˜ï¼Œå¹¶å°†å½’æ¡£æ—¥æœŸé™„åŠ åœ¨å½’æ¡£æ–‡ä»¶åä¸Šï¼Œæ”¾åœ¨ &#x2F;opt&#x2F;shell&#x2F;archive ä¸‹ã€‚è¿™é‡Œç”¨åˆ°äº†å½’æ¡£å‘½ä»¤ï¼štar åé¢å¯ä»¥åŠ ä¸Š -c é€‰é¡¹è¡¨ç¤ºå½’æ¡£ï¼ŒåŠ ä¸Š  -z é€‰é¡¹è¡¨ç¤ºåŒæ—¶è¿›è¡Œå‹ç¼©ï¼Œå¾—åˆ°çš„æ–‡ä»¶åç¼€åä¸º.tar.gzã€‚ archive .sh è„šæœ¬å®ç°å¦‚ä¸‹ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/bin/bash</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">é¦–å…ˆåˆ¤æ–­è¾“å…¥å‚æ•°ä¸ªæ•°æ˜¯å¦ä¸º1</span></span><br><span class="line">if [ $# -ne 1 ]</span><br><span class="line">then</span><br><span class="line">	echo &quot;å‚æ•°ä¸ªæ•°é”™è¯¯ï¼åº”è¯¥è¾“å…¥ä¸€ä¸ªå‚æ•°ï¼Œä½œä¸ºå½’æ¡£ç›®å½•å&quot;</span><br><span class="line">	exit</span><br><span class="line">fi</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">ä»å‚æ•°ä¸­è·å–ç›®å½•åç§°</span></span><br><span class="line">if [ -d $1 ]</span><br><span class="line">then</span><br><span class="line">	echo &quot;ç›®å½•å­˜åœ¨ï¼&quot;</span><br><span class="line">else</span><br><span class="line">	echo</span><br><span class="line">	echo &quot;ç›®å½•ä¸å­˜åœ¨ï¼&quot;</span><br><span class="line">	echo</span><br><span class="line">	exit</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line">DIR_NAME=$(basename $1)</span><br><span class="line">DIR_PATH=$(cd $(dirname $1); pwd)</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">è·å–å½“å‰æ—¥æœŸ</span></span><br><span class="line">DATE=$(date +%Y%m%d)</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">å®šä¹‰ç”Ÿæˆçš„å½’æ¡£æ–‡ä»¶åç§°</span></span><br><span class="line">DEST_PATH=/opt/shell/archive</span><br><span class="line">FILE=archive_$&#123;DIR_NAME&#125;_$DATE.tar.gz</span><br><span class="line">DEST=$DEST_PATH/$FILE</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">å¼€å§‹å½’æ¡£ç›®å½•æ–‡ä»¶</span></span><br><span class="line"></span><br><span class="line">echo &quot;å¼€å§‹å½’æ¡£...&quot;</span><br><span class="line">echo</span><br><span class="line"></span><br><span class="line">tar -czf $DEST $DIR_PATH/$DIR_NAME</span><br><span class="line"></span><br><span class="line">if [ $? -eq 0 ]</span><br><span class="line">then</span><br><span class="line">	echo</span><br><span class="line">	echo &quot;å½’æ¡£æˆåŠŸï¼&quot;</span><br><span class="line">	echo &quot;å½’æ¡£æ–‡ä»¶ä¸ºï¼š$DEST&quot;</span><br><span class="line">	echo</span><br><span class="line">else</span><br><span class="line">	echo &quot;å½’æ¡£å‡ºç°é—®é¢˜ï¼&quot;</span><br><span class="line">	echo</span><br><span class="line">fi</span><br><span class="line">exit</span><br></pre></td></tr></table></figure>



<h3 id="æ•°æ®åº“å¤‡ä»½"><a href="#æ•°æ®åº“å¤‡ä»½" class="headerlink" title="æ•°æ®åº“å¤‡ä»½"></a>æ•°æ®åº“å¤‡ä»½</h3><ol>
<li><p>æ¯å¤©å‡Œæ™¨2:10å¤‡ä»½æ•°æ®åº“testDB åˆ°&#x2F;data&#x2F;backup&#x2F;db</p>
</li>
<li><p>å¤‡ä»½å¼€å§‹å’Œå¤‡ä»½ç»“æŸèƒ½å¤Ÿç»™å‡ºç›¸åº”çš„æç¤ºä¿¡æ¯</p>
</li>
<li><p>å¤‡ä»½åçš„æ–‡ä»¶è¦æ±‚ä»¥å¤‡ä»½æ—¶é—´ä¸ºæ–‡ä»¶åï¼Œå¹¶æ‰“åŒ…æˆtar.gz. çš„å½¢å¼ï¼Œæ¯”å¦‚ï¼š2018-03-12_ 230201.tar.gz</p>
</li>
<li><p>åœ¨å¤‡ä»½çš„åŒæ—¶ï¼Œæ£€æŸ¥æ˜¯å¦æœ‰10å¤©å‰å¤‡ä»½çš„æ•°æ®åº“æ–‡ä»¶ï¼Œå¦‚æœæœ‰å°±å°†å…¶åˆ é™¤</p>
</li>
</ol>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/bin/bash</span></span><br><span class="line">BACKUP=/opt/shell/backup/db</span><br><span class="line">DATETIME=$(date +%Y_%m_%d_%H%M%S)</span><br><span class="line">echo &quot;å¼€å§‹å¤‡ä»½...&quot;</span><br><span class="line">echo &quot;å¤‡ä»½è·¯å¾„ä¸ºï¼š$BACKUP/$DATETIME.tar.gz&quot;</span><br><span class="line">HOST=127.0.0.1</span><br><span class="line">DB_USER=root</span><br><span class="line">DB_PWD=root</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æ•°æ®åº“å</span></span><br><span class="line">DATABASE=test</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æ²¡æœ‰ç›®å½•åˆ™åˆ›å»º</span></span><br><span class="line">[ ! -d &quot;$BACKUP/$DATETIME&quot; ] &amp;&amp; mkdir -p &quot;$BACKUP/$DATETIME&quot;</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">MySQLå¤‡ä»½æ•°æ®åº“çš„æŒ‡ä»¤</span></span><br><span class="line">mysqldump -u$&#123;DB_USER&#125; -p$&#123;DB_PWD&#125; --host=$HOST $DATEBASE | gzip &gt; $BACKUP/$DATETIME/$DATETIME.sql.gz</span><br><span class="line"></span><br><span class="line">cd $BACKUP</span><br><span class="line">tar -zcvf $DATETIME.tar.gz $DATETIME</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">åˆ é™¤ä¸´æ—¶ç›®å½•</span></span><br><span class="line">rm -rf $BACKUP/$DATETIME</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">åˆ é™¤10å¤©å‰çš„å¤‡ä»½æ–‡ä»¶ï¼Œ&#123;&#125; \ å›ºå®šå†™æ³•</span></span><br><span class="line">find $BACKUP -mtime +10 -name &quot;*.tar.gz&quot; -exec rm -rf &#123;&#125; \;</span><br><span class="line">echo &quot;å¤‡ä»½æˆåŠŸ&quot;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">0 2 * * * /usr/sbin/mysql_db_backup.sh</span></span><br></pre></td></tr></table></figure>

<h3 id="æ–‡ä»¶åˆ†å‘è„šæœ¬"><a href="#æ–‡ä»¶åˆ†å‘è„šæœ¬" class="headerlink" title="æ–‡ä»¶åˆ†å‘è„šæœ¬"></a>æ–‡ä»¶åˆ†å‘è„šæœ¬</h3><p>æ‰¹é‡è¿›è¡Œè·¨æœºå™¨é—´çš„æ–‡ä»¶ï¼ˆå«æ–‡ä»¶å¤¹ï¼‰ä¼ è¾“</p>
<blockquote>
<ul>
<li>åˆ›å»ºè„šæœ¬ xsync.shï¼Œä¼ å…¥è¦ä¼ è¾“çš„ç›®å½•å</li>
<li>shellè„šæœ¬è¦æ±‚å…·æœ‰æ‰§è¡Œæƒé™ï¼šchmod +x xsync</li>
<li>shellè„šæœ¬ä¿å­˜åœ¨ &#x2F;usr&#x2F;bin è¿™æ ·çš„ç›®å½•ä¸‹ï¼Œä»¥ä½¿å‘½ä»¤å…¨å±€æœ‰æ•ˆ</li>
</ul>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/bin/bash</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">åˆ¤æ–­å‚æ•°ä¸ªæ•°</span></span><br><span class="line">if [ $# -lt 1 ]</span><br><span class="line">then</span><br><span class="line">	echo &quot;Not Enough Arguments&quot;</span><br><span class="line">	exit</span><br><span class="line">fi</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">éå†æ‰€æœ‰ä¸»æœº</span></span><br><span class="line">for host in 192.168.100.100 192.168.100.110 192.168.100.120</span><br><span class="line">do</span><br><span class="line">	echo ========$host========</span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash">éå†æ‰€æœ‰ç›®å½•</span></span><br><span class="line">	for file in $@</span><br><span class="line">	do</span><br><span class="line">		if [ -e $file ]</span><br><span class="line">		then</span><br><span class="line"><span class="meta prompt_">			# </span><span class="language-bash">å¦‚æœæ–‡ä»¶å­˜åœ¨ï¼Œè·å–çˆ¶ç›®å½•ï¼Œ</span></span><br><span class="line"><span class="meta prompt_">			# </span><span class="language-bash"><span class="built_in">pwd</span> -Pï¼šå¦‚æœç›®å½•æ˜¯é“¾æ¥æ—¶ï¼Œæ˜¾ç¤ºå‡ºå®é™…è·¯å¾„ï¼Œè€Œéä½¿ç”¨è¿æ¥ï¼ˆ<span class="built_in">link</span>ï¼‰è·¯å¾„ã€‚<span class="built_in">pwd</span>é˜²æ­¢ä¼ å…¥ç›¸å¯¹è·¯å¾„</span></span><br><span class="line"><span class="meta prompt_">			# </span><span class="language-bash"><span class="built_in">cd</span> -P:å¦‚æœç›®å½•æ˜¯é“¾æ¥æ—¶ï¼Œåˆ‡æ¢åˆ°å®é™…è·¯å¾„çš„ç›®å½•ã€‚</span></span><br><span class="line">			pdir=$(cd -P $(dirname $file);pwd)</span><br><span class="line"><span class="meta prompt_">			# </span><span class="language-bash">è·å–æ–‡ä»¶åç§°</span></span><br><span class="line">			filename=$(basename $file)</span><br><span class="line">			ssh $host &quot;mkdir -p $pdir&quot;</span><br><span class="line">			rsync -av $pdir/$filename $host:$pdir</span><br><span class="line">		else</span><br><span class="line">			echo $file not exist!</span><br><span class="line">		fi</span><br><span class="line">	done</span><br><span class="line">done</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@root shell]# chmod +x xsync.sh</span><br><span class="line">[root@root shell]# cp xsync.sh /usr/bin</span><br></pre></td></tr></table></figure>

<h3 id="æŸ¥çœ‹æ‰€æœ‰JPSè¿›ç¨‹"><a href="#æŸ¥çœ‹æ‰€æœ‰JPSè¿›ç¨‹" class="headerlink" title="æŸ¥çœ‹æ‰€æœ‰JPSè¿›ç¨‹"></a>æŸ¥çœ‹æ‰€æœ‰JPSè¿›ç¨‹</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">for host in 192.168.100.100 192.168.100.110 192.168.100.120</span><br><span class="line">do</span><br><span class="line">    echo ========$host========</span><br><span class="line">    ssh $host jps $@ | grep -v Jps</span><br><span class="line">done</span><br></pre></td></tr></table></figure>

<h3 id="Zookeeper-å¯åŠ¨åœæ­¢è„šæœ¬"><a href="#Zookeeper-å¯åŠ¨åœæ­¢è„šæœ¬" class="headerlink" title="Zookeeper å¯åŠ¨åœæ­¢è„šæœ¬"></a>Zookeeper å¯åŠ¨åœæ­¢è„šæœ¬</h3><blockquote>
<p>å¯åŠ¨Zookeeperé›†ç¾¤ï¼Œè„šæœ¬ä½ç½®ï¼š&#x2F;home&#x2F;xxxx&#x2F;bin</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/bin/bash</span></span><br><span class="line">case $1 in</span><br><span class="line">&quot;start&quot;)&#123;</span><br><span class="line">	for host in 192.168.100.100 192.168.100.110 192.168.100.120</span><br><span class="line">	do</span><br><span class="line">		echo &quot;========zookeeper $host start========&quot;</span><br><span class="line">		ssh $host &quot;/opt/zookeeper/zookeeper-3.5.7/bin/zkServer.sh start&quot;</span><br><span class="line">	done</span><br><span class="line">&#125;</span><br><span class="line">;;</span><br><span class="line">&quot;status&quot;)&#123;</span><br><span class="line">	for host in 192.168.100.100 192.168.100.110 192.168.100.120</span><br><span class="line">	do</span><br><span class="line">		echo &quot;========zookeeper $host status========&quot;</span><br><span class="line">		ssh $host &quot;/opt/zookeeper/zookeeper-3.5.7/bin/zkServer.sh status&quot;</span><br><span class="line">	done</span><br><span class="line">&#125;</span><br><span class="line">;;</span><br><span class="line">&quot;stop&quot;)&#123;</span><br><span class="line">	for host in 192.168.100.100 192.168.100.110 192.168.100.120</span><br><span class="line">	do</span><br><span class="line">		echo &quot;========zookeeper $host stop========&quot;</span><br><span class="line">		ssh $host &quot;/opt/zookeeper/zookeeper-3.5.7/bin/zkServer.sh stop&quot;</span><br><span class="line">	done</span><br><span class="line">&#125;</span><br><span class="line">;;</span><br><span class="line">esac</span><br></pre></td></tr></table></figure>



<h3 id="å…¶ä»–-1"><a href="#å…¶ä»–-1" class="headerlink" title="å…¶ä»–"></a>å…¶ä»–</h3>]]></content>
  </entry>
  <entry>
    <title>MongoDB</title>
    <url>/2023/02/27/MongoDB/</url>
    <content><![CDATA[]]></content>
  </entry>
  <entry>
    <title>Mybatis</title>
    <url>/2023/02/28/Mybatis/</url>
    <content><![CDATA[<h1 id><a href="#" class="headerlink" title></a></h1><h1 id="Mybatis"><a href="#Mybatis" class="headerlink" title="Mybatis"></a>Mybatis</h1><h1 id="ä¸€ã€Mybatisæ¦‚è¿°"><a href="#ä¸€ã€Mybatisæ¦‚è¿°" class="headerlink" title="ä¸€ã€Mybatisæ¦‚è¿°"></a>ä¸€ã€Mybatisæ¦‚è¿°</h1><p>ã€Documentã€‘</p>
<p>å®˜æ–¹æ–‡æ¡£ï¼š</p>
<p>GitHub åœ°å€ï¼š</p>
<p>ä¸‹è½½åœ°å€ï¼š</p>
<h1 id="äºŒã€Mybatisçš„åŸºæœ¬ä½¿ç”¨"><a href="#äºŒã€Mybatisçš„åŸºæœ¬ä½¿ç”¨" class="headerlink" title="äºŒã€Mybatisçš„åŸºæœ¬ä½¿ç”¨"></a>äºŒã€Mybatisçš„åŸºæœ¬ä½¿ç”¨</h1>]]></content>
  </entry>
  <entry>
    <title>XXX</title>
    <url>/2023/02/23/Lovely/</url>
    <content><![CDATA[]]></content>
  </entry>
  <entry>
    <title>MySQL</title>
    <url>/2023/02/28/MySQL/</url>
    <content><![CDATA[<h1 id><a href="#" class="headerlink" title></a></h1><h1 id="MySQL"><a href="#MySQL" class="headerlink" title="MySQL"></a>MySQL</h1><h1 id="MySQL-æ¦‚è¿°"><a href="#MySQL-æ¦‚è¿°" class="headerlink" title="MySQL æ¦‚è¿°"></a>MySQL æ¦‚è¿°</h1><h2 id="MySQLç®€ä»‹"><a href="#MySQLç®€ä»‹" class="headerlink" title="MySQLç®€ä»‹"></a>MySQLç®€ä»‹</h2><ol>
<li><p>MySQL æ˜¯ä¸€ä¸ªå…³ç³»å‹æ•°æ®åº“ç®¡ç†ç³»ç»Ÿï¼Œç”±ç‘å…¸ MySQL AB å…¬å¸å¼€å‘ï¼Œç›®å‰å±äº Oracle å…¬å¸ã€‚</p>
</li>
<li><p>MySQL æ˜¯ä¸€ç§å…³è”æ•°æ®åº“ç®¡ç†ç³»ç»Ÿï¼Œå°†æ•°æ®ä¿å­˜åœ¨ä¸åŒçš„è¡¨ä¸­ï¼Œè€Œä¸æ˜¯å°†æ‰€æœ‰æ•°æ®æ”¾åœ¨ä¸€ä¸ªå¤§ä»“åº“å†…ï¼Œè¿™æ ·å°±å¢åŠ äº†é€Ÿåº¦å¹¶æé«˜äº†çµæ´»æ€§ã€‚</p>
</li>
<li><p>MySQL æ˜¯å¼€æºçš„ã€‚</p>
</li>
<li><p>MySQL æ”¯æŒå¤§å‹çš„æ•°æ®åº“ï¼Œå¯ä»¥å¤„ç†æ‹¥æœ‰ä¸Šåƒä¸‡æ¡è®°å½•çš„å¤§å‹æ•°æ®åº“ã€‚</p>
</li>
<li><p>MySQL ä½¿ç”¨æ ‡å‡†çš„SQLæ•°æ®è¯­è¨€å½¢å¼ã€‚</p>
</li>
<li><p>MySQL å¯ä»¥å…è®¸äºå¤šä¸ªç³»ç»Ÿä¸Šï¼Œå¹¶ä¸”æ”¯æŒå¤šç§è¯­è¨€ã€‚è¿™äº›ç¼–ç¨‹è¯­è¨€åŒ…æ‹¬Cã€C++ã€Pythonã€ Javaã€ Perlã€ PHPã€Eiffelã€ Rubyå’ŒTclç­‰ã€‚</p>
</li>
<li><p>MySQL æ”¯æŒå¤§å‹æ•°æ®åº“ï¼Œæ”¯æŒ 5000ä¸‡æ¡è®°å½•çš„æ•°æ®ä»“åº“ï¼Œ32ä½ç³»ç»Ÿè¡¨æ–‡ä»¶æœ€å¤§å¯æ”¯æŒ 4GBï¼Œ64ä½ç³»ç»Ÿæ”¯æŒæœ€å¤§çš„è¡¨æ–‡ä»¶ä¸º8TBã€‚</p>
</li>
<li><p>MySQL æ˜¯å¯ä»¥å®šåˆ¶çš„ï¼Œé‡‡ç”¨äº†GPLåè®®ï¼Œå¯ä»¥ä¿®æ”¹æºç æ¥å¼€å‘è‡ªå·±çš„ MySQL ç³»ç»Ÿã€‚</p>
</li>
</ol>
<h2 id="MySQL-ä¸‹è½½"><a href="#MySQL-ä¸‹è½½" class="headerlink" title="MySQL ä¸‹è½½"></a>MySQL ä¸‹è½½</h2><p>ä¸‹è½½åœ°å€ï¼š<a href="https://downloads.mysql.com/archives/community/">https://downloads.mysql.com/archives/community/</a></p>
<p><img src="/2023/02/28/MySQL/Java\Document\MySQL\MySQL.assets\image-20221006145016535.png" alt="image-20221006145016535"></p>
<h2 id="MySQL-å®‰è£…"><a href="#MySQL-å®‰è£…" class="headerlink" title="MySQL å®‰è£…"></a>MySQL å®‰è£…</h2><h3 id="ä¸€èˆ¬å®‰è£…æ–¹å¼"><a href="#ä¸€èˆ¬å®‰è£…æ–¹å¼" class="headerlink" title="ä¸€èˆ¬å®‰è£…æ–¹å¼"></a>ä¸€èˆ¬å®‰è£…æ–¹å¼</h3><ul>
<li><p>æºç ç¼–è¯‘</p>
</li>
<li><p>å‹ç¼©åŒ…è§£å‹ï¼ˆä¸€èˆ¬ä¸ºtar.gzï¼‰</p>
</li>
<li><p>ç¼–è¯‘å¥½çš„å®‰è£…åŒ…ï¼ˆRPMã€DPKGç­‰ï¼‰</p>
</li>
<li><p>åœ¨çº¿å®‰è£…ï¼ˆYUMã€APTç­‰ï¼‰</p>
<p>  å®‰è£…ç®€å•ç¨‹åº¦ï¼šYUM&gt;RPM&gt;tar.gz&gt;æºç å®‰è£…</p>
</li>
</ul>
<h3 id="MySQL-5-7-å®‰è£…"><a href="#MySQL-5-7-å®‰è£…" class="headerlink" title="MySQL 5.7 å®‰è£…"></a>MySQL 5.7 å®‰è£…</h3><p>ç¯å¢ƒï¼šCentOS7.9 + MySQL5.7.36</p>
<h4 id="å‹ç¼©åŒ…è§£å‹å®‰è£…"><a href="#å‹ç¼©åŒ…è§£å‹å®‰è£…" class="headerlink" title="å‹ç¼©åŒ…è§£å‹å®‰è£…"></a>å‹ç¼©åŒ…è§£å‹å®‰è£…</h4><p>ç¯å¢ƒï¼šCentOS7.9  + MySQL5.7.36.tar.gz</p>
<h5 id="ç¬¬ä¸€æ­¥ï¼šä¸Šä¼ å¹¶è§£å‹-tar-gz"><a href="#ç¬¬ä¸€æ­¥ï¼šä¸Šä¼ å¹¶è§£å‹-tar-gz" class="headerlink" title="ç¬¬ä¸€æ­¥ï¼šä¸Šä¼ å¹¶è§£å‹ tar.gz"></a>ç¬¬ä¸€æ­¥ï¼šä¸Šä¼ å¹¶è§£å‹ tar.gz</h5><p>â€‹		æ‹·è´å‹ç¼©åŒ… .tar.gz åˆ° &#x2F;opt ç›®å½•ï¼Œå¹¶è§£å‹è‡³ <strong>&#x2F;usr&#x2F;local&#x2F;mysql</strong> ä¸­</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@localhost mysql]# mkdir /opt/mysql</span><br><span class="line">x1[root@localhost mysql]# mkdir /usr/local/mysql/</span><br><span class="line">[root@localhost mysql]# tar zxvf mysql-5.7.36-linux-glibc2.12-x86_64.tar.gz</span><br><span class="line">[root@localhost mysql]# mv mysql-5.7.36-linux-glibc2.12-x86_64/* /usr/local/mysql</span><br><span class="line">[root@localhost mysql]# ls /usr/local/mysql/</span><br><span class="line">bin  docs  include  lib  LICENSE  man  README  share  support-files</span><br></pre></td></tr></table></figure>

<h5 id="ç¬¬äºŒæ­¥ï¼šåˆ›å»º-mysql-ç”¨æˆ·"><a href="#ç¬¬äºŒæ­¥ï¼šåˆ›å»º-mysql-ç”¨æˆ·" class="headerlink" title="ç¬¬äºŒæ­¥ï¼šåˆ›å»º mysql ç”¨æˆ·"></a>ç¬¬äºŒæ­¥ï¼šåˆ›å»º mysql ç”¨æˆ·</h5><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@localhost mysql]# id mysql</span><br><span class="line">id: mysql: no such user</span><br><span class="line">[root@localhost mysql]# useradd -r -s /sbin/nologin mysql</span><br><span class="line">[root@localhost mysql]# id mysql</span><br><span class="line">uid=987(mysql) gid=981(mysql) ç»„=981(mysql)</span><br><span class="line">[root@localhost mysql]#</span><br></pre></td></tr></table></figure>

<h5 id="ç¬¬ä¸‰æ­¥ï¼šæ›´æ”¹æƒé™"><a href="#ç¬¬ä¸‰æ­¥ï¼šæ›´æ”¹æƒé™" class="headerlink" title="ç¬¬ä¸‰æ­¥ï¼šæ›´æ”¹æƒé™"></a>ç¬¬ä¸‰æ­¥ï¼šæ›´æ”¹æƒé™</h5><p>â€‹		æ›´æ”¹mysqlç»„ä¸‹é¢mysqlç”¨æˆ·å¯¹ &#x2F;usr&#x2F;local&#x2F;mysql æƒé™</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@localhost local]# ll mysql</span><br><span class="line">æ€»ç”¨é‡ 272</span><br><span class="line">drwxr-xr-x.  2 root root    4096 4æœˆ  26 18:02 bin</span><br><span class="line">drwxr-xr-x.  2 root root      55 4æœˆ  26 18:02 docs</span><br><span class="line">drwxr-xr-x.  3 root root    4096 4æœˆ  26 18:02 include</span><br><span class="line">drwxr-xr-x.  5 root root     230 4æœˆ  26 18:02 lib</span><br><span class="line">-rw-r--r--.  1 7161 31415 259199 9æœˆ   7 2021 LICENSE</span><br><span class="line">drwxr-xr-x.  4 root root      30 4æœˆ  26 18:02 man</span><br><span class="line">-rw-r--r--.  1 7161 31415    566 9æœˆ   7 2021 README</span><br><span class="line">drwxr-xr-x. 28 root root    4096 4æœˆ  26 18:02 share</span><br><span class="line">drwxr-xr-x.  2 root root      90 4æœˆ  26 18:02 support-files</span><br><span class="line">[root@localhost local]# chown -R mysql.mysql /usr/local/mysql/</span><br><span class="line">[root@localhost local]# ll mysql</span><br><span class="line">æ€»ç”¨é‡ 272</span><br><span class="line">drwxr-xr-x.  2 mysql mysql   4096 4æœˆ  26 18:02 bin</span><br><span class="line">drwxr-xr-x.  2 mysql mysql     55 4æœˆ  26 18:02 docs</span><br><span class="line">drwxr-xr-x.  3 mysql mysql   4096 4æœˆ  26 18:02 include</span><br><span class="line">drwxr-xr-x.  5 mysql mysql    230 4æœˆ  26 18:02 lib</span><br><span class="line">-rw-r--r--.  1 mysql mysql 259199 9æœˆ   7 2021 LICENSE</span><br><span class="line">drwxr-xr-x.  4 mysql mysql     30 4æœˆ  26 18:02 man</span><br><span class="line">-rw-r--r--.  1 mysql mysql    566 9æœˆ   7 2021 README</span><br><span class="line">drwxr-xr-x. 28 mysql mysql   4096 4æœˆ  26 18:02 share</span><br><span class="line">drwxr-xr-x.  2 mysql mysql     90 4æœˆ  26 18:02 support-files</span><br></pre></td></tr></table></figure>

<h5 id="ç¬¬å››æ­¥ï¼šå¸è½½mariadb-libsåº“æ–‡ä»¶"><a href="#ç¬¬å››æ­¥ï¼šå¸è½½mariadb-libsåº“æ–‡ä»¶" class="headerlink" title="ç¬¬å››æ­¥ï¼šå¸è½½mariadb-libsåº“æ–‡ä»¶"></a>ç¬¬å››æ­¥ï¼š<strong>å¸è½½mariadb-libsåº“æ–‡ä»¶</strong></h5><p>â€‹		ç”±äºCentOS7æ“ä½œç³»ç»Ÿé»˜è®¤å®‰è£… mariadb-libs åº“ï¼Œå®ƒä¸ MySQL å†²çªï¼Œå½±å“åˆå§‹åŒ–</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@localhost local]# yum remove mariadb-libs</span><br></pre></td></tr></table></figure>

<h5 id="ç¬¬äº”æ­¥ï¼šåˆå§‹åŒ–æ•°æ®åº“"><a href="#ç¬¬äº”æ­¥ï¼šåˆå§‹åŒ–æ•°æ®åº“" class="headerlink" title="ç¬¬äº”æ­¥ï¼šåˆå§‹åŒ–æ•°æ®åº“"></a>ç¬¬äº”æ­¥ï¼šåˆå§‹åŒ–æ•°æ®åº“</h5><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æ²¡æœ‰dataç›®å½•ï¼Œéœ€è¦åˆå§‹åŒ–è¡¨</span></span><br><span class="line">[root@localhost mysql]# ls</span><br><span class="line">bin  docs  include  lib  LICENSE  man  README  share  support-files</span><br><span class="line">[root@localhost mysql]# bin/mysql_install_db --basedir=/usr/local/mysql --datadir=/usr/local/mysql/data --user=mysql</span><br><span class="line">2022-04-26 18:28:38 [WARNING] mysql_install_db is deprecated. Please consider switching to mysqld --initialize</span><br><span class="line">2022-04-26 18:28:41 [WARNING] The bootstrap log isn&#x27;t empty:</span><br><span class="line">2022-04-26 18:28:41 [WARNING] 2022-04-26T10:28:38.178883Z 0 [Warning] --bootstrap is deprecated. Please consider using --initialize instead</span><br><span class="line">2022-04-26T10:28:38.179678Z 0 [Warning] Changed limits: max_open_files: 1024 (requested 5000)</span><br><span class="line">2022-04-26T10:28:38.179692Z 0 [Warning] Changed limits: table_open_cache: 431 (requested 2000)</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">====mysql_install_dbåºŸå¼ƒï¼Œä½¿ç”¨mysqld --initializeä»£æ›¿====</span></span><br><span class="line">[root@localhost mysql]#  bin/mysqld --initialize</span><br><span class="line">2022-04-26T10:31:09.781805Z 0 [Warning] TIMESTAMP with implicit DEFAULT value is deprecated. Please use --explicit_defaults_for_timestamp server option (see documentation for more details).</span><br><span class="line">......</span><br><span class="line">[root@localhost mysql]# ls data</span><br><span class="line">auto.cnf    client-cert.pem  ibdata1      mysql               public_key.pem   sys</span><br><span class="line">ca-key.pem  client-key.pem   ib_logfile0  performance_schema  server-cert.pem</span><br><span class="line">ca.pem      ib_buffer_pool   ib_logfile1  private_key.pem     server-key.pem</span><br></pre></td></tr></table></figure>

<h5 id="ç¬¬å…­æ­¥ï¼šé…ç½®serviceå‘½ä»¤"><a href="#ç¬¬å…­æ­¥ï¼šé…ç½®serviceå‘½ä»¤" class="headerlink" title="ç¬¬å…­æ­¥ï¼šé…ç½®serviceå‘½ä»¤"></a>ç¬¬å…­æ­¥ï¼šé…ç½®serviceå‘½ä»¤</h5><p>â€‹		å¤åˆ¶ support-files ç›®å½•ä¸‹çš„ mysql.service è„šæœ¬åˆ° &#x2F;etc&#x2F;init.d ç›®å½•</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æœåŠ¡è‡ªå¯åŠ¨</span></span><br><span class="line">[root@localhost mysql]# cp support-files/mysql.server /etc/init.d/mysql</span><br><span class="line">[root@localhost mysql]# service mysql start</span><br><span class="line">Starting MySQL.Logging to &#x27;/usr/local/mysql/data/localhost.localdomain.err&#x27;.</span><br><span class="line"> ERROR! The server quit without updating PID file (/usr/local/mysql/data/localhost.localdomain.pid).</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">/usr/local/mysql/data/rekfan.pid æ–‡ä»¶æ²¡æœ‰å†™çš„æƒé™æ²¡æœ‰æƒé™</span></span><br><span class="line">[root@localhost mysql]# chown -R mysql.mysql /usr/local/mysql/</span><br><span class="line">[root@localhost mysql]# service mysql start</span><br><span class="line">Starting MySQL.Logging to &#x27;/usr/local/mysql/data/localhost.localdomain.err&#x27;.</span><br><span class="line"> SUCCESS!</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">å¯ä»¥é…ç½®ç¯å¢ƒå˜é‡ä»£æ›¿</span></span><br><span class="line">[root@localhost mysql]# ln -s /usr/local/mysql/bin/mysql /usr/bin/mysql</span><br></pre></td></tr></table></figure>

<h5 id="ç¬¬ä¸ƒæ­¥ï¼šé…ç½®å¯†ç "><a href="#ç¬¬ä¸ƒæ­¥ï¼šé…ç½®å¯†ç " class="headerlink" title="ç¬¬ä¸ƒæ­¥ï¼šé…ç½®å¯†ç "></a>ç¬¬ä¸ƒæ­¥ï¼šé…ç½®å¯†ç </h5><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">è®¾ç½®å¯†ç æŠ¥é”™</span></span><br><span class="line">[root@localhost mysql]# bin/mysqladmin -u root password &#x27;root&#x27;</span><br><span class="line">mysqladmin: connect to server at &#x27;localhost&#x27; failed</span><br><span class="line">error: &#x27;Access denied for user &#x27;root&#x27;@&#x27;localhost&#x27; (using password: NO)&#x27;</span><br><span class="line">ERROR 1045 (28000): Access denied for user &#x27;root&#x27;@&#x27;localhost&#x27; (using password: NO)</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æŸ¥è¯¢é»˜è®¤å¯†ç ï¼Œä½¿ç”¨é»˜è®¤å¯†ç ç™»å½•</span></span><br><span class="line">[root@localhost mysql]# cat /root/.mysql_secret</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Password <span class="built_in">set</span> <span class="keyword">for</span> user <span class="string">&#x27;root@localhost&#x27;</span> at 2022-04-26 18:28:38</span></span><br><span class="line">aUs6:3#hedu.</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">è®¾ç½®å¯†ç </span></span><br><span class="line">[root@localhost mysql]# pwd</span><br><span class="line">/usr/local/mysql</span><br><span class="line">[root@localhost mysql]# bin/mysqladmin -h localhost -u root password &#x27;root&#x27; -p&#x27;aUs6:3#hedu.&#x27;</span><br><span class="line">mysqladmin: [Warning] Using a password on the command line interface can be insecure.</span><br><span class="line">Warning: Since password will be sent to server in plain text, use ssl connection to ensure password safety.</span><br><span class="line">[root@localhost mysql]# mysql -uroot -proot</span><br><span class="line">mysql: [Warning] Using a password on the command line interface can be insecure.</span><br><span class="line">Welcome to the MySQL monitor.  Commands end with ; or \g.</span><br><span class="line">Your MySQL connection id is 7</span><br><span class="line">Server version: 5.7.36 MySQL Community Server (GPL)</span><br><span class="line">Copyright (c) 2000, 2021, Oracle and/or its affiliates.</span><br><span class="line">Oracle is a registered trademark of Oracle Corporation and/or its</span><br><span class="line">affiliates. Other names may be trademarks of their respective</span><br><span class="line">owners.</span><br><span class="line">Type &#x27;help;&#x27; or &#x27;\h&#x27; for help. Type &#x27;\c&#x27; to clear the current input statement.</span><br><span class="line"><span class="meta prompt_">mysql&gt;</span></span><br></pre></td></tr></table></figure>

<p>æ­¤å¤„å¦‚æœæŠ¥é”™ï¼š</p>
<p>cat: &#x2F;root&#x2F;.mysql_secret: æ²¡æœ‰é‚£ä¸ªæ–‡ä»¶æˆ–ç›®å½•</p>
<p>è§£å†³æ–¹æ¡ˆï¼šé‡ç½®å¯†ç ã€‚</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@localhost mysql]# vi /etc/my.cnf</span><br><span class="line">[mysqld]</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">å¿½ç•¥å¯†ç </span></span><br><span class="line">skip-grant-tables</span><br><span class="line">[root@localhost mysql]# mysql -uroot</span><br><span class="line">mysql: [Warning] Using a password on the command line interface can be insecure.</span><br><span class="line">Welcome to the MySQL monitor.  Commands end with ; or \g.</span><br><span class="line">Your MySQL connection id is 4</span><br><span class="line">Server version: 5.7.36 MySQL Community Server (GPL)</span><br><span class="line">Copyright (c) 2000, 2021, Oracle and/or its affiliates.</span><br><span class="line">Oracle is a registered trademark of Oracle Corporation and/or its</span><br><span class="line">affiliates. Other names may be trademarks of their respective</span><br><span class="line">owners.</span><br><span class="line">Type &#x27;help;&#x27; or &#x27;\h&#x27; for help. Type &#x27;\c&#x27; to clear the current input statement.</span><br><span class="line"><span class="meta prompt_">mysql&gt;</span><span class="language-bash">update mysql.user <span class="built_in">set</span> authentication_string=PASSWORD(<span class="string">&#x27;root&#x27;</span>) <span class="built_in">where</span> user=<span class="string">&#x27;root&#x27;</span>;</span></span><br><span class="line">Query OK, 1 row affected, 1 warning (0.00 sec)</span><br><span class="line">Rows matched: 1  Changed: 1  Warnings: 1</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">mysql&gt; </span><span class="language-bash">flush privileges;</span></span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br></pre></td></tr></table></figure>



<h5 id="ç¬¬å…«æ­¥ï¼šå¼€æ”¾ç«¯å£3306"><a href="#ç¬¬å…«æ­¥ï¼šå¼€æ”¾ç«¯å£3306" class="headerlink" title="ç¬¬å…«æ­¥ï¼šå¼€æ”¾ç«¯å£3306"></a>ç¬¬å…«æ­¥ï¼šå¼€æ”¾ç«¯å£3306</h5><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æŸ¥çœ‹å¼€æ”¾çš„ç«¯å£å·</span></span><br><span class="line">firewall-cmd --list-all</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">è®¾ç½®å¼€æ”¾çš„ç«¯å£å·</span></span><br><span class="line">firewall-cmd --add-service=mysql --permanent</span><br><span class="line">firewall-cmd --add-port=3306/tcp --permanent</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">é‡å¯é˜²ç«å¢™</span></span><br><span class="line">firewall-cmd --reload</span><br></pre></td></tr></table></figure>

<h5 id="ç¬¬ä¹æ­¥ï¼šè¿œç¨‹ç”¨æˆ·ç™»å½•"><a href="#ç¬¬ä¹æ­¥ï¼šè¿œç¨‹ç”¨æˆ·ç™»å½•" class="headerlink" title="ç¬¬ä¹æ­¥ï¼šè¿œç¨‹ç”¨æˆ·ç™»å½•"></a>ç¬¬ä¹æ­¥ï¼šè¿œç¨‹ç”¨æˆ·ç™»å½•</h5><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">mysql&gt; </span><span class="language-bash">update user <span class="built_in">set</span> host = <span class="string">&#x27;%&#x27;</span> <span class="built_in">where</span> user =<span class="string">&#x27;root&#x27;</span>;</span></span><br><span class="line">ERROR 1046 (3D000): No database selected</span><br><span class="line"><span class="meta prompt_">mysql&gt; </span><span class="language-bash">use mysql;</span></span><br><span class="line">ERROR 1820 (HY000): You must reset your password using ALTER USER statement before executing this statement.</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">è§£å†³ï¼šé‡ç½®å¯†ç </span></span><br><span class="line"><span class="meta prompt_">mysql&gt; </span><span class="language-bash"><span class="built_in">set</span> password=password(<span class="string">&#x27;root&#x27;</span>);</span></span><br><span class="line">Query OK, 0 rows affected, 1 warning (0.00 sec)</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">mysql&gt; </span><span class="language-bash">use mysql</span></span><br><span class="line">Reading table information for completion of table and column names</span><br><span class="line">You can turn off this feature to get a quicker startup with -A</span><br><span class="line"></span><br><span class="line">Database changed</span><br><span class="line"><span class="meta prompt_">mysql&gt; </span><span class="language-bash">select host, user from user;</span></span><br><span class="line">+-----------+---------------+</span><br><span class="line">| host      | user          |</span><br><span class="line">+-----------+---------------+</span><br><span class="line">| localhost | root          |</span><br><span class="line">| localhost | mysql.session |</span><br><span class="line">| localhost | mysql.sys     |</span><br><span class="line">+-----------+---------------+</span><br><span class="line">3 rows in set (0.00 sec)</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">ä¿®æ”¹ç”¨æˆ·ä¸ºrootçš„hostä¸º % ï¼Œ% é€šé…ç¬¦è¡¨ç¤ºä»»æ„ä¸»æœºéƒ½èƒ½è®¿é—®</span></span><br><span class="line"><span class="meta prompt_">mysql&gt;</span><span class="language-bash">update user <span class="built_in">set</span> host = <span class="string">&#x27;%&#x27;</span> <span class="built_in">where</span> user =<span class="string">&#x27;root&#x27;</span>;</span></span><br><span class="line"></span><br><span class="line">Query OK, 1 row affected (0.01 sec)</span><br><span class="line">Rows matched: 1  Changed: 1  Warnings: 0</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">åˆ·æ–°æƒé™</span></span><br><span class="line"><span class="meta prompt_">mysql&gt; </span><span class="language-bash">flush privileges;</span></span><br><span class="line">Query OK, 0 rows affected (0.01 sec)</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">mysql&gt; </span><span class="language-bash">select host, user from user;</span></span><br><span class="line">+-----------+---------------+</span><br><span class="line">| host      | user          |</span><br><span class="line">+-----------+---------------+</span><br><span class="line">| %         | root          |</span><br><span class="line">| localhost | mysql.session |</span><br><span class="line">| localhost | mysql.sys     |</span><br><span class="line">+-----------+---------------+</span><br><span class="line">3 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>

<h5 id="ç¬¬åæ­¥ï¼šç”¨æˆ·ç®¡ç†"><a href="#ç¬¬åæ­¥ï¼šç”¨æˆ·ç®¡ç†" class="headerlink" title="ç¬¬åæ­¥ï¼šç”¨æˆ·ç®¡ç†"></a>ç¬¬åæ­¥ï¼šç”¨æˆ·ç®¡ç†</h5><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">åˆ›å»ºç”¨æˆ·</span></span><br><span class="line">CREATE USER &#x27;liufei&#x27;@&#x27;%&#x27; IDENTIFIED BY &#x27;liufei&#x27;;</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">ä¿®æ”¹å¯†ç </span></span><br><span class="line">update mysql.user set authentication_string=password(&#x27;123456&#x27;) where user=&#x27;liufei&#x27;; </span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">ç”¨æˆ·æˆæƒ</span></span><br><span class="line">grant all privileges on æ•°æ®åº“å.* to &#x27;liufei&#x27;@&#x27;%&#x27;;</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">åˆ é™¤ç”¨æˆ·</span></span><br><span class="line">Delete FROM mysql.user Where user=&#x27;liufei&#x27;;</span><br></pre></td></tr></table></figure>

<h5 id="ç¬¬åä¸€æ­¥ï¼šé…ç½®æ–‡ä»¶è¯´æ˜"><a href="#ç¬¬åä¸€æ­¥ï¼šé…ç½®æ–‡ä»¶è¯´æ˜" class="headerlink" title="ç¬¬åä¸€æ­¥ï¼šé…ç½®æ–‡ä»¶è¯´æ˜"></a>ç¬¬åä¸€æ­¥ï¼šé…ç½®æ–‡ä»¶è¯´æ˜</h5><p><a href="https://blog.csdn.net/djcode/article/details/78621772">https://blog.csdn.net/djcode/article/details/78621772</a></p>
<h5 id="ç¬¬åäºŒæ­¥ï¼šä¹±ç é—®é¢˜"><a href="#ç¬¬åäºŒæ­¥ï¼šä¹±ç é—®é¢˜" class="headerlink" title="ç¬¬åäºŒæ­¥ï¼šä¹±ç é—®é¢˜"></a>ç¬¬åäºŒæ­¥ï¼šä¹±ç é—®é¢˜</h5><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">mysql&gt; </span><span class="language-bash">show variables like <span class="string">&#x27;%char%&#x27;</span>;</span></span><br><span class="line">+--------------------------+----------------------------------+</span><br><span class="line">| Variable_name            | Value                            |</span><br><span class="line">+--------------------------+----------------------------------+</span><br><span class="line">| character_set_client     | utf8                             |</span><br><span class="line">| character_set_connection | utf8                             |</span><br><span class="line">| character_set_database   | latin1                           |</span><br><span class="line">| character_set_filesystem | binary                           |</span><br><span class="line">| character_set_results    | utf8                             |</span><br><span class="line">| character_set_server     | latin1                           |</span><br><span class="line">| character_set_system     | utf8                             |</span><br><span class="line">| character_sets_dir       | /usr/local/mysql/share/charsets/ |</span><br><span class="line">+--------------------------+----------------------------------+</span><br><span class="line">8 rows in set (0.01 sec)</span><br></pre></td></tr></table></figure>

<p>åœ¨ &#x2F;etc ç›®å½•ä¸‹æ–°å»º my.cnfæ–‡ä»¶ï¼š</p>
<figure class="highlight tex"><table><tr><td class="code"><pre><span class="line">[client]</span><br><span class="line">default-character-set=utf8</span><br><span class="line"></span><br><span class="line">[mysql]</span><br><span class="line">no-beep</span><br><span class="line">default-character-set=utf8</span><br><span class="line"></span><br><span class="line">[mysqld]</span><br><span class="line">character-set-server=utf8</span><br></pre></td></tr></table></figure>

<p>é‡å¯ mysql æœåŠ¡ï¼ŒæŸ¥çœ‹å­—ç¬¦é›†ç¼–ç ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@localhost mysql]# service mysql restart</span><br><span class="line">Shutting down MySQL.... SUCCESS!</span><br><span class="line">Starting MySQL. SUCCESS!</span><br><span class="line">......</span><br><span class="line"><span class="meta prompt_">mysql&gt; </span><span class="language-bash">show variables like <span class="string">&#x27;%char%&#x27;</span>;</span></span><br><span class="line">+--------------------------+----------------------------------+</span><br><span class="line">| Variable_name            | Value                            |</span><br><span class="line">+--------------------------+----------------------------------+</span><br><span class="line">| character_set_client     | utf8                             |</span><br><span class="line">| character_set_connection | utf8                             |</span><br><span class="line">| character_set_database   | utf8                             |</span><br><span class="line">| character_set_filesystem | binary                           |</span><br><span class="line">| character_set_results    | utf8                             |</span><br><span class="line">| character_set_server     | utf8                             |</span><br><span class="line">| character_set_system     | utf8                             |</span><br><span class="line">| character_sets_dir       | /usr/local/mysql/share/charsets/ |</span><br><span class="line">+--------------------------+----------------------------------+</span><br><span class="line">8 rows in set (0.01 sec)</span><br></pre></td></tr></table></figure>

<h4 id="äºŒè¿›åˆ¶ç¼–è¯‘å®‰è£…"><a href="#äºŒè¿›åˆ¶ç¼–è¯‘å®‰è£…" class="headerlink" title="äºŒè¿›åˆ¶ç¼–è¯‘å®‰è£…"></a>äºŒè¿›åˆ¶ç¼–è¯‘å®‰è£…</h4><p>ç¯å¢ƒï¼šCentO S6.8 +  MySQL5.6</p>
<h5 id="ç¬¬ä¸€æ­¥ï¼šå®‰è£…ç¼–è¯‘ç¯å¢ƒ-gcc-c"><a href="#ç¬¬ä¸€æ­¥ï¼šå®‰è£…ç¼–è¯‘ç¯å¢ƒ-gcc-c" class="headerlink" title="ç¬¬ä¸€æ­¥ï¼šå®‰è£…ç¼–è¯‘ç¯å¢ƒ gcc-c++"></a>ç¬¬ä¸€æ­¥ï¼šå®‰è£…ç¼–è¯‘ç¯å¢ƒ gcc-c++</h5><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">yum -y install make gcc-c++ cmake bison-devel  ncurses-devel</span><br></pre></td></tr></table></figure>

<h5 id="ç¬¬äºŒæ­¥ï¼šè§£å‹å¹¶è¿›å…¥mysqlç›®å½•"><a href="#ç¬¬äºŒæ­¥ï¼šè§£å‹å¹¶è¿›å…¥mysqlç›®å½•" class="headerlink" title="ç¬¬äºŒæ­¥ï¼šè§£å‹å¹¶è¿›å…¥mysqlç›®å½•"></a>ç¬¬äºŒæ­¥ï¼šè§£å‹å¹¶è¿›å…¥mysqlç›®å½•</h5><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">tar xvf mysql-5.6.14.tar.gz</span><br><span class="line">cd mysql-5.6.14</span><br></pre></td></tr></table></figure>

<h5 id="ç¬¬ä¸‰æ­¥ï¼šç¼–è¯‘"><a href="#ç¬¬ä¸‰æ­¥ï¼šç¼–è¯‘" class="headerlink" title="ç¬¬ä¸‰æ­¥ï¼šç¼–è¯‘"></a>ç¬¬ä¸‰æ­¥ï¼šç¼–è¯‘</h5><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">cmake -DCMAKE_INSTALL_PREFIX=/usr/local/mysql -DMYSQL_DATADIR=/usr/local/mysql/data -DSYSCONFDIR=/etc -DWITH_MYISAM_STORAGE_ENGINE=1 -DWITH_INNOBASE_STORAGE_ENGINE=1 -DWITH_MEMORY_STORAGE_ENGINE=1 -DWITH_READLINE=1 -DMYSQL_UNIX_ADDR=/var/lib/mysql/mysql.sock -DMYSQL_TCP_PORT=3306 -DENABLED_LOCAL_INFILE=1 -DWITH_PARTITION_STORAGE_ENGINE=1 -DEXTRA_CHARSETS=all -DDEFAULT_CHARSET=utf8 -DDEFAULT_COLLATION=utf8_general_ci</span><br></pre></td></tr></table></figure>

<h5 id="ç¬¬å››æ­¥ï¼šå®‰è£…"><a href="#ç¬¬å››æ­¥ï¼šå®‰è£…" class="headerlink" title="ç¬¬å››æ­¥ï¼šå®‰è£…"></a>ç¬¬å››æ­¥ï¼šå®‰è£…</h5><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">make &amp;&amp; make install</span><br></pre></td></tr></table></figure>

<h5 id="ç¬¬äº”æ­¥ï¼šè®¾ç½®æƒé™"><a href="#ç¬¬äº”æ­¥ï¼šè®¾ç½®æƒé™" class="headerlink" title="ç¬¬äº”æ­¥ï¼šè®¾ç½®æƒé™"></a>ç¬¬äº”æ­¥ï¼šè®¾ç½®æƒé™</h5><p>â€‹		æŸ¥çœ‹æ˜¯å¦æœ‰mysqlç”¨æˆ·åŠç”¨æˆ·ç»„ï¼Œæ²¡æœ‰åˆ™åˆ›å»º</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">cat /etc/passwd | grep -i mysql</span><br><span class="line">cat /etc/group | grep -i mysql</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æ²¡æœ‰åˆ™åˆ›å»º</span></span><br><span class="line">groupadd mysql</span><br><span class="line">useradd -g mysql mysql</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">ä¿®æ”¹/usr/local/mysqlæƒé™</span></span><br><span class="line">chown -R mysqlï¼šmysql /usr/local/mysql</span><br></pre></td></tr></table></figure>

<h5 id="ç¬¬å…­æ­¥ï¼šåˆå§‹åŒ–é…ç½®"><a href="#ç¬¬å…­æ­¥ï¼šåˆå§‹åŒ–é…ç½®" class="headerlink" title="ç¬¬å…­æ­¥ï¼šåˆå§‹åŒ–é…ç½®"></a>ç¬¬å…­æ­¥ï¼šåˆå§‹åŒ–é…ç½®</h5><p>â€‹		è¿›å…¥å®‰è£…è·¯å¾„ï¼ˆåœ¨æ‰§è¡Œä¸‹é¢çš„æŒ‡ä»¤ï¼‰ï¼Œæ‰§è¡Œåˆå§‹åŒ–é…ç½®è„šæœ¬ï¼Œåˆ›å»ºç³»ç»Ÿè‡ªå¸¦çš„æ•°æ®åº“å’Œè¡¨</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">cd /usr/local/mysql</span><br><span class="line">scripts/mysql_install_db --basedir=/usr/local/mysql --datadir=/usr/local/mysql/data --user=mysql</span><br></pre></td></tr></table></figure>

<p>æ³¨æ„ï¼š</p>
<p>â€‹		åœ¨å¯åŠ¨MySQLæœåŠ¡æ—¶ï¼Œä¼šæŒ‰ç…§ä¸€å®šæ¬¡åºæœç´¢ my.cnf ï¼Œå…ˆåœ¨ &#x2F;etc ç›®å½•ä¸‹æ‰¾ï¼Œæ‰¾ä¸åˆ°åˆ™ä¼šæœç´¢ â€œ$basedir&#x2F;my.cnfâ€ï¼Œåœ¨æœ¬ä¾‹ä¸­å°±æ˜¯ &#x2F;usr&#x2F;local&#x2F;mysql&#x2F;my.cnfï¼Œè¿™æ˜¯æ–°ç‰ˆMySQLçš„é…ç½®æ–‡ä»¶çš„é»˜è®¤ä½ç½®ã€‚</p>
<p>â€‹		åœ¨CentOS 6.8ç‰ˆæ“ä½œç³»ç»Ÿçš„æœ€å°å®‰è£…å®Œæˆåï¼Œåœ¨&#x2F;etcç›®å½•ä¸‹ä¼šå­˜åœ¨ä¸€ä¸ªmy.cnfï¼Œéœ€è¦å°†æ­¤æ–‡ä»¶æ›´åä¸ºå…¶ä»–çš„åå­—ï¼Œå¦‚ï¼š&#x2F;etc&#x2F;my.cnf.bakï¼Œå¦åˆ™ï¼Œè¯¥æ–‡ä»¶ä¼šå¹²æ‰°æºç å®‰è£…çš„MySQLçš„æ­£ç¡®é…ç½®ï¼Œé€ æˆæ— æ³•å¯åŠ¨ã€‚</p>
<p>ä¿®æ”¹åç§°ï¼Œé˜²æ­¢å¹²æ‰°ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">mv /etc/my.cnf  /etc/my.cnf.bak</span><br></pre></td></tr></table></figure>

<h5 id="ç¬¬ä¸ƒæ­¥ï¼šå¯åŠ¨MySQL"><a href="#ç¬¬ä¸ƒæ­¥ï¼šå¯åŠ¨MySQL" class="headerlink" title="ç¬¬ä¸ƒæ­¥ï¼šå¯åŠ¨MySQL"></a>ç¬¬ä¸ƒæ­¥ï¼šå¯åŠ¨MySQL</h5><p>æ·»åŠ æœåŠ¡ï¼Œæ‹·è´æœåŠ¡è„šæœ¬åˆ°init.dç›®å½•ï¼Œå¹¶è®¾ç½®å¼€æœºå¯åŠ¨ </p>
<p>æ³¨æ„åœ¨ &#x2F;usr&#x2F;local&#x2F;mysql ä¸‹æ‰§è¡Œ</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">cp support-files/mysql.server /etc/init.d/mysql</span><br><span class="line">chkconfig mysql on</span><br><span class="line">service mysql start --å¯åŠ¨MySQL</span><br></pre></td></tr></table></figure>

<h5 id="ç¬¬å…«æ­¥ï¼šä¿®æ”¹rootå¯†ç "><a href="#ç¬¬å…«æ­¥ï¼šä¿®æ”¹rootå¯†ç " class="headerlink" title="ç¬¬å…«æ­¥ï¼šä¿®æ”¹rootå¯†ç "></a>ç¬¬å…«æ­¥ï¼šä¿®æ”¹rootå¯†ç </h5><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">cd /usr/local/mysql/bin</span><br><span class="line">./mysql -uroot </span><br><span class="line"><span class="meta prompt_">mysql&gt; </span><span class="language-bash">SET PASSWORD = PASSWORD(<span class="string">&#x27;root&#x27;</span>);</span></span><br></pre></td></tr></table></figure>

<h4 id="RPMå®‰è£…"><a href="#RPMå®‰è£…" class="headerlink" title="RPMå®‰è£…"></a>RPMå®‰è£…</h4><p>â€‹		ç¯å¢ƒï¼šCentOS7.9 + MySQL5.7.36</p>
<p>æ‹·è´å®‰è£…åŒ…è‡³ &#x2F;opt ç›®å½•å¹¶è§£å‹ï¼š</p>
<p>æŸ¥è¯¢æ˜¯å¦å·²ç»å®‰è£…ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">rpm â€“qa|grep â€“i mysql</span><br><span class="line">ps â€“ef|grep mysql</span><br><span class="line">service mysql start</span><br><span class="line">cat /etc/passwd |grep mysql</span><br><span class="line">cat /etc/group</span><br><span class="line">mysqlè®¾ç½®å¯†ç ï¼šmysqladmin â€“u root password 123456</span><br><span class="line">mysqlçš„è‡ªå¯åŠ¨ï¼šchkconfig mysql on</span><br><span class="line">chkconfig â€“list|grep mysql</span><br><span class="line">mysqlæ•°æ®åº“æ–‡ä»¶çš„å­˜å‚¨ä½ç½®ï¼š</span><br><span class="line">ps -ef|grep mysql</span><br><span class="line">äºŒè¿›åˆ¶å®‰è£…ï¼š/usr/local/mysql/data</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>RPMå½¢å¼å®‰è£…ç›®å½•è¯´æ˜ï¼š</p>
<table>
<thead>
<tr>
<th>è·¯å¾„</th>
<th>è¯´æ˜</th>
<th>å¤‡æ³¨</th>
</tr>
</thead>
<tbody><tr>
<td>&#x2F;var&#x2F;lib&#x2F;myql</td>
<td>mysqlæ•°æ®åº“æ–‡ä»¶çš„å­˜æ”¾è·¯å¾„</td>
<td></td>
</tr>
<tr>
<td>&#x2F;usr&#x2F;share&#x2F;mysql</td>
<td>é…ç½®æ–‡ä»¶ç›®å½•</td>
<td>mysql.serverå‘½ä»¤åŠå…¶é…ç½®</td>
</tr>
<tr>
<td>&#x2F;usr&#x2F;bin</td>
<td>ç›¸å…³å‘½ä»¤ç›®å½•</td>
<td>mysqladmin mysqldumpç­‰å‘½ä»¤</td>
</tr>
<tr>
<td>&#x2F;etc&#x2F;init.d&#x2F;mysql</td>
<td>å¯åŠ¨åœæ­¢ç›¸å…³è„šæœ¬</td>
<td></td>
</tr>
</tbody></table>
<h3 id="MySQL8-ç‰ˆæœ¬å®‰è£…"><a href="#MySQL8-ç‰ˆæœ¬å®‰è£…" class="headerlink" title="MySQL8 ç‰ˆæœ¬å®‰è£…"></a>MySQL8 ç‰ˆæœ¬å®‰è£…</h3><h2 id="MySQLå¸è½½"><a href="#MySQLå¸è½½" class="headerlink" title="MySQLå¸è½½"></a>MySQLå¸è½½</h2><h3 id="RPMå¸è½½"><a href="#RPMå¸è½½" class="headerlink" title="RPMå¸è½½"></a>RPMå¸è½½</h3><h3 id="äºŒè¿›åˆ¶æºç å¸è½½"><a href="#äºŒè¿›åˆ¶æºç å¸è½½" class="headerlink" title="äºŒè¿›åˆ¶æºç å¸è½½"></a>äºŒè¿›åˆ¶æºç å¸è½½</h3><h1 id="MySQL-é€»è¾‘æ¶æ„ä¸å­˜å‚¨å¼•æ“"><a href="#MySQL-é€»è¾‘æ¶æ„ä¸å­˜å‚¨å¼•æ“" class="headerlink" title="MySQL é€»è¾‘æ¶æ„ä¸å­˜å‚¨å¼•æ“"></a>MySQL é€»è¾‘æ¶æ„ä¸å­˜å‚¨å¼•æ“</h1><h2 id="é€»è¾‘æ¶æ„"><a href="#é€»è¾‘æ¶æ„" class="headerlink" title="é€»è¾‘æ¶æ„"></a>é€»è¾‘æ¶æ„</h2><p><img src="/2023/02/28/MySQL/Java\Document\MySQL\MySQL.assets\image-20221006162514210.png" alt="image-20221006162514210"></p>
<p>1.è¿æ¥å±‚</p>
<p>â€‹		æœ€ä¸Šå±‚æ˜¯ä¸€äº›å®¢æˆ·ç«¯å’Œè¿æ¥æœåŠ¡ï¼ŒåŒ…å«æœ¬åœ°socketé€šä¿¡å’Œå¤§å¤šæ•°åŸºäºå®¢æˆ·ç«¯&#x2F;æœåŠ¡ç«¯å·¥å…·ç±»ä¼¼äº tcp&#x2F;ip çš„é€šä¿¡ï¼Œä¸»è¦å®Œæˆä¸€äº›ç±»ä¼¼äºè¿æ¥å¤„ç†ã€æˆæƒè®¤è¯ç­‰ç›¸å…³çš„å®‰å…¨è§£å†³æ–¹æ¡ˆï¼Œè¯¥å±‚å¼•å…¥äº†çº¿ç¨‹æ± çš„æ¦‚å¿µï¼Œä¸ºé€šè¿‡è®¤è¯å®‰å…¨æ¥å…¥çš„å®¢æˆ·ç«¯æä¾›çº¿ç¨‹ï¼ŒåŒæ ·è¯¥å±‚å¯ä»¥å®ç°åŸºäºSSLçš„å®‰å…¨é“¾æ¥ï¼ŒæœåŠ¡å™¨ä¹Ÿä¼šä¸ºæ¯ä¸ªå®‰å…¨æ¥å…¥çš„å®¢æˆ·ç«¯éªŒè¯å®ƒæ‰€å…·æœ‰çš„æ“ä½œæƒé™ã€‚</p>
<p>2.æœåŠ¡å±‚</p>
<p>â€‹		ç¬¬äºŒå±‚æ¶æ„çš„ä¸»è¦å·¥ä½œå®Œæˆå¤§å¤šæ•°çš„æ ¸å¿ƒæœåŠ¡åŠŸèƒ½ï¼Œå¦‚SQLæ¥å£ï¼Œå¹¶å®Œæˆç¼“å­˜çš„æŸ¥è¯¢ï¼ŒSQLåˆ†æå’Œä¼˜åŒ–ä»¥åŠéƒ¨åˆ†å†…ç½®å‡½æ•°çš„æ‰§è¡Œï¼Œæ‰€æœ‰è·¨å­˜å‚¨å¼•æ“çš„åŠŸèƒ½ä¹Ÿåœ¨è¿™ä¸€å±‚å®ç°ï¼Œå¦‚è¿‡ç¨‹ã€å‡½æ•°ç­‰ï¼Œåœ¨è¯¥å±‚ï¼ŒæœåŠ¡å™¨ä¼šè§£ææŸ¥è¯¢ï¼Œåˆ›å»ºç›¸åº”çš„è§£ææ ‘ï¼Œå¹¶å®Œæˆç›¸åº”çš„ä¼˜åŒ–å¦‚ç¡®å®šæŸ¥è¯¢è¡¨çš„é¡ºåºï¼Œæ˜¯å¦åˆ©ç”¨ç´¢å¼•ç­‰ï¼Œæœ€åç”Ÿæˆç›¸åº”çš„æ‰§è¡Œæ“ä½œï¼Œå¦‚æœæ˜¯SELECTè¯­å¥ï¼ŒæœåŠ¡å™¨è¿˜ä¼šæŸ¥è¯¢å†…éƒ¨çš„ç¼“å­˜ï¼Œå¦‚æœç¼“å­˜çš„ç©ºé—´è¶³å¤Ÿå¤§ï¼Œå¯ä»¥è§£å†³å¤§é‡è¯»æ“ä½œçš„ç¯å¢ƒä¸­èƒ½å¤Ÿå¾ˆå¥½çš„æå‡ç³»ç»Ÿçš„æ€§èƒ½ã€‚</p>
<p>3.å¼•æ“å±‚</p>
<p>å­˜å‚¨å¼•æ“å±‚ï¼Œå­˜å‚¨å¼•æ“å±‚çœŸæ­£è´Ÿè´£MySQLçš„æ•°æ®å­˜å‚¨å’Œè¯»å–ï¼Œå³å¦‚ä½•å­˜å‚¨å’Œç´¢å¼•æ•°æ®ã€æ˜¯å¦æ”¯æŒäº‹åŠ¡ç­‰ï¼ŒæœåŠ¡å™¨é€šè¿‡APIä¸å­˜å‚¨å¼•æ“è¿›è¡Œé€šä¿¡ï¼Œä¸åŒçš„å­˜å‚¨å¼•æ“å…·æœ‰ä¸åŒçš„åŠŸèƒ½ï¼Œå¸¸ç”¨çš„æœ‰å’ŒMyISAMå’ŒInnoDBã€‚</p>
<p>4.å­˜å‚¨å±‚</p>
<p>æ•°æ®å­˜å‚¨å±‚ï¼Œä¸»è¦å°†æ•°æ®å­˜å‚¨åœ¨æ–‡ä»¶ç³»ç»Ÿä¸Šï¼Œå®Œæˆäºå­˜å‚¨å¼•æ“çš„äº¤äº’ã€‚</p>
<h2 id="å­˜å‚¨å¼•æ“"><a href="#å­˜å‚¨å¼•æ“" class="headerlink" title="å­˜å‚¨å¼•æ“"></a>å­˜å‚¨å¼•æ“</h2><ol>
<li>show engines;	ã€æŸ¥çœ‹MySQLæä¾›çš„å­˜å‚¨å¼•æ“ã€‘</li>
<li>show variables like â€˜%storage_engine%â€™;      ã€æŸ¥çœ‹MySQLé»˜è®¤çš„å­˜å‚¨å¼•æ“ã€‘</li>
</ol>
<p><img src="/2023/02/28/MySQL/Java\Document\MySQL\MySQL.assets\image-20221006165647546.png" alt="image-20221006165647546"></p>
<p>Supportï¼š æ˜¯å¦æ”¯æŒï¼ˆdefaultï¼‰ã€‚</p>
<p>Commentï¼šæ³¨é‡Šã€è¯´æ˜ã€‚</p>
<p>Transactionsï¼šæ˜¯å¦æ”¯æŒäº‹åŠ¡ã€‚</p>
<p>XAï¼šæ‰€æ”¯æŒçš„åˆ†å¸ƒå¼äº‹åŠ¡æ˜¯å¦ç¬¦åˆXAè§„èŒƒã€‚</p>
<p>Savepointsï¼š æ˜¯å¦æ”¯æŒäº‹åŠ¡ä¸­çš„ä¿å­˜ç‚¹ã€‚  </p>
<p><strong>æ³¨æ„ï¼šä»¥ ï¼› \g \G éƒ½è¡¨ç¤ºè¯­å¥ç»“æŸã€‚</strong></p>
<h2 id="MyISAM-å’Œ-InnoDB-çš„å¯¹æ¯”"><a href="#MyISAM-å’Œ-InnoDB-çš„å¯¹æ¯”" class="headerlink" title="MyISAM å’Œ InnoDB çš„å¯¹æ¯”"></a>MyISAM å’Œ InnoDB çš„å¯¹æ¯”</h2><table>
<thead>
<tr>
<th>å¯¹æ¯”é¡¹</th>
<th>MyISAM</th>
<th>InnoDB</th>
</tr>
</thead>
<tbody><tr>
<td>ä¸»å¤–é”®</td>
<td>ä¸æ”¯æŒ</td>
<td>æ”¯æŒ</td>
</tr>
<tr>
<td>äº‹åŠ¡</td>
<td>ä¸æ”¯æŒ</td>
<td>æ”¯æŒ</td>
</tr>
<tr>
<td>è¡Œè¡¨é”</td>
<td>è¡¨é”ï¼Œå³ä½¿æ“ä½œä¸€è¡Œè®°å½•ä¹Ÿä¼šé”ä½æ•´ä¸ªè¡¨ï¼Œä¸é€‚åˆé«˜å¹¶å‘æ“ä½œ</td>
<td>è¡Œé”ï¼Œæ“ä½œæ—¶åªé”ä½ä¸€è¡Œï¼Œä¸å¯¹å…¶ä»–è¡Œäº§ç”Ÿå½±å“</td>
</tr>
<tr>
<td>ç¼“å­˜</td>
<td>åªç¼“å­˜ç´¢å¼•ï¼Œä¸ç¼“å­˜çœŸå®æ•°æ®</td>
<td>ä¸ä»…ç¼“å­˜ç´¢å¼•ä¸”ç¼“å­˜çœŸå®æ•°æ®ï¼Œå¯¹å†…å­˜è¦æ±‚çš„é«˜ï¼Œä¸”å†…å­˜å¤§å°å¯¹æ€§èƒ½çš„å½±å“è¾ƒå¤§</td>
</tr>
<tr>
<td>è¡¨ç©ºé—´</td>
<td>å°</td>
<td>å¤§</td>
</tr>
<tr>
<td>å…³æ³¨ç‚¹</td>
<td>æ€§èƒ½</td>
<td>äº‹åŠ¡</td>
</tr>
<tr>
<td>é»˜è®¤å®‰è£…</td>
<td>æ˜¯</td>
<td>æ˜¯</td>
</tr>
</tbody></table>
<p>æ€»ç»“ï¼š</p>
<ol>
<li><p>MyISAMï¼š ä¸æ”¯æŒäº‹åŠ¡ã€å¤–é”®ç­‰ï¼Œè®¿é—®é€Ÿåº¦æ¯”è¾ƒå¿«ï¼Œå¯¹äº‹åŠ¡å®Œæ•´æ€§æ²¡æœ‰è¦æ±‚ã€‚</p>
</li>
<li><p>InnoDBï¼š æ”¯æŒäº‹åŠ¡ï¼ˆæäº¤ã€å›é¿ã€å´©æºƒæ¢å¤ç­‰ï¼‰ï¼Œå¹¶å‘æ§åˆ¶ç­‰ï¼Œå ç”¨æ›´å¤šç£ç›˜ã€‚</p>
</li>
<li><p>MEMORYï¼š ä½¿ç”¨å†…å­˜å­˜å‚¨æ•°æ®ï¼Œè®¿é—®é€Ÿåº¦å¿«ï¼Œä½†å®‰å…¨æ²¡æœ‰ä¿éšœã€‚</p>
</li>
</ol>
<h1 id="ç´¢å¼•ä¼˜åŒ–åˆ†æ"><a href="#ç´¢å¼•ä¼˜åŒ–åˆ†æ" class="headerlink" title="ç´¢å¼•ä¼˜åŒ–åˆ†æ"></a>ç´¢å¼•ä¼˜åŒ–åˆ†æ</h1><h2 id="é’ˆå¯¹çš„é—®é¢˜åŠå…¶åŸå› "><a href="#é’ˆå¯¹çš„é—®é¢˜åŠå…¶åŸå› " class="headerlink" title="é’ˆå¯¹çš„é—®é¢˜åŠå…¶åŸå› "></a>é’ˆå¯¹çš„é—®é¢˜åŠå…¶åŸå› </h2><p>é’ˆå¯¹é—®é¢˜ï¼š<strong>æ€§èƒ½ä¸‹é™SQLæ…¢ã€æ‰§è¡Œæ—¶é—´é•¿ã€ç­‰å¾…æ—¶é—´é•¿ã€‚</strong></p>
<p><strong>é—®é¢˜åŸå› </strong></p>
<ol>
<li><p>æŸ¥è¯¢è¯­å¥å†™çš„ä¸å¥½ã€‚</p>
</li>
<li><p>ç´¢å¼•å¤±æ•ˆã€‚ï¼ˆç´¢å¼•å»ºç«‹ï¼Œä½†æ²¡æœ‰ä½¿ç”¨åˆ°ï¼‰</p>
</li>
<li><p>å…³è”å¤ªå¤šçš„ JOINï¼ˆè®¾è®¡çš„ç¼ºé™·æˆ–ä¸å¾—å·²çš„éœ€æ±‚ï¼‰ã€‚</p>
</li>
<li><p>æœåŠ¡å™¨è°ƒä¼˜åŠå„ä¸ªå‚æ•°è®¾ç½®ï¼ˆç¼“å†²ã€çº¿ç¨‹æ•°é‡ç­‰ï¼‰ã€‚</p>
</li>
</ol>
<p>è§£å†³ï¼šå…ˆtop å‘½ä»¤ï¼ŒæŸ¥çœ‹ç£ç›˜ç©ºé—´ã€‚å†å¤ç°é—®é¢˜ï¼Œè€ƒè™‘è§£å†³æ–¹å¼ã€‚</p>
<p>å»ºç«‹ç´¢å¼•ç¤ºä¾‹ï¼š</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- userè¡¨çš„nameå­—æ®µï¼Œã€idx ç´¢å¼• userè¡¨å nameå­—æ®µåã€‘</span></span><br><span class="line"><span class="comment">-- å•å€¼ç´¢å¼•</span></span><br><span class="line"><span class="keyword">create</span> index idx_user_name <span class="keyword">on</span> <span class="keyword">user</span>(name);</span><br><span class="line"><span class="comment">-- å¤šå€¼ç´¢å¼•</span></span><br><span class="line"><span class="keyword">create</span> index idx_user_nameEmail <span class="keyword">on</span> <span class="keyword">user</span>(name,email);</span><br></pre></td></tr></table></figure>

<h2 id="é€šç”¨çš„JOINæŸ¥è¯¢"><a href="#é€šç”¨çš„JOINæŸ¥è¯¢" class="headerlink" title="é€šç”¨çš„JOINæŸ¥è¯¢"></a>é€šç”¨çš„JOINæŸ¥è¯¢</h2><h3 id="SQLé¡ºåº"><a href="#SQLé¡ºåº" class="headerlink" title="SQLé¡ºåº"></a>SQLé¡ºåº</h3><p>SQLä¹¦å†™é¡ºåºï¼š</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> </span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line"><span class="keyword">JOIN</span> <span class="keyword">ON</span></span><br><span class="line"><span class="keyword">WHERE</span></span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span></span><br><span class="line"><span class="keyword">HAVING</span></span><br><span class="line"><span class="keyword">DISTINCT</span></span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span></span><br><span class="line">LIMIT</span><br></pre></td></tr></table></figure>

<p>SQLæ‰§è¡Œé¡ºåºï¼š</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">FROM</span></span><br><span class="line"><span class="keyword">JOIN</span> <span class="keyword">ON</span></span><br><span class="line"><span class="keyword">WHERE</span></span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span></span><br><span class="line"><span class="keyword">HAVING</span></span><br><span class="line"><span class="keyword">SELECT</span></span><br><span class="line"><span class="keyword">DISTINCT</span></span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span></span><br><span class="line">LIMIT</span><br></pre></td></tr></table></figure>

<h3 id="7ç§JOINç†è®º"><a href="#7ç§JOINç†è®º" class="headerlink" title="7ç§JOINç†è®º"></a>7ç§JOINç†è®º</h3><p>æ³¨æ„ï¼š<strong>MySQLä¸æ”¯æŒæœ€ä¸‹é¢JOINç†è®º</strong></p>
<p><img src="/2023/02/28/MySQL/Java\Document\MySQL\MySQL.assets\image-20221006172123361.png" alt="image-20221006172123361"></p>
<p>åˆ›å»ºæµ‹è¯•è¡¨ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">CREATE DATABASE db_join;</span><br><span class="line">USE db_join;</span><br><span class="line">CREATE TABLE tbl_dept (</span><br><span class="line">	id INT ( 11 ) NOT NULL auto_increment,</span><br><span class="line">	deptName VARCHAR ( 30 ) DEFAULT NULL,</span><br><span class="line">	locAddr VARCHAR ( 40 ) DEFAULT NULL,</span><br><span class="line">	PRIMARY KEY ( id ) </span><br><span class="line">) ENGINE = INNODB auto_increment = 1 DEFAULT charset = utf8;</span><br><span class="line">CREATE TABLE tbl_emp (</span><br><span class="line">	id INT ( 11 ) NOT NULL auto_increment,</span><br><span class="line">	NAME VARCHAR ( 20 ) DEFAULT NULL,</span><br><span class="line">	deptId INT ( 11 ) DEFAULT NULL,</span><br><span class="line">	PRIMARY KEY ( id ),</span><br><span class="line">	KEY fk_dept_id ( deptId ) #constraint fk_dept_id foreign key(deptId) references tbl_dept(id)</span><br><span class="line">	</span><br><span class="line">) ENGINE = INNODB auto_increment = 1 DEFAULT charset = utf8;</span><br><span class="line"></span><br><span class="line">insert into tbl_dept(deptName,locAddr) values(&quot;RD&quot;,&quot;GanSu&quot;);</span><br><span class="line">insert into tbl_dept(deptName,locAddr) values(&quot;HR&quot;,&quot;XiAN&quot;);</span><br><span class="line">insert into tbl_dept(deptName,locAddr) values(&quot;MK&quot;,&quot;BeiJing&quot;);</span><br><span class="line">insert into tbl_dept(deptName,locAddr) values(&quot;MIS&quot;,&quot;ShangHai&quot;);</span><br><span class="line">insert into tbl_dept(deptName,locAddr) values(&quot;FD&quot;,&quot;ShenZhen&quot;);</span><br><span class="line"></span><br><span class="line">insert into tbl_emp(name,deptId) values(&quot;E1&quot;,1);</span><br><span class="line">insert into tbl_emp(name,deptId) values(&quot;E2&quot;,1);</span><br><span class="line">insert into tbl_emp(name,deptId) values(&quot;E3&quot;,1);</span><br><span class="line"></span><br><span class="line">insert into tbl_emp(name,deptId) values(&quot;EA&quot;,2);</span><br><span class="line">insert into tbl_emp(name,deptId) values(&quot;EB&quot;,2);</span><br><span class="line"></span><br><span class="line">insert into tbl_emp(name,deptId) values(&quot;W1&quot;,3);</span><br><span class="line">insert into tbl_emp(name,deptId) values(&quot;W2&quot;,4);</span><br><span class="line">insert into tbl_emp(name,deptId) values(&quot;W3&quot;,51);</span><br></pre></td></tr></table></figure>

<p>æŸ¥è¯¢è¡¨æ•°æ®ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">mysql&gt; use db_join;</span><br><span class="line">Reading table information for completion of table and column names</span><br><span class="line">You can turn off this feature to get a quicker startup with -A</span><br><span class="line">Database changed</span><br><span class="line">mysql&gt; select * from tbl_emp;</span><br><span class="line">+----+------+--------+</span><br><span class="line">| id | NAME | deptId |</span><br><span class="line">+----+------+--------+</span><br><span class="line">|  1 | E1   |      1 |</span><br><span class="line">|  2 | E2   |      1 |</span><br><span class="line">|  3 | E3   |      1 |</span><br><span class="line">|  4 | EA   |      2 |</span><br><span class="line">|  5 | EB   |      2 |</span><br><span class="line">|  6 | W1   |      3 |</span><br><span class="line">|  7 | W2   |      4 |</span><br><span class="line">|  8 | W3   |     51 |</span><br><span class="line">+----+------+--------+</span><br><span class="line">8 rows in set (0.00 sec)</span><br><span class="line">mysql&gt; select * from tbl_dept;</span><br><span class="line">+----+----------+----------+</span><br><span class="line">| id | deptName | locAddr  |</span><br><span class="line">+----+----------+----------+</span><br><span class="line">|  1 | RD       | GanSu    |</span><br><span class="line">|  2 | HR       | XiAN     |</span><br><span class="line">|  3 | MK       | BeiJing  |</span><br><span class="line">|  4 | MIS      | ShangHai |</span><br><span class="line">|  5 | FD       | ShenZhen |</span><br><span class="line">+----+----------+----------+</span><br><span class="line">5 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>

<h4 id="æƒ…å†µä¸€ï¼šä¸¤ä¸ªè¡¨çš„äº¤é›†æ•°æ®"><a href="#æƒ…å†µä¸€ï¼šä¸¤ä¸ªè¡¨çš„äº¤é›†æ•°æ®" class="headerlink" title="æƒ…å†µä¸€ï¼šä¸¤ä¸ªè¡¨çš„äº¤é›†æ•°æ®"></a>æƒ…å†µä¸€ï¼šä¸¤ä¸ªè¡¨çš„äº¤é›†æ•°æ®</h4><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">mysql&gt; select * from tbl_emp e inner join tbl_dept d on e.deptId = d.id;</span><br><span class="line">+----+------+--------+----+----------+----------+</span><br><span class="line">| id | NAME | deptId | id | deptName | locAddr  |</span><br><span class="line">+----+------+--------+----+----------+----------+</span><br><span class="line">|  1 | E1   |      1 |  1 | RD       | GanSu    |</span><br><span class="line">|  2 | E2   |      1 |  1 | RD       | GanSu    |</span><br><span class="line">|  3 | E3   |      1 |  1 | RD       | GanSu    |</span><br><span class="line">|  4 | EA   |      2 |  2 | HR       | XiAN     |</span><br><span class="line">|  5 | EB   |      2 |  2 | HR       | XiAN     |</span><br><span class="line">|  6 | W1   |      3 |  3 | MK       | BeiJing  |</span><br><span class="line">|  7 | W2   |      4 |  4 | MIS      | ShangHai |</span><br><span class="line">+----+------+--------+----+----------+----------+</span><br><span class="line">7 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>

<h4 id="æƒ…å†µäºŒï¼šä»¥è¡¨-tbl-emp-ä¸ºä¸»è¡¨å…³è”-tbl-dept"><a href="#æƒ…å†µäºŒï¼šä»¥è¡¨-tbl-emp-ä¸ºä¸»è¡¨å…³è”-tbl-dept" class="headerlink" title="æƒ…å†µäºŒï¼šä»¥è¡¨ tbl_emp ä¸ºä¸»è¡¨å…³è” tbl_dept"></a>æƒ…å†µäºŒï¼šä»¥è¡¨ tbl_emp ä¸ºä¸»è¡¨å…³è” tbl_dept</h4><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">mysql&gt; select * from tbl_emp e left join tbl_dept d on e.deptId = d.id;</span><br><span class="line">+----+------+--------+------+----------+----------+</span><br><span class="line">| id | NAME | deptId | id   | deptName | locAddr  |</span><br><span class="line">+----+------+--------+------+----------+----------+</span><br><span class="line">|  1 | E1   |      1 |    1 | RD       | GanSu    |</span><br><span class="line">|  2 | E2   |      1 |    1 | RD       | GanSu    |</span><br><span class="line">|  3 | E3   |      1 |    1 | RD       | GanSu    |</span><br><span class="line">|  4 | EA   |      2 |    2 | HR       | XiAN     |</span><br><span class="line">|  5 | EB   |      2 |    2 | HR       | XiAN     |</span><br><span class="line">|  6 | W1   |      3 |    3 | MK       | BeiJing  |</span><br><span class="line">|  7 | W2   |      4 |    4 | MIS      | ShangHai |</span><br><span class="line">|  8 | W3   |     51 | NULL | NULL     | NULL     |</span><br><span class="line">+----+------+--------+------+----------+----------+</span><br><span class="line">8 rows in set (0.01 sec)</span><br></pre></td></tr></table></figure>

<h4 id="æƒ…å†µä¸‰ï¼šä»¥-tbl-deptä¸ºä¸»è¡¨å…³è”-tbl-empè¡¨"><a href="#æƒ…å†µä¸‰ï¼šä»¥-tbl-deptä¸ºä¸»è¡¨å…³è”-tbl-empè¡¨" class="headerlink" title="æƒ…å†µä¸‰ï¼šä»¥ tbl_deptä¸ºä¸»è¡¨å…³è” tbl_empè¡¨"></a>æƒ…å†µä¸‰ï¼šä»¥ tbl_deptä¸ºä¸»è¡¨å…³è” tbl_empè¡¨</h4><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">mysql&gt; select * from tbl_emp e right join tbl_dept d on e.deptId = d.id;</span><br><span class="line">+------+------+--------+----+----------+----------+</span><br><span class="line">| id   | NAME | deptId | id | deptName | locAddr  |</span><br><span class="line">+------+------+--------+----+----------+----------+</span><br><span class="line">|    1 | E1   |      1 |  1 | RD       | GanSu    |</span><br><span class="line">|    2 | E2   |      1 |  1 | RD       | GanSu    |</span><br><span class="line">|    3 | E3   |      1 |  1 | RD       | GanSu    |</span><br><span class="line">|    4 | EA   |      2 |  2 | HR       | XiAN     |</span><br><span class="line">|    5 | EB   |      2 |  2 | HR       | XiAN     |</span><br><span class="line">|    6 | W1   |      3 |  3 | MK       | BeiJing  |</span><br><span class="line">|    7 | W2   |      4 |  4 | MIS      | ShangHai |</span><br><span class="line">| NULL | NULL |   NULL |  5 | FD       | ShenZhen |</span><br><span class="line">+------+------+--------+----+----------+----------+</span><br><span class="line">8 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>

<h4 id="æƒ…å†µå››ï¼šè¡¨-tbl-emp-ç‰¹æœ‰çš„æ•°æ®"><a href="#æƒ…å†µå››ï¼šè¡¨-tbl-emp-ç‰¹æœ‰çš„æ•°æ®" class="headerlink" title="æƒ…å†µå››ï¼šè¡¨ tbl_emp ç‰¹æœ‰çš„æ•°æ®"></a>æƒ…å†µå››ï¼šè¡¨ tbl_emp ç‰¹æœ‰çš„æ•°æ®</h4><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">mysql&gt; select * from tbl_emp e left join tbl_dept d on e.deptId = d.id where d.id is null;</span><br><span class="line">+----+------+--------+------+----------+---------+</span><br><span class="line">| id | NAME | deptId | id   | deptName | locAddr |</span><br><span class="line">+----+------+--------+------+----------+---------+</span><br><span class="line">|  8 | W3   |     51 | NULL | NULL     | NULL    |</span><br><span class="line">+----+------+--------+------+----------+---------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure>

<h4 id="æƒ…å†µäº”ï¼šè¡¨-tbl-dept-ç‰¹æœ‰çš„æ•°æ®"><a href="#æƒ…å†µäº”ï¼šè¡¨-tbl-dept-ç‰¹æœ‰çš„æ•°æ®" class="headerlink" title="æƒ…å†µäº”ï¼šè¡¨ tbl_dept ç‰¹æœ‰çš„æ•°æ®"></a>æƒ…å†µäº”ï¼šè¡¨ tbl_dept ç‰¹æœ‰çš„æ•°æ®</h4><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">mysql&gt; select * from tbl_emp e right join tbl_dept d on e.deptId = d.id where e.deptId is null;</span><br><span class="line">+------+------+--------+----+----------+----------+</span><br><span class="line">| id   | NAME | deptId | id | deptName | locAddr  |</span><br><span class="line">+------+------+--------+----+----------+----------+</span><br><span class="line">| NULL | NULL |   NULL |  5 | FD       | ShenZhen |</span><br><span class="line">+------+------+--------+----+----------+----------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure>

<h4 id="æƒ…å†µå…­ï¼šä¸¤å¼ è¡¨éƒ½æœ‰çš„æ•°æ®"><a href="#æƒ…å†µå…­ï¼šä¸¤å¼ è¡¨éƒ½æœ‰çš„æ•°æ®" class="headerlink" title="æƒ…å†µå…­ï¼šä¸¤å¼ è¡¨éƒ½æœ‰çš„æ•°æ®"></a>æƒ…å†µå…­ï¼šä¸¤å¼ è¡¨éƒ½æœ‰çš„æ•°æ®</h4><p>â€‹		ç”±äºMySQLä¸æ”¯æŒ FULL JOINï¼Œæ­¤å¤„ä½¿ç”¨ UNION ä»£æ›¿ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">mysql&gt; select * from tbl_emp e left join tbl_dept d on e.deptId = d.id</span><br><span class="line">    -&gt; union</span><br><span class="line">    -&gt; select * from tbl_emp e right join tbl_dept d on e.deptId = d.id;</span><br><span class="line">+------+------+--------+------+----------+----------+</span><br><span class="line">| id   | NAME | deptId | id   | deptName | locAddr  |</span><br><span class="line">+------+------+--------+------+----------+----------+</span><br><span class="line">|    1 | E1   |      1 |    1 | RD       | GanSu    |</span><br><span class="line">|    2 | E2   |      1 |    1 | RD       | GanSu    |</span><br><span class="line">|    3 | E3   |      1 |    1 | RD       | GanSu    |</span><br><span class="line">|    4 | EA   |      2 |    2 | HR       | XiAN     |</span><br><span class="line">|    5 | EB   |      2 |    2 | HR       | XiAN     |</span><br><span class="line">|    6 | W1   |      3 |    3 | MK       | BeiJing  |</span><br><span class="line">|    7 | W2   |      4 |    4 | MIS      | ShangHai |</span><br><span class="line">|    8 | W3   |     51 | NULL | NULL     | NULL     |</span><br><span class="line">| NULL | NULL |   NULL |    5 | FD       | ShenZhen |</span><br><span class="line">+------+------+--------+------+----------+----------+</span><br><span class="line">9 rows in set (0.01 sec)	</span><br></pre></td></tr></table></figure>

<h4 id="æƒ…å†µä¸ƒï¼šä¸¤å¼ è¡¨ç‰¹æœ‰çš„æ•°æ®"><a href="#æƒ…å†µä¸ƒï¼šä¸¤å¼ è¡¨ç‰¹æœ‰çš„æ•°æ®" class="headerlink" title="æƒ…å†µä¸ƒï¼šä¸¤å¼ è¡¨ç‰¹æœ‰çš„æ•°æ®"></a>æƒ…å†µä¸ƒï¼šä¸¤å¼ è¡¨ç‰¹æœ‰çš„æ•°æ®</h4><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">mysql&gt; select * from tbl_emp e left join tbl_dept d on e.deptId = d.id where d.id is null</span><br><span class="line">    -&gt; union</span><br><span class="line">    -&gt; select * from tbl_emp e right join tbl_dept d on e.deptId = d.id where e.id is null;</span><br><span class="line">+------+------+--------+------+----------+----------+</span><br><span class="line">| id   | NAME | deptId | id   | deptName | locAddr  |</span><br><span class="line">+------+------+--------+------+----------+----------+</span><br><span class="line">|    8 | W3   |     51 | NULL | NULL     | NULL     |</span><br><span class="line">| NULL | NULL |   NULL |    5 | FD       | ShenZhen |</span><br><span class="line">+------+------+--------+------+----------+----------+</span><br><span class="line">2 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>

<h2 id="ç´¢å¼•"><a href="#ç´¢å¼•" class="headerlink" title="ç´¢å¼•"></a>ç´¢å¼•</h2><h3 id="ç´¢å¼•å®šä¹‰"><a href="#ç´¢å¼•å®šä¹‰" class="headerlink" title="ç´¢å¼•å®šä¹‰"></a>ç´¢å¼•å®šä¹‰</h3><p><strong>æŸ¥æ‰¾å’Œæ’åºéƒ½è¦ç”¨åˆ°ç´¢å¼•ã€‚</strong>ã€æŸ¥æ‰¾ + æ’åºã€‘</p>
<p>MySQLå®˜æ–¹å¯¹ç´¢å¼•çš„å®šä¹‰ä¸ºï¼šç´¢å¼•ï¼ˆIndexï¼‰å¸®åŠ©MySQLé«˜æ•ˆè·å–æ•°æ®çš„æ•°æ®ç»“æ„ã€‚</p>
<p>ç´¢å¼•çš„æœ¬è´¨ï¼šç´¢å¼•æ˜¯æ•°æ®ç»“æ„ã€‚å¯ä»¥ç®€å•ç†è§£ä¸º â€œæ’å¥½åºçš„å¿«é€ŸæŸ¥æ‰¾æ•°æ®ç»“æ„â€ã€‚</p>
<p>â€‹		ä¸€èˆ¬æ¥è¯´ç´¢å¼•æœ¬èº«ä¹Ÿå¾ˆå¤§ï¼Œä¸å¯èƒ½å…¨éƒ¨å­˜å‚¨åœ¨å†…å­˜ä¸­ï¼Œå› æ­¤ç´¢å¼•å¾€å¾€ä»¥ç´¢å¼•æ–‡ä»¶çš„å½¢å¼å­˜å‚¨çš„ç£ç›˜ä¸Šã€‚æˆ‘ä»¬å¹³å¸¸æ‰€è¯´çš„ç´¢å¼•ï¼Œå¦‚æœæ²¡æœ‰ç‰¹åˆ«æŒ‡æ˜ï¼Œ<strong>éƒ½æ˜¯æŒ‡Bæ ‘</strong>ï¼ˆå¤šè·¯æœç´¢æ ‘ï¼Œå¹¶ä¸ä¸€å®šæ˜¯äºŒå‰çš„ï¼‰ç»“æ„ç»„ç»‡çš„ç´¢å¼•ã€‚</p>
<p>â€‹		å¤åˆç´¢å¼•ï¼Œå‰ç¼€ç´¢å¼•ï¼Œå”¯ä¸€ç´¢å¼•é»˜è®¤éƒ½æ˜¯ä½¿ç”¨B+æ ‘ç´¢å¼•ï¼Œç»Ÿç§°ç´¢å¼•ã€‚å½“ç„¶ï¼Œé™¤äº†B+æ ‘è¿™ç§ç±»å‹çš„ç´¢å¼•ï¼Œå…¶ä¸­èšé›†ç´¢å¼•ã€æ¬¡è¦ç´¢å¼•ã€è¦†ç›–ç´¢å¼•ï¼Œç»Ÿç§°ç´¢å¼•ï¼Œå½“ç„¶ï¼Œé™¤äº†B+æ ‘è¿™ç§ç±»å‹çš„ç´¢å¼•ä¹‹å¤–ï¼Œè¿˜æœ‰å“ˆç¨€ç´¢å¼•(hash index)ç­‰ã€‚</p>
<p>â€‹		åœ¨æ•°æ®ä¹‹å¤–ï¼Œæ•°æ®åº“ç³»ç»Ÿè¿˜ç»´æŠ¤ç€æ»¡è¶³ç‰¹å®šæŸ¥æ‰¾ç®—æ³•çš„æ•°æ®ç»“æ„ï¼Œè¿™äº›æ•°æ®ç»“æ„ä»¥æŸç§æ–¹å¼å¼•ç”¨ï¼ˆæŒ‡å‘ï¼‰æ•°æ®ï¼Œè¿™æ ·å°±å¯ä»¥åœ¨è¿™äº›æ•°æ®ç»“æ„ä¸Šå®ç°é«˜çº§æŸ¥æ‰¾ç®—æ³•ã€‚è¿™ç§æ•°æ®ç»“æ„ï¼Œå°±æ˜¯ç´¢å¼•ã€‚ä¸‹å›¾å°±æ˜¯ä¸€ç§å¯èƒ½çš„ç´¢å¼•æ–¹å¼ç¤ºä¾‹ï¼ˆBTREEï¼‰ï¼š</p>
<p><img src="/2023/02/28/MySQL/Java\Document\MySQL\MySQL.assets\image-20221006182044473.png" alt="image-20221006182044473"></p>
<h3 id="ç´¢å¼•å¤±æ•ˆ"><a href="#ç´¢å¼•å¤±æ•ˆ" class="headerlink" title="ç´¢å¼•å¤±æ•ˆ"></a>ç´¢å¼•å¤±æ•ˆ</h3><p>å¯¹æ•°æ®çš„åˆ é™¤ï¼Œæ²¡æœ‰åŠæ—¶ä¿®æ”¹ç´¢å¼•ï¼ŒåŸæœ¬ç´¢å¼•æŒ‡å‘çš„ä½ç½®ï¼Œæ•°æ®ä¸ä¼šæ”¹å˜</p>
<h3 id="ç´¢å¼•ä¼˜åŠ¿"><a href="#ç´¢å¼•ä¼˜åŠ¿" class="headerlink" title="ç´¢å¼•ä¼˜åŠ¿"></a>ç´¢å¼•ä¼˜åŠ¿</h3><ol>
<li><p>æé«˜æ•°æ®çš„æ£€ç´¢æ•ˆç‡ï¼Œé™ä½æ•°æ®åº“çš„ IO æˆæœ¬ã€‚</p>
</li>
<li><p>é€šè¿‡ç´¢å¼•å¯¹æ•°æ®è¿›è¡Œæ’åºï¼Œé™ä½æ•°æ®çš„æ’åºæˆæœ¬ï¼Œé™ä½äº† CPU çš„æ¶ˆè€—ã€‚</p>
</li>
</ol>
<h3 id="ç´¢å¼•åŠ£åŠ¿"><a href="#ç´¢å¼•åŠ£åŠ¿" class="headerlink" title="ç´¢å¼•åŠ£åŠ¿"></a>ç´¢å¼•åŠ£åŠ¿</h3><ol>
<li>å®é™…ä¸Šç´¢å¼•ä¹Ÿæ˜¯ä¸€å¼ è¡¨ï¼Œè¯¥è¡¨ä¿å­˜äº†ä¸»é”®ä¸ç´¢å¼•å­—æ®µï¼Œå¹¶æŒ‡å‘å®ä½“è¡¨çš„è®°å½•ï¼Œæ‰€ä»¥ç´¢å¼•åˆ—ä¹Ÿæ˜¯è¦å ç”¨ç©ºé—´çš„ã€‚</li>
<li>è™½ç„¶ç´¢å¼•å¤§å¤§æé«˜äº†æŸ¥è¯¢é€Ÿåº¦ï¼ŒåŒæ—¶å´ä¼šé™ä½æ›´æ–°è¡¨çš„é€Ÿåº¦ï¼Œå¦‚å¯¹è¡¨è¿›è¡ŒINSERTã€UPDATEå’ŒDELETEã€‚å› ä¸ºæ›´æ–°è¡¨æ—¶ï¼ŒMySQLä¸ä»…è¦ä¿å­˜æ•°æ®ï¼Œè¿˜è¦ä¿å­˜ä¸€ä¸‹ç´¢å¼•æ–‡ä»¶æ¯æ¬¡æ›´æ–°æ·»åŠ äº†ç´¢å¼•åˆ—çš„å­—æ®µï¼Œéƒ½ä¼šè°ƒæ•´å› ä¸ºæ›´æ–°æ‰€å¸¦æ¥çš„é”®å€¼å˜åŒ–åçš„ç´¢å¼•ä¿¡æ¯ã€‚</li>
<li>ç´¢å¼•åªæ˜¯æé«˜æ•ˆç‡çš„ä¸€ä¸ªå› ç´ ï¼Œå¦‚æœMySQLæœ‰å¤§æ•°æ®é‡çš„è¡¨ï¼Œå°±éœ€è¦èŠ±æ—¶é—´ç ”ç©¶å»ºç«‹æœ€ä¼˜ç§€çš„ç´¢å¼•ï¼Œæˆ–ä¼˜åŒ–æŸ¥è¯¢è¯­å¥ã€‚</li>
<li>ç´¢å¼•æ˜¯ä¸æ–­ä¼˜åŒ–å’Œè°ƒæ•´çš„ï¼Œæ ¹æ®ç”¨æˆ·æŸ¥è¯¢çš„ä¿¡æ¯ä¸æ–­è°ƒæ•´ã€‚</li>
</ol>
<h3 id="ç´¢å¼•åˆ†ç±»"><a href="#ç´¢å¼•åˆ†ç±»" class="headerlink" title="ç´¢å¼•åˆ†ç±»"></a>ç´¢å¼•åˆ†ç±»</h3><h4 id="å•å€¼ç´¢å¼•"><a href="#å•å€¼ç´¢å¼•" class="headerlink" title="å•å€¼ç´¢å¼•"></a>å•å€¼ç´¢å¼•</h4><p>â€‹		ä¸€ä¸ªç´¢å¼•åªåŒ…å«å•ä¸ªåˆ—ï¼Œä¸€ä¸ªè¡¨å¯ä»¥æœ‰å¯¹ä¸ªå•åˆ—ç´¢å¼•ã€‚</p>
<h4 id="å”¯ä¸€ç´¢å¼•"><a href="#å”¯ä¸€ç´¢å¼•" class="headerlink" title="å”¯ä¸€ç´¢å¼•"></a>å”¯ä¸€ç´¢å¼•</h4><p>â€‹		ç´¢å¼•åˆ—çš„å€¼å¿…é¡»å”¯ä¸€ï¼Œä½†å…è®¸æœ‰ç©ºå€¼ã€‚</p>
<h4 id="å¤åˆç´¢å¼•"><a href="#å¤åˆç´¢å¼•" class="headerlink" title="å¤åˆç´¢å¼•"></a>å¤åˆç´¢å¼•</h4><p>â€‹		ä¸€ä¸ªç´¢å¼•åŒ…å«å¤šä¸ªåˆ—ã€‚</p>
<h3 id="åŸºæœ¬è¯­æ³•"><a href="#åŸºæœ¬è¯­æ³•" class="headerlink" title="åŸºæœ¬è¯­æ³•"></a>åŸºæœ¬è¯­æ³•</h3><h4 id="åˆ›å»º"><a href="#åˆ›å»º" class="headerlink" title="åˆ›å»º"></a>åˆ›å»º</h4><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">create [unique] index indexName on tableName(columnName(length));</span><br></pre></td></tr></table></figure>

<p>â€‹		å¦‚æœæ˜¯ charï¼Œvarchar ç±»å‹ï¼Œlength é•¿åº¦å¯ä»¥å°äºå­—æ®µçš„å®é™…é•¿åº¦ã€‚å¦‚æœæ˜¯ blob å’Œ text å¿…é¡»æŒ‡å®š lengthã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">alter tableName add [unique] index indexName on (columnName(length));</span><br></pre></td></tr></table></figure>

<h4 id="åˆ é™¤"><a href="#åˆ é™¤" class="headerlink" title="åˆ é™¤"></a>åˆ é™¤</h4><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">drop index indexName on tableName;</span><br></pre></td></tr></table></figure>

<h4 id="æŸ¥çœ‹"><a href="#æŸ¥çœ‹" class="headerlink" title="æŸ¥çœ‹"></a>æŸ¥çœ‹</h4><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">show index from tableName;</span><br></pre></td></tr></table></figure>

<h4 id="ä½¿ç”¨alterå‘½ä»¤"><a href="#ä½¿ç”¨alterå‘½ä»¤" class="headerlink" title="ä½¿ç”¨alterå‘½ä»¤"></a>ä½¿ç”¨alterå‘½ä»¤</h4><p>æœ‰å››ç§æ–¹å¼æ¥æ·»åŠ æ•°æ®è¡¨çš„ç´¢å¼•ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"># è¯¥è¯­å¥æ·»åŠ ä¸€ä¸ªä¸»é”®ï¼Œè¿™æ„å‘³ç€ç´¢å¼•å€¼å¿…é¡»æ˜¯å”¯ä¸€çš„ï¼Œ ä¸”ä¸èƒ½ä¸ºNULL</span><br><span class="line">ALTER TABLE tbl_name ADD PRIMARY KEY (column(length)) </span><br><span class="line"># è¿™æ¡è¯­å¥åˆ›å»ºç´¢å¼•çš„å€¼å¿…é¡»æ˜¯å”¯ä¸€çš„(é™¤äº†NULLå¤–ï¼ŒNULLå¯èƒ½ä¼šå‡ºç°å¤šæ¬¡)</span><br><span class="line">ALTER TABLE tbl name ADD UNIQUE index_name (column(length)) </span><br><span class="line"># æ·»åŠ æ™®é€šç´¢å¼•ï¼Œç´¢å¼•å€¼å¯å‡ºç°å¤šæ¬¡</span><br><span class="line">ALTER TABLE tbl_name ADD INDEX index_name (column(length)) </span><br><span class="line"># è¯¥è¯­å¥æŒ‡å®šäº†ç´¢å¼•ä¸ºFULLTEXT,ç”¨äºå…¨æ–‡ç´¢å¼•</span><br><span class="line">ALTER TABLE tbl _name ADD FULLTEXT index_name (column(length)) </span><br></pre></td></tr></table></figure>

<h3 id="MySQL-ç´¢å¼•ç»“æ„"><a href="#MySQL-ç´¢å¼•ç»“æ„" class="headerlink" title="MySQL ç´¢å¼•ç»“æ„"></a>MySQL ç´¢å¼•ç»“æ„</h3><ol>
<li>BTreeç´¢å¼•</li>
<li>Hashç´¢å¼•</li>
<li>full-textå…¨æ–‡ç´¢å¼•</li>
<li>R-Treeç´¢å¼•</li>
</ol>
<h3 id="BTreeæ£€ç´¢åŸç†"><a href="#BTreeæ£€ç´¢åŸç†" class="headerlink" title="BTreeæ£€ç´¢åŸç†"></a><strong>BTreeæ£€ç´¢åŸç†</strong></h3><p><img src="/2023/02/28/MySQL/Java\Document\MySQL\MySQL.assets\image-20221006182956412.png" alt="image-20221006182956412"></p>
<p><strong>1.</strong>   <strong>åˆå§‹åŒ–ä»‹ç»</strong></p>
<p>â€‹		ä¸€é¢—b+æ ‘ï¼Œæµ…è“è‰²çš„å—æˆ‘ä»¬ç§°ä¹‹ä¸ºä¸€ä¸ªç£ç›˜å—ï¼Œå¯ä»¥çœ‹åˆ°æ¯ä¸ªç£ç›˜å—åŒ…å«å‡ ä¸ªæ•°æ®é¡¹(æ·±è“è‰²æ‰€ç¤º)å’ŒæŒ‡é’ˆ(é»„è‰²æ‰€ç¤º)ï¼Œå¦‚ç£ç›˜å—1åŒ…å«æ•°æ®é¡¹17å’Œ35ï¼ŒåŒ…å«æŒ‡é’ˆP1ã€P2ã€P3ï¼ŒP1è¡¨ç¤ºå°äº17çš„ç£ç›˜å—ï¼ŒP2è¡¨ç¤ºåœ¨17å’Œ35ä¹‹é—´çš„ç£ç›˜å—ï¼ŒP3è¡¨ç¤ºå¤§äº35çš„ç£ç›˜å—ã€‚</p>
<p>â€‹		çœŸå®çš„æ•°æ®å­˜åœ¨äºå¶å­èŠ‚ç‚¹å³3ã€5ã€9ã€10ã€13ã€15ã€28ã€29ã€36ã€60ã€75ã€79ã€90ã€99ã€‚éå¶å­èŠ‚ç‚¹ä¸å­˜å‚¨çœŸå®çš„æ•°æ®ï¼Œåªå­˜å‚¨æŒ‡å¼•æœç´¢æ–¹å‘çš„æ•°æ®é¡¹ï¼Œå¦‚17ã€ 35å¹¶ä¸çœŸå®å­˜åœ¨äºæ•°æ®è¡¨ä¸­ã€‚</p>
<p><strong>2.</strong>   <strong>æŸ¥æ‰¾è¿‡ç¨‹</strong></p>
<p>â€‹		å¦‚æœè¦æŸ¥æ‰¾æ•°æ®é¡¹29ï¼Œé‚£ä¹ˆé¦–å…ˆä¼šæŠŠç£ç›˜å—1ç”±ç£ç›˜åŠ è½½åˆ°å†…å­˜ï¼Œæ­¤æ—¶å‘ç”Ÿä¸€æ¬¡IO, åœ¨å†…å­˜ä¸­ç”¨äºŒåˆ†æŸ¥æ‰¾ç¡®å®š29åœ¨17å’Œ35ä¹‹é—´ï¼Œé”å®šç£ç›˜å—1çš„P2æŒ‡é’ˆï¼Œå†…å­˜æ—¶é—´å› ä¸ºéå¸¸çŸ­ï¼ˆç›¸æ¯”ç£ç›˜çš„IOï¼‰å¯ä»¥å¿½ç•¥ä¸è®¡ï¼Œé€šè¿‡ç£ç›˜å—1çš„P2æŒ‡é’ˆçš„ç£ç›˜åœ°å€ï¼ŒæŠŠç£ç›˜å—3ç”±ç£ç›˜åŠ è½½åˆ°å†…å­˜ï¼Œå‘ç”Ÿç¬¬äºŒæ¬¡IO, 29 åœ¨ 26 å’Œ 30 ä¹‹é—´ï¼Œ é”å®šç£ç›˜å—3çš„ P2 æŒ‡é’ˆï¼Œé€šè¿‡æŒ‡é’ˆåŠ è½½ç£ç›˜å—8åˆ°å†…å­˜ï¼Œå‘ç”Ÿç¬¬ä¸‰æ¬¡IOï¼Œ åŒæ—¶å†…å­˜ä¸­åšäºŒåˆ†æŸ¥æ‰¾æ‰¾åˆ°29ï¼Œç»“æŸæŸ¥è¯¢ï¼Œæ€»è®¡ä¸‰æ¬¡IOã€‚</p>
<p>â€‹		çœŸå®çš„æƒ…å†µæ˜¯ï¼Œ3å±‚çš„b+æ ‘å¯ä»¥è¡¨ç¤ºä¸Šç™¾ä¸‡çš„æ•°æ®ï¼Œå¦‚æœä¸Šç™¾ä¸‡çš„æ•°æ®æŸ¥æ‰¾åªéœ€è¦ä¸‰æ¬¡IOï¼Œæ€§èƒ½æé«˜å°†æ˜¯å·¨å¤§çš„ï¼Œå¦‚æœæ²¡æœ‰ç´¢å¼•ï¼Œæ¯ä¸ªæ•°æ®é¡¹éƒ½è¦å‘ç”Ÿä¸€æ¬¡IO,é‚£ä¹ˆæ€»å…±éœ€è¦ç™¾ä¸‡æ¬¡çš„IOï¼Œæ˜¾ç„¶æˆæœ¬éå¸¸éå¸¸é«˜ã€‚</p>
<h3 id="éœ€è¦åˆ›å»ºç´¢å¼•çš„æƒ…å†µ"><a href="#éœ€è¦åˆ›å»ºç´¢å¼•çš„æƒ…å†µ" class="headerlink" title="éœ€è¦åˆ›å»ºç´¢å¼•çš„æƒ…å†µ"></a>éœ€è¦åˆ›å»ºç´¢å¼•çš„æƒ…å†µ</h3><ol>
<li><p>ä¸»é”®è‡ªåŠ¨å»ºç«‹å”¯ä¸€ç´¢å¼•ã€‚</p>
</li>
<li><p>é¢‘ç¹ä½œä¸ºæŸ¥è¯¢æ¡ä»¶çš„å­—æ®µåº”è¯¥åˆ›å»ºç´¢å¼•ã€‚</p>
</li>
<li><p>æŸ¥è¯¢ä¸­ä¸å…¶å®ƒè¡¨å…³è”çš„å­—æ®µï¼Œå¤–é”®å…³ç³»å»ºç«‹ç´¢å¼•ã€‚</p>
</li>
<li><p>é¢‘ç¹æ›´æ–°çš„å­—æ®µä¸é€‚åˆåˆ›å»ºç´¢å¼•ã€‚å› ä¸ºæ¯æ¬¡æ›´æ–°ä¸ä»…æ›´æ–°è®°å½•è¿˜ä¼šæ›´æ–°ç´¢å¼•ã€‚</p>
</li>
<li><p>whereæ¡ä»¶é‡Œç”¨ä¸åˆ°çš„å­—æ®µä¸åˆ›å»ºç´¢å¼•ã€‚</p>
</li>
<li><p>å•é”®&#x2F;ç»„åˆç´¢å¼•çš„é€‰æ‹©é—®é¢˜ï¼Œ(åœ¨é«˜å¹¶å‘ä¸‹å€¾å‘åˆ›å»ºç»„åˆç´¢å¼•)ã€‚</p>
</li>
<li><p>æŸ¥è¯¢ä¸­æ’åºçš„å­—æ®µï¼Œæ’åºå­—æ®µè‹¥é€šè¿‡ç´¢å¼•å»è®¿é—®å°†å¤§å¤§æé«˜æ’åºé€Ÿåº¦ã€‚</p>
</li>
<li><p>æŸ¥è¯¢ä¸­ç»Ÿè®¡æˆ–è€…åˆ†ç»„å­—æ®µã€‚</p>
</li>
</ol>
<h3 id="ä¸éœ€è¦åˆ›å»ºç´¢å¼•çš„æƒ…å†µ"><a href="#ä¸éœ€è¦åˆ›å»ºç´¢å¼•çš„æƒ…å†µ" class="headerlink" title="ä¸éœ€è¦åˆ›å»ºç´¢å¼•çš„æƒ…å†µ"></a>ä¸éœ€è¦åˆ›å»ºç´¢å¼•çš„æƒ…å†µ</h3><ol>
<li><p><strong>è¡¨è®°å½•å¤ªå°‘ï¼Œä¼˜åŒ–å™¨ä¼šè‡ªåŠ¨ä¼˜åŒ–ã€‚</strong>ï¼ˆè‡³å°‘3ç™¾ä¸‡ï¼‰</p>
</li>
<li><p><strong>ç»å¸¸å¢åˆ æ”¹çš„è¡¨ã€‚</strong>ï¼ˆåŸå› ï¼šæé«˜äº†æŸ¥è¯¢é€Ÿåº¦ï¼ŒåŒæ—¶å´ä¼šé™ä½æ›´æ–°è¡¨çš„é€Ÿåº¦ï¼Œå¦‚å¯¹è¡¨è¿›è¡ŒINSERTã€UPDATEå’ŒDELETEã€‚å› ä¸ºæ›´æ–°è¡¨æ—¶ï¼ŒMySQLä¸ä»…è¦ä¿å­˜æ•°æ®ï¼Œè¿˜è¦ä¿å­˜ä¸€ä¸‹ç´¢å¼•æ–‡ä»¶ï¼‰ã€‚</p>
</li>
<li><p><strong>æ•°æ®é‡å¤ä¸”åˆ†å¸ƒå¹³å‡çš„è¡¨å­—æ®µï¼Œå› æ­¤åº”è¯¥åªä¸ºæœ€ç»å¸¸æŸ¥è¯¢å’Œæœ€ç»å¸¸æ’åºçš„æ•°æ®åˆ—å»ºç«‹ç´¢å¼•</strong>ã€‚</p>
<p> æ³¨æ„ï¼Œå¦‚æœæŸä¸ªæ•°æ®åˆ—åŒ…å«è®¸å¤šé‡å¤çš„å†…å®¹ï¼Œä¸ºå®ƒå»ºç«‹ç´¢å¼•å°±æ²¡æœ‰å¤ªå¤§çš„å®é™…æ•ˆæœã€‚å‡å¦‚ä¸€ä¸ªè¡¨æœ‰10ä¸‡è¡Œè®°å½•ï¼Œæœ‰ä¸€ä¸ªå­—æ®µAåªæœ‰Tå’ŒFä¸¤ç§å€¼ï¼Œä¸”æ¯ä¸ªå€¼çš„åˆ†å¸ƒæ¦‚ç‡å¤§çº¦ä¸º50%ï¼Œé‚£ä¹ˆå¯¹è¿™ç§è¡¨Aå­—æ®µå»ºç´¢å¼•ä¸€èˆ¬ä¸ä¼šæé«˜æ•°æ®åº“çš„æŸ¥è¯¢é€Ÿåº¦ã€‚ç´¢å¼•çš„é€‰æ‹©æ€§æ˜¯æŒ‡ç´¢å¼•åˆ—ä¸­ä¸åŒå€¼çš„æ•°ç›®ä¸è¡¨ä¸­è®°å½•æ•°çš„æ¯”ã€‚å¦‚æœä¸€ä¸ªè¡¨ä¸­æœ‰2000æ¡è®°å½•ï¼Œè¡¨ç´¢å¼•åˆ—æœ‰1980ä¸ªä¸åŒçš„å€¼ï¼Œé‚£ä¹ˆè¿™ä¸ªç´¢å¼•çš„é€‰æ‹©æ€§å°±æ˜¯1980&#x2F;2000&#x3D;0.99ã€‚ä¸€ä¸ªç´¢å¼•çš„é€‰æ‹©æ€§è¶Šæ¥è¿‘äº1,è¿™ä¸ªç´¢å¼•çš„æ•ˆç‡å°±è¶Šé«˜ã€‚</p>
</li>
</ol>
<h2 id="æ€§èƒ½åˆ†æ"><a href="#æ€§èƒ½åˆ†æ" class="headerlink" title="æ€§èƒ½åˆ†æ"></a>æ€§èƒ½åˆ†æ</h2><h3 id="MySQL-Query-Optimizerï¼ˆæŸ¥è¯¢ä¼˜åŒ–å™¨ï¼‰"><a href="#MySQL-Query-Optimizerï¼ˆæŸ¥è¯¢ä¼˜åŒ–å™¨ï¼‰" class="headerlink" title="MySQL  Query  Optimizerï¼ˆæŸ¥è¯¢ä¼˜åŒ–å™¨ï¼‰"></a>MySQL  Query  Optimizerï¼ˆæŸ¥è¯¢ä¼˜åŒ–å™¨ï¼‰</h3><p>â€‹		MySQLä¸­æœ‰ä¸“é—¨è´Ÿè´£ä¼˜åŒ– <strong>SELECT</strong> è¯­å¥çš„ä¼˜åŒ–å™¨æ¨¡å—ï¼Œä¸»è¦åŠŸèƒ½ï¼šé€šè¿‡è®¡ç®—åˆ†æç³»ç»Ÿä¸­æ”¶é›†åˆ°çš„ç»Ÿè®¡ä¿¡æ¯ï¼Œä¸ºå®¢æˆ·ç«¯è¯·æ±‚çš„ Query æä¾›å®ƒè®¤ä¸ºæœ€ä¼˜çš„æ‰§è¡Œè®¡åˆ’ï¼ˆæœºå™¨è®¤ä¸ºæœ€ä¼˜çš„æ•°æ®æ£€ç´¢æ–¹å¼ï¼Œä½†ä¸è§å¾—æ˜¯DBAè®¤ä¸ºæ˜¯æœ€ä¼˜çš„ï¼Œè¿™éƒ¨åˆ†æœ€è€—è´¹æ—¶é—´ï¼‰ã€‚</p>
<p>â€‹		å½“å®¢æˆ·ç«¯å‘ MySQL è¯·æ±‚ä¸€æ¡Queryï¼Œå‘½ä»¤è§£æå™¨æ¨¡å—å®Œæˆè¯·æ±‚åˆ†ç±»ï¼ŒåŒºåˆ«å‡ºæ˜¯ SELECT å¹¶è½¬å‘ç»™ MySQL Query Optimizeræ—¶ï¼ŒMySQL Query Optimizeré¦–å…ˆä¼šå¯¹æ•´æ¡Queryè¿›è¡Œä¼˜åŒ–ï¼Œå¤„ç†æ‰ä¸€äº›å¸¸é‡è¡¨è¾¾å¼çš„é¢„ç®—ï¼Œç›´æ¥æ¢ç®—æˆå¸¸é‡å€¼ã€‚å¹¶å¯¹Queryä¸­çš„æŸ¥è¯¢æ¡ä»¶è¿›è¡Œç®€åŒ–å’Œè½¬æ¢ï¼Œå¦‚å»æ‰ä¸€äº›æ— ç”¨æˆ–æ˜¾è€Œæ˜“è§çš„æ¡ä»¶ã€ç»“æ„è°ƒæ•´ç­‰ã€‚ç„¶ååˆ†æQueryä¸­çš„Hint ä¿¡æ¯ï¼ˆå¦‚æœæœ‰ï¼‰ï¼Œçœ‹æ˜¾ç¤º Hint ä¿¡æ¯æ˜¯å¦å¯ä»¥å®Œå…¨ç¡®å®šè¯¥Queryçš„æ‰§è¡Œè®¡åˆ’ã€‚å¦‚æœæ²¡æœ‰ Hint æˆ– Hint ä¿¡æ¯è¿˜ä¸è¶³ä»¥å®Œå…¨ç¡®å®šæ‰§è¡Œè®¡åˆ’ï¼Œåˆ™ä¼šè¯»å–æ‰€æ¶‰åŠå¯¹è±¡çš„ç»Ÿè®¡ä¿¡æ¯ï¼Œæ ¹æ® Query è¿›è¡Œå†™ç›¸åº”çš„è®¡ç®—åˆ†æï¼Œç„¶åå†å¾—å‡ºæœ€åçš„æ‰§è¡Œè®¡åˆ’ã€‚</p>
<h3 id="MySQLå¸¸è§ç“¶é¢ˆ"><a href="#MySQLå¸¸è§ç“¶é¢ˆ" class="headerlink" title="MySQLå¸¸è§ç“¶é¢ˆ"></a>MySQLå¸¸è§ç“¶é¢ˆ</h3><ol>
<li><p>CPUï¼šCPUåœ¨é¥±å’Œçš„æ—¶å€™ï¼Œä¸€èˆ¬å‘ç”Ÿåœ¨æ•°æ®è£…å…¥å†…å­˜æˆ–ä»ç£ç›˜ä¸Šè¯»å–æ•°æ®çš„æ—¶å€™ã€‚</p>
</li>
<li><p>IOï¼šç£ç›˜ I&#x2F;O ç“¶é¢ˆå‘ç”Ÿåœ¨è£…å…¥æ•°æ®è¿œå¤§äºå†…å­˜å®¹é‡çš„æ—¶å€™ã€‚</p>
</li>
<li><p>æœåŠ¡å™¨ç¡¬ä»¶çš„æ€§èƒ½ç“¶é¢ˆï¼štopï¼Œfreeï¼Œiostat å’Œ vmstat æ¥æŸ¥çœ‹ç³»ç»Ÿçš„æ€§èƒ½çŠ¶æ€ã€‚</p>
</li>
</ol>
<h3 id="Explainï¼ˆæŸ¥çœ‹æ‰§è¡Œè®¡åˆ’ï¼‰"><a href="#Explainï¼ˆæŸ¥çœ‹æ‰§è¡Œè®¡åˆ’ï¼‰" class="headerlink" title="Explainï¼ˆæŸ¥çœ‹æ‰§è¡Œè®¡åˆ’ï¼‰"></a>Explainï¼ˆæŸ¥çœ‹æ‰§è¡Œè®¡åˆ’ï¼‰</h3><h4 id="å®šä¹‰"><a href="#å®šä¹‰" class="headerlink" title="å®šä¹‰"></a>å®šä¹‰</h4><p>â€‹		ä½¿ç”¨ EXPLAIN å…³é”®å­—å¯ä»¥æ¨¡æ‹Ÿä¼˜åŒ–å™¨æ‰§è¡ŒSQLæŸ¥è¯¢è¯­å¥ï¼Œä»è€ŒçŸ¥é“ MySQL æ˜¯å¦‚ä½•å¤„ç† SQL è¯­å¥çš„ã€‚åˆ†æä½ çš„æŸ¥è¯¢è¯­å¥æˆ–æ˜¯è¡¨ç»“æ„çš„æ€§èƒ½ç“¶é¢ˆã€‚</p>
<h4 id="ä½œç”¨"><a href="#ä½œç”¨" class="headerlink" title="ä½œç”¨"></a>ä½œç”¨</h4><ol>
<li><p>è¡¨çš„è¯»å–é¡ºåºã€‚</p>
</li>
<li><p>æ•°æ®è¯»å–æ“ä½œçš„æ“ä½œç±»å‹ã€‚</p>
</li>
<li><p>å“ªäº›ç´¢å¼•å¯ä»¥ä½¿ç”¨ã€‚</p>
</li>
<li><p>å“ªäº›ç´¢å¼•è¢«å®é™…ä½¿ç”¨ã€‚</p>
</li>
<li><p>è¡¨ä¹‹é—´çš„å¼•ç”¨ã€‚</p>
</li>
<li><p>æ¯å¼ è¡¨æœ‰å¤šå°‘è¡Œè¢«ä¼˜åŒ–å™¨æŸ¥è¯¢ã€‚</p>
</li>
</ol>
<p><strong>è¯­æ³•ï¼šexplain + Sql è¯­å¥</strong></p>
<p><img src="/2023/02/28/MySQL/Java\Document\MySQL\MySQL.assets\image-20221006184029571.png" alt="image-20221006184029571"></p>
<h3 id="explain-å„å­—æ®µè¯´æ˜"><a href="#explain-å„å­—æ®µè¯´æ˜" class="headerlink" title="explain å„å­—æ®µè¯´æ˜"></a>explain å„å­—æ®µè¯´æ˜</h3><h4 id="id"><a href="#id" class="headerlink" title="id"></a>id</h4><p>â€‹		select æŸ¥è¯¢çš„åºåˆ—å·ï¼ŒåŒ…å«ä¸€ç»„æ•°å­—ï¼Œè¡¨ç¤ºæŸ¥è¯¢ä¸­æ‰§è¡Œselectå­å¥æˆ–æ“ä½œè¡¨çš„é¡ºåºã€‚</p>
<ol>
<li>idç›¸åŒï¼Œæ‰§è¡Œé¡ºåºç”±ä¸Šè‡³ä¸‹ã€‚</li>
<li>idä¸åŒï¼Œå¦‚æœæ˜¯å­æŸ¥è¯¢ï¼Œidçš„åºå·ä¼šé€’å¢ï¼Œidå€¼è¶Šå¤§ä¼˜å…ˆçº§è¶Šé«˜ï¼Œè¶Šå…ˆè¢«æ‰§è¡Œå†’ã€‚</li>
<li>idç›¸åŒç±»å‹ä¸åŒï¼ŒåŒæ—¶å­˜åœ¨ã€‚</li>
</ol>
<p>ç¤ºä¾‹ï¼šidç›¸åŒï¼Œæ‰§è¡Œé¡ºåºç”±ä¸Šå‘ä¸‹ã€‚</p>
<p><img src="/2023/02/28/MySQL/Java\Document\MySQL\MySQL.assets\image-20221006184319151.png" alt="image-20221006184319151"></p>
<p>ç¤ºä¾‹ï¼šå­æŸ¥è¯¢ï¼Œidè¶Šå¤§ï¼Œä¼˜å…ˆçº§è¶Šé«˜ï¼Œè¶Šä¼˜å…ˆæ‰§è¡Œã€‚</p>
<p><img src="/2023/02/28/MySQL/Java\Document\MySQL\MySQL.assets\image-20221006184338549.png" alt="image-20221006184338549"></p>
<p>ç¤ºä¾‹ï¼šé€šè¿‡ id åˆ†ç»„ï¼ŒåŒä¸€ç»„ä¸­ï¼Œç”±ä¸Šå‘ä¸‹æ‰§è¡Œï¼Œä¸åŒç»„ä¸­idè¶Šå¤§ï¼Œè¶Šå…ˆæ‰§è¡Œã€‚</p>
<p><img src="/2023/02/28/MySQL/Java\Document\MySQL\MySQL.assets\image-20221006184523873.png" alt="image-20221006184523873"></p>
<p>derived2 è¡¨ç¤ºè¡ç”Ÿçš„IDä¸º2çš„è™šè¡¨ã€‚</p>
<h4 id="select-type"><a href="#select-type" class="headerlink" title="select_type"></a>select_type</h4><p>æŸ¥è¯¢çš„ç±»å‹ï¼šä¸»è¦ç”¨æ¥åŒºåˆ†æ™®é€šæŸ¥è¯¢ã€è”åˆæŸ¥è¯¢ã€å­æŸ¥è¯¢ç­‰å¤æ‚æŸ¥è¯¢ã€‚</p>
<p>id     select_type</p>
<p>1         SIMPLE</p>
<p>2         PRIMARY</p>
<p>3         SUBQUERY</p>
<p>4         DERIVED</p>
<p>5         UNION</p>
<p>6         UNION RESULT</p>
<p><strong>SIMPLE</strong>ï¼šç®€å•çš„selectæŸ¥è¯¢ï¼ŒæŸ¥è¯¢ä¸­ä¸åŒ…å«å­æŸ¥è¯¢æˆ–è€…UNIONã€‚</p>
<p><strong>PRIMARY</strong>ï¼šæŸ¥è¯¢ä¸­è‹¥åŒ…å«ä»»ä½•å¤æ‚çš„å­éƒ¨åˆ†ï¼Œæœ€å¤–å±‚æŸ¥è¯¢åˆ™è¢«æ ‡è®°ä¸ºPRIMARYã€‚</p>
<p><strong>SUBQUERY</strong>ï¼šåœ¨ SELECT æˆ– WHERE åˆ—è¡¨ä¸­åŒ…å«äº†å­æŸ¥è¯¢ã€‚</p>
<p><strong>DERIVED</strong>ï¼š <strong>FROMåˆ—è¡¨ä¸­åŒ…å«çš„å­æŸ¥è¯¢è¢«æ ‡è®°ä¸ºDERIVEDè¡ç”Ÿ</strong>ï¼ŒMySQLä¼šé€’å½’æ‰§è¡Œè¿™äº›å­æŸ¥è¯¢ï¼ŒæŠŠç»“æœæ”¾åœ¨ä¸´æ—¶è¡¨é‡Œã€‚</p>
<p><strong>UNION</strong>ï¼šè‹¥ç¬¬äºŒä¸ªSELECTå‡ºç°åœ¨UNIONä¹‹åï¼Œåˆ™è¢«æ ‡è®°ä¸ºUNIONã€‚è‹¥UNIONåŒ…å«åœ¨FROMå­å¥çš„å­æŸ¥è¯¢ä¸­ï¼Œå¤–å±‚</p>
<p>â€‹				SELECTå°†è¢«æ ‡è®°ä¸ºï¼šDERIVEDã€‚</p>
<p><strong>UNION RESULT</strong>ï¼šä»UNIONè¡¨è·å–ç»“æœçš„SELECTã€‚</p>
<p>ç¤ºä¾‹ï¼šUNION</p>
<p><img src="/2023/02/28/MySQL/Java\Document\MySQL\MySQL.assets\image-20221006185930088.png" alt="image-20221006185930088"></p>
<h4 id="table"><a href="#table" class="headerlink" title="table"></a>table</h4><p>â€‹		æ˜¾ç¤ºè¿™ä¸€è¡Œçš„æ•°æ®æ˜¯å…³äºå“ªä¸€å¼ è¡¨çš„ã€‚</p>
<h4 id="type"><a href="#type" class="headerlink" title="type"></a>type</h4><p>è®¿é—®ç±»å‹çš„æ’åˆ—ã€‚</p>
<p>ä¸»è¦æœ‰ï¼š<strong>ALLã€indexã€rangeã€refã€eq_refã€constï¼Œsystemã€NULLã€‚</strong></p>
<p>ä»æœ€å¥½åˆ°æœ€å·®ä¾æ¬¡ä¸ºï¼š<strong>system &gt; const &gt; eq_ref &gt; ref &gt; range &gt; index &gt; ALLã€‚</strong></p>
<p>typeæ˜¾ç¤ºçš„æ˜¯è®¿é—®ç±»å‹ï¼Œæ˜¯è¾ƒä¸ºé‡è¦çš„ä¸€ä¸ªæŒ‡æ ‡ï¼Œç»“æœå€¼ä»æœ€å¥½åˆ°æœ€åä¾æ¬¡æ˜¯ï¼š</p>
<p>system&gt;const&gt;eq_ref&gt;ref&gt;flltext&gt;ref_or_null&gt;index_merge&gt;unique_subquery&gt;index_subquery&gt;range&gt;index&gt;ALL</p>
<p><strong>system &gt; const &gt; eq_ref &gt; ref &gt; range &gt; index &gt; ALLã€‚</strong></p>
<p>ä¸€èˆ¬æ¥è¯´ï¼Œå¾—ä¿è¯æŸ¥è¯¢è‡³å°‘è¾¾åˆ°rangeçº§åˆ«ï¼Œæœ€å¥½èƒ½è¾¾åˆ° refã€‚</p>
<p><strong>1.</strong>   <strong>system</strong></p>
<p>è¡¨åªæœ‰ä¸€è¡Œè®°å½•ï¼ˆç­‰äºç³»ç»Ÿè¡¨ï¼‰ï¼Œè¿™æ˜¯ const ç±»å‹çš„ç‰¹åˆ—ï¼Œå¹³æ—¶ä¸ä¼šå‡ºç°ï¼Œè¿™ä¸ªä¹Ÿå¯ä»¥å¿½ç•¥ä¸è®¡ã€‚</p>
<p><strong>2.</strong>   <strong>const</strong></p>
<p>è¡¨ç¤ºé€šè¿‡ç´¢å¼•ä¸€æ¬¡å°±æ‰¾åˆ°äº†ï¼Œconst ç”¨äºæ¯”è¾ƒ <strong>primary key æˆ–è€… unique ç´¢å¼•</strong>ã€‚å› ä¸ºåªåŒ¹é…ä¸€è¡Œæ•°æ®ï¼Œæ‰€ä»¥å¾ˆå¿«ã€‚å¦‚å°†ä¸»é”®ç½®äº where åˆ—è¡¨ä¸­ï¼ŒMySQLå°±èƒ½å°†è¯¥æŸ¥è¯¢è½¬æ¢ä¸ºä¸€ä¸ªå¸¸é‡ã€‚</p>
<p><img src="/2023/02/28/MySQL/Java\Document\MySQL\MySQL.assets\image-20221006190248776.png" alt="image-20221006190248776"></p>
<p><strong>3.</strong>   <strong>eq_ref</strong></p>
<p>å”¯ä¸€æ€§ç´¢å¼•æ‰«æï¼Œå¯¹äºæ¯ä¸ª<strong>ç´¢å¼•é”®</strong>ï¼Œè¡¨ä¸­åªæœ‰ä¸€æ¡è®°å½•ä¸ä¹‹åŒ¹é…ã€‚å¸¸è§äºä¸»é”®æˆ–å”¯ä¸€ç´¢å¼•æ‰«æã€‚</p>
<p><img src="/2023/02/28/MySQL/Java\Document\MySQL\MySQL.assets\image-20221006190319449.png" alt="image-20221006190319449"></p>
<p><strong>4.</strong>   <strong>ref</strong></p>
<p>éå”¯ä¸€æ€§ç´¢å¼•æ‰«æï¼Œè¿”å›åŒ¹é…æŸä¸ªå•ç‹¬å€¼çš„æ‰€æœ‰è¡Œã€‚</p>
<p>æœ¬è´¨ä¸Šä¹Ÿæ˜¯ä¸€ç§ç´¢å¼•è®¿é—®ï¼Œå®ƒè¿”å›æ‰€æœ‰åŒ¹é…æŸä¸ªå•ç‹¬å€¼çš„è¡Œï¼Œç„¶è€Œå®ƒå¯èƒ½ä¼šæ‰¾åˆ°å¤šä¸ªç¬¦åˆæ¡ä»¶çš„è¡Œï¼Œæ‰€ä»¥å®ƒåº”è¯¥å±äºæŸ¥æ‰¾å’Œæ‰«æçš„æ··åˆä½“ã€‚</p>
<p><img src="/2023/02/28/MySQL/Java\Document\MySQL\MySQL.assets\image-20221006190406575.png" alt="image-20221006190406575"></p>
<p><strong>5.</strong>   <strong>range</strong></p>
<p>åªæ£€ç´¢ç»™å®šèŒƒå›´çš„è¡Œï¼Œä½¿ç”¨ä¸€ä¸ªç´¢å¼•æ¥é€‰æ‹©è¡Œã€‚keyåˆ—æ˜¾ç¤ºä½¿ç”¨äº†å“ªä¸ªç´¢å¼•ã€‚ä¸€èˆ¬å°±æ˜¯åœ¨ä½ çš„whereè¯­å¥ä¸­å‡ºç°äº†betweenã€&lt;ã€&gt;ã€inç­‰çš„æŸ¥è¯¢ã€‚è¿™ç§èŒƒå›´æ‰«æç´¢å¼•æ‰«ææ¯”å…¨è¡¨æ‰«æè¦å¥½ï¼Œå› ä¸ºå®ƒåªéœ€è¦å¼€å§‹äºç´¢å¼•çš„æŸä¸€ç‚¹ï¼Œè€Œç»“æŸè¯­å¦ä¸€ç‚¹ï¼Œä¸ç”¨æ‰«æå…¨éƒ¨ç´¢å¼•ã€‚</p>
<p><img src="/2023/02/28/MySQL/Java\Document\MySQL\MySQL.assets\image-20221006190614716.png" alt="image-20221006190614716"></p>
<p><strong>6.</strong>   <strong>index</strong></p>
<p>Full Index Scan<strong>ï¼Œindex ä¸ ALL åŒºåˆ«ä¸º index ç±»å‹åªéå†ç´¢å¼•æ ‘ã€‚</strong>è¿™é€šå¸¸æ¯”ALLå¿«ï¼Œå› ä¸ºç´¢å¼•æ–‡ä»¶é€šå¸¸æ¯”æ•°æ®æ–‡ä»¶å°ã€‚ä¹Ÿå°±æ˜¯è¯´è™½ç„¶ all å’Œ Index éƒ½æ˜¯è¯»å…¨è¡¨ï¼Œä½† index æ˜¯ä»ç´¢å¼•ä¸­è¯»å–çš„ï¼Œè€Œ all æ˜¯ä»ç¡¬ç›˜ä¸­è¯»çš„ã€‚</p>
<p><img src="/2023/02/28/MySQL/Java\Document\MySQL\MySQL.assets\image-20221006190648292.png" alt="image-20221006190648292"></p>
<p><strong>7.</strong>   <strong>all</strong></p>
<p><strong>Full Table Scanï¼Œå°†éå†å…¨è¡¨ä»¥æ‰¾åˆ°åŒ¹é…çš„è¡Œã€‚</strong></p>
<p><img src="/2023/02/28/MySQL/Java\Document\MySQL\MySQL.assets\image-20221006190755759.png" alt="image-20221006190755759"></p>
<p><strong>å¤‡æ³¨ï¼šä¸€èˆ¬æ¥è¯´ï¼Œå¾—ä¿è¯æŸ¥è¯¢è‡³å°‘è¾¾åˆ°rangeçº§åˆ«ï¼Œæœ€å¥½èƒ½è¾¾åˆ°refã€‚</strong></p>
<h4 id="possible-keys"><a href="#possible-keys" class="headerlink" title="possible_keys"></a>possible_keys</h4><ol>
<li>æ˜¾ç¤ºå¯èƒ½åº”ç”¨åœ¨è¿™å¼ è¡¨ä¸­çš„ç´¢å¼•ï¼Œä¸€ä¸ªæˆ–å¤šä¸ªã€‚</li>
<li>æŸ¥è¯¢æ¶‰åŠåˆ°çš„å­—æ®µè‹¥å­˜åœ¨ç´¢å¼•ï¼Œåˆ™è¯¥ç´¢å¼•å°†è¢«åˆ—å‡ºï¼Œä½†ä¸ä¸€å®šè¢«æŸ¥è¯¢å®é™…ä½¿ç”¨ã€‚</li>
</ol>
<h4 id="key"><a href="#key" class="headerlink" title="key"></a>key</h4><ol>
<li><p>å®é™…ä½¿ç”¨çš„ç´¢å¼•ã€‚å¦‚æœä¸º NULLï¼Œåˆ™æ²¡æœ‰ä½¿ç”¨ç´¢å¼•ã€‚</p>
</li>
<li><p>æŸ¥è¯¢ä¸­è‹¥ä½¿ç”¨äº†è¦†ç›–ç´¢å¼•ï¼Œåˆ™è¯¥ç´¢å¼•ä»…å‡ºç°åœ¨ key åˆ—è¡¨ä¸­ã€‚</p>
</li>
</ol>
<p><strong>è¦†ç›–ç´¢å¼•ï¼š</strong>å»ºç«‹çš„ç´¢å¼•çš„ä¸ªæ•°é¡ºåºå’ŒæŸ¥è¯¢çš„å­—æ®µä¸€è‡´ï¼Œå°±ä¼šé€šè¿‡ç´¢å¼•å»æŸ¥ã€‚</p>
<p><img src="/2023/02/28/MySQL/Java\Document\MySQL\MySQL.assets\image-20221006190924207.png" alt="image-20221006190924207"></p>
<h4 id="ken-len"><a href="#ken-len" class="headerlink" title="ken_len"></a>ken_len</h4><ol>
<li><p>è¡¨ç¤ºç´¢å¼•ä¸­ä½¿ç”¨çš„å­—èŠ‚æ•°ï¼Œå¯é€šè¿‡è¯¥åˆ—è®¡ç®—æŸ¥è¯¢ä¸­ä½¿ç”¨çš„ç´¢å¼•çš„é•¿åº¦ã€‚åœ¨ä¸æŸå¤±ç²¾ç¡®æ€§çš„æƒ…å†µä¸‹ï¼Œé•¿åº¦è¶ŠçŸ­è¶Šå¥½ã€‚</p>
</li>
<li><p>key_ len æ˜¾ç¤ºçš„å€¼ä¸ºç´¢å¼•å­—æ®µçš„æœ€å¤§å¯èƒ½é•¿åº¦ï¼Œå¹¶éå®é™…ä½¿ç”¨é•¿åº¦ï¼Œå³ key_ len æ˜¯æ ¹æ®è¡¨å®šä¹‰è®¡ç®—è€Œå¾—ï¼Œä¸æ˜¯é€šè¿‡è¡¨</p>
</li>
</ol>
<p>â€‹		å†…æ£€ç´¢å‡ºçš„ã€‚</p>
<p><img src="/2023/02/28/MySQL/Java\Document\MySQL\MySQL.assets\image-20221006191031290.png" alt="image-20221006191031290"></p>
<h4 id="ref"><a href="#ref" class="headerlink" title="ref"></a>ref</h4><p>æ˜¾ç¤ºç´¢å¼•çš„å“ªä¸€åˆ—è¢«ä½¿ç”¨äº†ï¼Œå¦‚æœå¯èƒ½çš„è¯ï¼Œæ˜¯ä¸€ä¸ªå¸¸æ•°ã€‚å“ªäº›åˆ—æˆ–å¸¸é‡è¢«ç”¨äºæŸ¥æ‰¾ç´¢å¼•åˆ—ä¸Šçš„å€¼ã€‚</p>
<p><img src="/2023/02/28/MySQL/Java\Document\MySQL\MySQL.assets\image-20221006191129061.png" alt="image-20221006191129061"></p>
<p>å¯¹äº t1 è¡¨ï¼Œkey_len &#x3D; 26ï¼Œç´¢å¼• idx_col1_col2 è¢«å……åˆ†ä½¿ç”¨ï¼Œt1.col2 &#x3D; â€˜acâ€™ è¡¨ç¤ºåŒ¹é…åˆ°äº†ä¸€ä¸ªå¸¸é‡ã€‚</p>
<h4 id="rows"><a href="#rows" class="headerlink" title="rows"></a>rows</h4><p><strong>æ ¹æ®è¡¨ç»Ÿè®¡ä¿¡æ¯åŠç´¢å¼•é€‰ç”¨æƒ…å†µï¼Œå¤§è‡´ä¼°ç®—å‡ºæ‰¾åˆ°æ‰€éœ€çš„è®°å½•æ‰€éœ€è¦è¯»å–çš„è¡Œæ•°ã€‚</strong></p>
<p><img src="/2023/02/28/MySQL/Java\Document\MySQL\MySQL.assets\image-20221006191202220.png" alt="image-20221006191202220"></p>
<h4 id="Extra"><a href="#Extra" class="headerlink" title="Extra"></a>Extra</h4><p>åŒ…å«ä¸é€‚åˆåœ¨å…¶ä»–åˆ—ä¸­æ˜¾ç¤ºä½†ååˆ†é‡è¦çš„é¢å¤–ä¿¡æ¯ã€‚</p>
<h5 id="Using-filesortï¼ˆæ–‡ä»¶å†…æ’åºï¼‰"><a href="#Using-filesortï¼ˆæ–‡ä»¶å†…æ’åºï¼‰" class="headerlink" title="Using filesortï¼ˆæ–‡ä»¶å†…æ’åºï¼‰"></a>Using filesortï¼ˆæ–‡ä»¶å†…æ’åºï¼‰</h5><p>â€‹		è¯´æ˜ mysq| ä¼šå¯¹æ•°æ®ä½¿ç”¨ä¸€ä¸ªå¤–éƒ¨çš„ç´¢å¼•æ’åºï¼Œè€Œä¸æ˜¯æŒ‰ç…§è¡¨å†…çš„ç´¢å¼•é¡ºåºè¿›è¡Œè¯»å–ã€‚MySQLä¸­æ— æ³•åˆ©ç”¨ç´¢å¼•å®Œçš„æ’åºæ“ä½œç§°ä¸ºâ€æ–‡ä»¶æ’åºâ€ã€‚å‡ºç° Using filesort è¯´æ˜æ€§èƒ½å—åˆ°è¾ƒå¤§å½±å“ï¼Œåº”è¯¥å°½é‡é¿å…ã€‚</p>
<p>æŸ¥è¯¢ç”¨åˆ°ï¼Œæ’åºæ²¡æœ‰ç”¨åˆ°<strong>ï¼ˆç´¢å¼• idx_col1_col2_col3 ä¸­ col2æ²¡æœ‰ç”¨åˆ°ï¼Œä¸­æ–­äº†ï¼‰</strong></p>
<p><img src="/2023/02/28/MySQL/Java\Document\MySQL\MySQL.assets\image-20221006191427766.png" alt="image-20221006191427766"></p>
<h5 id="Using-temporary"><a href="#Using-temporary" class="headerlink" title="Using temporary"></a>Using temporary</h5><p>â€‹		ä½¿äº†ç”¨<strong>ä¸´æ—¶è¡¨</strong>ä¿å­˜ä¸­é—´ç»“æœï¼ŒMySQLåœ¨å¯¹æŸ¥è¯¢ç»“æœæ’åºæ—¶ä½¿ç”¨ä¸´æ—¶è¡¨ã€‚å¸¸è§äºæ’åº order by å’Œåˆ†ç»„æŸ¥è¯¢ group byã€‚<strong>ï¼ˆgroup by å°½é‡å’Œç´¢å¼•çš„ä¸ªæ•°å’Œé¡ºåºä¸€è‡´ï¼Œä¸ç®—æŸ¥è¯¢æ¡ä»¶ä¸­çš„å­—æ®µï¼‰</strong></p>
<p><strong>ï¼ˆorder by å°½é‡å’Œç´¢å¼•çš„ä¸ªæ•°å’Œé¡ºåºä¸€è‡´ï¼Œå¯ä»¥åŒ…å«æŸ¥è¯¢æ¡ä»¶çš„å­—æ®µï¼‰</strong></p>
<p><strong>å°½å¯èƒ½é¿å… using filesort å’Œ using temporaryã€‚</strong></p>
<p><img src="/2023/02/28/MySQL/Java\Document\MySQL\MySQL.assets\image-20221006191619424.png" alt="image-20221006191619424"></p>
<p><strong>åˆ†ç»„å­—æ®µ col1å’Œ col2 åº”è¯¥å’Œç´¢å¼•çš„ä¸ªæ•°é¡ºåºä¸€è‡´ï¼Œä¸åº”ä¸­æ–­ã€‚</strong></p>
<h5 id="Using-index"><a href="#Using-index" class="headerlink" title="Using index"></a>Using index</h5><p>è¡¨ç¤ºç›¸åº”çš„ select æ“ä½œä¸­ä½¿ç”¨äº†**è¦†ç›–ç´¢å¼•(Covering Index)**ï¼Œé¿å…è®¿é—®äº†è¡¨çš„æ•°æ®è¡Œï¼Œæ•ˆç‡ä¸é”™ã€‚</p>
<p>å¦‚æœåŒæ—¶å‡ºç° Using whereï¼Œè¡¨æ˜ç´¢å¼•è¢«ç”¨æ¥æ‰§è¡Œç´¢å¼•é”®å€¼çš„æŸ¥æ‰¾ã€‚</p>
<p>å¦‚æœæ²¡æœ‰åŒæ—¶å‡ºç°Using whereï¼Œ<strong>è¡¨æ˜ç´¢å¼•ç”¨æ¥è¯»å–æ•°æ®è€Œéæ‰§è¡ŒæŸ¥æ‰¾åŠ¨ä½œã€‚</strong></p>
<p><strong>è¦†ç›–ç´¢å¼•(Covering Index)ã€‚</strong></p>
<p>è¦†ç›–ç´¢å¼•(Covering Index)ï¼Œä¹Ÿè¯´ä¸ºç´¢å¼•è¦†ç›–ã€‚</p>
<p>ç†è§£æ–¹å¼ä¸€ï¼š</p>
<p>â€‹		å°±æ˜¯ select çš„æ•°æ®åˆ—åªç”¨ä»ç´¢å¼•ä¸­å°±èƒ½å¤Ÿå–å¾—ï¼Œä¸å¿…è¯»å–æ•°æ®è¡Œï¼ŒMySQLå¯ä»¥åˆ©ç”¨ç´¢å¼•è¿”å› select åˆ—è¡¨ä¸­çš„å­—æ®µï¼Œè€Œä¸å¿…æ ¹æ®ç´¢å¼•å†æ¬¡è¯»å–æ•°æ®æ–‡ä»¶ï¼Œæ¢å¥è¯è¯´æŸ¥è¯¢åˆ—è¦è¢«æ‰€å»ºçš„ç´¢å¼•è¦†ç›–ã€‚</p>
<p>ç†è§£æ–¹å¼äºŒï¼š</p>
<p>â€‹		ç´¢å¼•æ˜¯é«˜æ•ˆæ‰¾åˆ°è¡Œçš„ä¸€ä¸ªæ–¹æ³•ï¼Œä½†æ˜¯ä¸€èˆ¬æ•°æ®åº“ä¹Ÿèƒ½ä½¿ç”¨ç´¢å¼•æ‰¾åˆ°ä¸€ä¸ªåˆ—çš„æ•°æ®ï¼Œå› æ­¤å®ƒä¸å¿…è¯»å–æ•´ä¸ªè¡Œã€‚æ¯•ç«Ÿç´¢å¼•å¶å­èŠ‚ç‚¹å­˜å‚¨äº†å®ƒä»¬ç´¢å¼•çš„æ•°æ®ï¼›å½“èƒ½é€šè¿‡è¯»å–ç´¢å¼•å°±å¯ä»¥å¾—åˆ°æƒ³è¦çš„æ•°æ®ï¼Œé‚£å°±ä¸éœ€è¦è¯»å–è¡Œäº†ã€‚ä¸€ä¸ªç´¢å¼•åŒ…å«äº†(æˆ–è¦†ç›–äº†)æ»¡è¶³æŸ¥è¯¢ç»“æœçš„æ•°æ®å°±å«åšè¦†ç›–ç´¢å¼•ã€‚</p>
<p>æ³¨æ„ï¼šå¦‚æœè¦ä½¿ç”¨è¦†ç›–ç´¢å¼•ï¼Œä¸€å®šè¦æ³¨æ„selectåˆ—è¡¨ä¸­åªå–å‡ºéœ€è¦çš„åˆ—ï¼Œä¸å¯ select *ï¼Œå› ä¸ºå¦‚æœå°†æ‰€æœ‰å­—æ®µä¸€èµ·åšç´¢å¼•ä¼šå¯¼è‡´ç´¢å¼•æ–‡ä»¶è¿‡å¤§ï¼ŒæŸ¥è¯¢æ€§èƒ½ä¸‹é™ã€‚</p>
<p><img src="/2023/02/28/MySQL/Java\Document\MySQL\MySQL.assets\image-20221006192057410.png" alt="image-20221006192057410"></p>
<h5 id="Using-where"><a href="#Using-where" class="headerlink" title="Using where"></a>Using where</h5><p>â€‹		è¡¨æ˜ä½¿ç”¨äº†whereè¿‡æ»¤ã€‚</p>
<h5 id="Using-join-buffer"><a href="#Using-join-buffer" class="headerlink" title="Using join buffer"></a>Using join buffer</h5><p>â€‹		ä½¿ç”¨äº†è¿æ¥ç¼“å­˜ã€‚</p>
<h5 id="Impossible-where"><a href="#Impossible-where" class="headerlink" title="Impossible where"></a>Impossible where</h5><p>â€‹		whereå­å¥çš„å€¼æ€»æ˜¯falseï¼Œä¸èƒ½ç”¨æ¥è·å–ä»»ä½•å…ƒç»„ã€‚</p>
<p><img src="/2023/02/28/MySQL/Java\Document\MySQL\MySQL.assets\image-20221006192403646.png" alt="image-20221006192403646"></p>
<h5 id="select-tables-optimized-away"><a href="#select-tables-optimized-away" class="headerlink" title="select tables optimized away"></a>select tables optimized away</h5><p>â€‹		åœ¨æ²¡æœ‰GROUP BYå­å¥çš„æƒ…å†µä¸‹ï¼ŒåŸºäºç´¢å¼•ä¼˜åŒ–MIN&#x2F;MAXæ“ä½œæˆ–è€…å¯¹äºMyISAMå­˜å‚¨å¼•æ“ä¼˜åŒ–COUNT(*) æ“ä½œï¼Œä¸å¿…ç­‰åˆ°æ‰§è¡Œé˜¶æ®µå†è¿›è¡Œè®¡ç®—ï¼ŒæŸ¥è¯¢æ‰§è¡Œè®¡åˆ’ç”Ÿæˆçš„é˜¶æ®µå³å®Œæˆä¼˜åŒ–ã€‚</p>
<h5 id="distinct"><a href="#distinct" class="headerlink" title="distinct"></a>distinct</h5><p>â€‹		ä¼˜åŒ–distinctæ“ä½œï¼Œåœ¨æ‰¾åˆ°ç¬¬ä¸€åŒ¹é…çš„å…ƒç»„åå³åœæ­¢æ‰¾åŒæ ·å€¼çš„åŠ¨ä½œã€‚</p>
<h5 id="ç¤ºä¾‹è¯´æ˜"><a href="#ç¤ºä¾‹è¯´æ˜" class="headerlink" title="ç¤ºä¾‹è¯´æ˜"></a>ç¤ºä¾‹è¯´æ˜</h5><p><img src="/2023/02/28/MySQL/Java\Document\MySQL\MySQL.assets\image-20221006192733929.png" alt="image-20221006192733929"></p>
<p>â€‹		å…ˆæ‰§è¡Œ union åé¢çš„æŸ¥è¯¢è¯­å¥ï¼Œselect_type &#x3D; unionï¼Œå†æ‰§è¡Œ fromåé¢çš„è™šè¡¨ï¼Œå†æ‰§è¡Œ select å­—æ®µä¸­å­æŸ¥è¯¢ï¼Œå†æ‰§è¡Œ union å‰é¢çš„ä¸»æŸ¥è¯¢ï¼Œæœ€åæ‰§è¡Œunion  resultã€‚</p>
<h3 id="å•è¡¨ä¼˜åŒ–æ¡ˆä¾‹"><a href="#å•è¡¨ä¼˜åŒ–æ¡ˆä¾‹" class="headerlink" title="å•è¡¨ä¼˜åŒ–æ¡ˆä¾‹"></a>å•è¡¨ä¼˜åŒ–æ¡ˆä¾‹</h3><p>åˆ›å»ºæµ‹è¯•æ•°æ®ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">-- åˆ›å»ºæ•°æ®åº“ index_db</span><br><span class="line">create table if not exists article(</span><br><span class="line">id int(10) unsigned not null primary key auto_increment,</span><br><span class="line">author_id int(10) unsigned not null,</span><br><span class="line">category_id int(10) unsigned not null,</span><br><span class="line">views int(10) unsigned not null,</span><br><span class="line">comments int(10) unsigned not null,</span><br><span class="line">title varbinary(255) not null,</span><br><span class="line">content text not null</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">insert into article(author_id,category_id,views,comments,title,content) values</span><br><span class="line">(1,1,1,1,&quot;1&quot;,&quot;1&quot;),</span><br><span class="line">(2,2,2,2,&quot;2&quot;,&quot;2&quot;),</span><br><span class="line">(1,1,3,3,&quot;3&quot;,&quot;3&quot;);</span><br><span class="line"></span><br><span class="line">select * from article;</span><br></pre></td></tr></table></figure>

<p>ç¤ºä¾‹ï¼šæŸ¥è¯¢category_idä¸º1ï¼Œcommentså¤§äº1ï¼Œä¸”viewæœ€å¤šçš„article_idã€‚</p>
<p>æœªå»ºç«‹ç´¢å¼•ï¼š</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">show</span> index <span class="keyword">from</span> article;</span><br></pre></td></tr></table></figure>

<p><img src="/2023/02/28/MySQL/Java\Document\MySQL\MySQL.assets\image-20221006193639519.png" alt="image-20221006193639519"></p>
<p>æ‰§è¡ŒSQLï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">explain select id,author_id from article where category_id=1 and comments&gt;1 order by views desc limit 1;</span><br></pre></td></tr></table></figure>

<p><img src="/2023/02/28/MySQL/Java\Document\MySQL\MySQL.assets\image-20221006193826920.png" alt="image-20221006193826920"></p>
<p>å»ºç«‹ç´¢å¼•ï¼š</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- å¯¹äºå¤åˆç´¢å¼•ï¼Œå…ˆæ ¹æ®category_idæŸ¥æ‰¾ï¼Œå†æ ¹æ®commentsæŸ¥æ‰¾ï¼Œå†æ ¹æ®viewsæŸ¥æ‰¾</span></span><br><span class="line"><span class="keyword">create</span> index idx_article_ccv <span class="keyword">on</span> article (category_id,comments,views);</span><br><span class="line"><span class="keyword">show</span> index <span class="keyword">from</span> article;</span><br></pre></td></tr></table></figure>

<p><img src="/2023/02/28/MySQL/Java\Document\MySQL\MySQL.assets\image-20221006194232740.png" alt="image-20221006194232740"></p>
<p>å†æ¬¡explainï¼š</p>
<p><img src="/2023/02/28/MySQL/Java\Document\MySQL\MySQL.assets\image-20221006194414877.png" alt="image-20221006194414877"></p>
<p>ä¿®æ”¹æŸ¥è¯¢æ¡ä»¶ï¼š</p>
<p><img src="/2023/02/28/MySQL/Java\Document\MySQL\MySQL.assets\image-20221006194502965.png" alt="image-20221006194502965"></p>
<p>åŸå› ï¼š<strong>comments&gt;1é€ æˆäº†ç´¢å¼•å¤±æ•ˆï¼Œä¸€èˆ¬å°½å¯èƒ½ç²¾ç¡®ã€‚</strong></p>
<p>åˆ é™¤å¹¶é‡æ–°å»ºç«‹ç´¢å¼•ï¼š</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">drop</span> index idx_article_ccv <span class="keyword">on</span> article;</span><br><span class="line"><span class="keyword">create</span> index idx_article_cv <span class="keyword">on</span> article(category_id,views);</span><br><span class="line"><span class="keyword">show</span> index <span class="keyword">from</span> article;</span><br></pre></td></tr></table></figure>

<p><img src="/2023/02/28/MySQL/Java\Document\MySQL\MySQL.assets\image-20221006194750583.png" alt="image-20221006194750583"></p>
<p>å†æ¬¡explainï¼š</p>
<p><img src="/2023/02/28/MySQL/Java\Document\MySQL\MySQL.assets\image-20221006194914897.png" alt="image-20221006194914897"></p>
<h3 id="ä¸¤è¡¨ä¼˜åŒ–æ¡ˆä¾‹"><a href="#ä¸¤è¡¨ä¼˜åŒ–æ¡ˆä¾‹" class="headerlink" title="ä¸¤è¡¨ä¼˜åŒ–æ¡ˆä¾‹"></a>ä¸¤è¡¨ä¼˜åŒ–æ¡ˆä¾‹</h3><p>å‡†å¤‡æ•°æ®ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">create table if not exists class(</span><br><span class="line">id int(10) unsigned not null auto_increment,</span><br><span class="line">card int(10) unsigned not null,</span><br><span class="line">primary key(id)</span><br><span class="line">);</span><br><span class="line">create table if not exists book(</span><br><span class="line">	bookid int(10) unsigned not null auto_increment,</span><br><span class="line">	card int(10) unsigned not null,</span><br><span class="line">	primary key(bookid)</span><br><span class="line">);</span><br><span class="line">insert into class(card) values(floor(1+(rand()*20)));</span><br><span class="line">insert into class(card) values(floor(1+(rand()*20)));</span><br><span class="line">insert into class(card) values(floor(1+(rand()*20)));</span><br><span class="line">insert into class(card) values(floor(1+(rand()*20)));</span><br><span class="line">insert into class(card) values(floor(1+(rand()*20)));</span><br><span class="line">insert into class(card) values(floor(1+(rand()*20)));</span><br><span class="line">insert into class(card) values(floor(1+(rand()*20)));</span><br><span class="line">insert into class(card) values(floor(1+(rand()*20)));</span><br><span class="line">insert into class(card) values(floor(1+(rand()*20)));</span><br><span class="line">insert into class(card) values(floor(1+(rand()*20)));</span><br><span class="line">insert into class(card) values(floor(1+(rand()*20)));</span><br><span class="line">insert into class(card) values(floor(1+(rand()*20)));</span><br><span class="line">insert into class(card) values(floor(1+(rand()*20)));</span><br><span class="line">insert into class(card) values(floor(1+(rand()*20)));</span><br><span class="line">insert into class(card) values(floor(1+(rand()*20)));</span><br><span class="line">insert into class(card) values(floor(1+(rand()*20)));</span><br><span class="line">insert into class(card) values(floor(1+(rand()*20)));</span><br><span class="line">insert into class(card) values(floor(1+(rand()*20)));</span><br><span class="line">insert into class(card) values(floor(1+(rand()*20)));</span><br><span class="line">insert into class(card) values(floor(1+(rand()*20)));</span><br><span class="line"></span><br><span class="line">insert into book(card) values(floor(1+(rand()*20)));</span><br><span class="line">insert into book(card) values(floor(1+(rand()*20)));</span><br><span class="line">insert into book(card) values(floor(1+(rand()*20)));</span><br><span class="line">insert into book(card) values(floor(1+(rand()*20)));</span><br><span class="line">insert into book(card) values(floor(1+(rand()*20)));</span><br><span class="line">insert into book(card) values(floor(1+(rand()*20)));</span><br><span class="line">insert into book(card) values(floor(1+(rand()*20)));</span><br><span class="line">insert into book(card) values(floor(1+(rand()*20)));</span><br><span class="line">insert into book(card) values(floor(1+(rand()*20)));</span><br><span class="line">insert into book(card) values(floor(1+(rand()*20)));</span><br><span class="line">insert into book(card) values(floor(1+(rand()*20)));</span><br><span class="line">insert into book(card) values(floor(1+(rand()*20)));</span><br><span class="line">insert into book(card) values(floor(1+(rand()*20)));</span><br><span class="line">insert into book(card) values(floor(1+(rand()*20)));</span><br><span class="line">insert into book(card) values(floor(1+(rand()*20)));</span><br><span class="line">insert into book(card) values(floor(1+(rand()*20)));</span><br><span class="line">insert into book(card) values(floor(1+(rand()*20)));</span><br><span class="line">insert into book(card) values(floor(1+(rand()*20)));</span><br><span class="line">insert into book(card) values(floor(1+(rand()*20)));</span><br><span class="line">insert into book(card) values(floor(1+(rand()*20)));</span><br></pre></td></tr></table></figure>

<p>å¯¹è¡¨ book å’Œ class åš inner join æŸ¥è¯¢ï¼š</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">explain <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> class <span class="keyword">inner</span> <span class="keyword">join</span> book <span class="keyword">on</span> book.card <span class="operator">=</span> class.card;</span><br></pre></td></tr></table></figure>

<p><img src="/2023/02/28/MySQL/Java\Document\MySQL\MySQL.assets\image-20221006195225436.png" alt="image-20221006195225436"></p>
<p><strong>ç´¢å¼•åº”è¯¥æ·»åŠ åˆ°é‚£å¼ è¡¨è¿›è¡Œä¼˜åŒ–ï¼Ÿ</strong></p>
<p><strong>å¯¹äºinner joinè¿æ¥ï¼Œç´¢å¼•çš„æ·»åŠ ç±»ä¼¼äºå•è¡¨ã€‚</strong></p>
<p><strong>æƒ…å†µä¸€ï¼šå·¦è¿æ¥ç»™å³è¡¨æ·»åŠ ç´¢å¼•</strong></p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> book <span class="keyword">add</span> index Y(card);</span><br><span class="line">explain <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> class <span class="keyword">left</span> <span class="keyword">join</span> book <span class="keyword">on</span> class.card <span class="operator">=</span> book.card;</span><br></pre></td></tr></table></figure>

<p><img src="/2023/02/28/MySQL/Java\Document\MySQL\MySQL.assets\image-20221006195603694.png" alt="image-20221006195603694"></p>
<p><strong>ç´¢å¼•åº”è¯¥æ·»åŠ åˆ°é‚£å¼ è¡¨è¿›è¡Œä¼˜åŒ–ï¼Ÿ</strong></p>
<p><strong>å¯¹äºinner joinè¿æ¥ï¼Œç´¢å¼•çš„æ·»åŠ ç±»ä¼¼äºå•è¡¨ã€‚</strong></p>
<p><strong>å¯¹äºå·¦è¿æ¥å’Œå³è¿æ¥ï¼š</strong></p>
<p><strong>æƒ…å†µä¸€ï¼šå·¦è¿æ¥ç»™å³è¡¨æ·»åŠ ç´¢å¼•</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">alter table book add index Y(card);</span><br><span class="line">explain select * from class left join book on class.card = book.card;</span><br></pre></td></tr></table></figure>

<p><img src="/2023/02/28/MySQL/Java\Document\MySQL\MySQL.assets\image-20221006195848293.png" alt="image-20221006195848293"></p>
<p><strong>æƒ…å†µäºŒï¼šå·¦è¿æ¥ç»™åå·¦è¡¨æ·»åŠ ç´¢å¼•</strong></p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">drop</span> index Y <span class="keyword">on</span> book;</span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> class <span class="keyword">add</span> index X(card);</span><br><span class="line">explain <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> class <span class="keyword">left</span> <span class="keyword">join</span> book <span class="keyword">on</span> class.card <span class="operator">=</span> book.card;</span><br></pre></td></tr></table></figure>

<p><img src="/2023/02/28/MySQL/Java\Document\MySQL\MySQL.assets\image-20221006195944984.png" alt="image-20221006195944984"></p>
<p>æ€»ç»“ï¼š</p>
<p><strong>å·¦è¿æ¥æŸ¥è¯¢æ—¶ï¼Œå·¦è¡¨çš„æ•°æ®éƒ½æœ‰ï¼Œéœ€è¦å¯¹å³è¾¹çš„æ•°æ®è¿›è¡Œæœç´¢ï¼Œå› æ­¤éœ€è¦å¯¹å³è¡¨çš„æ•°æ®å»ºç«‹ç´¢å¼•ï¼Œåä¹‹ç›¸åŒã€‚</strong></p>
<p><strong>ç´¢å¼•å¯ä»¥åªå»ºç«‹å…¶ä¸­ä¸€å¼ è¡¨ï¼Œåˆ†æƒ…å†µä½¿ç”¨å·¦è¿æ¥æˆ–å³è¿æ¥ã€‚</strong></p>
<p><img src="/2023/02/28/MySQL/Java\Document\MySQL\MySQL.assets\image-20221006200225231.png" alt="image-20221006200225231"></p>
<h3 id="ä¸‰è¡¨ä¼˜åŒ–æ¡ˆä¾‹"><a href="#ä¸‰è¡¨ä¼˜åŒ–æ¡ˆä¾‹" class="headerlink" title="ä¸‰è¡¨ä¼˜åŒ–æ¡ˆä¾‹"></a>ä¸‰è¡¨ä¼˜åŒ–æ¡ˆä¾‹</h3><p>æ•°æ®å‡†å¤‡ï¼šå†æ·»åŠ ä¸€å¼ è¡¨phoneå†æ·»åŠ ä¸€å¼ è¡¨phone</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">create table if not exists phone(</span><br><span class="line">phoneid int(10) unsigned not null auto_increment,</span><br><span class="line">card int(10) unsigned not null,</span><br><span class="line">primary key(phoneid)</span><br><span class="line">);</span><br><span class="line">insert into phone(card) values(floor(1+(rand()*20)));</span><br><span class="line">insert into phone(card) values(floor(1+(rand()*20)));</span><br><span class="line">insert into phone(card) values(floor(1+(rand()*20)));</span><br><span class="line">insert into phone(card) values(floor(1+(rand()*20)));</span><br><span class="line">insert into phone(card) values(floor(1+(rand()*20)));</span><br><span class="line">insert into phone(card) values(floor(1+(rand()*20)));</span><br><span class="line">insert into phone(card) values(floor(1+(rand()*20)));</span><br><span class="line">insert into phone(card) values(floor(1+(rand()*20)));</span><br><span class="line">insert into phone(card) values(floor(1+(rand()*20)));</span><br><span class="line">insert into phone(card) values(floor(1+(rand()*20)));</span><br><span class="line">insert into phone(card) values(floor(1+(rand()*20)));</span><br><span class="line">insert into phone(card) values(floor(1+(rand()*20)));</span><br><span class="line">insert into phone(card) values(floor(1+(rand()*20)));</span><br><span class="line">insert into phone(card) values(floor(1+(rand()*20)));</span><br><span class="line">insert into phone(card) values(floor(1+(rand()*20)));</span><br><span class="line">insert into phone(card) values(floor(1+(rand()*20)));</span><br><span class="line">insert into phone(card) values(floor(1+(rand()*20)));</span><br><span class="line">insert into phone(card) values(floor(1+(rand()*20)));</span><br><span class="line">insert into phone(card) values(floor(1+(rand()*20)));</span><br><span class="line">insert into phone(card) values(floor(1+(rand()*20)));</span><br></pre></td></tr></table></figure>

<p>å¦‚æœä¸‰å¼ è¡¨éƒ½ä¸åŠ ç´¢å¼•ï¼š</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">show</span> index <span class="keyword">from</span> class;</span><br><span class="line"><span class="keyword">drop</span> index X <span class="keyword">on</span> class;</span><br><span class="line">explain <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> class <span class="keyword">left</span> <span class="keyword">join</span> book <span class="keyword">on</span> class.card <span class="operator">=</span> book.card <span class="keyword">left</span> <span class="keyword">join</span> phone <span class="keyword">on</span> book.card <span class="operator">=</span> phone.card;</span><br></pre></td></tr></table></figure>

<p><img src="/2023/02/28/MySQL/Java\Document\MySQL\MySQL.assets\image-20221006202906949.png" alt="image-20221006202906949"></p>
<p>ç»™è¢« JOIN è¡¨æ·»åŠ ç´¢å¼•ï¼š</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">create</span> index Y <span class="keyword">on</span> book(card);</span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> phone <span class="keyword">add</span> index Z(card);</span><br><span class="line">explain <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> class <span class="keyword">left</span> <span class="keyword">join</span> book <span class="keyword">on</span> class.card <span class="operator">=</span> book.card <span class="keyword">left</span> <span class="keyword">join</span> phone <span class="keyword">on</span> book.card <span class="operator">=</span> phone.card;</span><br></pre></td></tr></table></figure>

<p><img src="/2023/02/28/MySQL/Java\Document\MySQL\MySQL.assets\image-20221006203113294.png" alt="image-20221006203113294"></p>
<p><img src="/2023/02/28/MySQL/Java\Document\MySQL\MySQL.assets\image-20221006205026827.png" alt="image-20221006205026827"></p>
<h2 id="ç´¢å¼•ä¼˜åŒ–"><a href="#ç´¢å¼•ä¼˜åŒ–" class="headerlink" title="ç´¢å¼•ä¼˜åŒ–"></a>ç´¢å¼•ä¼˜åŒ–</h2><p>å‡†å¤‡æ•°æ®ï¼š</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> staffs(</span><br><span class="line">id <span class="type">int</span> <span class="keyword">primary</span> key auto_increment,</span><br><span class="line">name <span class="type">varchar</span>(<span class="number">24</span>) <span class="keyword">not</span> <span class="keyword">null</span> <span class="keyword">default</span> <span class="string">&#x27;&#x27;</span> comment &quot;å§“å&quot;,</span><br><span class="line">age <span class="type">int</span> <span class="keyword">not</span> <span class="keyword">null</span> <span class="keyword">default</span> <span class="number">0</span> comment <span class="string">&#x27;å¹´é¾„&#x27;</span>,</span><br><span class="line">pos <span class="type">varchar</span>(<span class="number">20</span>) <span class="keyword">not</span> <span class="keyword">null</span> <span class="keyword">default</span> <span class="string">&#x27;&#x27;</span> comment <span class="string">&#x27;èŒä½&#x27;</span>,</span><br><span class="line">add_time <span class="type">timestamp</span> <span class="keyword">not</span> <span class="keyword">null</span> <span class="keyword">default</span> <span class="built_in">current_timestamp</span> comment <span class="string">&#x27;å…¥èŒæ—¶é—´&#x27;</span></span><br><span class="line">) charset utf8 comment <span class="string">&#x27;å‘˜å·¥è®°å½•è¡¨&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> staffs(name,age,pos,add_time) <span class="keyword">values</span>(<span class="string">&#x27;z3&#x27;</span>,<span class="number">22</span>,<span class="string">&#x27;manager&#x27;</span>,now());</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> staffs(name,age,pos,add_time) <span class="keyword">values</span>(<span class="string">&#x27;July&#x27;</span>,<span class="number">23</span>,<span class="string">&#x27;dev&#x27;</span>,now());</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> staffs(name,age,pos,add_time) <span class="keyword">values</span>(<span class="string">&#x27;2000&#x27;</span>,<span class="number">23</span>,<span class="string">&#x27;dev&#x27;</span>,now());</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> staffs;</span><br><span class="line"><span class="comment">-- æ·»åŠ ç´¢å¼•</span></span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> staffs <span class="keyword">add</span> index idx_staffs_nameAgePos(name,age,pos);</span><br></pre></td></tr></table></figure>

<h4 id="ä¼˜åŒ–ä¸€ï¼šå…¨å€¼åŒ¹é…"><a href="#ä¼˜åŒ–ä¸€ï¼šå…¨å€¼åŒ¹é…" class="headerlink" title="ä¼˜åŒ–ä¸€ï¼šå…¨å€¼åŒ¹é…"></a>ä¼˜åŒ–ä¸€ï¼šå…¨å€¼åŒ¹é…</h4><p>æ¡ä»¶å­—æ®µä¸ç´¢å¼•å­—æ®µå…¨å€¼åŒ¹é…</p>
<p>æ¡ä»¶å­—æ®µçš„é¡ºåºå’Œç´¢å¼•çš„å­—æ®µé¡ºåºç›¸åŒï¼Œä¸”ä¸èƒ½ç•¥è¿‡å‰é¢çš„ç´¢å¼•ï¼Œå¦åˆ™ç´¢å¼•å¤±æ•ˆã€‚</p>
<p><img src="/2023/02/28/MySQL/Java\Document\MySQL\MySQL.assets\image-20221006214908963.png" alt="image-20221006214908963"></p>
<p><img src="/2023/02/28/MySQL/Java\Document\MySQL\MySQL.assets\image-20221006215142556.png" alt="image-20221006215142556"></p>
<h4 id="ä¼˜åŒ–äºŒï¼šæœ€ä½³å·¦å‰ç¼€æ³•åˆ™"><a href="#ä¼˜åŒ–äºŒï¼šæœ€ä½³å·¦å‰ç¼€æ³•åˆ™" class="headerlink" title="ä¼˜åŒ–äºŒï¼šæœ€ä½³å·¦å‰ç¼€æ³•åˆ™"></a>ä¼˜åŒ–äºŒï¼šæœ€ä½³å·¦å‰ç¼€æ³•åˆ™</h4><p>â€‹		å¦‚æœç´¢å¼•äº†å¤šåˆ—ï¼Œè¦éµå®ˆæœ€å·¦å‰ç¼€æ³•åˆ™ã€‚æŒ‡çš„æ˜¯æŸ¥è¯¢ä»ç´¢å¼•çš„æœ€å·¦å‰åˆ—å¼€å§‹å¹¶ä¸”ä¸è·³è¿‡ç´¢å¼•ä¸­çš„åˆ—ã€‚</p>
<p>â€‹		æœ€å·¦è¾¹çš„ç´¢å¼•å¿…é¡»æœ‰ã€‚ä¸­é—´çš„ç´¢å¼•ä¸èƒ½æ–­ã€‚</p>
<p><img src="/2023/02/28/MySQL/Java\Document\MySQL\MySQL.assets\image-20221006220822455.png" alt="image-20221006220822455"></p>
<h4 id="ä¼˜åŒ–ä¸‰ï¼šä¸åœ¨ç´¢å¼•åˆ—ä¸Šåšä»»ä½•æ“ä½œ"><a href="#ä¼˜åŒ–ä¸‰ï¼šä¸åœ¨ç´¢å¼•åˆ—ä¸Šåšä»»ä½•æ“ä½œ" class="headerlink" title="ä¼˜åŒ–ä¸‰ï¼šä¸åœ¨ç´¢å¼•åˆ—ä¸Šåšä»»ä½•æ“ä½œ"></a>ä¼˜åŒ–ä¸‰ï¼šä¸åœ¨ç´¢å¼•åˆ—ä¸Šåšä»»ä½•æ“ä½œ</h4><p>â€‹		ä¸åœ¨ç´¢å¼•åˆ—ä¸Šåšä»»ä½•æ“ä½œï¼ˆè®¡ç®—ã€å‡½æ•°ã€(è‡ªåŠ¨oræ‰‹åŠ¨)ç±»å‹è½¬æ¢ï¼‰ï¼Œä¼šå¯¼è‡´ç´¢å¼•å¤±æ•ˆè€Œè½¬å‘å…¨è¡¨æ‰«æã€‚</p>
<p><img src="/2023/02/28/MySQL/Java\Document\MySQL\MySQL.assets\image-20221006220738234.png" alt="image-20221006220738234"></p>
<h4 id="ä¼˜åŒ–å››ï¼šå­˜å‚¨å¼•æ“ä¸èƒ½ä½¿ç”¨ç´¢å¼•ä¸­èŒƒå›´æ¡ä»¶å³è¾¹çš„åˆ—"><a href="#ä¼˜åŒ–å››ï¼šå­˜å‚¨å¼•æ“ä¸èƒ½ä½¿ç”¨ç´¢å¼•ä¸­èŒƒå›´æ¡ä»¶å³è¾¹çš„åˆ—" class="headerlink" title="ä¼˜åŒ–å››ï¼šå­˜å‚¨å¼•æ“ä¸èƒ½ä½¿ç”¨ç´¢å¼•ä¸­èŒƒå›´æ¡ä»¶å³è¾¹çš„åˆ—"></a>ä¼˜åŒ–å››ï¼šå­˜å‚¨å¼•æ“ä¸èƒ½ä½¿ç”¨ç´¢å¼•ä¸­èŒƒå›´æ¡ä»¶å³è¾¹çš„åˆ—</h4><p>â€‹		name å’Œ age æœ¬èº«ä¹Ÿç”¨åˆ°äº†ç´¢å¼•ã€‚å…¶ä¸­ age æ˜¯æ’åºç”¨åˆ°äº†ç´¢å¼•ï¼Œname æ˜¯æ£€ç´¢ç”¨åˆ°çš„ã€‚</p>
<p><img src="/2023/02/28/MySQL/Java\Document\MySQL\MySQL.assets\image-20221006221117759.png" alt="image-20221006221117759"></p>
<h4 id="ä¼˜åŒ–äº”ï¼šå°½é‡ä½¿ç”¨è¦†ç›–ç´¢å¼•"><a href="#ä¼˜åŒ–äº”ï¼šå°½é‡ä½¿ç”¨è¦†ç›–ç´¢å¼•" class="headerlink" title="ä¼˜åŒ–äº”ï¼šå°½é‡ä½¿ç”¨è¦†ç›–ç´¢å¼•"></a>ä¼˜åŒ–äº”ï¼šå°½é‡ä½¿ç”¨è¦†ç›–ç´¢å¼•</h4><p>å°½é‡ä½¿ç”¨è¦†ç›–ç´¢å¼•ï¼ˆåªè®¿é—®ç´¢å¼•çš„æŸ¥è¯¢(ç´¢å¼•åˆ—å’ŒæŸ¥è¯¢åˆ—ä¸€è‡´ï¼‰ï¼Œå‡å°‘select *ã€‚</p>
<p><strong>ä½¿ç”¨è¦†ç›–ç´¢å¼•ï¼Œå ç”¨çš„å­—èŠ‚æ•°æ›´å°ï¼Œtypeçº§åˆ«æ›´é«˜ã€‚</strong></p>
<p><img src="/2023/02/28/MySQL/Java\Document\MySQL\MySQL.assets\image-20221006221525315.png" alt="image-20221006221525315"></p>
<h4 id="ä¼˜åŒ–å…­ï¼š-x3D-å’Œ-lt-gt-å¯¼è‡´ç´¢å¼•å¤±æ•ˆ"><a href="#ä¼˜åŒ–å…­ï¼š-x3D-å’Œ-lt-gt-å¯¼è‡´ç´¢å¼•å¤±æ•ˆ" class="headerlink" title="ä¼˜åŒ–å…­ï¼š!&#x3D; å’Œ &lt;&gt;å¯¼è‡´ç´¢å¼•å¤±æ•ˆ"></a>ä¼˜åŒ–å…­ï¼š!&#x3D; å’Œ &lt;&gt;å¯¼è‡´ç´¢å¼•å¤±æ•ˆ</h4><p>MySQLåœ¨ä½¿ç”¨ä¸ç­‰äºï¼ˆ!&#x3D;æˆ–è€…&lt;&gt;ï¼‰çš„æ—¶å€™æ— æ³•ä½¿ç”¨ç´¢å¼•ä¼šå¯¼è‡´å…¨è¡¨æ‰«æã€‚</p>
<p><img src="/2023/02/28/MySQL/Java\Document\MySQL\MySQL.assets\image-20221006221655336.png" alt="image-20221006221655336"></p>
<h4 id="ä¼˜åŒ–ä¸ƒï¼šis-nullï¼Œis-not-nullä¹Ÿæ— æ³•ä½¿ç”¨ç´¢å¼•"><a href="#ä¼˜åŒ–ä¸ƒï¼šis-nullï¼Œis-not-nullä¹Ÿæ— æ³•ä½¿ç”¨ç´¢å¼•" class="headerlink" title="ä¼˜åŒ–ä¸ƒï¼šis nullï¼Œis not nullä¹Ÿæ— æ³•ä½¿ç”¨ç´¢å¼•"></a>ä¼˜åŒ–ä¸ƒï¼šis nullï¼Œis not nullä¹Ÿæ— æ³•ä½¿ç”¨ç´¢å¼•</h4><p>ã€ä¸ºä¿è¯ç´¢å¼•ä¸å¤±æ•ˆï¼Œå»ºè®®ä½¿ç”¨é»˜è®¤å€¼ã€‘</p>
<p><img src="/2023/02/28/MySQL/Java\Document\MySQL\MySQL.assets\image-20221006221824011.png" alt="image-20221006221824011"></p>
<h4 id="ä¼˜åŒ–å…«ï¼šlike-ä»¥é€šé…ç¬¦å¼€å¤´ï¼ˆ-abâ€¦â€™ï¼‰"><a href="#ä¼˜åŒ–å…«ï¼šlike-ä»¥é€šé…ç¬¦å¼€å¤´ï¼ˆ-abâ€¦â€™ï¼‰" class="headerlink" title="ä¼˜åŒ–å…«ï¼šlike ä»¥é€šé…ç¬¦å¼€å¤´ï¼ˆ%abâ€¦â€™ï¼‰"></a>ä¼˜åŒ–å…«ï¼šlike ä»¥é€šé…ç¬¦å¼€å¤´ï¼ˆ%abâ€¦â€™ï¼‰</h4><p>like ä»¥é€šé…ç¬¦å¼€å¤´ï¼ˆ%abâ€¦â€™ï¼‰ï¼Œmysq|ç´¢å¼•å¤±æ•ˆä¼šå˜æˆå…¨è¡¨æ‰«æçš„æ“ä½œã€‚</p>
<p><img src="/2023/02/28/MySQL/Java\Document\MySQL\MySQL.assets\image-20221006222003661.png" alt="image-20221006222003661"></p>
<p>July%æ˜¯èŒƒå›´åŒ¹é…ã€‚</p>
<p>é—®é¢˜ï¼šè§£å†³ like  â€˜%å­—ç¬¦ä¸²%â€™  æ—¶ç´¢å¼•ä¸è¢«ä½¿ç”¨çš„æ–¹æ³•ï¼Œ<strong>æŸ¥è¯¢å­—æ®µé‡‡ç”¨ç´¢å¼•</strong>ã€‚</p>
<p>ç¤ºä¾‹ï¼š</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> tbl_user(</span><br><span class="line">id <span class="type">int</span>(<span class="number">11</span>) <span class="keyword">not</span> <span class="keyword">null</span> auto_increment,</span><br><span class="line">name <span class="type">varchar</span>(<span class="number">20</span>) <span class="keyword">default</span> <span class="keyword">null</span>,</span><br><span class="line">age <span class="type">int</span>(<span class="number">11</span>) <span class="keyword">default</span> <span class="keyword">null</span>,</span><br><span class="line">email <span class="type">varchar</span>(<span class="number">20</span>) <span class="keyword">default</span> <span class="keyword">null</span>,</span><br><span class="line"><span class="keyword">primary</span> key(id)</span><br><span class="line">)engine<span class="operator">=</span>innodb auto_increment<span class="operator">=</span><span class="number">1</span> <span class="keyword">default</span> charset<span class="operator">=</span>utf8;</span><br><span class="line"></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> tbl_user(name,age,email) <span class="keyword">values</span>(&quot;1aa1&quot;,<span class="number">21</span>,<span class="string">&#x27;b@163.com&#x27;</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> tbl_user(name,age,email) <span class="keyword">values</span>(&quot;2aa2&quot;,<span class="number">222</span>,<span class="string">&#x27;a@163.com&#x27;</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> tbl_user(name,age,email) <span class="keyword">values</span>(&quot;3aa3&quot;,<span class="number">256</span>,<span class="string">&#x27;c@163.com&#x27;</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> tbl_user(name,age,email) <span class="keyword">values</span>(&quot;4aa4&quot;,<span class="number">21</span>,<span class="string">&#x27;d@163.com&#x27;</span>);</span><br></pre></td></tr></table></figure>

<p>å»ºç«‹ç´¢å¼•ï¼š</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> tbl_user <span class="keyword">add</span> index idx_user_nameAge (name,age);</span><br></pre></td></tr></table></figure>

<p><img src="/2023/02/28/MySQL/Java\Document\MySQL\MySQL.assets\image-20221006222148674.png" alt="image-20221006222148674"></p>
<h4 id="ä¼˜åŒ–ä¹ï¼šå­—ç¬¦ä¸²ä¸åŠ å•å¼•å·ç´¢å¼•å¤±æ•ˆ"><a href="#ä¼˜åŒ–ä¹ï¼šå­—ç¬¦ä¸²ä¸åŠ å•å¼•å·ç´¢å¼•å¤±æ•ˆ" class="headerlink" title="ä¼˜åŒ–ä¹ï¼šå­—ç¬¦ä¸²ä¸åŠ å•å¼•å·ç´¢å¼•å¤±æ•ˆ"></a>ä¼˜åŒ–ä¹ï¼šå­—ç¬¦ä¸²ä¸åŠ å•å¼•å·ç´¢å¼•å¤±æ•ˆ</h4><p>å­—ç¬¦ä¸²ä¸åŠ å•å¼•å·ç´¢å¼•å¤±æ•ˆï¼Œå¯¹äºvarcharç±»å‹ï¼Œå¿…é¡»åŠ å¼•å·ã€‚å¦‚ <strong>â€˜2000â€™ &#x3D; 2000ã€‚</strong></p>
<p><img src="/2023/02/28/MySQL/Java\Document\MySQL\MySQL.assets\image-20221006222518353.png" alt="image-20221006222518353"></p>
<h4 id="ä¼˜åŒ–åï¼šå°‘ç”¨orï¼Œç”¨å®ƒæ¥è¿æ¥æ—¶ä¼šç´¢å¼•å¤±æ•ˆ"><a href="#ä¼˜åŒ–åï¼šå°‘ç”¨orï¼Œç”¨å®ƒæ¥è¿æ¥æ—¶ä¼šç´¢å¼•å¤±æ•ˆ" class="headerlink" title="ä¼˜åŒ–åï¼šå°‘ç”¨orï¼Œç”¨å®ƒæ¥è¿æ¥æ—¶ä¼šç´¢å¼•å¤±æ•ˆ"></a>ä¼˜åŒ–åï¼šå°‘ç”¨orï¼Œç”¨å®ƒæ¥è¿æ¥æ—¶ä¼šç´¢å¼•å¤±æ•ˆ</h4><p><img src="/2023/02/28/MySQL/Java\Document\MySQL\MySQL.assets\image-20221006222646312.png" alt="image-20221006222646312"></p>
<p>ç¤ºä¾‹ï¼šç´¢å¼•æ˜¯å¦è¢«ä½¿ç”¨ï¼Ÿ</p>
<p><img src="/2023/02/28/MySQL/Java\Document\MySQL\MySQL.assets\image-20221006222718225.png" alt="image-20221006222718225"></p>
<h4 id="ç¤ºä¾‹ï¼šç´¢å¼•å¤±æ•ˆçš„æƒ…å†µ"><a href="#ç¤ºä¾‹ï¼šç´¢å¼•å¤±æ•ˆçš„æƒ…å†µ" class="headerlink" title="ç¤ºä¾‹ï¼šç´¢å¼•å¤±æ•ˆçš„æƒ…å†µ"></a>ç¤ºä¾‹ï¼šç´¢å¼•å¤±æ•ˆçš„æƒ…å†µ</h4><p>æ•°æ®å‡†å¤‡ï¼š</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> test03(</span><br><span class="line">id <span class="type">int</span> <span class="keyword">primary</span> key <span class="keyword">not</span> <span class="keyword">null</span> auto_increment,</span><br><span class="line">c1 <span class="type">char</span>(<span class="number">10</span>),</span><br><span class="line">c2 <span class="type">char</span>(<span class="number">10</span>),</span><br><span class="line">c3 <span class="type">char</span>(<span class="number">10</span>),</span><br><span class="line">c4 <span class="type">char</span>(<span class="number">10</span>),</span><br><span class="line">c5 <span class="type">char</span>(<span class="number">10</span>)</span><br><span class="line">);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> test03(c1,c2,c3,c4,c5) <span class="keyword">values</span>(<span class="string">&#x27;a1&#x27;</span>,<span class="string">&#x27;a2&#x27;</span>,<span class="string">&#x27;a3&#x27;</span>,<span class="string">&#x27;a4&#x27;</span>,<span class="string">&#x27;a5&#x27;</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> test03(c1,c2,c3,c4,c5) <span class="keyword">values</span>(<span class="string">&#x27;b1&#x27;</span>,<span class="string">&#x27;b2&#x27;</span>,<span class="string">&#x27;b3&#x27;</span>,<span class="string">&#x27;b4&#x27;</span>,<span class="string">&#x27;b5&#x27;</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> test03(c1,c2,c3,c4,c5) <span class="keyword">values</span>(<span class="string">&#x27;c1&#x27;</span>,<span class="string">&#x27;c2&#x27;</span>,<span class="string">&#x27;c3&#x27;</span>,<span class="string">&#x27;c4&#x27;</span>,<span class="string">&#x27;c5&#x27;</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> test03(c1,c2,c3,c4,c5) <span class="keyword">values</span>(<span class="string">&#x27;d1&#x27;</span>,<span class="string">&#x27;d2&#x27;</span>,<span class="string">&#x27;d3&#x27;</span>,<span class="string">&#x27;d4&#x27;</span>,<span class="string">&#x27;d5&#x27;</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> test03(c1,c2,c3,c4,c5) <span class="keyword">values</span>(<span class="string">&#x27;e1&#x27;</span>,<span class="string">&#x27;e2&#x27;</span>,<span class="string">&#x27;e3&#x27;</span>,<span class="string">&#x27;e4&#x27;</span>,<span class="string">&#x27;e5&#x27;</span>);</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> test03;</span><br><span class="line"><span class="keyword">create</span> index idx_test03_c1234 <span class="keyword">on</span> test03(c1,c2,c3,c4);</span><br><span class="line"><span class="keyword">show</span> index <span class="keyword">from</span> test03;</span><br></pre></td></tr></table></figure>

<p><img src="/2023/02/28/MySQL/Java\Document\MySQL\MySQL.assets\image-20221006223209912.png" alt="image-20221006223209912"></p>
<p><img src="/2023/02/28/MySQL/Java\Document\MySQL\MySQL.assets\image-20221006223342768.png" alt="image-20221006223342768"></p>
<p><img src="/2023/02/28/MySQL/Java\Document\MySQL\MySQL.assets\image-20221006224016041.png" alt="image-20221006224016041"></p>
<p><img src="/2023/02/28/MySQL/Java\Document\MySQL\MySQL.assets\image-20221006224706809.png" alt="image-20221006224706809"></p>
<p><img src="/2023/02/28/MySQL/Java\Document\MySQL\MySQL.assets\image-20221006225059667.png" alt="image-20221006225059667"></p>
<p>æ³¨æ„æŠ¥é”™ï¼š</p>
<p><img src="/2023/02/28/MySQL/Java\Document\MySQL\MySQL.assets\image-20221006225325685.png" alt="image-20221006225325685"></p>
<p>è§£å†³ï¼š<a href="https://blog.csdn.net/weixin_41948075/article/details/123656114">https://blog.csdn.net/weixin_41948075/article/details/123656114</a></p>
<h4 id="ä¸€èˆ¬æ€§å»ºè®®"><a href="#ä¸€èˆ¬æ€§å»ºè®®" class="headerlink" title="ä¸€èˆ¬æ€§å»ºè®®"></a>ä¸€èˆ¬æ€§å»ºè®®</h4><ol>
<li><p>å¯¹äºå•é”®ç´¢å¼•ï¼Œå°½é‡é€‰æ‹©é’ˆå¯¹å½“å‰queryè¿‡æ»¤æ€§æ›´å¥½çš„ç´¢å¼•ã€‚</p>
</li>
<li><p>åœ¨é€‰æ‹©ç»„åˆç´¢å¼•çš„æ—¶å€™ï¼Œå½“å‰Queryä¸­è¿‡æ»¤æ€§æœ€å¥½çš„å­—æ®µåœ¨ç´¢å¼•å­—æ®µé¡ºåºä¸­ï¼Œä½ç½®è¶Šé å‰è¶Šå¥½ã€‚</p>
</li>
<li><p>åœ¨é€‰æ‹©ç»„åˆç´¢å¼•çš„æ—¶å€™ï¼Œå°½é‡é€‰æ‹©å¯ä»¥èƒ½å¤ŸåŒ…å«å½“å‰queryä¸­çš„whereå­—å¥ä¸­æ›´å¤šå­—æ®µçš„ç´¢å¼•ã€‚</p>
</li>
<li><p>å°½å¯èƒ½é€šè¿‡åˆ†æç»Ÿè®¡ä¿¡æ¯å’Œè°ƒæ•´queryçš„å†™æ³•æ¥è¾¾åˆ°é€‰æ‹©åˆé€‚ç´¢å¼•çš„ç›®çš„ã€‚</p>
</li>
</ol>
<h1 id="æŸ¥è¯¢æˆªå–åˆ†æ"><a href="#æŸ¥è¯¢æˆªå–åˆ†æ" class="headerlink" title="æŸ¥è¯¢æˆªå–åˆ†æ"></a>æŸ¥è¯¢æˆªå–åˆ†æ</h1><p>é’ˆå¯¹ç”Ÿäº§ç¯å¢ƒçš„æ…¢SQLï¼š</p>
<ol>
<li><p>è§‚å¯Ÿï¼Œè‡³å°‘è·‘1å¤©ï¼Œçœ‹çœ‹ç”Ÿäº§çš„æ…¢SQLæƒ…å†µã€‚</p>
</li>
<li><p>å¼€å¯æ…¢æŸ¥è¯¢æ—¥å¿—ï¼Œè®¾ç½®é˜™å€¼ï¼Œæ¯”å¦‚è¶…è¿‡5ç§’é’Ÿçš„å°±æ˜¯æ…¢SQLï¼Œ å¹¶å°†å®ƒæŠ“å–å‡ºæ¥ã€‚</p>
</li>
<li><p>explain+æ…¢SQLåˆ†æã€‚</p>
</li>
<li><p>show profileæŸ¥è¯¢SQLåœ¨Mysq1æœåŠ¡å™¨é‡Œé¢çš„æ‰§è¡Œç»†èŠ‚å’Œç”Ÿå‘½å‘¨æœŸæƒ…å†µã€‚</p>
</li>
<li><p>SQLæ•°æ®åº“æœåŠ¡å™¨çš„å‚æ•°è°ƒä¼˜ã€‚</p>
</li>
</ol>
<h2 id="æŸ¥è¯¢ä¼˜åŒ–"><a href="#æŸ¥è¯¢ä¼˜åŒ–" class="headerlink" title="æŸ¥è¯¢ä¼˜åŒ–"></a>æŸ¥è¯¢ä¼˜åŒ–</h2><h3 id="å°è¡¨é©±åŠ¨å¤§è¡¨ï¼ˆin-å’Œ-existsï¼‰"><a href="#å°è¡¨é©±åŠ¨å¤§è¡¨ï¼ˆin-å’Œ-existsï¼‰" class="headerlink" title="å°è¡¨é©±åŠ¨å¤§è¡¨ï¼ˆin å’Œ existsï¼‰"></a>å°è¡¨é©±åŠ¨å¤§è¡¨ï¼ˆin å’Œ existsï¼‰</h3><p><strong>ï¼ˆå°½å¯èƒ½å°‘çš„è¿æ¥ï¼Œå…ˆâ€éå†â€å¤§è¡¨ï¼Œä¼šäº§ç”Ÿæ›´å¤šçš„èµ„æºæ¶ˆè€—ï¼‰</strong></p>
<p><strong>ç¤ºä¾‹</strong></p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- ä¼˜åŒ–åŸåˆ™;å°çš„æ•°æ®é›†é©±åŠ¨å¤§çš„æ•°æ®é›†</span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> A <span class="keyword">where</span> id (<span class="keyword">select</span> id <span class="keyword">from</span> B);</span><br><span class="line"><span class="comment">-- ç­‰ä»·äº</span></span><br><span class="line"><span class="keyword">for</span> <span class="keyword">select</span> id <span class="keyword">from</span> B</span><br><span class="line">	<span class="keyword">for</span> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> A <span class="keyword">where</span> A.id <span class="operator">=</span> B.id</span><br><span class="line"><span class="comment">-- å½“Bè¡¨çš„æ•°æ®é›†å°äºAè¡¨çš„æ•°æ®é›†æ—¶ï¼Œin ä¼˜å…ˆäº exists</span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> A <span class="keyword">where</span> <span class="keyword">exists</span>(<span class="keyword">select</span> <span class="number">1</span> <span class="keyword">from</span> B <span class="keyword">where</span> A.id <span class="operator">=</span> B.id);</span><br><span class="line"><span class="comment">-- ç­‰ä»·äº</span></span><br><span class="line"><span class="keyword">for</span> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> A </span><br><span class="line">	<span class="keyword">for</span> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> B <span class="keyword">where</span> B.id <span class="operator">=</span> A.id</span><br><span class="line"><span class="comment">-- å½“Bè¡¨çš„æ•°æ®é›†å¤§äºAè¡¨çš„æ•°æ®é›†æ—¶ï¼Œexists ä¼˜å…ˆäº in</span></span><br><span class="line"><span class="comment">-- æ³¨æ„ï¼šAè¡¨ä¸Bè¡¨çš„å­—æ®µåº”è¯¥å»ºç«‹ç´¢å¼•</span></span><br></pre></td></tr></table></figure>

<p><strong>å½“Bè¡¨çš„æ•°æ®é›†å°äºAè¡¨çš„æ•°æ®é›†æ—¶ï¼Œç”¨ in ä¼˜äº existsã€‚</strong></p>
<p><strong>å½“Bè¡¨çš„æ•°æ®é›†å¤§äºAè¡¨çš„æ•°æ®é›†æ—¶ï¼Œç”¨ exists ç”±äº inã€‚</strong></p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> tbl_dept;</span><br><span class="line"><span class="operator">+</span><span class="comment">----+----------+----------+</span></span><br><span class="line"><span class="operator">|</span> id <span class="operator">|</span> deptName <span class="operator">|</span> locAddr  <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+----------+----------+</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">1</span> <span class="operator">|</span> RD       <span class="operator">|</span> GanSu    <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">2</span> <span class="operator">|</span> HR       <span class="operator">|</span> XiAN     <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">3</span> <span class="operator">|</span> MK       <span class="operator">|</span> BeiJing  <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">4</span> <span class="operator">|</span> MIS      <span class="operator">|</span> ShangHai <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">5</span> <span class="operator">|</span> FD       <span class="operator">|</span> ShenZhen <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+----------+----------+</span></span><br><span class="line"><span class="number">5</span> <span class="keyword">rows</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> tbl_emp;</span><br><span class="line"><span class="operator">+</span><span class="comment">----+------+--------+</span></span><br><span class="line"><span class="operator">|</span> id <span class="operator">|</span> NAME <span class="operator">|</span> deptId <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+------+--------+</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">1</span> <span class="operator">|</span> E1   <span class="operator">|</span>      <span class="number">1</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">2</span> <span class="operator">|</span> E2   <span class="operator">|</span>      <span class="number">1</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">3</span> <span class="operator">|</span> E3   <span class="operator">|</span>      <span class="number">1</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">4</span> <span class="operator">|</span> EA   <span class="operator">|</span>      <span class="number">2</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">5</span> <span class="operator">|</span> EB   <span class="operator">|</span>      <span class="number">2</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">6</span> <span class="operator">|</span> W1   <span class="operator">|</span>      <span class="number">3</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">7</span> <span class="operator">|</span> W2   <span class="operator">|</span>      <span class="number">4</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">8</span> <span class="operator">|</span> W3   <span class="operator">|</span>     <span class="number">51</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+------+--------+</span></span><br><span class="line"><span class="number">8</span> <span class="keyword">rows</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> tbl_dept d <span class="keyword">where</span> <span class="keyword">exists</span>(<span class="keyword">select</span> <span class="number">1</span> <span class="keyword">from</span> tbl_emp e <span class="keyword">where</span> d.id <span class="operator">=</span> e.deptId);</span><br><span class="line"><span class="operator">+</span><span class="comment">----+----------+----------+</span></span><br><span class="line"><span class="operator">|</span> id <span class="operator">|</span> deptName <span class="operator">|</span> locAddr  <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+----------+----------+</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">1</span> <span class="operator">|</span> RD       <span class="operator">|</span> GanSu    <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">2</span> <span class="operator">|</span> HR       <span class="operator">|</span> XiAN     <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">3</span> <span class="operator">|</span> MK       <span class="operator">|</span> BeiJing  <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">4</span> <span class="operator">|</span> MIS      <span class="operator">|</span> ShangHai <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+----------+----------+</span></span><br><span class="line"><span class="number">4</span> <span class="keyword">rows</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> tbl_emp e <span class="keyword">where</span> e.deptId <span class="keyword">in</span> (<span class="keyword">select</span> id <span class="keyword">from</span> tbl_dept);</span><br><span class="line"><span class="operator">+</span><span class="comment">----+------+--------+</span></span><br><span class="line"><span class="operator">|</span> id <span class="operator">|</span> NAME <span class="operator">|</span> deptId <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+------+--------+</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">1</span> <span class="operator">|</span> E1   <span class="operator">|</span>      <span class="number">1</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">2</span> <span class="operator">|</span> E2   <span class="operator">|</span>      <span class="number">1</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">3</span> <span class="operator">|</span> E3   <span class="operator">|</span>      <span class="number">1</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">4</span> <span class="operator">|</span> EA   <span class="operator">|</span>      <span class="number">2</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">5</span> <span class="operator">|</span> EB   <span class="operator">|</span>      <span class="number">2</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">6</span> <span class="operator">|</span> W1   <span class="operator">|</span>      <span class="number">3</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">7</span> <span class="operator">|</span> W2   <span class="operator">|</span>      <span class="number">4</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+------+--------+</span></span><br><span class="line"><span class="number">7</span> <span class="keyword">rows</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong>in å’Œ exists çš„åŒºåˆ«</strong></p>
<p><strong>EXISTS</strong></p>
<p><strong>SELECT â€¦ FROM table WHERE EXISTS (subquery)</strong></p>
<p>å¯ä»¥ç†è§£ä¸ºï¼šå°†ä¸»æŸ¥è¯¢çš„æ•°æ®ï¼Œæ”¾åˆ°å­æŸ¥è¯¢ä¸­åšæ¡ä»¶éªŒè¯ï¼Œæ ¹æ®éªŒè¯ç»“æœ(TRUEæˆ–FALSE)æ¥å†³å®šä¸»æŸ¥è¯¢çš„æ•°æ®ç»“æœæ˜¯å¦å¾—ä»¥ä¿ç•™ã€‚</p>
<p><strong>EXISTS (subquery)åªè¿”å›TRUEæˆ–FALSE, å› æ­¤å­æŸ¥è¯¢ä¸­çš„SELECT * ä¹Ÿå¯ä»¥æ˜¯SELECT 1æˆ–select â€˜Xâ€™,</strong> å®˜æ–¹è¯´æ³•æ˜¯å®é™…æ‰§è¡Œæ—¶ä¼šå¿½ç•¥SELECTæ¸…å•ï¼Œå› æ­¤æ²¡æœ‰ã€‚</p>
<p><strong>åŒºåˆ«</strong></p>
<ol>
<li><p>EXISTSå­æŸ¥è¯¢çš„å®é™…æ‰§è¡Œè¿‡ç¨‹å¯èƒ½ç»è¿‡äº†ä¼˜åŒ–è€Œä¸æ˜¯æˆ‘ä»¬ç†è§£ä¸Šçš„é€æ¡å¯¹æ¯”ï¼Œå¦‚æœæ‹…å¿§æ•ˆç‡é—®é¢˜ï¼Œå¯è¿›è¡Œå®é™…æ£€éªŒä»¥ç¡®å®šæ˜¯å¦æœ‰æ•ˆç‡é—®é¢˜ã€‚</p>
</li>
<li><p>EXISTSå­æŸ¥è¯¢å¾€å¾€ä¹Ÿå¯ä»¥ç”¨æ¡ä»¶è¡¨è¾¾å¼ã€å…¶ä»–å­æŸ¥è¯¢æˆ–è€…JOINæ¥æ›¿ä»£ï¼Œä½•ç§æœ€ä¼˜éœ€è¦å…·ä½“é—®é¢˜å…·ä½“åˆ†æã€‚</p>
</li>
</ol>
<h3 id="ORDER-BYå…³é”®å­—ä¼˜åŒ–"><a href="#ORDER-BYå…³é”®å­—ä¼˜åŒ–" class="headerlink" title="ORDER BYå…³é”®å­—ä¼˜åŒ–"></a>ORDER BYå…³é”®å­—ä¼˜åŒ–</h3><ol>
<li>ORDER BYå­å¥å°½å¯èƒ½ä½¿ç”¨ Index æ’åºï¼Œé¿å…ä½¿ç”¨ Using filesort æ–¹å¼æ’åºã€‚</li>
</ol>
<p><img src="/2023/02/28/MySQL/Java\Document\MySQL\MySQL.assets\image-20221006231402679.png" alt="image-20221006231402679"></p>
<p><img src="/2023/02/28/MySQL/Java\Document\MySQL\MySQL.assets\image-20221006231427799.png" alt="image-20221006231427799"></p>
<ol start="2">
<li><p>å°½å¯èƒ½åœ¨ç´¢å¼•åˆ—ä¸Šå®Œæˆæ’åºæ“ä½œï¼Œéµç…§ç´¢å¼•å»ºçš„æœ€ä½³å·¦å‰ç¼€ã€‚</p>
</li>
<li><p>å¦‚æœä¸åœ¨ç´¢å¼•åˆ—ä¸Šï¼Œfilesortæœ‰ä¸¤ç§ç®—æ³•ï¼šmysqlå°±è¦å¯åŠ¨åŒè·¯æ’åºå’Œå•è·¯æ’åºã€‚</p>
</li>
</ol>
<h3 id="filesort"><a href="#filesort" class="headerlink" title="filesort"></a>filesort</h3><p>MySQLæ”¯æŒäºŒç§æ–¹å¼çš„æ’åºï¼Œfilesort å’ŒIndexï¼Œindexæ•ˆç‡é«˜ã€‚å®ƒæŒ‡MySQLæ‰«æç´¢å¼•æœ¬èº«å®Œæˆæ’åºã€‚filesort æ–¹å¼æ•ˆç‡è¾ƒä½ã€‚</p>
<p>ORDER BYæ»¡è¶³ä¸¤æƒ…å†µï¼Œä¼šä½¿ç”¨Indexæ–¹å¼æ’åºï¼š</p>
<ul>
<li>ORDER BYè¯­å¥ä½¿ç”¨ç´¢å¼•æœ€å·¦å‰åˆ—ã€‚</li>
<li>ä½¿ç”¨ where å­å¥ä¸ order by å­å¥æ¡ä»¶åˆ—ç»„åˆæ»¡è¶³ç´¢å¼•æœ€å·¦å‰åˆ—ã€‚</li>
</ul>
<h3 id="group-byå…³é”®å­—ä¼˜åŒ–"><a href="#group-byå…³é”®å­—ä¼˜åŒ–" class="headerlink" title="group byå…³é”®å­—ä¼˜åŒ–"></a>group byå…³é”®å­—ä¼˜åŒ–</h3><ol>
<li><p>group byå®è´¨æ˜¯å…ˆæ’åºåè¿›è¡Œåˆ†ç»„ï¼Œéµç…§ç´¢å¼•å»ºçš„æœ€ä½³å·¦å‰ç¼€</p>
</li>
<li><p>å½“æ— æ³•ä½¿ç”¨ç´¢å¼•åˆ—ï¼Œå¢å¤§max_length_for_sort_dataå‚æ•°çš„è®¾ç½® + å¢å¤§sort_buffer_sizeå‚æ•°çš„è®¾ç½®</p>
</li>
<li><p>where é«˜äº having, èƒ½å†™åœ¨ where é™å®šçš„æ¡ä»¶å°±ä¸è¦å» having é™å®šäº†ã€‚</p>
</li>
</ol>
<h2 id="æ…¢æŸ¥è¯¢æ—¥å¿—"><a href="#æ…¢æŸ¥è¯¢æ—¥å¿—" class="headerlink" title="æ…¢æŸ¥è¯¢æ—¥å¿—"></a>æ…¢æŸ¥è¯¢æ—¥å¿—</h2><h3 id="å®šä¹‰-1"><a href="#å®šä¹‰-1" class="headerlink" title="å®šä¹‰"></a>å®šä¹‰</h3><ol>
<li><p>MySQLçš„æ…¢æŸ¥è¯¢æ—¥å¿—æ˜¯ MySQL æä¾›çš„ä¸€ç§æ—¥å¿—è®°å½•ï¼Œå®ƒç”¨æ¥è®°å½•åœ¨ MySQL ä¸­å“åº”æ—¶é—´è¶…è¿‡é˜€å€¼çš„è¯­å¥ï¼Œå…·ä½“æŒ‡è¿è¡Œæ—¶é—´è¶…è¿‡ long_query_time å€¼çš„ SQLï¼Œåˆ™ä¼šè¢«è®°å½•åˆ°æ…¢æŸ¥è¯¢æ—¥å¿—ä¸­ã€‚</p>
</li>
<li><p>å…·ä½“æŒ‡è¿è¡Œæ—¶é—´è¶…è¿‡ long_query_time å€¼çš„SQLï¼Œåˆ™ä¼šè¢«è®°å½•åˆ°æ…¢æŸ¥è¯¢æ—¥å¿—ä¸­ã€‚long_query_time çš„é»˜è®¤å€¼ä¸º10ï¼Œæ„æ€æ˜¯è¿è¡Œ10ç§’ä»¥ä¸Šçš„è¯­å¥ã€‚</p>
</li>
<li><p>ç”±å®ƒæ¥æŸ¥çœ‹å“ªäº›SQLè¶…å‡ºäº†æˆ‘ä»¬çš„æœ€å¤§å¿è€æ—¶é—´å€¼ï¼Œæ¯”å¦‚ä¸€æ¡sq|æ‰§è¡Œè¶…è¿‡5ç§’é’Ÿï¼Œæˆ‘ä»¬å°±ç®—æ…¢SQLï¼Œå¸Œæœ›èƒ½æ”¶é›†è¶…è¿‡5ç§’çš„ sqlï¼Œç»“åˆä¹‹å‰ explain è¿›è¡Œå…¨é¢åˆ†æã€‚</p>
</li>
</ol>
<h3 id="ä½¿ç”¨"><a href="#ä½¿ç”¨" class="headerlink" title="ä½¿ç”¨"></a>ä½¿ç”¨</h3><p>é»˜è®¤æƒ…å†µä¸‹ï¼ŒMySQLæ•°æ®åº“æ²¡æœ‰å¼€å¯æ…¢æŸ¥è¯¢æ—¥å¿—ï¼Œéœ€è¦æˆ‘ä»¬æ‰‹åŠ¨æ¥è®¾ç½®è¿™ä¸ªå‚æ•°ã€‚</p>
<p>å½“ç„¶ï¼Œå¦‚æœä¸æ˜¯è°ƒä¼˜éœ€è¦çš„è¯ï¼Œä¸€èˆ¬ä¸å»ºè®®å¯åŠ¨è¯¥å‚æ•°ï¼Œå› ä¸ºå¼€å¯æ…¢æŸ¥è¯¢æ—¥å¿—ä¼šæˆ–å¤šæˆ–å°‘å¸¦æ¥ä¸€å®šçš„æ€§èƒ½å½±å“ã€‚<strong>æ…¢æŸ¥è¯¢æ—¥å¿—æ”¯æŒå°†æ—¥å¿—è®°å½•å†™å…¥æ–‡ä»¶ã€‚</strong></p>
<h4 id="æŸ¥çœ‹æ˜¯å¦å¼€å¯ä»¥åŠå¦‚ä½•å¼€å¯"><a href="#æŸ¥çœ‹æ˜¯å¦å¼€å¯ä»¥åŠå¦‚ä½•å¼€å¯" class="headerlink" title="æŸ¥çœ‹æ˜¯å¦å¼€å¯ä»¥åŠå¦‚ä½•å¼€å¯"></a>æŸ¥çœ‹æ˜¯å¦å¼€å¯ä»¥åŠå¦‚ä½•å¼€å¯</h4><p>é»˜è®¤ï¼š<strong>show variables like â€œ%slow_query_log%â€;</strong></p>
<p>é»˜è®¤æƒ…å†µä¸‹ slow_query_log çš„å€¼ä¸ºOFFï¼Œè¡¨ç¤ºæ…¢æŸ¥è¯¢æ—¥å¿—æ˜¯ç¦ç”¨çš„ï¼Œå¯ä»¥é€šè¿‡è®¾ç½®slow_ query logçš„å€¼æ¥å¼€å¯ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">mysql&gt; show variables like &#x27;%slow_query_log%&#x27;;</span><br><span class="line">+---------------------+------------------------------------------+</span><br><span class="line">| Variable_name       | Value                                    |</span><br><span class="line">+---------------------+------------------------------------------+</span><br><span class="line">| slow_query_log      | OFF                                      |</span><br><span class="line">| slow_query_log_file | /usr/local/mysql/data/localhost-slow.log |</span><br><span class="line">+---------------------+------------------------------------------+</span><br><span class="line">2 rows in set (0.02 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; set global slow_query_log = 1;</span><br><span class="line">Query OK, 0 rows affected (0.01 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; show variables like &#x27;%slow_query_log%&#x27;;</span><br><span class="line">+---------------------+------------------------------------------+</span><br><span class="line">| Variable_name       | Value                                    |</span><br><span class="line">+---------------------+------------------------------------------+</span><br><span class="line">| slow_query_log      | ON                                       |</span><br><span class="line">| slow_query_log_file | /usr/local/mysql/data/localhost-slow.log |</span><br><span class="line">+---------------------+------------------------------------------+</span><br></pre></td></tr></table></figure>

<p>ä½¿ç”¨ set global slow_query_log&#x3D;1 å¼€å¯äº†æ…¢æŸ¥è¯¢æ—¥å¿—<strong>åªå¯¹å½“å‰æ•°æ®åº“ç”Ÿæ•ˆ</strong>ï¼Œå¦‚æœMySQLé‡å¯ååˆ™ä¼šå¤±æ•ˆã€‚</p>
<p><strong>å¦‚æœè¦æ°¸ä¹…ç”Ÿæ•ˆï¼Œå°±å¿…é¡»ä¿®æ”¹é…ç½®æ–‡ä»¶my.cnf (å…¶å®ƒç³»ç»Ÿå˜é‡ä¹Ÿæ˜¯å¦‚æ­¤)</strong></p>
<p>ä¿®æ”¹ my.cnf æ–‡ä»¶ï¼Œ[mysqld] ä¸‹å¢åŠ æˆ–ä¿®æ”¹å‚æ•°ã€‚</p>
<p>**slow_query_log **å’Œ <strong>slow_query_log_file</strong>åï¼Œç„¶åé‡å¯MySQLæœåŠ¡å™¨ã€‚å³å°†å¦‚ä¸‹ä¸¤è¡Œé…ç½®è¿›my.cnfæ–‡ä»¶ã€‚</p>
<p><strong>slow_query_log&#x3D;1</strong></p>
<p><strong>slow_query_log_file&#x3D;&#x2F;var&#x2F;lib&#x2F;mysql&#x2F;localhost-slow.log æˆ–è€…</strong></p>
<p><strong>slow_query_log_file&#x3D;&#x2F;usr&#x2F;local&#x2F;mysql&#x2F;data&#x2F;localhost-slow.log</strong></p>
<p>å…³äºæ…¢æŸ¥è¯¢çš„å‚æ•°<strong>slow_query_log_file</strong>ï¼Œå®ƒæŒ‡å®šæ…¢æŸ¥è¯¢æ—¥å¿—æ–‡ä»¶çš„å­˜æ”¾è·¯å¾„ï¼Œç³»ç»Ÿé»˜è®¤ä¼šç»™ä¸€ä¸ªç¼ºçœçš„æ–‡ä»¶<strong>localhost-slow.log</strong> ï¼ˆå¦‚æœæ²¡æœ‰æŒ‡å®šå‚æ•°<strong>slow_query_log_file</strong>çš„è¯ï¼‰ã€‚</p>
<h4 id="è®¾ç½®é˜ˆå€¼æ—¶é—´"><a href="#è®¾ç½®é˜ˆå€¼æ—¶é—´" class="headerlink" title="è®¾ç½®é˜ˆå€¼æ—¶é—´"></a>è®¾ç½®é˜ˆå€¼æ—¶é—´</h4><p>è¿™ä¸ªæ˜¯ç”±å‚æ•° long_query_time æ§åˆ¶ï¼Œ é»˜è®¤æƒ…å†µä¸‹**long_query_time **çš„å€¼ä¸º10ç§’ã€‚</p>
<p>å‘½ä»¤ï¼š<strong>SHOW VARIABLES LIKE â€œ%long_query_time%â€;</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">mysql&gt; show variables like &#x27;%long_query_time%&#x27;;</span><br><span class="line">+-----------------+-----------+</span><br><span class="line">| Variable_name   | Value     |</span><br><span class="line">+-----------------+-----------+</span><br><span class="line">| long_query_time | 10.000000 |</span><br><span class="line">+-----------------+-----------+</span><br><span class="line">1 row in set (0.01 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; set global long_query_time = 3;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; show variables like &#x27;%long_query_time%&#x27;;</span><br><span class="line">+-----------------+-----------+</span><br><span class="line">| Variable_name   | Value     |</span><br><span class="line">+-----------------+-----------+</span><br><span class="line">| long_query_time | 10.000000 |</span><br><span class="line">+-----------------+-----------+</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; show global variables like &#x27;%long_query_time%&#x27;;</span><br><span class="line">+-----------------+----------+</span><br><span class="line">| Variable_name   | Value    |</span><br><span class="line">+-----------------+----------+</span><br><span class="line">| long_query_time | 3.000000 |</span><br><span class="line">+-----------------+----------+</span><br></pre></td></tr></table></figure>

<p>å¯ä»¥ä½¿ç”¨å‘½ä»¤ä¿®æ”¹ï¼Œä¹Ÿå¯ä»¥åœ¨ my.cnf å‚æ•°é‡Œé¢ä¿®æ”¹ã€‚</p>
<p>å‡å¦‚è¿è¡Œæ—¶é—´æ­£å¥½ç­‰äº long_query_time çš„æƒ…å†µï¼Œå¹¶ä¸ä¼šè¢«è®°å½•ä¸‹æ¥ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨ MySQL æºç é‡Œæ˜¯åˆ¤æ–­å¤§äºlong_query_timeï¼Œè€Œéå¤§äºç­‰äºã€‚</p>
<p><strong>è®¾ç½®åæ²¡æœ‰æ”¹å˜ï¼šéœ€è¦é‡æ–°è¿æ¥æˆ–æ–°å¼€å¯ä¸€ä¸ªä¼šè¯æ‰èƒ½çœ‹åˆ°ä¿®æ”¹çš„å€¼ã€‚</strong></p>
<h4 id="æ…¢æŸ¥è¯¢ç¤ºä¾‹"><a href="#æ…¢æŸ¥è¯¢ç¤ºä¾‹" class="headerlink" title="æ…¢æŸ¥è¯¢ç¤ºä¾‹"></a>æ…¢æŸ¥è¯¢ç¤ºä¾‹</h4><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">mysql&gt; select sleep(4);</span><br><span class="line">+----------+</span><br><span class="line">| sleep(4) |</span><br><span class="line">+----------+</span><br><span class="line">|        0 |</span><br><span class="line">+----------+</span><br><span class="line">1 row in set (4.00 sec)</span><br></pre></td></tr></table></figure>

<p>æŸ¥çœ‹æ…¢æŸ¥è¯¢æ—¥å¿—ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@localhost ~]# cat -n /usr/local/mysql/data/localhost-slow.log</span><br><span class="line">     1  /usr/local/mysql/bin/mysqld, Version: 5.7.36 (MySQL Community Server (GPL)). started with:</span><br><span class="line">     2  Tcp port: 3306  Unix socket: /tmp/mysql.sock</span><br><span class="line">     3  Time                 Id Command    Argument</span><br><span class="line">     4  # Time: 2022-04-29T10:19:17.035870Z</span><br><span class="line">     5  # User@Host: root[root] @ localhost []  Id:     4</span><br><span class="line">     6  # Query_time: 4.001412  Lock_time: 0.000000 Rows_sent: 1  Rows_examined: 0</span><br><span class="line">     7  use index_db;</span><br><span class="line">     8  SET timestamp=1651227557;</span><br><span class="line">     9  select sleep(4);</span><br><span class="line">    10  # Time: 2022-04-29T10:20:27.102982Z</span><br><span class="line">    11  # User@Host: root[root] @ localhost []  Id:     4</span><br><span class="line">    12  # Query_time: 4.000828  Lock_time: 0.000000 Rows_sent: 1  Rows_examined: 0</span><br><span class="line">    13  SET timestamp=1651227627;</span><br><span class="line">    14  select sleep(4);</span><br></pre></td></tr></table></figure>

<p>æŸ¥è¯¢ç³»ç»Ÿä¸­æœ‰å¤šå°‘æ¡æ…¢SQLï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">mysql&gt; show global status like &#x27;%Slow_queries%&#x27;;</span><br><span class="line">+---------------+-------+</span><br><span class="line">| Variable_name | Value |</span><br><span class="line">+---------------+-------+</span><br><span class="line">| Slow_queries  | 2     |</span><br><span class="line">+---------------+-------+</span><br><span class="line">1 row in set (0.01 sec)</span><br></pre></td></tr></table></figure>

<h4 id="æ–‡ä»¶é…ç½®"><a href="#æ–‡ä»¶é…ç½®" class="headerlink" title="æ–‡ä»¶é…ç½®"></a>æ–‡ä»¶é…ç½®</h4><p><strong>[mysqld]ä¸‹é…ç½®ï¼š</strong></p>
<p><strong>slow_query_log&#x3D;1;</strong></p>
<p><strong>slow_guery_log_file&#x3D;&#x2F;var&#x2F;ib&#x2F;mysql&#x2F;localhost-slow.log</strong></p>
<p><strong># slow_guery_log_file&#x3D;&#x2F;usr&#x2F;local&#x2F;mysql&#x2F;localhost-slow.log</strong></p>
<p><strong>long_query_time&#x3D;3;</strong></p>
<p><strong>log_output&#x3D;FILE</strong></p>
<h3 id="æ—¥å¿—åˆ†æå·¥å…·-mysqldumpslow"><a href="#æ—¥å¿—åˆ†æå·¥å…·-mysqldumpslow" class="headerlink" title="æ—¥å¿—åˆ†æå·¥å…· mysqldumpslow"></a>æ—¥å¿—åˆ†æå·¥å…· mysqldumpslow</h3><p><strong>åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œå¦‚æœè¦æ‰‹å·¥åˆ†ææ—¥å¿—ï¼ŒæŸ¥æ‰¾ã€åˆ†æSQLï¼Œæ˜¾ç„¶æ˜¯ä¸ªä½“åŠ›æ´»ï¼ŒMySQLæä¾›äº†æ—¥å¿—åˆ†æå·¥å…·ï¼šmysqldumpslowã€‚</strong></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">mysqldumpslow: æœªæ‰¾åˆ°å‘½ä»¤</span></span><br><span class="line">ln -s /usr/local/mysql/bin/mysqldumpslow /usr/bin</span><br></pre></td></tr></table></figure>



<p><strong>æŸ¥çœ‹å¸®åŠ©ä¿¡æ¯</strong></p>
<p><strong>mysqldumpslow â€“help</strong></p>
<p><strong>sï¼šæ˜¯è¡¨ç¤ºæŒ‰ç…§ä½•ç§æ–¹å¼æ’åº</strong></p>
<p><strong>cï¼šè®¿é—®æ¬¡æ•°</strong></p>
<p><strong>|ï¼šé”å®šæ—¶é—´</strong></p>
<p><strong>rï¼šè¿”å›è®°å½•</strong></p>
<p><strong>tï¼šæŸ¥è¯¢æ—¶é—´</strong></p>
<p><strong>alï¼šå¹³å‡é”å®šæ—¶é—´</strong></p>
<p><strong>arï¼šå¹³å‡è¿”å›è®°å½•æ•°</strong></p>
<p><strong>atï¼šå¹³å‡æŸ¥è¯¢æ—¶é—´</strong></p>
<p><strong>tï¼šå³ä¸ºè¿”å›å‰é¢å¤šå°‘æ¡çš„æ•°æ®</strong></p>
<p><strong>gï¼šåè¾¹æ­é…ä¸€ä¸ªæ­£åˆ™åŒ¹é…æ¨¡å¼ï¼Œå¤§å°å†™ä¸æ•æ„Ÿçš„</strong></p>
<p><strong>å¾—åˆ°è¿”å›è®°å½•é›†æœ€å¤šçš„10ä¸ªSQL</strong> </p>
<p>æ—¥å¿—æ–‡ä»¶ä½ç½®ï¼š</p>
<p>&#x2F;var&#x2F;ib&#x2F;mysql&#x2F;localhost-slow.log</p>
<p>æˆ–è€…</p>
<p>&#x2F;usr&#x2F;local&#x2F;mysql&#x2F;data&#x2F;localhost-slow.log</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">mysqldumpslow -s r -t 10 /usr/local/mysql/data/localhost-slow.log</span><br></pre></td></tr></table></figure>

<p><strong>å¾—åˆ°è®¿é—®æ¬¡æ•°æœ€å¤šçš„10ä¸ªSQL</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">mysqldumpslow -s c -t 10 /var/ib/mysq/localhost-slow.log</span><br></pre></td></tr></table></figure>

<p><strong>å¾—åˆ°æŒ‰ç…§æ—¶é—´æ’åºçš„å‰10æ¡é‡Œé¢å«æœ‰å·¦è¿æ¥çš„æŸ¥è¯¢è¯­å¥</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">mysqldumpslow -s t -t 10 -g &quot;left join&quot; /war/lib/mysql/localhost-slow.log</span><br></pre></td></tr></table></figure>

<p><strong>å¦å¤–å»ºè®®åœ¨ä½¿ç”¨è¿™äº›å‘½ä»¤æ—¶ç»“åˆ|å’Œmore ä½¿ç”¨ï¼Œå¦åˆ™æœ‰å¯èƒ½å‡ºç°çˆ†å±æƒ…å†µ</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">mysqldumpslow -s r -t 10 /var/ib/mysql/localhost-slow.log | more</span><br></pre></td></tr></table></figure>

<h2 id="æ‰¹é‡æ•°æ®è„šæœ¬"><a href="#æ‰¹é‡æ•°æ®è„šæœ¬" class="headerlink" title="æ‰¹é‡æ•°æ®è„šæœ¬"></a>æ‰¹é‡æ•°æ®è„šæœ¬</h2><h3 id="å‡†å¤‡æ•°æ®"><a href="#å‡†å¤‡æ•°æ®" class="headerlink" title="å‡†å¤‡æ•°æ®"></a>å‡†å¤‡æ•°æ®</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">create table dept(</span><br><span class="line">id int unsigned primary key auto_increment,</span><br><span class="line">deptno mediumint unsigned not null default 0,</span><br><span class="line">dname varchar(20) not null default &#x27;&#x27;,</span><br><span class="line">loc varchar(13) not null default &#x27;&#x27;</span><br><span class="line">) engine=innodb default charset=utf8;</span><br><span class="line"></span><br><span class="line">create table emp(</span><br><span class="line">id int unsigned primary key auto_increment,</span><br><span class="line">empno int,</span><br><span class="line">ename varchar(20),</span><br><span class="line">job varchar(20),</span><br><span class="line">mgr varchar(20),</span><br><span class="line">hiredate date,</span><br><span class="line">sal double,</span><br><span class="line">comm double,</span><br><span class="line">deptno varchar(20))</span><br><span class="line">engine=innodb default charset=utf8;</span><br></pre></td></tr></table></figure>

<h3 id="è®¾ç½®å‚æ•°-log-bin-trust-function-creators"><a href="#è®¾ç½®å‚æ•°-log-bin-trust-function-creators" class="headerlink" title="è®¾ç½®å‚æ•° log_bin_trust_function_creators"></a>è®¾ç½®å‚æ•° log_bin_trust_function_creators</h3><p>åˆ›å»ºå‡½æ•°ï¼Œå‡å¦‚æŠ¥é”™: This function has none of DETERMINISâ€¦â€¦</p>
<p>ç”±äºå¼€å¯è¿‡æ…¢æŸ¥è¯¢æ—¥å¿—ï¼Œå› ä¸ºæˆ‘ä»¬å¼€å¯äº†bin-log, æˆ‘ä»¬å°±å¿…é¡»ä¸ºæˆ‘ä»¬çš„functionæŒ‡å®šä¸€ä¸ªå‚æ•°ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">show variables like &quot;log_bin_trust_function_creators&#x27;;</span><br><span class="line"></span><br><span class="line">set global log_bin_trust_function_creators=1;</span><br></pre></td></tr></table></figure>

<p>#è¿™æ ·æ·»åŠ äº†å‚æ•°ä»¥åï¼Œå¦‚æœmysqldé‡å¯ï¼Œä¸Šè¿°å‚æ•°åˆä¼šæ¶ˆå¤±ï¼Œæ°¸ä¹…æ–¹æ³•:</p>
<p>windowsä¸‹ï¼šmy.ini[mysqld] åŠ ä¸Š log_bin_trust_function_creators&#x3D;1</p>
<p>linuxä¸‹ ï¼š&#x2F;etc&#x2F;my.cnf ä¸‹ my.cnf[mysqld] åŠ ä¸Š log_bin_trust_function_creators&#x3D;1</p>
<h3 id="åˆ›å»ºå‡½æ•°"><a href="#åˆ›å»ºå‡½æ•°" class="headerlink" title="åˆ›å»ºå‡½æ•°"></a>åˆ›å»ºå‡½æ•°</h3><h4 id="éšæœºäº§ç”Ÿå­—ç¬¦ä¸²"><a href="#éšæœºäº§ç”Ÿå­—ç¬¦ä¸²" class="headerlink" title="éšæœºäº§ç”Ÿå­—ç¬¦ä¸²"></a>éšæœºäº§ç”Ÿå­—ç¬¦ä¸²</h4><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">DELIMITER $$</span><br><span class="line">CREATE FUNCTION rand_string(n INT) RETURNS VARCHAR(255)</span><br><span class="line">BEGIN</span><br><span class="line">DECLARE chars_str VARCHAR(100) DEFAULT &#x27;abcdefghijklmnopqrstuvwxyzABCDEFJHIJKLMNOPQRSTUVWXYZ&#x27;;</span><br><span class="line">DECLARE return_str VARCHAR(255) DEFAULT &#x27;&#x27;;</span><br><span class="line">DECLARE i INT DEFAULT 0;</span><br><span class="line">WHILE i&lt;n DO </span><br><span class="line">SET return_str =CONCAT(return_str,SUBSTRING(chars_str,FLOOR(1+RAND()*52),1));</span><br><span class="line">SET i=i+ 1;</span><br><span class="line">END WHILE;</span><br><span class="line">RETURN return_str;</span><br><span class="line">END $$</span><br></pre></td></tr></table></figure>

<h4 id="éšæœºäº§ç”Ÿéƒ¨é—¨ç¼–å·"><a href="#éšæœºäº§ç”Ÿéƒ¨é—¨ç¼–å·" class="headerlink" title="éšæœºäº§ç”Ÿéƒ¨é—¨ç¼–å·"></a>éšæœºäº§ç”Ÿéƒ¨é—¨ç¼–å·</h4><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">DELIMITER $$</span><br><span class="line">CREATE FUNCTION rand_num( )</span><br><span class="line">RETURNS INT(5)</span><br><span class="line">BEGIN</span><br><span class="line">DECLARE i INT DEFAULT 0;</span><br><span class="line">SET i= FLOOR(100+RAND()*10); </span><br><span class="line">RETURN i;</span><br><span class="line">END $$</span><br></pre></td></tr></table></figure>

<p>åˆ é™¤å‡½æ•°ï¼šdrop function rand_string;</p>
<h3 id="åˆ›å»ºå­˜å‚¨è¿‡ç¨‹"><a href="#åˆ›å»ºå­˜å‚¨è¿‡ç¨‹" class="headerlink" title="åˆ›å»ºå­˜å‚¨è¿‡ç¨‹"></a>åˆ›å»ºå­˜å‚¨è¿‡ç¨‹</h3><h4 id="å¾€empè¡¨ä¸­æ’å…¥æ•°æ®çš„å­˜å‚¨è¿‡ç¨‹"><a href="#å¾€empè¡¨ä¸­æ’å…¥æ•°æ®çš„å­˜å‚¨è¿‡ç¨‹" class="headerlink" title="å¾€empè¡¨ä¸­æ’å…¥æ•°æ®çš„å­˜å‚¨è¿‡ç¨‹"></a>å¾€empè¡¨ä¸­æ’å…¥æ•°æ®çš„å­˜å‚¨è¿‡ç¨‹</h4><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">DELIMITER $$</span><br><span class="line">CREATE PROCEDURE insert_emp(IN START INT(10),IN max_num INT(10))</span><br><span class="line">BEGIN</span><br><span class="line">DECLARE i INT DEFAULT 0; </span><br><span class="line">#set autocommit =0æŠŠautocommitè®¾ç½®æˆ0,ä¸éœ€è¦æäº¤å¤šæ¬¡</span><br><span class="line">SET autocommit = 0;</span><br><span class="line">REPEAT</span><br><span class="line">SET i=i + 1;</span><br><span class="line">INSERT INTO emp (empno, ename,job ,mgr ,hiredate ,sal ,comm ,deptno ) VALUES ((START+i)</span><br><span class="line">,rand_string(6),&#x27;SALESMAN&#x27; ,0001 ,CURDATE(),2000,400,rand_num());</span><br><span class="line">UNTIL i= max_num</span><br><span class="line">END REPEAT;</span><br><span class="line">COMMIT;</span><br><span class="line">END $$</span><br></pre></td></tr></table></figure>

<h4 id="å¾€deptè¡¨ä¸­æ’å…¥æ•°æ®çš„å­˜å‚¨è¿‡ç¨‹"><a href="#å¾€deptè¡¨ä¸­æ’å…¥æ•°æ®çš„å­˜å‚¨è¿‡ç¨‹" class="headerlink" title="å¾€deptè¡¨ä¸­æ’å…¥æ•°æ®çš„å­˜å‚¨è¿‡ç¨‹"></a>å¾€deptè¡¨ä¸­æ’å…¥æ•°æ®çš„å­˜å‚¨è¿‡ç¨‹</h4><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">drop procedure insert_dept;</span><br><span class="line">DELIMITER $$</span><br><span class="line">CREATE PROCEDURE insert_dept(IN START INT(10),IN max_num INT(10))</span><br><span class="line">BEGIN</span><br><span class="line">DECLARE i INT DEFAULT 0;</span><br><span class="line">SET autocommit = 0;</span><br><span class="line">REPEAT</span><br><span class="line">SET i=i+1;</span><br><span class="line">INSERT INTO dept (deptno,dname,loc) VALUES ((START+i),rand_string(10),rand_string(8)) ;</span><br><span class="line">UNTIL i = max_num</span><br><span class="line">END REPEAT ;</span><br><span class="line">COMMIT;</span><br><span class="line">END $$</span><br></pre></td></tr></table></figure>

<h3 id="è°ƒç”¨å­˜å‚¨è¿‡ç¨‹"><a href="#è°ƒç”¨å­˜å‚¨è¿‡ç¨‹" class="headerlink" title="è°ƒç”¨å­˜å‚¨è¿‡ç¨‹"></a>è°ƒç”¨å­˜å‚¨è¿‡ç¨‹</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">DELIMITER ;</span><br><span class="line">CALL insert_dept(100,10);</span><br><span class="line">#æ‰§è¡Œå­˜å‚¨è¿‡ç¨‹ï¼Œå¾€empè¡¨æ·»åŠ 50ä¸‡æ¡æ•°æ®</span><br><span class="line">DELIMITER ;</span><br><span class="line">CALL insert_emp(10001,500000);</span><br></pre></td></tr></table></figure>

<h2 id="Show-Profile"><a href="#Show-Profile" class="headerlink" title="Show Profile"></a>Show Profile</h2><p>å®šä¹‰ï¼šæ˜¯mysqlæä¾›å¯ä»¥ç”¨æ¥åˆ†æ<strong>å½“å‰ä¼šè¯ä¸­è¯­å¥æ‰§è¡Œçš„èµ„æºæ¶ˆè€—æƒ…å†µ</strong>ï¼Œå¯ä»¥ç”¨äºSQLçš„è°ƒä¼˜çš„æµ‹é‡ã€‚</p>
<p>å®˜ç½‘ï¼šhtp:&#x2F;&#x2F;dev.mysql.com&#x2F;doc&#x2F;refman&#x2F;5.5&#x2F;en&#x2F;show-profile.htmlã€‚</p>
<p>é»˜è®¤æƒ…å†µä¸‹ï¼Œå‚æ•°å¤„äºå…³é—­çŠ¶æ€ï¼Œå¹¶ä¿å­˜æœ€è¿‘15æ¬¡çš„è¿è¡Œç»“æœã€‚</p>
<p><strong>åˆ†ææ­¥éª¤</strong></p>
<p>æŸ¥çœ‹å½“å‰çš„mysqlç‰ˆæœ¬æ˜¯å¦æ”¯æŒã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">show variables like &quot;profiling%&quot;;</span><br></pre></td></tr></table></figure>

<p><strong>é»˜è®¤å…³é—­ï¼Œä½¿ç”¨å‰å¼€å¯ã€‚</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">mysql&gt; show variables like &quot;profiling%&quot;;</span><br><span class="line">+------------------------+-------+</span><br><span class="line">| Variable_name          | Value |</span><br><span class="line">+------------------------+-------+</span><br><span class="line">| profiling              | OFF   |</span><br><span class="line">| profiling_history_size | 15    |</span><br><span class="line">+------------------------+-------+</span><br><span class="line">2 rows in set (0.02 sec)</span><br><span class="line">-- ä½¿ç”¨set profiling=onå¼€å¯</span><br><span class="line">mysql&gt; set profiling=on;</span><br><span class="line">Query OK, 0 rows affected, 1 warning (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; show variables like &quot;profiling%&quot;;</span><br><span class="line">+------------------------+-------+</span><br><span class="line">| Variable_name          | Value |</span><br><span class="line">+------------------------+-------+</span><br><span class="line">| profiling              | ON    |</span><br><span class="line">| profiling_history_size | 15    |</span><br><span class="line">+------------------------+-------+</span><br><span class="line">2 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>

<p>è¿è¡ŒSQLã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">select * from emp group by id%10 limit 150000;</span><br><span class="line"></span><br><span class="line">select * from emp group by id%20 order by 5;</span><br></pre></td></tr></table></figure>

<p>æŸ¥çœ‹ç»“æœï¼Œ<strong>show profiles;</strong></p>
<p>åˆ†ææ­¥éª¤</p>
<p>è¯Šæ–­SQLï¼Œshow profile cpu,block io for query [id]ã€‚ä¸Šä¸€æ­¥å‰é¢çš„é—®é¢˜SQLæ•°å­—å·ç ã€‚</p>
<p>å‚æ•°å¤‡æ³¨ï¼š</p>
<table>
<thead>
<tr>
<th><strong>ALL</strong></th>
<th><strong>æ˜¾ç¤ºæ‰€æœ‰çš„å¼€é”€ä¿¡æ¯</strong></th>
</tr>
</thead>
<tbody><tr>
<td><strong>BLOCK IO</strong></td>
<td>æ˜¾ç¤ºå—IOç›¸å…³å¼€é”€</td>
</tr>
<tr>
<td><strong>CONTEXT SWITCHES</strong></td>
<td>ä¸Šä¸‹æ–‡åˆ‡æ¢ç›¸å…³å¼€é”€</td>
</tr>
<tr>
<td><strong>CPU</strong></td>
<td>æ˜¾ç¤ºCPUç›¸å…³å¼€é”€ä¿¡æ¯</td>
</tr>
<tr>
<td><strong>IPC</strong></td>
<td>æ˜¾ç¤ºå‘é€å’Œæ¥æ”¶ç›¸å…³å¼€é”€ä¿¡æ¯</td>
</tr>
<tr>
<td><strong>MEMORY</strong></td>
<td>æ˜¾ç¤ºå†…å­˜ç›¸å…³å¼€é”€ä¿¡æ¯</td>
</tr>
<tr>
<td><strong>PAGE FAULTS</strong></td>
<td>æ˜¾ç¤ºé¡µé¢é”™è¯¯ç›¸å…³å¼€é”€ä¿¡æ¯</td>
</tr>
<tr>
<td><strong>SOURCE</strong></td>
<td>æ˜¾ç¤ºå’ŒSource_function, Source_fileï¼ŒSource_lineç›¸å…³çš„å¼€é”€ä¿¡æ¯</td>
</tr>
<tr>
<td><strong>SWAPS</strong></td>
<td>æ˜¾ç¤ºäº¤æ¢æ¬¡æ•°ç›¸å…³å¼€é”€çš„ä¿¡æ¯</td>
</tr>
</tbody></table>
<p>æ—¥å¸¸å¼€å‘éœ€è¦æ³¨æ„çš„ç»“è®ºï¼š</p>
<ol>
<li><p>converting HEAP to MyISAM   æŸ¥è¯¢ç»“æœå¤ªå¤§ï¼Œå†…å­˜éƒ½ä¸å¤Ÿç”¨äº†å¾€ç£ç›˜ä¸Šæ¬äº†ã€‚</p>
</li>
<li><p>Creating tmp table          åˆ›å»ºä¸´æ—¶è¡¨ï¼Œæ‹·è´æ•°æ®åˆ°ä¸´æ—¶è¡¨ï¼Œç”¨å®Œå†åˆ é™¤ã€‚</p>
</li>
<li><p>Copying to tmp table on disk   æŠŠå†…å­˜ä¸­ä¸´æ—¶è¡¨å¤åˆ¶åˆ°ç£ç›˜ï¼Œå±é™©!</p>
</li>
<li><p>locked</p>
</li>
</ol>
<h2 id="å…¨å±€æŸ¥è¯¢æ—¥å¿—"><a href="#å…¨å±€æŸ¥è¯¢æ—¥å¿—" class="headerlink" title="å…¨å±€æŸ¥è¯¢æ—¥å¿—"></a>å…¨å±€æŸ¥è¯¢æ—¥å¿—</h2><p><strong>æ°¸è¿œä¸è¦åœ¨ç”Ÿäº§ç¯å¢ƒå¼€å¯è¿™ä¸ªåŠŸèƒ½ã€‚</strong></p>
<p>é…ç½®å¯ç”¨ç¼–ç å¯ç”¨</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">set global general_log=1;</span><br><span class="line"></span><br><span class="line">set global log_output=&#x27;TABLE&#x27;;</span><br></pre></td></tr></table></figure>



<p>æ­¤åï¼Œä½ æ‰€ç¼–å†™çš„sqlè¯­å¥ï¼Œå°†ä¼šè®°å½•åˆ°mysq|åº“é‡Œçš„general logè¡¨ï¼Œå¯ä»¥ç”¨ä¸‹é¢çš„å‘½ä»¤æŸ¥çœ‹ï¼š</p>
<p>select * from mysql.general log;</p>
]]></content>
  </entry>
  <entry>
    <title>MybatisPlus</title>
    <url>/2023/02/28/MybatisPlus/</url>
    <content><![CDATA[<h1 id><a href="#" class="headerlink" title></a></h1><h1 id="MybatisPlus"><a href="#MybatisPlus" class="headerlink" title="MybatisPlus"></a>MybatisPlus</h1><p><strong>ã€æ–‡æ¡£ã€‘</strong><a href="https://baomidou.com/">https://baomidou.com/</a></p>
<p><strong>ã€å»ºè®®é˜…è¯»å®˜æ–¹æ–‡æ¡£å­¦ä¹  MybatisPlusã€‘</strong></p>
<h1 id="ä¸€ã€å¿«é€Ÿå…¥é—¨"><a href="#ä¸€ã€å¿«é€Ÿå…¥é—¨" class="headerlink" title="ä¸€ã€å¿«é€Ÿå…¥é—¨"></a>ä¸€ã€å¿«é€Ÿå…¥é—¨</h1><h2 id="1-1-ç®€ä»‹"><a href="#1-1-ç®€ä»‹" class="headerlink" title="1.1 ç®€ä»‹"></a>1.1 ç®€ä»‹</h2><p><a href="https://github.com/baomidou/mybatis-plus">MyBatis-Plus (opens new window)</a>ï¼ˆç®€ç§° MPï¼‰æ˜¯ä¸€ä¸ª <a href="https://www.mybatis.org/mybatis-3/">MyBatis (opens new window)</a>çš„å¢å¼ºå·¥å…·ï¼Œåœ¨ MyBatis çš„åŸºç¡€ä¸Šåªåšå¢å¼ºä¸åšæ”¹å˜ï¼Œä¸ºç®€åŒ–å¼€å‘ã€æé«˜æ•ˆç‡è€Œç”Ÿã€‚</p>
<h3 id="1-1-1-ç‰¹æ€§"><a href="#1-1-1-ç‰¹æ€§" class="headerlink" title="1.1.1 ç‰¹æ€§"></a>1.1.1 ç‰¹æ€§</h3><ul>
<li><strong>æ— ä¾µå…¥</strong>ï¼šåªåšå¢å¼ºä¸åšæ”¹å˜ï¼Œå¼•å…¥å®ƒä¸ä¼šå¯¹ç°æœ‰å·¥ç¨‹äº§ç”Ÿå½±å“ï¼Œå¦‚ä¸èˆ¬é¡ºæ»‘</li>
<li><strong>æŸè€—å°</strong>ï¼šå¯åŠ¨å³ä¼šè‡ªåŠ¨æ³¨å…¥åŸºæœ¬ CURDï¼Œæ€§èƒ½åŸºæœ¬æ— æŸè€—ï¼Œç›´æ¥é¢å‘å¯¹è±¡æ“ä½œ</li>
<li><strong>å¼ºå¤§çš„ CRUD æ“ä½œ</strong>ï¼šå†…ç½®é€šç”¨ Mapperã€é€šç”¨ Serviceï¼Œä»…ä»…é€šè¿‡å°‘é‡é…ç½®å³å¯å®ç°å•è¡¨å¤§éƒ¨åˆ† CRUD æ“ä½œï¼Œæ›´æœ‰å¼ºå¤§çš„æ¡ä»¶æ„é€ å™¨ï¼Œæ»¡è¶³å„ç±»ä½¿ç”¨éœ€æ±‚</li>
<li><strong>æ”¯æŒ Lambda å½¢å¼è°ƒç”¨</strong>ï¼šé€šè¿‡ Lambda è¡¨è¾¾å¼ï¼Œæ–¹ä¾¿çš„ç¼–å†™å„ç±»æŸ¥è¯¢æ¡ä»¶ï¼Œæ— éœ€å†æ‹…å¿ƒå­—æ®µå†™é”™</li>
<li><strong>æ”¯æŒä¸»é”®è‡ªåŠ¨ç”Ÿæˆ</strong>ï¼šæ”¯æŒå¤šè¾¾ 4 ç§ä¸»é”®ç­–ç•¥ï¼ˆå†…å«åˆ†å¸ƒå¼å”¯ä¸€ ID ç”Ÿæˆå™¨ - Sequenceï¼‰ï¼Œå¯è‡ªç”±é…ç½®ï¼Œå®Œç¾è§£å†³ä¸»é”®é—®é¢˜</li>
<li><strong>æ”¯æŒ ActiveRecord æ¨¡å¼</strong>ï¼šæ”¯æŒ ActiveRecord å½¢å¼è°ƒç”¨ï¼Œå®ä½“ç±»åªéœ€ç»§æ‰¿ Model ç±»å³å¯è¿›è¡Œå¼ºå¤§çš„ CRUD æ“ä½œ</li>
<li><strong>æ”¯æŒè‡ªå®šä¹‰å…¨å±€é€šç”¨æ“ä½œ</strong>ï¼šæ”¯æŒå…¨å±€é€šç”¨æ–¹æ³•æ³¨å…¥ï¼ˆ Write once, use anywhere ï¼‰</li>
<li><strong>å†…ç½®ä»£ç ç”Ÿæˆå™¨</strong>ï¼šé‡‡ç”¨ä»£ç æˆ–è€… Maven æ’ä»¶å¯å¿«é€Ÿç”Ÿæˆ Mapper ã€ Model ã€ Service ã€ Controller å±‚ä»£ç ï¼Œæ”¯æŒæ¨¡æ¿å¼•æ“ï¼Œæ›´æœ‰è¶…å¤šè‡ªå®šä¹‰é…ç½®ç­‰æ‚¨æ¥ä½¿ç”¨</li>
<li><strong>å†…ç½®åˆ†é¡µæ’ä»¶</strong>ï¼šåŸºäº MyBatis ç‰©ç†åˆ†é¡µï¼Œå¼€å‘è€…æ— éœ€å…³å¿ƒå…·ä½“æ“ä½œï¼Œé…ç½®å¥½æ’ä»¶ä¹‹åï¼Œå†™åˆ†é¡µç­‰åŒäºæ™®é€š List æŸ¥è¯¢</li>
<li><strong>åˆ†é¡µæ’ä»¶æ”¯æŒå¤šç§æ•°æ®åº“</strong>ï¼šæ”¯æŒ MySQLã€MariaDBã€Oracleã€DB2ã€H2ã€HSQLã€SQLiteã€Postgreã€SQLServer ç­‰å¤šç§æ•°æ®åº“</li>
<li><strong>å†…ç½®æ€§èƒ½åˆ†ææ’ä»¶</strong>ï¼šå¯è¾“å‡º SQL è¯­å¥ä»¥åŠå…¶æ‰§è¡Œæ—¶é—´ï¼Œå»ºè®®å¼€å‘æµ‹è¯•æ—¶å¯ç”¨è¯¥åŠŸèƒ½ï¼Œèƒ½å¿«é€Ÿæªå‡ºæ…¢æŸ¥è¯¢</li>
<li><strong>å†…ç½®å…¨å±€æ‹¦æˆªæ’ä»¶</strong>ï¼šæä¾›å…¨è¡¨ delete ã€ update æ“ä½œæ™ºèƒ½åˆ†æé˜»æ–­ï¼Œä¹Ÿå¯è‡ªå®šä¹‰æ‹¦æˆªè§„åˆ™ï¼Œé¢„é˜²è¯¯æ“ä½œ</li>
</ul>
<h3 id="1-1-2-æ¡†æ¶ç»“æ„"><a href="#1-1-2-æ¡†æ¶ç»“æ„" class="headerlink" title="1.1.2 æ¡†æ¶ç»“æ„"></a>1.1.2 æ¡†æ¶ç»“æ„</h3><img src="images/MybatisPlusæ¡†æ¶ç»“æ„.png" alt="MybatisPlusæ¡†æ¶ç»“æ„" style="zoom:60%;">

<h2 id="1-2-å¿«é€Ÿå¼€å§‹"><a href="#1-2-å¿«é€Ÿå¼€å§‹" class="headerlink" title="1.2 å¿«é€Ÿå¼€å§‹"></a>1.2 å¿«é€Ÿå¼€å§‹</h2><h3 id="1-2-1-æ•°æ®åº“è„šæœ¬"><a href="#1-2-1-æ•°æ®åº“è„šæœ¬" class="headerlink" title="1.2.1 æ•°æ®åº“è„šæœ¬"></a>1.2.1 æ•°æ®åº“è„šæœ¬</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> IF <span class="keyword">EXISTS</span> <span class="keyword">user</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="keyword">user</span></span><br><span class="line">(</span><br><span class="line">    id <span class="type">BIGINT</span>(<span class="number">20</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;ä¸»é”®ID&#x27;</span>,</span><br><span class="line">    name <span class="type">VARCHAR</span>(<span class="number">30</span>) <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;å§“å&#x27;</span>,</span><br><span class="line">    age <span class="type">INT</span>(<span class="number">11</span>) <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;å¹´é¾„&#x27;</span>,</span><br><span class="line">    email <span class="type">VARCHAR</span>(<span class="number">50</span>) <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;é‚®ç®±&#x27;</span>,</span><br><span class="line">    <span class="keyword">PRIMARY</span> KEY (id)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">DELETE</span> <span class="keyword">FROM</span> <span class="keyword">user</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> <span class="keyword">user</span> (id, name, age, email) <span class="keyword">VALUES</span></span><br><span class="line">(<span class="number">1</span>, <span class="string">&#x27;Jone&#x27;</span>, <span class="number">18</span>, <span class="string">&#x27;test1@baomidou.com&#x27;</span>),</span><br><span class="line">(<span class="number">2</span>, <span class="string">&#x27;Jack&#x27;</span>, <span class="number">20</span>, <span class="string">&#x27;test2@baomidou.com&#x27;</span>),</span><br><span class="line">(<span class="number">3</span>, <span class="string">&#x27;Tom&#x27;</span>, <span class="number">28</span>, <span class="string">&#x27;test3@baomidou.com&#x27;</span>),</span><br><span class="line">(<span class="number">4</span>, <span class="string">&#x27;Sandy&#x27;</span>, <span class="number">21</span>, <span class="string">&#x27;test4@baomidou.com&#x27;</span>),</span><br><span class="line">(<span class="number">5</span>, <span class="string">&#x27;Billie&#x27;</span>, <span class="number">24</span>, <span class="string">&#x27;test5@baomidou.com&#x27;</span>);</span><br></pre></td></tr></table></figure>

<p><code>user</code>è¡¨ç»“æ„å¦‚ä¸‹ï¼š</p>
<table>
<thead>
<tr>
<th>id</th>
<th>name</th>
<th>age</th>
<th>email</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td>Jone</td>
<td>18</td>
<td><a href="mailto:&#116;&#101;&#115;&#x74;&#x31;&#64;&#x62;&#97;&#x6f;&#x6d;&#x69;&#100;&#111;&#117;&#46;&#99;&#111;&#x6d;">&#116;&#101;&#115;&#x74;&#x31;&#64;&#x62;&#97;&#x6f;&#x6d;&#x69;&#100;&#111;&#117;&#46;&#99;&#111;&#x6d;</a></td>
</tr>
<tr>
<td>2</td>
<td>Jack</td>
<td>20</td>
<td><a href="mailto:&#116;&#101;&#x73;&#x74;&#50;&#64;&#x62;&#97;&#x6f;&#109;&#105;&#100;&#111;&#x75;&#46;&#99;&#111;&#109;">&#116;&#101;&#x73;&#x74;&#50;&#64;&#x62;&#97;&#x6f;&#109;&#105;&#100;&#111;&#x75;&#46;&#99;&#111;&#109;</a></td>
</tr>
<tr>
<td>3</td>
<td>Tom</td>
<td>28</td>
<td><a href="mailto:&#116;&#x65;&#115;&#116;&#x33;&#x40;&#98;&#97;&#x6f;&#109;&#x69;&#100;&#x6f;&#x75;&#46;&#99;&#111;&#109;">&#116;&#x65;&#115;&#116;&#x33;&#x40;&#98;&#97;&#x6f;&#109;&#x69;&#100;&#x6f;&#x75;&#46;&#99;&#111;&#109;</a></td>
</tr>
<tr>
<td>4</td>
<td>Sandy</td>
<td>21</td>
<td><a href="mailto:&#x74;&#x65;&#115;&#x74;&#52;&#64;&#98;&#x61;&#x6f;&#109;&#105;&#100;&#x6f;&#x75;&#x2e;&#99;&#x6f;&#x6d;">&#x74;&#x65;&#115;&#x74;&#52;&#64;&#98;&#x61;&#x6f;&#109;&#105;&#100;&#x6f;&#x75;&#x2e;&#99;&#x6f;&#x6d;</a></td>
</tr>
<tr>
<td>5</td>
<td>Billie</td>
<td>24</td>
<td><a href="mailto:&#116;&#101;&#x73;&#x74;&#x35;&#x40;&#98;&#97;&#111;&#109;&#105;&#100;&#111;&#x75;&#x2e;&#99;&#111;&#x6d;">&#116;&#101;&#x73;&#x74;&#x35;&#x40;&#98;&#97;&#111;&#109;&#105;&#100;&#111;&#x75;&#x2e;&#99;&#111;&#x6d;</a></td>
</tr>
</tbody></table>
<h3 id="1-2-2-åˆå§‹åŒ–å·¥ç¨‹"><a href="#1-2-2-åˆå§‹åŒ–å·¥ç¨‹" class="headerlink" title="1.2.2 åˆå§‹åŒ–å·¥ç¨‹"></a>1.2.2 åˆå§‹åŒ–å·¥ç¨‹</h3><p>â€‹		ä½¿ç”¨ <a href="https://start.spring.io/">Spring Initializer (opens new window) </a> åˆ›å»ºå·¥ç¨‹ï¼šMybatisPlus-Sample</p>
<h3 id="1-2-3-æ·»åŠ ä¾èµ–"><a href="#1-2-3-æ·»åŠ ä¾èµ–" class="headerlink" title="1.2.3 æ·»åŠ ä¾èµ–"></a>1.2.3 æ·»åŠ ä¾èµ–</h3><p>ç‰ˆæœ¬æŸ¥è¯¢ï¼š<a href="https://mvnrepository.com/">https://mvnrepository.com/</a></p>
<p>parent ä¾èµ–ç¤ºä¾‹ï¼š</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-parent<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.7.8<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">relativePath</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--MybatisPlusä¾èµ–--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.baomidou<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-plus-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.5.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>8.0.20<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">exclusions</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.junit.vintage<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit-vintage-engine<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">exclusions</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure>



<h3 id="1-2-4-é…ç½®"><a href="#1-2-4-é…ç½®" class="headerlink" title="1.2.4 é…ç½®"></a>1.2.4 é…ç½®</h3><p>mysql8+ æ•°æ®åº“è¿æ¥é…ç½®ï¼šã€æ·»åŠ æ—¶åŒºï¼šGMT+8ã€‘</p>
<figure class="highlight properties"><table><tr><td class="code"><pre><span class="line"><span class="comment">#mysql8+æ•°æ®åº“è¿æ¥</span></span><br><span class="line"><span class="attr">spring.datasource.driver-class-name</span>=<span class="string">com.mysql.cj.jdbc.Driver</span></span><br><span class="line"><span class="attr">spring.datasource.url</span>=<span class="string">jdbc:mysql://localhost:3306/mybatis_plus?serverTimezone=GMT%2B8&amp;characterEncoding=utf-8</span></span><br><span class="line"><span class="attr">spring.datasource.username</span>=<span class="string">root</span></span><br><span class="line"><span class="attr">spring.datasource.password</span>=<span class="string">root</span></span><br></pre></td></tr></table></figure>

<p>mysql5 æ•°æ®åº“è¿æ¥é…ç½®ï¼š</p>
<figure class="highlight properties"><table><tr><td class="code"><pre><span class="line"><span class="comment">#mysql5æ•°æ®åº“è¿æ¥</span></span><br><span class="line"><span class="attr">spring.datasource.driver-class-name</span>=<span class="string">com.mysql.jdbc.Driver</span></span><br><span class="line"><span class="attr">spring.datasource.url</span>=<span class="string">jdbc:mysql://localhost:3306/mybatis_plus?characterEncoding=utf-8&amp;useSSL=true</span></span><br><span class="line"><span class="attr">spring.datasource.username</span>=<span class="string">root</span></span><br><span class="line"><span class="attr">spring.datasource.password</span>=<span class="string">root</span></span><br></pre></td></tr></table></figure>

<p>MybatisPlusSampleApplication é…ç½®ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@MapperScan(&quot;com.example.mybatisplus.mapper&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MybatisPlusSampleApplication</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        SpringApplication.run(MybatisPlusSampleApplication.class, args);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="1-2-5-ç¼–ç "><a href="#1-2-5-ç¼–ç " class="headerlink" title="1.2.5 ç¼–ç "></a>1.2.5 ç¼–ç </h3><p>åˆ›å»ºå®ä½“  <code>User</code>ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.mybatisplus.entity;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> Integer age;</span><br><span class="line">    <span class="keyword">private</span> String email;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="1-2-6-æµ‹è¯•"><a href="#1-2-6-æµ‹è¯•" class="headerlink" title="1.2.6 æµ‹è¯•"></a>1.2.6 æµ‹è¯•</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.mybatisplus;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.example.mybatisplus.entity.User;</span><br><span class="line"><span class="keyword">import</span> com.example.mybatisplus.mapper.UserMapper;</span><br><span class="line"><span class="keyword">import</span> org.junit.jupiter.api.Test;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.test.context.SpringBootTest;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.annotation.Resource;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">QuickStartSampleTest</span> &#123;</span><br><span class="line">    <span class="comment">// ä½¿ç”¨@AutowiredæŠ¥çº¢ï¼Œè§£å†³æ–¹æ¡ˆï¼šä½¿ç”¨@Resourceæ³¨è§£ï¼Œæˆ–è€…UserMapperæ·»åŠ @Repositoryã€@Mapperç­‰</span></span><br><span class="line">    <span class="comment">// @Autowired</span></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> UserMapper userMapper;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testSelectListNull</span><span class="params">()</span> &#123;</span><br><span class="line">        List&lt;User&gt; userList = userMapper.selectList(<span class="literal">null</span>);</span><br><span class="line">        userList.forEach(System.out::println);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ§åˆ¶å°è¾“å‡ºç»“æœï¼š</p>
<blockquote>
<p>User(id&#x3D;1, name&#x3D;Jone, age&#x3D;18, email&#x3D;<a href="mailto:&#116;&#x65;&#115;&#116;&#x31;&#64;&#98;&#97;&#x6f;&#109;&#x69;&#x64;&#x6f;&#117;&#46;&#x63;&#111;&#x6d;">&#116;&#x65;&#115;&#116;&#x31;&#64;&#98;&#97;&#x6f;&#109;&#x69;&#x64;&#x6f;&#117;&#46;&#x63;&#111;&#x6d;</a>)<br>User(id&#x3D;2, name&#x3D;Jack, age&#x3D;20, email&#x3D;<a href="mailto:&#116;&#101;&#x73;&#x74;&#x32;&#x40;&#98;&#x61;&#x6f;&#x6d;&#x69;&#100;&#111;&#117;&#x2e;&#99;&#x6f;&#x6d;">&#116;&#101;&#x73;&#x74;&#x32;&#x40;&#98;&#x61;&#x6f;&#x6d;&#x69;&#100;&#111;&#117;&#x2e;&#99;&#x6f;&#x6d;</a>)<br>User(id&#x3D;3, name&#x3D;Tom, age&#x3D;28, email&#x3D;<a href="mailto:&#116;&#x65;&#115;&#116;&#51;&#64;&#x62;&#x61;&#111;&#109;&#105;&#100;&#x6f;&#x75;&#x2e;&#x63;&#111;&#109;">&#116;&#x65;&#115;&#116;&#51;&#64;&#x62;&#x61;&#111;&#109;&#105;&#100;&#x6f;&#x75;&#x2e;&#x63;&#111;&#109;</a>)<br>User(id&#x3D;4, name&#x3D;Sandy, age&#x3D;21, email&#x3D;<a href="mailto:&#116;&#101;&#115;&#116;&#52;&#64;&#98;&#97;&#x6f;&#109;&#105;&#x64;&#x6f;&#x75;&#x2e;&#99;&#111;&#x6d;">&#116;&#101;&#115;&#116;&#52;&#64;&#98;&#97;&#x6f;&#109;&#105;&#x64;&#x6f;&#x75;&#x2e;&#99;&#111;&#x6d;</a>)<br>User(id&#x3D;5, name&#x3D;Billie, age&#x3D;24, email&#x3D;<a href="mailto:&#116;&#x65;&#115;&#116;&#x35;&#x40;&#98;&#97;&#111;&#109;&#x69;&#x64;&#x6f;&#117;&#x2e;&#x63;&#111;&#x6d;">&#116;&#x65;&#115;&#116;&#x35;&#x40;&#98;&#97;&#111;&#109;&#x69;&#x64;&#x6f;&#117;&#x2e;&#x63;&#111;&#x6d;</a>)</p>
</blockquote>
<h2 id="1-3-é…ç½®"><a href="#1-3-é…ç½®" class="headerlink" title="1.3 é…ç½®"></a>1.3 é…ç½®</h2><h3 id="1-3-1-SpringBootå·¥ç¨‹"><a href="#1-3-1-SpringBootå·¥ç¨‹" class="headerlink" title="1.3.1 SpringBootå·¥ç¨‹"></a>1.3.1 SpringBootå·¥ç¨‹</h3><p>æ·»åŠ  @MapperScan æ³¨è§£ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@MapperScan(&quot;com.baomidou.mybatisplus.samples.quickstart.mapper&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Application</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        SpringApplication.run(Application.class, args);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="1-3-2-Spring-å·¥ç¨‹"><a href="#1-3-2-Spring-å·¥ç¨‹" class="headerlink" title="1.3.2 Spring å·¥ç¨‹"></a>1.3.2 Spring å·¥ç¨‹</h3><p><strong>é…ç½® MapperScan</strong></p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;org.mybatis.spring.mapper.MapperScannerConfigurer&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;basePackage&quot;</span> <span class="attr">value</span>=<span class="string">&quot;com.baomidou.mybatisplus.samples.quickstart.mapper&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>è°ƒæ•´ SqlSessionFactory ä¸º MyBatis-Plus çš„ SqlSessionFactory</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;sqlSessionFactory&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.baomidou.mybatisplus.extension.spring.MybatisSqlSessionFactoryBean&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;dataSource&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;dataSource&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>é€šå¸¸æ¥è¯´ï¼Œä¸€èˆ¬çš„ç®€å•å·¥ç¨‹ï¼Œé€šè¿‡ä»¥ä¸Šé…ç½®å³å¯æ­£å¸¸ä½¿ç”¨ MyBatis-Plusï¼Œå…·ä½“å¯å‚è€ƒä»¥ä¸‹é¡¹ç›®ï¼š<a href="https://github.com/baomidou/mybatis-plus-samples/tree/master/mybatis-plus-sample-quickstart">Spring Boot å¿«é€Ÿå¯åŠ¨ç¤ºä¾‹ (opens new window)</a>ã€<a href="https://github.com/baomidou/mybatis-plus-samples/tree/master/mybatis-plus-sample-quickstart-springmvc">Spring MVC å¿«é€Ÿå¯åŠ¨ç¤ºä¾‹ (opens new window)</a>ã€‚</p>
<h2 id="1-4-æ³¨è§£"><a href="#1-4-æ³¨è§£" class="headerlink" title="1.4 æ³¨è§£"></a>1.4 æ³¨è§£</h2><h3 id="1-4-1-TableName"><a href="#1-4-1-TableName" class="headerlink" title="1.4.1 @TableName"></a>1.4.1 <a href="https://github.com/baomidou/mybatis-plus/blob/3.0/mybatis-plus-annotation/src/main/java/com/baomidou/mybatisplus/annotation/TableName.java">@TableName</a></h3><ul>
<li>æè¿°ï¼šè¡¨åæ³¨è§£ï¼Œæ ‡è¯†å®ä½“ç±»å¯¹åº”çš„è¡¨<strong>ã€åº”ç”¨äºæ•°æ®åº“è¡¨åå’Œå®ä½“åç§°ä¸ä¸€è‡´çš„æƒ…å†µã€‘</strong></li>
<li>ä½¿ç”¨ä½ç½®ï¼šå®ä½“ç±»</li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@TableName(&quot;sys_user&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> Integer age;</span><br><span class="line">    <span class="keyword">private</span> String email;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th align="left">å±æ€§</th>
<th align="left">ç±»å‹</th>
<th align="left">å¿…é¡»æŒ‡å®š</th>
<th align="left">é»˜è®¤å€¼</th>
<th align="left">æè¿°</th>
</tr>
</thead>
<tbody><tr>
<td align="left">value</td>
<td align="left">String</td>
<td align="left">å¦</td>
<td align="left">â€œâ€</td>
<td align="left">è¡¨å</td>
</tr>
<tr>
<td align="left">schema</td>
<td align="left">String</td>
<td align="left">å¦</td>
<td align="left">â€œâ€</td>
<td align="left">schema</td>
</tr>
<tr>
<td align="left">keepGlobalPrefix</td>
<td align="left">boolean</td>
<td align="left">å¦</td>
<td align="left">false</td>
<td align="left">æ˜¯å¦ä¿æŒä½¿ç”¨å…¨å±€çš„ tablePrefix çš„å€¼ï¼ˆå½“å…¨å±€ tablePrefix ç”Ÿæ•ˆæ—¶ï¼‰</td>
</tr>
<tr>
<td align="left">resultMap</td>
<td align="left">String</td>
<td align="left">å¦</td>
<td align="left">â€œâ€</td>
<td align="left">xml ä¸­ resultMap çš„ idï¼ˆç”¨äºæ»¡è¶³ç‰¹å®šç±»å‹çš„å®ä½“ç±»å¯¹è±¡ç»‘å®šï¼‰</td>
</tr>
<tr>
<td align="left">autoResultMap</td>
<td align="left">boolean</td>
<td align="left">å¦</td>
<td align="left">false</td>
<td align="left">æ˜¯å¦è‡ªåŠ¨æ„å»º resultMap å¹¶ä½¿ç”¨ï¼ˆå¦‚æœè®¾ç½® resultMap åˆ™ä¸ä¼šè¿›è¡Œ resultMap çš„è‡ªåŠ¨æ„å»ºä¸æ³¨å…¥ï¼‰</td>
</tr>
<tr>
<td align="left">excludeProperty</td>
<td align="left">String[]</td>
<td align="left">å¦</td>
<td align="left">{}</td>
<td align="left">éœ€è¦æ’é™¤çš„å±æ€§å @since 3.3.1</td>
</tr>
</tbody></table>
<p><strong>å…³äº <code>autoResultMap</code> çš„è¯´æ˜ï¼š</strong></p>
<p>MP ä¼šè‡ªåŠ¨æ„å»ºä¸€ä¸ª <code>resultMap</code> å¹¶æ³¨å…¥åˆ° MyBatis é‡Œï¼ˆä¸€èˆ¬ç”¨ä¸ä¸Šï¼‰ï¼Œè¯·æ³¨æ„ä»¥ä¸‹å†…å®¹ï¼š</p>
<p>å› ä¸º MP åº•å±‚æ˜¯ MyBatisï¼Œæ‰€ä»¥ MP åªæ˜¯å¸®æ‚¨æ³¨å…¥äº†å¸¸ç”¨ CRUD åˆ° MyBatis é‡Œï¼Œæ³¨å…¥ä¹‹å‰æ˜¯åŠ¨æ€çš„ï¼ˆæ ¹æ®æ‚¨çš„ Entity å­—æ®µä»¥åŠæ³¨è§£å˜åŒ–è€Œå˜åŒ–ï¼‰ï¼Œä½†æ˜¯æ³¨å…¥ä¹‹åæ˜¯é™æ€çš„ï¼ˆç­‰äº XML é…ç½®ä¸­çš„å†…å®¹ï¼‰ã€‚</p>
<p>è€Œå¯¹äº <code>typeHandler</code> å±æ€§ï¼ŒMyBatis åªæ”¯æŒå†™åœ¨ 2 ä¸ªåœ°æ–¹:</p>
<ol>
<li>å®šä¹‰åœ¨ resultMap é‡Œï¼Œä½œç”¨äºæŸ¥è¯¢ç»“æœçš„å°è£…</li>
<li>å®šä¹‰åœ¨ <code>insert</code> å’Œ <code>update</code> è¯­å¥çš„ <code>#&#123;property&#125;</code> ä¸­çš„ <code>property</code> åé¢ï¼ˆä¾‹ï¼š<code>#&#123;property,typehandler=xxx.xxx.xxx&#125;</code>ï¼‰ï¼Œå¹¶ä¸”åªä½œç”¨äºå½“å‰ <code>è®¾ç½®å€¼</code></li>
</ol>
<p>é™¤äº†ä»¥ä¸Šä¸¤ç§ç›´æ¥æŒ‡å®š <code>typeHandler</code> çš„å½¢å¼ï¼ŒMyBatis æœ‰ä¸€ä¸ªå…¨å±€æ‰«æè‡ªå®šä¹‰ <code>typeHandler</code> åŒ…çš„é…ç½®ï¼ŒåŸç†æ˜¯æ ¹æ®æ‚¨çš„ <code>property</code> ç±»å‹å»æ‰¾å…¶å¯¹åº”çš„ <code>typeHandler</code> å¹¶ä½¿ç”¨ã€‚</p>
<h3 id="1-4-2-TableId"><a href="#1-4-2-TableId" class="headerlink" title="1.4.2 @TableId"></a>1.4.2 <a href="https://github.com/baomidou/mybatis-plus/blob/3.0/mybatis-plus-annotation/src/main/java/com/baomidou/mybatisplus/annotation/TableId.java">@TableId</a></h3><ul>
<li>æè¿°ï¼šä¸»é”®æ³¨è§£ <strong>ã€åº”ç”¨äºè¡¨å­—æ®µå’Œå®ä½“ç±»å±æ€§ä¸ä¸€è‡´çš„æƒ…å†µã€‘</strong></li>
<li>ä½¿ç”¨ä½ç½®ï¼šå®ä½“ç±»ä¸»é”®å­—æ®µ</li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@TableName(&quot;sys_user&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@TableId(&quot;id&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> Integer age;</span><br><span class="line">    <span class="keyword">private</span> String email;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th align="left">å±æ€§</th>
<th align="left">ç±»å‹</th>
<th align="left">å¿…é¡»æŒ‡å®š</th>
<th align="left">é»˜è®¤å€¼</th>
<th align="left">æè¿°</th>
</tr>
</thead>
<tbody><tr>
<td align="left">value</td>
<td align="left">String</td>
<td align="left">å¦</td>
<td align="left">â€œâ€</td>
<td align="left">ä¸»é”®å­—æ®µå</td>
</tr>
<tr>
<td align="left">type</td>
<td align="left">Enum</td>
<td align="left">å¦</td>
<td align="left">IdType.NONE</td>
<td align="left">æŒ‡å®šä¸»é”®ç±»å‹</td>
</tr>
</tbody></table>
<h4 id="IdType"><a href="#IdType" class="headerlink" title=" IdType"></a><a href="https://github.com/baomidou/mybatis-plus/blob/3.0/mybatis-plus-annotation/src/main/java/com/baomidou/mybatisplus/annotation/IdType.java"> IdType</a></h4><table>
<thead>
<tr>
<th align="left">å€¼</th>
<th align="left">æè¿°</th>
</tr>
</thead>
<tbody><tr>
<td align="left">AUTO</td>
<td align="left">æ•°æ®åº“ ID è‡ªå¢</td>
</tr>
<tr>
<td align="left">NONE</td>
<td align="left">æ— çŠ¶æ€ï¼Œè¯¥ç±»å‹ä¸ºæœªè®¾ç½®ä¸»é”®ç±»å‹ï¼ˆæ³¨è§£é‡Œç­‰äºè·Ÿéšå…¨å±€ï¼Œå…¨å±€é‡Œçº¦ç­‰äº INPUTï¼‰</td>
</tr>
<tr>
<td align="left">INPUT</td>
<td align="left">insert å‰è‡ªè¡Œ set ä¸»é”®å€¼</td>
</tr>
<tr>
<td align="left">ASSIGN_ID</td>
<td align="left">åˆ†é… ID(ä¸»é”®ç±»å‹ä¸º Number(Long å’Œ Integer)æˆ– String)(since 3.3.0)ï¼Œä½¿ç”¨æ¥å£<code>IdentifierGenerator</code>çš„æ–¹æ³•<code>nextId</code>(é»˜è®¤å®ç°ç±»ä¸º<code>DefaultIdentifierGenerator</code>é›ªèŠ±ç®—æ³•)</td>
</tr>
<tr>
<td align="left">ASSIGN_UUID</td>
<td align="left">åˆ†é… UUIDï¼Œä¸»é”®ç±»å‹ä¸º String(since 3.3.0)ï¼Œä½¿ç”¨æ¥å£<code>IdentifierGenerator</code>çš„æ–¹æ³•<code>nextUUID</code>(é»˜è®¤ default æ–¹æ³•)</td>
</tr>
<tr>
<td align="left"><del>ID_WORKER</del></td>
<td align="left">åˆ†å¸ƒå¼å…¨å±€å”¯ä¸€ ID é•¿æ•´å‹ç±»å‹(please use <code>ASSIGN_ID</code>)</td>
</tr>
<tr>
<td align="left"><del>UUID</del></td>
<td align="left">32 ä½ UUID å­—ç¬¦ä¸²(please use <code>ASSIGN_UUID</code>)</td>
</tr>
<tr>
<td align="left"><del>ID_WORKER_STR</del></td>
<td align="left">åˆ†å¸ƒå¼å…¨å±€å”¯ä¸€ ID å­—ç¬¦ä¸²ç±»å‹(please use <code>ASSIGN_ID</code>)</td>
</tr>
</tbody></table>
<h4 id="é›ªèŠ±ç®—æ³•"><a href="#é›ªèŠ±ç®—æ³•" class="headerlink" title="é›ªèŠ±ç®—æ³•"></a>é›ªèŠ±ç®—æ³•</h4><h3 id="1-4-3-TableField"><a href="#1-4-3-TableField" class="headerlink" title="1.4.3  @TableField"></a>1.4.3 <a href="https://github.com/baomidou/mybatis-plus/blob/3.0/mybatis-plus-annotation/src/main/java/com/baomidou/mybatisplus/annotation/TableField.java"> @TableField</a></h3><ul>
<li>æè¿°ï¼šå­—æ®µæ³¨è§£ï¼ˆéä¸»é”®ï¼‰</li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@TableName(&quot;sys_user&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> &#123;</span><br><span class="line">    <span class="meta">@TableId</span></span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line">    <span class="meta">@TableField(&quot;nickname&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> Integer age;</span><br><span class="line">    <span class="keyword">private</span> String email;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th align="left">å±æ€§</th>
<th align="left">ç±»å‹</th>
<th align="left">å¿…é¡»æŒ‡å®š</th>
<th align="left">é»˜è®¤å€¼</th>
<th align="left">æè¿°</th>
</tr>
</thead>
<tbody><tr>
<td align="left">value</td>
<td align="left">String</td>
<td align="left">å¦</td>
<td align="left">â€œâ€</td>
<td align="left">æ•°æ®åº“å­—æ®µå</td>
</tr>
<tr>
<td align="left">exist</td>
<td align="left">boolean</td>
<td align="left">å¦</td>
<td align="left">true</td>
<td align="left">æ˜¯å¦ä¸ºæ•°æ®åº“è¡¨å­—æ®µ</td>
</tr>
<tr>
<td align="left">condition</td>
<td align="left">String</td>
<td align="left">å¦</td>
<td align="left">â€œâ€</td>
<td align="left">å­—æ®µ <code>where</code> å®ä½“æŸ¥è¯¢æ¯”è¾ƒæ¡ä»¶ï¼Œæœ‰å€¼è®¾ç½®åˆ™æŒ‰è®¾ç½®çš„å€¼ä¸ºå‡†ï¼Œæ²¡æœ‰åˆ™ä¸ºé»˜è®¤å…¨å±€çš„ &#96;%s&#x3D;#</td>
</tr>
</tbody></table>
]]></content>
  </entry>
  <entry>
    <title>Python</title>
    <url>/2023/02/27/Python/</url>
    <content><![CDATA[]]></content>
  </entry>
  <entry>
    <title>Nginx</title>
    <url>/2023/02/28/Nginx/</url>
    <content><![CDATA[<h1 id><a href="#" class="headerlink" title></a></h1><h1 id="Nginx"><a href="#Nginx" class="headerlink" title="Nginx"></a>Nginx</h1><h1 id="nginxç®€ä»‹"><a href="#nginxç®€ä»‹" class="headerlink" title="nginxç®€ä»‹"></a>nginxç®€ä»‹</h1><p>åœ°å€ï¼š<a href="http://nginx.org/">http://nginx.org/</a></p>
<p>â€‹		Nginx (engine x) æ˜¯ä¸€ä¸ªé«˜æ€§èƒ½çš„ HTTP å’Œåå‘ä»£ç† Web æœåŠ¡å™¨ï¼ŒåŒæ—¶ä¹Ÿæä¾›äº† IMAP&#x2F;POP3&#x2F;SMTP æœåŠ¡ã€‚Nginx æ˜¯ç”±ä¼Šæˆˆå°”Â·èµ›ç´¢è€¶å¤«ä¸ºä¿„ç½—æ–¯è®¿é—®é‡ç¬¬äºŒçš„ Rambler.ruç«™ç‚¹ï¼ˆä¿„æ–‡ï¼šĞ Ğ°Ğ¼Ğ±Ğ»ĞµÑ€ï¼‰å¼€å‘çš„ï¼Œç¬¬ä¸€ä¸ªå…¬å¼€ç‰ˆæœ¬0.1.0å‘å¸ƒäº2004å¹´10æœˆ4æ—¥ã€‚</p>
<p>â€‹		Nginxé‡‡ç”¨ C è¿›è¡Œç¼–å†™ï¼ŒNginx æ˜¯ä¸€ä¸ªå®‰è£…éå¸¸çš„ç®€å•ã€é…ç½®æ–‡ä»¶éå¸¸ç®€æ´ï¼ˆè¿˜èƒ½å¤Ÿæ”¯æŒperlè¯­æ³•ï¼‰ã€Bugéå¸¸å°‘çš„æœåŠ¡ã€‚Nginx å¯åŠ¨ç‰¹åˆ«å®¹æ˜“ï¼Œå¹¶ä¸”å‡ ä¹å¯ä»¥åšåˆ° 7*24 ä¸é—´æ–­è¿è¡Œï¼Œå³ä½¿è¿è¡Œæ•°ä¸ªæœˆä¹Ÿä¸éœ€è¦é‡æ–°å¯åŠ¨ã€‚ä½ è¿˜èƒ½å¤Ÿä¸é—´æ–­æœåŠ¡çš„æƒ…å†µä¸‹è¿›è¡Œè½¯ä»¶ç‰ˆæœ¬çš„<a href="https://baike.baidu.com/item/%E5%8D%87%E7%BA%A7/8358284">å‡çº§</a>ã€‚å¤„ç†é«˜å¹¶å‘èƒ½åŠ›æ˜¯ååˆ†å¼ºå¤§çš„ï¼Œèƒ½ç»å—é«˜è´Ÿè½½çš„è€ƒéªŒ,æœ‰æŠ¥å‘Šè¡¨æ˜èƒ½æ”¯æŒé«˜è¾¾ 50,000 ä¸ªå¹¶å‘è¿æ¥æ•°ã€‚</p>
<h1 id="Nginxç›¸å…³æ¦‚å¿µ"><a href="#Nginxç›¸å…³æ¦‚å¿µ" class="headerlink" title="Nginxç›¸å…³æ¦‚å¿µ"></a>Nginxç›¸å…³æ¦‚å¿µ</h1><h2 id="æ­£å‘ä»£ç†"><a href="#æ­£å‘ä»£ç†" class="headerlink" title="æ­£å‘ä»£ç†"></a>æ­£å‘ä»£ç†</h2><p>æ­£å‘ä»£ç†ï¼šå¦‚æœæŠŠå±€åŸŸç½‘å¤–çš„ Internet æƒ³è±¡æˆä¸€ä¸ªå·¨å¤§çš„èµ„æºåº“ï¼Œåˆ™å±€åŸŸç½‘ä¸­çš„å®¢æˆ·ç«¯è¦è®¿é—® Internetï¼Œåˆ™éœ€è¦é€šè¿‡ä»£ç†æœåŠ¡å™¨æ¥è®¿é—®ï¼Œè¿™ç§ä»£ç†æœåŠ¡å°±ç§°ä¸ºæ­£å‘ä»£ç†ã€‚</p>
<p><strong>éœ€è¦åœ¨å®¢æˆ·ç«¯é…ç½®ä»£ç†æœåŠ¡å™¨è¿›è¡ŒæŒ‡å®šç½‘ç«™è®¿é—®ã€‚</strong></p>
<p><img src="/2023/02/28/Nginx/Java\Document\Nginx\Nginx.assets\image-20220425165532060.png" alt="image-æ­£å‘ä»£ç†"></p>
<h2 id="åå‘ä»£ç†"><a href="#åå‘ä»£ç†" class="headerlink" title="åå‘ä»£ç†"></a>åå‘ä»£ç†</h2><p>â€‹		åå‘ä»£ç†ï¼Œå…¶å®å®¢æˆ·ç«¯å¯¹ä»£ç†æ˜¯æ— æ„ŸçŸ¥çš„ï¼Œå› ä¸ºå®¢æˆ·ç«¯ä¸éœ€è¦ä»»ä½•é…ç½®å°±å¯ä»¥è®¿é—®ï¼Œæˆ‘ä»¬åªéœ€è¦å°†è¯·æ±‚å‘é€åˆ°åå‘ä»£ç†æœåŠ¡å™¨ï¼Œç”±åå‘ä»£ç†æœåŠ¡å™¨å»é€‰æ‹©ç›®æ ‡æœåŠ¡å™¨è·å–æ•°æ®åï¼Œåœ¨è¿”å›ç»™å®¢æˆ·ç«¯ï¼Œæ­¤æ—¶åå‘ä»£ç†æœåŠ¡å™¨å’Œç›®æ ‡æœåŠ¡å™¨å¯¹å¤–å°±æ˜¯ä¸€ä¸ªæœåŠ¡å™¨ï¼Œ<strong>æš´éœ²çš„æ˜¯ä»£ç†æœåŠ¡å™¨åœ°å€ï¼Œéšè—äº†çœŸå®æœåŠ¡å™¨ IP åœ°å€</strong>ã€‚</p>
<p><img src="/2023/02/28/Nginx/Java\Document\Nginx\Nginx.assets\image-20220425165945076.png" alt="image-åå‘ä»£ç†"></p>
<h2 id="è´Ÿè½½å‡è¡¡"><a href="#è´Ÿè½½å‡è¡¡" class="headerlink" title="è´Ÿè½½å‡è¡¡"></a>è´Ÿè½½å‡è¡¡</h2><p>â€‹		æé«˜å•ä¸ªæœºå™¨çš„æ€§èƒ½é…ç½®ä¹Ÿæ— æ³•è§£å†³é«˜å¹¶å‘çš„é—®é¢˜ï¼Œå› æ­¤å¢åŠ æœåŠ¡å™¨çš„æ•°é‡ï¼Œç„¶åå°†è¯·æ±‚åˆ†å‘åˆ°å„ä¸ªæœåŠ¡å™¨ä¸Šï¼Œå°†åŸå…ˆè¯·æ±‚é›†ä¸­åˆ°å•ä¸ªæœåŠ¡å™¨ä¸Šçš„æƒ…å†µæ”¹ä¸ºå°†è¯·æ±‚åˆ†å‘åˆ°å¤šä¸ªæœåŠ¡å™¨ä¸Šï¼Œå°†è´Ÿè½½åˆ†å‘åˆ°ä¸åŒçš„æœåŠ¡å™¨ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬æ‰€è¯´çš„è´Ÿè½½å‡è¡¡ã€‚</p>
<p><img src="/2023/02/28/Nginx/Java\Document\Nginx\Nginx.assets\image-20220425170207764.png" alt="image-è´Ÿè½½å‡è¡¡"></p>
<h2 id="åŠ¨é™åˆ†ç¦»"><a href="#åŠ¨é™åˆ†ç¦»" class="headerlink" title="åŠ¨é™åˆ†ç¦»"></a>åŠ¨é™åˆ†ç¦»</h2><p>â€‹		ä¸ºäº†åŠ å¿«ç½‘ç«™çš„è§£æé€Ÿåº¦ï¼Œå¯ä»¥æŠŠåŠ¨æ€é¡µé¢å’Œé™æ€é¡µé¢ç”±ä¸åŒçš„æœåŠ¡å™¨æ¥è§£æï¼ŒåŠ å¿«è§£æé€Ÿåº¦ã€‚é™ä½åŸæ¥å•ä¸ªæœåŠ¡å™¨çš„å‹åŠ›ã€‚</p>
<p><img src="/2023/02/28/Nginx/Java\Document\Nginx\Nginx.assets\image-20220425170549236.png" alt="image-åŠ¨é™åˆ†ç¦»"></p>
<h1 id="nginxçš„å®‰è£…"><a href="#nginxçš„å®‰è£…" class="headerlink" title="nginxçš„å®‰è£…"></a>nginxçš„å®‰è£…</h1><p>nginxä¸‹è½½åœ°å€ï¼š<strong><a href="http://nginx.org/en/download.html">http://nginx.org/en/download.html</a></strong></p>
<h2 id="nginxå®‰è£…æ­¥éª¤"><a href="#nginxå®‰è£…æ­¥éª¤" class="headerlink" title="nginxå®‰è£…æ­¥éª¤"></a>nginxå®‰è£…æ­¥éª¤</h2><h3 id="å®‰è£…ç¼–è¯‘å·¥å…·ä»¥åŠåº“æ–‡ä»¶"><a href="#å®‰è£…ç¼–è¯‘å·¥å…·ä»¥åŠåº“æ–‡ä»¶" class="headerlink" title="å®‰è£…ç¼–è¯‘å·¥å…·ä»¥åŠåº“æ–‡ä»¶"></a>å®‰è£…ç¼–è¯‘å·¥å…·ä»¥åŠåº“æ–‡ä»¶</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">yum -y install make zlib zlib-devel gcc-c++ libtool  openssl openssl-devel</span><br></pre></td></tr></table></figure>

<h3 id="å®‰è£…-pcre"><a href="#å®‰è£…-pcre" class="headerlink" title="å®‰è£… pcre"></a>å®‰è£… pcre</h3><p>PCRE ä½œç”¨ï¼šè®© Nginx æ”¯æŒ Rewrite åŠŸèƒ½ã€‚</p>
<p>ä¸‹è½½åœ°å€ï¼š <a href="http://downloads.sourceforge.net/project/pcre/pcre/8.35/pcre-8.35.tar.gz">http://downloads.sourceforge.net/project/pcre/pcre/8.35/pcre-8.35.tar.gz</a></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@localhost src]# cd /usr/local/src</span><br><span class="line">[root@localhost src]# wget  http://downloads.sourceforge.net/project/pcre/pcre/8.35/pcre-8.35.tar.gz</span><br></pre></td></tr></table></figure>

<p>è§£å‹å¹¶è¿›å…¥pcreç›®å½•ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@localhost src]# tar zxvf pcre-8.35.tar.gz</span><br><span class="line">[root@localhost src]# cd pcre-8.35</span><br></pre></td></tr></table></figure>

<p>ç¼–è¯‘å®‰è£…ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@localhost pcre-8.35]# ./configure</span><br><span class="line">[root@localhost pcre-8.35]# make &amp;&amp; make install</span><br></pre></td></tr></table></figure>

<p>æŸ¥çœ‹pcreç‰ˆæœ¬ï¼špcre-config â€“version</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@localhost pcre-8.35]# pcre-config --version</span><br><span class="line">8.35</span><br></pre></td></tr></table></figure>

<h3 id="å®‰è£…-nginx"><a href="#å®‰è£…-nginx" class="headerlink" title="å®‰è£… nginx"></a>å®‰è£… nginx</h3><p>ä¸‹è½½ nginxï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@localhost pcre-8.35]# cd /usr/local/src/</span><br><span class="line">[root@localhost src]# wget http://nginx.org/download/nginx-1.16.1.tar.gz</span><br></pre></td></tr></table></figure>

<p>è§£å‹å¹¶è¿›å…¥nginxç›®å½•ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@localhost src]# tar zxvf nginx-1.16.1.tar.gz</span><br><span class="line">[root@localhost src]# cd nginx-1.16.1/</span><br></pre></td></tr></table></figure>

<p>ç¼–è¯‘å¹¶å®‰è£…ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@localhost nginx-1.16.1]# ./configure</span><br><span class="line">[root@localhost nginx-1.16.1]# make &amp;&amp; make install</span><br></pre></td></tr></table></figure>

<p>æŸ¥çœ‹å®‰è£…ç‰ˆæœ¬ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@localhost nginx-1.16.1]# /usr/local/nginx/sbin/nginx -v</span><br><span class="line">nginx version: nginx/1.16.1</span><br></pre></td></tr></table></figure>

<p>å‘½ä»¤ä½ç½®ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@localhost local]# ll /usr/local/nginx/</span><br><span class="line">æ€»ç”¨é‡ 4</span><br><span class="line">drwxr-xr-x. 2 root root 4096 10æœˆ  9 00:43 conf</span><br><span class="line">drwxr-xr-x. 2 root root   40 10æœˆ  9 00:43 html</span><br><span class="line">drwxr-xr-x. 2 root root    6 10æœˆ  9 00:43 logs</span><br><span class="line">drwxr-xr-x. 2 root root   19 10æœˆ  9 00:43 sbin</span><br><span class="line">[root@localhost local]# cd /usr/local/nginx/</span><br><span class="line">[root@localhost nginx]# ll sbin</span><br><span class="line">æ€»ç”¨é‡ 3740</span><br><span class="line">-rwxr-xr-x. 1 root root 3826240 10æœˆ  9 00:43 nginx</span><br><span class="line">[root@localhost nginx]# ll conf/</span><br><span class="line">æ€»ç”¨é‡ 68</span><br><span class="line">-rw-r--r--. 1 root root 1077 10æœˆ  9 00:43 fastcgi.conf</span><br><span class="line">-rw-r--r--. 1 root root 1077 10æœˆ  9 00:43 fastcgi.conf.default</span><br><span class="line">-rw-r--r--. 1 root root 1007 10æœˆ  9 00:43 fastcgi_params</span><br><span class="line">-rw-r--r--. 1 root root 1007 10æœˆ  9 00:43 fastcgi_params.default</span><br><span class="line">-rw-r--r--. 1 root root 2837 10æœˆ  9 00:43 koi-utf</span><br><span class="line">-rw-r--r--. 1 root root 2223 10æœˆ  9 00:43 koi-win</span><br><span class="line">-rw-r--r--. 1 root root 5231 10æœˆ  9 00:43 mime.types</span><br><span class="line">-rw-r--r--. 1 root root 5231 10æœˆ  9 00:43 mime.types.default</span><br><span class="line">-rw-r--r--. 1 root root 2656 10æœˆ  9 00:43 nginx.conf</span><br><span class="line">-rw-r--r--. 1 root root 2656 10æœˆ  9 00:43 nginx.conf.default</span><br><span class="line">-rw-r--r--. 1 root root  636 10æœˆ  9 00:43 scgi_params</span><br><span class="line">-rw-r--r--. 1 root root  636 10æœˆ  9 00:43 scgi_params.default</span><br><span class="line">-rw-r--r--. 1 root root  664 10æœˆ  9 00:43 uwsgi_params</span><br><span class="line">-rw-r--r--. 1 root root  664 10æœˆ  9 00:43 uwsgi_params.default</span><br><span class="line">-rw-r--r--. 1 root root 3610 10æœˆ  9 00:43 win-utf</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>é…ç½®æ–‡ä»¶ä½ç½®ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@localhost conf]# pwd</span><br><span class="line">/usr/local/nginx/conf</span><br><span class="line">[root@localhost conf]# ls |grep nginx.conf</span><br><span class="line">nginx.conf</span><br><span class="line">nginx.conf.default</span><br></pre></td></tr></table></figure>

<h2 id="å¼€æ”¾80ç«¯å£"><a href="#å¼€æ”¾80ç«¯å£" class="headerlink" title="å¼€æ”¾80ç«¯å£"></a>å¼€æ”¾80ç«¯å£</h2><p>å¯¹äºCentOS7ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æŸ¥çœ‹å¼€æ”¾çš„ç«¯å£å·</span></span><br><span class="line">firewall-cmd --list-all</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">è®¾ç½®å¼€æ”¾çš„ç«¯å£å·</span></span><br><span class="line">firewall-cmd --add-service=http --permanent</span><br><span class="line">firewall-cmd --add-port=80/tcp --permanent</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">é‡å¯é˜²ç«å¢™</span></span><br><span class="line">firewall-cmd --reload</span><br></pre></td></tr></table></figure>

<p>ç¤ºä¾‹ï¼šå¼€æ”¾ç«¯å£</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@localhost local]# firewall-cmd --list-all</span><br><span class="line">public (active)</span><br><span class="line">  target: default</span><br><span class="line">  icmp-block-inversion: no</span><br><span class="line">  interfaces: ens33</span><br><span class="line">  sources:</span><br><span class="line">  services: dhcpv6-client ssh</span><br><span class="line">  ports:</span><br><span class="line">  protocols:</span><br><span class="line">  masquerade: no</span><br><span class="line">  forward-ports:</span><br><span class="line">  source-ports:</span><br><span class="line">  icmp-blocks:</span><br><span class="line">  rich rules:</span><br><span class="line">[root@localhost local]# firewall-cmd --add-service=http --permanent</span><br><span class="line">success</span><br><span class="line">[root@localhost local]# firewall-cmd --add-port=80/tcp --permanent</span><br><span class="line">success</span><br><span class="line">[root@localhost local]# firewall-cmd --reload</span><br><span class="line">success</span><br><span class="line">[root@localhost local]# firewall-cmd --list-all</span><br><span class="line">public (active)</span><br><span class="line">  target: default</span><br><span class="line">  icmp-block-inversion: no</span><br><span class="line">  interfaces: ens33</span><br><span class="line">  sources:</span><br><span class="line">  services: dhcpv6-client http ssh</span><br><span class="line">  ports: 80/tcp</span><br><span class="line">  protocols:</span><br><span class="line">  masquerade: no</span><br><span class="line">  forward-ports:</span><br><span class="line">  source-ports:</span><br><span class="line">  icmp-blocks:</span><br><span class="line">  rich rules:</span><br><span class="line">[root@localhost local]#</span><br></pre></td></tr></table></figure>

<h2 id="é…ç½®ç¯å¢ƒå˜é‡"><a href="#é…ç½®ç¯å¢ƒå˜é‡" class="headerlink" title="é…ç½®ç¯å¢ƒå˜é‡"></a>é…ç½®ç¯å¢ƒå˜é‡</h2><h3 id="ä¸´æ—¶ä¿®æ”¹"><a href="#ä¸´æ—¶ä¿®æ”¹" class="headerlink" title="ä¸´æ—¶ä¿®æ”¹"></a>ä¸´æ—¶ä¿®æ”¹</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@localhost conf]# export PATH=$PATH:/usr/local/nginx/sbin</span><br><span class="line">[root@localhost conf]# nginx -v</span><br><span class="line">nginx version: nginx/1.16.1</span><br></pre></td></tr></table></figure>

<h3 id="æ°¸ä¹…ä¿®æ”¹"><a href="#æ°¸ä¹…ä¿®æ”¹" class="headerlink" title="æ°¸ä¹…ä¿®æ”¹"></a>æ°¸ä¹…ä¿®æ”¹</h3><p>ä¿®æ”¹ &#x2F;etc&#x2F;profileæ–‡ä»¶</p>
<p>source &#x2F;etc&#x2F;profile</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@localhost ~]# vim /etc/profile</span><br><span class="line">......</span><br><span class="line">unset i</span><br><span class="line">unset -f pathmunge</span><br><span class="line"></span><br><span class="line">export NGINX_HOME=/usr/local/nginx</span><br><span class="line">export PATH=$&#123;NGINX_HOME&#125;/sbin:$&#123;PATH&#125;</span><br><span class="line">[root@localhost ~]# source /etc/profile</span><br><span class="line">[root@localhost ~]# echo $PATH</span><br><span class="line">/usr/local/nginx/sbin:/usr/local/nginx/sbin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/root/bin</span><br><span class="line">[root@localhost ~]# nginx -s reload</span><br></pre></td></tr></table></figure>

<h2 id="NginxæœåŠ¡è‡ªå¯åŠ¨"><a href="#NginxæœåŠ¡è‡ªå¯åŠ¨" class="headerlink" title="NginxæœåŠ¡è‡ªå¯åŠ¨"></a>NginxæœåŠ¡è‡ªå¯åŠ¨</h2><p>CentOS7ä¸­ï¼š</p>
<p>â€‹		1. å…³é—­ nginx è¿›ç¨‹ </p>
<p>â€‹		2. åœ¨ &#x2F;usr&#x2F;lib&#x2F;systemd&#x2F;system&#x2F; ç›®å½•ä¸‹ï¼Œåˆ›å»ºnginx.serviceæ–‡ä»¶ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@localhost ~]# cd /usr/lib/systemd/system</span><br><span class="line">[root@localhost system]# vim nginx.service</span><br><span class="line">[Unit]</span><br><span class="line">Description=nginx service</span><br><span class="line">After=network.target </span><br><span class="line"> </span><br><span class="line">[Service] </span><br><span class="line">Type=forking</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">è·¯å¾„å¯¹åº”å®‰è£…è·¯å¾„</span></span><br><span class="line">ExecStart=/usr/local/nginx/sbin/nginx</span><br><span class="line">ExecReload=/usr/local/nginx/sbin/nginx -s reload</span><br><span class="line">ExecStop=/usr/local/nginx/sbin/nginx -s quit</span><br><span class="line">PrivateTmp=true </span><br><span class="line"> </span><br><span class="line">[Install] </span><br><span class="line">WantedBy=multi-user.target</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">å¿…é¡»é‡æ–°åŠ è½½</span></span><br><span class="line">[root@localhost ~]# systemctl daemon-reload</span><br><span class="line">[root@localhost system]# systemctl start nginx</span><br><span class="line">[root@localhost system]# systemctl status nginx</span><br><span class="line">â— nginx.service - nginx</span><br><span class="line">   Loaded: loaded (/usr/lib/systemd/system/nginx.service; enabled; vendor preset: disabled)</span><br><span class="line">   Active: active (running) since ä¸€ 2022-04-25 19:59:11 CST; 9s ago</span><br><span class="line">  Process: 3922 ExecStart=/usr/local/nginx/sbin/nginx -c /usr/local/nginx/conf/nginx.conf (code=exited, status=0/SUCCESS)</span><br><span class="line"> Main PID: 3925 (nginx)</span><br><span class="line">    Tasks: 2</span><br><span class="line">   CGroup: /system.slice/nginx.service</span><br><span class="line">           â”œâ”€3925 nginx: master process /usr/local/nginx/sbin/nginx -c /usr/local/nginx/conf/nginx.conf</span><br><span class="line">           â””â”€3926 nginx: worker process</span><br><span class="line"></span><br><span class="line">4æœˆ 25 19:59:11 localhost.localdomain systemd[1]: Starting nginx...</span><br><span class="line">4æœˆ 25 19:59:11 localhost.localdomain systemd[1]: Started nginx.</span><br></pre></td></tr></table></figure>



<h1 id="Nginx-å¸¸ç”¨å‘½ä»¤"><a href="#Nginx-å¸¸ç”¨å‘½ä»¤" class="headerlink" title="Nginx å¸¸ç”¨å‘½ä»¤"></a>Nginx å¸¸ç”¨å‘½ä»¤</h1><p>æŸ¥çœ‹ç‰ˆæœ¬ï¼š.&#x2F;nginx -v</p>
<p>å¯åŠ¨ï¼š.&#x2F;nginx</p>
<p>é‡è½½é…ç½®æ–‡ä»¶ï¼š.&#x2F;nginx -s reload</p>
<p>åœæ­¢ï¼š.&#x2F;nginx -s stop</p>
<p>ç‰¹å®šé…ç½®æ–‡ä»¶å¯åŠ¨ nginxï¼š.&#x2F;nginx  -c  path  &#x2F;nginx.conf</p>
<p>æµ‹è¯•å½“å‰é…ç½®æ–‡ä»¶æ˜¯å¦æ­£ç¡®ï¼š.&#x2F;nginx -t</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@localhost sbin]# pwd</span><br><span class="line">/usr/local/nginx/sbin</span><br><span class="line">[root@localhost sbin]# ./nginx -v</span><br><span class="line">nginx version: nginx/1.6.2</span><br><span class="line">[root@localhost sbin]# ./nginx</span><br><span class="line">[root@localhost sbin]# ps -ef|grep nginx</span><br><span class="line">root      64001      1  0 17:43 ?        00:00:00 nginx: master process ./nginx</span><br><span class="line">nobody    64002  64001  0 17:43 ?        00:00:00 nginx: worker process</span><br><span class="line">root      64004  56888  0 17:43 pts/0    00:00:00 grep --color=auto nginx</span><br><span class="line">[root@localhost sbin]# ./nginx -s reload</span><br><span class="line">[root@localhost sbin]# ./nginx -s stop</span><br></pre></td></tr></table></figure>

<p><strong>æ³¨æ„ï¼šnginxä¼šå¯åŠ¨ä¸¤ä¸ªè¿›ç¨‹</strong></p>
<h1 id="nginé…ç½®æ–‡ä»¶"><a href="#nginé…ç½®æ–‡ä»¶" class="headerlink" title="nginé…ç½®æ–‡ä»¶"></a>nginé…ç½®æ–‡ä»¶</h1><h2 id="é…ç½®æ–‡ä»¶"><a href="#é…ç½®æ–‡ä»¶" class="headerlink" title="é…ç½®æ–‡ä»¶"></a>é…ç½®æ–‡ä»¶</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@localhost conf]# cat -n nginx.conf</span><br><span class="line">     1</span><br><span class="line">     2  #user  nobody;</span><br><span class="line">     3  worker_processes  1;</span><br><span class="line">     4</span><br><span class="line">     5  #error_log  logs/error.log;</span><br><span class="line">     6  #error_log  logs/error.log  notice;</span><br><span class="line">     7  #error_log  logs/error.log  info;</span><br><span class="line">     8</span><br><span class="line">     9  #pid        logs/nginx.pid;</span><br><span class="line">    11</span><br><span class="line">    12  events &#123;</span><br><span class="line">    13      worker_connections  1024;</span><br><span class="line">    14  &#125;</span><br><span class="line">    15</span><br><span class="line">    17  http &#123;</span><br><span class="line">    18      include       mime.types;</span><br><span class="line">    19      default_type  application/octet-stream;</span><br><span class="line">    20</span><br><span class="line">    21      #log_format  main  &#x27;$remote_addr - $remote_user [$time_local] &quot;$request&quot; &#x27;</span><br><span class="line">    22      #                  &#x27;$status $body_bytes_sent &quot;$http_referer&quot; &#x27;</span><br><span class="line">    23      #                  &#x27;&quot;$http_user_agent&quot; &quot;$http_x_forwarded_for&quot;&#x27;;</span><br><span class="line">    24</span><br><span class="line">    25      #access_log  logs/access.log  main;</span><br><span class="line">    26</span><br><span class="line">    27      sendfile        on;</span><br><span class="line">    28      #tcp_nopush     on;</span><br><span class="line">    29</span><br><span class="line">    30      #keepalive_timeout  0;</span><br><span class="line">    31      keepalive_timeout  65;</span><br><span class="line">    32</span><br><span class="line">    33      #gzip  on;</span><br><span class="line">    34</span><br><span class="line">    35      server &#123;</span><br><span class="line">    36          listen       80;</span><br><span class="line">    37          server_name  localhost;</span><br><span class="line">    38</span><br><span class="line">    39          #charset koi8-r;</span><br><span class="line">    40</span><br><span class="line">    41          #access_log  logs/host.access.log  main;</span><br><span class="line">    42</span><br><span class="line">    43          location / &#123;</span><br><span class="line">    44              root   html;</span><br><span class="line">    45              index  index.html index.htm;</span><br><span class="line">    46          &#125;</span><br><span class="line">    47</span><br><span class="line">    48          #error_page  404              /404.html;</span><br><span class="line">    49</span><br><span class="line">    50          # redirect server error pages to the static page /50x.html</span><br><span class="line">    51          #</span><br><span class="line">    52          error_page   500 502 503 504  /50x.html;</span><br><span class="line">    53          location = /50x.html &#123;</span><br><span class="line">    54              root   html;</span><br><span class="line">    55          &#125;</span><br><span class="line">    56</span><br><span class="line">    57          # proxy the PHP scripts to Apache listening on 127.0.0.1:80</span><br><span class="line">    58          #</span><br><span class="line">    59          #location ~ \.php$ &#123;</span><br><span class="line">    60          #    proxy_pass   http://127.0.0.1;</span><br><span class="line">    61          #&#125;</span><br><span class="line">    62</span><br><span class="line">    63          # pass the PHP scripts to FastCGI server listening on 127.0.0.1:9000</span><br><span class="line">    64          #</span><br><span class="line">    65          #location ~ \.php$ &#123;</span><br><span class="line">    66          #    root           html;</span><br><span class="line">    67          #    fastcgi_pass   127.0.0.1:9000;</span><br><span class="line">    68          #    fastcgi_index  index.php;</span><br><span class="line">    69          #    fastcgi_param  SCRIPT_FILENAME  /scripts$fastcgi_script_name;</span><br><span class="line">    70          #    include        fastcgi_params;</span><br><span class="line">    71          #&#125;</span><br><span class="line">    72</span><br><span class="line">    73          # deny access to .htaccess files, if Apache&#x27;s document root</span><br><span class="line">    74          # concurs with nginx&#x27;s one</span><br><span class="line">    75          #</span><br><span class="line">    76          #location ~ /\.ht &#123;</span><br><span class="line">    77          #    deny  all;</span><br><span class="line">    78          #&#125;</span><br><span class="line">    79      &#125;</span><br><span class="line">    81</span><br><span class="line">    82      # another virtual host using mix of IP-, name-, and port-based configuration</span><br><span class="line">    83      #</span><br><span class="line">    84      #server &#123;</span><br><span class="line">    85      #    listen       8000;</span><br><span class="line">    86      #    listen       somename:8080;</span><br><span class="line">    87      #    server_name  somename  alias  another.alias;</span><br><span class="line">    88</span><br><span class="line">    89      #    location / &#123;</span><br><span class="line">    90      #        root   html;</span><br><span class="line">    91      #        index  index.html index.htm;</span><br><span class="line">    92      #    &#125;</span><br><span class="line">    93      #&#125;</span><br><span class="line">    94</span><br><span class="line">    96      # HTTPS server</span><br><span class="line">    97      #</span><br><span class="line">    98      #server &#123;</span><br><span class="line">    99      #    listen       443 ssl;</span><br><span class="line">   100      #    server_name  localhost;</span><br><span class="line">   101</span><br><span class="line">   102      #    ssl_certificate      cert.pem;</span><br><span class="line">   103      #    ssl_certificate_key  cert.key;</span><br><span class="line">   104</span><br><span class="line">   105      #    ssl_session_cache    shared:SSL:1m;</span><br><span class="line">   106      #    ssl_session_timeout  5m;</span><br><span class="line">   107</span><br><span class="line">   108      #    ssl_ciphers  HIGH:!aNULL:!MD5;</span><br><span class="line">   109      #    ssl_prefer_server_ciphers  on;</span><br><span class="line">   110</span><br><span class="line">   111      #    location / &#123;</span><br><span class="line">   112      #        root   html;</span><br><span class="line">   113      #        index  index.html index.htm;</span><br><span class="line">   114      #    &#125;</span><br><span class="line">   115      #&#125;</span><br><span class="line">   116</span><br><span class="line">   117  &#125;</span><br></pre></td></tr></table></figure>

<p>é…ç½®æ–‡ä»¶è¯´æ˜ï¼š</p>
<p>â€‹		å¯ä»¥å°† nginx.conf é…ç½®æ–‡ä»¶åˆ†ä¸ºä¸‰éƒ¨åˆ†ã€‚</p>
<h2 id="ç¬¬ä¸€éƒ¨åˆ†ï¼šå…¨å±€å—"><a href="#ç¬¬ä¸€éƒ¨åˆ†ï¼šå…¨å±€å—" class="headerlink" title="ç¬¬ä¸€éƒ¨åˆ†ï¼šå…¨å±€å—"></a>ç¬¬ä¸€éƒ¨åˆ†ï¼šå…¨å±€å—</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">3  worker_processes  1;</span><br></pre></td></tr></table></figure>

<p>â€‹	ä»é…ç½®æ–‡ä»¶å¼€å§‹åˆ° events å—ä¹‹é—´çš„å†…å®¹ï¼Œä¸»è¦ä¼šè®¾ç½®ä¸€äº›å½±å“ nginx æœåŠ¡å™¨æ•´ä½“è¿è¡Œçš„é…ç½®æŒ‡ä»¤ï¼Œä¸»è¦åŒ…æ‹¬é…ç½®è¿è¡Œ Nginx æœåŠ¡å™¨çš„ç”¨æˆ·ï¼ˆç»„ï¼‰ã€å…è®¸ç”Ÿæˆçš„ worker process æ•°ï¼Œè¿›ç¨‹ PID å­˜æ”¾è·¯å¾„ã€æ—¥å¿—å­˜æ”¾è·¯å¾„å’Œç±»å‹ä»¥åŠé…ç½®æ–‡ä»¶çš„å¼•å…¥ç­‰ã€‚</p>
<p>â€‹		è¿™æ˜¯ Nginx æœåŠ¡å™¨å¹¶å‘å¤„ç†æœåŠ¡çš„å…³é”®é…ç½®ï¼Œworker_processes å€¼è¶Šå¤§ï¼Œå¯ä»¥æ”¯æŒçš„å¹¶å‘å¤„ç†é‡ä¹Ÿè¶Šå¤šï¼Œä½†æ˜¯ä¼šå—åˆ°ç¡¬ä»¶ã€è½¯ä»¶ç­‰è®¾å¤‡çš„åˆ¶çº¦ã€‚</p>
<h2 id="ç¬¬äºŒéƒ¨åˆ†ï¼ševents-å—"><a href="#ç¬¬äºŒéƒ¨åˆ†ï¼ševents-å—" class="headerlink" title="ç¬¬äºŒéƒ¨åˆ†ï¼ševents å—"></a>ç¬¬äºŒéƒ¨åˆ†ï¼ševents å—</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">12  events &#123;</span><br><span class="line">13      worker_connections  1024;</span><br><span class="line">14  &#125;</span><br></pre></td></tr></table></figure>

<p>â€‹		events å—æ¶‰åŠçš„æŒ‡ä»¤ä¸»è¦å½±å“ Nginx æœåŠ¡å™¨ä¸ç”¨æˆ·çš„ç½‘ç»œè¿æ¥ï¼Œå¸¸ç”¨çš„è®¾ç½®åŒ…æ‹¬æ˜¯å¦å¼€å¯å¯¹å¤š work process ä¸‹çš„ç½‘ç»œè¿æ¥è¿›è¡Œåºåˆ—åŒ–ï¼Œæ˜¯å¦å…è®¸åŒæ—¶æ¥æ”¶å¤šä¸ªç½‘ç»œè¿æ¥ï¼Œé€‰å–å“ªç§äº‹ä»¶é©±åŠ¨æ¨¡å‹æ¥å¤„ç†è¿æ¥è¯·æ±‚ï¼Œæ¯ä¸ª word process å¯ä»¥åŒæ—¶æ”¯æŒçš„æœ€å¤§è¿æ¥æ•°ç­‰ã€‚ ä¸Šè¿°ä¾‹å­å°±è¡¨ç¤ºæ¯ä¸ª work process æ”¯æŒçš„æœ€å¤§è¿æ¥æ•°ä¸º 1024ã€‚è¿™éƒ¨åˆ†çš„é…ç½®å¯¹ Nginx çš„æ€§èƒ½å½±å“è¾ƒå¤§ï¼Œåœ¨å®é™…ä¸­åº”è¯¥çµæ´»é…ç½®ã€‚</p>
<h2 id="ç¬¬ä¸‰éƒ¨åˆ†ï¼šhttpå—"><a href="#ç¬¬ä¸‰éƒ¨åˆ†ï¼šhttpå—" class="headerlink" title="ç¬¬ä¸‰éƒ¨åˆ†ï¼šhttpå—"></a>ç¬¬ä¸‰éƒ¨åˆ†ï¼šhttpå—</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">17  http &#123;</span><br><span class="line">18      include       mime.types;</span><br><span class="line">19      default_type  application/octet-stream;</span><br><span class="line">21      #log_format  main  &#x27;$remote_addr - $remote_user [$time_local] &quot;$request&quot; &#x27;</span><br><span class="line">22      #                  &#x27;$status $body_bytes_sent &quot;$http_referer&quot; &#x27;</span><br><span class="line">23      #                  &#x27;&quot;$http_user_agent&quot; &quot;$http_x_forwarded_for&quot;&#x27;;</span><br><span class="line">25      #access_log  logs/access.log  main;</span><br><span class="line">27      sendfile        on;</span><br><span class="line">28      #tcp_nopush     on;</span><br><span class="line">30      #keepalive_timeout  0;</span><br><span class="line">31      keepalive_timeout  65;</span><br><span class="line">33      #gzip  on;</span><br><span class="line">35      server &#123;</span><br><span class="line">36          listen       80;</span><br><span class="line">37          server_name  localhost;</span><br><span class="line">39          #charset koi8-r;</span><br><span class="line">41          #access_log  logs/host.access.log  main;</span><br><span class="line">43          location / &#123;</span><br><span class="line">44              root   html;</span><br><span class="line">45              index  index.html index.htm;</span><br><span class="line">46          &#125;</span><br></pre></td></tr></table></figure>

<p>â€‹		è¯¥éƒ¨åˆ†æ˜¯Nginx æœåŠ¡å™¨é…ç½®ä¸­æœ€é¢‘ç¹çš„éƒ¨åˆ†ï¼Œä»£ç†ã€ç¼“å­˜å’Œæ—¥å¿—å®šä¹‰ç­‰ç»å¤§å¤šæ•°åŠŸèƒ½å’Œç¬¬ä¸‰æ–¹æ¨¡å—çš„é…ç½®éƒ½åœ¨è¿™é‡Œã€‚ éœ€è¦æ³¨æ„çš„æ˜¯ï¼šhttp å—ä¹Ÿå¯ä»¥åŒ…æ‹¬ http å…¨å±€å—ã€server å—ã€‚</p>
<h3 id="http-å…¨å±€å—"><a href="#http-å…¨å±€å—" class="headerlink" title="http å…¨å±€å—"></a>http å…¨å±€å—</h3><p>â€‹		http å…¨å±€å—é…ç½®çš„æŒ‡ä»¤åŒ…æ‹¬æ–‡ä»¶å¼•å…¥ã€MIME-TYPE å®šä¹‰ã€æ—¥å¿—è‡ªå®šä¹‰ã€è¿æ¥è¶…æ—¶æ—¶é—´ã€å•é“¾æ¥è¯·æ±‚æ•°ä¸Šé™ç­‰ã€‚</p>
<h3 id="server-å—"><a href="#server-å—" class="headerlink" title="server å—"></a>server å—</h3><p>â€‹		è¿™å—å’Œè™šæ‹Ÿä¸»æœºæœ‰å¯†åˆ‡å…³ç³»ï¼Œè™šæ‹Ÿä¸»æœºä»ç”¨æˆ·è§’åº¦çœ‹ï¼Œå’Œä¸€å°ç‹¬ç«‹çš„ç¡¬ä»¶ä¸»æœºæ˜¯å®Œå…¨ä¸€æ ·çš„ï¼Œè¯¥æŠ€æœ¯çš„äº§ç”Ÿæ˜¯ä¸ºäº† èŠ‚çœäº’è”ç½‘æœåŠ¡å™¨ç¡¬ä»¶æˆæœ¬ã€‚ <strong>æ¯ä¸ª http å—å¯ä»¥åŒ…æ‹¬å¤šä¸ª server å—ï¼Œè€Œæ¯ä¸ª server å—å°±ç›¸å½“äºä¸€ä¸ªè™šæ‹Ÿä¸»æœºã€‚</strong> è€Œæ¯ä¸ª server å—ä¹Ÿåˆ†ä¸ºå…¨å±€ server å—ï¼Œä»¥åŠå¯ä»¥åŒæ—¶åŒ…å«å¤šä¸ª location å—ã€‚</p>
<ol>
<li><p>å…¨å±€ server å—ï¼šæœ€å¸¸è§çš„é…ç½®æ˜¯æœ¬è™šæ‹Ÿæœºä¸»æœºçš„ç›‘å¬é…ç½®å’Œæœ¬è™šæ‹Ÿä¸»æœºçš„åç§°æˆ– IP é…ç½®ã€‚</p>
</li>
<li><p>location å—ï¼šä¸€ä¸ª server å—å¯ä»¥é…ç½®å¤šä¸ª location å—ã€‚ è¿™å—çš„ä¸»è¦ä½œç”¨æ˜¯åŸºäº Nginx æœåŠ¡å™¨æ¥æ”¶åˆ°çš„è¯·æ±‚å­—ç¬¦ä¸²ï¼ˆä¾‹å¦‚ server_name&#x2F;uri-stringï¼‰ï¼Œå¯¹è™šæ‹Ÿä¸»æœºåç§° ï¼ˆä¹Ÿå¯ä»¥æ˜¯ IP åˆ«åï¼‰ä¹‹å¤–çš„å­—ç¬¦ä¸²ï¼ˆä¾‹å¦‚ å‰é¢çš„ &#x2F;uri-stringï¼‰è¿›è¡ŒåŒ¹é…ï¼Œå¯¹ç‰¹å®šçš„è¯·æ±‚è¿›è¡Œå¤„ç†ã€‚åœ°å€å®šå‘ã€æ•°æ®ç¼“ å­˜å’Œåº”ç­”æ§åˆ¶ç­‰åŠŸèƒ½ï¼Œè¿˜æœ‰è®¸å¤šç¬¬ä¸‰æ–¹æ¨¡å—çš„é…ç½®ä¹Ÿåœ¨è¿™é‡Œè¿›è¡Œã€‚</p>
</li>
</ol>
<h1 id="é…ç½®å®ä¾‹"><a href="#é…ç½®å®ä¾‹" class="headerlink" title="é…ç½®å®ä¾‹"></a>é…ç½®å®ä¾‹</h1><h2 id="ç¤ºä¾‹ä¸€ï¼šåå‘ä»£ç†"><a href="#ç¤ºä¾‹ä¸€ï¼šåå‘ä»£ç†" class="headerlink" title="ç¤ºä¾‹ä¸€ï¼šåå‘ä»£ç†"></a>ç¤ºä¾‹ä¸€ï¼šåå‘ä»£ç†</h2><p>â€‹		åœ¨æµè§ˆå™¨åœ°å€æ è¾“å…¥åœ°å€ <strong><a href="http://www.123.com/">www.123.com</a></strong>ï¼Œè·³è½¬åˆ° linux ç³»ç»Ÿ tomcat ä¸»é¡µã€‚</p>
<p>ç¬¬ä¸€æ­¥ï¼šä¿®æ”¹ <a href="http://www.123.com/">www.123.com</a> å’ŒIPçš„æ˜ å°„å…³ç³»</p>
<p>ä¿®æ”¹æ–‡ä»¶ï¼šC:\Windows\System32\drivers\etc\hostsï¼Œé…ç½®åŸŸåå’ŒIPçš„å¯¹åº”å…³ç³»ã€‚</p>
<figure class="highlight tex"><table><tr><td class="code"><pre><span class="line">192.168.100.100		www.123.com</span><br></pre></td></tr></table></figure>

<p>ç¬¬äºŒæ­¥ï¼šé…ç½® server å—</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">35     server &#123;</span><br><span class="line">36         listen       80;</span><br><span class="line">		   # ä¿®æ”¹åœ°å€</span><br><span class="line">37         server_name  192.168.100.100;</span><br><span class="line">38</span><br><span class="line">39         #charset koi8-r;</span><br><span class="line">40</span><br><span class="line">41         #access_log  logs/host.access.log  main;</span><br><span class="line">43         location / &#123;</span><br><span class="line">44             root   html;</span><br><span class="line">			    # æ·»åŠ  proxy_pass</span><br><span class="line">45             proxy_pass http://192.168.100.100:8080;</span><br><span class="line">46             index  index.html index.htm;</span><br><span class="line">47         &#125;</span><br></pre></td></tr></table></figure>

<p>ç¬¬ä¸‰æ­¥ï¼šé…ç½® tomcat ç¯å¢ƒå˜é‡</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">vim /etc/profile</span><br><span class="line">export NGINX_HOME=/usr/local/nginx</span><br><span class="line">export TOMCAT_HOME=/opt/tomcat/apache-tomcat-8.5.78/bin</span><br><span class="line">export PATH=$&#123;NGINX_HOME&#125;/sbin:$&#123;TOMCAT_HOME&#125;:$&#123;PATH&#125;</span><br><span class="line"></span><br><span class="line">source /etc/profile</span><br></pre></td></tr></table></figure>

<p>ç¬¬å››æ­¥ï¼šå¼€æ”¾ç«¯å£8080</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æŸ¥çœ‹å¼€æ”¾çš„ç«¯å£å·</span></span><br><span class="line">firewall-cmd --list-all</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">è®¾ç½®å¼€æ”¾çš„ç«¯å£å·</span></span><br><span class="line">firewall-cmd --add-service=http --permanent</span><br><span class="line">firewall-cmd --add-port=8080/tcp --permanent</span><br><span class="line">firewall-cmd --add-port=8081/tcp --permanent</span><br><span class="line">firewall-cmd --add-port=9001/tcp --permanent</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">é‡å¯é˜²ç«å¢™</span></span><br><span class="line">firewall-cmd --reload</span><br></pre></td></tr></table></figure>



<p>å¯åŠ¨tomcatï¼Œæµè§ˆå™¨è¾“å…¥åœ°å€ <a href="http://www.123.com/">www.123.com</a> è¿›è¡Œæµ‹è¯•ã€‚</p>
<p><img src="/2023/02/28/Nginx/Java\Document\Nginx\Nginx.assets\image-20220425200236256.png" alt="image-tomcatä¸»é¡µé¢"></p>
<p>ç¬¬å››æ­¥ï¼šæŸ¥çœ‹tomcatæ—¥å¿—æ–‡ä»¶</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">tail -f logs/catalina.out</span><br></pre></td></tr></table></figure>

<h2 id="ç¤ºä¾‹äºŒï¼šåå‘ä»£ç†"><a href="#ç¤ºä¾‹äºŒï¼šåå‘ä»£ç†" class="headerlink" title="ç¤ºä¾‹äºŒï¼šåå‘ä»£ç†"></a>ç¤ºä¾‹äºŒï¼šåå‘ä»£ç†</h2><p>â€‹		ä½¿ç”¨ nginx åå‘ä»£ç†ï¼Œæ ¹æ®è®¿é—®çš„è·¯å¾„è·³è½¬åˆ°ä¸åŒç«¯å£çš„æœåŠ¡ä¸­ nginx ç›‘å¬ç«¯å£ä¸º 9001ã€‚</p>
<p>â€‹		è®¿é—® <a href="http://192.168.100.100:9001/edu/">http://192.168.100.100:9001/edu/</a> ç›´æ¥è·³è½¬åˆ° 192.168.100.100:8080 </p>
<p>â€‹		è®¿é—® http:&#x2F;&#x2F; 192.168.100.100:9001&#x2F;vod&#x2F; ç›´æ¥è·³è½¬åˆ° 192.168.100.100:8081</p>
<p>ç¬¬ä¸€æ­¥ï¼šå‡†å¤‡ä¸¤ä¸ªtomcatï¼Œç«¯å£åˆ†åˆ«ä¸º 8080 å’Œ 8081ã€‚</p>
<p><strong>ã€æ³¨æ„ã€‘å¯åŠ¨ä¸¤ä¸ª Tomcat æ—¶ï¼Œç›´æ¥åœ¨ tomcat&#x2F;bin ç›®å½•å¯åŠ¨ï¼Œå¦‚æœé…ç½®äº† Tomcat çš„ç¯å¢ƒå˜é‡ï¼Œåº”è¯¥é…ç½®å¤šä¸ªï¼Œè¦ä¹ˆå°±ä¸é…ã€‚</strong></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@localhost tomcat]# pwd</span><br><span class="line">/opt/tomcat</span><br><span class="line">[root@localhost tomcat]# mkdir tomcat8081</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æ³¨æ„æ‹·è´å¤šçº§ç›®å½•æ—¶éœ€è¦åŠ é€’å½’å‚æ•° -rï¼Œå¦åˆ™ä¸ç”Ÿæ•ˆï¼Œæç¤ºï¼š<span class="built_in">cp</span>: ç•¥è¿‡ç›®å½•<span class="string">&quot;apache-tomcat-8.5.70&quot;</span></span></span><br><span class="line">[root@localhost tomcat]# cp -r apache-tomcat-8.5.78/. tomcat8081/</span><br><span class="line">[root@localhost tomcat]# vim tomcat8081/conf/server.xml</span><br><span class="line"> ......</span><br><span class="line"><span class="meta prompt_"> # </span><span class="language-bash">ä¿®æ”¹8005</span></span><br><span class="line"> 22 &lt;Server port=&quot;8015&quot; shutdown=&quot;SHUTDOWN&quot;&gt;</span><br><span class="line"> 23   &lt;Listener className=&quot;org.apache.catalina.startup.VersionLoggerListener&quot; /&gt;</span><br><span class="line"><span class="meta prompt_"> # </span><span class="language-bash">ä¿®æ”¹8081ä»¥åŠ8443</span></span><br><span class="line"> 69     &lt;Connector port=&quot;8081&quot; protocol=&quot;HTTP/1.1&quot;</span><br><span class="line"> 70                connectionTimeout=&quot;20000&quot;</span><br><span class="line"> 71                redirectPort=&quot;8444&quot; /&gt;</span><br><span class="line"> ......</span><br></pre></td></tr></table></figure>

<p>ç¬¬äºŒæ­¥ï¼šæµ‹è¯•é¡µé¢ test.html</p>
<p>cd 	&#x2F;opt&#x2F;tomcat&#x2F;apache-tomcat-8.5.78&#x2F;webapps&#x2F;edu</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">h2</span>&gt;</span></span><br><span class="line">    tomcat 8080</span><br><span class="line"><span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>cd 	&#x2F;opt&#x2F;tomcat&#x2F;tomcat8081&#x2F;webapps&#x2F;vod</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">h2</span>&gt;</span></span><br><span class="line">    tomcat 8081</span><br><span class="line"><span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>å°†æµ‹è¯•é¡µé¢åˆ†åˆ«æ”¾åœ¨ webapps ä¸‹é¢çš„æŸä¸€ä¸ªå…·ä½“ç›®å½•ï¼Œå¦‚æœç›´æ¥æ”¾åœ¨ webapps ä¸‹æ˜¯ä¸ä¼šè®¿é—®çš„ï¼ˆ404ï¼‰ã€‚</strong></p>
<p>ç¬¬ä¸‰æ­¥ï¼šé…ç½®Nginx</p>
<p>å¯ä»¥é…ç½®å¤šä¸ª server å—ã€‚</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">85     server &#123;</span><br><span class="line">86         listen       9001;</span><br><span class="line">87         # server_name:ä¸»æœºåï¼Œhostname</span><br><span class="line">88         server_name  192.168.100.100;</span><br><span class="line">89</span><br><span class="line">90         location ~ /edu/ &#123;</span><br><span class="line">91                 proxy_pass http://192.168.100.100:8080;</span><br><span class="line">93         &#125;</span><br><span class="line">94</span><br><span class="line">95         location ~ /vod/ &#123;</span><br><span class="line">96                 proxy_pass http://192.168.100.100:8081;</span><br><span class="line">97         &#125;</span><br><span class="line">98     &#125;</span><br></pre></td></tr></table></figure>

<p>å¦‚æœæœªå¯åŠ¨ tomcatï¼Œåˆ™ä¼šæŠ¥é”™ï¼š502 Bad GateWay</p>
<p>ç¬¬å››æ­¥ï¼šå¯åŠ¨ nginx å’Œ tomcat æµ‹è¯•</p>
<p>â€‹		<a href="http://192.168.100.100:9001/vod/test.html">http://192.168.100.100:9001/vod/test.html</a></p>
<p>â€‹		<a href="http://192.168.100.100:9001/edu/test.html">http://192.168.100.100:9001/edu/test.html</a></p>
<h2 id="ç¤ºä¾‹ä¸‰ï¼šè´Ÿè½½å‡è¡¡"><a href="#ç¤ºä¾‹ä¸‰ï¼šè´Ÿè½½å‡è¡¡" class="headerlink" title="ç¤ºä¾‹ä¸‰ï¼šè´Ÿè½½å‡è¡¡"></a>ç¤ºä¾‹ä¸‰ï¼šè´Ÿè½½å‡è¡¡</h2><p>â€‹		æµè§ˆå™¨åœ°å€æ è¾“å…¥åœ°å€ <a href="http://192.168.100.100edu/test.html%EF%BC%8C%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1%E6%95%88%E6%9E%9C%EF%BC%8C%E5%B9%B3%E5%9D%87">http://192.168.100.100edu/test.htmlï¼Œè´Ÿè½½å‡è¡¡æ•ˆæœï¼Œå¹³å‡</a> 8080 å’Œ 8081 ç«¯å£ä¸­ã€‚</p>
<p>ç¬¬ä¸€æ­¥ï¼šåœ¨ä¸¤ä¸ªtomcatä¸­åˆ›å»ºeduç›®å½•ï¼Œæ”¾å…¥test.html</p>
<p>ç¬¬äºŒæ­¥ï¼šåœ¨ nginx.conf ä¸­çš„ http å—è¿›è¡Œè´Ÿè½½å‡è¡¡é…ç½®</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">34     # è´Ÿè½½å‡è¡¡é…ç½®</span><br><span class="line">35     upstream myserver&#123;</span><br><span class="line">36         server  192.168.100.100:8080;</span><br><span class="line">37         server  192.168.100.100:8081;</span><br><span class="line">38     &#125;</span><br><span class="line">39</span><br><span class="line">40     server &#123;</span><br><span class="line">41         listen       80;</span><br><span class="line">42         server_name  192.168.100.100;</span><br><span class="line">43</span><br><span class="line">44         #charset koi8-r;</span><br><span class="line">45</span><br><span class="line">46         #access_log  logs/host.access.log  main;</span><br><span class="line">47</span><br><span class="line">48         location / &#123;</span><br><span class="line">49             root   html;</span><br><span class="line">50             proxy_pass http://myserver;</span><br><span class="line">51             index  index.html index.htm;</span><br><span class="line">52         &#125;</span><br></pre></td></tr></table></figure>

<p>ç¬¬ä¸‰æ­¥ï¼šæµ‹è¯• <a href="http://192.168.100.100/edu/test.html">http://192.168.100.100/edu/test.html</a></p>
<h2 id="nginx-åˆ†é…æœåŠ¡å™¨ç­–ç•¥"><a href="#nginx-åˆ†é…æœåŠ¡å™¨ç­–ç•¥" class="headerlink" title="nginx åˆ†é…æœåŠ¡å™¨ç­–ç•¥"></a>nginx åˆ†é…æœåŠ¡å™¨ç­–ç•¥</h2><p>ç¬¬ä¸€ç§ è½®è¯¢ï¼ˆé»˜è®¤ï¼‰ </p>
<p>â€‹		æ¯ä¸ªè¯·æ±‚æŒ‰æ—¶é—´é¡ºåºé€ä¸€åˆ†é…åˆ°ä¸åŒçš„åç«¯æœåŠ¡å™¨ï¼Œå¦‚æœåç«¯æœåŠ¡å™¨ down æ‰ï¼Œèƒ½è‡ªåŠ¨å‰”é™¤ã€‚</p>
<p>ç¬¬äºŒç§</p>
<p>â€‹		weight weight ä»£è¡¨æƒé‡é»˜è®¤ä¸º 1ï¼Œæƒé‡è¶Šé«˜è¢«åˆ†é…çš„å®¢æˆ·ç«¯è¶Šå¤š</p>
<p>ç¬¬ä¸‰ç§</p>
<p>â€‹		ip_hash æ¯ä¸ªè¯·æ±‚æŒ‰è®¿é—® ip çš„ hash ç»“æœåˆ†é…ï¼Œè¿™æ ·æ¯ä¸ªè®¿å®¢å›ºå®šè®¿é—®ä¸€ä¸ªåç«¯æœåŠ¡å™¨</p>
<p>ç¬¬å››ç§</p>
<p>â€‹		fairï¼ˆç¬¬ä¸‰æ–¹ï¼‰ æŒ‰åç«¯æœåŠ¡å™¨çš„å“åº”æ—¶é—´æ¥åˆ†é…è¯·æ±‚ï¼Œå“åº”æ—¶é—´çŸ­çš„ä¼˜å…ˆåˆ†é…ã€‚</p>
<h2 id="ç¤ºä¾‹å››ï¼šåŠ¨é™åˆ†ç¦»"><a href="#ç¤ºä¾‹å››ï¼šåŠ¨é™åˆ†ç¦»" class="headerlink" title="ç¤ºä¾‹å››ï¼šåŠ¨é™åˆ†ç¦»"></a>ç¤ºä¾‹å››ï¼šåŠ¨é™åˆ†ç¦»</h2><p>â€‹		é€šè¿‡ location æŒ‡å®šä¸åŒçš„åç¼€åå®ç°ä¸åŒçš„è¯·æ±‚è½¬å‘ã€‚é€šè¿‡ expires å‚æ•°è®¾ç½®ï¼Œå¯ä»¥ä½¿æµè§ˆå™¨ç¼“å­˜è¿‡æœŸæ—¶é—´ï¼Œå‡å°‘ä¸æœåŠ¡å™¨ä¹‹å‰çš„è¯·æ±‚å’Œæµé‡ã€‚</p>
<p>â€‹		å…·ä½“ Expires å®šä¹‰ï¼šæ˜¯ç»™ä¸€ä¸ªèµ„æºè®¾å®šä¸€ä¸ªè¿‡æœŸæ—¶é—´ï¼Œä¹Ÿå°±æ˜¯è¯´æ— éœ€å»æœåŠ¡ç«¯éªŒè¯ï¼Œç›´æ¥é€šè¿‡æµè§ˆå™¨è‡ªèº«ç¡®è®¤æ˜¯å¦è¿‡æœŸå³å¯ï¼Œ æ‰€ä»¥ä¸ä¼šäº§ç”Ÿé¢å¤–çš„æµé‡ã€‚æ­¤ç§æ–¹æ³•éå¸¸é€‚åˆä¸ç»å¸¸å˜åŠ¨çš„èµ„æºã€‚ï¼ˆå¦‚æœç»å¸¸æ›´æ–°çš„æ–‡ä»¶ï¼Œ ä¸å»ºè®®ä½¿ç”¨ Expires æ¥ç¼“å­˜ï¼‰ï¼Œæˆ‘è¿™é‡Œè®¾ç½® 3dï¼Œè¡¨ç¤ºåœ¨è¿™ 3 å¤©ä¹‹å†…è®¿é—®è¿™ä¸ª URLï¼Œå‘é€ä¸€ ä¸ªè¯·æ±‚ï¼Œæ¯”å¯¹æœåŠ¡å™¨è¯¥æ–‡ä»¶æœ€åæ›´æ–°æ—¶é—´æ²¡æœ‰å˜åŒ–ï¼Œåˆ™ä¸ä¼šä»æœåŠ¡å™¨æŠ“å–ï¼Œè¿”å›çŠ¶æ€ç  304ï¼Œ å¦‚æœæœ‰ä¿®æ”¹ï¼Œåˆ™ç›´æ¥ä»æœåŠ¡å™¨é‡æ–°ä¸‹è½½ï¼Œè¿”å›çŠ¶æ€ç  200ã€‚</p>
<p>ç¬¬ä¸€æ­¥ï¼šåœ¨ &#x2F;opt&#x2F;nginxData ç›®å½•ä¸‹å‡†å¤‡ä¸¤ä¸ªæ–‡ä»¶å¤¹ image å’Œ wwwï¼Œåˆ†åˆ«å­˜å‚¨é™æ€èµ„æº</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@localhost tomcat]# cd /opt/</span><br><span class="line">[root@localhost opt]# mkdir nginxData</span><br><span class="line">[root@localhost opt]# cd nginxData/</span><br><span class="line">[root@localhost nginxData]# mkdir image www</span><br><span class="line">[root@localhost nginxData]# ls</span><br><span class="line">image  www</span><br></pre></td></tr></table></figure>

<p>ç¬¬äºŒæ­¥ï¼šé…ç½® nginx.confï¼Œå¹¶é‡æ–°åŠ è½½é…ç½®</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">40     server &#123;</span><br><span class="line">41         listen       80;</span><br><span class="line">42         server_name  192.168.100.100;</span><br><span class="line">43</span><br><span class="line">44         #charset koi8-r;</span><br><span class="line">45</span><br><span class="line">46         #access_log  logs/host.access.log  main;</span><br><span class="line">47         location /image/&#123;</span><br><span class="line">48            root /opt/nginxData/;</span><br><span class="line">			  # åœ¨é¡µé¢ä»¥åˆ—è¡¨çš„å½¢å¼åˆ—å‡ºæ–‡ä»¶</span><br><span class="line">49            autoindex  on;</span><br><span class="line">50         &#125;</span><br><span class="line">51</span><br><span class="line">52         location /www/&#123;</span><br><span class="line">53            root /opt/nginxData/;</span><br><span class="line">54            index index.html index.htm;</span><br><span class="line">55         &#125;</span><br></pre></td></tr></table></figure>

<p>ç¬¬ä¸‰æ­¥ï¼šæµ‹è¯•</p>
<p>â€‹		<a href="http://192.168.100.100/image/girl01.webp">http://192.168.100.100/image/girl01.webp</a></p>
<p>â€‹		<a href="http://192.168.100.100/www/test.html">http://192.168.100.100/www/test.html</a></p>
<p><img src="/2023/02/28/Nginx/Java\Document\Nginx\Nginx.assets\image-20220425220015488.png" alt="image-autoindex"></p>
<h1 id="é…ç½®é«˜å¯ç”¨é›†ç¾¤"><a href="#é…ç½®é«˜å¯ç”¨é›†ç¾¤" class="headerlink" title="é…ç½®é«˜å¯ç”¨é›†ç¾¤"></a>é…ç½®é«˜å¯ç”¨é›†ç¾¤</h1><h2 id="åŸºæœ¬ä»‹ç»"><a href="#åŸºæœ¬ä»‹ç»" class="headerlink" title="åŸºæœ¬ä»‹ç»"></a>åŸºæœ¬ä»‹ç»</h2><p><img src="/2023/02/28/Nginx/Java\Document\Nginx\Nginx.assets\image-20220425220609428.png" alt="image-nginxé«˜å¯ç”¨é›†ç¾¤"></p>
<h2 id="é«˜å¯ç”¨é…ç½®"><a href="#é«˜å¯ç”¨é…ç½®" class="headerlink" title="é«˜å¯ç”¨é…ç½®"></a>é«˜å¯ç”¨é…ç½®</h2><h3 id="ç¬¬ä¸€æ­¥ï¼šå…‹éš†å½“å‰è™šæ‹Ÿæœº"><a href="#ç¬¬ä¸€æ­¥ï¼šå…‹éš†å½“å‰è™šæ‹Ÿæœº" class="headerlink" title="ç¬¬ä¸€æ­¥ï¼šå…‹éš†å½“å‰è™šæ‹Ÿæœº"></a>ç¬¬ä¸€æ­¥ï¼šå…‹éš†å½“å‰è™šæ‹Ÿæœº</h3><p>â€‹		æ³¨æ„å…‹éš†åç½‘å¡ä¸¢å¤±çš„æƒ…å†µ</p>
<h3 id="ç¬¬äºŒæ­¥ï¼šå®‰è£…-keepalived"><a href="#ç¬¬äºŒæ­¥ï¼šå®‰è£…-keepalived" class="headerlink" title="ç¬¬äºŒæ­¥ï¼šå®‰è£… keepalived"></a>ç¬¬äºŒæ­¥ï¼šå®‰è£… keepalived</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@localhost ~]# yum install keepalived â€“y</span><br><span class="line">......</span><br><span class="line">[root@centos7-slaver ~]# ls /etc|grep keepalived</span><br><span class="line">keepalived</span><br></pre></td></tr></table></figure>

<p>å®‰è£…å®Œæˆåä¼šåœ¨ &#x2F;etc ç›®å½•ä¸‹ç”Ÿæˆ keepalived ç›®å½•</p>
<h3 id="ç¬¬ä¸‰æ­¥ï¼šé…ç½®-keepalived-conf"><a href="#ç¬¬ä¸‰æ­¥ï¼šé…ç½®-keepalived-conf" class="headerlink" title="ç¬¬ä¸‰æ­¥ï¼šé…ç½® keepalived.conf"></a>ç¬¬ä¸‰æ­¥ï¼šé…ç½® keepalived.conf</h3><p>â€‹		å¤‡ä»½ &#x2F;etc&#x2F;keepalived&#x2F;keepalivec.conf é…ç½®æ–‡ä»¶ï¼Œä½¿ç”¨ä¸‹é¢çš„æ–‡ä»¶æ›¿æ¢</p>
<p>â€‹	æ³¨æ„ï¼š</p>
<blockquote>
<ol>
<li><p>è™šæ‹ŸIPåœ°å€ virtual_ipaddress éœ€è¦å’Œä¸»æœºåœ¨åŒä¸€ç½‘æ®µã€‚</p>
<pre><code>               2. global_defs ä¸­ smtp_server ä¸ºä¸»æœºåœ°å€ 192.168.100.100
               3. æ£€æµ‹è„šæœ¬çš„ä½ç½®ï¼šscript &quot;/usr/local/src/nginx_check.sh&quot;
               4. ä»æœºåªéœ€è¦ä¿®æ”¹ state BACKUP
</code></pre>
</li>
</ol>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">global_defs &#123;</span><br><span class="line">	notification_email &#123;</span><br><span class="line">		acassen@firewall.loc</span><br><span class="line">		failover@firewall.loc</span><br><span class="line">		sysadmin@firewall.loc</span><br><span class="line">	&#125;</span><br><span class="line">	notification_email_from Alexandre.Cassen@firewall.loc</span><br><span class="line">	smtp_server 192.168.100.100</span><br><span class="line">	smtp_connect_timeout 30</span><br><span class="line">	router_id LVS_DEVEL</span><br><span class="line">&#125;</span><br><span class="line">vrrp_script chk_http_port &#123;</span><br><span class="line">	script &quot;/usr/local/src/nginx_check.sh&quot;</span><br><span class="line">	interval 2 #ï¼ˆæ£€æµ‹è„šæœ¬æ‰§è¡Œçš„é—´éš”ï¼‰</span><br><span class="line">	weight 2</span><br><span class="line">&#125;</span><br><span class="line">vrrp_instance VI_1 &#123;</span><br><span class="line">	state MASTER # å¤‡ä»½æœåŠ¡å™¨ä¸Šå°† MASTER æ”¹ä¸º BACKUP</span><br><span class="line">	interface ens33 # ç½‘å¡</span><br><span class="line">	virtual_router_id 51 # ä¸»ã€å¤‡æœºçš„ virtual_router_id å¿…é¡»ç›¸åŒ</span><br><span class="line">	priority 90 # ä¸»ã€å¤‡æœºå–ä¸åŒçš„ä¼˜å…ˆçº§ï¼Œä¸»æœºå€¼è¾ƒå¤§ï¼Œå¤‡ä»½æœºå€¼è¾ƒå°</span><br><span class="line">	advert_int 1</span><br><span class="line">	authentication &#123;</span><br><span class="line">		auth_type PASS</span><br><span class="line">		auth_pass 1111</span><br><span class="line">	&#125;</span><br><span class="line">	virtual_ipaddress &#123;</span><br><span class="line">		192.168.100.50 # VRRP H è™šæ‹Ÿåœ°å€</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="ç¬¬å››æ­¥ï¼šæ–°å»ºæ£€æµ‹è„šæœ¬-nginx-check-sh"><a href="#ç¬¬å››æ­¥ï¼šæ–°å»ºæ£€æµ‹è„šæœ¬-nginx-check-sh" class="headerlink" title="ç¬¬å››æ­¥ï¼šæ–°å»ºæ£€æµ‹è„šæœ¬ nginx_check.sh"></a>ç¬¬å››æ­¥ï¼šæ–°å»ºæ£€æµ‹è„šæœ¬ nginx_check.sh</h3><p>â€‹		åœ¨ &#x2F;usr&#x2F;local&#x2F;src ä¸‹åˆ›å»ºæ£€æµ‹è„šæœ¬ nginx_check.sh</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/bin/bash</span></span><br><span class="line">A=`ps -C nginx --no-header |wc -l`</span><br><span class="line">if [ $A -eq 0 ];then</span><br><span class="line">        /usr/local/nginx/sbin/nginx</span><br><span class="line">        sleep 2</span><br><span class="line">        if [ `ps -C nginx --no-header |wc -l` -eq 0 ];then</span><br><span class="line">                killall keepalived</span><br><span class="line">        fi</span><br><span class="line">fi</span><br></pre></td></tr></table></figure>

<h3 id="ç¬¬äº”æ­¥ï¼šå¯åŠ¨-nginx-å’Œ-keepalived"><a href="#ç¬¬äº”æ­¥ï¼šå¯åŠ¨-nginx-å’Œ-keepalived" class="headerlink" title="ç¬¬äº”æ­¥ï¼šå¯åŠ¨ nginx å’Œ keepalived"></a>ç¬¬äº”æ­¥ï¼šå¯åŠ¨ nginx å’Œ keepalived</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@localhost keepalived]# nginx</span><br><span class="line">[root@localhost keepalived]# systemctl start keepalived.service</span><br></pre></td></tr></table></figure>

<p>æŸ¥çœ‹ç»‘å®šåˆ°ens33çš„è™šæ‹ŸIPï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@localhost keepalived]# ip a</span><br><span class="line">1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000</span><br><span class="line">    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00</span><br><span class="line">    inet 127.0.0.1/8 scope host lo</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">    inet6 ::1/128 scope host</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">2: ens33: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UP group default qlen 1000</span><br><span class="line">    link/ether 00:50:56:3b:fb:0d brd ff:ff:ff:ff:ff:ff</span><br><span class="line">    inet 192.168.100.100/24 brd 192.168.100.255 scope global ens33</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">       # ======192.168.100.50ç»‘å®šåœ¨ens33ä¸Šé¢=======</span><br><span class="line">    inet 192.168.100.50/32 scope global ens33</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">    inet6 fe80::250:56ff:fe3b:fb0d/64 scope link</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">3: virbr0: &lt;NO-CARRIER,BROADCAST,MULTICAST,UP&gt; mtu 1500 qdisc noqueue state DOWN group default qlen 1000</span><br><span class="line">    link/ether 52:54:00:16:52:0a brd ff:ff:ff:ff:ff:ff</span><br><span class="line">    inet 192.168.122.1/24 brd 192.168.122.255 scope global virbr0</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">4: virbr0-nic: &lt;BROADCAST,MULTICAST&gt; mtu 1500 qdisc pfifo_fast master virbr0 state DOWN group default qlen 1000</span><br><span class="line">    link/ether 52:54:00:16:52:0a brd ff:ff:ff:ff:ff:ff</span><br><span class="line">[root@localhost keepalived]#</span><br></pre></td></tr></table></figure>

<h3 id="ç¬¬å…­æ­¥ï¼šæµ‹è¯•"><a href="#ç¬¬å…­æ­¥ï¼šæµ‹è¯•" class="headerlink" title="ç¬¬å…­æ­¥ï¼šæµ‹è¯•"></a>ç¬¬å…­æ­¥ï¼šæµ‹è¯•</h3><p>â€‹		åœ¨æµè§ˆå™¨åœ°å€æ è¾“å…¥è™šæ‹ŸIPï¼š192.168.100.50</p>
<p>â€‹		åœæ­¢192.168.100.100çš„nginxï¼Œé¡µé¢ä¾ç„¶èƒ½å¤Ÿè®¿é—®</p>
<h2 id="nginx-åŸç†ä¸ä¼˜åŒ–å‚æ•°é…ç½®"><a href="#nginx-åŸç†ä¸ä¼˜åŒ–å‚æ•°é…ç½®" class="headerlink" title="nginx åŸç†ä¸ä¼˜åŒ–å‚æ•°é…ç½®"></a>nginx åŸç†ä¸ä¼˜åŒ–å‚æ•°é…ç½®</h2><h3 id="åŸç†"><a href="#åŸç†" class="headerlink" title="åŸç†"></a>åŸç†</h3><p><img src="/2023/02/28/Nginx/Java\Document\Nginx\Nginx.assets\image-20220426101753602.png" alt="image-master-worker"></p>
<p><img src="/2023/02/28/Nginx/Java\Document\Nginx\Nginx.assets\image-20220426101823774.png" alt="image-nginxäº‰æŠ¢æœºåˆ¶"></p>
<p>master-workers çš„æœºåˆ¶çš„å¥½å¤„</p>
<p>â€‹		é¦–å…ˆï¼Œå¯¹äºæ¯ä¸ª worker è¿›ç¨‹æ¥è¯´ï¼Œç‹¬ç«‹çš„è¿›ç¨‹ï¼Œä¸éœ€è¦åŠ é”ï¼Œæ‰€ä»¥çœæ‰äº†é”å¸¦æ¥çš„å¼€é”€ï¼Œ åŒæ—¶åœ¨ç¼–ç¨‹ä»¥åŠé—®é¢˜æŸ¥æ‰¾æ—¶ï¼Œä¹Ÿä¼šæ–¹ä¾¿å¾ˆå¤šã€‚</p>
<p>â€‹		å…¶æ¬¡ï¼Œé‡‡ç”¨ç‹¬ç«‹çš„è¿›ç¨‹ï¼Œå¯ä»¥è®©äº’ç›¸ä¹‹é—´ä¸ä¼š å½±å“ï¼Œä¸€ä¸ªè¿›ç¨‹é€€å‡ºåï¼Œå…¶å®ƒè¿›ç¨‹è¿˜åœ¨å·¥ä½œï¼ŒæœåŠ¡ä¸ä¼šä¸­æ–­ï¼Œmaster è¿›ç¨‹åˆ™å¾ˆå¿«å¯åŠ¨æ–°çš„ worker è¿›ç¨‹ã€‚å½“ç„¶ï¼Œworker è¿›ç¨‹çš„å¼‚å¸¸é€€å‡ºï¼Œè‚¯å®šæ˜¯ç¨‹åºæœ‰ bug äº†ï¼Œå¼‚å¸¸é€€å‡ºï¼Œä¼šå¯¼è‡´å½“å‰ worker ä¸Šçš„æ‰€æœ‰è¯·æ±‚å¤±è´¥ï¼Œä¸è¿‡ä¸ä¼šå½±å“åˆ°æ‰€æœ‰è¯·æ±‚ï¼Œæ‰€ä»¥é™ä½äº†é£é™©ã€‚</p>
<p>éœ€è¦è®¾ç½®å¤šå°‘ä¸ª worker</p>
<p>â€‹		<strong>Nginx åŒ redis ç±»ä¼¼éƒ½é‡‡ç”¨äº† io å¤šè·¯å¤ç”¨æœºåˆ¶</strong>ã€Linuxæ”¯æŒIOå¤šè·¯å¤ç”¨ï¼Œwindowæ— æ³•å‘æŒ¥IOå¤šè·¯å¤ç”¨çš„åŠŸèƒ½ã€‘ï¼Œæ¯ä¸ª worker éƒ½æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„è¿›ç¨‹ï¼Œä½†æ¯ä¸ªè¿› ç¨‹é‡Œåªæœ‰ä¸€ä¸ªä¸»çº¿ç¨‹ï¼Œé€šè¿‡å¼‚æ­¥éé˜»å¡çš„æ–¹å¼æ¥å¤„ç†è¯·æ±‚ï¼Œ å³ä½¿æ˜¯åƒä¸Šä¸‡ä¸ªè¯·æ±‚ä¹Ÿä¸åœ¨è¯ ä¸‹ã€‚æ¯ä¸ª worker çš„çº¿ç¨‹å¯ä»¥æŠŠä¸€ä¸ª cpu çš„æ€§èƒ½å‘æŒ¥åˆ°æè‡´ã€‚æ‰€ä»¥ worker æ•°å’ŒæœåŠ¡å™¨çš„ cpu æ•°ç›¸ç­‰æ˜¯æœ€ä¸ºé€‚å®œçš„ã€‚è®¾å°‘äº†ä¼šæµªè´¹ cpuï¼Œè®¾å¤šäº†ä¼šé€ æˆ cpu é¢‘ç¹åˆ‡æ¢ä¸Šä¸‹æ–‡å¸¦æ¥çš„æŸè€—ã€‚</p>
<p>è®¾ç½® worker æ•°é‡</p>
<p>â€‹		worker_processes 4 #work ç»‘å®š cpu(4 work ç»‘å®š 4cpu)ã€‚ worker_cpu_affinity 0001 0010 0100 1000 #work ç»‘å®š cpu (4 work ç»‘å®š 8cpu ä¸­çš„ 4 ä¸ª) ã€‚ worker_cpu_affinity 0000001 00000010 00000100 00001000</p>
<p>è¿æ¥æ•° worker_connection </p>
<p>â€‹		è¿™ä¸ªå€¼æ˜¯è¡¨ç¤ºæ¯ä¸ª worker è¿›ç¨‹æ‰€èƒ½å»ºç«‹è¿æ¥çš„æœ€å¤§å€¼ï¼Œæ‰€ä»¥ï¼Œä¸€ä¸ª nginx èƒ½å»ºç«‹çš„æœ€å¤§è¿æ¥ æ•°ï¼Œåº”è¯¥æ˜¯ worker_connections * worker_processesã€‚å½“ç„¶ï¼Œè¿™é‡Œè¯´çš„æ˜¯æœ€å¤§è¿æ¥æ•°ï¼Œå¯¹äº HTTP è¯· æ±‚ æœ¬ åœ° èµ„ æº æ¥ è¯´ ï¼Œ èƒ½ å¤Ÿ æ”¯ æŒ çš„ æœ€ å¤§ å¹¶ å‘ æ•° é‡ æ˜¯ worker_connections * worker_processesï¼Œå¦‚æœæ˜¯æ”¯æŒ http1.1 çš„æµè§ˆå™¨æ¯æ¬¡è®¿é—®è¦å ä¸¤ä¸ªè¿æ¥ï¼Œæ‰€ä»¥æ™®é€šçš„é™æ€è®¿ é—®æœ€å¤§å¹¶å‘æ•°æ˜¯ï¼š worker_connections * worker_processes &#x2F;2ï¼Œè€Œå¦‚æœæ˜¯ HTTP ä½œ ä¸ºåå‘ä»£ ç†æ¥è¯´ï¼Œæœ€å¤§å¹¶å‘æ•°é‡åº”è¯¥æ˜¯ worker_connections * worker_processes&#x2F;4ã€‚å› ä¸ºä½œä¸ºåå‘ä»£ç†æœåŠ¡å™¨ï¼Œæ¯ä¸ªå¹¶å‘ä¼šå»ºç«‹ä¸å®¢æˆ·ç«¯çš„è¿æ¥å’Œä¸åç«¯æœ åŠ¡çš„è¿æ¥ï¼Œä¼šå ç”¨ä¸¤ä¸ªè¿æ¥ã€‚</p>
<p><img src="/2023/02/28/Nginx/Java\Document\Nginx\Nginx.assets\image-20220426102041889.png" alt="image-nginx.confç»“æ„"></p>
]]></content>
  </entry>
  <entry>
    <title>Oracle</title>
    <url>/2023/02/27/Oracle/</url>
    <content><![CDATA[]]></content>
  </entry>
  <entry>
    <title>Netty</title>
    <url>/2023/02/28/Netty/</url>
    <content><![CDATA[<h1 id="Netty-åŸºæœ¬ä»‹ç»"><a href="#Netty-åŸºæœ¬ä»‹ç»" class="headerlink" title="Netty åŸºæœ¬ä»‹ç»"></a>Netty åŸºæœ¬ä»‹ç»</h1><p>å®˜ç½‘åœ°å€ï¼š<a href="https://netty.io/">https://netty.io/</a></p>
<p>GitHubåœ°å€ï¼š<a href="https://github.com/netty">https://github.com/netty</a></p>
<blockquote>
<p>Netty is <em>an asynchronous event-driven network application framework</em><br>for rapid development of maintainable high performance protocol servers &amp; clients.</p>
<img src="/2023/02/28/Netty/Java\Document\Netty\Netty å‚çœ‹æ–‡æ¡£.assets\components.png" alt="components" style="zoom:100%;">
</blockquote>
<ol>
<li>Netty æ˜¯ä¸€ä¸ªå¼‚æ­¥çš„ã€åŸºäºäº‹ä»¶é©±åŠ¨çš„ç½‘ç»œåº”ç”¨æ¡†æ¶ï¼Œç”¨ä»¥å¿«é€Ÿå¼€å‘é«˜æ€§èƒ½ã€é«˜å¯é æ€§çš„ç½‘ç»œIOç¨‹åºã€‚</li>
<li>Netty æ˜¯ç”± JBOSS æä¾›çš„ä¸€ä¸ª Java å¼€æºæ¡†æ¶ï¼Œç°ä¸º Github ä¸Šçš„ç‹¬ç«‹é¡¹ç›®ã€‚</li>
<li>Netty ä¸»è¦é’ˆå¯¹åœ¨ TCP åè®®ä¸‹ï¼Œé¢å‘ Clients ç«¯çš„é«˜å¹¶å‘åº”ç”¨ï¼Œæˆ–è€… Peer-to-Peer åœºæ™¯ä¸‹çš„å¤§é‡æ•°æ®æŒç»­ä¼ è¾“çš„åº”ç”¨ã€‚</li>
<li>Netty æœ¬è´¨æ˜¯ä¸€ä¸ª NIO æ¡†æ¶ï¼Œé€‚ç”¨äºæœåŠ¡å™¨é€šè®¯ç›¸å…³çš„å¤šç§åº”ç”¨åœºæ™¯</li>
</ol>
<p>åº”ç”¨åœºæ™¯ï¼š</p>
<ol>
<li><p>å¼‚æ­¥é«˜æ€§èƒ½çš„é€šä¿¡æ¡†æ¶ï¼Œå¦‚åˆ†å¸ƒå¼ç³»ç»Ÿä¸­çš„ RPC æ¡†æ¶</p>
</li>
<li><p>ç§æœ‰åè®®çš„å®šåˆ¶å¼€å‘</p>
</li>
<li><p>ç½‘ç»œæ¸¸æˆï¼Œåœ°å›¾å¼€å‘ç­‰</p>
</li>
<li><p>å¤§æ•°æ®é¢†åŸŸï¼š</p>
<p> â€‹	ç»å…¸çš„ Hadoop çš„é«˜æ€§èƒ½é€šä¿¡å’Œåºåˆ—åŒ–ç»„ä»¶ Avro çš„ RPC æ¡†æ¶ï¼Œé»˜è®¤é‡‡ç”¨ Netty è¿›è¡Œè·¨ç•Œç‚¹é€šä¿¡ã€‚</p>
<p> â€‹	å®ƒçš„ Netty Service åŸºäº Netty æ¡†æ¶äºŒæ¬¡å°è£…å®ç°ã€‚</p>
</li>
</ol>
<p>	</p>
<p>å‚è€ƒä¹¦ç±ï¼š</p>
<ol>
<li>Netty In Action</li>
<li>Netty æƒå¨æŒ‡å—ï¼ˆåŸºäºNettyï¼‰</li>
</ol>
<h1 id="IO-æ¨¡å‹"><a href="#IO-æ¨¡å‹" class="headerlink" title="IO æ¨¡å‹"></a>IO æ¨¡å‹</h1><p>Java å…±æ”¯æŒ 3 ç§ç½‘ç»œç¼–ç¨‹æ¨¡å‹&#x2F;IO æ¨¡å¼ï¼šBIOã€NIOã€AIO</p>
<h2 id="Java-BIO"><a href="#Java-BIO" class="headerlink" title="Java BIO"></a>Java BIO</h2><p>â€‹		åŒæ­¥é˜»å¡å‹ï¼ˆBlocking IOï¼‰ï¼ŒæœåŠ¡å™¨å®ç°æ¨¡å¼ä¸ºä¸€ä¸ªè¿æ¥ä¸€ä¸ªçº¿ç¨‹ï¼Œå³å®¢æˆ·ç«¯æœ‰è¿æ¥è¯·æ±‚æ—¶æœåŠ¡å™¨ç«¯å°±éœ€è¦å¯åŠ¨ä¸€ä¸ªçº¿ç¨‹è¿›è¡Œå¤„ç†ï¼Œå¦‚æœè¿™ä¸ªè¿æ¥ä¸åšä»»ä½•äº‹æƒ…ä¼šé€ æˆä¸å¿…è¦çš„çº¿ç¨‹å¼€é”€ã€‚</p>
<p>â€‹	é€‚ç”¨äºè¿æ¥æ•°ç›®æ¯”è¾ƒå°ä¸”å›ºå®šçš„æ¶æ„ï¼Œè¿™ç§æ–¹å¼å¯¹æœåŠ¡å™¨èµ„æºè¦æ±‚æ¯”è¾ƒé«˜ï¼Œå¹¶å‘å±€é™äºåº”ç”¨ä¸­ï¼ŒJDK1.4ä»¥å‰çš„å”¯ä¸€é€‰æ‹©ã€‚</p>
<h2 id="Java-NIO"><a href="#Java-NIO" class="headerlink" title="Java NIO"></a>Java NIO</h2><p>â€‹		åŒæ­¥éé˜»å¡ï¼ŒæœåŠ¡å™¨å®ç°æ¨¡å¼ä¸ºä¸€ä¸ªçº¿ç¨‹å¤„ç†å¤šä¸ªè¯·æ±‚ï¼Œå³å®¢æˆ·ç«¯å‘é€çš„è¿æ¥è¯·æ±‚éƒ½ä¼šæ³¨å†Œåˆ°å¤šè·¯å¤ç”¨å™¨ä¸Šï¼Œå¤šè·¯å¤ç”¨å™¨è½®è¯¢åˆ°è¿æ¥æœ‰ I&#x2F;O è¯·æ±‚å°±è¿›è¡Œå¤„ç†ã€‚</p>
<p>â€‹		é€‚ç”¨äºç”¨äºè¿æ¥æ•°ç›®å¤šä¸”è¿æ¥æ¯”è¾ƒçŸ­ï¼ˆè½»æ“ä½œï¼‰çš„æ¶æ„ï¼Œæ¯”å¦‚èŠå¤©æœåŠ¡å™¨ï¼Œå¼¹å¹•ç³»ç»Ÿï¼ŒæœåŠ¡å™¨é—´é€šè®¯ç­‰ï¼ŒJDK1.4 å¼€å§‹æ”¯æŒã€‚</p>
<h2 id="Java-AIO-NIO-2"><a href="#Java-AIO-NIO-2" class="headerlink" title="Java AIO(NIO.2)"></a>Java AIO(NIO.2)</h2><p>â€‹		å¼‚æ­¥éé˜»å¡ï¼ŒAIO å¼•å…¥å¼‚æ­¥é€šé“çš„æ¦‚å¿µï¼Œé‡‡ç”¨äº† Proactor æ¨¡å¼ï¼Œç®€åŒ–äº†ç¨‹åºç¼–å†™ï¼Œæœ‰æ•ˆçš„è¯·æ±‚æ‰å¯åŠ¨çº¿ç¨‹ï¼Œå®ƒçš„ç‰¹ç‚¹æ˜¯å…ˆç”±æ“ä½œç³»ç»Ÿå®Œæˆåæ‰é€šçŸ¥æœåŠ¡ç«¯ç¨‹åºå¯åŠ¨çº¿ç¨‹å»å¤„ç†ï¼Œä¸€èˆ¬é€‚ç”¨äºè¿æ¥æ•°è¾ƒå¤šä¸”è¿æ¥æ—¶é—´è¾ƒé•¿çš„åº”ç”¨ã€‚</p>
<p>â€‹		é€‚ç”¨äºè¿æ¥æ•°ç›®å¤šä¸”è¿æ¥æ¯”è¾ƒé•¿ï¼ˆé‡æ“ä½œï¼‰çš„æ¶æ„ï¼Œæ¯”å¦‚ç›¸å†ŒæœåŠ¡å™¨ï¼Œå……åˆ†è°ƒç”¨OS å‚ä¸å¹¶å‘æ“ä½œï¼Œç¼–ç¨‹æ¯”è¾ƒå¤æ‚ï¼ŒJDK7 å¼€å§‹æ”¯æŒã€‚</p>
<h1 id="BIO-ç¼–ç¨‹"><a href="#BIO-ç¼–ç¨‹" class="headerlink" title="BIO ç¼–ç¨‹"></a>BIO ç¼–ç¨‹</h1><h2 id="åŸºæœ¬ä»‹ç»"><a href="#åŸºæœ¬ä»‹ç»" class="headerlink" title="åŸºæœ¬ä»‹ç»"></a>åŸºæœ¬ä»‹ç»</h2><ol>
<li><p>Java BIO å°±æ˜¯ä¼ ç»Ÿçš„ java io ç¼–ç¨‹ï¼Œå…¶ç›¸å…³çš„ç±»å’Œæ¥å£åœ¨ java.ioã€‚</p>
</li>
<li><p>åŒæ­¥é˜»å¡IOï¼ŒæœåŠ¡å™¨å®ç°æ¨¡å¼ä¸ºä¸€ä¸ªè¿æ¥å¯¹åº”ä¸€ä¸ªçº¿ç¨‹ï¼Œå³å®¢æˆ·ç«¯æœ‰è¿æ¥è¯·æ±‚æ—¶æœåŠ¡å™¨ç«¯å°±ä¼šå¯åŠ¨ä¸€ä¸ªçº¿ç¨‹è¿›è¡Œå¤„ç†ï¼Œå¦‚æœè¿™ä¸ªè¿æ¥ä¸åšä»»ä½•äº‹æƒ…ä¼šé€ æˆä¸å¿…è¦çš„çº¿ç¨‹å¼€é”€ï¼Œå¯ä»¥é€šè¿‡çº¿ç¨‹æ± æœºåˆ¶æ”¹å–„ï¼ˆå®ç°å¤šä¸ªå®¢æˆ·è¿æ¥æœåŠ¡å™¨ï¼‰ã€‚</p>
</li>
<li><p>é€‚ç”¨äºè¿æ¥æ•°ç›®æ¯”è¾ƒå°ä¸”å›ºå®šçš„æ¶æ„ï¼Œè¿™ç§æ–¹å¼å¯¹æœåŠ¡å™¨èµ„æºè¦æ±‚æ¯”è¾ƒé«˜ï¼Œå¹¶å‘å±€é™äºåº”ç”¨ä¸­ã€‚</p>
</li>
</ol>
<h2 id="åŸç†è¯´æ˜"><a href="#åŸç†è¯´æ˜" class="headerlink" title="åŸç†è¯´æ˜"></a>åŸç†è¯´æ˜</h2><p>â€‹		æœåŠ¡å™¨å¯åŠ¨ä¸€ä¸ª ServerSocket è¿›è¡Œç«¯å£ç›‘å¬ï¼Œå®¢æˆ·ç«¯å¯åŠ¨ä¸€ä¸ª Socket ä¸æœåŠ¡å™¨è¿›è¡Œé€šä¿¡ï¼Œè¿æ¥å»ºç«‹åï¼Œå¦‚æœæœåŠ¡å™¨æœ‰ç©ºé—²çº¿ç¨‹å»ºç«‹ï¼Œå°±ä¼šæ–°å»ºçº¿ç¨‹å¤„ç†å®¢æˆ·ç«¯çš„è¯·æ±‚ã€‚</p>
<p>ç¨‹åºé˜»å¡çš„ä½ç½®ï¼š</p>
<h2 id="åº”ç”¨ç¤ºä¾‹"><a href="#åº”ç”¨ç¤ºä¾‹" class="headerlink" title="åº”ç”¨ç¤ºä¾‹"></a>åº”ç”¨ç¤ºä¾‹</h2><p>ç¨‹åºï¼šç›‘å¬6000ç«¯å£ï¼Œå¯ä»¥è¿æ¥å¤šä¸ªå®¢æˆ·ç«¯ï¼Œå®¢æˆ·ç«¯è¯·æ±‚ä½¿ç”¨ telnet ä¸ä¹‹é€šä¿¡ã€‚</p>
<blockquote>
<p>telnetå‘½ä»¤ï¼štelnetï¼štelnet 127.0.0.1 6000</p>
<p>ä½¿ç”¨ CTRL + [ï¼Œè¾“å…¥ send  [æ¶ˆæ¯]</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.mineting.bio;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.InputStream;</span><br><span class="line"><span class="keyword">import</span> java.net.ServerSocket;</span><br><span class="line"><span class="keyword">import</span> java.net.Socket;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.ExecutorService;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.Executors;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * BIOServerï¼šç›‘å¬6000ç«¯å£ï¼Œå¯ä»¥è¿æ¥å¤šä¸ªå®¢æˆ·ç«¯ï¼Œå®¢æˆ·ç«¯è¯·æ±‚ä½¿ç”¨ telnet ä¸ä¹‹é€šä¿¡ã€‚</span></span><br><span class="line"><span class="comment"> * é˜»å¡ä»£ç ï¼š</span></span><br><span class="line"><span class="comment"> * 1. accept()  è¿æ¥é˜»å¡</span></span><br><span class="line"><span class="comment"> * 2. read()/write()    è¯»å†™æ•°æ®é˜»å¡</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BIOServer</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">ExecutorService</span> <span class="variable">threadPool</span> <span class="operator">=</span> Executors.newCachedThreadPool();</span><br><span class="line">        <span class="type">ServerSocket</span> <span class="variable">serverSocket</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ServerSocket</span>(<span class="number">6000</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;BIOServer start...&quot;</span>);</span><br><span class="line">        <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;Waiting Clients Connect...&quot;</span>);</span><br><span class="line">            <span class="type">Socket</span> <span class="variable">socket</span> <span class="operator">=</span> serverSocket.accept();</span><br><span class="line">            System.out.println(<span class="string">&quot;Clients Connect...&quot;</span>);</span><br><span class="line">            threadPool.execute(() -&gt; &#123;</span><br><span class="line">                handler(socket);</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">handler</span><span class="params">(Socket socket)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Thread Id: &quot;</span> + Thread.currentThread().getId() + <span class="string">&quot;, ThreadName: &quot;</span> + Thread.currentThread().getName());</span><br><span class="line">        <span class="type">byte</span>[] bytes = <span class="keyword">new</span> <span class="title class_">byte</span>[<span class="number">1024</span>];</span><br><span class="line">        <span class="type">int</span> <span class="variable">read</span> <span class="operator">=</span> -<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">InputStream</span> <span class="variable">in</span> <span class="operator">=</span> socket.getInputStream();</span><br><span class="line">            <span class="comment">//while ((read = in.read(bytes)) != -1) &#123;&#125;</span></span><br><span class="line">            <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;handler will read...&quot;</span>);</span><br><span class="line">                read = in.read(bytes);</span><br><span class="line">                <span class="keyword">if</span> (read != -<span class="number">1</span>) &#123;</span><br><span class="line">                    System.out.println(<span class="keyword">new</span> <span class="title class_">String</span>(bytes, <span class="number">0</span>, read));</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                socket.close();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="å­˜åœ¨é—®é¢˜"><a href="#å­˜åœ¨é—®é¢˜" class="headerlink" title="å­˜åœ¨é—®é¢˜"></a>å­˜åœ¨é—®é¢˜</h2><ol>
<li>æ¯ä¸ªè¯·æ±‚éƒ½éœ€è¦åˆ›å»ºç‹¬ç«‹çš„çº¿ç¨‹ï¼Œä¸å¯¹åº”çš„å®¢æˆ·ç«¯è¿›è¡Œæ•°æ® Readï¼Œä¸šåŠ¡å¤„ç†ï¼Œæ•°æ®Write ã€‚</li>
<li>å½“å¹¶å‘æ•°è¾ƒå¤§æ—¶ï¼Œéœ€è¦åˆ›å»ºå¤§é‡çº¿ç¨‹æ¥å¤„ç†è¿æ¥ï¼Œç³»ç»Ÿèµ„æºå ç”¨è¾ƒå¤§ã€‚</li>
<li>è¿æ¥å»ºç«‹åï¼Œå¦‚æœå½“å‰çº¿ç¨‹æš‚æ—¶æ²¡æœ‰æ•°æ®å¯è¯»ï¼Œåˆ™çº¿ç¨‹å°±é˜»å¡åœ¨ Read æ“ä½œä¸Šï¼Œé€ æˆçº¿ç¨‹èµ„æºæµªè´¹ã€‚</li>
</ol>
<h1 id="NIOç¼–ç¨‹"><a href="#NIOç¼–ç¨‹" class="headerlink" title="NIOç¼–ç¨‹"></a>NIOç¼–ç¨‹</h1><h2 id="åŸºæœ¬ä»‹ç»-1"><a href="#åŸºæœ¬ä»‹ç»-1" class="headerlink" title="åŸºæœ¬ä»‹ç»"></a>åŸºæœ¬ä»‹ç»</h2><ol>
<li><p>Java NIO å…¨ç§° java non-blocking IOï¼Œæ˜¯æŒ‡ JDK æä¾›çš„æ–° APIã€‚ä» JDK1.4 å¼€å§‹ï¼ŒJava æä¾›äº†ä¸€ç³»åˆ—æ”¹è¿›çš„è¾“å…¥&#x2F;è¾“å‡ºçš„æ–°ç‰¹æ€§ï¼Œè¢«ç»Ÿç§°ä¸º NIOï¼ˆå³ New IOï¼‰ï¼Œæ˜¯åŒæ­¥éé˜»å¡çš„ï¼ŒNIO ç›¸å…³ç±»éƒ½è¢«æ”¾åœ¨ java.nio åŒ…åŠå­åŒ…ä¸‹ã€‚</p>
</li>
<li><p>NIO æœ‰ä¸‰å¤§æ ¸å¿ƒéƒ¨åˆ†ï¼šChannelï¼ˆé€šé“ï¼‰ï¼ŒBufferï¼ˆç¼“å†²åŒº)ï¼‰, Selectorï¼ˆé€‰æ‹©å™¨ï¼‰</p>
</li>
<li><p>NIO æ˜¯ é¢å‘ç¼“å†²åŒº ï¼Œæˆ–è€…é¢å‘ å— ç¼–ç¨‹çš„ã€‚æ•°æ®è¯»å–åˆ°ä¸€ä¸ªå®ƒç¨åå¤„ç†çš„ç¼“å†²åŒºï¼Œéœ€è¦æ—¶å¯åœ¨ç¼“å†²åŒºä¸­å‰åç§»åŠ¨ï¼Œè¿™å°±å¢åŠ äº†å¤„ç†è¿‡ç¨‹ä¸­çš„çµæ´»æ€§ï¼Œä½¿ç”¨å®ƒå¯ä»¥æä¾›éé˜»å¡å¼çš„é«˜ä¼¸ç¼©æ€§ç½‘ç»œã€‚</p>
</li>
<li><p>Java NIO çš„éé˜»å¡æ¨¡å¼ï¼Œä½¿ä¸€ä¸ªçº¿ç¨‹ä»æŸé€šé“å‘é€è¯·æ±‚æˆ–è€…è¯»å–æ•°æ®ï¼Œä½†æ˜¯å®ƒä»…èƒ½å¾—åˆ°ç›®å‰å¯ç”¨çš„æ•°æ®ï¼Œå¦‚æœç›®å‰æ²¡æœ‰æ•°æ®å¯ç”¨æ—¶ï¼Œå°±ä»€ä¹ˆéƒ½ä¸ä¼šè·å–ï¼Œè€Œä¸æ˜¯ä¿æŒçº¿ç¨‹é˜»å¡ï¼Œæ‰€ä»¥ç›´è‡³æ•°æ®å˜çš„å¯ä»¥è¯»å–ä¹‹å‰ï¼Œè¯¥çº¿ç¨‹å¯ä»¥ç»§ç»­åšå…¶ä»–çš„äº‹æƒ…ã€‚ éé˜»å¡å†™ä¹Ÿæ˜¯å¦‚æ­¤ï¼Œä¸€ä¸ªçº¿ç¨‹è¯·æ±‚å†™å…¥ä¸€äº›æ•°æ®åˆ°æŸé€šé“ï¼Œä½†ä¸éœ€è¦ç­‰å¾…å®ƒå®Œå…¨å†™å…¥ï¼Œè¿™ä¸ªçº¿ç¨‹åŒæ—¶å¯ä»¥å»åšåˆ«çš„äº‹æƒ…ã€‚</p>
</li>
<li><p>é€šä¿—ç†è§£ï¼šNIO æ˜¯å¯ä»¥åšåˆ°ç”¨ä¸€ä¸ªçº¿ç¨‹æ¥å¤„ç†å¤šä¸ªæ“ä½œçš„ã€‚å‡è®¾æœ‰ 10000 ä¸ªè¯·æ±‚è¿‡æ¥,æ ¹æ®å®é™…æƒ…å†µï¼Œå¯ä»¥åˆ†é…50 æˆ–è€… 100 ä¸ªçº¿ç¨‹æ¥å¤„ç†ã€‚ä¸åƒä¹‹å‰çš„é˜»å¡ IO é‚£æ ·ï¼Œéå¾—åˆ†é… 10000 ä¸ªã€‚</p>
</li>
</ol>
<h2 id="NIO-ä¸‰å¤§ç»„ä»¶è¯´æ˜"><a href="#NIO-ä¸‰å¤§ç»„ä»¶è¯´æ˜" class="headerlink" title="NIO ä¸‰å¤§ç»„ä»¶è¯´æ˜"></a>NIO ä¸‰å¤§ç»„ä»¶è¯´æ˜</h2><ol>
<li>æ¯ä¸ª Selector å¯¹åº”ä¸€ä¸ªçº¿ç¨‹ï¼Œæ¯ä¸ªçº¿ç¨‹å¯¹åº”ä¸€ä¸ª Channel ï¼Œæ¯ä¸ª Channel å¯¹åº”ä¸€ä¸ª Bufferã€‚</li>
<li>å¤šä¸ª Channel ä¼šæ³¨å†Œåˆ° Selector ä¸Šï¼ŒSelector æ ¹æ® Event ï¼Œåœ¨å„ä¸ª Channel ä¸Šè¿›è¡Œåˆ‡æ¢ã€‚</li>
<li>æ•°æ®çš„è¯»å†™é€šè¿‡ Buffer , Bufferæ˜¯åŒå‘çš„ï¼Œæ˜¯ä¸€ä¸ªå†…å­˜å—ï¼Œåº•å±‚æ˜¯æ•°ç»„ï¼Œä¸åŒäº BIO çš„è¾“å…¥è¾“å‡ºæµï¼ŒNIO çš„ Buffer å¯è¯»å¯å†™ï¼Œéœ€è¦ä½¿ç”¨ flip() æ–¹æ³•è½¬æ¢ã€‚</li>
</ol>
<h2 id="NIO-ä¸-BIO-çš„æ¯”è¾ƒ"><a href="#NIO-ä¸-BIO-çš„æ¯”è¾ƒ" class="headerlink" title="NIO ä¸ BIO çš„æ¯”è¾ƒ"></a>NIO ä¸ BIO çš„æ¯”è¾ƒ</h2><ol>
<li>BIO ä»¥æµçš„æ–¹å¼å¤„ç†æ•°æ®ï¼Œè€Œ NIO ä»¥å—çš„æ–¹å¼å¤„ç†æ•°æ®ï¼Œå— I&#x2F;O çš„æ•ˆç‡æ¯”æµ I&#x2F;O é«˜å¾ˆå¤šã€‚</li>
<li>BIO æ˜¯é˜»å¡çš„ï¼ŒNIO åˆ™æ˜¯éé˜»å¡çš„ã€‚</li>
<li>BIO åŸºäºå­—èŠ‚æµå’Œå­—ç¬¦æµè¿›è¡Œæ“ä½œï¼Œè€Œ NIO åŸºäº Channel(é€šé“)å’Œ Bufferï¼ˆç¼“å†²åŒºï¼‰è¿›è¡Œæ“ä½œï¼Œæ•°æ®æ€»æ˜¯ä»é€šé“è¯»å–åˆ°ç¼“å†²åŒºä¸­ï¼Œæˆ–è€…ä»ç¼“å†²åŒºå†™å…¥åˆ°é€šé“ä¸­ã€‚Selectorï¼ˆé€‰æ‹©å™¨ï¼‰ç”¨äºç›‘å¬å¤šä¸ªé€šé“çš„äº‹ä»¶ï¼ˆæ¯”å¦‚ï¼šè¿æ¥è¯·æ±‚ï¼Œæ•°æ®åˆ°è¾¾ç­‰ï¼‰ï¼Œå› æ­¤ä½¿ç”¨å•ä¸ªçº¿ç¨‹å°±å¯ä»¥ç›‘å¬å¤šä¸ªå®¢æˆ·ç«¯é€šé“ã€‚</li>
</ol>
<h2 id="ç¼“å†²åŒº-Buffer"><a href="#ç¼“å†²åŒº-Buffer" class="headerlink" title="ç¼“å†²åŒº Buffer"></a>ç¼“å†²åŒº Buffer</h2><h3 id="åŸºæœ¬ä»‹ç»-2"><a href="#åŸºæœ¬ä»‹ç»-2" class="headerlink" title="åŸºæœ¬ä»‹ç»"></a>åŸºæœ¬ä»‹ç»</h3><p>â€‹		ç¼“å†²åŒºï¼ˆBufferï¼‰ï¼šç¼“å†²åŒºæœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªå¯ä»¥è¯»å†™æ•°æ®çš„å†…å­˜å—ï¼Œå¯ä»¥ç†è§£æˆæ˜¯ä¸€ä¸ªå®¹å™¨å¯¹è±¡ï¼ˆå«æ•°ç»„ï¼‰ï¼Œè¯¥å¯¹è±¡æä¾›äº†ä¸€ç»„æ–¹æ³•ï¼Œå¯ä»¥æ›´è½»æ¾åœ°ä½¿ç”¨å†…å­˜å—ï¼Œç¼“å†²åŒºå¯¹è±¡å†…ç½®äº†ä¸€äº›æœºåˆ¶ï¼Œèƒ½å¤Ÿè·Ÿè¸ªå’Œè®°å½•ç¼“å†²åŒºçš„çŠ¶æ€å˜åŒ–æƒ…å†µã€‚Channel æä¾›ä»æ–‡ä»¶ã€ç½‘ç»œè¯»å–æ•°æ®çš„æ¸ é“ï¼Œä½†æ˜¯è¯»å–æˆ–å†™å…¥çš„æ•°æ®éƒ½å¿…é¡»ç»ç”±Bufferã€‚</p>
<h3 id="Buffer-ç±»åŠå…¶å­ç±»"><a href="#Buffer-ç±»åŠå…¶å­ç±»" class="headerlink" title="Buffer ç±»åŠå…¶å­ç±»"></a>Buffer ç±»åŠå…¶å­ç±»</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">Buffer</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * The characteristics of Spliterators that traverse and split elements</span></span><br><span class="line"><span class="comment">     * maintained in Buffers.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">SPLITERATOR_CHARACTERISTICS</span> <span class="operator">=</span></span><br><span class="line">        Spliterator.SIZED | Spliterator.SUBSIZED | Spliterator.ORDERED;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Invariants: mark &lt;= position &lt;= limit &lt;= capacity</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> <span class="variable">mark</span> <span class="operator">=</span> -<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> <span class="variable">position</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> limit;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> capacity;</span><br></pre></td></tr></table></figure>

<p>å®ç°å­ç±»ï¼š</p>
<p>Buffer</p>
<p>â€‹		|â€”- IntBuffer</p>
<p>â€‹		|â€”- FloatBuffer 		</p>
<p>â€‹		|â€”- DoubleBuffer 		</p>
<p>â€‹		|â€”- CharBuffer 		</p>
<p>â€‹		|â€”- ShortBuffer 		</p>
<p>â€‹		|â€”- LongBuffer 		</p>
<p>â€‹		|â€”- ByteBuffer 		</p>
<p>â€‹				|â€”- HeapByteBuffer</p>
<p>â€‹						|â€”- HeapByteBufferR</p>
<p>â€‹				|â€”- MappedByteBuffer</p>
<p>â€‹						|â€”- DireByteBUffer</p>
<p>â€‹								|â€”- DirectByteBufferR</p>
<h3 id="ä½¿ç”¨ç¤ºä¾‹"><a href="#ä½¿ç”¨ç¤ºä¾‹" class="headerlink" title="ä½¿ç”¨ç¤ºä¾‹"></a>ä½¿ç”¨ç¤ºä¾‹</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.mineting.nio;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.nio.IntBuffer;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BufferDemo</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">IntBuffer</span> <span class="variable">buffer</span> <span class="operator">=</span> IntBuffer.allocate(<span class="number">5</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; buffer.capacity(); i++) &#123;</span><br><span class="line">            buffer.put(i * <span class="number">2</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// è¯»å†™åˆ‡æ¢</span></span><br><span class="line">        buffer.flip();</span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">        public final Buffer flip() &#123;</span></span><br><span class="line"><span class="comment">            limit = position;</span></span><br><span class="line"><span class="comment">            position = 0;</span></span><br><span class="line"><span class="comment">            mark = -1;</span></span><br><span class="line"><span class="comment">            return this;</span></span><br><span class="line"><span class="comment">        &#125;</span></span><br><span class="line"><span class="comment">        */</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span> (buffer.hasRemaining()) &#123;</span><br><span class="line">            System.out.println(buffer.get());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="å››ä¸ªå±æ€§è¯´æ˜"><a href="#å››ä¸ªå±æ€§è¯´æ˜" class="headerlink" title="å››ä¸ªå±æ€§è¯´æ˜"></a>å››ä¸ªå±æ€§è¯´æ˜</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="type">int</span> <span class="variable">mark</span> <span class="operator">=</span> -<span class="number">1</span>;			<span class="comment">// æ ‡è®°</span></span><br><span class="line"><span class="keyword">private</span> <span class="type">int</span> <span class="variable">position</span> <span class="operator">=</span> <span class="number">0</span>;		<span class="comment">// ä¸‹ä¸€ä¸ªè¯»å†™çš„å…ƒç´ ç´¢å¼•</span></span><br><span class="line"><span class="keyword">private</span> <span class="type">int</span> limit;				<span class="comment">// å½“å‰ç¼“å†²åŒºçš„ç»ˆç‚¹ï¼Œä¸èƒ½å¯¹è¶…è¿‡ limit çš„ç¼“å†²åŒºè¿›è¡Œæ“ä½œ</span></span><br><span class="line"><span class="keyword">private</span> <span class="type">int</span> capacity;			<span class="comment">// å®¹é‡ï¼Œç¼“å†²åŒºåˆ›å»ºæ—¶è®¾å®š</span></span><br></pre></td></tr></table></figure>

<h3 id="Buffer-ç±»çš„ç›¸å…³æ–¹æ³•"><a href="#Buffer-ç±»çš„ç›¸å…³æ–¹æ³•" class="headerlink" title="Buffer ç±»çš„ç›¸å…³æ–¹æ³•"></a>Buffer ç±»çš„ç›¸å…³æ–¹æ³•</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">Buffer</span> &#123;</span><br><span class="line">    <span class="comment">//JDK1.4æ—¶ï¼Œå¼•å…¥çš„api</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> <span class="type">int</span> <span class="title function_">capacity</span><span class="params">( )</span>	<span class="comment">//è¿”å›æ­¤ç¼“å†²åŒºçš„å®¹é‡</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> <span class="type">int</span> <span class="title function_">position</span><span class="params">( )</span>	<span class="comment">//è¿”å›æ­¤ç¼“å†²åŒºçš„ä½ç½®</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> Buffer <span class="title function_">position</span> <span class="params">(<span class="type">int</span> newPositio)</span>	<span class="comment">//è®¾ç½®æ­¤ç¼“å†²åŒºçš„ä½ç½®</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> <span class="type">int</span> <span class="title function_">limit</span><span class="params">( )</span>	<span class="comment">//è¿”å›æ­¤ç¼“å†²åŒºçš„é™åˆ¶</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> Buffer <span class="title function_">limit</span> <span class="params">(<span class="type">int</span> newLimit)</span>	<span class="comment">//è®¾ç½®æ­¤ç¼“å†²åŒºçš„é™åˆ¶</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> Buffer <span class="title function_">mark</span><span class="params">( )</span>		<span class="comment">//åœ¨æ­¤ç¼“å†²åŒºçš„ä½ç½®è®¾ç½®æ ‡è®°</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> Buffer <span class="title function_">reset</span><span class="params">( )</span>	<span class="comment">//å°†æ­¤ç¼“å†²åŒºçš„ä½ç½®é‡ç½®ä¸ºä»¥å‰æ ‡è®°çš„ä½ç½®</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> Buffer <span class="title function_">clear</span><span class="params">( )</span>	<span class="comment">//æ¸…é™¤æ­¤ç¼“å†²åŒº, å³å°†å„ä¸ªæ ‡è®°æ¢å¤åˆ°åˆå§‹çŠ¶æ€ï¼Œä½†æ•°æ®å¹¶æ²¡æœ‰çœŸæ­£æ“¦é™¤, åé¢æ“ä½œä¼šè¦†ç›–</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> Buffer <span class="title function_">flip</span><span class="params">( )</span>		<span class="comment">//åè½¬æ­¤ç¼“å†²åŒº</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> Buffer <span class="title function_">rewind</span><span class="params">( )</span>	<span class="comment">//é‡ç»•æ­¤ç¼“å†²åŒº</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> <span class="type">int</span> <span class="title function_">remaining</span><span class="params">( )</span>	<span class="comment">//è¿”å›å½“å‰ä½ç½®ä¸é™åˆ¶ä¹‹é—´çš„å…ƒç´ æ•°</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> <span class="type">boolean</span> <span class="title function_">hasRemaining</span><span class="params">( )</span>	<span class="comment">//å‘ŠçŸ¥åœ¨å½“å‰ä½ç½®å’Œé™åˆ¶ä¹‹é—´æ˜¯å¦æœ‰å…ƒç´ </span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">abstract</span> <span class="type">boolean</span> <span class="title function_">isReadOnly</span><span class="params">( )</span>;	<span class="comment">//å‘ŠçŸ¥æ­¤ç¼“å†²åŒºæ˜¯å¦ä¸ºåªè¯»ç¼“å†²åŒº</span></span><br><span class="line">    <span class="comment">//JDK1.6æ—¶å¼•å…¥çš„api</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">abstract</span> <span class="type">boolean</span> <span class="title function_">hasArray</span><span class="params">()</span>;		<span class="comment">//å‘ŠçŸ¥æ­¤ç¼“å†²åŒºæ˜¯å¦å…·æœ‰å¯è®¿é—®çš„åº•å±‚å®ç°æ•°ç»„</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">abstract</span> Object <span class="title function_">array</span><span class="params">()</span>;			<span class="comment">//è¿”å›æ­¤ç¼“å†²åŒºçš„åº•å±‚å®ç°æ•°ç»„</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">abstract</span> <span class="type">int</span> <span class="title function_">arrayOffset</span><span class="params">()</span>;		<span class="comment">//è¿”å›æ­¤ç¼“å†²åŒºçš„åº•å±‚å®ç°æ•°ç»„ä¸­ç¬¬ä¸€ä¸ªç¼“å†²åŒºå…ƒç´ çš„åç§»é‡</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">abstract</span> <span class="type">boolean</span> <span class="title function_">isDirect</span><span class="params">()</span>;		<span class="comment">//å‘ŠçŸ¥æ­¤ç¼“å†²åŒºæ˜¯å¦ä¸ºç›´æ¥ç¼“å†²åŒº</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>flip() å’Œ clear() çš„åŒºåˆ«ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// å°†å„ä¸ªæ ‡è®°æ¢å¤åˆ°åˆå§‹çŠ¶æ€,ä½†æ•°æ®å¹¶æ²¡æœ‰çœŸæ­£æ“¦é™¤</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> Buffer <span class="title function_">clear</span><span class="params">()</span> &#123;</span><br><span class="line">    position = <span class="number">0</span>;</span><br><span class="line">    limit = capacity;</span><br><span class="line">    mark = -<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// åè½¬æ­¤ç¼“å†²åŒº</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> Buffer <span class="title function_">flip</span><span class="params">()</span> &#123;</span><br><span class="line">    limit = position;</span><br><span class="line">    position = <span class="number">0</span>;</span><br><span class="line">    mark = -<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="ByteBuffer"><a href="#ByteBuffer" class="headerlink" title="ByteBuffer"></a>ByteBuffer</h3><p>â€‹		å¯¹äº Java ä¸­çš„åŸºæœ¬æ•°æ®ç±»å‹ï¼ˆbooleané™¤å¤–ï¼‰ï¼Œéƒ½æœ‰ä¸€ä¸ª Buffer ç±»å‹ä¸ä¹‹ç›¸å¯¹åº”ï¼Œç½‘ç»œç¼–ç¨‹ä¸­æœ€å¸¸ç”¨çš„æ˜¯ByteBuffer ç±»ï¼ˆäºŒè¿›åˆ¶æ•°æ®ï¼‰ï¼Œè¯¥ç±»çš„ä¸»è¦æ–¹æ³•å¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">ByteBuffer</span> &#123;</span><br><span class="line">    <span class="comment">//ç¼“å†²åŒºåˆ›å»ºç›¸å…³api</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> ByteBuffer <span class="title function_">allocateDirect</span><span class="params">(<span class="type">int</span> capacity)</span>	<span class="comment">//åˆ›å»ºç›´æ¥ç¼“å†²åŒº</span></span><br><span class="line">        </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> ByteBuffer <span class="title function_">allocate</span><span class="params">(<span class="type">int</span> capacity)</span>		<span class="comment">//è®¾ç½®ç¼“å†²åŒºçš„åˆå§‹å®¹é‡</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> ByteBuffer <span class="title function_">wrap</span><span class="params">(<span class="type">byte</span>[] array)</span>		<span class="comment">//æŠŠä¸€ä¸ªæ•°ç»„æ”¾åˆ°ç¼“å†²åŒºä¸­ä½¿ç”¨</span></span><br><span class="line">        </span><br><span class="line">    <span class="comment">//æ„é€ åˆå§‹åŒ–ä½ç½®offsetå’Œä¸Šç•Œlengthçš„ç¼“å†²åŒº</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> ByteBuffer <span class="title function_">wrap</span><span class="params">(<span class="type">byte</span>[] array,<span class="type">int</span> offset, <span class="type">int</span> length)</span></span><br><span class="line">	</span><br><span class="line">     <span class="comment">//ç¼“å­˜åŒºå­˜å–ç›¸å…³API</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">abstract</span> <span class="type">byte</span> <span class="title function_">get</span><span class="params">( )</span>;		<span class="comment">//ä»å½“å‰ä½ç½®positionä¸Šgetï¼Œgetä¹‹åï¼Œpositionä¼šè‡ªåŠ¨+1</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">abstract</span> <span class="type">byte</span> <span class="title function_">get</span> <span class="params">(<span class="type">int</span> index)</span>;		<span class="comment">//ä»ç»å¯¹ä½ç½®get</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">abstract</span> ByteBuffer <span class="title function_">put</span> <span class="params">(<span class="type">byte</span> b)</span>;		<span class="comment">//ä»å½“å‰ä½ç½®ä¸Šæ·»åŠ ï¼Œputä¹‹åï¼Œpositionä¼šè‡ªåŠ¨+1</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">abstract</span> ByteBuffer <span class="title function_">put</span> <span class="params">(<span class="type">int</span> index, <span class="type">byte</span> b)</span>;		<span class="comment">//ä»ç»å¯¹ä½ç½®ä¸Šput</span></span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>

<h2 id="é€šé“-Channel"><a href="#é€šé“-Channel" class="headerlink" title="é€šé“ Channel"></a>é€šé“ Channel</h2><h3 id="åŸºæœ¬ä»‹ç»-3"><a href="#åŸºæœ¬ä»‹ç»-3" class="headerlink" title="åŸºæœ¬ä»‹ç»"></a>åŸºæœ¬ä»‹ç»</h3><ol>
<li><p>NIO ä¸­çš„æµå¯ä»¥å¼‚æ­¥è¯»å†™æ•°æ®ï¼Œä¸åŒäº BIO ä¸­çš„å•å‘ Streamã€‚</p>
</li>
<li><p>Channel åœ¨ NIO ä¸­æ˜¯ä¸€ä¸ªæ¥å£ï¼Œå¸¸ç”¨çš„ Channel ç±»æœ‰ï¼š FileChannelã€DatagramChannelã€ServerSocketChannel å’Œ SocketChannelã€‚</p>
<ul>
<li><p>FileChannel ç”¨äºæ–‡ä»¶çš„æ•°æ®è¯»å†™</p>
</li>
<li><p>DatagramChannel ç”¨äº UDP çš„æ•°æ®è¯»å†™</p>
</li>
<li><p>ServerSocketChannel å’Œ SocketChannel ç”¨äº TCP çš„æ•°æ®è¯»å†™</p>
</li>
</ul>
</li>
</ol>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">FileChannel</span></span><br><span class="line">    <span class="keyword">extends</span> <span class="title class_">AbstractInterruptibleChannel</span></span><br><span class="line">    <span class="keyword">implements</span> <span class="title class_">SeekableByteChannel</span>, GatheringByteChannel, ScatteringByteChannel</span><br><span class="line">&#123;</span><br></pre></td></tr></table></figure>

<p>å®ç°å­ç±»ï¼š</p>
<img src="/2023/02/28/Netty/Java\Document\Netty\Netty å‚çœ‹æ–‡æ¡£.assets\image-20220917154502387.png" alt="image-20220917154502387" style="zoom:80%;">

<h3 id="FileChannel"><a href="#FileChannel" class="headerlink" title="FileChannel"></a>FileChannel</h3><p>FileChannel ä¸»è¦å¯¹æœ¬åœ°æ–‡ä»¶è¿›è¡Œ IO æ“ä½œã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">read</span><span class="params">(ByteBuffer dst)</span> 	ä»é€šé“è¯»å–æ•°æ®å¹¶æ”¾åˆ°ç¼“å†²åŒºä¸­</span><br><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">write</span><span class="params">(ByteBuffer src)</span> 	æŠŠç¼“å†²åŒºçš„æ•°æ®å†™åˆ°é€šé“ä¸­</span><br><span class="line">    </span><br><span class="line"><span class="keyword">public</span> <span class="type">long</span> <span class="title function_">transferFrom</span><span class="params">(ReadableByteChannel src, <span class="type">long</span> position, <span class="type">long</span> count)</span> ä»ç›®æ ‡é€šé“ä¸­å¤åˆ¶æ•°æ®åˆ°å½“å‰é€šé“ï¬ <span class="keyword">public</span> <span class="type">long</span> <span class="title function_">transferTo</span><span class="params">(<span class="type">long</span> position, <span class="type">long</span> count, WritableByteChannel target)</span> æŠŠæ•°æ®ä»å½“å‰é€šé“å¤åˆ¶ç»™ç›®æ ‡é€šé“</span><br></pre></td></tr></table></figure>

<p>è¯»å†™æ–‡ä»¶ç¤ºä¾‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.mineting.nio;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.FileInputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.FileOutputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.nio.ByteBuffer;</span><br><span class="line"><span class="keyword">import</span> java.nio.channels.FileChannel;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">FileChannelDemo</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å°†æ•°æ®å†™å…¥æ–‡ä»¶</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testWrite</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="type">FileOutputStream</span> <span class="variable">fos</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(<span class="string">&quot;TestDir/01.txt&quot;</span>);</span><br><span class="line">        <span class="comment">// FileChannel çš„çœŸå®ç±»å‹ä¸º FileChannelImpl</span></span><br><span class="line">        <span class="type">FileChannel</span> <span class="variable">channel</span> <span class="operator">=</span> fos.getChannel();</span><br><span class="line">        <span class="type">ByteBuffer</span> <span class="variable">byteBuffer</span> <span class="operator">=</span> ByteBuffer.allocate(<span class="number">1024</span>);</span><br><span class="line">        byteBuffer.put(<span class="string">&quot;Hello ä¸–ç•Œ&quot;</span>.getBytes());</span><br><span class="line"></span><br><span class="line">        byteBuffer.flip();</span><br><span class="line">        channel.write(byteBuffer);</span><br><span class="line">        fos.close();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ä»æ–‡ä»¶ä¸­è¯»å–æ•°æ®</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testRead</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="type">FileInputStream</span> <span class="variable">fis</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileInputStream</span>(<span class="string">&quot;TestDir/01.txt&quot;</span>);</span><br><span class="line">        <span class="type">FileChannel</span> <span class="variable">channel</span> <span class="operator">=</span> fis.getChannel();</span><br><span class="line">        <span class="comment">//æ³¨æ„æ•°æ®æº¢å‡º</span></span><br><span class="line">        <span class="type">ByteBuffer</span> <span class="variable">byteBuffer</span> <span class="operator">=</span> ByteBuffer.allocate(<span class="number">1024</span>);</span><br><span class="line">        <span class="type">int</span> <span class="variable">read</span> <span class="operator">=</span> channel.read(byteBuffer);</span><br><span class="line">        byteBuffer.flip();</span><br><span class="line">        System.out.println(<span class="keyword">new</span> <span class="title class_">String</span>(byteBuffer.array()));</span><br><span class="line">        fis.close();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ä½¿ç”¨ä¸€ä¸ª buffer å¤åˆ¶æ–‡ä»¶</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testCopyByBuffer</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="type">FileInputStream</span> <span class="variable">fis</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileInputStream</span>(<span class="string">&quot;TestDir/01.txt&quot;</span>);</span><br><span class="line">        <span class="type">FileOutputStream</span> <span class="variable">fos</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(<span class="string">&quot;TestDir/02.txt&quot;</span>);</span><br><span class="line">        <span class="type">FileChannel</span> <span class="variable">fisChannel</span> <span class="operator">=</span> fis.getChannel();</span><br><span class="line">        <span class="type">FileChannel</span> <span class="variable">fosChannel</span> <span class="operator">=</span> fos.getChannel();</span><br><span class="line">        <span class="type">int</span> <span class="variable">read</span> <span class="operator">=</span> -<span class="number">1</span>;</span><br><span class="line">        <span class="type">ByteBuffer</span> <span class="variable">buffer</span> <span class="operator">=</span> ByteBuffer.allocate(<span class="number">32</span>);</span><br><span class="line">        <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">            <span class="comment">// å‘ buffer ä¸­å†™å…¥æ•°æ®æ—¶ï¼Œå…ˆå°†å„ä¸ªæ ‡è¯†å½’ä½ï¼Œé˜²æ­¢è¯»å–ä¸åˆ°æ•°æ®</span></span><br><span class="line">            buffer.clear();</span><br><span class="line">            read = fisChannel.read(buffer);</span><br><span class="line">            <span class="keyword">if</span> (read != -<span class="number">1</span>) &#123;</span><br><span class="line">                buffer.flip();</span><br><span class="line">                fosChannel.write(buffer);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        fis.close();</span><br><span class="line">        fos.close();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ä½¿ç”¨ transForm å¤åˆ¶æ–‡ä»¶</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testTransFormApi</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="type">FileInputStream</span> <span class="variable">fis</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileInputStream</span>(<span class="string">&quot;TestDir/01.txt&quot;</span>);</span><br><span class="line">        <span class="type">FileOutputStream</span> <span class="variable">fos</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(<span class="string">&quot;TestDir/02.txt&quot;</span>);</span><br><span class="line">        <span class="type">FileChannel</span> <span class="variable">fisChannel</span> <span class="operator">=</span> fis.getChannel();</span><br><span class="line">        <span class="type">FileChannel</span> <span class="variable">fosChannel</span> <span class="operator">=</span> fos.getChannel();</span><br><span class="line">        <span class="comment">//fisChannel.transferTo(0,fisChannel.size(),fosChannel);</span></span><br><span class="line">        fosChannel.transferFrom(fisChannel, <span class="number">0</span>, fisChannel.size());</span><br><span class="line">        fis.close();</span><br><span class="line">        fos.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Buffer-å’Œ-Channel-çš„æ³¨æ„äº‹é¡¹"><a href="#Buffer-å’Œ-Channel-çš„æ³¨æ„äº‹é¡¹" class="headerlink" title="Buffer å’Œ Channel çš„æ³¨æ„äº‹é¡¹"></a>Buffer å’Œ Channel çš„æ³¨æ„äº‹é¡¹</h2><h3 id="Buffer-ç±»å‹åŒ–"><a href="#Buffer-ç±»å‹åŒ–" class="headerlink" title="Buffer ç±»å‹åŒ–"></a>Buffer ç±»å‹åŒ–</h3><p>â€‹		Buffer æ”¯æŒç±»å‹åŒ–çš„ put å’Œ getï¼Œput æ”¾å…¥çš„æ˜¯ä»€ä¹ˆæ•°æ®ç±»å‹ï¼Œget å°±åº”è¯¥ä½¿ç”¨ç›¸åº”çš„æ•°æ®ç±»å‹æ¥å–å‡ºï¼Œå¦åˆ™å¯èƒ½æœ‰ BufferUnderflowException å¼‚å¸¸ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Buffer ç±»å‹åŒ–ï¼šæ”¾å…¥æ—¶æ˜¯ä»€ä¹ˆç±»å‹ï¼Œå–å‡ºæ—¶ä¹Ÿåº”è¯¥æŒ‰ç…§ä»€ä¹ˆç±»å‹</span></span><br><span class="line"><span class="comment"> * put()</span></span><br><span class="line"><span class="comment"> * putInt()</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testBufferType</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">ByteBuffer</span> <span class="variable">buffer</span> <span class="operator">=</span> ByteBuffer.allocate(<span class="number">4</span>);</span><br><span class="line">    buffer.putInt(<span class="number">10</span>);</span><br><span class="line">    buffer.putLong(<span class="number">10L</span>);</span><br><span class="line">    buffer.putChar(<span class="string">&#x27;A&#x27;</span>);</span><br><span class="line">    buffer.putShort((<span class="type">short</span>) <span class="number">10</span>);</span><br><span class="line"></span><br><span class="line">    buffer.flip();</span><br><span class="line">    <span class="comment">// java.nio.BufferOverflowException</span></span><br><span class="line">    buffer.getChar();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Buffer-åªè¯»"><a href="#Buffer-åªè¯»" class="headerlink" title="Buffer åªè¯»"></a>Buffer åªè¯»</h3><p>â€‹		åªè¯» bufferï¼Œè¿”å›çš„ buffer åªè¯»ï¼ŒByteBuffer readOnlyBuffer &#x3D; buffer.asReadOnlyBuffer();</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">    * åªè¯»Buffer</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="meta">@Test</span></span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testReadOnlyBuffer</span><span class="params">()</span> &#123;</span><br><span class="line">       <span class="type">ByteBuffer</span> <span class="variable">buffer</span> <span class="operator">=</span> ByteBuffer.allocate(<span class="number">2</span>);</span><br><span class="line">       buffer.put((<span class="type">byte</span>) <span class="number">10</span>);</span><br><span class="line">       buffer.flip();</span><br><span class="line"></span><br><span class="line">       <span class="comment">// è¿”å›çš„ buffer åªè¯»</span></span><br><span class="line">       <span class="type">ByteBuffer</span> <span class="variable">readOnlyBuffer</span> <span class="operator">=</span> buffer.asReadOnlyBuffer();</span><br><span class="line"></span><br><span class="line">       <span class="comment">// java.nio.ReadOnlyBufferException</span></span><br><span class="line">       readOnlyBuffer.put((<span class="type">byte</span>) <span class="number">12</span>);</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<h3 id="MappedByteBuffer"><a href="#MappedByteBuffer" class="headerlink" title="MappedByteBuffer"></a>MappedByteBuffer</h3><p>â€‹		MappedByteBufferï¼Œå¯ä»¥è®©æ–‡ä»¶ç›´æ¥åœ¨å†…å­˜ï¼ˆå †å¤–çš„å†…å­˜ï¼‰ä¸­è¿›è¡Œä¿®æ”¹ï¼Œè€Œå¦‚ä½•åŒæ­¥åˆ°æ–‡ä»¶ç”±NIO æ¥å®Œæˆã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æµ‹è¯• MappedByteBuffer</span></span><br><span class="line"><span class="comment"> * å¯ä»¥è®©æ–‡ä»¶ç›´æ¥åœ¨å†…å­˜ï¼ˆå †å¤–çš„å†…å­˜ï¼‰ä¸­è¿›è¡Œä¿®æ”¹ï¼Œè€Œå¦‚ä½•åŒæ­¥åˆ°æ–‡ä»¶ç”± NIOæ¥å®Œæˆã€‚</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testMappedByteBuffer</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    <span class="type">RandomAccessFile</span> <span class="variable">rw</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">RandomAccessFile</span>(<span class="string">&quot;TestDir/01.txt&quot;</span>, <span class="string">&quot;rw&quot;</span>);</span><br><span class="line">    <span class="type">FileChannel</span> <span class="variable">channel</span> <span class="operator">=</span> rw.getChannel();</span><br><span class="line">    <span class="comment">// map(æ¨¡å¼,position,size)</span></span><br><span class="line">    <span class="type">MappedByteBuffer</span> <span class="variable">mappedByteBuffer</span> <span class="operator">=</span> channel.map(FileChannel.MapMode.READ_WRITE, <span class="number">0</span>, <span class="number">3</span>);</span><br><span class="line">    mappedByteBuffer.put(<span class="number">0</span>, (<span class="type">byte</span>) <span class="string">&#x27;M&#x27;</span>);</span><br><span class="line">    mappedByteBuffer.put(<span class="number">2</span>, (<span class="type">byte</span>) <span class="string">&#x27;T&#x27;</span>);</span><br><span class="line">    <span class="comment">// java.lang.IndexOutOfBoundsException</span></span><br><span class="line">    <span class="comment">// mappedByteBuffer.put(3, (byte) &#x27;M&#x27;);</span></span><br><span class="line">    rw.close();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Scattering-Gathering"><a href="#Scattering-Gathering" class="headerlink" title="Scattering Gathering"></a>Scattering Gathering</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æµ‹è¯•ScatteringAndGathering</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    <span class="type">ServerSocketChannel</span> <span class="variable">serverSocketChannel</span> <span class="operator">=</span> ServerSocketChannel.open();</span><br><span class="line">    serverSocketChannel.socket().bind(<span class="keyword">new</span> <span class="title class_">InetSocketAddress</span>(<span class="number">8000</span>));</span><br><span class="line"></span><br><span class="line">    ByteBuffer[] byteBuffers = <span class="keyword">new</span> <span class="title class_">ByteBuffer</span>[<span class="number">2</span>];</span><br><span class="line">    byteBuffers[<span class="number">0</span>] = ByteBuffer.allocate(<span class="number">5</span>);</span><br><span class="line">    byteBuffers[<span class="number">1</span>] = ByteBuffer.allocate(<span class="number">3</span>);</span><br><span class="line">    System.out.println(<span class="string">&quot;ç­‰å¾…å®¢æˆ·ç«¯è¿æ¥...&quot;</span>);</span><br><span class="line">    <span class="type">SocketChannel</span> <span class="variable">socketChannel</span> <span class="operator">=</span> serverSocketChannel.accept();</span><br><span class="line">    <span class="comment">// å›ºå®šä»å®¢æˆ·ç«¯æ¥æ”¶ 8 ä¸ªå­—èŠ‚</span></span><br><span class="line">    <span class="type">int</span> <span class="variable">maxLength</span> <span class="operator">=</span> <span class="number">8</span>;</span><br><span class="line">    <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">readLength</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span> (readLength &lt; maxLength) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;ç­‰å¾…å®¢æˆ·ç«¯å‘é€æ•°æ®...&quot;</span>);</span><br><span class="line">            <span class="type">long</span> <span class="variable">read</span> <span class="operator">=</span> socketChannel.read(byteBuffers);</span><br><span class="line">            readLength += read;</span><br><span class="line">            System.out.println(<span class="string">&quot;read: &quot;</span> + readLength);</span><br><span class="line">            Arrays.stream(byteBuffers).map(buffer -&gt; <span class="string">&quot;position: &quot;</span> + buffer.position() +</span><br><span class="line">                    <span class="string">&quot;, limit: &quot;</span> + buffer.limit()).forEach(System.out::println);</span><br><span class="line">        &#125;</span><br><span class="line">        Arrays.stream(byteBuffers).forEach(Buffer::flip);</span><br><span class="line"></span><br><span class="line">        <span class="type">long</span> <span class="variable">writeLength</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span> (writeLength &lt; maxLength) &#123;</span><br><span class="line">            <span class="type">long</span> <span class="variable">write</span> <span class="operator">=</span> socketChannel.write(byteBuffers);</span><br><span class="line">            writeLength += write;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        Arrays.stream(byteBuffers).forEach(Buffer::clear);</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">&quot;readLength = &quot;</span> + readLength + <span class="string">&quot;, writeLength =&quot;</span> + writeLength +</span><br><span class="line">                <span class="string">&quot;, maxLength = &quot;</span> + maxLength);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="é€‰æ‹©å™¨-Selector"><a href="#é€‰æ‹©å™¨-Selector" class="headerlink" title="é€‰æ‹©å™¨ Selector"></a>é€‰æ‹©å™¨ Selector</h2><h3 id="Selector-åŸºæœ¬ä»‹ç»"><a href="#Selector-åŸºæœ¬ä»‹ç»" class="headerlink" title="Selector åŸºæœ¬ä»‹ç»"></a>Selector åŸºæœ¬ä»‹ç»</h3><ol>
<li><p>Java çš„ NIOï¼Œç”¨éé˜»å¡çš„ IO æ–¹å¼ã€‚å¯ä»¥ç”¨ä¸€ä¸ªçº¿ç¨‹ï¼Œå¤„ç†å¤šä¸ªçš„å®¢æˆ·ç«¯è¿æ¥ï¼Œå°±ä¼šä½¿ç”¨åˆ° Selectorï¼ˆé€‰æ‹©å™¨ï¼‰ã€‚</p>
</li>
<li><p>Selector èƒ½å¤Ÿæ£€æµ‹å¤šä¸ªæ³¨å†Œçš„é€šé“ä¸Šæ˜¯å¦æœ‰äº‹ä»¶å‘ç”Ÿï¼Œå¦‚æœæœ‰äº‹ä»¶å‘ç”Ÿï¼Œå†é’ˆå¯¹æ¯ä¸ªäº‹ä»¶è¿›è¡Œç›¸åº”çš„å¤„ç†ã€‚è¿™æ ·å°±å¯ä»¥åªç”¨ä¸€ä¸ªå•çº¿ç¨‹å»ç®¡ç†å¤šä¸ªé€šé“ï¼ˆè¿æ¥ï¼‰ã€‚</p>
</li>
<li><p>åªæœ‰åœ¨è¿æ¥&#x2F;é€šé“ çœŸæ­£æœ‰è¯»å†™äº‹ä»¶å‘ç”Ÿæ—¶ï¼Œæ‰ä¼šè¿›è¡Œè¯»å†™ï¼Œå°±å¤§å¤§åœ°å‡å°‘äº†ç³»ç»Ÿå¼€é”€ï¼Œå¹¶ä¸”ä¸å¿…ä¸ºæ¯ä¸ªè¿æ¥éƒ½åˆ›å»ºä¸€ä¸ªçº¿ç¨‹ï¼Œé¿å…äº†å¤šçº¿ç¨‹ä¹‹é—´çš„ä¸Šä¸‹æ–‡åˆ‡æ¢å¯¼è‡´çš„å¼€é”€ã€‚</p>
</li>
</ol>
<h3 id="ç¤ºæ„å›¾"><a href="#ç¤ºæ„å›¾" class="headerlink" title="ç¤ºæ„å›¾"></a>ç¤ºæ„å›¾</h3><h3 id="ç‰¹ç‚¹è¯´æ˜"><a href="#ç‰¹ç‚¹è¯´æ˜" class="headerlink" title="ç‰¹ç‚¹è¯´æ˜"></a>ç‰¹ç‚¹è¯´æ˜</h3><ol>
<li><p>Netty çš„ IO çº¿ç¨‹ NioEventLoop èšåˆäº† Selector(é€‰æ‹©å™¨ï¼Œä¹Ÿå«å¤šè·¯å¤ç”¨å™¨)ï¼Œå¯ä»¥åŒæ—¶å¹¶å‘å¤„ç†æˆç™¾ä¸Šåƒä¸ªå®¢æˆ·ç«¯è¿æ¥ã€‚</p>
</li>
<li><p>å½“çº¿ç¨‹ä»æŸå®¢æˆ·ç«¯ Socket é€šé“è¿›è¡Œè¯»å†™æ•°æ®æ—¶ï¼Œè‹¥æ²¡æœ‰æ•°æ®å¯ç”¨æ—¶ï¼Œè¯¥çº¿ç¨‹å¯ä»¥è¿›è¡Œå…¶ä»–ä»»åŠ¡ã€‚</p>
</li>
<li><p>çº¿ç¨‹é€šå¸¸å°†éé˜»å¡ IO çš„ç©ºé—²æ—¶é—´ç”¨äºåœ¨å…¶ä»–é€šé“ä¸Šæ‰§è¡Œ IO æ“ä½œï¼Œæ‰€ä»¥å•ç‹¬çš„çº¿ç¨‹å¯ä»¥ç®¡ç†å¤šä¸ªè¾“å…¥å’Œè¾“å‡ºé€šé“ã€‚</p>
</li>
<li><p>ç”±äºè¯»å†™æ“ä½œéƒ½æ˜¯éé˜»å¡çš„ï¼Œè¿™å°±å¯ä»¥å……åˆ†æå‡ IO çº¿ç¨‹çš„è¿è¡Œæ•ˆç‡ï¼Œé¿å…ç”±äºé¢‘ç¹ I&#x2F;O é˜»å¡å¯¼è‡´çš„çº¿ç¨‹æŒ‚èµ·ã€‚</p>
</li>
<li><p>ä¸€ä¸ª I&#x2F;O çº¿ç¨‹å¯ä»¥å¹¶å‘å¤„ç† N ä¸ªå®¢æˆ·ç«¯è¿æ¥å’Œè¯»å†™æ“ä½œï¼Œè¿™ä»æ ¹æœ¬ä¸Šè§£å†³äº†ä¼ ç»ŸåŒæ­¥é˜»å¡ I&#x2F;O ä¸€è¿æ¥ä¸€çº¿ç¨‹æ¨¡å‹ï¼Œæ¶æ„çš„æ€§èƒ½ã€å¼¹æ€§		ä¼¸ç¼©èƒ½åŠ›å’Œå¯é æ€§éƒ½å¾—åˆ°äº†æå¤§çš„æå‡ã€‚</p>
</li>
</ol>
<h3 id="Selector-ç±»çš„ç›¸å…³æ–¹æ³•"><a href="#Selector-ç±»çš„ç›¸å…³æ–¹æ³•" class="headerlink" title="Selector ç±»çš„ç›¸å…³æ–¹æ³•"></a>Selector ç±»çš„ç›¸å…³æ–¹æ³•</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">Selector</span> <span class="keyword">implements</span> <span class="title class_">Closeable</span> &#123; </span><br><span class="line">	<span class="comment">// å¾—åˆ°ä¸€ä¸ªé€‰æ‹©å™¨å¯¹è±¡</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">static</span> Selector <span class="title function_">open</span><span class="params">()</span>;</span><br><span class="line">    </span><br><span class="line">	<span class="comment">// ç›‘æ§æ‰€æœ‰æ³¨å†Œçš„é€šé“ï¼Œå½“å…¶ä¸­æœ‰ IO æ“ä½œå¯ä»¥è¿›è¡Œæ—¶ï¼Œå°†å¯¹åº”çš„ SelectionKey åŠ å…¥åˆ°å†…éƒ¨é›†åˆä¸­å¹¶è¿”å›ï¼Œå‚æ•°ç”¨æ¥è®¾ç½®è¶…æ—¶æ—¶é—´</span></span><br><span class="line">	<span class="keyword">public</span> <span class="type">int</span> <span class="title function_">select</span><span class="params">(<span class="type">long</span> timeout)</span>;</span><br><span class="line">    </span><br><span class="line">	<span class="comment">// ä»å†…éƒ¨é›†åˆä¸­å¾—åˆ°æ‰€æœ‰çš„ SelectionKey</span></span><br><span class="line">	<span class="keyword">public</span> Set&lt;SelectionKey&gt; <span class="title function_">selectedKeys</span><span class="params">()</span>;</span><br><span class="line">    </span><br><span class="line">    selector.select()		<span class="comment">// é˜»å¡</span></span><br><span class="line">	selector.select(<span class="number">1000</span>);	<span class="comment">// é˜»å¡1000æ¯«ç§’ï¼Œåœ¨1000æ¯«ç§’åè¿”å›</span></span><br><span class="line">	selector.wakeup();		<span class="comment">// å”¤é†’selector</span></span><br><span class="line">	selector.selectNow();	<span class="comment">// ä¸é˜»å¡ï¼Œç«‹é©¬è¿”è¿˜</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="NIO-éé˜»å¡-ç½‘ç»œç¼–ç¨‹åŸç†åˆ†æå›¾"><a href="#NIO-éé˜»å¡-ç½‘ç»œç¼–ç¨‹åŸç†åˆ†æå›¾" class="headerlink" title="NIO éé˜»å¡ ç½‘ç»œç¼–ç¨‹åŸç†åˆ†æå›¾"></a>NIO éé˜»å¡ ç½‘ç»œç¼–ç¨‹åŸç†åˆ†æå›¾</h3><p><strong>å¯¹è¯¥å›¾çš„è¯´æ˜</strong></p>
<ol>
<li><p>å½“å®¢æˆ·ç«¯è¿æ¥æ—¶ï¼Œä¼šé€šè¿‡ServerSocketChannel å¾—åˆ° SocketChannelã€‚</p>
</li>
<li><p>Selector è¿›è¡Œç›‘å¬ select æ–¹æ³•, è¿”å›æœ‰äº‹ä»¶å‘ç”Ÿçš„é€šé“çš„ä¸ªæ•°ã€‚</p>
</li>
<li><p>å°†socketChannelæ³¨å†Œåˆ°Selectorä¸Š, register(Selector sel, int ops), ä¸€ä¸ªselectorä¸Šå¯ä»¥æ³¨å†Œå¤šä¸ªSocketChannelã€‚</p>
</li>
<li><p>æ³¨å†Œåè¿”å›ä¸€ä¸ª SelectionKey, ä¼šå’Œè¯¥Selector å…³è”(é›†åˆ)ã€‚</p>
</li>
<li><p>è¿›ä¸€æ­¥å¾—åˆ°å„ä¸ª SelectionKey (æœ‰äº‹ä»¶å‘ç”Ÿ)ã€‚</p>
</li>
<li><p>åœ¨é€šè¿‡ SelectionKeyåå‘è·å– SocketChannel , æ–¹æ³• channel()ã€‚</p>
</li>
<li><p>å¯ä»¥é€šè¿‡å¾—åˆ°çš„ channel , å®Œæˆä¸šåŠ¡å¤„ç†ã€‚</p>
</li>
</ol>
<h3 id="ä½¿ç”¨ç¤ºä¾‹-1"><a href="#ä½¿ç”¨ç¤ºä¾‹-1" class="headerlink" title="ä½¿ç”¨ç¤ºä¾‹"></a>ä½¿ç”¨ç¤ºä¾‹</h3><p>ç¨‹åºåŠŸèƒ½ï¼šé€šè¿‡ NIO å®ç°æœåŠ¡å™¨ç«¯å’Œå®¢æˆ·ç«¯ä¹‹é—´çš„æ•°æ®ç®€å•é€šè®¯ã€‚</p>
<p>NIOServerï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.mineting.nio;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.net.InetSocketAddress;</span><br><span class="line"><span class="keyword">import</span> java.nio.ByteBuffer;</span><br><span class="line"><span class="keyword">import</span> java.nio.channels.*;</span><br><span class="line"><span class="keyword">import</span> java.util.Iterator;</span><br><span class="line"><span class="keyword">import</span> java.util.Set;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">NIOServer</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="comment">// åˆ›å»º ServerScoketChannelå¯¹è±¡å¹¶ç»‘å®šç«¯å£</span></span><br><span class="line">        <span class="type">ServerSocketChannel</span> <span class="variable">serverSocketChannel</span> <span class="operator">=</span> ServerSocketChannel.open();</span><br><span class="line">        serverSocketChannel.socket().bind(<span class="keyword">new</span> <span class="title class_">InetSocketAddress</span>(<span class="number">8000</span>));</span><br><span class="line">        <span class="comment">// åˆ›å»º Selector å¯¹è±¡</span></span><br><span class="line">        <span class="type">Selector</span> <span class="variable">selector</span> <span class="operator">=</span> Selector.open();</span><br><span class="line">        <span class="comment">// è®¾ç½®ä¸ºéé˜»å¡æ¨¡å¼</span></span><br><span class="line">        serverSocketChannel.configureBlocking(<span class="literal">false</span>);</span><br><span class="line">        <span class="comment">// å°† serverSocketChannel æ³¨å†Œåˆ° Selector,å…³å¿ƒäº‹ä»¶ä¸ºç›‘å¬</span></span><br><span class="line">        serverSocketChannel.register(selector, SelectionKey.OP_ACCEPT);</span><br><span class="line">        <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (selector.select(<span class="number">3000</span>) == <span class="number">0</span>) &#123;</span><br><span class="line">                <span class="comment">// å¦‚æœç­‰å¾… 1 ç§’æ²¡æœ‰äº‹ä»¶å‘ç”Ÿ</span></span><br><span class="line">                System.out.println(<span class="string">&quot;Server Waiting 3s...&quot;</span>);</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            Set&lt;SelectionKey&gt; selectionKeys = selector.selectedKeys();</span><br><span class="line">            System.out.println(<span class="string">&quot;SelectionKeys Nums: &quot;</span> + selector.keys().size());</span><br><span class="line">            Iterator&lt;SelectionKey&gt; iterator = selectionKeys.iterator();</span><br><span class="line"></span><br><span class="line">            <span class="keyword">while</span> (iterator.hasNext()) &#123;</span><br><span class="line">                <span class="type">SelectionKey</span> <span class="variable">key</span> <span class="operator">=</span> iterator.next();</span><br><span class="line">                <span class="comment">// æ ¹æ®äº‹ä»¶ç±»å‹ä½œç›¸åº”å¤„ç†</span></span><br><span class="line">                <span class="keyword">if</span> (key.isAcceptable()) &#123;</span><br><span class="line">                    <span class="type">SocketChannel</span> <span class="variable">socketChannel</span> <span class="operator">=</span> serverSocketChannel.accept();</span><br><span class="line">                    System.out.println(<span class="string">&quot;å®¢æˆ·ç«¯è¿æ¥æˆåŠŸ,ç”ŸæˆSocketChannel, hashCode: &quot;</span> +</span><br><span class="line">                            socketChannel.hashCode());</span><br><span class="line">                    </span><br><span class="line">                    socketChannel.configureBlocking(<span class="literal">false</span>);</span><br><span class="line">                    <span class="comment">// å…³è”ä¸€ä¸ª buffer</span></span><br><span class="line">                    socketChannel.register(selector, SelectionKey.OP_READ, ByteBuffer.allocate(<span class="number">1024</span>));</span><br><span class="line">                    System.out.println(<span class="string">&quot;å®¢æˆ·ç«¯è¿æ¥æˆåŠŸå, SelectionKeys æ•°é‡: &quot;</span> + selector.keys().size());</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span> (key.isReadable()) &#123;</span><br><span class="line">                    <span class="type">SocketChannel</span> <span class="variable">channel</span> <span class="operator">=</span> (SocketChannel) key.channel();</span><br><span class="line">                    <span class="type">ByteBuffer</span> <span class="variable">buffer</span> <span class="operator">=</span> (ByteBuffer) key.attachment();</span><br><span class="line">                    channel.read(buffer);</span><br><span class="line">                    System.out.println(<span class="string">&quot;å®¢æˆ·ç«¯å‘é€çš„æ•°æ®: &quot;</span> + <span class="keyword">new</span> <span class="title class_">String</span>(buffer.array()));</span><br><span class="line">                &#125;</span><br><span class="line">				<span class="comment">// ç§»é™¤SelectionKey, é˜²æ­¢å¤šçº¿ç¨‹ç¯å¢ƒä¸‹,å¯¹ key é‡å¤æ“ä½œ</span></span><br><span class="line">                iterator.remove();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>NIOClientï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.mineting.nio;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.net.InetSocketAddress;</span><br><span class="line"><span class="keyword">import</span> java.nio.ByteBuffer;</span><br><span class="line"><span class="keyword">import</span> java.nio.channels.SocketChannel;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">NIOClient</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">SocketChannel</span> <span class="variable">socketChannel</span> <span class="operator">=</span> SocketChannel.open();</span><br><span class="line">        socketChannel.configureBlocking(<span class="literal">false</span>);</span><br><span class="line">        <span class="type">InetSocketAddress</span> <span class="variable">inetSocketAddress</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">InetSocketAddress</span>(<span class="string">&quot;127.0.0.1&quot;</span>, <span class="number">8000</span>);</span><br><span class="line">        <span class="keyword">if</span> (!socketChannel.connect(inetSocketAddress)) &#123;</span><br><span class="line">            <span class="keyword">while</span> (!socketChannel.finishConnect()) &#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;è¿æ¥éœ€è¦æ—¶é—´ï¼Œå®¢æˆ·ç«¯ä¸ä¼šé˜»å¡ï¼Œå¯ä»¥åšå…¶å®ƒå·¥ä½œ...&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//è¿æ¥æˆåŠŸ,å‘é€æ•°æ®</span></span><br><span class="line">        <span class="type">ByteBuffer</span> <span class="variable">buffer</span> <span class="operator">=</span> ByteBuffer.wrap(<span class="string">&quot;Hello NIOServer&quot;</span>.getBytes());</span><br><span class="line">        socketChannel.write(buffer);</span><br><span class="line">        System.in.read();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Selectorç›¸å…³API"><a href="#Selectorç›¸å…³API" class="headerlink" title="Selectorç›¸å…³API"></a>Selectorç›¸å…³API</h3><h4 id="SelectionKey"><a href="#SelectionKey" class="headerlink" title="SelectionKey"></a>SelectionKey</h4><p>SelectionKeyï¼Œè¡¨ç¤º Selector å’Œç½‘ç»œé€šé“çš„æ³¨å†Œå…³ç³», å…±å››ç§:</p>
<p>int OP_ACCEPTï¼šæœ‰æ–°çš„ç½‘ç»œè¿æ¥å¯ä»¥ acceptï¼Œå€¼ä¸º 16</p>
<p>int OP_CONNECTï¼šä»£è¡¨è¿æ¥å·²ç»å»ºç«‹ï¼Œå€¼ä¸º 8</p>
<p>int OP_READï¼šä»£è¡¨è¯»æ“ä½œï¼Œå€¼ä¸º 1 </p>
<p>int OP_WRITEï¼šä»£è¡¨å†™æ“ä½œï¼Œå€¼ä¸º 4</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">OP_READ</span> <span class="operator">=</span> <span class="number">1</span> &lt;&lt; <span class="number">0</span>;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">OP_WRITE</span> <span class="operator">=</span> <span class="number">1</span> &lt;&lt; <span class="number">2</span>;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">OP_CONNECT</span> <span class="operator">=</span> <span class="number">1</span> &lt;&lt; <span class="number">3</span>;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">OP_ACCEPT</span> <span class="operator">=</span> <span class="number">1</span> &lt;&lt; <span class="number">4</span>;</span><br></pre></td></tr></table></figure>

<h4 id="SelectionKey-1"><a href="#SelectionKey-1" class="headerlink" title="SelectionKey"></a>SelectionKey</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">SelectionKey</span> &#123;</span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">abstract</span> Selector <span class="title function_">selector</span><span class="params">()</span>;	<span class="comment">//å¾—åˆ°ä¸ä¹‹å…³è”çš„ Selector å¯¹è±¡</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">abstract</span> SelectableChannel <span class="title function_">channel</span><span class="params">()</span>;	<span class="comment">//å¾—åˆ°ä¸ä¹‹å…³è”çš„é€šé“</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">final</span> Object <span class="title function_">attachment</span><span class="params">()</span>;	<span class="comment">//å¾—åˆ°ä¸ä¹‹å…³è”çš„å…±äº«æ•°æ®</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">abstract</span> SelectionKey <span class="title function_">interestOps</span><span class="params">(<span class="type">int</span> ops)</span>;	<span class="comment">//è®¾ç½®æˆ–æ”¹å˜ç›‘å¬äº‹ä»¶</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">final</span> <span class="type">boolean</span> <span class="title function_">isAcceptable</span><span class="params">()</span>;	<span class="comment">//æ˜¯å¦å¯ä»¥ accept</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">final</span> <span class="type">boolean</span> <span class="title function_">isReadable</span><span class="params">()</span>;	<span class="comment">//æ˜¯å¦å¯ä»¥è¯»</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">final</span> <span class="type">boolean</span> <span class="title function_">isWritable</span><span class="params">()</span>;	<span class="comment">//æ˜¯å¦å¯ä»¥å†™</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title function_">cancel</span><span class="params">()</span>;		<span class="comment">//å–æ¶ˆæ³¨å†Œ</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="ServerSocketChannel"><a href="#ServerSocketChannel" class="headerlink" title="ServerSocketChannel"></a>ServerSocketChannel</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">ServerSocketChannel</span> <span class="keyword">extends</span> <span class="title class_">AbstractSelectableChannel</span> <span class="keyword">implements</span> <span class="title class_">NetworkChannel</span>&#123;</span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">static</span> ServerSocketChannel <span class="title function_">open</span><span class="params">()</span>	<span class="comment">// å¾—åˆ°ä¸€ä¸ª ServerSocketChannel é€šé“</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">final</span> ServerSocketChannel <span class="title function_">bind</span><span class="params">(SocketAddress local)</span>	<span class="comment">// è®¾ç½®æœåŠ¡å™¨ç«¯ç«¯å£å·</span></span><br><span class="line">    <span class="comment">// è®¾ç½®é˜»å¡æˆ–éé˜»å¡æ¨¡å¼ï¼Œå–å€¼ false è¡¨ç¤ºé‡‡ç”¨éé˜»å¡æ¨¡å¼</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">final</span> SelectableChannel <span class="title function_">configureBlocking</span><span class="params">(<span class="type">boolean</span> block)</span>	</span><br><span class="line">	<span class="keyword">public</span> SocketChannel <span class="title function_">accept</span><span class="params">()</span>	<span class="comment">// æ¥å—ä¸€ä¸ªè¿æ¥ï¼Œè¿”å›ä»£è¡¨è¿™ä¸ªè¿æ¥çš„é€šé“å¯¹è±¡</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">final</span> SelectionKey <span class="title function_">register</span><span class="params">(Selector sel, <span class="type">int</span> ops)</span><span class="comment">// æ³¨å†Œä¸€ä¸ªé€‰æ‹©å™¨å¹¶è®¾ç½®ç›‘å¬äº‹ä»¶</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="SocketChannel"><a href="#SocketChannel" class="headerlink" title="SocketChannel"></a>SocketChannel</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">SocketChannel</span> <span class="keyword">extends</span> <span class="title class_">AbstractSelectableChannel</span> <span class="keyword">implements</span> <span class="title class_">ByteChannel</span>, ScatteringByteChannel, GatheringByteChannel, NetworkChannel&#123;</span><br><span class="line">	<span class="comment">// å¾—åˆ°ä¸€ä¸ª SocketChannel é€šé“</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">static</span> SocketChannel <span class="title function_">open</span><span class="params">()</span>;</span><br><span class="line">	<span class="comment">// è®¾ç½®é˜»å¡æˆ–éé˜»å¡æ¨¡å¼ï¼Œå–å€¼ false è¡¨ç¤ºé‡‡ç”¨éé˜»å¡æ¨¡å¼</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">final</span> SelectableChannel <span class="title function_">configureBlocking</span><span class="params">(<span class="type">boolean</span> block)</span>;</span><br><span class="line">	<span class="comment">// è¿æ¥æœåŠ¡å™¨</span></span><br><span class="line">	<span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">connect</span><span class="params">(SocketAddress remote)</span>;</span><br><span class="line">	<span class="comment">// å¦‚æœä¸Šé¢çš„æ–¹æ³•è¿æ¥å¤±è´¥ï¼Œæ¥ä¸‹æ¥å°±è¦é€šè¿‡è¯¥æ–¹æ³•å®Œæˆè¿æ¥æ“ä½œ</span></span><br><span class="line">	<span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">finishConnect</span><span class="params">()</span>;</span><br><span class="line">	<span class="comment">// å¾€é€šé“é‡Œå†™æ•°æ®</span></span><br><span class="line">	<span class="keyword">public</span> <span class="type">int</span> <span class="title function_">write</span><span class="params">(ByteBuffer src)</span>;</span><br><span class="line">	<span class="comment">// ä»é€šé“é‡Œè¯»æ•°æ®</span></span><br><span class="line">	<span class="keyword">public</span> <span class="type">int</span> <span class="title function_">read</span><span class="params">(ByteBuffer dst)</span>;</span><br><span class="line">	<span class="comment">// æ³¨å†Œä¸€ä¸ªé€‰æ‹©å™¨å¹¶è®¾ç½®ç›‘å¬äº‹ä»¶ï¼Œæœ€åä¸€ä¸ªå‚æ•°å¯ä»¥è®¾ç½®å…±äº«æ•°æ®</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">final</span> SelectionKey <span class="title function_">register</span><span class="params">(Selector sel, <span class="type">int</span> ops, Object att)</span>;</span><br><span class="line">	<span class="comment">// å…³é—­é€šé“</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title function_">close</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="NIO-ç½‘ç»œç¼–ç¨‹ï¼šç¾¤èŠ"><a href="#NIO-ç½‘ç»œç¼–ç¨‹ï¼šç¾¤èŠ" class="headerlink" title="NIO ç½‘ç»œç¼–ç¨‹ï¼šç¾¤èŠ"></a>NIO ç½‘ç»œç¼–ç¨‹ï¼šç¾¤èŠ</h3><p>ç¨‹åºè¦æ±‚ï¼šå®ç°å¤šäººç¾¤èŠ</p>
<p>â€‹		æœåŠ¡å™¨ç«¯ï¼šç›‘æµ‹ç”¨æˆ·ä¸Šçº¿ï¼Œç¦»çº¿ï¼Œå¹¶å®ç°æ¶ˆæ¯è½¬å‘åŠŸèƒ½</p>
<p>â€‹		å®¢æˆ·ç«¯ï¼š é€šè¿‡channel å¯ä»¥æ— é˜»å¡å‘é€æ¶ˆæ¯ç»™å…¶å®ƒæ‰€æœ‰ç”¨æˆ·ï¼ŒåŒæ—¶å¯ä»¥æ¥å—å…¶å®ƒç”¨æˆ·æ¶ˆæ¯</p>
<p>æœåŠ¡å™¨ç«¯ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.mineting.nio;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.net.InetSocketAddress;</span><br><span class="line"><span class="keyword">import</span> java.nio.ByteBuffer;</span><br><span class="line"><span class="keyword">import</span> java.nio.channels.*;</span><br><span class="line"><span class="keyword">import</span> java.util.Iterator;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ç¾¤èŠæœåŠ¡ç«¯</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">GroupChatServer</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">PORT</span> <span class="operator">=</span> <span class="number">8000</span>;</span><br><span class="line">    <span class="keyword">private</span> Selector selector;</span><br><span class="line">    <span class="keyword">private</span> ServerSocketChannel serverSocketChannel;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">GroupChatServer</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            serverSocketChannel = ServerSocketChannel.open();</span><br><span class="line">            serverSocketChannel.socket().bind(<span class="keyword">new</span> <span class="title class_">InetSocketAddress</span>(PORT));</span><br><span class="line">            serverSocketChannel.configureBlocking(<span class="literal">false</span>);</span><br><span class="line">            selector = Selector.open();</span><br><span class="line">            serverSocketChannel.register(selector, SelectionKey.OP_ACCEPT);</span><br><span class="line">            listen();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">listen</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;listen thread: &quot;</span> + Thread.currentThread().getName());</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">                <span class="keyword">if</span> (selector.select() &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                    Iterator&lt;SelectionKey&gt; iterator = selector.selectedKeys().iterator();</span><br><span class="line">                    <span class="keyword">while</span> (iterator.hasNext()) &#123;</span><br><span class="line">                        <span class="type">SelectionKey</span> <span class="variable">key</span> <span class="operator">=</span> iterator.next();</span><br><span class="line">                        <span class="keyword">if</span> (key.isAcceptable()) &#123;</span><br><span class="line">                            <span class="type">SocketChannel</span> <span class="variable">socketChannel</span> <span class="operator">=</span> serverSocketChannel.accept();</span><br><span class="line">                            socketChannel.configureBlocking(<span class="literal">false</span>);</span><br><span class="line">                            socketChannel.register(selector, SelectionKey.OP_READ);</span><br><span class="line">                            System.out.println(socketChannel.getRemoteAddress() + <span class="string">&quot;: ä¸Šçº¿...&quot;</span>);</span><br><span class="line">                        &#125;</span><br><span class="line">                        <span class="keyword">if</span> (key.isReadable()) &#123;</span><br><span class="line">                            readData(key);</span><br><span class="line">                        &#125;</span><br><span class="line">                        <span class="comment">//å½“å‰é€šé“å¤„ç†å®Œæˆ,ç§»é™¤,é˜²æ­¢å¤šçº¿ç¨‹ç¯å¢ƒä¸‹é‡å¤æ“ä½œ</span></span><br><span class="line">                        iterator.remove();</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">readData</span><span class="params">(SelectionKey key)</span> &#123;</span><br><span class="line">        <span class="type">SocketChannel</span> <span class="variable">channel</span> <span class="operator">=</span> (SocketChannel) key.channel();</span><br><span class="line">        <span class="type">ByteBuffer</span> <span class="variable">buffer</span> <span class="operator">=</span> ByteBuffer.allocate(<span class="number">1024</span>);</span><br><span class="line">        <span class="comment">// æ­¤å¤„ åº”è¯¥å‘ buffer å¾ªç¯è¯»å–æ•°æ®</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> channel.read(buffer);</span><br><span class="line">            <span class="keyword">if</span> (count &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                <span class="type">String</span> <span class="variable">message</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">String</span>(buffer.array());</span><br><span class="line">                System.out.println(channel.getRemoteAddress() + <span class="string">&quot; å‘é€æ¶ˆæ¯: &quot;</span> + message);</span><br><span class="line">                forwardToOthers(message, channel);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;ç¦»çº¿å¼‚å¸¸: &quot;</span> + e.getMessage());</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                System.out.println(channel.getRemoteAddress() + <span class="string">&quot;: ç¦»çº¿äº†...&quot;</span>);</span><br><span class="line">                key.cancel();</span><br><span class="line">                channel.close();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (IOException ex) &#123;</span><br><span class="line">                ex.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">forwardToOthers</span><span class="params">(String message, SocketChannel self)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;æœåŠ¡å™¨è½¬å‘æ¶ˆæ¯ä¸­...&quot;</span>);</span><br><span class="line">        <span class="keyword">for</span> (SelectionKey key : selector.keys()) &#123;</span><br><span class="line">            <span class="type">SelectableChannel</span> <span class="variable">channel</span> <span class="operator">=</span> key.channel();</span><br><span class="line">            <span class="keyword">if</span> (channel <span class="keyword">instanceof</span> SocketChannel &amp;&amp; channel != self) &#123;</span><br><span class="line">                <span class="type">SocketChannel</span> <span class="variable">dest</span> <span class="operator">=</span> (SocketChannel) channel;</span><br><span class="line">                <span class="type">ByteBuffer</span> <span class="variable">buffer</span> <span class="operator">=</span> ByteBuffer.wrap(message.getBytes());</span><br><span class="line">                dest.write(buffer);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">GroupChatServer</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å®¢æˆ·ç«¯ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.mineting.nio;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.net.InetSocketAddress;</span><br><span class="line"><span class="keyword">import</span> java.nio.ByteBuffer;</span><br><span class="line"><span class="keyword">import</span> java.nio.channels.SelectionKey;</span><br><span class="line"><span class="keyword">import</span> java.nio.channels.Selector;</span><br><span class="line"><span class="keyword">import</span> java.nio.channels.SocketChannel;</span><br><span class="line"><span class="keyword">import</span> java.util.Iterator;</span><br><span class="line"><span class="keyword">import</span> java.util.Scanner;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.TimeUnit;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ç¾¤èŠå®¢æˆ·ç«¯</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">GroupChatClient</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">IP</span> <span class="operator">=</span> <span class="string">&quot;127.0.0.1&quot;</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">PORT</span> <span class="operator">=</span> <span class="number">8000</span>;</span><br><span class="line">    <span class="keyword">private</span> Selector selector;</span><br><span class="line">    <span class="keyword">private</span> SocketChannel socketChannel;</span><br><span class="line">    <span class="keyword">private</span> String username;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">GroupChatClient</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            selector = Selector.open();</span><br><span class="line">            socketChannel = SocketChannel.open(<span class="keyword">new</span> <span class="title class_">InetSocketAddress</span>(IP, PORT));</span><br><span class="line">            socketChannel.configureBlocking(<span class="literal">false</span>);</span><br><span class="line">            socketChannel.register(selector, SelectionKey.OP_READ);</span><br><span class="line">            System.out.println(socketChannel.getLocalAddress().toString());</span><br><span class="line">            username = socketChannel.getLocalAddress().toString().substring(<span class="number">1</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">sendInfo</span><span class="params">(String info)</span> &#123;</span><br><span class="line">        info = username + <span class="string">&quot; : &quot;</span> + info;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            socketChannel.write(ByteBuffer.wrap(info.getBytes()));</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">receiveInfo</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">long</span> <span class="variable">count</span> <span class="operator">=</span> selector.select();</span><br><span class="line">            <span class="keyword">if</span> (count &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                Iterator&lt;SelectionKey&gt; iterator = selector.selectedKeys().iterator();</span><br><span class="line">                <span class="keyword">while</span> (iterator.hasNext()) &#123;</span><br><span class="line">                    <span class="type">SelectionKey</span> <span class="variable">key</span> <span class="operator">=</span> iterator.next();</span><br><span class="line">                    <span class="keyword">if</span> (key.isReadable()) &#123;</span><br><span class="line">                        <span class="type">SocketChannel</span> <span class="variable">channel</span> <span class="operator">=</span> (SocketChannel) key.channel();</span><br><span class="line">                        <span class="type">ByteBuffer</span> <span class="variable">buffer</span> <span class="operator">=</span> ByteBuffer.allocate(<span class="number">1024</span>);</span><br><span class="line">                        channel.read(buffer);</span><br><span class="line">                        System.out.println(<span class="keyword">new</span> <span class="title class_">String</span>(buffer.array()).trim());</span><br><span class="line">                    &#125;</span><br><span class="line">                    iterator.remove();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">GroupChatClient</span> <span class="variable">client</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">GroupChatClient</span>();</span><br><span class="line">        <span class="comment">// å¯åŠ¨çº¿ç¨‹è¯»å–æœåŠ¡å™¨å‘é€çš„æ•°æ®</span></span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">                    client.receiveInfo();</span><br><span class="line">                    TimeUnit.SECONDS.sleep(<span class="number">3</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;).start();</span><br><span class="line">        <span class="type">Scanner</span> <span class="variable">scanner</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Scanner</span>(System.in);</span><br><span class="line">        <span class="keyword">while</span> (scanner.hasNextLine()) &#123;</span><br><span class="line">            client.sendInfo(scanner.nextLine());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="é›¶æ‹·è´ï¼ˆç•¥ï¼‰"><a href="#é›¶æ‹·è´ï¼ˆç•¥ï¼‰" class="headerlink" title="é›¶æ‹·è´ï¼ˆç•¥ï¼‰"></a>é›¶æ‹·è´ï¼ˆç•¥ï¼‰</h2><p>â€‹		åœ¨ Java ç¨‹åºä¸­ï¼Œå¸¸ç”¨çš„é›¶æ‹·è´æœ‰ mmap(å†…å­˜æ˜ å°„) å’Œ sendFileã€‚</p>
<p>ä¼ ç»Ÿçš„ IO æ•°æ®è¯»å†™ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">File</span> <span class="variable">file</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(<span class="string">&quot;test.txt&quot;</span>);</span><br><span class="line"><span class="type">RandomAccessFile</span> <span class="variable">raf</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">RandomAccessFile</span>(file,<span class="string">&quot;rw&quot;</span>);</span><br><span class="line"><span class="type">byte</span>[] bytes = <span class="keyword">new</span> <span class="title class_">bytes</span>[(<span class="type">int</span>)file.length()];</span><br><span class="line">raf.read(bytes);</span><br><span class="line"><span class="type">Socket</span> <span class="variable">socket</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ServerSocket</span>(<span class="number">8000</span>).accept();</span><br><span class="line">socket.getOutputStream().write(bytes);</span><br></pre></td></tr></table></figure>

<h3 id="mmap-ä¼˜åŒ–"><a href="#mmap-ä¼˜åŒ–" class="headerlink" title="mmap ä¼˜åŒ–"></a>mmap ä¼˜åŒ–</h3><p>â€‹		mmap é€šè¿‡å†…å­˜æ˜ å°„ï¼Œå°†æ–‡ä»¶æ˜ å°„åˆ°å†…æ ¸ç¼“å†²åŒºï¼ŒåŒæ—¶ï¼Œç”¨æˆ·ç©ºé—´å¯ä»¥å…±äº«å†…æ ¸ç©ºé—´çš„æ•°æ®ã€‚è¿™æ ·ï¼Œåœ¨è¿›è¡Œç½‘ç»œä¼ è¾“æ—¶ï¼Œå°±å¯ä»¥å‡å°‘å†…æ ¸ç©ºé—´åˆ°ç”¨æˆ·æ§ä»¶çš„æ‹·è´æ¬¡æ•°ã€‚å¦‚ä¸‹å›¾</p>
<p>mmapç¤ºæ„å›¾</p>
<h3 id="sendFile-ä¼˜åŒ–"><a href="#sendFile-ä¼˜åŒ–" class="headerlink" title="sendFile ä¼˜åŒ–"></a>sendFile ä¼˜åŒ–</h3><p>Linux 2.1 ç‰ˆæœ¬ æä¾›äº† sendFile å‡½æ•°ï¼Œå…¶åŸºæœ¬åŸç†å¦‚ä¸‹ï¼šæ•°æ®æ ¹æœ¬ä¸ç»è¿‡ç”¨æˆ·æ€ï¼Œç›´æ¥ä»å†…æ ¸ç¼“å†²åŒºè¿›å…¥åˆ° Socket Bufferï¼ŒåŒæ—¶ï¼Œç”±äºå’Œç”¨æˆ·æ€å®Œå…¨æ— å…³ï¼Œå°±å‡å°‘äº†ä¸€æ¬¡ä¸Šä¸‹æ–‡åˆ‡æ¢ã€‚</p>
<p>ç¤ºæ„å›¾å’Œå°ç»“</p>
<p>æç¤ºï¼šé›¶æ‹·è´ä»æ“ä½œç³»ç»Ÿè§’åº¦ï¼Œæ˜¯æ²¡æœ‰cpu æ‹·è´</p>
<p>Linux åœ¨ 2.4 ç‰ˆæœ¬ä¸­ï¼Œåšäº†ä¸€äº›ä¿®æ”¹ï¼Œé¿å…äº†ä»å†…æ ¸ç¼“å†²åŒºæ‹·è´åˆ° Socket buffer çš„æ“ä½œï¼Œç›´æ¥æ‹·è´åˆ°åè®®æ ˆï¼Œä»è€Œå†ä¸€æ¬¡å‡å°‘äº†æ•°æ®æ‹·è´ã€‚å…·ä½“å¦‚ä¸‹å›¾å’Œå°ç»“ï¼š</p>
<p>è¿™é‡Œå…¶å®æœ‰ ä¸€æ¬¡cpu æ‹·è´</p>
<p>kernel buffer -&gt; socket buffer</p>
<p>ä½†æ˜¯ï¼Œæ‹·è´çš„ä¿¡æ¯å¾ˆå°‘ï¼Œæ¯”å¦‚</p>
<p>lenght , offset , æ¶ˆè€—ä½ï¼Œå¯ä»¥å¿½ç•¥</p>
<h3 id="é›¶æ‹·è´çš„å†æ¬¡ç†è§£"><a href="#é›¶æ‹·è´çš„å†æ¬¡ç†è§£" class="headerlink" title="é›¶æ‹·è´çš„å†æ¬¡ç†è§£"></a>é›¶æ‹·è´çš„å†æ¬¡ç†è§£</h3><p>â€‹		æˆ‘ä»¬è¯´é›¶æ‹·è´ï¼Œæ˜¯ä»æ“ä½œç³»ç»Ÿçš„è§’åº¦æ¥è¯´çš„ã€‚å› ä¸ºå†…æ ¸ç¼“å†²åŒºä¹‹é—´ï¼Œæ²¡æœ‰æ•°æ®æ˜¯é‡å¤çš„ï¼ˆåªæœ‰ kernel buffer æœ‰ä¸€ä»½æ•°æ®ï¼‰ã€‚</p>
<p>é›¶æ‹·è´ä¸ä»…ä»…å¸¦æ¥æ›´å°‘çš„æ•°æ®å¤åˆ¶ï¼Œè¿˜èƒ½å¸¦æ¥å…¶ä»–çš„æ€§èƒ½ä¼˜åŠ¿ï¼Œä¾‹å¦‚æ›´å°‘çš„ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Œæ›´å°‘çš„ CPU ç¼“å­˜ä¼ªå…±äº«ä»¥åŠæ—  CPU æ ¡éªŒå’Œè®¡ç®—ã€‚</p>
<h3 id="mmap-å’Œ-sendFile-çš„åŒºåˆ«"><a href="#mmap-å’Œ-sendFile-çš„åŒºåˆ«" class="headerlink" title="mmap å’Œ sendFile çš„åŒºåˆ«"></a>mmap å’Œ sendFile çš„åŒºåˆ«</h3><ol>
<li><p>mmap é€‚åˆå°æ•°æ®é‡è¯»å†™ï¼ŒsendFile é€‚åˆå¤§æ–‡ä»¶ä¼ è¾“ã€‚</p>
</li>
<li><p>mmap éœ€è¦ 4 æ¬¡ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Œ3 æ¬¡æ•°æ®æ‹·è´ï¼›sendFile éœ€è¦ 3 æ¬¡ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Œæœ€å°‘ 2 æ¬¡æ•°æ®æ‹·è´ã€‚</p>
</li>
<li><p>sendFile å¯ä»¥åˆ©ç”¨ DMA æ–¹å¼ï¼Œå‡å°‘ CPU æ‹·è´ï¼Œmmap åˆ™ä¸èƒ½ï¼ˆå¿…é¡»ä»å†…æ ¸æ‹·è´åˆ° Socket ç¼“å†²åŒºï¼‰ã€‚</p>
</li>
</ol>
<h1 id="AIOç¼–ç¨‹"><a href="#AIOç¼–ç¨‹" class="headerlink" title="AIOç¼–ç¨‹"></a>AIOç¼–ç¨‹</h1><p>â€‹		JDK 7 å¼•å…¥äº† Asynchronous I&#x2F;Oï¼Œå³ AIOã€‚åœ¨è¿›è¡Œ I&#x2F;O ç¼–ç¨‹ä¸­ï¼Œå¸¸ç”¨åˆ°ä¸¤ç§æ¨¡å¼ï¼šReactorå’Œ Proactorã€‚Java çš„ NIO å°±æ˜¯Reactorï¼Œå½“æœ‰äº‹ä»¶è§¦å‘æ—¶ï¼ŒæœåŠ¡å™¨ç«¯å¾—åˆ°é€šçŸ¥ï¼Œè¿›è¡Œç›¸åº”çš„å¤„ç†AIO å³ NIO2.0ï¼Œå«åšå¼‚æ­¥ä¸é˜»å¡çš„ IOã€‚AIO å¼•å…¥å¼‚æ­¥é€šé“çš„æ¦‚å¿µï¼Œé‡‡ç”¨äº† Proactor æ¨¡å¼ï¼Œç®€åŒ–äº†ç¨‹åºç¼–å†™ï¼Œæœ‰æ•ˆçš„è¯·æ±‚æ‰å¯åŠ¨çº¿ç¨‹ï¼Œå®ƒçš„ç‰¹ç‚¹æ˜¯å…ˆç”±æ“ä½œç³»ç»Ÿå®Œæˆåæ‰é€šçŸ¥æœåŠ¡ç«¯ç¨‹åºå¯åŠ¨çº¿ç¨‹å»å¤„ç†ï¼Œä¸€èˆ¬é€‚ç”¨äºè¿æ¥æ•°è¾ƒå¤šä¸”è¿æ¥æ—¶é—´è¾ƒé•¿çš„åº”ç”¨ã€‚</p>
<p>â€‹		ç›®å‰ AIO è¿˜æ²¡æœ‰å¹¿æ³›åº”ç”¨ï¼ŒNetty ä¹Ÿæ˜¯åŸºäºNIO, è€Œä¸æ˜¯AIOï¼ŒAIO å¯ä»¥å‚è€ƒ Javaæ–°ä¸€ä»£ç½‘ç»œç¼–ç¨‹æ¨¡å‹AIOåŸç†åŠLinuxç³»ç»ŸAIOä»‹ç»</p>
<p><a href="http://www.52im.net/thread-306-1-1.html">http://www.52im.net/thread-306-1-1.html</a> </p>
<h1 id="Nettyæ¦‚è¿°"><a href="#Nettyæ¦‚è¿°" class="headerlink" title="Nettyæ¦‚è¿°"></a>Nettyæ¦‚è¿°</h1><h2 id="åŸç”ŸNIOå­˜åœ¨çš„é—®é¢˜"><a href="#åŸç”ŸNIOå­˜åœ¨çš„é—®é¢˜" class="headerlink" title="åŸç”ŸNIOå­˜åœ¨çš„é—®é¢˜"></a>åŸç”ŸNIOå­˜åœ¨çš„é—®é¢˜</h2><ol>
<li><p>NIO çš„ç±»åº“å’Œ API ç¹æ‚ï¼Œä½¿ç”¨éº»çƒ¦ï¼šéœ€è¦ç†Ÿç»ƒæŒæ¡ Selectorã€ServerSocketChannelã€SocketChannelã€ByteBuffer ç­‰ã€‚</p>
</li>
<li><p>éœ€è¦å…·å¤‡å…¶ä»–çš„é¢å¤–æŠ€èƒ½ï¼šè¦ç†Ÿæ‚‰ Java å¤šçº¿ç¨‹ç¼–ç¨‹ï¼Œå› ä¸º NIO ç¼–ç¨‹æ¶‰åŠåˆ° Reactor æ¨¡å¼ï¼Œä½ å¿…é¡»å¯¹å¤šçº¿ç¨‹å’Œç½‘ç»œç¼–ç¨‹éå¸¸ç†Ÿæ‚‰ï¼Œæ‰		èƒ½ç¼–å†™å‡ºé«˜è´¨é‡çš„ NIO ç¨‹åºã€‚</p>
</li>
<li><p>å¼€å‘å·¥ä½œé‡å’Œéš¾åº¦éƒ½éå¸¸å¤§ï¼šä¾‹å¦‚å®¢æˆ·ç«¯é¢ä¸´æ–­è¿é‡è¿ã€ç½‘ç»œé—ªæ–­ã€åŠåŒ…è¯»å†™ã€å¤±è´¥ç¼“å­˜ã€ç½‘ç»œæ‹¥å¡å’Œå¼‚å¸¸æµçš„å¤„ç†ç­‰ã€‚</p>
</li>
<li><p>JDK NIO çš„ Bugï¼šä¾‹å¦‚è‡­åæ˜­è‘—çš„ Epoll Bugï¼Œå®ƒä¼šå¯¼è‡´ Selector ç©ºè½®è¯¢ï¼Œæœ€ç»ˆå¯¼è‡´ CPU 100%ã€‚ç›´åˆ° JDK 1.7 ç‰ˆæœ¬è¯¥é—®é¢˜ä»æ—§å­˜		åœ¨ï¼Œæ²¡æœ‰è¢«æ ¹æœ¬è§£å†³ã€‚</p>
</li>
</ol>
<h2 id="Nettyçš„ä¼˜ç‚¹"><a href="#Nettyçš„ä¼˜ç‚¹" class="headerlink" title="Nettyçš„ä¼˜ç‚¹"></a>Nettyçš„ä¼˜ç‚¹</h2><ol>
<li><p>Netty å¯¹ JDK è‡ªå¸¦çš„ NIO çš„ API è¿›è¡Œäº†å°è£…ï¼Œè§£å†³äº†ä¸Šè¿°é—®é¢˜ã€‚</p>
</li>
<li><p>è®¾è®¡ä¼˜é›…ï¼šé€‚ç”¨äºå„ç§ä¼ è¾“ç±»å‹çš„ç»Ÿä¸€ API é˜»å¡å’Œéé˜»å¡ Socketï¼›åŸºäºçµæ´»ä¸”å¯æ‰©å±•çš„äº‹ä»¶æ¨¡å‹ï¼Œå¯ä»¥æ¸…æ™°åœ°åˆ†ç¦»å…³æ³¨ç‚¹ï¼›é«˜åº¦å¯		å®šåˆ¶çš„çº¿ç¨‹æ¨¡å‹ - å•çº¿ç¨‹ï¼Œä¸€ä¸ªæˆ–å¤šä¸ªçº¿ç¨‹æ± .</p>
</li>
<li><p>ä½¿ç”¨æ–¹ä¾¿ï¼šè¯¦ç»†è®°å½•çš„ Javadocï¼Œç”¨æˆ·æŒ‡å—å’Œç¤ºä¾‹ï¼›æ²¡æœ‰å…¶ä»–ä¾èµ–é¡¹ï¼ŒJDK 5ï¼ˆNetty 3.xï¼‰æˆ– 6ï¼ˆNetty 4.xï¼‰å°±è¶³å¤Ÿäº†ã€‚</p>
</li>
<li><p>é«˜æ€§èƒ½ã€ååé‡æ›´é«˜ï¼šå»¶è¿Ÿæ›´ä½ï¼›å‡å°‘èµ„æºæ¶ˆè€—ï¼›æœ€å°åŒ–ä¸å¿…è¦çš„å†…å­˜å¤åˆ¶ã€‚</p>
</li>
</ol>
<p>â€‹		å®‰å…¨ï¼šå®Œæ•´çš„ SSL&#x2F;TLS å’Œ StartTLS æ”¯æŒã€‚</p>
<ol start="5">
<li>ç¤¾åŒºæ´»è·ƒã€ä¸æ–­æ›´æ–°ï¼šç¤¾åŒºæ´»è·ƒï¼Œç‰ˆæœ¬è¿­ä»£å‘¨æœŸçŸ­ï¼Œå‘ç°çš„ Bug å¯ä»¥è¢«åŠæ—¶ä¿®å¤ï¼ŒåŒæ—¶ï¼Œæ›´å¤šçš„æ–°åŠŸèƒ½ä¼šè¢«åŠ å…¥</li>
</ol>
<h2 id="Nettyç‰ˆæœ¬è¯´æ˜"><a href="#Nettyç‰ˆæœ¬è¯´æ˜" class="headerlink" title="Nettyç‰ˆæœ¬è¯´æ˜"></a>Nettyç‰ˆæœ¬è¯´æ˜</h2><ol>
<li>nettyç‰ˆæœ¬åˆ†ä¸º netty3.x å’Œ netty4.xã€netty5.x</li>
<li>å› ä¸ºNetty5å‡ºç°é‡å¤§bugï¼Œå·²ç»è¢«å®˜ç½‘åºŸå¼ƒäº†ï¼Œç›®å‰æ¨èä½¿ç”¨çš„æ˜¯Netty4.xçš„ç¨³å®šç‰ˆæœ¬ã€‚</li>
<li>ç›®å‰åœ¨å®˜ç½‘å¯ä¸‹è½½çš„ç‰ˆæœ¬ netty3.x netty4.0.x å’Œ netty4.1.x</li>
<li>netty ä¸‹è½½åœ°å€ï¼š <a href="https://bintray.com/netty/downloads/netty/">https://bintray.com/netty/downloads/netty/</a></li>
</ol>
<h1 id="Netty-é«˜æ€§èƒ½æ¶æ„è®¾è®¡"><a href="#Netty-é«˜æ€§èƒ½æ¶æ„è®¾è®¡" class="headerlink" title="Netty é«˜æ€§èƒ½æ¶æ„è®¾è®¡"></a>Netty é«˜æ€§èƒ½æ¶æ„è®¾è®¡</h1><h2 id="çº¿ç¨‹æ¨¡å‹åŸºæœ¬ä»‹ç»"><a href="#çº¿ç¨‹æ¨¡å‹åŸºæœ¬ä»‹ç»" class="headerlink" title="çº¿ç¨‹æ¨¡å‹åŸºæœ¬ä»‹ç»"></a>çº¿ç¨‹æ¨¡å‹åŸºæœ¬ä»‹ç»</h2><p>â€‹		ä¸åŒçš„çº¿ç¨‹æ¨¡å¼ï¼Œå¯¹ç¨‹åºçš„æ€§èƒ½æœ‰å¾ˆå¤§å½±å“ï¼Œç›®å‰å­˜åœ¨çš„çº¿ç¨‹æ¨¡å‹æœ‰ï¼š<strong>ä¼ ç»Ÿé˜»å¡ I&#x2F;O æœåŠ¡æ¨¡å‹ï¼ŒReactor æ¨¡å¼</strong></p>
<p>æ ¹æ® Reactor çš„æ•°é‡å’Œå¤„ç†èµ„æºæ± çº¿ç¨‹çš„æ•°é‡ä¸åŒï¼Œæœ‰ 3 ç§å…¸å‹çš„å®ç°ï¼š</p>
<ul>
<li><p>å• Reactor å•çº¿ç¨‹ï¼›</p>
</li>
<li><p>å• Reactor å¤šçº¿ç¨‹ï¼›</p>
</li>
<li><p>ä¸»ä» Reactor å¤šçº¿ç¨‹</p>
<p>  Netty çº¿ç¨‹æ¨¡å¼ï¼ˆNetty ä¸»è¦åŸºäºä¸»ä» Reactor å¤šçº¿ç¨‹æ¨¡å‹åšäº†ä¸€å®šçš„æ”¹è¿›ï¼Œå…¶ä¸­ä¸»ä» Reactor å¤šçº¿ç¨‹æ¨¡å‹æœ‰å¤šä¸ª Reactorï¼‰ã€‚</p>
</li>
</ul>
<h2 id="ä¼ ç»Ÿé˜»å¡-I-x2F-O-æœåŠ¡æ¨¡å‹"><a href="#ä¼ ç»Ÿé˜»å¡-I-x2F-O-æœåŠ¡æ¨¡å‹" class="headerlink" title="ä¼ ç»Ÿé˜»å¡ I&#x2F;O æœåŠ¡æ¨¡å‹"></a>ä¼ ç»Ÿé˜»å¡ I&#x2F;O æœåŠ¡æ¨¡å‹</h2><h3 id="å·¥ä½œåŸç†å›¾"><a href="#å·¥ä½œåŸç†å›¾" class="headerlink" title="å·¥ä½œåŸç†å›¾"></a>å·¥ä½œåŸç†å›¾</h3><img src="/2023/02/28/Netty/Java\Document\Netty\Netty å‚çœ‹æ–‡æ¡£.assets\image-20220919092414543.png" alt="image-20220919092414543" style="zoom:150%;">

<h3 id="æ¨¡å‹ç‰¹ç‚¹"><a href="#æ¨¡å‹ç‰¹ç‚¹" class="headerlink" title="æ¨¡å‹ç‰¹ç‚¹"></a><strong>æ¨¡å‹ç‰¹ç‚¹</strong></h3><p>é‡‡ç”¨é˜»å¡IOæ¨¡å¼è·å–è¾“å…¥çš„æ•°æ®</p>
<p>æ¯ä¸ªè¿æ¥éƒ½éœ€è¦ç‹¬ç«‹çš„çº¿ç¨‹å®Œæˆæ•°æ®çš„è¾“å…¥ï¼Œä¸šåŠ¡å¤„ç†ï¼Œæ•°æ®è¿”å›</p>
<h3 id="é—®é¢˜åˆ†æ"><a href="#é—®é¢˜åˆ†æ" class="headerlink" title="é—®é¢˜åˆ†æ"></a><strong>é—®é¢˜åˆ†æ</strong></h3><ol>
<li><p>å½“å¹¶å‘æ•°å¾ˆå¤§ï¼Œå°±ä¼šåˆ›å»ºå¤§é‡çš„çº¿ç¨‹ï¼Œå ç”¨å¾ˆå¤§ç³»ç»Ÿèµ„æº</p>
</li>
<li><p>è¿æ¥åˆ›å»ºåï¼Œå¦‚æœå½“å‰çº¿ç¨‹æš‚æ—¶æ²¡æœ‰æ•°æ®å¯è¯»ï¼Œè¯¥çº¿ç¨‹ä¼šé˜»å¡åœ¨read æ“ä½œï¼Œé€ æˆçº¿ç¨‹èµ„æºæµªè´¹ã€‚</p>
</li>
</ol>
<h2 id="Reactor-æ¨¡å¼"><a href="#Reactor-æ¨¡å¼" class="headerlink" title="Reactor æ¨¡å¼"></a>Reactor æ¨¡å¼</h2><h3 id="Reactoræ¨¡å¼æ¦‚è¿°"><a href="#Reactoræ¨¡å¼æ¦‚è¿°" class="headerlink" title="Reactoræ¨¡å¼æ¦‚è¿°"></a>Reactoræ¨¡å¼æ¦‚è¿°</h3><p>Reactor æ¨¡å¼ä¹Ÿç§°ä¸ºï¼šååº”å™¨æ¨¡å¼ã€åˆ†å‘è€…æ¨¡å¼ï¼ˆDispatcherï¼‰ã€é€šçŸ¥è€…æ¨¡å¼ï¼ˆnotifierï¼‰</p>
<p>é’ˆå¯¹ä¼ ç»Ÿé˜»å¡ I&#x2F;O æœåŠ¡æ¨¡å‹çš„ 2 ä¸ªç¼ºç‚¹ï¼Œè§£å†³æ–¹æ¡ˆï¼š</p>
<ol>
<li><p>åŸºäº I&#x2F;O å¤ç”¨æ¨¡å‹ï¼šå¤šä¸ªè¿æ¥å…±ç”¨ä¸€ä¸ªé˜»å¡å¯¹è±¡ï¼Œåº”ç”¨ç¨‹åºåªéœ€è¦åœ¨ä¸€ä¸ªé˜»å¡å¯¹è±¡ç­‰å¾…ï¼Œæ— éœ€é˜»å¡ç­‰å¾…æ‰€æœ‰è¿æ¥ã€‚å½“æŸä¸ªè¿æ¥æœ‰æ–°çš„æ•°æ®å¯ä»¥å¤„ç†æ—¶ï¼Œæ“ä½œç³»ç»Ÿé€šçŸ¥åº”ç”¨ç¨‹åºï¼Œçº¿ç¨‹ä»é˜»å¡çŠ¶æ€è¿”å›ï¼Œå¼€å§‹è¿›è¡Œä¸šåŠ¡å¤„ç†ã€‚</p>
</li>
<li><p>åŸºäºçº¿ç¨‹æ± å¤ç”¨çº¿ç¨‹èµ„æºï¼šä¸å¿…å†ä¸ºæ¯ä¸ªè¿æ¥åˆ›å»ºçº¿ç¨‹ï¼Œå°†è¿æ¥å®Œæˆåçš„ä¸šåŠ¡å¤„ç†ä»»åŠ¡åˆ†é…ç»™çº¿ç¨‹è¿›è¡Œå¤„ç†ï¼Œä¸€ä¸ªçº¿ç¨‹å¯ä»¥å¤„ç†å¤šä¸ªè¿æ¥çš„ä¸šåŠ¡ã€‚</p>
</li>
</ol>
<p><strong>I&#x2F;O å¤ç”¨ç»“åˆçº¿ç¨‹æ± ï¼Œå°±æ˜¯ Reactor æ¨¡å¼åŸºæœ¬è®¾è®¡æ€æƒ³ï¼Œå¦‚å›¾ï¼š</strong></p>
<img src="/2023/02/28/Netty/Java\Document\Netty\Netty å‚çœ‹æ–‡æ¡£.assets\image-20220919092954069.png" alt="image-20220919092954069" style="zoom:150%;">

<p>è¯´æ˜ï¼š</p>
<p>Reactor æ¨¡å¼ï¼Œå³é€šè¿‡ä¸€ä¸ªæˆ–å¤šä¸ªè¾“å…¥åŒæ—¶ä¼ é€’ç»™æœåŠ¡å¤„ç†å™¨çš„æ¨¡å¼ï¼ˆåŸºäºäº‹ä»¶é©±åŠ¨ï¼‰</p>
<p>æœåŠ¡å™¨ç«¯ç¨‹åºå¤„ç†ä¼ å…¥çš„å¤šä¸ªè¯·æ±‚ï¼Œå¹¶å°†å®ƒä»¬åŒæ­¥åˆ†æ´¾åˆ°ç›¸åº”çš„å¤„ç†çº¿ç¨‹ï¼Œå› æ­¤ Reactor æ¨¡å¼ä¹Ÿå« Dispatcher æ¨¡å¼ã€‚</p>
<p>Reactor æ¨¡å¼ä½¿ç”¨ IOå¤ç”¨ ç›‘å¬äº‹ä»¶ï¼Œæ”¶åˆ°äº‹ä»¶åï¼Œåˆ†å‘ç»™æŸä¸ªçº¿ç¨‹(è¿›ç¨‹)ï¼Œè¿™ç‚¹å°±æ˜¯ç½‘ç»œæœåŠ¡å™¨é«˜å¹¶å‘å¤„ç†å…³é”®ã€‚</p>
<p>Reactor æ¨¡å¼ä¸­æ ¸å¿ƒç»„æˆï¼š</p>
<p><strong>Reactor</strong>ï¼šReactor åœ¨ä¸€ä¸ªå•ç‹¬çš„çº¿ç¨‹ä¸­è¿è¡Œï¼Œè´Ÿè´£ç›‘å¬å’Œåˆ†å‘äº‹ä»¶ï¼Œåˆ†å‘ç»™é€‚å½“çš„å¤„ç†ç¨‹åºæ¥å¯¹ IO äº‹ä»¶åšå‡ºååº”ã€‚ å®ƒå°±åƒå…¬å¸çš„ç”µè¯æ¥çº¿å‘˜ï¼Œå®ƒæ¥å¬æ¥è‡ªå®¢æˆ·çš„ç”µè¯å¹¶å°†çº¿è·¯è½¬ç§»åˆ°é€‚å½“çš„è”ç³»äººï¼›</p>
<p><strong>Handlers</strong>ï¼šå¤„ç†ç¨‹åºæ‰§è¡Œ I&#x2F;O äº‹ä»¶è¦å®Œæˆçš„å®é™…äº‹ä»¶ï¼Œç±»ä¼¼äºå®¢æˆ·æƒ³è¦ä¸ä¹‹äº¤è°ˆçš„å…¬å¸ä¸­çš„èŒå‘˜ã€‚Reactor é€šè¿‡è°ƒåº¦é€‚å½“çš„å¤„ç†ç¨‹åºæ¥å“åº” I&#x2F;O äº‹ä»¶ï¼Œå¤„ç†ç¨‹åºæ‰§è¡Œéé˜»å¡æ“ä½œã€‚</p>
<h3 id="Reactor-æ¨¡å¼åˆ†ç±»"><a href="#Reactor-æ¨¡å¼åˆ†ç±»" class="headerlink" title="Reactor æ¨¡å¼åˆ†ç±»"></a>Reactor æ¨¡å¼åˆ†ç±»</h3><p>æ ¹æ® Reactor çš„æ•°é‡å’Œå¤„ç†èµ„æºæ± çº¿ç¨‹çš„æ•°é‡ä¸åŒï¼Œæœ‰ 3 ç§å…¸å‹çš„å®ç°</p>
<ol>
<li><p>å• Reactor å•çº¿ç¨‹</p>
</li>
<li><p>å• Reactor å¤šçº¿ç¨‹</p>
</li>
<li><p>ä¸»ä» Reactor å¤šçº¿ç¨‹</p>
</li>
</ol>
<h3 id="å•-Reactor-å•çº¿ç¨‹"><a href="#å•-Reactor-å•çº¿ç¨‹" class="headerlink" title="å• Reactor å•çº¿ç¨‹"></a>å• Reactor å•çº¿ç¨‹</h3><h4 id="å·¥ä½œåŸç†å›¾-1"><a href="#å·¥ä½œåŸç†å›¾-1" class="headerlink" title="å·¥ä½œåŸç†å›¾"></a>å·¥ä½œåŸç†å›¾</h4><img src="/2023/02/28/Netty/Java\Document\Netty\Netty å‚çœ‹æ–‡æ¡£.assets\image-20220919093450325.png" alt="image-20220919093450325" style="zoom:150%;">

<h4 id="æ–¹æ¡ˆè¯´æ˜"><a href="#æ–¹æ¡ˆè¯´æ˜" class="headerlink" title="æ–¹æ¡ˆè¯´æ˜"></a>æ–¹æ¡ˆè¯´æ˜</h4><ol>
<li><p>Select æ˜¯å‰é¢ I&#x2F;O å¤ç”¨æ¨¡å‹ä»‹ç»çš„æ ‡å‡†ç½‘ç»œç¼–ç¨‹ APIï¼Œå¯ä»¥å®ç°åº”ç”¨ç¨‹åºé€šè¿‡ä¸€ä¸ªé˜»å¡å¯¹è±¡ç›‘å¬å¤šè·¯è¿æ¥è¯·æ±‚ã€‚</p>
</li>
<li><p>Reactor å¯¹è±¡é€šè¿‡ Select ç›‘æ§å®¢æˆ·ç«¯è¯·æ±‚äº‹ä»¶ï¼Œæ”¶åˆ°äº‹ä»¶åé€šè¿‡ Dispatch è¿›è¡Œåˆ†å‘ã€‚</p>
</li>
<li><p>å¦‚æœæ˜¯å»ºç«‹è¿æ¥è¯·æ±‚äº‹ä»¶ï¼Œåˆ™ç”± Acceptor é€šè¿‡ Accept å¤„ç†è¿æ¥è¯·æ±‚ï¼Œç„¶ååˆ›å»ºä¸€ä¸ª Handler å¯¹è±¡å¤„ç†è¿æ¥å®Œæˆåçš„åç»­ä¸šåŠ¡ã€‚</p>
</li>
<li><p>å¦‚æœä¸æ˜¯å»ºç«‹è¿æ¥äº‹ä»¶ï¼Œåˆ™ Reactor ä¼šåˆ†å‘è°ƒç”¨è¿æ¥å¯¹åº”çš„ Handler æ¥å“åº”ï¼ŒHandler ä¼šå®Œæˆ Readâ†’ä¸šåŠ¡å¤„ç†â†’Send çš„å®Œæ•´ä¸šåŠ¡æµç¨‹ã€‚</p>
</li>
<li><p>æœåŠ¡å™¨ç«¯ç”¨ä¸€ä¸ªçº¿ç¨‹é€šè¿‡å¤šè·¯å¤ç”¨å®Œæˆæ‰€æœ‰çš„ IO æ“ä½œï¼ˆåŒ…æ‹¬è¿æ¥ï¼Œè¯»ã€å†™ç­‰ï¼‰ï¼Œç¼–ç ç®€å•ï¼Œä½†æ˜¯å¦‚æœå®¢æˆ·ç«¯è¿æ¥æ•°é‡è¾ƒå¤šï¼Œå°†æ— æ³•æ”¯æ’‘ï¼Œå‰é¢çš„ NIO æ¡ˆä¾‹å°±å±äºè¿™ç§æ¨¡å‹ã€‚</p>
</li>
</ol>
<h4 id="ä¼˜ç¼ºç‚¹åˆ†æ"><a href="#ä¼˜ç¼ºç‚¹åˆ†æ" class="headerlink" title="ä¼˜ç¼ºç‚¹åˆ†æ"></a>ä¼˜ç¼ºç‚¹åˆ†æ</h4><p>ä¼˜ç‚¹ï¼šæ¨¡å‹ç®€å•ï¼Œæ²¡æœ‰å¤šçº¿ç¨‹ã€è¿›ç¨‹é€šä¿¡ã€ç«äº‰çš„é—®é¢˜ï¼Œå…¨éƒ¨éƒ½åœ¨ä¸€ä¸ªçº¿ç¨‹ä¸­å®Œæˆã€‚</p>
<p>ç¼ºç‚¹ï¼š</p>
<ol>
<li><p>æ€§èƒ½é—®é¢˜ï¼Œåªæœ‰ä¸€ä¸ªçº¿ç¨‹ï¼Œæ— æ³•å®Œå…¨å‘æŒ¥å¤šæ ¸ CPU çš„æ€§èƒ½ã€‚Handler åœ¨å¤„ç†æŸä¸ªè¿æ¥ä¸Šçš„ä¸šåŠ¡æ—¶ï¼Œæ•´ä¸ªè¿›ç¨‹æ— æ³•å¤„ç†å…¶ä»–è¿æ¥äº‹ä»¶ï¼Œå¾ˆå®¹æ˜“å¯¼è‡´æ€§èƒ½ç“¶é¢ˆã€‚</p>
</li>
<li><p>å¯é æ€§é—®é¢˜ï¼Œçº¿ç¨‹æ„å¤–ç»ˆæ­¢ï¼Œæˆ–è€…è¿›å…¥æ­»å¾ªç¯ï¼Œä¼šå¯¼è‡´æ•´ä¸ªç³»ç»Ÿé€šä¿¡æ¨¡å—ä¸å¯ç”¨ï¼Œä¸èƒ½æ¥æ”¶å’Œå¤„ç†å¤–éƒ¨æ¶ˆæ¯ï¼Œé€ æˆèŠ‚ç‚¹æ•…éšœã€‚</p>
<p> ä½¿ç”¨åœºæ™¯ï¼šå®¢æˆ·ç«¯çš„æ•°é‡æœ‰é™ï¼Œä¸šåŠ¡å¤„ç†éå¸¸å¿«é€Ÿï¼Œæ¯”å¦‚ Redis åœ¨ä¸šåŠ¡å¤„ç†çš„æ—¶é—´å¤æ‚åº¦ O(1) çš„æƒ…å†µã€‚</p>
</li>
</ol>
<h3 id="å•-Reactor-å¤šçº¿ç¨‹"><a href="#å•-Reactor-å¤šçº¿ç¨‹" class="headerlink" title="å• Reactor å¤šçº¿ç¨‹"></a>å• Reactor å¤šçº¿ç¨‹</h3><h4 id="å·¥ä½œåŸç†å›¾-2"><a href="#å·¥ä½œåŸç†å›¾-2" class="headerlink" title="å·¥ä½œåŸç†å›¾"></a>å·¥ä½œåŸç†å›¾</h4><img src="/2023/02/28/Netty/Java\Document\Netty\Netty å‚çœ‹æ–‡æ¡£.assets\image-20220919094021418.png" alt="image-20220919094021418" style="zoom:150%;">

<h4 id="æ–¹æ¡ˆè¯´æ˜-1"><a href="#æ–¹æ¡ˆè¯´æ˜-1" class="headerlink" title="æ–¹æ¡ˆè¯´æ˜"></a>æ–¹æ¡ˆè¯´æ˜</h4><ol>
<li><p>Reactor å¯¹è±¡é€šè¿‡ select ç›‘æ§å®¢æˆ·ç«¯è¯·æ±‚äº‹ä»¶ï¼Œæ”¶åˆ°äº‹ä»¶åï¼Œé€šè¿‡dispatchè¿›è¡Œåˆ†å‘ã€‚</p>
</li>
<li><p>å¦‚æœå»ºç«‹è¿æ¥è¯·æ±‚ï¼Œåˆ™ç”± Acceptor é€šè¿‡ accept å¤„ç†è¿æ¥è¯·æ±‚ï¼Œ ç„¶ååˆ›å»ºä¸€ä¸ª Handler å¯¹è±¡å¤„ç†å®Œæˆè¿æ¥åçš„å„ç§äº‹ä»¶ã€‚</p>
</li>
<li><p>å¦‚æœä¸æ˜¯è¿æ¥è¯·æ±‚ï¼Œåˆ™ç”± reactor åˆ†å‘è°ƒç”¨è¿æ¥å¯¹åº”çš„ handler æ¥å¤„ç†ã€‚</p>
</li>
<li><p>handler åªè´Ÿè´£å“åº”äº‹ä»¶ï¼Œä¸åšå…·ä½“çš„ä¸šåŠ¡å¤„ç†ï¼Œ<strong>é€šè¿‡ read è¯»å–æ•°æ®å</strong>ï¼Œä¼šåˆ†å‘ç»™åé¢çš„ worker çº¿ç¨‹æ± çš„æŸä¸ªçº¿ç¨‹å¤„ç†ä¸šåŠ¡ã€‚</p>
</li>
<li><p>worker çº¿ç¨‹æ± ä¼šåˆ†é…ç‹¬ç«‹çº¿ç¨‹å®ŒæˆçœŸæ­£çš„ä¸šåŠ¡ï¼Œå¹¶å°†ç»“æœè¿”å›ç»™ handlerã€‚</p>
</li>
<li><p>handleræ”¶åˆ°å“åº”åï¼Œé€šè¿‡send å°†ç»“æœè¿”å›ç»™clientã€‚</p>
</li>
</ol>
<h4 id="ä¼˜ç¼ºç‚¹åˆ†æ-1"><a href="#ä¼˜ç¼ºç‚¹åˆ†æ-1" class="headerlink" title="ä¼˜ç¼ºç‚¹åˆ†æ"></a>ä¼˜ç¼ºç‚¹åˆ†æ</h4><p>ä¼˜ç‚¹ï¼šå¯ä»¥å……åˆ†çš„åˆ©ç”¨å¤šæ ¸cpu çš„å¤„ç†èƒ½åŠ›</p>
<p>ç¼ºç‚¹ï¼š å¤šçº¿ç¨‹æ•°æ®å…±äº«å’Œè®¿é—®æ¯”è¾ƒå¤æ‚ï¼Œreactor å¤„ç†æ‰€æœ‰çš„äº‹ä»¶çš„ç›‘å¬å’Œå“åº”ï¼Œåœ¨å•çº¿ç¨‹è¿è¡Œï¼Œåœ¨é«˜å¹¶å‘åœºæ™¯å®¹æ˜“å‡ºç°æ€§èƒ½ç“¶é¢ˆã€‚</p>
<h3 id="ä¸»ä»-Reactor-å¤šçº¿ç¨‹"><a href="#ä¸»ä»-Reactor-å¤šçº¿ç¨‹" class="headerlink" title="ä¸»ä» Reactor å¤šçº¿ç¨‹"></a>ä¸»ä» Reactor å¤šçº¿ç¨‹</h3><h4 id="å·¥ä½œåŸç†å›¾-3"><a href="#å·¥ä½œåŸç†å›¾-3" class="headerlink" title="å·¥ä½œåŸç†å›¾"></a>å·¥ä½œåŸç†å›¾</h4><p>é’ˆå¯¹å• Reactor å¤šçº¿ç¨‹æ¨¡å‹ä¸­ï¼ŒReactor åœ¨å•çº¿ç¨‹ä¸­è¿è¡Œï¼Œé«˜å¹¶å‘åœºæ™¯ä¸‹å®¹æ˜“æˆä¸ºæ€§èƒ½ç“¶é¢ˆï¼Œå¯ä»¥è®© Reactor åœ¨å¤šçº¿ç¨‹ä¸­è¿è¡Œã€‚</p>
<img src="/2023/02/28/Netty/Java\Document\Netty\Netty å‚çœ‹æ–‡æ¡£.assets\image-20220919094446646.png" alt="image-20220919094446646" style="zoom:150%;">

<h4 id="æ–¹æ¡ˆè¯´æ˜-2"><a href="#æ–¹æ¡ˆè¯´æ˜-2" class="headerlink" title="æ–¹æ¡ˆè¯´æ˜"></a>æ–¹æ¡ˆè¯´æ˜</h4><ol>
<li><p>Reactorä¸»çº¿ç¨‹ MainReactor å¯¹è±¡é€šè¿‡select ç›‘å¬è¿æ¥äº‹ä»¶, æ”¶åˆ°äº‹ä»¶åï¼Œé€šè¿‡Acceptor å¤„ç†è¿æ¥äº‹ä»¶ã€‚</p>
</li>
<li><p>å½“ Acceptor å¤„ç†è¿æ¥äº‹ä»¶åï¼ŒMainReactor å°†è¿æ¥åˆ†é…ç»™ SubReactor ã€‚</p>
</li>
<li><p>Subreactor å°†è¿æ¥åŠ å…¥åˆ°è¿æ¥é˜Ÿåˆ—è¿›è¡Œç›‘å¬ï¼Œå¹¶åˆ›å»º handler è¿›è¡Œå„ç§äº‹ä»¶å¤„ç†ã€‚</p>
</li>
<li><p>å½“æœ‰æ–°äº‹ä»¶å‘ç”Ÿæ—¶ï¼Œ Subreactor å°±ä¼šè°ƒç”¨å¯¹åº”çš„ handler å¤„ç†ã€‚</p>
</li>
<li><p>handler é€šè¿‡ read è¯»å–æ•°æ®ï¼Œåˆ†å‘ç»™åé¢çš„ worker çº¿ç¨‹å¤„ç†ã€‚</p>
</li>
<li><p>worker çº¿ç¨‹æ± åˆ†é…ç‹¬ç«‹çš„ worker çº¿ç¨‹è¿›è¡Œä¸šåŠ¡å¤„ç†ï¼Œå¹¶è¿”å›ç»“æœã€‚</p>
</li>
<li><p>handler æ”¶åˆ°å“åº”çš„ç»“æœåï¼Œå†é€šè¿‡ send å°†ç»“æœè¿”å›ç»™ clientã€‚</p>
</li>
<li><p><strong>Reactor ä¸»çº¿ç¨‹å¯ä»¥å¯¹åº”å¤šä¸ª Reactor å­çº¿ç¨‹ï¼Œå³ MainRecator å¯ä»¥å…³è”å¤šä¸ªSubReactor</strong>ã€‚</p>
</li>
</ol>
<h4 id="ä¼˜ç¼ºç‚¹åˆ†æ-2"><a href="#ä¼˜ç¼ºç‚¹åˆ†æ-2" class="headerlink" title="ä¼˜ç¼ºç‚¹åˆ†æ"></a>ä¼˜ç¼ºç‚¹åˆ†æ</h4><p>ä¼˜ç‚¹ï¼š</p>
<ol>
<li><p>çˆ¶çº¿ç¨‹ä¸å­çº¿ç¨‹çš„æ•°æ®äº¤äº’ç®€å•èŒè´£æ˜ç¡®ï¼Œçˆ¶çº¿ç¨‹åªéœ€è¦æ¥æ”¶æ–°è¿æ¥ï¼Œå­çº¿ç¨‹å®Œæˆåç»­çš„ä¸šåŠ¡å¤„ç†ã€‚</p>
</li>
<li><p>ä¼˜ç‚¹ï¼šçˆ¶çº¿ç¨‹ä¸å­çº¿ç¨‹çš„æ•°æ®äº¤äº’ç®€å•ï¼ŒReactor ä¸»çº¿ç¨‹åªéœ€è¦æŠŠæ–°è¿æ¥ä¼ ç»™å­çº¿ç¨‹ï¼Œå­çº¿ç¨‹æ— éœ€è¿”å›æ•°æ®ã€‚</p>
</li>
</ol>
<p>ç¼ºç‚¹ï¼šç¼–ç¨‹å¤æ‚åº¦è¾ƒé«˜</p>
<p>ç»“åˆå®ä¾‹ï¼šè¿™ç§æ¨¡å‹åœ¨è®¸å¤šé¡¹ç›®ä¸­å¹¿æ³›ä½¿ç”¨ï¼ŒåŒ…æ‹¬ Nginx ä¸»ä» Reactor å¤šè¿›ç¨‹æ¨¡å‹ï¼ŒMemcached ä¸»ä»å¤šçº¿ç¨‹ï¼ŒNetty ä¸»ä»å¤šçº¿ç¨‹æ¨¡å‹çš„æ”¯æŒã€‚</p>
<h4 id="Scalable-IO-in-Java-å¯¹-Multiple-Reactors-çš„åŸç†å›¾è§£"><a href="#Scalable-IO-in-Java-å¯¹-Multiple-Reactors-çš„åŸç†å›¾è§£" class="headerlink" title="Scalable IO in Java å¯¹ Multiple Reactors çš„åŸç†å›¾è§£"></a>Scalable IO in Java å¯¹ Multiple Reactors çš„åŸç†å›¾è§£</h4><img src="/2023/02/28/Netty/Java\Document\Netty\Netty å‚çœ‹æ–‡æ¡£.assets\image-20220919100722867.png" alt="image-20220919100722867" style="zoom:150%;">

<h3 id="Reactor-æ¨¡å¼å°ç»“"><a href="#Reactor-æ¨¡å¼å°ç»“" class="headerlink" title="Reactor æ¨¡å¼å°ç»“"></a>Reactor æ¨¡å¼å°ç»“</h3><p>3 ç§æ¨¡å¼ç”¨ç”Ÿæ´»æ¡ˆä¾‹æ¥ç†è§£</p>
<p>Ã˜ å• Reactor å•çº¿ç¨‹ï¼Œå‰å°æ¥å¾…å‘˜å’ŒæœåŠ¡å‘˜æ˜¯åŒä¸€ä¸ªäººï¼Œå…¨ç¨‹ä¸ºé¡¾å®¢æœåŠ¡</p>
<p>Ã˜ å• Reactor å¤šçº¿ç¨‹ï¼Œ1 ä¸ªå‰å°æ¥å¾…å‘˜ï¼Œå¤šä¸ªæœåŠ¡å‘˜ï¼Œæ¥å¾…å‘˜åªè´Ÿè´£æ¥å¾…</p>
<p>Ã˜ ä¸»ä» Reactor å¤šçº¿ç¨‹ï¼Œå¤šä¸ªå‰å°æ¥å¾…å‘˜ï¼Œå¤šä¸ªæœåŠ¡ç”Ÿ</p>
<p>Reactor æ¨¡å¼å…·æœ‰å¦‚ä¸‹çš„ä¼˜ç‚¹</p>
<ol>
<li><p>å“åº”å¿«ï¼Œä¸å¿…ä¸ºå•ä¸ªåŒæ­¥æ—¶é—´æ‰€é˜»å¡ï¼Œè™½ç„¶ Reactor æœ¬èº«ä¾ç„¶æ˜¯åŒæ­¥çš„ã€‚</p>
</li>
<li><p>å¯ä»¥æœ€å¤§ç¨‹åº¦çš„é¿å…å¤æ‚çš„å¤šçº¿ç¨‹åŠåŒæ­¥é—®é¢˜ï¼Œå¹¶ä¸”é¿å…äº†å¤šçº¿ç¨‹&#x2F;è¿›ç¨‹çš„åˆ‡æ¢å¼€é”€ã€‚</p>
</li>
<li><p>æ‰©å±•æ€§å¥½ï¼Œå¯ä»¥æ–¹ä¾¿çš„é€šè¿‡å¢åŠ  Reactor å®ä¾‹ä¸ªæ•°æ¥å……åˆ†åˆ©ç”¨ CPU èµ„æºã€‚</p>
</li>
<li><p>å¤ç”¨æ€§å¥½ï¼ŒReactor æ¨¡å‹æœ¬èº«ä¸å…·ä½“äº‹ä»¶å¤„ç†é€»è¾‘æ— å…³ï¼Œå…·æœ‰å¾ˆé«˜çš„å¤ç”¨æ€§ã€‚</p>
</li>
</ol>
<h2 id="Nettyæ¨¡å‹"><a href="#Nettyæ¨¡å‹" class="headerlink" title="Nettyæ¨¡å‹"></a>Nettyæ¨¡å‹</h2><h3 id="å·¥ä½œåŸç†å›¾ï¼šç®€å•ç‰ˆ"><a href="#å·¥ä½œåŸç†å›¾ï¼šç®€å•ç‰ˆ" class="headerlink" title="å·¥ä½œåŸç†å›¾ï¼šç®€å•ç‰ˆ"></a>å·¥ä½œåŸç†å›¾ï¼šç®€å•ç‰ˆ</h3><img src="/2023/02/28/Netty/Java\Document\Netty\Netty å‚çœ‹æ–‡æ¡£.assets\image-20220919100436410.png" alt="image-20220919100436410" style="zoom:150%;">

<p>è¯´æ˜ï¼š</p>
<ol>
<li><p>Netty ä¸»è¦åŸºäºä¸»ä» Reactors å¤šçº¿ç¨‹æ¨¡å‹ï¼ˆå¦‚å›¾ï¼‰åšäº†ä¸€å®šçš„æ”¹è¿›ï¼Œå…¶ä¸­ä¸»ä» Reactor å¤šçº¿ç¨‹æ¨¡å‹æœ‰å¤šä¸ª Reactorã€‚</p>
</li>
<li><p>BossGroup çº¿ç¨‹ç»´æŠ¤Selector ï¼Œåªå…³æ³¨Accecptã€‚</p>
</li>
<li><p>å½“æ¥æ”¶åˆ°Acceptäº‹ä»¶ï¼Œè·å–åˆ°å¯¹åº”çš„ SocketChannelï¼Œå°è£…æˆ NIOScoketChannel å¹¶æ³¨å†Œåˆ° Worker çº¿ç¨‹ï¼ˆäº‹ä»¶å¾ªç¯ç»„ï¼‰, å¹¶è¿›è¡Œç»´		æŠ¤ã€‚</p>
</li>
<li><p>å½“ Worker çº¿ç¨‹ç›‘å¬åˆ° Selector ä¸­é€šé“å‘ç”Ÿè‡ªå·±æ„Ÿå…´è¶£çš„äº‹ä»¶åï¼Œå°±ç”±handlerè¿›è¡Œå¤„ç†ï¼Œæ³¨æ„ Handler å·²ç»åŠ å…¥åˆ°é€šé“ã€‚</p>
</li>
</ol>
<h3 id="å·¥ä½œåŸç†å›¾ï¼šè¿›é˜¶ç‰ˆ"><a href="#å·¥ä½œåŸç†å›¾ï¼šè¿›é˜¶ç‰ˆ" class="headerlink" title="å·¥ä½œåŸç†å›¾ï¼šè¿›é˜¶ç‰ˆ"></a>å·¥ä½œåŸç†å›¾ï¼šè¿›é˜¶ç‰ˆ</h3><p>Netty ä¸»è¦åŸºäºä¸»ä» Reactors å¤šçº¿ç¨‹æ¨¡å‹ï¼ˆå¦‚å›¾ï¼‰åšäº†ä¸€å®šçš„æ”¹è¿›ï¼Œå…¶ä¸­ä¸»ä»Reactor å¤šçº¿ç¨‹æ¨¡å‹æœ‰å¤šä¸ª Reactorã€‚</p>
<img src="/2023/02/28/Netty/Java\Document\Netty\Netty å‚çœ‹æ–‡æ¡£.assets\image-20220919100632295.png" alt="image-20220919100632295" style="zoom:150%;">

<h3 id="å·¥ä½œåŸç†å›¾ï¼šè¯¦ç»†ç‰ˆ"><a href="#å·¥ä½œåŸç†å›¾ï¼šè¯¦ç»†ç‰ˆ" class="headerlink" title="å·¥ä½œåŸç†å›¾ï¼šè¯¦ç»†ç‰ˆ"></a>å·¥ä½œåŸç†å›¾ï¼šè¯¦ç»†ç‰ˆ</h3><img src="/2023/02/28/Netty/Java\Document\Netty\Netty å‚çœ‹æ–‡æ¡£.assets\image-20220919100839638.png" alt="image-20220919100839638" style="zoom:150%;">

<p>è¯´æ˜ï¼š</p>
<ol>
<li><p>NettyæŠ½è±¡å‡ºä¸¤ç»„çº¿ç¨‹æ±  BossGroup ä¸“é—¨è´Ÿè´£æ¥æ”¶å®¢æˆ·ç«¯çš„è¿æ¥ï¼ŒWorkerGroup ä¸“é—¨è´Ÿè´£ç½‘ç»œçš„è¯»å†™ã€‚</p>
</li>
<li><p>BossGroup å’Œ WorkerGroup ç±»å‹éƒ½æ˜¯ NioEventLoopGroupã€‚</p>
</li>
<li><p>NioEventLoopGroup ç›¸å½“äºä¸€ä¸ªäº‹ä»¶å¾ªç¯ç»„, è¿™ä¸ªç»„ä¸­å«æœ‰å¤šä¸ªäº‹ä»¶å¾ªç¯ï¼Œæ¯ä¸€ä¸ªäº‹ä»¶å¾ªç¯æ˜¯ NioEventLoopã€‚</p>
</li>
<li><p>NioEventLoop è¡¨ç¤ºä¸€ä¸ªä¸æ–­å¾ªç¯çš„æ‰§è¡Œå¤„ç†ä»»åŠ¡çš„çº¿ç¨‹ï¼Œæ¯ä¸ªNioEventLoop éƒ½æœ‰ä¸€ä¸ªselector , ç”¨äºç›‘å¬ç»‘å®šåœ¨å…¶ä¸Šçš„socketçš„ç½‘		ç»œé€šè®¯ã€‚</p>
</li>
<li><p>NioEventLoopGroup å¯ä»¥æœ‰å¤šä¸ªçº¿ç¨‹ï¼Œå³å¯ä»¥å«æœ‰å¤šä¸ªNioEventLoopã€‚</p>
</li>
<li><p>æ¯ä¸ªBossNioEventLoop å¾ªç¯æ‰§è¡Œçš„æ­¥éª¤æœ‰3æ­¥ï¼š</p>
</li>
</ol>
<ol>
<li><p>è½®è¯¢ accept äº‹ä»¶ã€‚</p>
</li>
<li><p>å¤„ç† accept äº‹ä»¶ , ä¸ client å»ºç«‹è¿æ¥ , ç”ŸæˆNioScocketChannel , å¹¶å°†å…¶æ³¨å†Œåˆ°æŸä¸ªworker NIOEventLoop ä¸Šçš„ selector ã€‚</p>
</li>
<li><p>å¤„ç†ä»»åŠ¡é˜Ÿåˆ—çš„ä»»åŠ¡ï¼Œå³ runAllTasksã€‚</p>
</li>
</ol>
<ol start="7">
<li>æ¯ä¸ªWorker NIOEventLoop å¾ªç¯æ‰§è¡Œçš„æ­¥éª¤ï¼š</li>
</ol>
<ol>
<li><p>è½®è¯¢ read, write äº‹ä»¶ã€‚</p>
</li>
<li><p>å¤„ç† I&#x2F;O äº‹ä»¶ï¼Œå³ read, write äº‹ä»¶ï¼Œåœ¨å¯¹åº” NioScocketChannel å¤„ç†ã€‚</p>
</li>
<li><p>å¤„ç†ä»»åŠ¡é˜Ÿåˆ—çš„ä»»åŠ¡ï¼Œå³ runAllTasksã€‚</p>
</li>
</ol>
<ol start="8">
<li>æ¯ä¸ªWorker NIOEventLoop å¤„ç†ä¸šåŠ¡æ—¶ï¼Œä¼šä½¿ç”¨pipeline(ç®¡é“)ï¼Œpipeline ä¸­åŒ…å«äº† channel , å³é€šè¿‡pipeline å¯ä»¥è·å–åˆ°å¯¹åº”é€šé“,</li>
</ol>
<p>â€‹		ç®¡é“ä¸­ç»´æŠ¤äº†å¾ˆå¤šçš„å¤„ç†å™¨ã€‚</p>
<h3 id="Netty-å…¥é—¨ç¤ºä¾‹ï¼šTCPæœåŠ¡"><a href="#Netty-å…¥é—¨ç¤ºä¾‹ï¼šTCPæœåŠ¡" class="headerlink" title="Netty å…¥é—¨ç¤ºä¾‹ï¼šTCPæœåŠ¡"></a>Netty å…¥é—¨ç¤ºä¾‹ï¼šTCPæœåŠ¡</h3><p>ç¨‹åºè¦æ±‚ï¼šç›‘å¬8000ç«¯å£ï¼Œå®¢æˆ·ç«¯å‘é€æ¶ˆæ¯ï¼ŒæœåŠ¡ç«¯è¿›è¡Œå“åº”ã€‚</p>
<p>NettyServerï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.mineting.netty.simple;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> io.netty.bootstrap.ServerBootstrap;</span><br><span class="line"><span class="keyword">import</span> io.netty.channel.ChannelFuture;</span><br><span class="line"><span class="keyword">import</span> io.netty.channel.ChannelInitializer;</span><br><span class="line"><span class="keyword">import</span> io.netty.channel.ChannelOption;</span><br><span class="line"><span class="keyword">import</span> io.netty.channel.nio.NioEventLoopGroup;</span><br><span class="line"><span class="keyword">import</span> io.netty.channel.socket.SocketChannel;</span><br><span class="line"><span class="keyword">import</span> io.netty.channel.socket.nio.NioServerSocketChannel;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">NettyServer</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">            1. åˆ›å»ºä¸¤ä¸ªçº¿ç¨‹ç»„ bossGroupå’ŒWorkerGroup</span></span><br><span class="line"><span class="comment">            2. bossGroupåªè´Ÿè´£å¤„ç†è¿æ¥è¯·æ±‚ï¼ŒçœŸæ­£çš„å’Œå®¢æˆ·ç«¯è¿›è¡Œä¸šåŠ¡å¤„ç†çš„ä¼šäº¤ç»™ workerGroup</span></span><br><span class="line"><span class="comment">            3. ä¸¤ä¸ªéƒ½æ˜¯æ— é™å¾ªç¯ä¸ª</span></span><br><span class="line"><span class="comment">            4. bossGroupå’ŒworkerGroupå«æœ‰å­çº¿ç¨‹ï¼ˆNioEventLoopï¼‰çš„æ•°ï¼Œé»˜è®¤å®é™… CPUæ ¸æ•° * 2</span></span><br><span class="line"><span class="comment">        */</span></span><br><span class="line">        <span class="type">NioEventLoopGroup</span> <span class="variable">bossGroup</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">NioEventLoopGroup</span>(<span class="number">1</span>);</span><br><span class="line">        <span class="type">NioEventLoopGroup</span> <span class="variable">workerGroup</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">NioEventLoopGroup</span>();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">//åˆ›å»ºæœåŠ¡å™¨ç«¯çš„å¯åŠ¨å¯¹è±¡ï¼Œé…ç½®å‚æ•°</span></span><br><span class="line">            <span class="type">ServerBootstrap</span> <span class="variable">serverBootstrap</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ServerBootstrap</span>();</span><br><span class="line">            serverBootstrap</span><br><span class="line">                    <span class="comment">// è®¾ç½®ä¸¤ä¸ªçº¿ç¨‹ç»„</span></span><br><span class="line">                    .group(bossGroup, workerGroup)</span><br><span class="line">                    <span class="comment">// æœåŠ¡ç«¯ä½¿ç”¨ NioServerSocketChannel ä½œä¸ºæœåŠ¡å™¨çš„é€šé“å®ç°</span></span><br><span class="line">                    .channel(NioServerSocketChannel.class)</span><br><span class="line">                    <span class="comment">// è®¾ç½®çº¿ç¨‹é˜Ÿåˆ—å¾—åˆ°è¿æ¥ä¸ªæ•°</span></span><br><span class="line">                    .option(ChannelOption.SO_BACKLOG, <span class="number">128</span>)</span><br><span class="line">                    <span class="comment">// è®¾ç½®ä¿æŒæ´»åŠ¨è¿æ¥çŠ¶æ€</span></span><br><span class="line">                    .childOption(ChannelOption.SO_KEEPALIVE, <span class="literal">true</span>)</span><br><span class="line">                    <span class="comment">// è®¾ç½®æœåŠ¡ç«¯æ“ä½œ</span></span><br><span class="line">                    .handler(<span class="keyword">new</span> <span class="title class_">LoggingHandler</span>(LogLevel.INFO))</span><br><span class="line">                    .childHandler(<span class="keyword">new</span> <span class="title class_">ChannelInitializer</span>&lt;SocketChannel&gt;() &#123;</span><br><span class="line">                        <span class="meta">@Override</span></span><br><span class="line">                        <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">initChannel</span><span class="params">(SocketChannel socketChannel)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">                            <span class="comment">// ç»™workerGroupçš„EventLoopå¯¹åº”çš„ç®¡é“è®¾ç½®å¤„ç†å™¨</span></span><br><span class="line">                            socketChannel.pipeline().addLast(<span class="keyword">new</span> <span class="title class_">NettyServerHandler</span>());</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;);</span><br><span class="line">            System.out.println(<span class="string">&quot;Netty Server Is Ready...&quot;</span>);</span><br><span class="line">            <span class="comment">//ç»‘å®šç«¯å£å¹¶ä¸”åŒæ­¥ï¼Œå¯åŠ¨æœåŠ¡å™¨ï¼Œç”Ÿæˆä¸€ä¸ªChannelFutureå¯¹è±¡</span></span><br><span class="line">            <span class="type">ChannelFuture</span> <span class="variable">cf</span> <span class="operator">=</span> serverBootstrap.bind(<span class="number">8000</span>).sync();</span><br><span class="line">            <span class="comment">// å¯¹å…³é—­é€šé“äº‹ä»¶è¿›è¡Œç›‘å¬ï¼Œæ³¨æ„æ­¤å¤„æ˜¯ closeFuture è€Œä¸æ˜¯ close,å¦åˆ™å¯åŠ¨ä¾¿ä¼šå…³é—­</span></span><br><span class="line">            cf.channel().closeFuture().sync();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            bossGroup.shutdownGracefully();</span><br><span class="line">            workerGroup.shutdownGracefully();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>NettyServerHandlerï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.mineting.netty.simple;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> io.netty.buffer.ByteBuf;</span><br><span class="line"><span class="keyword">import</span> io.netty.buffer.Unpooled;</span><br><span class="line"><span class="keyword">import</span> io.netty.channel.Channel;</span><br><span class="line"><span class="keyword">import</span> io.netty.channel.ChannelHandlerContext;</span><br><span class="line"><span class="keyword">import</span> io.netty.channel.ChannelInboundHandlerAdapter;</span><br><span class="line"><span class="keyword">import</span> io.netty.channel.ChannelPipeline;</span><br><span class="line"><span class="keyword">import</span> io.netty.util.CharsetUtil;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.nio.charset.Charset;</span><br><span class="line"><span class="keyword">import</span> java.nio.charset.StandardCharsets;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">NettyServerHandler</span> <span class="keyword">extends</span> <span class="title class_">ChannelInboundHandlerAdapter</span> &#123;</span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">        å½“é€šé“ç”±è¯»å–äº‹ä»¶å‘ç”Ÿæ—¶å°±ä¼šè§¦å‘è¯¥æ–¹æ³•</span></span><br><span class="line"><span class="comment">        ChannelHandlerContext ä¸Šä¸‹æ–‡å¯¹è±¡ï¼Œå«æœ‰ç®¡é“pipelineï¼Œé€šé“channelï¼Œåœ°å€ç­‰ä¿¡æ¯</span></span><br><span class="line"><span class="comment">        Object msg å®¢æˆ·ç«¯å‘é€çš„æ•°æ®ï¼Œé»˜è®¤Objectï¼Œå¯ä»¥æŒ‡å®šæ³›å‹</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">channelRead</span><span class="params">(ChannelHandlerContext ctx, Object msg)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;æœåŠ¡å™¨è¯»å–çº¿ç¨‹ï¼š&quot;</span> + Thread.currentThread().getName());</span><br><span class="line">        System.out.println(<span class="string">&quot;server ctx: &quot;</span> + ctx);</span><br><span class="line">        <span class="type">Channel</span> <span class="variable">channel</span> <span class="operator">=</span> ctx.channel();</span><br><span class="line">        <span class="comment">//æœ¬è´¨æ˜¯ä¸€ä¸ªåŒå‘é“¾è¡¨ï¼Œå…·æœ‰å‡ºæ ˆå…¥æ ˆ</span></span><br><span class="line">        <span class="type">ChannelPipeline</span> <span class="variable">pipeline</span> <span class="operator">=</span> ctx.pipeline();</span><br><span class="line">        <span class="comment">//å°†msgè½¬ä¸ºByteBuf  ByteBufæ˜¯ç”±Nettyæä¾›çš„ï¼Œä¸æ˜¯NIOçš„ByteBuffer</span></span><br><span class="line">        <span class="type">ByteBuf</span> <span class="variable">byteBuf</span> <span class="operator">=</span> (ByteBuf) msg;</span><br><span class="line">        System.out.println(<span class="string">&quot;å®¢æˆ·ç«¯å‘é€çš„æ¶ˆæ¯ï¼š&quot;</span> + byteBuf.toString(CharsetUtil.UTF_8));</span><br><span class="line">        <span class="comment">//System.out.println(&quot;å®¢æˆ·ç«¯å‘é€çš„æ¶ˆæ¯ï¼š&quot; + byteBuf.toString(StandardCharsets.UTF_8));</span></span><br><span class="line">        <span class="comment">//System.out.println(&quot;å®¢æˆ·ç«¯å‘é€çš„æ¶ˆæ¯ï¼š&quot; + byteBuf.toString(Charset.forName(&quot;utf-8&quot;)));</span></span><br><span class="line">        System.out.println(<span class="string">&quot;å®¢æˆ·ç«¯çš„åœ°å€ï¼š&quot;</span> + channel.remoteAddress());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//æ•°æ®è¯»å–å®Œæ¯•</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">channelReadComplete</span><span class="params">(ChannelHandlerContext ctx)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="comment">//å°†æ•°æ®å†™å…¥åˆ°ç¼“å­˜ï¼Œå¹¶åˆ·æ–°ï¼Œä¸€èˆ¬å¯¹å‘é€çš„æ•°æ®è¿›è¡Œç¼–ç </span></span><br><span class="line">        ctx.writeAndFlush(Unpooled.copiedBuffer(<span class="string">&quot;Hello,Client!&quot;</span>, StandardCharsets.UTF_8));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//å¤„ç†å¼‚å¸¸ï¼Œä¸€èˆ¬æ˜¯å…³é—­é€šé“</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">exceptionCaught</span><span class="params">(ChannelHandlerContext ctx, Throwable cause)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        ctx.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>NettyClientï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.mineting.netty.simple;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> io.netty.bootstrap.Bootstrap;</span><br><span class="line"><span class="keyword">import</span> io.netty.channel.ChannelFuture;</span><br><span class="line"><span class="keyword">import</span> io.netty.channel.ChannelInitializer;</span><br><span class="line"><span class="keyword">import</span> io.netty.channel.nio.NioEventLoopGroup;</span><br><span class="line"><span class="keyword">import</span> io.netty.channel.socket.SocketChannel;</span><br><span class="line"><span class="keyword">import</span> io.netty.channel.socket.nio.NioSocketChannel;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">NettyClient</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">//å®¢æˆ·ç«¯éœ€è¦ä¸€ä¸ªäº‹ä»¶å¾ªç¯ç»„</span></span><br><span class="line">        <span class="type">NioEventLoopGroup</span> <span class="variable">eventLoopGroup</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">NioEventLoopGroup</span>();</span><br><span class="line">        <span class="keyword">try</span>&#123;</span><br><span class="line">            <span class="comment">//åˆ›å»ºå®¢æˆ·ç«¯å¯åŠ¨å¯¹è±¡,æ³¨æ„å®¢æˆ·ç«¯ä½¿ç”¨çš„æ˜¯Bootstrap,ä¸æ˜¯ServerBootstrap</span></span><br><span class="line">            <span class="type">Bootstrap</span> <span class="variable">bootstrap</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Bootstrap</span>();</span><br><span class="line">            bootstrap</span><br><span class="line">                    .group(eventLoopGroup)</span><br><span class="line">                    .channel(NioSocketChannel.class)</span><br><span class="line">                    .handler(<span class="keyword">new</span> <span class="title class_">ChannelInitializer</span>&lt;SocketChannel&gt;() &#123;</span><br><span class="line">                        <span class="meta">@Override</span></span><br><span class="line">                        <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">initChannel</span><span class="params">(SocketChannel socketChannel)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">                            socketChannel.pipeline().addLast(<span class="keyword">new</span> <span class="title class_">NettyClientHandler</span>());</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;);</span><br><span class="line">            System.out.println(<span class="string">&quot;Client Is Ready...&quot;</span>);</span><br><span class="line">            <span class="type">ChannelFuture</span> <span class="variable">channelFuture</span> <span class="operator">=</span> bootstrap.connect(<span class="string">&quot;127.0.0.1&quot;</span>, <span class="number">8000</span>).sync();</span><br><span class="line">            <span class="comment">//ç›‘å¬é€šé“å…³é—­</span></span><br><span class="line">            channelFuture.channel().closeFuture().sync();</span><br><span class="line">        &#125;<span class="keyword">catch</span> (Exception e)&#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;<span class="keyword">finally</span> &#123;</span><br><span class="line">            eventLoopGroup.shutdownGracefully();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>NettyClientHandlerï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.mineting.netty.simple;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> io.netty.buffer.ByteBuf;</span><br><span class="line"><span class="keyword">import</span> io.netty.buffer.Unpooled;</span><br><span class="line"><span class="keyword">import</span> io.netty.channel.ChannelHandlerContext;</span><br><span class="line"><span class="keyword">import</span> io.netty.channel.ChannelInboundHandlerAdapter;</span><br><span class="line"><span class="keyword">import</span> io.netty.util.CharsetUtil;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.nio.charset.StandardCharsets;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">NettyClientHandler</span> <span class="keyword">extends</span> <span class="title class_">ChannelInboundHandlerAdapter</span> &#123;</span><br><span class="line">    <span class="comment">//å½“é€šé“å°±ç»ªå°±ä¼šè§¦å‘è¯¥æ–¹æ³•</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">channelActive</span><span class="params">(ChannelHandlerContext ctx)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;client: &quot;</span> + ctx);</span><br><span class="line">        ctx.channel().writeAndFlush(Unpooled.copiedBuffer(<span class="string">&quot;Hello,Server!&quot;</span>, CharsetUtil.UTF_8));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//å½“é€šé“ç”±è¯»å–äº‹ä»¶å‘ç”Ÿæ—¶å°±ä¼šè§¦å‘</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">channelRead</span><span class="params">(ChannelHandlerContext ctx, Object msg)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">ByteBuf</span> <span class="variable">byteBuf</span> <span class="operator">=</span> (ByteBuf) msg;</span><br><span class="line">        System.out.println(<span class="string">&quot;æœåŠ¡å™¨å›å¤çš„æ¶ˆæ¯ï¼š&quot;</span> + byteBuf.toString(StandardCharsets.UTF_8));</span><br><span class="line">        System.out.println(<span class="string">&quot;æœåŠ¡å™¨ç«¯çš„åœ°å€ï¼š&quot;</span> + ctx.channel().remoteAddress());</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//å¼‚å¸¸å¤„ç†</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">exceptionCaught</span><span class="params">(ChannelHandlerContext ctx, Throwable cause)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        ctx.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æµ‹è¯• Nettyåˆ›å»ºçº¿ç¨‹æ•°é‡ï¼Œé»˜è®¤CPUæ ¸æ•° * 2</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">NettyCpuTest</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;CPUæ ¸æ•°ï¼š&quot;</span> + NettyRuntime.availableProcessors());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="ä»»åŠ¡é˜Ÿåˆ—ä¸­çš„-Task-3-ç§å…¸å‹ä½¿ç”¨åœºæ™¯"><a href="#ä»»åŠ¡é˜Ÿåˆ—ä¸­çš„-Task-3-ç§å…¸å‹ä½¿ç”¨åœºæ™¯" class="headerlink" title="ä»»åŠ¡é˜Ÿåˆ—ä¸­çš„ Task 3 ç§å…¸å‹ä½¿ç”¨åœºæ™¯"></a>ä»»åŠ¡é˜Ÿåˆ—ä¸­çš„ Task 3 ç§å…¸å‹ä½¿ç”¨åœºæ™¯</h3><ol>
<li><p>ç”¨æˆ·ç¨‹åºè‡ªå®šä¹‰çš„æ™®é€šä»»åŠ¡</p>
</li>
<li><p>ç”¨æˆ·è‡ªå®šä¹‰å®šæ—¶ä»»åŠ¡</p>
</li>
<li><p>éå½“å‰ Reactor çº¿ç¨‹è°ƒç”¨ Channel çš„å„ç§æ–¹æ³•ã€‚ä¾‹å¦‚åœ¨æ¨é€ç³»ç»Ÿçš„ä¸šåŠ¡çº¿ç¨‹é‡Œé¢ï¼Œæ ¹æ®ç”¨æˆ·çš„æ ‡è¯†ï¼Œæ‰¾åˆ°å¯¹åº”çš„ Channel å¼•ç”¨ï¼Œç„¶		åè°ƒç”¨ Write ç±»æ–¹æ³•å‘è¯¥ç”¨æˆ·æ¨é€æ¶ˆæ¯ï¼Œå°±ä¼šè¿›å…¥åˆ°è¿™ç§åœºæ™¯ã€‚æœ€ç»ˆçš„ Write ä¼šæäº¤åˆ°ä»»åŠ¡é˜Ÿåˆ—ä¸­åè¢«å¼‚æ­¥æ¶ˆè´¹ã€‚</p>
</li>
</ol>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">channelRead</span><span class="params">(ChannelHandlerContext ctx, Object msg)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">       <span class="comment">// å¯¹äºæ¯”è¾ƒè€—æ—¶çš„ä»»åŠ¡ï¼ˆè‡ªå®šä¹‰çš„æ™®é€šä»»åŠ¡ï¼Œä¼šæäº¤åˆ° TaskQueue ä¸­ï¼‰ï¼š--&gt;å¼‚æ­¥æ‰§è¡Œ</span></span><br><span class="line">       ctx.channel().eventLoop().execute(() -&gt; &#123;</span><br><span class="line">           <span class="keyword">try</span> &#123;</span><br><span class="line">               TimeUnit.SECONDS.sleep(<span class="number">3</span>);</span><br><span class="line">               ctx.writeAndFlush(Unpooled.copiedBuffer(<span class="string">&quot;HelloClient2...&quot;</span>, CharsetUtil.UTF_8));</span><br><span class="line">               System.out.println(<span class="string">&quot;channel2 code: &quot;</span> + ctx.channel().hashCode());</span><br><span class="line">           &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">               e.printStackTrace();</span><br><span class="line">           &#125;</span><br><span class="line">       &#125;);</span><br><span class="line">       <span class="comment">// ç”¨æˆ·è‡ªå®šä¹‰å®šæ—¶ä»»åŠ¡ï¼Œè¯¥ä»»åŠ¡ä¼šæäº¤åˆ° scheduleTaskQueue ä¸­</span></span><br><span class="line">       ctx.channel().eventLoop().schedule(() -&gt; &#123;</span><br><span class="line">           <span class="keyword">try</span> &#123;</span><br><span class="line">               TimeUnit.SECONDS.sleep(<span class="number">3</span>);</span><br><span class="line">               ctx.writeAndFlush(Unpooled.copiedBuffer(<span class="string">&quot;HelloClient3...&quot;</span>, CharsetUtil.UTF_8));</span><br><span class="line">               System.out.println(<span class="string">&quot;channel3 code: &quot;</span> + ctx.channel().hashCode());</span><br><span class="line">           &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">               e.printStackTrace();</span><br><span class="line">           &#125;</span><br><span class="line">       &#125;, <span class="number">5</span>, TimeUnit.SECONDS);</span><br><span class="line">       <span class="comment">// éå½“å‰ Reactor çº¿ç¨‹è°ƒç”¨ Channel çš„å„ç§æ–¹æ³•ï¼Œå¦‚æ¨é€ä¸šåŠ¡ï¼šæ‹¿åˆ°å„ä¸ª Channel ,åœ¨eventLoopä¸­éå†æ·»åŠ äº‹ä»¶</span></span><br><span class="line">       System.out.println(<span class="string">&quot;go on ...&quot;</span>);</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<h3 id="ç¤ºä¾‹æ€»ç»“"><a href="#ç¤ºä¾‹æ€»ç»“" class="headerlink" title="ç¤ºä¾‹æ€»ç»“"></a>ç¤ºä¾‹æ€»ç»“</h3><ol>
<li><p>Netty æŠ½è±¡å‡ºä¸¤ç»„çº¿ç¨‹æ± ï¼ŒBossGroup ä¸“é—¨è´Ÿè´£æ¥æ”¶å®¢æˆ·ç«¯è¿æ¥ï¼ŒWorkerGroup ä¸“é—¨è´Ÿè´£ç½‘ç»œè¯»å†™æ“ä½œã€‚</p>
</li>
<li><p>NioEventLoop è¡¨ç¤ºä¸€ä¸ªä¸æ–­å¾ªç¯æ‰§è¡Œå¤„ç†ä»»åŠ¡çš„çº¿ç¨‹ï¼Œæ¯ä¸ª NioEventLoop éƒ½æœ‰ä¸€ä¸ª selectorï¼Œç”¨äºç›‘å¬ç»‘å®šåœ¨å…¶ä¸Šçš„ socket ç½‘ç»œ		é€šé“ã€‚</p>
</li>
<li><p>NioEventLoop å†…éƒ¨é‡‡ç”¨ä¸²è¡ŒåŒ–è®¾è®¡ï¼Œä»æ¶ˆæ¯çš„è¯»å– â€“&gt; è§£ç  â€“&gt; å¤„ç† â€“&gt; ç¼–ç  â€“&gt; å‘é€ï¼Œå§‹ç»ˆç”± IO çº¿ç¨‹ NioEventLoop è´Ÿè´£ã€‚</p>
</li>
<li><p>NioEventLoopGroup ä¸‹åŒ…å«å¤šä¸ª NioEventLoopï¼š</p>
</li>
</ol>
<ul>
<li>æ¯ä¸ª NioEventLoop ä¸­åŒ…å«æœ‰ä¸€ä¸ª Selectorï¼Œä¸€ä¸ª taskQueueã€‚</li>
<li>æ¯ä¸ª NioEventLoop çš„ Selector ä¸Šå¯ä»¥æ³¨å†Œç›‘å¬å¤šä¸ª NioChannelã€‚</li>
<li>æ¯ä¸ª NioChannel åªä¼šç»‘å®šåœ¨å”¯ä¸€çš„ NioEventLoop ä¸Šã€‚</li>
<li>æ¯ä¸ª NioChannel éƒ½ç»‘å®šæœ‰ä¸€ä¸ªè‡ªå·±çš„ ChannelPipelineã€‚</li>
</ul>
<h3 id="å¼‚æ­¥æ¨¡å‹"><a href="#å¼‚æ­¥æ¨¡å‹" class="headerlink" title="å¼‚æ­¥æ¨¡å‹"></a>å¼‚æ­¥æ¨¡å‹</h3><h4 id="åŸºæœ¬ä»‹ç»-4"><a href="#åŸºæœ¬ä»‹ç»-4" class="headerlink" title="åŸºæœ¬ä»‹ç»"></a>åŸºæœ¬ä»‹ç»</h4><p>â€‹		å¼‚æ­¥çš„æ¦‚å¿µå’ŒåŒæ­¥ç›¸å¯¹ã€‚å½“ä¸€ä¸ªå¼‚æ­¥è¿‡ç¨‹è°ƒç”¨å‘å‡ºåï¼Œè°ƒç”¨è€…ä¸èƒ½ç«‹åˆ»å¾—åˆ°ç»“æœã€‚å®é™…å¤„ç†è¿™ä¸ªè°ƒç”¨çš„ç»„ä»¶åœ¨å®Œæˆåï¼Œé€šè¿‡çŠ¶æ€ã€é€šçŸ¥å’Œå›è°ƒæ¥é€šçŸ¥è°ƒç”¨è€…ã€‚</p>
<p>Netty ä¸­çš„ I&#x2F;O æ“ä½œæ˜¯å¼‚æ­¥çš„ï¼ŒåŒ…æ‹¬ <strong>Bindã€Writeã€Connect</strong> ç­‰æ“ä½œä¼šç®€å•çš„è¿”å›ä¸€ä¸ª ChannelFutureã€‚</p>
<p>è°ƒç”¨è€…å¹¶ä¸èƒ½ç«‹åˆ»è·å¾—ç»“æœï¼Œè€Œæ˜¯é€šè¿‡ Future-Listener æœºåˆ¶ï¼Œç”¨æˆ·å¯ä»¥æ–¹ä¾¿çš„ä¸»åŠ¨è·å–æˆ–è€…é€šè¿‡é€šçŸ¥æœºåˆ¶è·å¾— IO æ“ä½œç»“æœã€‚</p>
<p>Netty çš„å¼‚æ­¥æ¨¡å‹æ˜¯å»ºç«‹åœ¨ future å’Œ callback ä¹‹ä¸Šçš„ã€‚callback å°±æ˜¯å›è°ƒã€‚é‡ç‚¹è¯´ Futureï¼Œå®ƒçš„æ ¸å¿ƒæ€æƒ³æ˜¯ï¼šå‡è®¾ä¸€ä¸ªæ–¹æ³• funï¼Œè®¡ç®—è¿‡ç¨‹å¯èƒ½éå¸¸è€—æ—¶ï¼Œç­‰å¾… funè¿”å›æ˜¾ç„¶ä¸åˆé€‚ã€‚é‚£ä¹ˆå¯ä»¥åœ¨è°ƒç”¨ fun çš„æ—¶å€™ï¼Œç«‹é©¬è¿”å›ä¸€ä¸ª Futureï¼Œåç»­å¯ä»¥é€šè¿‡ Futureå»ç›‘æ§æ–¹æ³• fun çš„å¤„ç†è¿‡ç¨‹(å³ ï¼šFuture-Listener æœºåˆ¶)ã€‚</p>
<h4 id="Future-è¯´æ˜"><a href="#Future-è¯´æ˜" class="headerlink" title="Future è¯´æ˜"></a>Future è¯´æ˜</h4><p>â€‹		Future è¡¨ç¤ºå¼‚æ­¥çš„æ‰§è¡Œç»“æœï¼Œå¯ä»¥é€šè¿‡å®ƒæä¾›çš„æ–¹æ³•æ¥æ£€æµ‹æ‰§è¡Œæ˜¯å¦å®Œæˆï¼Œæ¯”å¦‚æ£€ç´¢ã€è®¡ç®—ç­‰ã€‚</p>
<p>ChannelFuture æ˜¯ä¸€ä¸ªæ¥å£ ï¼š </p>
<p>public interface ChannelFuture extends Future<Void></Void></p>
<p>å¯ä»¥æ·»åŠ ç›‘å¬å™¨ï¼Œå½“ç›‘å¬çš„äº‹ä»¶å‘ç”Ÿæ—¶ï¼Œå°±ä¼šé€šçŸ¥åˆ°ç›‘å¬å™¨ã€‚</p>
<h4 id="å·¥ä½œåŸç†å›¾-4"><a href="#å·¥ä½œåŸç†å›¾-4" class="headerlink" title="å·¥ä½œåŸç†å›¾"></a>å·¥ä½œåŸç†å›¾</h4><img src="/2023/02/28/Netty/Java\Document\Netty\Netty å‚çœ‹æ–‡æ¡£.assets\image-20220919113947886.png" alt="image-20220919113947886" style="zoom:150%;">

<p>è¯´æ˜</p>
<p>â€‹		åœ¨ä½¿ç”¨ Netty è¿›è¡Œç¼–ç¨‹æ—¶ï¼Œæ‹¦æˆªæ“ä½œå’Œè½¬æ¢å‡ºå…¥ç«™æ•°æ®åªéœ€è¦æ‚¨æä¾› callback æˆ–åˆ©ç”¨ future å³å¯ã€‚è¿™ä½¿å¾—é“¾å¼æ“ä½œç®€å•ã€é«˜æ•ˆï¼Œå¹¶æœ‰åˆ©äºç¼–å†™å¯é‡ç”¨çš„ã€é€šç”¨çš„ä»£ç ã€‚Netty æ¡†æ¶çš„ç›®æ ‡å°±æ˜¯è®©ä½ çš„ä¸šåŠ¡é€»è¾‘ä»ç½‘ç»œåŸºç¡€åº”ç”¨ç¼–ç ä¸­åˆ†ç¦»å‡ºæ¥ã€è§£è„±å‡ºæ¥ã€‚</p>
<h4 id="Future-Listener-æœºåˆ¶"><a href="#Future-Listener-æœºåˆ¶" class="headerlink" title="Future-Listener æœºåˆ¶"></a>Future-Listener æœºåˆ¶</h4><p>â€‹		å½“ Future å¯¹è±¡åˆšåˆšåˆ›å»ºæ—¶ï¼Œå¤„äºæœªå®ŒæˆçŠ¶æ€ï¼Œè°ƒç”¨è€…å¯ä»¥é€šè¿‡è¿”å›çš„ ChannelFuture æ¥è·å–æ“ä½œæ‰§è¡Œçš„çŠ¶æ€ï¼Œæ³¨å†Œç›‘å¬å‡½æ•°æ¥æ‰§è¡Œå®Œæˆåçš„æ“ä½œã€‚</p>
<p>å¸¸è§æœ‰å¦‚ä¸‹æ“ä½œï¼š</p>
<ul>
<li>é€šè¿‡ isDone æ–¹æ³•æ¥åˆ¤æ–­å½“å‰æ“ä½œæ˜¯å¦å®Œæˆï¼›</li>
<li>é€šè¿‡ isSuccess æ–¹æ³•æ¥åˆ¤æ–­å·²å®Œæˆçš„å½“å‰æ“ä½œæ˜¯å¦æˆåŠŸï¼›</li>
<li>é€šè¿‡ getCause æ–¹æ³•æ¥è·å–å·²å®Œæˆçš„å½“å‰æ“ä½œå¤±è´¥çš„åŸå› ï¼›</li>
<li>é€šè¿‡ isCancelled æ–¹æ³•æ¥åˆ¤æ–­å·²å®Œæˆçš„å½“å‰æ“ä½œæ˜¯å¦è¢«å–æ¶ˆï¼›</li>
</ul>
<p>é€šè¿‡ addListener æ–¹æ³•æ¥æ³¨å†Œç›‘å¬å™¨ï¼Œå½“æ“ä½œå·²å®Œæˆï¼ˆisDone æ–¹æ³•è¿”å›å®Œæˆï¼‰ï¼Œå°†ä¼šé€šçŸ¥æŒ‡å®šçš„ç›‘å¬å™¨ï¼›å¦‚æœ Future å¯¹è±¡å·²å®Œæˆï¼Œåˆ™é€šçŸ¥æŒ‡å®šçš„ç›‘å¬å™¨ã€‚</p>
<p>ç¤ºä¾‹ï¼šç»‘å®šç«¯å£æ˜¯å¼‚æ­¥æ“ä½œï¼Œå½“ç»‘å®šæ“ä½œå¤„ç†å®Œï¼Œå°†ä¼šè°ƒç”¨ç›¸åº”çš„ç›‘å¬å™¨å¤„ç†é€»è¾‘ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">cf.addListener(<span class="keyword">new</span> <span class="title class_">ChannelFutureListener</span>() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">operationComplete</span><span class="params">(ChannelFuture channelFuture)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="keyword">if</span> (channelFuture.isSuccess()) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;ç›‘å¬ç«¯å£æˆåŠŸ&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;ç›‘å¬ç«¯å£å¤±è´¥&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>ç›¸æ¯”ä¼ ç»Ÿé˜»å¡ I&#x2F;Oï¼Œæ‰§è¡Œ I&#x2F;O æ“ä½œåçº¿ç¨‹ä¼šè¢«é˜»å¡ä½, ç›´åˆ°æ“ä½œå®Œæˆï¼›</p>
<p>å¼‚æ­¥å¤„ç†çš„å¥½å¤„æ˜¯ä¸ä¼šé€ æˆçº¿ç¨‹é˜»å¡ï¼Œçº¿ç¨‹åœ¨ I&#x2F;O æ“ä½œæœŸé—´å¯ä»¥æ‰§è¡Œåˆ«çš„ç¨‹åºï¼Œåœ¨é«˜å¹¶å‘æƒ…å½¢ä¸‹ä¼šæ›´ç¨³å®šå’Œæ›´é«˜çš„ååé‡ã€‚</p>
<h3 id="Netty-ç¤ºä¾‹ï¼šHttpæœåŠ¡"><a href="#Netty-ç¤ºä¾‹ï¼šHttpæœåŠ¡" class="headerlink" title="Netty ç¤ºä¾‹ï¼šHttpæœåŠ¡"></a>Netty ç¤ºä¾‹ï¼šHttpæœåŠ¡</h3><p>ç¨‹åºè¦æ±‚ï¼šæµè§ˆå™¨å‘é€è¯·æ±‚ï¼šlocalhost:&#x2F;&#x2F;8000&#x2F;helloï¼ŒæœåŠ¡ç«¯å“åº” Hello Client!ï¼ŒåŒæ—¶è¿‡æ»¤ ç‰¹å®šè¯·æ±‚èµ„æºï¼Œå¦‚ &#x2F;favicon.ico</p>
<p>NettyServerï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.mineting.netty.http;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> io.netty.bootstrap.ServerBootstrap;</span><br><span class="line"><span class="keyword">import</span> io.netty.channel.ChannelFuture;</span><br><span class="line"><span class="keyword">import</span> io.netty.channel.ChannelInitializer;</span><br><span class="line"><span class="keyword">import</span> io.netty.channel.ChannelOption;</span><br><span class="line"><span class="keyword">import</span> io.netty.channel.nio.NioEventLoopGroup;</span><br><span class="line"><span class="keyword">import</span> io.netty.channel.socket.SocketChannel;</span><br><span class="line"><span class="keyword">import</span> io.netty.channel.socket.nio.NioServerSocketChannel;</span><br><span class="line"><span class="keyword">import</span> io.netty.handler.codec.http.HttpRequestDecoder;</span><br><span class="line"><span class="keyword">import</span> io.netty.handler.codec.http.HttpResponseEncoder;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">NettyHttpServer</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">NioEventLoopGroup</span> <span class="variable">listenGroup</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">NioEventLoopGroup</span>(<span class="number">1</span>);</span><br><span class="line">        <span class="type">NioEventLoopGroup</span> <span class="variable">handlerGroup</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">NioEventLoopGroup</span>();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">ServerBootstrap</span> <span class="variable">serverBootstrap</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ServerBootstrap</span>();</span><br><span class="line">            serverBootstrap</span><br><span class="line">                    .group(listenGroup, handlerGroup)</span><br><span class="line">                    .channel(NioServerSocketChannel.class)</span><br><span class="line">                    .option(ChannelOption.SO_BACKLOG, <span class="number">128</span>)</span><br><span class="line">                    .childOption(ChannelOption.SO_KEEPALIVE, <span class="literal">true</span>)</span><br><span class="line">                    .childHandler(<span class="keyword">new</span> <span class="title class_">ChannelInitializer</span>&lt;SocketChannel&gt;() &#123;</span><br><span class="line">                        <span class="meta">@Override</span></span><br><span class="line">                        <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">initChannel</span><span class="params">(SocketChannel socketChannel)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">                            <span class="comment">/*</span></span><br><span class="line"><span class="comment">                                åœ¨ç®¡é“åŠ å…¥ HttpServerCodec,HttpServerCodec æ˜¯nettyæä¾›çš„ http çš„ç¼–è§£ç å™¨</span></span><br><span class="line"><span class="comment">                                server ç«¯æ¥æ”¶çš„æ˜¯ httpRequestï¼Œéœ€è¦ä½¿ç”¨ HttpRequestDecoder è¿›è¡Œè§£ç </span></span><br><span class="line"><span class="comment">                                server ç«¯å“åº”çš„æ˜¯ httpResponseï¼Œéœ€è¦ä½¿ç”¨ HttpResponseEncoder è¿›è¡Œç¼–ç </span></span><br><span class="line"><span class="comment">                             * */</span></span><br><span class="line">                            socketChannel.pipeline()</span><br><span class="line">                                    .addLast(<span class="string">&quot;MyHttpRequestDecoder&quot;</span>, <span class="keyword">new</span> <span class="title class_">HttpRequestDecoder</span>())</span><br><span class="line">                                    .addLast(<span class="string">&quot;HttpResponseEncoder&quot;</span>, <span class="keyword">new</span> <span class="title class_">HttpResponseEncoder</span>())</span><br><span class="line">                                    .addLast(<span class="string">&quot;TestHttpServerHandler&quot;</span>, <span class="keyword">new</span> <span class="title class_">TestHttpServerHandler</span>());</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;);</span><br><span class="line">            <span class="type">ChannelFuture</span> <span class="variable">channelFuture</span> <span class="operator">=</span> serverBootstrap.bind(<span class="number">8000</span>).sync();</span><br><span class="line">            channelFuture.channel().closeFuture().sync();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            listenGroup.shutdownGracefully();</span><br><span class="line">            handlerGroup.shutdownGracefully();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å…¶ä¸­ ChannelInitializer å¯ä»¥å•ç‹¬å†™åœ¨ä¸€ä¸ªç±»ä¸­ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.mineting.netty.http;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> io.netty.channel.ChannelInitializer;</span><br><span class="line"><span class="keyword">import</span> io.netty.channel.socket.SocketChannel;</span><br><span class="line"><span class="keyword">import</span> io.netty.handler.codec.http.HttpRequestDecoder;</span><br><span class="line"><span class="keyword">import</span> io.netty.handler.codec.http.HttpResponseEncoder;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyChannelInitializer</span> <span class="keyword">extends</span> <span class="title class_">ChannelInitializer</span>&lt;SocketChannel&gt; &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">initChannel</span><span class="params">(SocketChannel socketChannel)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">            åœ¨ç®¡é“åŠ å…¥ HttpServerCodec,HttpServerCodec æ˜¯nettyæä¾›çš„ http çš„ç¼–è§£ç å™¨</span></span><br><span class="line"><span class="comment">            server ç«¯æ¥æ”¶çš„æ˜¯ httpRequestï¼Œéœ€è¦ä½¿ç”¨ HttpRequestDecoder è¿›è¡Œè§£ç </span></span><br><span class="line"><span class="comment">            server ç«¯å“åº”çš„æ˜¯ httpResponseï¼Œéœ€è¦ä½¿ç”¨ HttpResponseEncoder è¿›è¡Œç¼–ç </span></span><br><span class="line"><span class="comment">         * */</span></span><br><span class="line">        socketChannel.pipeline()</span><br><span class="line">                .addLast(<span class="string">&quot;MyHttpRequestDecoder&quot;</span>, <span class="keyword">new</span> <span class="title class_">HttpRequestDecoder</span>())</span><br><span class="line">                .addLast(<span class="string">&quot;HttpResponseEncoder&quot;</span>, <span class="keyword">new</span> <span class="title class_">HttpResponseEncoder</span>())</span><br><span class="line">                .addLast(<span class="string">&quot;TestHttpServerHandler&quot;</span>, <span class="keyword">new</span> <span class="title class_">TestHttpServerHandler</span>());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>TestHttpServerHandlerï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.mineting.netty.http;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> io.netty.buffer.ByteBuf;</span><br><span class="line"><span class="keyword">import</span> io.netty.buffer.Unpooled;</span><br><span class="line"><span class="keyword">import</span> io.netty.channel.ChannelHandlerContext;</span><br><span class="line"><span class="keyword">import</span> io.netty.channel.SimpleChannelInboundHandler;</span><br><span class="line"><span class="keyword">import</span> io.netty.handler.codec.http.*;</span><br><span class="line"><span class="keyword">import</span> io.netty.util.CharsetUtil;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.net.URI;</span><br><span class="line"><span class="keyword">import</span> java.nio.charset.StandardCharsets;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * SimpleChannelInboundHandleræ˜¯ChannelInBoundHandlerAdapterçš„å­ç±»</span></span><br><span class="line"><span class="comment"> * HttpObject å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯ç›¸äº’é€šè®¯çš„æ•°æ®è¢«å°è£…ä¸ºHttpObject</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestHttpServerHandler</span> <span class="keyword">extends</span> <span class="title class_">SimpleChannelInboundHandler</span>&lt;HttpObject&gt; &#123;</span><br><span class="line">    <span class="comment">// è¯»å–å®¢æˆ·ç«¯æ•°æ®</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">channelRead0</span><span class="params">(ChannelHandlerContext ctx, HttpObject msg)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;å¯¹åº”çš„channel=&quot;</span> + ctx.channel() + <span class="string">&quot; pipeline=&quot;</span> + ctx</span><br><span class="line">                .pipeline() + <span class="string">&quot; é€šè¿‡pipelineè·å–channel&quot;</span> + ctx.pipeline().channel());</span><br><span class="line">        System.out.println(<span class="string">&quot;å½“å‰ctxçš„handler=&quot;</span> + ctx.handler());</span><br><span class="line">        <span class="keyword">if</span> (msg <span class="keyword">instanceof</span> HttpRequest) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;ctx ç±»å‹=&quot;</span> + ctx.getClass());</span><br><span class="line">            System.out.println(<span class="string">&quot;pipeline hashcode&quot;</span> + ctx.pipeline().hashCode() + <span class="string">&quot; TestHttpServerHandler hash=&quot;</span> + <span class="built_in">this</span>.hashCode());</span><br><span class="line">            System.out.println(<span class="string">&quot;msg ç±»å‹ï¼š &quot;</span> + msg.getClass());</span><br><span class="line">            System.out.println(<span class="string">&quot;å®¢æˆ·ç«¯åœ°å€ï¼š &quot;</span> + ctx.channel().remoteAddress());</span><br><span class="line">            <span class="type">HttpRequest</span> <span class="variable">httpRequest</span> <span class="operator">=</span> (HttpRequest) msg;</span><br><span class="line">            <span class="type">URI</span> <span class="variable">uri</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">URI</span>(httpRequest.uri());</span><br><span class="line">            <span class="keyword">if</span> (<span class="string">&quot;/favicon.ico&quot;</span>.equals(uri.getPath())) &#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;å®¢æˆ·ç«¯è¯·æ±‚ favicon.ico, ä¸åšå“åº”&quot;</span>);</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// è®¾ç½®å“åº”ä¿¡æ¯</span></span><br><span class="line">            <span class="type">ByteBuf</span> <span class="variable">content</span> <span class="operator">=</span> Unpooled.copiedBuffer(<span class="string">&quot;Hello,Browser&quot;</span>, CharsetUtil.UTF_8);</span><br><span class="line">            <span class="type">DefaultFullHttpResponse</span> <span class="variable">response</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DefaultFullHttpResponse</span>(HttpVersion.HTTP_1_1, HttpResponseStatus.OK, content);</span><br><span class="line">            response.headers().set(HttpHeaderNames.CONTENT_TYPE, <span class="string">&quot;text/plain&quot;</span>);</span><br><span class="line">            response.headers().set(HttpHeaderNames.CONTENT_LENGTH, content.readableBytes());</span><br><span class="line">            ctx.channel().writeAndFlush(response);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="Netty-æ ¸å¿ƒæ¨¡å—ç»„ä»¶"><a href="#Netty-æ ¸å¿ƒæ¨¡å—ç»„ä»¶" class="headerlink" title="Netty æ ¸å¿ƒæ¨¡å—ç»„ä»¶"></a>Netty æ ¸å¿ƒæ¨¡å—ç»„ä»¶</h1><h2 id="Bootstrapã€ServerBootstrap"><a href="#Bootstrapã€ServerBootstrap" class="headerlink" title="Bootstrapã€ServerBootstrap"></a>Bootstrapã€ServerBootstrap</h2><p>â€‹		Bootstrap æ„æ€æ˜¯å¼•å¯¼ï¼Œä¸€ä¸ª Netty åº”ç”¨é€šå¸¸ç”±ä¸€ä¸ª Bootstrap å¼€å§‹ï¼Œ<strong>ä¸»è¦ä½œç”¨æ˜¯é…ç½®æ•´ä¸ª Netty ç¨‹åºï¼Œä¸²è”å„ä¸ªç»„ä»¶</strong>ï¼ŒNetty ä¸­ Bootstrap ç±»æ˜¯å®¢æˆ·ç«¯ç¨‹åºçš„å¯åŠ¨å¼•å¯¼ç±»ï¼ŒServerBootstrap æ˜¯æœåŠ¡ç«¯å¯åŠ¨å¼•å¯¼ç±»ã€‚</p>
<p>å¸¸è§çš„æ–¹æ³•ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//è¯¥æ–¹æ³•ç”¨äºæœåŠ¡å™¨ç«¯ï¼Œç”¨æ¥è®¾ç½®ä¸¤ä¸ª EventLoop</span></span><br><span class="line"><span class="keyword">public</span> ServerBootstrap <span class="title function_">group</span><span class="params">(EventLoopGroup parentGroup, EventLoopGroup childGroup)</span></span><br><span class="line">    </span><br><span class="line"><span class="comment">//è¯¥æ–¹æ³•ç”¨äºå®¢æˆ·ç«¯ï¼Œç”¨æ¥è®¾ç½®ä¸€ä¸ª EventLoop</span></span><br><span class="line"><span class="keyword">public</span> ServerBootstrap <span class="title function_">group</span><span class="params">(EventLoopGroup group)</span></span><br><span class="line">    </span><br><span class="line"><span class="comment">//è¯¥æ–¹æ³•ç”¨æ¥è®¾ç½®ä¸€ä¸ªæœåŠ¡å™¨ç«¯çš„é€šé“å®ç°</span></span><br><span class="line"><span class="keyword">public</span> ServerBootstrap <span class="title function_">channel</span><span class="params">(Class&lt;? extends C&gt; channelClass)</span></span><br><span class="line">    </span><br><span class="line"><span class="comment">//ç”¨æ¥ç»™ ServerChannel æ·»åŠ é…ç½®</span></span><br><span class="line"><span class="keyword">public</span> &lt;T&gt; ServerBootstrap <span class="title function_">option</span><span class="params">(ChannelOption&lt;T&gt; option, T value)</span></span><br><span class="line">    </span><br><span class="line"><span class="comment">//ç”¨æ¥ç»™æ¥æ”¶åˆ°çš„é€šé“æ·»åŠ é…ç½®</span></span><br><span class="line"><span class="keyword">public</span> &lt;T&gt; ServerBootstrap <span class="title function_">childOption</span><span class="params">(ChannelOption&lt;T&gt; childOption, T value)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//è¯¥æ–¹æ³•ç”¨æ¥è®¾ç½®ä¸šåŠ¡å¤„ç†ç±»ï¼ˆè‡ªå®šä¹‰çš„ handlerï¼‰</span></span><br><span class="line"><span class="keyword">public</span> ServerBootstrap <span class="title function_">childHandler</span><span class="params">(ChannelHandler childHandler)</span></span><br><span class="line">    </span><br><span class="line"><span class="comment">//è¯¥æ–¹æ³•ç”¨äºæœåŠ¡å™¨ç«¯ï¼Œç”¨æ¥è®¾ç½®å ç”¨çš„ç«¯å£å·</span></span><br><span class="line"><span class="keyword">public</span> ChannelFuture <span class="title function_">bind</span><span class="params">(<span class="type">int</span> inetPort)</span></span><br><span class="line">    </span><br><span class="line"><span class="comment">//è¯¥æ–¹æ³•ç”¨äºå®¢æˆ·ç«¯ï¼Œç”¨æ¥è¿æ¥æœåŠ¡å™¨ç«¯</span></span><br><span class="line"><span class="keyword">public</span> ChannelFuture <span class="title function_">connect</span><span class="params">(String inetHost, <span class="type">int</span> inetPort)</span></span><br></pre></td></tr></table></figure>

<h2 id="Futureã€ChannelFuture"><a href="#Futureã€ChannelFuture" class="headerlink" title="Futureã€ChannelFuture"></a>Futureã€ChannelFuture</h2><p>Netty ä¸­æ‰€æœ‰çš„ IO æ“ä½œéƒ½æ˜¯å¼‚æ­¥çš„ï¼Œä¸èƒ½ç«‹åˆ»å¾—çŸ¥æ¶ˆæ¯æ˜¯å¦è¢«æ­£ç¡®å¤„ç†ã€‚ä½†æ˜¯å¯ä»¥è¿‡ä¸€ä¼šç­‰å®ƒæ‰§è¡Œå®Œæˆæˆ–è€…ç›´æ¥æ³¨å†Œä¸€ä¸ªç›‘å¬ï¼Œå…·ä½“çš„å®ç°å°±æ˜¯é€šè¿‡ Future å’Œ ChannelFuturesï¼Œä»–ä»¬å¯ä»¥æ³¨å†Œä¸€ä¸ªç›‘å¬ï¼Œå½“æ“ä½œæ‰§è¡ŒæˆåŠŸæˆ–å¤±è´¥æ—¶ç›‘å¬ä¼šè‡ªåŠ¨è§¦å‘æ³¨å†Œçš„ç›‘å¬äº‹ä»¶ã€‚</p>
<p>å¸¸è§çš„æ–¹æ³•ï¼š</p>
<p>Channel channel()     è¿”å›å½“å‰æ­£åœ¨è¿›è¡Œ IO æ“ä½œçš„é€šé“ã€‚</p>
<p>ChannelFuture sync()   ç­‰å¾…å¼‚æ­¥æ“ä½œæ‰§è¡Œå®Œæ¯•ã€‚</p>
<h2 id="Channel"><a href="#Channel" class="headerlink" title="Channel"></a>Channel</h2><ol>
<li><p>Netty ç½‘ç»œé€šä¿¡çš„ç»„ä»¶ï¼Œèƒ½å¤Ÿç”¨äºæ‰§è¡Œç½‘ç»œ I&#x2F;O æ“ä½œã€‚</p>
</li>
<li><p>é€šè¿‡Channel å¯è·å¾—å½“å‰ç½‘ç»œè¿æ¥çš„é€šé“çš„çŠ¶æ€ã€‚</p>
</li>
<li><p>é€šè¿‡Channel å¯è·å¾—ç½‘ç»œè¿æ¥çš„é…ç½®å‚æ•°ï¼ˆä¾‹å¦‚æ¥æ”¶ç¼“å†²åŒºå¤§å°ï¼‰ã€‚</p>
</li>
<li><p>Channel æä¾›å¼‚æ­¥çš„ç½‘ç»œ I&#x2F;O æ“ä½œ(å¦‚å»ºç«‹è¿æ¥ï¼Œè¯»å†™ï¼Œç»‘å®šç«¯å£)ï¼Œå¼‚æ­¥è°ƒç”¨æ„å‘³ç€ä»»ä½• I&#x2F;O è°ƒç”¨éƒ½å°†ç«‹å³è¿”å›ï¼Œå¹¶ä¸”ä¸ä¿è¯åœ¨è°ƒç”¨		ç»“æŸæ—¶æ‰€è¯·æ±‚çš„ I&#x2F;O æ“ä½œå·²å®Œæˆã€‚</p>
</li>
<li><p>è°ƒç”¨ç«‹å³è¿”å›ä¸€ä¸ª ChannelFuture å®ä¾‹ï¼Œé€šè¿‡æ³¨å†Œç›‘å¬å™¨åˆ° ChannelFuture ä¸Šï¼Œå¯ä»¥ I&#x2F;O æ“ä½œæˆåŠŸã€å¤±è´¥æˆ–å–æ¶ˆæ—¶å›è°ƒé€šçŸ¥è°ƒç”¨		æ–¹ã€‚</p>
</li>
<li><p>æ”¯æŒå…³è” I&#x2F;O æ“ä½œä¸å¯¹åº”çš„å¤„ç†ç¨‹åºã€‚</p>
</li>
<li><p>ä¸åŒåè®®ã€ä¸åŒçš„é˜»å¡ç±»å‹çš„è¿æ¥éƒ½æœ‰ä¸åŒçš„ Channel ç±»å‹ä¸ä¹‹å¯¹åº”ï¼Œå¸¸ç”¨çš„ Channel ç±»å‹ï¼š</p>
</li>
</ol>
<ul>
<li><p>â€‹	NioSocketChannelï¼šå¼‚æ­¥çš„å®¢æˆ·ç«¯ TCP Socket è¿æ¥ã€‚</p>
</li>
<li><p>â€‹	NioServerSocketChannelï¼šå¼‚æ­¥çš„æœåŠ¡å™¨ç«¯ TCP Socket è¿æ¥ã€‚</p>
</li>
<li><p>â€‹	NioDatagramChannelï¼šå¼‚æ­¥çš„ UDP è¿æ¥ã€‚</p>
</li>
<li><p>â€‹	NioSctpChannelï¼šå¼‚æ­¥çš„å®¢æˆ·ç«¯ Sctp è¿æ¥ã€‚</p>
</li>
<li><p>â€‹	NioSctpServerChannelï¼šå¼‚æ­¥çš„ Sctp æœåŠ¡å™¨ç«¯è¿æ¥ï¼Œè¿™äº›é€šé“æ¶µç›–äº† UDP å’Œ TCP ç½‘ç»œ IO ä»¥åŠæ–‡ä»¶ IOã€‚</p>
</li>
</ul>
<h2 id="Selector"><a href="#Selector" class="headerlink" title="Selector"></a>Selector</h2><ol>
<li><p>Netty åŸºäº Selector å¯¹è±¡å®ç° I&#x2F;O å¤šè·¯å¤ç”¨ï¼Œé€šè¿‡ Selectorä¸€ä¸ªçº¿ç¨‹å¯ä»¥ç›‘å¬å¤šä¸ªè¿æ¥çš„ Channel äº‹ä»¶ã€‚</p>
</li>
<li><p>å½“å‘ä¸€ä¸ª Selector ä¸­æ³¨å†Œ Channel åï¼ŒSelector å†…éƒ¨çš„æœºåˆ¶å°±å¯ä»¥ä¸æ–­è½®è¯¢è¿™äº›æ³¨å†Œçš„ Channel æ˜¯å¦æœ‰å·²å°±ç»ªçš„ I&#x2F;O äº‹ä»¶ï¼ˆä¾‹å¦‚å¯è¯»ï¼Œå¯å†™ï¼Œç½‘ç»œè¿æ¥å®Œæˆç­‰ï¼‰ï¼Œè¿™æ ·ç¨‹åºå°±å¯ä»¥ä½¿ç”¨ä¸€ä¸ªçº¿ç¨‹é«˜æ•ˆåœ°ç®¡ç†å¤šä¸ª Channelã€‚</p>
</li>
</ol>
<h2 id="ChannelHandler-åŠå…¶å®ç°ç±»"><a href="#ChannelHandler-åŠå…¶å®ç°ç±»" class="headerlink" title="ChannelHandler åŠå…¶å®ç°ç±»"></a>ChannelHandler åŠå…¶å®ç°ç±»</h2><ol>
<li><p>ChannelHandler æ˜¯ä¸€ä¸ªæ¥å£ï¼Œå¤„ç† I&#x2F;O äº‹ä»¶æˆ–æ‹¦æˆª I&#x2F;O æ“ä½œï¼Œå¹¶å°†å…¶è½¬å‘åˆ°å…¶ ChannelPipeline(ä¸šåŠ¡å¤„ç†é“¾)ä¸­çš„ä¸‹ä¸€ä¸ªå¤„ç†ç¨‹åºã€‚</p>
</li>
<li><p>ChannelHandler æœ¬èº«å¹¶æ²¡æœ‰æä¾›å¾ˆå¤šæ–¹æ³•ï¼Œå› ä¸ºè¿™ä¸ªæ¥å£æœ‰è®¸å¤šçš„æ–¹æ³•éœ€è¦å®ç°ï¼Œæ–¹ä¾¿ä½¿ç”¨æœŸé—´ï¼Œå¯ä»¥ç»§æ‰¿å®ƒçš„å­ç±»ã€‚</p>
</li>
<li><p>ChannelHandler åŠå…¶å®ç°ç±»ä¸€è§ˆå›¾</p>
</li>
</ol>
<p>![image-20220919130347051](C:\Java\Document\Netty\Netty å‚çœ‹æ–‡æ¡£.assets\image-20220919130347051.png)</p>
<p>ChannelInboundHandler 		ç”¨äºå¤„ç†å…¥ç«™ I&#x2F;O äº‹ä»¶ã€‚</p>
<p>ChannelOutboundHandler 		ç”¨äºå¤„ç†å‡ºç«™ I&#x2F;O æ“ä½œã€‚</p>
<p>ChannelInboundHandlerAdapter 		ç”¨äºå¤„ç†å…¥ç«™ I&#x2F;O äº‹ä»¶ã€‚</p>
<p>ChannelOutboundHandlerAdapter 	ç”¨äºå¤„ç†å‡ºç«™ I&#x2F;O æ“ä½œã€‚</p>
<p>ChannelDuplexHandler 		ç”¨äºå¤„ç†å…¥ç«™å’Œå‡ºç«™äº‹ä»¶ã€‚</p>
<p>4ï¼‰ç”¨æˆ·éœ€è¦è‡ªå®šä¹‰ä¸€ä¸ª Handler ç±»å»ç»§æ‰¿ ChannelInboundHandlerAdapterï¼Œç„¶åé‡å†™ç›¸åº”æ–¹æ³•å®ç°ä¸šåŠ¡é€»è¾‘ã€‚</p>
<p>â€‹	ç›¸å…³æ–¹æ³•ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ChannelInboundHandlerAdapter</span> <span class="keyword">extends</span> <span class="title class_">ChannelHandlerAdapter</span> <span class="keyword">implements</span> <span class="title class_">ChannelInboundHandler</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">ChannelInboundHandlerAdapter</span><span class="params">()</span> &#123; &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">channelRegistered</span><span class="params">(ChannelHandlerContext ctx)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        ctx.fireChannelRegistered();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">channelUnregistered</span><span class="params">(ChannelHandlerContext ctx)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        ctx.fireChannelUnregistered();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// é€šé“å°±ç»ªäº‹ä»¶</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">channelActive</span><span class="params">(ChannelHandlerContext ctx)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        ctx.fireChannelActive();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// é€šé“æ–­å¼€æ—¶é—´</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">channelInactive</span><span class="params">(ChannelHandlerContext ctx)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        ctx.fireChannelInactive();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// é€šé“è¯»å–æ•°æ®äº‹ä»¶</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">channelRead</span><span class="params">(ChannelHandlerContext ctx, Object msg)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        ctx.fireChannelRead(msg);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//æ•°æ®è¯»å–å®Œæ¯•äº‹ä»¶</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">channelReadComplete</span><span class="params">(ChannelHandlerContext ctx)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        ctx.fireChannelReadComplete();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//è§¦å‘ä¸‹ä¸€ä¸ªhandler</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">userEventTriggered</span><span class="params">(ChannelHandlerContext ctx, Object evt)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        ctx.fireUserEventTriggered(evt);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">channelWritabilityChanged</span><span class="params">(ChannelHandlerContext ctx)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        ctx.fireChannelWritabilityChanged();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//é€šé“å‘ç”Ÿå¼‚å¸¸äº‹ä»¶</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">exceptionCaught</span><span class="params">(ChannelHandlerContext ctx, Throwable cause)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        ctx.fireExceptionCaught(cause);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="Pipeline-å’Œ-ChannelPipeline"><a href="#Pipeline-å’Œ-ChannelPipeline" class="headerlink" title="Pipeline å’Œ ChannelPipeline"></a>Pipeline å’Œ ChannelPipeline</h2><ol>
<li><p>ChannelPipeline æ˜¯ä¸€ä¸ª Handler çš„é›†åˆï¼Œå®ƒè´Ÿè´£å¤„ç†å’Œæ‹¦æˆª inbound æˆ–è€… outbound çš„äº‹ä»¶å’Œæ“ä½œï¼Œç›¸å½“äºä¸€ä¸ªè´¯ç©¿ Netty çš„é“¾ã€‚(ä¹Ÿå¯ä»¥è¿™æ ·ç†è§£ï¼š<strong>ChannelPipeline æ˜¯ ä¿å­˜ ChannelHandler çš„ List</strong>ï¼Œç”¨äºå¤„ç†æˆ–æ‹¦æˆª Channel çš„å…¥ç«™äº‹ä»¶å’Œå‡ºç«™æ“ä½œ)ã€‚</p>
</li>
<li><p>ChannelPipeline å®ç°äº†ä¸€ç§é«˜çº§å½¢å¼çš„æ‹¦æˆªè¿‡æ»¤å™¨æ¨¡å¼ï¼Œä½¿ç”¨æˆ·å¯ä»¥å®Œå…¨æ§åˆ¶äº‹ä»¶çš„å¤„ç†æ–¹å¼ï¼Œä»¥åŠ Channel ä¸­å„ä¸ªçš„ ChannelHandler å¦‚ä½•ç›¸äº’äº¤äº’ã€‚</p>
</li>
<li><p>åœ¨ Netty ä¸­æ¯ä¸ª Channel éƒ½æœ‰ä¸”ä»…æœ‰ä¸€ä¸ª ChannelPipeline ä¸ä¹‹å¯¹åº”ï¼Œå®ƒä»¬çš„ç»„æˆå…³ç³»å¦‚ä¸‹ï¼š</p>
 <img src="/2023/02/28/Netty/Java\Document\Netty\Netty å‚çœ‹æ–‡æ¡£.assets\image-20220919130911495.png" alt="image-20220919130911495" style="zoom:150%;">

<ul>
<li><p>ä¸€ä¸ª Channel åŒ…å«äº†ä¸€ä¸ª ChannelPipelineï¼Œè€Œ ChannelPipeline ä¸­åˆç»´æŠ¤äº†ä¸€ä¸ªç”± ChannelHandlerContext ç»„æˆçš„åŒå‘é“¾è¡¨ï¼Œå¹¶ä¸”æ¯ä¸ª ChannelHandlerContext ä¸­åˆå…³è”ç€ä¸€ä¸ª ChannelHandlerã€‚</p>
</li>
<li><p>å…¥ç«™äº‹ä»¶å’Œå‡ºç«™äº‹ä»¶åœ¨ä¸€ä¸ªåŒå‘é“¾è¡¨ä¸­ï¼Œå…¥ç«™äº‹ä»¶ä¼šä»é“¾è¡¨ head å¾€åä¼ é€’åˆ°æœ€åä¸€ä¸ªå…¥ç«™çš„ handlerï¼Œå‡ºç«™äº‹ä»¶ä¼šä»é“¾è¡¨ tail å¾€å‰ä¼ é€’åˆ°æœ€å‰ä¸€ä¸ªå‡ºç«™çš„ handlerï¼Œä¸¤ç§ç±»å‹çš„ handler äº’ä¸å¹²æ‰°ã€‚</p>
</li>
</ul>
</li>
</ol>
<p><strong>å¸¸ç”¨æ–¹æ³•</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//æŠŠä¸€ä¸ªä¸šåŠ¡å¤„ç†ç±»ï¼ˆhandlerï¼‰æ·»åŠ åˆ°é“¾ä¸­çš„ç¬¬ä¸€ä¸ªä½ç½®</span></span><br><span class="line">ChannelPipeline <span class="title function_">addFirst</span><span class="params">(ChannelHandler... handlers)</span></span><br><span class="line"><span class="comment">//æŠŠä¸€ä¸ªä¸šåŠ¡å¤„ç†ç±»ï¼ˆhandlerï¼‰æ·»åŠ åˆ°é“¾ä¸­çš„æœ€åä¸€ä¸ªä½ç½®</span></span><br><span class="line">ChannelPipeline <span class="title function_">addLast</span><span class="params">(ChannelHandler... handlers)</span></span><br></pre></td></tr></table></figure>

<h2 id="ChannelHandlerContext"><a href="#ChannelHandlerContext" class="headerlink" title="ChannelHandlerContext"></a>ChannelHandlerContext</h2><ol>
<li><p>ä¿å­˜Channelç›¸å…³çš„æ‰€æœ‰ä¸Šä¸‹æ–‡ä¿¡æ¯ï¼ŒåŒæ—¶å…³è”ä¸€ä¸ªChannelHandlerå¯¹è±¡ã€‚</p>
</li>
<li><p>å³ChannelHandlerContextä¸­åŒ…å«ä¸€ä¸ªå…·ä½“çš„äº‹ä»¶å¤„ç†å™¨ChannelHandlerï¼ŒåŒæ—¶ChannelHandlerContextä¸­ä¹Ÿç»‘å®šäº†å¯¹åº”çš„</p>
</li>
</ol>
<p>â€‹		pipelineå’ŒChannelçš„ä¿¡æ¯ï¼Œæ–¹ä¾¿å¯¹ChannelHandlerè¿›è¡Œè°ƒç”¨ã€‚</p>
<ol start="3">
<li>å¸¸ç”¨æ–¹æ³•</li>
</ol>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">ChannelFuture <span class="title function_">close</span><span class="params">()</span> 	å…³é—­é€šé“</span><br><span class="line">ChannelOutboundInvoker <span class="title function_">flush</span><span class="params">()</span> 	åˆ·æ–°</span><br><span class="line">ChannelFuture <span class="title function_">writeAndFlush</span><span class="params">(Object msg)</span> å°†æ•°æ®å†™åˆ°ChannelPipelineä¸­å½“å‰ChannelHandlerçš„ä¸‹ä¸€ä¸ªChannelHandlerå¼€å§‹å¤„ç†ï¼ˆå‡ºç«™ï¼‰ã€‚</span><br></pre></td></tr></table></figure>

<h2 id="ChannelOption"><a href="#ChannelOption" class="headerlink" title="ChannelOption"></a>ChannelOption</h2><p>Netty åœ¨åˆ›å»º Channel å®ä¾‹åï¼Œä¸€èˆ¬éƒ½éœ€è¦è®¾ç½® ChannelOption å‚æ•°ã€‚</p>
<p>ChannelOption å‚æ•°å¦‚ä¸‹ï¼š</p>
<p>ChannelOption.SO_BACKLOG</p>
<p>â€‹	å¯¹åº” TCP&#x2F;IP åè®® listen å‡½æ•°ä¸­çš„ backlog å‚æ•°ï¼Œç”¨æ¥åˆå§‹åŒ–æœåŠ¡å™¨å¯è¿æ¥é˜Ÿåˆ—å¤§å°ã€‚æœåŠ¡ç«¯å¤„ç†å®¢æˆ·ç«¯è¿æ¥è¯·æ±‚æ˜¯é¡ºåºå¤„ç†çš„ï¼Œæ‰€ä»¥åŒä¸€æ—¶é—´åªèƒ½å¤„ç†ä¸€ä¸ªå®¢æˆ·ç«¯è¿æ¥ã€‚å¤šä¸ªå®¢æˆ·ç«¯æ¥çš„æ—¶å€™ï¼ŒæœåŠ¡ç«¯å°†ä¸èƒ½å¤„ç†çš„å®¢æˆ·ç«¯è¿æ¥è¯·æ±‚æ”¾åœ¨é˜Ÿåˆ—ä¸­ç­‰å¾…å¤„ç†ï¼Œbacklog å‚æ•°æŒ‡å®šäº†é˜Ÿåˆ—çš„å¤§å°ã€‚</p>
<p>ChannelOption.SO_KEEPALIVEï¼š ä¸€ç›´ä¿æŒè¿æ¥æ´»åŠ¨çŠ¶æ€ã€‚</p>
<h2 id="EventLoopGroup-åŠ-NioEventLoopGroup"><a href="#EventLoopGroup-åŠ-NioEventLoopGroup" class="headerlink" title="EventLoopGroup åŠ NioEventLoopGroup"></a>EventLoopGroup åŠ NioEventLoopGroup</h2><ol>
<li>EventLoopGroup æ˜¯ä¸€ç»„ EventLoop çš„æŠ½è±¡ï¼ŒNetty ä¸ºäº†æ›´å¥½çš„åˆ©ç”¨å¤šæ ¸ CPU èµ„æºï¼Œä¸€èˆ¬ä¼šæœ‰å¤šä¸ª EventLoop åŒæ—¶å·¥ä½œï¼Œæ¯ä¸ª</li>
</ol>
<p>â€‹		EventLoop ç»´æŠ¤ç€ä¸€ä¸ª Selector å®ä¾‹ã€‚</p>
<ol start="2">
<li>EventLoopGroup æä¾› next æ¥å£ï¼Œå¯ä»¥ä»ç»„é‡Œé¢æŒ‰ç…§ä¸€å®šè§„åˆ™è·å–å…¶ä¸­ä¸€ä¸ª EventLoopæ¥å¤„ç†ä»»åŠ¡ã€‚åœ¨ Netty æœåŠ¡å™¨ç«¯ç¼–ç¨‹ä¸­ï¼Œ</li>
</ol>
<p>â€‹		ä¸€èˆ¬éƒ½éœ€è¦æä¾›ä¸¤ä¸ª EventLoopGroupï¼Œä¾‹å¦‚ï¼šBossEventLoopGroup å’Œ WorkerEventLoopGroupã€‚</p>
<ol start="3">
<li>é€šå¸¸ä¸€ä¸ªæœåŠ¡ç«¯å£å³ä¸€ä¸ª ServerSocketChannelå¯¹åº”ä¸€ä¸ªSelector å’Œä¸€ä¸ªEventLoopçº¿ç¨‹ã€‚BossEventLoop è´Ÿè´£æ¥æ”¶å®¢æˆ·ç«¯çš„è¿æ¥</li>
</ol>
<p>â€‹		å¹¶å°† SocketChannel äº¤ç»™ WorkerEventLoopGroup æ¥è¿›è¡Œ IO å¤„ç†ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<img src="/2023/02/28/Netty/Java\Document\Netty\Netty å‚çœ‹æ–‡æ¡£.assets\image-20220919133039295.png" alt="image-20220919133039295" style="zoom:150%;">

<p>è¯´æ˜ï¼š</p>
<ol>
<li><p>BossEventLoopGroup é€šå¸¸æ˜¯ä¸€ä¸ªå•çº¿ç¨‹çš„ EventLoopï¼ŒEventLoop ç»´æŠ¤ç€ä¸€ä¸ªæ³¨å†Œäº†ServerSocketChannel çš„ Selector å®ä¾‹BossEventLoop ä¸æ–­è½®è¯¢ Selector å°†è¿æ¥äº‹ä»¶åˆ†ç¦»å‡ºæ¥ã€‚</p>
</li>
<li><p>é€šå¸¸æ˜¯ OP_ACCEPT äº‹ä»¶ï¼Œç„¶åå°†æ¥æ”¶åˆ°çš„ SocketChannel äº¤ç»™ WorkerEventLoopGroupã€‚</p>
</li>
<li><p>WorkerEventLoopGroup ä¼šç”± next é€‰æ‹©å…¶ä¸­ä¸€ä¸ª EventLoopæ¥å°†è¿™ä¸ª SocketChannel æ³¨å†Œåˆ°å…¶ç»´æŠ¤çš„ Selector å¹¶å¯¹å…¶åç»­çš„ IO äº‹ä»¶è¿›è¡Œå¤„ç†ã€‚</p>
</li>
</ol>
<p>å¸¸ç”¨æ–¹æ³•</p>
<p>public NioEventLoopGroup()   æ„é€ æ–¹æ³•</p>
<p>public Future&lt;?&gt; shutdownGracefully()    æ–­å¼€è¿æ¥ï¼Œå…³é—­çº¿ç¨‹ã€‚</p>
<h2 id="Unpooled-ç±»"><a href="#Unpooled-ç±»" class="headerlink" title="Unpooled ç±»"></a>Unpooled ç±»</h2><ol>
<li><p>Netty æä¾›ä¸€ä¸ªä¸“é—¨ç”¨æ¥æ“ä½œç¼“å†²åŒº(å³Nettyçš„æ•°æ®å®¹å™¨)çš„å·¥å…·ç±»ã€‚</p>
</li>
<li><p>å¸¸ç”¨æ–¹æ³•å¦‚ä¸‹ï¼š</p>
</li>
</ol>
<p>â€‹		&#x2F;&#x2F; é€šè¿‡ç»™å®šçš„æ•°æ®å’Œå­—ç¬¦ç¼–ç è¿”å›ä¸€ä¸ª ByteBuf å¯¹è±¡ï¼ˆç±»ä¼¼äº NIO ä¸­çš„ ByteBuffer ä½†æœ‰åŒºåˆ«ï¼‰</p>
<p>â€‹		public static ByteBuf copiedBuffer(CharSequence string, Charset charset)</p>
<p>â€‹		ByteBuf buffer &#x3D; Unpooled.buffer(10);	&#x2F;&#x2F; åˆ›å»ºå®¹é‡ä¸º10çš„buffer</p>
<p>3ï¼‰Unpooled è·å– Nettyçš„æ•°æ®å®¹å™¨ByteBufï¼š</p>
<img src="/2023/02/28/Netty/Java\Document\Netty\Netty å‚çœ‹æ–‡æ¡£.assets\image-20220919133244906.png" alt="image-20220919133244906" style="zoom:150%;">

<ol>
<li><p>åœ¨nettyçš„bufferä¸­ï¼Œä¸éœ€è¦ä½¿ç”¨flip è¿›è¡Œåè½¬ã€‚</p>
</li>
<li><p>åº•å±‚ç»´æŠ¤äº†readerindex å’Œ writerIndexã€‚</p>
</li>
<li><p>é€šè¿‡readerindexå’ŒwriterIndex å’Œcapacityï¼Œå°†bufferåˆ†æˆä¸‰ä¸ªåŒºåŸŸã€‚</p>
<p> 0 â€” readerindex   		å·²ç»è¯»å–çš„åŒºåŸŸ</p>
<p> readerindex â€” writerIndex  		å¯è¯»çš„åŒºåŸŸ</p>
<p> writerIndex â€” capacity  		å¯å†™çš„åŒºåŸŸ</p>
</li>
</ol>
<p>ä½¿ç”¨ç¤ºä¾‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testByteBuf01</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">ByteBuf</span> <span class="variable">buffer</span> <span class="operator">=</span> Unpooled.buffer(<span class="number">5</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; buffer.capacity(); i++) &#123;</span><br><span class="line">        buffer.writeByte(i);</span><br><span class="line">    &#125;</span><br><span class="line">    System.out.println(<span class="string">&quot;capacity: &quot;</span> + buffer.capacity());</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; buffer.capacity(); i++) &#123;</span><br><span class="line">        <span class="comment">// System.out.println(buffer.getByte(i));</span></span><br><span class="line">        System.out.println(buffer.readByte());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testByteBuf02</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">ByteBuf</span> <span class="variable">byteBuf</span> <span class="operator">=</span> Unpooled.copiedBuffer(<span class="string">&quot;hello,world!&quot;</span>, Charset.forName(<span class="string">&quot;utf-8&quot;</span>));</span><br><span class="line">    <span class="keyword">if</span> (byteBuf.hasArray()) &#123;</span><br><span class="line">        <span class="type">byte</span>[] array = byteBuf.array();</span><br><span class="line">        System.out.println(<span class="keyword">new</span> <span class="title class_">String</span>(array, StandardCharsets.UTF_8)); <span class="comment">//hello,world!</span></span><br><span class="line">        System.out.println(<span class="string">&quot;byteBuf&quot;</span> + byteBuf);</span><br><span class="line">        <span class="comment">//byteBufUnpooledByteBufAllocator$InstrumentedUnpooledUnsafeHeapByteBuf(ridx: 0, widx: 12, cap: 36)</span></span><br><span class="line">        System.out.println(byteBuf.arrayOffset()); <span class="comment">//0</span></span><br><span class="line">        System.out.println(byteBuf.readerIndex()); <span class="comment">//0</span></span><br><span class="line">        System.out.println(byteBuf.writerIndex()); <span class="comment">//12</span></span><br><span class="line">        System.out.println(byteBuf.capacity()); <span class="comment">//36</span></span><br><span class="line">        System.out.println(byteBuf.getByte(<span class="number">0</span>)); <span class="comment">//104</span></span><br><span class="line">        System.out.println(byteBuf.readableBytes()); <span class="comment">//12</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; byteBuf.readableBytes(); i++) &#123;</span><br><span class="line">            System.out.println((<span class="type">char</span>) byteBuf.getByte(i)); <span class="comment">//h e l l o ,.....</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//index , length, charset</span></span><br><span class="line">        System.out.println(byteBuf.getCharSequence(<span class="number">0</span>, <span class="number">4</span>, StandardCharsets.UTF_8));<span class="comment">//hello</span></span><br><span class="line">        System.out.println(byteBuf.getCharSequence(<span class="number">4</span>, <span class="number">6</span>, Charset.forName(<span class="string">&quot;utf-8&quot;</span>)));<span class="comment">//o,worl</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Nettyåº”ç”¨å®ä¾‹-ç¾¤èŠç³»ç»Ÿ"><a href="#Nettyåº”ç”¨å®ä¾‹-ç¾¤èŠç³»ç»Ÿ" class="headerlink" title="Nettyåº”ç”¨å®ä¾‹-ç¾¤èŠç³»ç»Ÿ"></a>Nettyåº”ç”¨å®ä¾‹-ç¾¤èŠç³»ç»Ÿ</h2><p>ç¨‹åºè¦æ±‚ï¼šå®ç°æœåŠ¡å™¨ç«¯å’Œå®¢æˆ·ç«¯ä¹‹é—´çš„æ•°æ®ç®€å•é€šè®¯ï¼ˆéé˜»å¡ï¼‰</p>
<p>GroupChatServerï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.mineting.netty.groupchat;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> io.netty.bootstrap.ServerBootstrap;</span><br><span class="line"><span class="keyword">import</span> io.netty.channel.ChannelFuture;</span><br><span class="line"><span class="keyword">import</span> io.netty.channel.ChannelInitializer;</span><br><span class="line"><span class="keyword">import</span> io.netty.channel.ChannelOption;</span><br><span class="line"><span class="keyword">import</span> io.netty.channel.nio.NioEventLoopGroup;</span><br><span class="line"><span class="keyword">import</span> io.netty.channel.socket.SocketChannel;</span><br><span class="line"><span class="keyword">import</span> io.netty.channel.socket.nio.NioServerSocketChannel;</span><br><span class="line"><span class="keyword">import</span> io.netty.handler.codec.string.StringDecoder;</span><br><span class="line"><span class="keyword">import</span> io.netty.handler.codec.string.StringEncoder;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">GroupChatServer</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> port;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">GroupChatServer</span><span class="params">(<span class="type">int</span> port)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.port = port;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">NioEventLoopGroup</span> <span class="variable">listenGroup</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">NioEventLoopGroup</span>(<span class="number">1</span>);</span><br><span class="line">        <span class="type">NioEventLoopGroup</span> <span class="variable">handlerGroup</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">NioEventLoopGroup</span>();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">ServerBootstrap</span> <span class="variable">serverBootstrap</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ServerBootstrap</span>();</span><br><span class="line">            serverBootstrap</span><br><span class="line">                    .group(listenGroup, handlerGroup)</span><br><span class="line">                    .channel(NioServerSocketChannel.class)</span><br><span class="line">                    .option(ChannelOption.SO_BACKLOG, <span class="number">128</span>)</span><br><span class="line">                    .childOption(ChannelOption.SO_KEEPALIVE, <span class="literal">true</span>)</span><br><span class="line">                    .childHandler(<span class="keyword">new</span> <span class="title class_">ChannelInitializer</span>&lt;SocketChannel&gt;() &#123;</span><br><span class="line">                        <span class="meta">@Override</span></span><br><span class="line">                        <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">initChannel</span><span class="params">(SocketChannel socketChannel)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">                            socketChannel.pipeline()</span><br><span class="line">                                    .addLast(<span class="string">&quot;StringDecoder&quot;</span>, <span class="keyword">new</span> <span class="title class_">StringDecoder</span>())</span><br><span class="line">                                    .addLast(<span class="string">&quot;StringEncoder&quot;</span>, <span class="keyword">new</span> <span class="title class_">StringEncoder</span>())</span><br><span class="line">                                    .addLast(<span class="string">&quot;GroupChatServerHandler&quot;</span>, <span class="keyword">new</span> <span class="title class_">GroupChatServerHandler</span>());</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;);</span><br><span class="line">            <span class="type">ChannelFuture</span> <span class="variable">channelFuture</span> <span class="operator">=</span> serverBootstrap.bind(port).sync();</span><br><span class="line">            System.out.println(<span class="string">&quot;GroupServer Start...&quot;</span>);</span><br><span class="line">            channelFuture.channel().closeFuture().sync();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            listenGroup.shutdownGracefully();</span><br><span class="line">            handlerGroup.shutdownGracefully();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">GroupChatServer</span>(<span class="number">8000</span>).run();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>GroupChatServerHandlerï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.mineting.netty.groupchat;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> io.netty.channel.Channel;</span><br><span class="line"><span class="keyword">import</span> io.netty.channel.ChannelHandlerContext;</span><br><span class="line"><span class="keyword">import</span> io.netty.channel.ChannelInboundHandlerAdapter;</span><br><span class="line"><span class="keyword">import</span> io.netty.channel.SimpleChannelInboundHandler;</span><br><span class="line"><span class="keyword">import</span> io.netty.channel.group.ChannelGroup;</span><br><span class="line"><span class="keyword">import</span> io.netty.channel.group.DefaultChannelGroup;</span><br><span class="line"><span class="keyword">import</span> io.netty.util.concurrent.GlobalEventExecutor;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.text.SimpleDateFormat;</span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">GroupChatServerHandler</span> <span class="keyword">extends</span> <span class="title class_">SimpleChannelInboundHandler</span>&lt;String&gt; &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">        ç¾¤èŠï¼š</span></span><br><span class="line"><span class="comment">        ç§èŠï¼šä½¿ç”¨ä¸€ä¸ªMapç®¡ç†å¤šä¸ª Channel</span></span><br><span class="line"><span class="comment">        ç¾¤èŠæ–¹å¼ä¸€ï¼šå®šä¹‰ä¸€ä¸ªListç®¡ç†æ‰€æœ‰ Channel</span></span><br><span class="line"><span class="comment">        ç¾¤èŠæ–¹å¼äºŒï¼šå®šä¹‰ä¸€ä¸ª channel ç»„ï¼Œç®¡ç†æ‰€æœ‰çš„channel</span></span><br><span class="line"><span class="comment">        GlobalEventExecutor.INSTANCE) æ˜¯å…¨å±€çš„äº‹ä»¶æ‰§è¡Œå™¨ï¼Œæ˜¯ä¸€ä¸ªå•ä¾‹</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">ChannelGroup</span> <span class="variable">channelGroup</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DefaultChannelGroup</span>(GlobalEventExecutor.INSTANCE);</span><br><span class="line">    <span class="type">SimpleDateFormat</span> <span class="variable">sdf</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SimpleDateFormat</span>(<span class="string">&quot;yyyy-MM-dd hh:mm:ss&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//handlerAdded è¡¨ç¤ºè¿æ¥å»ºç«‹ï¼Œä¸€æ—¦è¿æ¥ï¼Œç¬¬ä¸€ä¸ªè¢«æ‰§è¡Œ</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">handlerAdded</span><span class="params">(ChannelHandlerContext ctx)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">Channel</span> <span class="variable">channel</span> <span class="operator">=</span> ctx.channel();</span><br><span class="line">        <span class="comment">// è¯¥æ–¹æ³•ä¼šéå†æ‰€æœ‰çš„channelï¼Œå°†è¯¥ Channel åŠ å…¥ChannelGroupå‰ï¼Œéå†</span></span><br><span class="line">        channelGroup.writeAndFlush(<span class="string">&quot;[å®¢æˆ·ç«¯ï¼š]&quot;</span> + channel.remoteAddress() + <span class="string">&quot; åŠ å…¥èŠå¤© &quot;</span> + sdf.format(<span class="keyword">new</span> <span class="title class_">Date</span>()) + <span class="string">&quot;\n&quot;</span>);</span><br><span class="line">        channelGroup.add(channel);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//æ–­å¼€è¿æ¥, å°†å®¢æˆ·ç«¯ç¦»å¼€ä¿¡æ¯æ¨é€ç»™å½“å‰åœ¨çº¿çš„å®¢æˆ·</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">handlerRemoved</span><span class="params">(ChannelHandlerContext ctx)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">Channel</span> <span class="variable">channel</span> <span class="operator">=</span> ctx.channel();</span><br><span class="line">        System.out.println(<span class="string">&quot;[å®¢æˆ·ç«¯ï¼š]&quot;</span> + channel.remoteAddress() + <span class="string">&quot; ç¦»å¼€äº†\n&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;GroupChannelSize: &quot;</span> + channelGroup.size());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//è¡¨ç¤ºchannelå¤„äºä¸æ´»åŠ¨çš„çŠ¶æ€ï¼Œæç¤ºXXç¦»çº¿äº†</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">channelInactive</span><span class="params">(ChannelHandlerContext ctx)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        System.out.println(ctx.channel().remoteAddress() + <span class="string">&quot; ç¦»çº¿äº†\n&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//è¡¨ç¤ºchannelå¤„äºæ´»åŠ¨çŠ¶æ€ï¼Œæç¤ºXXä¸Šçº¿äº†</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">channelActive</span><span class="params">(ChannelHandlerContext ctx)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        System.out.println(ctx.channel().remoteAddress() + <span class="string">&quot; ä¸Šçº¿äº†&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">channelRead0</span><span class="params">(ChannelHandlerContext ctx, String msg)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">Channel</span> <span class="variable">channel</span> <span class="operator">=</span> ctx.channel();</span><br><span class="line">        channelGroup.forEach(ch -&gt; &#123;</span><br><span class="line">            <span class="keyword">if</span> (channel != ch) &#123;</span><br><span class="line">                ch.writeAndFlush(<span class="string">&quot;å®¢æˆ·ç«¯ï¼š&quot;</span> + channel.remoteAddress() + <span class="string">&quot; å‘é€äº†æ¶ˆæ¯ï¼š &quot;</span> + msg + <span class="string">&quot;\n&quot;</span>);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                ch.writeAndFlush(<span class="string">&quot;è‡ªå·±å‘é€äº†æ¶ˆæ¯ï¼š&quot;</span> + msg + <span class="string">&quot;\n&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>GroupChatClientï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.mineting.netty.groupchat;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> io.netty.bootstrap.Bootstrap;</span><br><span class="line"><span class="keyword">import</span> io.netty.channel.Channel;</span><br><span class="line"><span class="keyword">import</span> io.netty.channel.ChannelFuture;</span><br><span class="line"><span class="keyword">import</span> io.netty.channel.ChannelInitializer;</span><br><span class="line"><span class="keyword">import</span> io.netty.channel.ChannelPipeline;</span><br><span class="line"><span class="keyword">import</span> io.netty.channel.nio.NioEventLoopGroup;</span><br><span class="line"><span class="keyword">import</span> io.netty.channel.socket.SocketChannel;</span><br><span class="line"><span class="keyword">import</span> io.netty.channel.socket.nio.NioSocketChannel;</span><br><span class="line"><span class="keyword">import</span> io.netty.handler.codec.string.StringDecoder;</span><br><span class="line"><span class="keyword">import</span> io.netty.handler.codec.string.StringEncoder;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Scanner;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">GroupChatClient</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> port;</span><br><span class="line">    <span class="keyword">private</span> String ip;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">GroupChatClient</span><span class="params">(String ip, <span class="type">int</span> port)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.port = port;</span><br><span class="line">        <span class="built_in">this</span>.ip = ip;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">NioEventLoopGroup</span> <span class="variable">group</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">NioEventLoopGroup</span>();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">Bootstrap</span> <span class="variable">bootstrap</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Bootstrap</span>().group(group)</span><br><span class="line">                    .channel(NioSocketChannel.class)</span><br><span class="line">                    .handler(<span class="keyword">new</span> <span class="title class_">ChannelInitializer</span>&lt;SocketChannel&gt;() &#123;</span><br><span class="line">                        <span class="meta">@Override</span></span><br><span class="line">                        <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">initChannel</span><span class="params">(SocketChannel ch)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">                            <span class="type">ChannelPipeline</span> <span class="variable">pipeline</span> <span class="operator">=</span> ch.pipeline();</span><br><span class="line">                            pipeline.addLast(<span class="string">&quot;StringDecoder&quot;</span>, <span class="keyword">new</span> <span class="title class_">StringDecoder</span>());</span><br><span class="line">                            pipeline.addLast(<span class="string">&quot;StringEncoder&quot;</span>, <span class="keyword">new</span> <span class="title class_">StringEncoder</span>());</span><br><span class="line">                            pipeline.addLast(<span class="keyword">new</span> <span class="title class_">GroupChatClientHandler</span>());</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;);</span><br><span class="line">            <span class="comment">//å»ºç«‹è¿æ¥</span></span><br><span class="line">            <span class="type">ChannelFuture</span> <span class="variable">channelFuture</span> <span class="operator">=</span> bootstrap.connect(ip, port).sync();</span><br><span class="line">            <span class="type">Channel</span> <span class="variable">channel</span> <span class="operator">=</span> channelFuture.channel();</span><br><span class="line">            System.out.println(channel.localAddress() + <span class="string">&quot; start...&quot;</span>);</span><br><span class="line">            <span class="type">Scanner</span> <span class="variable">scanner</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Scanner</span>(System.in);</span><br><span class="line">            <span class="keyword">while</span> (scanner.hasNextLine()) &#123;</span><br><span class="line">                <span class="type">String</span> <span class="variable">msg</span> <span class="operator">=</span> scanner.nextLine();</span><br><span class="line">                channel.writeAndFlush(msg);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            group.shutdownGracefully();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">GroupChatClient</span>(<span class="string">&quot;127.0.0.1&quot;</span>, <span class="number">8000</span>).run();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>GroupChatClientHandlerï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.mineting.netty.groupchat;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> io.netty.channel.ChannelHandlerContext;</span><br><span class="line"><span class="keyword">import</span> io.netty.channel.SimpleChannelInboundHandler;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">GroupChatClientHandler</span> <span class="keyword">extends</span> <span class="title class_">SimpleChannelInboundHandler</span>&lt;String&gt; &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">channelRead0</span><span class="params">(ChannelHandlerContext channelHandlerContext, String s)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        System.out.println(s.trim());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Netty-å¿ƒè·³æ£€æµ‹æœºåˆ¶"><a href="#Netty-å¿ƒè·³æ£€æµ‹æœºåˆ¶" class="headerlink" title="Netty å¿ƒè·³æ£€æµ‹æœºåˆ¶"></a>Netty å¿ƒè·³æ£€æµ‹æœºåˆ¶</h2><p>ç¨‹åºè¦æ±‚ï¼š</p>
<ol>
<li><p>ç¼–å†™ä¸€ä¸ª Nettyå¿ƒè·³æ£€æµ‹æœºåˆ¶æ¡ˆä¾‹, å½“æœåŠ¡å™¨è¶…è¿‡3ç§’æ²¡æœ‰è¯»æ—¶ï¼Œå°±æç¤ºè¯»ç©ºé—²ã€‚</p>
</li>
<li><p>å½“æœåŠ¡å™¨è¶…è¿‡5ç§’æ²¡æœ‰å†™æ“ä½œæ—¶ï¼Œå°±æç¤ºå†™ç©ºé—²ã€‚</p>
</li>
<li><p><strong>ä½¿ç”¨å®¢æˆ·ç«¯è¿æ¥</strong>ï¼Œå¦‚æœæœåŠ¡å™¨è¶…è¿‡7ç§’æ²¡æœ‰è¯»æˆ–è€…å†™æ“ä½œæ—¶ï¼Œå°±æç¤ºè¯»å†™ç©ºé—²ã€‚</p>
</li>
</ol>
<p>HeartBeatServerï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.mineting.netty.heartbeat;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> io.netty.bootstrap.ServerBootstrap;</span><br><span class="line"><span class="keyword">import</span> io.netty.channel.ChannelFuture;</span><br><span class="line"><span class="keyword">import</span> io.netty.channel.ChannelInitializer;</span><br><span class="line"><span class="keyword">import</span> io.netty.channel.ChannelPipeline;</span><br><span class="line"><span class="keyword">import</span> io.netty.channel.nio.NioEventLoopGroup;</span><br><span class="line"><span class="keyword">import</span> io.netty.channel.socket.SocketChannel;</span><br><span class="line"><span class="keyword">import</span> io.netty.channel.socket.nio.NioServerSocketChannel;</span><br><span class="line"><span class="keyword">import</span> io.netty.handler.logging.LogLevel;</span><br><span class="line"><span class="keyword">import</span> io.netty.handler.logging.LoggingHandler;</span><br><span class="line"><span class="keyword">import</span> io.netty.handler.timeout.IdleStateHandler;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.TimeUnit;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HeartBeatServer</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">        <span class="type">NioEventLoopGroup</span> <span class="variable">bossGroup</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">NioEventLoopGroup</span>(<span class="number">1</span>);</span><br><span class="line">        <span class="type">NioEventLoopGroup</span> <span class="variable">workerGroup</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">NioEventLoopGroup</span>();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">ServerBootstrap</span> <span class="variable">serverBootstrap</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ServerBootstrap</span>();</span><br><span class="line">            serverBootstrap.group(bossGroup, workerGroup).channel(NioServerSocketChannel.class)</span><br><span class="line">                    .handler(<span class="keyword">new</span> <span class="title class_">LoggingHandler</span>(LogLevel.INFO))</span><br><span class="line">                    .childHandler(<span class="keyword">new</span> <span class="title class_">ChannelInitializer</span>&lt;SocketChannel&gt;() &#123;</span><br><span class="line">                        <span class="meta">@Override</span></span><br><span class="line">                        <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">initChannel</span><span class="params">(SocketChannel ch)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">                            <span class="type">ChannelPipeline</span> <span class="variable">pipeline</span> <span class="operator">=</span> ch.pipeline();</span><br><span class="line">                            <span class="comment">//åŠ å…¥ä¸€ä¸ªnetty æä¾› IdleStateHandler</span></span><br><span class="line">                            <span class="comment">/*</span></span><br><span class="line"><span class="comment">                            è¯´æ˜</span></span><br><span class="line"><span class="comment">                            1. IdleStateHandler æ˜¯netty æä¾›çš„å¤„ç†ç©ºé—²çŠ¶æ€çš„å¤„ç†å™¨</span></span><br><span class="line"><span class="comment">                            2. long readerIdleTime : è¡¨ç¤ºå¤šé•¿æ—¶é—´æ²¡æœ‰è¯», å°±ä¼šå‘é€ä¸€ä¸ªå¿ƒè·³æ£€æµ‹åŒ…æ£€æµ‹æ˜¯å¦è¿æ¥</span></span><br><span class="line"><span class="comment">                            3. long writerIdleTime : è¡¨ç¤ºå¤šé•¿æ—¶é—´æ²¡æœ‰å†™, å°±ä¼šå‘é€ä¸€ä¸ªå¿ƒè·³æ£€æµ‹åŒ…æ£€æµ‹æ˜¯å¦è¿æ¥</span></span><br><span class="line"><span class="comment">                            4. long allIdleTime : è¡¨ç¤ºå¤šé•¿æ—¶é—´æ²¡æœ‰è¯»å†™, å°±ä¼šå‘é€ä¸€ä¸ªå¿ƒè·³æ£€æµ‹åŒ…æ£€æµ‹æ˜¯å¦è¿æ¥</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">                            5. æ–‡æ¡£è¯´æ˜</span></span><br><span class="line"><span class="comment">                            triggers an &#123;@link IdleStateEvent&#125; when a &#123;@link Channel&#125; has not performed read, write, or both operation for a while.</span></span><br><span class="line"><span class="comment">                             6. å½“ IdleStateEvent è§¦å‘å , å°±ä¼šä¼ é€’ç»™ç®¡é“ çš„ä¸‹ä¸€ä¸ªhandlerå»å¤„ç†</span></span><br><span class="line"><span class="comment">                             é€šè¿‡è°ƒç”¨(è§¦å‘)ä¸‹ä¸€ä¸ªhandler çš„ userEventTriggered , åœ¨è¯¥æ–¹æ³•ä¸­å»å¤„ç† IdleStateEvent(è¯»ç©ºé—²ï¼Œå†™ç©ºé—²ï¼Œè¯»å†™ç©ºé—²)</span></span><br><span class="line"><span class="comment">                             */</span></span><br><span class="line">                            pipeline.addLast(<span class="keyword">new</span> <span class="title class_">IdleStateHandler</span>(<span class="number">5</span>, <span class="number">7</span>, <span class="number">3</span>, TimeUnit.SECONDS));</span><br><span class="line">                            pipeline.addLast(<span class="keyword">new</span> <span class="title class_">HeartBeatHandler</span>());</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;);</span><br><span class="line">            <span class="type">ChannelFuture</span> <span class="variable">channelFuture</span> <span class="operator">=</span> serverBootstrap.bind(<span class="number">8000</span>).sync();</span><br><span class="line">            System.out.println(<span class="string">&quot;HeartBeat Server Start...&quot;</span>);</span><br><span class="line">            channelFuture.channel().closeFuture().sync();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            bossGroup.shutdownGracefully();</span><br><span class="line">            workerGroup.shutdownGracefully();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>HeartBeatHandlerï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.mineting.netty.heartbeat;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> io.netty.channel.ChannelHandlerContext;</span><br><span class="line"><span class="keyword">import</span> io.netty.channel.ChannelInboundHandlerAdapter;</span><br><span class="line"><span class="keyword">import</span> io.netty.handler.timeout.IdleStateEvent;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HeartBeatHandler</span> <span class="keyword">extends</span> <span class="title class_">ChannelInboundHandlerAdapter</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">userEventTriggered</span><span class="params">(ChannelHandlerContext ctx, Object evt)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="keyword">if</span> (evt <span class="keyword">instanceof</span> IdleStateEvent) &#123;</span><br><span class="line">            <span class="type">IdleStateEvent</span> <span class="variable">event</span> <span class="operator">=</span> (IdleStateEvent) evt;</span><br><span class="line">            <span class="type">String</span> <span class="variable">eventType</span> <span class="operator">=</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">            <span class="keyword">switch</span> (event.state()) &#123;</span><br><span class="line">                <span class="keyword">case</span> READER_IDLE:</span><br><span class="line">                    eventType = <span class="string">&quot;è¯»ç©ºé—²&quot;</span>;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">case</span> WRITER_IDLE:</span><br><span class="line">                    eventType = <span class="string">&quot;å†™ç©ºé—²&quot;</span>;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">case</span> ALL_IDLE:</span><br><span class="line">                    eventType = <span class="string">&quot;è¯»å†™ç©ºé—²&quot;</span>;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            System.out.println(ctx.channel().remoteAddress() + <span class="string">&quot;...è¶…æ—¶æ—¶é—´...&quot;</span> + eventType);</span><br><span class="line">            <span class="comment">// å¦‚æœå‘ç”Ÿç©ºé—²ï¼Œå…³é—­é€šé“</span></span><br><span class="line">            <span class="comment">// ctx.channel().close();</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>HeartBeatClientï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.mineting.netty.heartbeat;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.example.mineting.netty.groupchat.GroupChatClientHandler;</span><br><span class="line"><span class="keyword">import</span> io.netty.bootstrap.Bootstrap;</span><br><span class="line"><span class="keyword">import</span> io.netty.channel.Channel;</span><br><span class="line"><span class="keyword">import</span> io.netty.channel.ChannelFuture;</span><br><span class="line"><span class="keyword">import</span> io.netty.channel.ChannelInitializer;</span><br><span class="line"><span class="keyword">import</span> io.netty.channel.ChannelPipeline;</span><br><span class="line"><span class="keyword">import</span> io.netty.channel.nio.NioEventLoopGroup;</span><br><span class="line"><span class="keyword">import</span> io.netty.channel.socket.SocketChannel;</span><br><span class="line"><span class="keyword">import</span> io.netty.channel.socket.nio.NioSocketChannel;</span><br><span class="line"><span class="keyword">import</span> io.netty.handler.codec.string.StringDecoder;</span><br><span class="line"><span class="keyword">import</span> io.netty.handler.codec.string.StringEncoder;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Scanner;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HeartBeatClient</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> port;</span><br><span class="line">    <span class="keyword">private</span> String ip;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">HeartBeatClient</span><span class="params">(String ip, <span class="type">int</span> port)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.port = port;</span><br><span class="line">        <span class="built_in">this</span>.ip = ip;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">NioEventLoopGroup</span> <span class="variable">group</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">NioEventLoopGroup</span>();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">Bootstrap</span> <span class="variable">bootstrap</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Bootstrap</span>().group(group)</span><br><span class="line">                    .channel(NioSocketChannel.class)</span><br><span class="line">                    .handler(<span class="keyword">new</span> <span class="title class_">ChannelInitializer</span>&lt;SocketChannel&gt;() &#123;</span><br><span class="line">                        <span class="meta">@Override</span></span><br><span class="line">                        <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">initChannel</span><span class="params">(SocketChannel ch)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">                            <span class="type">ChannelPipeline</span> <span class="variable">pipeline</span> <span class="operator">=</span> ch.pipeline();</span><br><span class="line">                            pipeline.addLast(<span class="string">&quot;StringDecoder&quot;</span>, <span class="keyword">new</span> <span class="title class_">StringDecoder</span>());</span><br><span class="line">                            pipeline.addLast(<span class="string">&quot;StringEncoder&quot;</span>, <span class="keyword">new</span> <span class="title class_">StringEncoder</span>());</span><br><span class="line">                            pipeline.addLast(<span class="keyword">new</span> <span class="title class_">GroupChatClientHandler</span>());</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;);</span><br><span class="line">            <span class="comment">//å»ºç«‹è¿æ¥</span></span><br><span class="line">            <span class="type">ChannelFuture</span> <span class="variable">channelFuture</span> <span class="operator">=</span> bootstrap.connect(ip, port).sync();</span><br><span class="line">            <span class="type">Channel</span> <span class="variable">channel</span> <span class="operator">=</span> channelFuture.channel();</span><br><span class="line">            System.out.println(channel.localAddress() + <span class="string">&quot; start...&quot;</span>);</span><br><span class="line">            <span class="type">Scanner</span> <span class="variable">scanner</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Scanner</span>(System.in);</span><br><span class="line">            <span class="keyword">while</span> (scanner.hasNextLine()) &#123;</span><br><span class="line">                <span class="type">String</span> <span class="variable">msg</span> <span class="operator">=</span> scanner.nextLine();</span><br><span class="line">                channel.writeAndFlush(msg);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            group.shutdownGracefully();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">HeartBeatClient</span>(<span class="string">&quot;127.0.0.1&quot;</span>, <span class="number">8000</span>).run();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="Netty-WebSocketé•¿è¿æ¥"><a href="#Netty-WebSocketé•¿è¿æ¥" class="headerlink" title="Netty WebSocketé•¿è¿æ¥"></a>Netty WebSocketé•¿è¿æ¥</h2><p>ç¨‹åºè¦æ±‚ï¼šå®ç°åŸºäºwebSocketçš„é•¿è¿æ¥çš„å…¨åŒå·¥çš„äº¤äº’ï¼Œå®¢æˆ·ç«¯æµè§ˆå™¨å’ŒæœåŠ¡å™¨ç«¯ä¼šç›¸äº’æ„ŸçŸ¥ï¼ŒæœåŠ¡å™¨å¯ä»¥å‘é€æ¶ˆæ¯ç»™æµè§ˆå™¨ã€‚</p>
<p>WebSocketServerï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.mineting.netty.websocket;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> io.netty.bootstrap.ServerBootstrap;</span><br><span class="line"><span class="keyword">import</span> io.netty.channel.ChannelFuture;</span><br><span class="line"><span class="keyword">import</span> io.netty.channel.ChannelInitializer;</span><br><span class="line"><span class="keyword">import</span> io.netty.channel.ChannelOption;</span><br><span class="line"><span class="keyword">import</span> io.netty.channel.ChannelPipeline;</span><br><span class="line"><span class="keyword">import</span> io.netty.channel.nio.NioEventLoopGroup;</span><br><span class="line"><span class="keyword">import</span> io.netty.channel.socket.SocketChannel;</span><br><span class="line"><span class="keyword">import</span> io.netty.channel.socket.nio.NioServerSocketChannel;</span><br><span class="line"><span class="keyword">import</span> io.netty.handler.codec.http.HttpObjectAggregator;</span><br><span class="line"><span class="keyword">import</span> io.netty.handler.codec.http.HttpServerCodec;</span><br><span class="line"><span class="keyword">import</span> io.netty.handler.codec.http.websocketx.WebSocketServerProtocolHandler;</span><br><span class="line"><span class="keyword">import</span> io.netty.handler.logging.LogLevel;</span><br><span class="line"><span class="keyword">import</span> io.netty.handler.logging.LoggingHandler;</span><br><span class="line"><span class="keyword">import</span> io.netty.handler.stream.ChunkedWriteHandler;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WebSocketServer</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">NioEventLoopGroup</span> <span class="variable">listenGroup</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">NioEventLoopGroup</span>(<span class="number">1</span>);</span><br><span class="line">        <span class="type">NioEventLoopGroup</span> <span class="variable">handlerGroup</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">NioEventLoopGroup</span>();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">ServerBootstrap</span> <span class="variable">serverBootstrap</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ServerBootstrap</span>();</span><br><span class="line">            serverBootstrap.group(listenGroup, handlerGroup)</span><br><span class="line">                    .channel(NioServerSocketChannel.class)</span><br><span class="line">                    .option(ChannelOption.SO_BACKLOG, <span class="number">128</span>)</span><br><span class="line">                    .childOption(ChannelOption.SO_KEEPALIVE, <span class="literal">true</span>)</span><br><span class="line">                    .handler(<span class="keyword">new</span> <span class="title class_">LoggingHandler</span>(LogLevel.INFO))</span><br><span class="line">                    .childHandler(<span class="keyword">new</span> <span class="title class_">ChannelInitializer</span>&lt;SocketChannel&gt;() &#123;</span><br><span class="line">                        <span class="meta">@Override</span></span><br><span class="line">                        <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">initChannel</span><span class="params">(SocketChannel socketChannel)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">                            <span class="type">ChannelPipeline</span> <span class="variable">channel</span> <span class="operator">=</span> socketChannel.pipeline();</span><br><span class="line">                            <span class="comment">// åŸºäºhttpåè®®ï¼Œä½¿ç”¨httpçš„ç¼–ç å’Œè§£ç å™¨</span></span><br><span class="line">                            channel.addLast(<span class="keyword">new</span> <span class="title class_">HttpServerCodec</span>());</span><br><span class="line">                            <span class="comment">// æ˜¯ä»¥å—æ–¹å¼å†™ï¼Œæ·»åŠ ChunkedWriteHandlerå¤„ç†å™¨</span></span><br><span class="line">                            channel.addLast(<span class="keyword">new</span> <span class="title class_">ChunkedWriteHandler</span>());</span><br><span class="line">                            <span class="comment">// httpæ•°æ®åœ¨ä¼ è¾“è¿‡ç¨‹ä¸­æ˜¯åˆ†æ®µ, HttpObjectAggregator ï¼Œå°±æ˜¯å¯ä»¥å°†å¤šä¸ªæ®µèšåˆ</span></span><br><span class="line">                            <span class="comment">// å½“æµè§ˆå™¨å‘é€å¤§é‡æ•°æ®æ—¶ï¼Œå°±ä¼šå‘å‡ºå¤šæ¬¡httpè¯·æ±‚</span></span><br><span class="line">                            channel.addLast(<span class="keyword">new</span> <span class="title class_">HttpObjectAggregator</span>(<span class="number">8192</span>));</span><br><span class="line">                            <span class="comment">// å¯¹åº”websocket ï¼Œå®ƒçš„æ•°æ®æ˜¯ä»¥ å¸§(frame) å½¢å¼ä¼ é€’</span></span><br><span class="line">                            <span class="comment">// æµè§ˆå™¨è¯·æ±‚æ—¶ ws://localhost:7000/hello è¡¨ç¤ºè¯·æ±‚çš„uri</span></span><br><span class="line">                            <span class="comment">// WebSocketServerProtocolHandler æ ¸å¿ƒåŠŸèƒ½æ˜¯å°† httpåè®®å‡çº§ä¸º wsåè®® , ä¿æŒé•¿è¿æ¥</span></span><br><span class="line">                            channel.addLast(<span class="keyword">new</span> <span class="title class_">WebSocketServerProtocolHandler</span>(<span class="string">&quot;/ws01&quot;</span>));</span><br><span class="line">                            <span class="comment">// è‡ªå®šä¹‰çš„handler ï¼Œå¤„ç†ä¸šåŠ¡é€»è¾‘, å‰å°é€šè¿‡ textarea æäº¤æ•°æ®</span></span><br><span class="line">                            channel.addLast(<span class="keyword">new</span> <span class="title class_">MyTextWebSocketFrameHandler</span>());</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;);</span><br><span class="line">            <span class="type">ChannelFuture</span> <span class="variable">channelFuture</span> <span class="operator">=</span> serverBootstrap.bind(<span class="number">8000</span>).sync();</span><br><span class="line">            System.out.println(<span class="string">&quot;WebSocket Server Start....&quot;</span>);</span><br><span class="line">            channelFuture.channel().closeFuture().sync();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            listenGroup.shutdownGracefully();</span><br><span class="line">            handlerGroup.shutdownGracefully();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>MyTextWebSocketFrameHandlerï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.mineting.netty.websocket;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> io.netty.channel.ChannelHandlerContext;</span><br><span class="line"><span class="keyword">import</span> io.netty.channel.SimpleChannelInboundHandler;</span><br><span class="line"><span class="keyword">import</span> io.netty.handler.codec.http.websocketx.TextWebSocketFrame;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.time.LocalDateTime;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * TextWebSocketFrame: è¡¨ç¤ºä¸€ä¸ªæ–‡æœ¬å¸§</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyTextWebSocketFrameHandler</span> <span class="keyword">extends</span> <span class="title class_">SimpleChannelInboundHandler</span>&lt;TextWebSocketFrame&gt; &#123;</span><br><span class="line">    <span class="comment">// æœ‰æ•°æ®è¯»å†™æ—¶è§¦å‘</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">channelRead0</span><span class="params">(ChannelHandlerContext ctx, TextWebSocketFrame textFrame)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;WebSocket Server: &quot;</span> + textFrame.text());</span><br><span class="line">        ctx.writeAndFlush(<span class="keyword">new</span> <span class="title class_">TextWebSocketFrame</span>(<span class="string">&quot;WebSocket Server: &quot;</span> + LocalDateTime.now() + <span class="string">&quot; &quot;</span> + textFrame.text()));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å½“å®¢æˆ·ç«¯è¿æ¥æ—¶è§¦å‘</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">handlerAdded</span><span class="params">(ChannelHandlerContext ctx)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;handlerAdded: &quot;</span> + ctx.channel().id().asLongText());</span><br><span class="line">        System.out.println(<span class="string">&quot;handlerAdded: &quot;</span> + ctx.channel().id().asShortText());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å½“å®¢æˆ·ç«¯è¿æ¥æ—¶è§¦å‘</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">handlerRemoved</span><span class="params">(ChannelHandlerContext ctx)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;handlerRemoved: &quot;</span> + ctx.channel().id().asShortText());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">exceptionCaught</span><span class="params">(ChannelHandlerContext ctx, Throwable cause)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;å¼‚å¸¸å‘ç”Ÿ &quot;</span> + cause.getMessage());</span><br><span class="line">        ctx.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>ws.htmlï¼š</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Title<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// æ³¨æ„ä½¿ç”¨ var ç»™ window æ·»åŠ å±æ€§ï¼Œè€Œä¸æ˜¯let</span></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">var</span> socket;</span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// åˆ¤æ–­æµè§ˆå™¨æ˜¯å¦æ”¯æŒWebSocket</span></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">if</span> (<span class="variable language_">window</span>.<span class="property">WebSocket</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">            socket = <span class="keyword">new</span> <span class="title class_">WebSocket</span>(<span class="string">&quot;ws://localhost:8000/ws01&quot;</span>)</span></span><br><span class="line"><span class="language-javascript">            <span class="comment">// æ”¶åˆ°æœåŠ¡å™¨å›å¤çš„æ¶ˆæ¯</span></span></span><br><span class="line"><span class="language-javascript">            socket.<span class="property">onmessage</span> = <span class="keyword">function</span> (<span class="params">ev</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="keyword">var</span> ret = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;responseText&quot;</span>)</span></span><br><span class="line"><span class="language-javascript">                ret.<span class="property">value</span> = ret.<span class="property">value</span> + <span class="string">&quot;\n&quot;</span> + ev.<span class="property">data</span></span></span><br><span class="line"><span class="language-javascript">            &#125;</span></span><br><span class="line"><span class="language-javascript">            <span class="comment">// è¿æ¥å°±ç»ª</span></span></span><br><span class="line"><span class="language-javascript">            socket.<span class="property">onopen</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="keyword">var</span> ret = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;responseText&quot;</span>)</span></span><br><span class="line"><span class="language-javascript">                ret.<span class="property">value</span> = <span class="string">&quot;è¿æ¥å°±ç»ª...&quot;</span></span></span><br><span class="line"><span class="language-javascript">            &#125;</span></span><br><span class="line"><span class="language-javascript">            <span class="comment">// è¿æ¥å…³é—­</span></span></span><br><span class="line"><span class="language-javascript">            socket.<span class="property">onclose</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="keyword">var</span> ret = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;responseText&quot;</span>)</span></span><br><span class="line"><span class="language-javascript">                ret.<span class="property">value</span> = ret.<span class="property">value</span> + <span class="string">&quot;\n&quot;</span> + <span class="string">&quot;è¿æ¥æ–­å¼€&quot;</span></span></span><br><span class="line"><span class="language-javascript">            &#125;</span></span><br><span class="line"><span class="language-javascript">        &#125; <span class="keyword">else</span> &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="title function_">alert</span>(<span class="string">&quot;å½“å‰æµè§ˆå™¨ä¸æ”¯æŒWebSocket&quot;</span>)</span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">function</span> <span class="title function_">send</span>(<span class="params">message</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="comment">// socketæ˜¯å¦åˆ›å»ºå¥½</span></span></span><br><span class="line"><span class="language-javascript">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">window</span>.<span class="property">socket</span>)</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">if</span> (!<span class="variable language_">window</span>.<span class="property">socket</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="keyword">return</span></span></span><br><span class="line"><span class="language-javascript">            &#125;</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">if</span> (socket.<span class="property">readyState</span> == <span class="title class_">WebSocket</span>.<span class="property">OPEN</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">                socket.<span class="title function_">send</span>(message)</span></span><br><span class="line"><span class="language-javascript">            &#125; <span class="keyword">else</span> &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="title function_">alert</span>(<span class="string">&quot;è¿æ¥æ²¡æœ‰å¼€å¯&quot;</span>)</span></span><br><span class="line"><span class="language-javascript">            &#125;</span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript">    </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">onsubmit</span>=<span class="string">&quot;return false&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">textarea</span> <span class="attr">name</span>=<span class="string">&quot;message&quot;</span> <span class="attr">style</span>=<span class="string">&quot;width:300px;height:300px&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">textarea</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;button&quot;</span> <span class="attr">value</span>=<span class="string">&quot;å‘é€æ¶ˆæ¯&quot;</span> <span class="attr">onclick</span>=<span class="string">&quot;send(this.form.message.value)&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">textarea</span> <span class="attr">id</span>=<span class="string">&quot;responseText&quot;</span> <span class="attr">style</span>=<span class="string">&quot;width:300px;height: 300px&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">textarea</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;button&quot;</span> <span class="attr">onclick</span>=<span class="string">&quot;document.getElementById(&#x27;responseText&#x27;).value = &#x27;&#x27;&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>



<h1 id="Google-Protobufï¼ˆç•¥ï¼‰"><a href="#Google-Protobufï¼ˆç•¥ï¼‰" class="headerlink" title="Google Protobufï¼ˆç•¥ï¼‰"></a>Google Protobufï¼ˆç•¥ï¼‰</h1><h1 id="Nettyç¼–è§£ç å™¨å’Œhandlerçš„è°ƒç”¨æœºåˆ¶"><a href="#Nettyç¼–è§£ç å™¨å’Œhandlerçš„è°ƒç”¨æœºåˆ¶" class="headerlink" title="Nettyç¼–è§£ç å™¨å’Œhandlerçš„è°ƒç”¨æœºåˆ¶"></a>Nettyç¼–è§£ç å™¨å’Œhandlerçš„è°ƒç”¨æœºåˆ¶</h1><h1 id="TCP-ç²˜åŒ…å’Œæ‹†åŒ…åŠè§£å†³æ–¹æ¡ˆ"><a href="#TCP-ç²˜åŒ…å’Œæ‹†åŒ…åŠè§£å†³æ–¹æ¡ˆ" class="headerlink" title="TCP ç²˜åŒ…å’Œæ‹†åŒ…åŠè§£å†³æ–¹æ¡ˆ"></a>TCP ç²˜åŒ…å’Œæ‹†åŒ…åŠè§£å†³æ–¹æ¡ˆ</h1><h2 id="åŸºæœ¬ä»‹ç»-5"><a href="#åŸºæœ¬ä»‹ç»-5" class="headerlink" title="åŸºæœ¬ä»‹ç»"></a>åŸºæœ¬ä»‹ç»</h2><ol>
<li><p>TCPæ˜¯é¢å‘è¿æ¥çš„ï¼Œé¢å‘æµçš„ï¼Œæä¾›é«˜å¯é æ€§æœåŠ¡ã€‚æ”¶å‘ä¸¤ç«¯ï¼ˆå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ç«¯ï¼‰éƒ½è¦æœ‰ä¸€ä¸€æˆå¯¹çš„socketï¼Œå› æ­¤ï¼Œå‘é€ç«¯ä¸ºäº†å°†		å¤šä¸ªå‘ç»™æ¥æ”¶ç«¯çš„åŒ…ï¼Œæ›´æœ‰æ•ˆçš„å‘ç»™å¯¹æ–¹ï¼Œä½¿ç”¨äº†ä¼˜åŒ–æ–¹æ³•ï¼ˆNagleç®—æ³•ï¼‰ï¼Œå°†å¤šæ¬¡é—´éš”è¾ƒå°ä¸”æ•°æ®é‡å°çš„æ•°æ®ï¼Œåˆå¹¶æˆä¸€ä¸ªå¤§çš„æ•°		æ®å—ï¼Œç„¶åè¿›è¡Œå°åŒ…ã€‚è¿™æ ·åšè™½ç„¶æé«˜äº†æ•ˆç‡ï¼Œä½†æ˜¯æ¥æ”¶ç«¯å°±éš¾äºåˆ†è¾¨å‡ºå®Œæ•´çš„æ•°æ®åŒ…äº†ï¼Œå› ä¸ºé¢å‘æµçš„é€šä¿¡æ˜¯æ— æ¶ˆæ¯ä¿æŠ¤è¾¹ç•Œçš„ã€‚</p>
</li>
<li><p>ç”±äºTCPæ— æ¶ˆæ¯ä¿æŠ¤è¾¹ç•Œ, éœ€è¦åœ¨æ¥æ”¶ç«¯å¤„ç†æ¶ˆæ¯è¾¹ç•Œé—®é¢˜ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬æ‰€è¯´çš„ç²˜åŒ…ã€æ‹†åŒ…é—®é¢˜, çœ‹ä¸€å¼ å›¾ã€‚</p>
</li>
</ol>
<img src="/2023/02/28/Netty/Java\Document\Netty\Netty å‚çœ‹æ–‡æ¡£.assets\image-20220920173939976.png" alt="image-20220920173939976" style="zoom:150%;">

<p>è¯´æ˜ï¼š</p>
<p>â€‹		å‡è®¾å®¢æˆ·ç«¯åˆ†åˆ«å‘é€äº†ä¸¤ä¸ªæ•°æ®åŒ…D1å’ŒD2ç»™æœåŠ¡ç«¯ï¼Œç”±äºæœåŠ¡ç«¯ä¸€æ¬¡è¯»å–åˆ°å­—èŠ‚æ•°æ˜¯ä¸ç¡®å®šçš„ï¼Œæ•…å¯èƒ½å­˜åœ¨ä»¥ä¸‹å››ç§æƒ…å†µï¼š</p>
<ol>
<li><p>æœåŠ¡ç«¯åˆ†ä¸¤æ¬¡è¯»å–åˆ°äº†ä¸¤ä¸ªç‹¬ç«‹çš„æ•°æ®åŒ…ï¼Œåˆ†åˆ«æ˜¯D1å’ŒD2ï¼Œæ²¡æœ‰ç²˜åŒ…å’Œæ‹†åŒ…ã€‚</p>
</li>
<li><p>æœåŠ¡ç«¯ä¸€æ¬¡æ¥å—åˆ°äº†ä¸¤ä¸ªæ•°æ®åŒ…ï¼ŒD1å’ŒD2ç²˜åˆåœ¨ä¸€èµ·ï¼Œç§°ä¹‹ä¸ºTCPç²˜åŒ…ã€‚</p>
</li>
<li><p>æœåŠ¡ç«¯åˆ†ä¸¤æ¬¡è¯»å–åˆ°äº†æ•°æ®åŒ…ï¼Œç¬¬ä¸€æ¬¡è¯»å–åˆ°äº†å®Œæ•´çš„D1åŒ…å’ŒD2åŒ…çš„éƒ¨åˆ†å†…å®¹ï¼Œç¬¬äºŒæ¬¡è¯»å–åˆ°äº†D2åŒ…çš„å‰©ä½™å†…å®¹ï¼Œè¿™ç§°ä¹‹ä¸ºTCPæ‹†		åŒ…ã€‚</p>
</li>
<li><p>æœåŠ¡ç«¯åˆ†ä¸¤æ¬¡è¯»å–åˆ°äº†æ•°æ®åŒ…ï¼Œç¬¬ä¸€æ¬¡è¯»å–åˆ°äº†D1åŒ…çš„éƒ¨åˆ†å†…å®¹D1_1ï¼Œç¬¬äºŒæ¬¡è¯»å–åˆ°äº†D1åŒ…çš„å‰©ä½™éƒ¨åˆ†å†…å®¹D1_2å’Œå®Œæ•´çš„D2åŒ…ã€‚</p>
</li>
</ol>
<h2 id="ä»£ç ç¤ºä¾‹"><a href="#ä»£ç ç¤ºä¾‹" class="headerlink" title="ä»£ç ç¤ºä¾‹"></a>ä»£ç ç¤ºä¾‹</h2><h3 id="ç²˜åŒ…ç¤ºä¾‹"><a href="#ç²˜åŒ…ç¤ºä¾‹" class="headerlink" title="ç²˜åŒ…ç¤ºä¾‹"></a>ç²˜åŒ…ç¤ºä¾‹</h3><p>Server</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.mineting.netty.tcp;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> io.netty.bootstrap.ServerBootstrap;</span><br><span class="line"><span class="keyword">import</span> io.netty.channel.ChannelFuture;</span><br><span class="line"><span class="keyword">import</span> io.netty.channel.ChannelInitializer;</span><br><span class="line"><span class="keyword">import</span> io.netty.channel.ChannelOption;</span><br><span class="line"><span class="keyword">import</span> io.netty.channel.nio.NioEventLoopGroup;</span><br><span class="line"><span class="keyword">import</span> io.netty.channel.socket.SocketChannel;</span><br><span class="line"><span class="keyword">import</span> io.netty.channel.socket.nio.NioServerSocketChannel;</span><br><span class="line"><span class="keyword">import</span> io.netty.handler.logging.LogLevel;</span><br><span class="line"><span class="keyword">import</span> io.netty.handler.logging.LoggingHandler;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Tcp: ç²˜åŒ…</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyServer</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">NioEventLoopGroup</span> <span class="variable">listenGroup</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">NioEventLoopGroup</span>(<span class="number">1</span>);</span><br><span class="line">        <span class="type">NioEventLoopGroup</span> <span class="variable">handlerGroup</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">NioEventLoopGroup</span>();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">ServerBootstrap</span> <span class="variable">serverBootstrap</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ServerBootstrap</span>();</span><br><span class="line">            serverBootstrap.group(listenGroup,handlerGroup)</span><br><span class="line">                    .channel(NioServerSocketChannel.class)</span><br><span class="line">                    .option(ChannelOption.SO_BACKLOG,<span class="number">128</span>)</span><br><span class="line">                    .childOption(ChannelOption.SO_KEEPALIVE,<span class="literal">true</span>)</span><br><span class="line">                    .handler(<span class="keyword">new</span> <span class="title class_">LoggingHandler</span>(LogLevel.INFO))</span><br><span class="line">                    .childHandler(<span class="keyword">new</span> <span class="title class_">ChannelInitializer</span>&lt;SocketChannel&gt;() &#123;</span><br><span class="line">                        <span class="meta">@Override</span></span><br><span class="line">                        <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">initChannel</span><span class="params">(SocketChannel socketChannel)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">                            socketChannel.pipeline().addLast(<span class="keyword">new</span> <span class="title class_">MyServerHandler</span>());</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;);</span><br><span class="line">            <span class="type">ChannelFuture</span> <span class="variable">channelFuture</span> <span class="operator">=</span> serverBootstrap.bind(<span class="number">8000</span>).sync();</span><br><span class="line">            System.out.println(<span class="string">&quot;Server Start...&quot;</span>);</span><br><span class="line">            channelFuture.channel().closeFuture().sync();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            listenGroup.shutdownGracefully();</span><br><span class="line">            handlerGroup.shutdownGracefully();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ServerHandler</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.mineting.netty.tcp;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> io.netty.buffer.ByteBuf;</span><br><span class="line"><span class="keyword">import</span> io.netty.buffer.Unpooled;</span><br><span class="line"><span class="keyword">import</span> io.netty.channel.ChannelHandlerContext;</span><br><span class="line"><span class="keyword">import</span> io.netty.channel.SimpleChannelInboundHandler;</span><br><span class="line"><span class="keyword">import</span> io.netty.util.CharsetUtil;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.UUID;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyServerHandler</span> <span class="keyword">extends</span> <span class="title class_">SimpleChannelInboundHandler</span>&lt;ByteBuf&gt; &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> <span class="variable">packageCount</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">channelRead0</span><span class="params">(ChannelHandlerContext ctx, ByteBuf byteBuf)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">byte</span>[] bytes = <span class="keyword">new</span> <span class="title class_">byte</span>[byteBuf.readableBytes()];</span><br><span class="line">        byteBuf.readBytes(bytes);</span><br><span class="line">        System.out.println(<span class="string">&quot;Server: &quot;</span> + <span class="keyword">new</span> <span class="title class_">String</span>(bytes, CharsetUtil.UTF_8));</span><br><span class="line">        System.out.println(<span class="string">&quot;Server packageCount: &quot;</span> + (++<span class="built_in">this</span>.packageCount));</span><br><span class="line">        <span class="type">String</span> <span class="variable">text</span> <span class="operator">=</span> UUID.randomUUID().toString().replaceAll(<span class="string">&quot;-&quot;</span>, <span class="string">&quot;&quot;</span>).substring(<span class="number">0</span>, <span class="number">8</span>);</span><br><span class="line">        <span class="type">ByteBuf</span> <span class="variable">response</span> <span class="operator">=</span> Unpooled.copiedBuffer(text, CharsetUtil.UTF_8);</span><br><span class="line">        ctx.writeAndFlush(response);</span><br><span class="line">        <span class="comment">//å¦‚æœå½“åšä¸€ä¸ªåŒ…æ¥æ”¶ï¼Œåˆ™åœ¨å¯åŠ¨ä¸€ä¸ªclient</span></span><br><span class="line">        <span class="comment">//Server: HelloServer: 0HelloServer: 1HelloServer: 2HelloServer: 3HelloServer: 4HelloServer: 5HelloServer: 6HelloServer: 7HelloServer: 8HelloServer: 9</span></span><br><span class="line">        <span class="comment">//Server packageCount: 1</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">exceptionCaught</span><span class="params">(ChannelHandlerContext ctx, Throwable cause)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Server: &quot;</span> + cause.getMessage());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Client</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.mineting.netty.tcp;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> io.netty.bootstrap.Bootstrap;</span><br><span class="line"><span class="keyword">import</span> io.netty.channel.ChannelFuture;</span><br><span class="line"><span class="keyword">import</span> io.netty.channel.ChannelInitializer;</span><br><span class="line"><span class="keyword">import</span> io.netty.channel.nio.NioEventLoopGroup;</span><br><span class="line"><span class="keyword">import</span> io.netty.channel.socket.SocketChannel;</span><br><span class="line"><span class="keyword">import</span> io.netty.channel.socket.nio.NioSocketChannel;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyClient</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">NioEventLoopGroup</span> <span class="variable">group</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">NioEventLoopGroup</span>();</span><br><span class="line">        <span class="type">Bootstrap</span> <span class="variable">bootstrap</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Bootstrap</span>();</span><br><span class="line">        bootstrap.group(group)</span><br><span class="line">                .channel(NioSocketChannel.class)</span><br><span class="line">                .handler(<span class="keyword">new</span> <span class="title class_">ChannelInitializer</span>&lt;SocketChannel&gt;() &#123;</span><br><span class="line">                    <span class="meta">@Override</span></span><br><span class="line">                    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">initChannel</span><span class="params">(SocketChannel socketChannel)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">                        socketChannel.pipeline().addLast(<span class="keyword">new</span> <span class="title class_">MyClientHandler</span>());</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;);</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">ChannelFuture</span> <span class="variable">channelFuture</span> <span class="operator">=</span> bootstrap.connect(<span class="string">&quot;127.0.0.1&quot;</span>, <span class="number">8000</span>).sync();</span><br><span class="line">            System.out.println(<span class="string">&quot;Client Start...&quot;</span>);</span><br><span class="line">            channelFuture.channel().closeFuture().sync();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            group.shutdownGracefully();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ClientHandler</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.mineting.netty.tcp;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> io.netty.buffer.ByteBuf;</span><br><span class="line"><span class="keyword">import</span> io.netty.buffer.Unpooled;</span><br><span class="line"><span class="keyword">import</span> io.netty.channel.ChannelHandlerContext;</span><br><span class="line"><span class="keyword">import</span> io.netty.channel.SimpleChannelInboundHandler;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.nio.charset.Charset;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyClientHandler</span> <span class="keyword">extends</span> <span class="title class_">SimpleChannelInboundHandler</span>&lt;ByteBuf&gt; &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> <span class="variable">packageCount</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">channelActive</span><span class="params">(ChannelHandlerContext ctx)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span><br><span class="line">            <span class="type">ByteBuf</span> <span class="variable">buf</span> <span class="operator">=</span> Unpooled.copiedBuffer(<span class="string">&quot;HelloServer: &quot;</span> + i, Charset.forName(<span class="string">&quot;utf-8&quot;</span>));</span><br><span class="line">            ctx.channel().writeAndFlush(buf);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">channelRead0</span><span class="params">(ChannelHandlerContext ctx, ByteBuf byteBuf)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">byte</span>[] bytes = <span class="keyword">new</span> <span class="title class_">byte</span>[byteBuf.readableBytes()];</span><br><span class="line">        byteBuf.readBytes(bytes);</span><br><span class="line">        System.out.println(<span class="string">&quot;Client: &quot;</span> + <span class="keyword">new</span> <span class="title class_">String</span>(bytes, Charset.forName(<span class="string">&quot;utf-8&quot;</span>)));</span><br><span class="line">        System.out.println(<span class="string">&quot;Client packageCount: &quot;</span> + (++packageCount));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">exceptionCaught</span><span class="params">(ChannelHandlerContext ctx, Throwable cause)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        cause.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="è§£å†³æ–¹æ¡ˆ"><a href="#è§£å†³æ–¹æ¡ˆ" class="headerlink" title="è§£å†³æ–¹æ¡ˆ"></a>è§£å†³æ–¹æ¡ˆ</h3><p>â€‹		å…³é”®åœ¨äºè§£å†³æœåŠ¡å™¨ç«¯æ¯æ¬¡è¯»å–æ•°æ®é•¿åº¦çš„é—®é¢˜, å°±ä¸ä¼šå‡ºç°æœåŠ¡å™¨å¤šè¯»æˆ–å°‘è¯»æ•°æ®çš„é—®é¢˜ï¼Œä»è€Œé¿å…çš„TCP ç²˜åŒ…ã€æ‹†åŒ…</p>
<p>åè®®æ•°æ®ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.mineting.netty.tcp.protocol;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * åè®®æ•°æ®</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MessageProtocol</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> length;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">byte</span>[] content;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getLength</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> length;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setLength</span><span class="params">(<span class="type">int</span> length)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.length = length;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">byte</span>[] getContent() &#123;</span><br><span class="line">        <span class="keyword">return</span> content;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setContent</span><span class="params">(<span class="type">byte</span>[] content)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.content = content;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p> Server</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.mineting.netty.tcp.protocol;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> io.netty.bootstrap.ServerBootstrap;</span><br><span class="line"><span class="keyword">import</span> io.netty.channel.ChannelFuture;</span><br><span class="line"><span class="keyword">import</span> io.netty.channel.ChannelInitializer;</span><br><span class="line"><span class="keyword">import</span> io.netty.channel.ChannelOption;</span><br><span class="line"><span class="keyword">import</span> io.netty.channel.nio.NioEventLoopGroup;</span><br><span class="line"><span class="keyword">import</span> io.netty.channel.socket.SocketChannel;</span><br><span class="line"><span class="keyword">import</span> io.netty.channel.socket.nio.NioServerSocketChannel;</span><br><span class="line"><span class="keyword">import</span> io.netty.handler.logging.LogLevel;</span><br><span class="line"><span class="keyword">import</span> io.netty.handler.logging.LoggingHandler;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Tcp: ç²˜åŒ…</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyServer</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">NioEventLoopGroup</span> <span class="variable">listenGroup</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">NioEventLoopGroup</span>(<span class="number">1</span>);</span><br><span class="line">        <span class="type">NioEventLoopGroup</span> <span class="variable">handlerGroup</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">NioEventLoopGroup</span>();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">ServerBootstrap</span> <span class="variable">serverBootstrap</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ServerBootstrap</span>();</span><br><span class="line">            serverBootstrap.group(listenGroup, handlerGroup)</span><br><span class="line">                    .channel(NioServerSocketChannel.class)</span><br><span class="line">                    .option(ChannelOption.SO_BACKLOG, <span class="number">128</span>)</span><br><span class="line">                    .childOption(ChannelOption.SO_KEEPALIVE, <span class="literal">true</span>)</span><br><span class="line">                    .handler(<span class="keyword">new</span> <span class="title class_">LoggingHandler</span>(LogLevel.INFO))</span><br><span class="line">                    .childHandler(<span class="keyword">new</span> <span class="title class_">ChannelInitializer</span>&lt;SocketChannel&gt;() &#123;</span><br><span class="line">                        <span class="meta">@Override</span></span><br><span class="line">                        <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">initChannel</span><span class="params">(SocketChannel socketChannel)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">                            <span class="comment">// æ³¨æ„ç¼–ç å™¨å’Œè§£ç å™¨åœ¨ handler ä¹‹å‰</span></span><br><span class="line">                            socketChannel.pipeline()</span><br><span class="line">                                    .addLast(<span class="keyword">new</span> <span class="title class_">MyMessageDecoder</span>())</span><br><span class="line">                                    .addLast(<span class="keyword">new</span> <span class="title class_">MyMessageEncoder</span>())</span><br><span class="line">                                    .addLast(<span class="keyword">new</span> <span class="title class_">MyServerHandler</span>());</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;);</span><br><span class="line">            <span class="type">ChannelFuture</span> <span class="variable">channelFuture</span> <span class="operator">=</span> serverBootstrap.bind(<span class="number">8000</span>).sync();</span><br><span class="line">            System.out.println(<span class="string">&quot;Server Start...&quot;</span>);</span><br><span class="line">            channelFuture.channel().closeFuture().sync();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            listenGroup.shutdownGracefully();</span><br><span class="line">            handlerGroup.shutdownGracefully();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç¼–ç å™¨ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.mineting.netty.tcp.protocol;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> io.netty.buffer.ByteBuf;</span><br><span class="line"><span class="keyword">import</span> io.netty.channel.ChannelHandlerContext;</span><br><span class="line"><span class="keyword">import</span> io.netty.handler.codec.MessageToByteEncoder;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyMessageEncoder</span> <span class="keyword">extends</span> <span class="title class_">MessageToByteEncoder</span>&lt;MessageProtocol&gt; &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">encode</span><span class="params">(ChannelHandlerContext ctx, MessageProtocol messageProtocol, ByteBuf byteBuf)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;MyMessageEncoder encode...&quot;</span>);</span><br><span class="line">        byteBuf.writeInt(messageProtocol.getLength());</span><br><span class="line">        byteBuf.writeBytes(messageProtocol.getContent());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è§£ç å™¨ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.mineting.netty.tcp.protocol;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> io.netty.buffer.ByteBuf;</span><br><span class="line"><span class="keyword">import</span> io.netty.channel.ChannelHandlerContext;</span><br><span class="line"><span class="keyword">import</span> io.netty.handler.codec.ReplayingDecoder;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyMessageDecoder</span> <span class="keyword">extends</span> <span class="title class_">ReplayingDecoder</span>&lt;MessageProtocol&gt; &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">decode</span><span class="params">(ChannelHandlerContext channelHandlerContext, ByteBuf byteBuf, List&lt;Object&gt; list)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;MyMessageDecoder decode...&quot;</span>);</span><br><span class="line">        <span class="type">int</span> <span class="variable">length</span> <span class="operator">=</span> byteBuf.readInt();</span><br><span class="line">        <span class="type">byte</span>[] bytes = <span class="keyword">new</span> <span class="title class_">byte</span>[length];</span><br><span class="line">        byteBuf.readBytes(bytes);</span><br><span class="line">        <span class="type">MessageProtocol</span> <span class="variable">protocol</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MessageProtocol</span>();</span><br><span class="line">        protocol.setLength(length);</span><br><span class="line">        protocol.setContent(bytes);</span><br><span class="line">        list.add(protocol);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Client</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.mineting.netty.tcp.protocol;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> io.netty.bootstrap.Bootstrap;</span><br><span class="line"><span class="keyword">import</span> io.netty.channel.ChannelFuture;</span><br><span class="line"><span class="keyword">import</span> io.netty.channel.ChannelInitializer;</span><br><span class="line"><span class="keyword">import</span> io.netty.channel.nio.NioEventLoopGroup;</span><br><span class="line"><span class="keyword">import</span> io.netty.channel.socket.SocketChannel;</span><br><span class="line"><span class="keyword">import</span> io.netty.channel.socket.nio.NioSocketChannel;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyClient</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">NioEventLoopGroup</span> <span class="variable">group</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">NioEventLoopGroup</span>();</span><br><span class="line">        <span class="type">Bootstrap</span> <span class="variable">bootstrap</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Bootstrap</span>();</span><br><span class="line">        bootstrap.group(group)</span><br><span class="line">                .channel(NioSocketChannel.class)</span><br><span class="line">                .handler(<span class="keyword">new</span> <span class="title class_">ChannelInitializer</span>&lt;SocketChannel&gt;() &#123;</span><br><span class="line">                    <span class="meta">@Override</span></span><br><span class="line">                    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">initChannel</span><span class="params">(SocketChannel socketChannel)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">                        <span class="comment">// æ³¨æ„ç¼–ç å™¨å’Œè§£ç å™¨åœ¨ handler ä¹‹å‰</span></span><br><span class="line">                        socketChannel.pipeline()</span><br><span class="line">                                .addLast(<span class="keyword">new</span> <span class="title class_">MyMessageEncoder</span>())</span><br><span class="line">                                .addLast(<span class="keyword">new</span> <span class="title class_">MyMessageDecoder</span>())</span><br><span class="line">                                .addLast(<span class="keyword">new</span> <span class="title class_">MyClientHandler</span>());</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;);</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">ChannelFuture</span> <span class="variable">channelFuture</span> <span class="operator">=</span> bootstrap.connect(<span class="string">&quot;127.0.0.1&quot;</span>, <span class="number">8000</span>).sync();</span><br><span class="line">            System.out.println(<span class="string">&quot;Client Start...&quot;</span>);</span><br><span class="line">            channelFuture.channel().closeFuture().sync();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            group.shutdownGracefully();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>ClientHandler</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.mineting.netty.tcp.protocol;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> io.netty.buffer.ByteBuf;</span><br><span class="line"><span class="keyword">import</span> io.netty.buffer.Unpooled;</span><br><span class="line"><span class="keyword">import</span> io.netty.channel.ChannelHandlerContext;</span><br><span class="line"><span class="keyword">import</span> io.netty.channel.SimpleChannelInboundHandler;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.nio.charset.Charset;</span><br><span class="line"><span class="keyword">import</span> java.nio.charset.StandardCharsets;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyClientHandler</span> <span class="keyword">extends</span> <span class="title class_">SimpleChannelInboundHandler</span>&lt;MessageProtocol&gt; &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> <span class="variable">packageCount</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">channelActive</span><span class="params">(ChannelHandlerContext ctx)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">content</span> <span class="operator">=</span> <span class="string">&quot;abandon&quot;</span>;</span><br><span class="line">            <span class="type">MessageProtocol</span> <span class="variable">protocol</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MessageProtocol</span>();</span><br><span class="line">            protocol.setLength(content.getBytes(StandardCharsets.UTF_8).length);</span><br><span class="line">            protocol.setContent(content.getBytes(StandardCharsets.UTF_8));</span><br><span class="line">            ctx.writeAndFlush(protocol);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">channelRead0</span><span class="params">(ChannelHandlerContext ctx, MessageProtocol protocol)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Client: Length: &quot;</span> + protocol.getLength() + <span class="string">&quot;, Content: &quot;</span> + <span class="keyword">new</span> <span class="title class_">String</span>(protocol.getContent(), StandardCharsets.UTF_8));</span><br><span class="line">        System.out.println(<span class="string">&quot;Client packageCount: &quot;</span> + (++packageCount));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">exceptionCaught</span><span class="params">(ChannelHandlerContext ctx, Throwable cause)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        cause.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h1 id="Netty-å®ç°-RPC-è°ƒç”¨"><a href="#Netty-å®ç°-RPC-è°ƒç”¨" class="headerlink" title="Netty å®ç° RPC è°ƒç”¨"></a>Netty å®ç° RPC è°ƒç”¨</h1><h2 id="RPCåŸºæœ¬ä»‹ç»"><a href="#RPCåŸºæœ¬ä»‹ç»" class="headerlink" title="RPCåŸºæœ¬ä»‹ç»"></a>RPCåŸºæœ¬ä»‹ç»</h2><ol>
<li><p>RPCï¼ˆRemote Procedure Callï¼‰â€” è¿œç¨‹è¿‡ç¨‹è°ƒç”¨ï¼Œæ˜¯ä¸€ä¸ªè®¡ç®—æœºé€šä¿¡åè®®ã€‚è¯¥åè®®å…è®¸è¿è¡Œäºä¸€å°è®¡ç®—æœºçš„ç¨‹åºè°ƒç”¨å¦ä¸€å°è®¡ç®—æœº		çš„å­ç¨‹åºï¼Œè€Œç¨‹åºå‘˜æ— éœ€é¢å¤–åœ°ä¸ºè¿™ä¸ªäº¤äº’ä½œç”¨ç¼–ç¨‹ã€‚</p>
</li>
<li><p>ä¸¤ä¸ªæˆ–å¤šä¸ªåº”ç”¨ç¨‹åºéƒ½åˆ†å¸ƒåœ¨ä¸åŒçš„æœåŠ¡å™¨ä¸Šï¼Œå®ƒä»¬ä¹‹é—´çš„è°ƒç”¨éƒ½åƒæ˜¯æœ¬åœ°æ–¹æ³•è°ƒç”¨ä¸€æ ·(å¦‚å›¾)ã€‚</p>
</li>
<li><p>å¸¸è§çš„ RPC æ¡†æ¶æœ‰: æ¯”è¾ƒçŸ¥åçš„å¦‚é˜¿é‡Œçš„Dubboã€googleçš„gRPCã€Goè¯­è¨€çš„rpcxã€Apacheçš„thriftï¼Œ Spring æ——ä¸‹çš„ SpringCloudã€‚</p>
</li>
</ol>
<h2 id="RPCè°ƒç”¨æµç¨‹"><a href="#RPCè°ƒç”¨æµç¨‹" class="headerlink" title="RPCè°ƒç”¨æµç¨‹"></a>RPCè°ƒç”¨æµç¨‹</h2><img src="/2023/02/28/Netty/Java\Document\Netty\Netty å‚çœ‹æ–‡æ¡£.assets\image-20220921115701760.png" alt="image-20220921115701760" style="zoom:150%;">

<p>è¯´æ˜ï¼š</p>
<ol>
<li><p>æœåŠ¡æ¶ˆè´¹æ–¹ä»¥æœ¬åœ°è°ƒç”¨æ–¹å¼è°ƒç”¨æœåŠ¡</p>
</li>
<li><p>client stub æ¥æ”¶åˆ°è°ƒç”¨åè´Ÿè´£å°†æ–¹æ³•ã€å‚æ•°ç­‰å°è£…æˆèƒ½å¤Ÿè¿›è¡Œç½‘ç»œä¼ è¾“çš„æ¶ˆæ¯ä½“</p>
</li>
<li><p>client stub å°†æ¶ˆæ¯è¿›è¡Œç¼–ç å¹¶å‘é€åˆ°æœåŠ¡ç«¯</p>
</li>
<li><p>server stub æ”¶åˆ°æ¶ˆæ¯åè¿›è¡Œè§£ç </p>
</li>
<li><p>server stub æ ¹æ®è§£ç ç»“æœè°ƒç”¨æœ¬åœ°çš„æœåŠ¡</p>
</li>
<li><p>æœ¬åœ°æœåŠ¡æ‰§è¡Œå¹¶å°†ç»“æœè¿”å›ç»™ server stub</p>
</li>
<li><p>server stub å°†è¿”å›å¯¼å…¥ç»“æœè¿›è¡Œç¼–ç å¹¶å‘é€è‡³æ¶ˆè´¹æ–¹</p>
</li>
<li><p>client stub æ¥æ”¶åˆ°æ¶ˆæ¯å¹¶è¿›è¡Œè§£ç </p>
</li>
<li><p>æœåŠ¡æ¶ˆè´¹æ–¹å¾—åˆ°ç»“æœ</p>
</li>
</ol>
<h2 id="ä»£ç å®ç°"><a href="#ä»£ç å®ç°" class="headerlink" title="ä»£ç å®ç°"></a>ä»£ç å®ç°</h2><p>ç¨‹åºåŠŸèƒ½ï¼šæ¶ˆè´¹è€…å’Œæä¾›è€…çº¦å®šæ¥å£å’Œåè®®ï¼Œæ¶ˆè´¹è€…è¿œç¨‹è°ƒç”¨æä¾›è€…çš„æœåŠ¡ï¼Œæä¾›è€…è¿”å›ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œæ¶ˆè´¹è€…æ‰“å°æä¾›è€…è¿”å›çš„æ•°æ®ã€‚</p>
<p>å…¬å…±æ¥å£ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.mineting.netty.dubborpc.publicinterface;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">HelloService</span> &#123;</span><br><span class="line">    String <span class="title function_">hello</span><span class="params">(String info)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æœåŠ¡æä¾›æ–¹ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.mineting.netty.dubborpc.provider;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.example.mineting.netty.dubborpc.publicinterface.HelloService;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HelloServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">HelloService</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">int</span> invokeCount;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">hello</span><span class="params">(String info)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Server Provider: &quot;</span> + info);</span><br><span class="line">        <span class="keyword">if</span> (info != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;Hello Client, Message: &quot;</span> + info + <span class="string">&quot;, InvokeCount: &quot;</span> + invokeCount;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;Hello Client, Message: &quot;</span> + <span class="string">&quot;&quot;</span> + <span class="string">&quot;, InvokeCount: &quot;</span> + invokeCount;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.mineting.netty.dubborpc.provider;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.example.mineting.netty.dubborpc.netty.NettyRpcServer;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RpcServerBootStrap</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        NettyRpcServer.startServer(<span class="string">&quot;127.0.0.1&quot;</span>,<span class="number">8000</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.mineting.netty.dubborpc.netty;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> io.netty.bootstrap.ServerBootstrap;</span><br><span class="line"><span class="keyword">import</span> io.netty.channel.ChannelFuture;</span><br><span class="line"><span class="keyword">import</span> io.netty.channel.ChannelInitializer;</span><br><span class="line"><span class="keyword">import</span> io.netty.channel.nio.NioEventLoopGroup;</span><br><span class="line"><span class="keyword">import</span> io.netty.channel.socket.SocketChannel;</span><br><span class="line"><span class="keyword">import</span> io.netty.channel.socket.nio.NioServerSocketChannel;</span><br><span class="line"><span class="keyword">import</span> io.netty.handler.codec.string.StringDecoder;</span><br><span class="line"><span class="keyword">import</span> io.netty.handler.codec.string.StringEncoder;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">NettyRpcServer</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">startServer</span><span class="params">(String host, <span class="type">int</span> port)</span> &#123;</span><br><span class="line">        startServer0(host, port);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">startServer0</span><span class="params">(String host, <span class="type">int</span> port)</span> &#123;</span><br><span class="line">        <span class="type">NioEventLoopGroup</span> <span class="variable">listenGroup</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">NioEventLoopGroup</span>(<span class="number">1</span>);</span><br><span class="line">        <span class="type">NioEventLoopGroup</span> <span class="variable">handlerGroup</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">NioEventLoopGroup</span>();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">ServerBootstrap</span> <span class="variable">serverBootstrap</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ServerBootstrap</span>();</span><br><span class="line">            serverBootstrap.group(listenGroup, handlerGroup)</span><br><span class="line">                    .channel(NioServerSocketChannel.class)</span><br><span class="line">                    .childHandler(<span class="keyword">new</span> <span class="title class_">ChannelInitializer</span>&lt;SocketChannel&gt;() &#123;</span><br><span class="line">                        <span class="meta">@Override</span></span><br><span class="line">                        <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">initChannel</span><span class="params">(SocketChannel socketChannel)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">                            socketChannel.pipeline()</span><br><span class="line">                                    .addLast(<span class="keyword">new</span> <span class="title class_">StringDecoder</span>())</span><br><span class="line">                                    .addLast(<span class="keyword">new</span> <span class="title class_">StringEncoder</span>())</span><br><span class="line">                                    .addLast(<span class="keyword">new</span> <span class="title class_">NettyRpcServerHandler</span>());</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;);</span><br><span class="line">            <span class="type">ChannelFuture</span> <span class="variable">channelFuture</span> <span class="operator">=</span> serverBootstrap.bind(host,port).sync();</span><br><span class="line">            System.out.println(<span class="string">&quot;RpcServer Start...&quot;</span>);</span><br><span class="line">            channelFuture.channel().closeFuture().sync();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            listenGroup.shutdownGracefully();</span><br><span class="line">            handlerGroup.shutdownGracefully();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.mineting.netty.dubborpc.netty;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.example.mineting.netty.dubborpc.customer.RpcClientBootstrap;</span><br><span class="line"><span class="keyword">import</span> com.example.mineting.netty.dubborpc.provider.HelloServiceImpl;</span><br><span class="line"><span class="keyword">import</span> io.netty.channel.ChannelHandlerContext;</span><br><span class="line"><span class="keyword">import</span> io.netty.channel.ChannelInboundHandlerAdapter;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">NettyRpcServerHandler</span> <span class="keyword">extends</span> <span class="title class_">ChannelInboundHandlerAdapter</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">channelRead</span><span class="params">(ChannelHandlerContext ctx, Object msg)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">text</span> <span class="operator">=</span> msg.toString();</span><br><span class="line">        System.out.println(<span class="string">&quot;æ¶ˆè´¹è€…å‘é€çš„æ¶ˆæ¯ msgï¼š&quot;</span> + text);</span><br><span class="line">        <span class="keyword">if</span> (msg.toString().startsWith(RpcClientBootstrap.PROTOCOL_NAME)) &#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">result</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HelloServiceImpl</span>().hello(msg.toString().substring(msg.toString().lastIndexOf(<span class="string">&quot;#&quot;</span>) + <span class="number">1</span>));</span><br><span class="line">            ctx.writeAndFlush(result);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">exceptionCaught</span><span class="params">(ChannelHandlerContext ctx, Throwable cause)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        ctx.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æœåŠ¡æ¶ˆè´¹æ–¹ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.mineting.netty.dubborpc.customer;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.example.mineting.netty.dubborpc.netty.NettyRpcClient;</span><br><span class="line"><span class="keyword">import</span> com.example.mineting.netty.dubborpc.publicinterface.HelloService;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.TimeUnit;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RpcClientBootstrap</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">PROTOCOL_NAME</span> <span class="operator">=</span> <span class="string">&quot;HelloService#hello#&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">        <span class="type">NettyRpcClient</span> <span class="variable">client</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">NettyRpcClient</span>();</span><br><span class="line">        <span class="type">HelloService</span> <span class="variable">helloService</span> <span class="operator">=</span> (HelloService) client.getBean(HelloService.class, PROTOCOL_NAME);</span><br><span class="line">        <span class="keyword">for</span> (; ; ) &#123;</span><br><span class="line">            TimeUnit.SECONDS.sleep(<span class="number">5</span>);</span><br><span class="line">            <span class="type">String</span> <span class="variable">ret</span> <span class="operator">=</span> helloService.hello(<span class="string">&quot;Hello DubboRpc&quot;</span>);</span><br><span class="line">            System.out.println(<span class="string">&quot;result: &quot;</span> + ret);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.mineting.netty.dubborpc.netty;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> io.netty.bootstrap.Bootstrap;</span><br><span class="line"><span class="keyword">import</span> io.netty.channel.ChannelInitializer;</span><br><span class="line"><span class="keyword">import</span> io.netty.channel.ChannelOption;</span><br><span class="line"><span class="keyword">import</span> io.netty.channel.ChannelPipeline;</span><br><span class="line"><span class="keyword">import</span> io.netty.channel.nio.NioEventLoopGroup;</span><br><span class="line"><span class="keyword">import</span> io.netty.channel.socket.SocketChannel;</span><br><span class="line"><span class="keyword">import</span> io.netty.channel.socket.nio.NioSocketChannel;</span><br><span class="line"><span class="keyword">import</span> io.netty.handler.codec.string.StringDecoder;</span><br><span class="line"><span class="keyword">import</span> io.netty.handler.codec.string.StringEncoder;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Proxy;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.ExecutorService;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.Executors;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">NettyRpcClient</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">ExecutorService</span> <span class="variable">executorService</span> <span class="operator">=</span> Executors.newFixedThreadPool(Runtime.getRuntime().availableProcessors());</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> NettyRpcClientHandler clientHandler;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">int</span> clientInvokeCount;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Object <span class="title function_">getBean</span><span class="params">(Class&lt;?&gt; serviceClass, String protocolName)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> Proxy.newProxyInstance(Thread.currentThread().getContextClassLoader(),</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;serviceClass&#125;, (proxy, method, args) -&gt; &#123;</span><br><span class="line">                    System.out.println(<span class="string">&quot;Client getBean clientInvokeCount: &quot;</span> + (++clientInvokeCount));</span><br><span class="line">                    <span class="keyword">if</span> (clientHandler == <span class="literal">null</span>) &#123;</span><br><span class="line">                        initRpcClientHandler();</span><br><span class="line">                    &#125;</span><br><span class="line">                    clientHandler.setParam(protocolName + args[<span class="number">0</span>]);</span><br><span class="line">                    <span class="comment">//invokeHandlerï¼šæ‰§è¡Œç»“æœçš„è¿”å›å€¼</span></span><br><span class="line">                    <span class="keyword">return</span> executorService.submit(clientHandler).get();</span><br><span class="line">                &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">initRpcClientHandler</span><span class="params">()</span> &#123;</span><br><span class="line">        clientHandler = <span class="keyword">new</span> <span class="title class_">NettyRpcClientHandler</span>();</span><br><span class="line">        <span class="type">NioEventLoopGroup</span> <span class="variable">group</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">NioEventLoopGroup</span>();</span><br><span class="line">        <span class="type">Bootstrap</span> <span class="variable">bootstrap</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Bootstrap</span>();</span><br><span class="line">        bootstrap.group(group)</span><br><span class="line">                .channel(NioSocketChannel.class)</span><br><span class="line">                .option(ChannelOption.TCP_NODELAY, <span class="literal">true</span>)</span><br><span class="line">                .handler(</span><br><span class="line">                        <span class="keyword">new</span> <span class="title class_">ChannelInitializer</span>&lt;SocketChannel&gt;() &#123;</span><br><span class="line">                            <span class="meta">@Override</span></span><br><span class="line">                            <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">initChannel</span><span class="params">(SocketChannel ch)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">                                <span class="type">ChannelPipeline</span> <span class="variable">pipeline</span> <span class="operator">=</span> ch.pipeline();</span><br><span class="line">                                pipeline.addLast(<span class="keyword">new</span> <span class="title class_">StringDecoder</span>());</span><br><span class="line">                                pipeline.addLast(<span class="keyword">new</span> <span class="title class_">StringEncoder</span>());</span><br><span class="line">                                pipeline.addLast(clientHandler);</span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;</span><br><span class="line">                );</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            bootstrap.connect(<span class="string">&quot;127.0.0.1&quot;</span>, <span class="number">8000</span>).sync();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.mineting.netty.dubborpc.netty;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> io.netty.channel.ChannelHandlerContext;</span><br><span class="line"><span class="keyword">import</span> io.netty.channel.ChannelInboundHandlerAdapter;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.Callable;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">NettyRpcClientHandler</span> <span class="keyword">extends</span> <span class="title class_">ChannelInboundHandlerAdapter</span> <span class="keyword">implements</span> <span class="title class_">Callable</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String param;</span><br><span class="line">    <span class="keyword">private</span> String result;</span><br><span class="line">    <span class="keyword">private</span> ChannelHandlerContext ctx;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setParam</span><span class="params">(String param)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.param = param;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">channelActive</span><span class="params">(ChannelHandlerContext ctx)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="built_in">this</span>.ctx = ctx;</span><br><span class="line">        System.out.println(<span class="string">&quot;NettyRpcClientHandler channelActive...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title function_">channelRead</span><span class="params">(ChannelHandlerContext ctx, Object msg)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;NettyRpcClientHandler channelRead...&quot;</span>);</span><br><span class="line">        result = msg.toString();</span><br><span class="line">        notify();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">synchronized</span> Object <span class="title function_">call</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;NettyRpcClientHandler call...&quot;</span>);</span><br><span class="line">        ctx.writeAndFlush(param);</span><br><span class="line">        wait();</span><br><span class="line">        System.out.println(<span class="string">&quot;NettyRpcClientHandler call wait...&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">exceptionCaught</span><span class="params">(ChannelHandlerContext ctx, Throwable cause)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        System.out.println(cause.getMessage());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

]]></content>
  </entry>
  <entry>
    <title>RocketMQ</title>
    <url>/2023/02/27/RocketMQ/</url>
    <content><![CDATA[]]></content>
  </entry>
  <entry>
    <title>Redis</title>
    <url>/2023/02/28/Redis/</url>
    <content><![CDATA[<h1 id><a href="#" class="headerlink" title></a></h1><h1 id="Redis"><a href="#Redis" class="headerlink" title="Redis"></a>Redis</h1><h1 id="NSQL-æ¦‚è¿°"><a href="#NSQL-æ¦‚è¿°" class="headerlink" title="NSQL æ¦‚è¿°"></a>NSQL æ¦‚è¿°</h1><h2 id="æŠ€æœ¯å‘å±•"><a href="#æŠ€æœ¯å‘å±•" class="headerlink" title="æŠ€æœ¯å‘å±•"></a>æŠ€æœ¯å‘å±•</h2><p>æŠ€æœ¯çš„åˆ†ç±»</p>
<ol>
<li><p>è§£å†³åŠŸèƒ½æ€§çš„é—®é¢˜ï¼šJavaã€Jspã€RDBMSã€Tomcatã€HTMLã€Linuxã€JDBCã€SVN</p>
</li>
<li><p>è§£å†³æ‰©å±•æ€§çš„é—®é¢˜ï¼šStrutsã€Springã€SpringMVCã€Hibernateã€Mybatis</p>
</li>
<li><p>è§£å†³æ€§èƒ½çš„é—®é¢˜ï¼šNoSQLã€Javaçº¿ç¨‹ã€Hadoopã€Nginxã€MQã€ElasticSearchs</p>
</li>
</ol>
<h3 id="Web1-0-æ—¶ä»£"><a href="#Web1-0-æ—¶ä»£" class="headerlink" title="Web1.0 æ—¶ä»£"></a>Web1.0 æ—¶ä»£</h3><p>â€‹		Web1.0çš„æ—¶ä»£ï¼Œæ•°æ®è®¿é—®é‡å¾ˆæœ‰é™ï¼Œç”¨ä¸€å¤«å½“å…³çš„é«˜æ€§èƒ½çš„å•ç‚¹æœåŠ¡å™¨å¯ä»¥è§£å†³å¤§éƒ¨åˆ†é—®é¢˜ã€‚</p>
<h3 id="Web2-0-æ—¶ä»£"><a href="#Web2-0-æ—¶ä»£" class="headerlink" title="Web2.0 æ—¶ä»£"></a><strong>Web2.0</strong> æ—¶ä»£</h3><p>â€‹		éšç€ Web2.0 çš„æ—¶ä»£çš„åˆ°æ¥ï¼Œç”¨æˆ·è®¿é—®é‡å¤§å¹…åº¦æå‡ï¼ŒåŒæ—¶äº§ç”Ÿäº†å¤§é‡çš„ç”¨æˆ·æ•°æ®ã€‚åŠ ä¸Šåæ¥çš„æ™ºèƒ½ç§»åŠ¨è®¾å¤‡çš„æ™®åŠï¼Œæ‰€æœ‰çš„äº’è”ç½‘å¹³å°éƒ½é¢ä¸´äº†å·¨å¤§çš„æ€§èƒ½æŒ‘æˆ˜ã€‚</p>
<h3 id="è§£å†³CPUåŠå†…å­˜å‹åŠ›"><a href="#è§£å†³CPUåŠå†…å­˜å‹åŠ›" class="headerlink" title="è§£å†³CPUåŠå†…å­˜å‹åŠ›"></a><strong>è§£å†³CPUåŠå†…å­˜å‹åŠ›</strong></h3><img src="/2023/02/28/Redis/Java\Document\Redis\Redis.assets\image-20221009000626519.png" alt="image-20221009000626519" style="zoom:80%;">

<h3 id="è§£å†³IOå‹åŠ›"><a href="#è§£å†³IOå‹åŠ›" class="headerlink" title="è§£å†³IOå‹åŠ›"></a><strong>è§£å†³IOå‹åŠ›</strong></h3><img src="/2023/02/28/Redis/Java\Document\Redis\Redis.assets\image-20221009000730414.png" alt="image-20221009000730414" style="zoom:80%;">

<h2 id="NoSQLæ•°æ®åº“"><a href="#NoSQLæ•°æ®åº“" class="headerlink" title="NoSQLæ•°æ®åº“"></a>NoSQLæ•°æ®åº“</h2><p>NoSQLï¼ˆNoSQL &#x3D; <strong>Not Only SQL</strong> ï¼‰ï¼Œæ„å³â€œä¸ä»…ä»…æ˜¯SQLâ€ï¼Œæ³›æŒ‡<strong>éå…³ç³»å‹çš„æ•°æ®åº“</strong>ã€‚ </p>
<p>NoSQL ä¸ä¾èµ–ä¸šåŠ¡é€»è¾‘æ–¹å¼å­˜å‚¨ï¼Œè€Œä»¥ç®€å•çš„key-valueæ¨¡å¼å­˜å‚¨ã€‚å› æ­¤å¤§å¤§çš„å¢åŠ äº†æ•°æ®åº“çš„æ‰©å±•èƒ½åŠ›ã€‚</p>
<ul>
<li>ä¸éµå¾ªSQLæ ‡å‡†ã€‚</li>
<li>ä¸æ”¯æŒACIDã€‚</li>
<li>è¿œè¶…äºSQLçš„æ€§èƒ½ã€‚</li>
</ul>
<h3 id="NoSQLé€‚ç”¨åœºæ™¯"><a href="#NoSQLé€‚ç”¨åœºæ™¯" class="headerlink" title="NoSQLé€‚ç”¨åœºæ™¯"></a>NoSQLé€‚ç”¨åœºæ™¯</h3><ul>
<li>å¯¹æ•°æ®é«˜å¹¶å‘çš„è¯»å†™</li>
<li>æµ·é‡æ•°æ®çš„è¯»å†™</li>
<li>å¯¹æ•°æ®é«˜å¯æ‰©å±•æ€§çš„</li>
</ul>
<h3 id="NoSQLä¸é€‚ç”¨åœºæ™¯"><a href="#NoSQLä¸é€‚ç”¨åœºæ™¯" class="headerlink" title="NoSQLä¸é€‚ç”¨åœºæ™¯"></a>NoSQLä¸é€‚ç”¨åœºæ™¯</h3><ul>
<li>éœ€è¦äº‹åŠ¡æ”¯æŒ</li>
<li>åŸºäºsqlçš„ç»“æ„åŒ–æŸ¥è¯¢å­˜å‚¨ï¼Œå¤„ç†å¤æ‚çš„å…³ç³»ï¼Œéœ€è¦å³å¸­æŸ¥è¯¢ï¼ˆç”¨ä¸ç€sqlçš„å’Œç”¨äº†sqlä¹Ÿä¸è¡Œçš„æƒ…å†µï¼Œè¯·è€ƒè™‘ç”¨NoSqlï¼‰</li>
</ul>
<h3 id="Memcache"><a href="#Memcache" class="headerlink" title="Memcache"></a>Memcache</h3><ol>
<li>æ•°æ®éƒ½åœ¨å†…å­˜ä¸­ï¼Œä¸€èˆ¬ä¸æŒä¹…åŒ–</li>
<li>æ”¯æŒç®€å•çš„ key-value æ¨¡å¼ï¼Œæ”¯æŒç±»å‹å•ä¸€</li>
<li>ä¸€èˆ¬æ˜¯ä½œä¸ºç¼“å­˜æ•°æ®åº“è¾…åŠ©æŒä¹…åŒ–çš„æ•°æ®åº“</li>
</ol>
<h3 id="Redis-1"><a href="#Redis-1" class="headerlink" title="Redis"></a>Redis</h3><ol>
<li>å‡ ä¹è¦†ç›–äº†Memcachedçš„ç»å¤§éƒ¨åˆ†åŠŸèƒ½</li>
<li>æ•°æ®éƒ½åœ¨å†…å­˜ä¸­ï¼Œæ”¯æŒæŒä¹…åŒ–ï¼Œä¸»è¦ç”¨ä½œå¤‡ä»½æ¢å¤</li>
<li>é™¤äº†æ”¯æŒç®€å•çš„key-valueæ¨¡å¼ï¼Œè¿˜æ”¯æŒå¤šç§æ•°æ®ç»“æ„çš„å­˜å‚¨ï¼Œæ¯”å¦‚ listã€setã€hashã€zsetç­‰ã€‚</li>
<li>ä¸€èˆ¬æ˜¯ä½œä¸ºç¼“å­˜æ•°æ®åº“è¾…åŠ©æŒä¹…åŒ–çš„æ•°æ®åº“</li>
</ol>
<h3 id="MongoDB"><a href="#MongoDB" class="headerlink" title="MongoDB"></a>MongoDB</h3><ol>
<li>é«˜æ€§èƒ½ã€å¼€æºã€æ¨¡å¼è‡ªç”±(schema free)çš„<strong>æ–‡æ¡£å‹æ•°æ®åº“</strong></li>
<li>æ•°æ®éƒ½åœ¨å†…å­˜ä¸­ï¼Œ å¦‚æœå†…å­˜ä¸è¶³ï¼ŒæŠŠä¸å¸¸ç”¨çš„æ•°æ®ä¿å­˜åˆ°ç¡¬ç›˜</li>
<li>è™½ç„¶æ˜¯key-valueæ¨¡å¼ï¼Œä½†æ˜¯å¯¹valueï¼ˆå°¤å…¶æ˜¯<strong>json</strong>ï¼‰æä¾›äº†ä¸°å¯Œçš„æŸ¥è¯¢åŠŸèƒ½</li>
<li>æ”¯æŒäºŒè¿›åˆ¶æ•°æ®åŠå¤§å‹å¯¹è±¡</li>
<li>å¯ä»¥æ ¹æ®æ•°æ®çš„ç‰¹ç‚¹<strong>æ›¿ä»£RDBMS</strong> ï¼Œæˆä¸ºç‹¬ç«‹çš„æ•°æ®åº“ã€‚æˆ–è€…é…åˆRDBMSï¼Œå­˜å‚¨ç‰¹å®šçš„æ•°æ®ã€‚</li>
</ol>
<h2 id="è¡Œå¼å­˜å‚¨æ•°æ®åº“ï¼ˆå¤§æ•°æ®æ—¶ä»£ï¼‰"><a href="#è¡Œå¼å­˜å‚¨æ•°æ®åº“ï¼ˆå¤§æ•°æ®æ—¶ä»£ï¼‰" class="headerlink" title="è¡Œå¼å­˜å‚¨æ•°æ®åº“ï¼ˆå¤§æ•°æ®æ—¶ä»£ï¼‰"></a><strong>è¡Œå¼å­˜å‚¨æ•°æ®åº“ï¼ˆå¤§æ•°æ®æ—¶ä»£ï¼‰</strong></h2><h3 id="è¡Œå¼æ•°æ®åº“"><a href="#è¡Œå¼æ•°æ®åº“" class="headerlink" title="è¡Œå¼æ•°æ®åº“"></a><strong>è¡Œå¼æ•°æ®åº“</strong></h3><img src="/2023/02/28/Redis/Java\Document\Redis\Redis.assets\image-20221009001250886.png" alt="image-20221009001250886" style="zoom:80%;">

<h3 id="åˆ—å¼æ•°æ®åº“"><a href="#åˆ—å¼æ•°æ®åº“" class="headerlink" title="åˆ—å¼æ•°æ®åº“"></a><strong>åˆ—å¼æ•°æ®åº“</strong></h3><img src="/2023/02/28/Redis/Java\Document\Redis\Redis.assets\image-20221009001329709.png" alt="image-20221009001329709" style="zoom:80%;">

<h3 id="Hbase"><a href="#Hbase" class="headerlink" title="Hbase"></a><strong>Hbase</strong></h3><p>HBase æ˜¯ <strong>Hadoop</strong> é¡¹ç›®ä¸­çš„æ•°æ®åº“ã€‚å®ƒç”¨äºéœ€è¦å¯¹å¤§é‡çš„æ•°æ®è¿›è¡Œéšæœºã€å®æ—¶çš„è¯»å†™æ“ä½œçš„åœºæ™¯ä¸­ã€‚</p>
<p>HBase çš„ç›®æ ‡å°±æ˜¯å¤„ç†æ•°æ®é‡<strong>éå¸¸åºå¤§</strong>çš„è¡¨ï¼Œå¯ä»¥ç”¨<strong>æ™®é€šçš„è®¡ç®—æœº</strong>å¤„ç†è¶…è¿‡<strong>10</strong>äº¿è¡Œæ•°æ®<strong>ï¼Œè¿˜å¯å¤„ç†æœ‰æ•°ç™¾ä¸‡</strong>åˆ—å…ƒç´ çš„æ•°æ®è¡¨ã€‚</p>
<h2 id="å›¾å…³ç³»å‹æ•°æ®åº“"><a href="#å›¾å…³ç³»å‹æ•°æ®åº“" class="headerlink" title="å›¾å…³ç³»å‹æ•°æ®åº“"></a><strong>å›¾å…³ç³»å‹æ•°æ®åº“</strong></h2><p>ä¸»è¦åº”ç”¨ï¼šç¤¾ä¼šå…³ç³»ï¼Œå…¬å…±äº¤é€šç½‘ç»œï¼Œåœ°å›¾åŠç½‘ç»œæ‹“è°±(n*(n-1)&#x2F;2)</p>
<h2 id="DB-Engines-æ•°æ®åº“æ’å"><a href="#DB-Engines-æ•°æ®åº“æ’å" class="headerlink" title="DB-Engines æ•°æ®åº“æ’å"></a><strong>DB-Engines</strong> <strong>æ•°æ®åº“æ’å</strong></h2><blockquote>
<p><a href="http://db-engines.com/en/ranking"><strong>http://db-engines.com/en/ranking</strong></a></p>
</blockquote>
<h1 id="Redisæ¦‚è¿°"><a href="#Redisæ¦‚è¿°" class="headerlink" title="Redisæ¦‚è¿°"></a>Redisæ¦‚è¿°</h1><p>å®˜ç½‘åœ°å€ï¼š<a href="http://redis.io/"><strong>http://redis.io</strong></a></p>
<p>ä¸­æ–‡åœ°å€ï¼š<a href="http://redis.cn/">http://redis.cn/</a></p>
<h2 id="åº”ç”¨åœºæ™¯"><a href="#åº”ç”¨åœºæ™¯" class="headerlink" title="åº”ç”¨åœºæ™¯"></a>åº”ç”¨åœºæ™¯</h2><ol>
<li><p><strong>é…åˆå…³ç³»å‹æ•°æ®åº“åšé«˜é€Ÿç¼“å­˜</strong></p>
<p> é«˜é¢‘æ¬¡ï¼Œçƒ­é—¨è®¿é—®çš„æ•°æ®ï¼Œé™ä½æ•°æ®åº“IO</p>
<p> åˆ†å¸ƒå¼æ¶æ„ï¼Œåšsessionå…±äº«</p>
</li>
<li><p><strong>å¤šæ ·çš„æ•°æ®ç»“æ„å­˜å‚¨æŒä¹…åŒ–æ•°æ®</strong></p>
<p> æœ€æ–°Nä¸ªæ•°æ®ï¼šé€šè¿‡Listå®ç°æŒ‰è‡ªç„¶æ—¶é—´æ’åºçš„æ•°æ®</p>
<p> æ’è¡Œæ¦œï¼ŒTopNï¼šåˆ©ç”¨ zset æœ‰åºé›†åˆ</p>
<p> æ—¶æ•ˆæ€§çš„æ•°æ®ï¼Œå¦‚ï¼šæ‰‹æœºéªŒè¯ç ï¼šExpire è¿‡æœŸ</p>
<p> è®¡æ•°å™¨ï¼Œç§’æ€ï¼šåŸå­æ€§ï¼Œè‡ªå¢æ–¹æ³•INCREã€DECRE</p>
<p> å–å‡ºå¤§é‡æ•°æ®ä¸­çš„é‡å¤æ•°æ®ï¼šåˆ©ç”¨ Set é›†åˆ</p>
<p> æ„å»ºé˜Ÿåˆ—ï¼šåˆ©ç”¨ List é›†åˆ</p>
<p> å‘å¸ƒè®¢é˜…ç³»ç»Ÿï¼špub&#x2F;subæ¨¡å¼</p>
</li>
</ol>
<h2 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h2><p><img src="/2023/02/28/Redis/Java\Document\Redis\Redis.assets\image-20220513090502331.png" alt="image-20220513090502331"></p>
<p>å®‰è£…ç‰ˆæœ¬ï¼šredis-6.2.1.tar.gz</p>
<h3 id="å®‰è£…æ­¥éª¤"><a href="#å®‰è£…æ­¥éª¤" class="headerlink" title="å®‰è£…æ­¥éª¤"></a>å®‰è£…æ­¥éª¤</h3><ol>
<li><p>å®‰è£… gccç¼–è¯‘å™¨</p>
 <figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@localhost /]# yum install -y centos-release-scl scl-utils-build</span><br><span class="line">[root@localhost /]# yum install -y devtoolset-8-toolchain</span><br><span class="line">[root@localhost /]# scl enable devtoolset-8 bash</span><br><span class="line">[root@localhost /]# gcc --version</span><br><span class="line">gcc (GCC) 8.3.1 20190311 (Red Hat 8.3.1-3)</span><br><span class="line">Copyright (C) 2018 Free Software Foundation, Inc.</span><br><span class="line">This is free software; see the source for copying conditions.  There is NO</span><br><span class="line">warranty; not even for MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.</span><br></pre></td></tr></table></figure>
</li>
<li><p>ä¸‹è½½ redis-6.2.1.tar.gz æ”¾åœ¨ &#x2F;opt ç›®å½•å¹¶è§£å‹</p>
</li>
<li><p>è¿›å…¥ <strong>redis-6.2.1</strong>ç›®å½•ä½¿ç”¨ make ç¼–è¯‘</p>
</li>
<li><p><strong>è·³è¿‡make test ç»§ç»­æ‰§è¡Œ: make install</strong></p>
 <figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@localhost redis]# cd /opt/redis</span><br><span class="line">[root@localhost redis]# tar -zxvf redis-6.2.1.tar.gz</span><br><span class="line">[root@localhost redis]# ls</span><br><span class="line">redis-6.2.1  redis-6.2.1.tar.gz</span><br><span class="line">[root@localhost redis]# cd redis-6.2.1</span><br><span class="line">[root@localhost redis-6.2.1]# make &amp;&amp; make install</span><br><span class="line"></span><br></pre></td></tr></table></figure>
</li>
<li><p>å¦‚æœæŠ¥é”™</p>
<p> <strong>å¦‚æœæ²¡æœ‰å‡†å¤‡å¥½Cè¯­è¨€ç¼–è¯‘ç¯å¢ƒï¼Œmake ä¼šæŠ¥é”™â€”Jemalloc&#x2F;jemalloc.hï¼šæ²¡æœ‰é‚£ä¸ªæ–‡ä»¶</strong></p>
<p> è§£å†³æ–¹æ¡ˆï¼š<strong>è¿è¡Œ make distclean</strong>ï¼Œ<strong>å†æ¬¡æ‰§è¡Œmakeå‘½ä»¤</strong></p>
</li>
</ol>
<h3 id="å®‰è£…ç›®å½•ï¼š-x2F-usr-x2F-local-x2F-bin"><a href="#å®‰è£…ç›®å½•ï¼š-x2F-usr-x2F-local-x2F-bin" class="headerlink" title="å®‰è£…ç›®å½•ï¼š&#x2F;usr&#x2F;local&#x2F;bin"></a>å®‰è£…ç›®å½•ï¼š&#x2F;usr&#x2F;local&#x2F;bin</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@localhost redis-6.2.1]# ll /usr/local/bin</span><br><span class="line">æ€»ç”¨é‡ 19136</span><br><span class="line">-rwxr-xr-x. 1 root root 4833352 5æœˆ  13 09:20 redis-benchmark</span><br><span class="line">lrwxrwxrwx. 1 root root      12 5æœˆ  13 09:20 redis-check-aof -&gt; redis-server</span><br><span class="line">lrwxrwxrwx. 1 root root      12 5æœˆ  13 09:20 redis-check-rdb -&gt; redis-server</span><br><span class="line">-rwxr-xr-x. 1 root root 5003368 5æœˆ  13 09:20 redis-cli</span><br><span class="line">lrwxrwxrwx. 1 root root      12 5æœˆ  13 09:20 redis-sentinel -&gt; redis-server</span><br><span class="line">-rwxr-xr-x. 1 root root 9450208 5æœˆ  13 09:20 redis-server</span><br></pre></td></tr></table></figure>

<p>æŸ¥çœ‹é»˜è®¤å®‰è£…ç›®å½•ï¼š</p>
<ol>
<li>redis-benchmarkï¼šæ€§èƒ½æµ‹è¯•å·¥å…·</li>
<li>redis-check-aofï¼šä¿®å¤æœ‰é—®é¢˜çš„AOFæ–‡ä»¶</li>
<li>redis-check-dumpï¼šä¿®å¤æœ‰é—®é¢˜çš„dump.rdbæ–‡ä»¶</li>
<li>redis-sentinelï¼šRedisé›†ç¾¤ä½¿ç”¨</li>
<li>redis-serverï¼šRedisæœåŠ¡å™¨å¯åŠ¨å‘½ä»¤</li>
<li>redis-cliï¼šå®¢æˆ·ç«¯å·¥å…·</li>
</ol>
<p><strong>å¯¹äº &#x2F;usr&#x2F;local&#x2F;bin ç›®å½•è¯´æ˜</strong></p>
<p>è¯¥ç›®å½•ä¸‹çš„å¯æ‰§è¡Œå‘½ä»¤å·²ç»ä½œä¸ºç¯å¢ƒå˜é‡è€Œå­˜åœ¨ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨ã€‚</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@localhost nginx]# echo $PATH</span><br><span class="line">/usr/local/nginx/sbin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/root/bin</span><br></pre></td></tr></table></figure>



<h3 id="å‰å°å¯åŠ¨"><a href="#å‰å°å¯åŠ¨" class="headerlink" title="å‰å°å¯åŠ¨"></a>å‰å°å¯åŠ¨</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@localhost redis-6.2.1]# cd /usr/local/bin</span><br><span class="line">[root@localhost bin]# ./redis-server</span><br><span class="line">97713:C 13 May 2022 09:22:05.617 # oO0OoO0OoO0Oo Redis is starting oO0OoO0OoO0Oo</span><br><span class="line">97713:C 13 May 2022 09:22:05.617 # Redis version=6.2.1, bits=64, commit=00000000, modified=0, pid=97713, just started</span><br><span class="line">97713:C 13 May 2022 09:22:05.617 # Warning: no config file specified, using the default config. In order to specify a config file use ./redis-server /path/to/redis.conf</span><br><span class="line">97713:M 13 May 2022 09:22:05.618 * Increased maximum number of open files to 10032 (it was originally set to 1024).</span><br><span class="line">97713:M 13 May 2022 09:22:05.618 * monotonic clock: POSIX clock_gettime</span><br><span class="line">                _._</span><br><span class="line">           _.-``__ &#x27;&#x27;-._</span><br><span class="line">      _.-``    `.  `_.  &#x27;&#x27;-._           Redis 6.2.1 (00000000/0) 64 bit</span><br><span class="line">  .-`` .-```.  ```\/    _.,_ &#x27;&#x27;-._</span><br><span class="line"> (    &#x27;      ,       .-`  | `,    )     Running in standalone mode</span><br><span class="line"> |`-._`-...-` __...-.``-._|&#x27;` _.-&#x27;|     Port: 6379</span><br><span class="line"> |    `-._   `._    /     _.-&#x27;    |     PID: 97713</span><br><span class="line">  `-._    `-._  `-./  _.-&#x27;    _.-&#x27;</span><br><span class="line"> |`-._`-._    `-.__.-&#x27;    _.-&#x27;_.-&#x27;|</span><br><span class="line"> |    `-._`-._        _.-&#x27;_.-&#x27;    |           http://redis.io</span><br><span class="line">  `-._    `-._`-.__.-&#x27;_.-&#x27;    _.-&#x27;</span><br><span class="line"> |`-._`-._    `-.__.-&#x27;    _.-&#x27;_.-&#x27;|</span><br><span class="line"> |    `-._`-._        _.-&#x27;_.-&#x27;    |</span><br><span class="line">  `-._    `-._`-.__.-&#x27;_.-&#x27;    _.-&#x27;</span><br><span class="line">      `-._    `-.__.-&#x27;    _.-&#x27;</span><br><span class="line">          `-._        _.-&#x27;</span><br><span class="line">              `-.__.-&#x27;</span><br><span class="line"></span><br><span class="line">97713:M 13 May 2022 09:22:05.621 # WARNING: The TCP backlog setting of 511 cannot be enforced because /proc/sys/net/core/somaxconn is set to the lower value of 128.</span><br><span class="line">97713:M 13 May 2022 09:22:05.621 # Server initialized</span><br><span class="line">97713:M 13 May 2022 09:22:05.621 # WARNING overcommit_memory is set to 0! Background save may fail under low memory condition. To fix this issue add &#x27;vm.overcommit_memory = 1&#x27; to /etc/sysctl.conf and then reboot or run the command &#x27;sysctl vm.overcommit_memory=1&#x27; for this to take effect.</span><br><span class="line">97713:M 13 May 2022 09:22:05.621 * Ready to accept connections</span><br><span class="line">^C97713:signal-handler (1652404933) Received SIGINT scheduling shutdown...</span><br><span class="line">97713:M 13 May 2022 09:22:13.266 # User requested shutdown...</span><br><span class="line">97713:M 13 May 2022 09:22:13.266 * Saving the final RDB snapshot before exiting.</span><br><span class="line">97713:M 13 May 2022 09:22:13.271 * DB saved on disk</span><br><span class="line">97713:M 13 May 2022 09:22:13.271 # Redis is now ready to exit, bye bye...</span><br></pre></td></tr></table></figure>

<h3 id="åå°å¯åŠ¨"><a href="#åå°å¯åŠ¨" class="headerlink" title="åå°å¯åŠ¨"></a>åå°å¯åŠ¨</h3><p>å¤‡ä»½ redis.confï¼Œæˆ–è€…æ‹·è´åˆ° &#x2F;etc ç­‰å…¶ä»–ç›®å½•ä¸­ã€‚</p>
<p><strong>åå°å¯åŠ¨è®¾ç½®daemonize noæ”¹æˆyes</strong></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@localhost bin]# cp /opt/redis-6.2.1/redis.conf /etc</span><br><span class="line">[root@localhost bin]# vim /etc/redis.conf</span><br><span class="line">[root@localhost bin]# redis-server /etc/redis.conf</span><br><span class="line">[root@localhost bin]# ps -ef |grep redis</span><br><span class="line">root      97843      1  0 09:30 ?        00:00:00 redis-server 127.0.0.1:6379</span><br><span class="line">root      97849  93182  0 09:30 pts/1    00:00:00 grep --color=auto redis</span><br><span class="line">[root@localhost ~]# ps -aux|grep redis|grep -v grep</span><br><span class="line">root      18370  0.4  0.2 162540  2644 ?        Ssl  12:26   0:00 redis-server 127.0.0.1:6379</span><br></pre></td></tr></table></figure>

<p>å¤šä¸ªç«¯å£å¯åŠ¨å¯ä»¥ï¼šredis-cli -p6379</p>
<h3 id="å®¢æˆ·ç«¯è¿œç¨‹è¿æ¥"><a href="#å®¢æˆ·ç«¯è¿œç¨‹è¿æ¥" class="headerlink" title="å®¢æˆ·ç«¯è¿œç¨‹è¿æ¥"></a>å®¢æˆ·ç«¯è¿œç¨‹è¿æ¥</h3><p>ç¦ç”¨ Linux çš„é˜²ç«å¢™ï¼šLinux(CentOS7) é‡Œæ‰§è¡Œå‘½ä»¤</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">systemctl stop/disable firewalld.service</span><br></pre></td></tr></table></figure>

<p>æˆ–è€…å¼€æ”¾ç«¯å£ 6379</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æŸ¥çœ‹å¼€æ”¾çš„ç«¯å£å·</span></span><br><span class="line">firewall-cmd --list-all</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">è®¾ç½®å¼€æ”¾çš„ç«¯å£å·</span></span><br><span class="line">firewall-cmd --add-service=redis --permanent</span><br><span class="line">firewall-cmd --add-port=6379/tcp --permanent</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">é‡å¯é˜²ç«å¢™</span></span><br><span class="line">firewall-cmd --reload</span><br></pre></td></tr></table></figure>

<p>redis.conf ä¸­æ³¨é‡Šæ‰ bind 127.0.0.1ï¼Œå¹¶ä¸”è®¾ç½®ï¼š protected-mode no</p>
<p>ã€<strong>æ”¹é…ç½®å‰å¿…é¡»å…³æ‰ redisï¼Œå¦åˆ™ä¸ç”Ÿæ•ˆ</strong>ã€‘</p>
<figure class="highlight tex"><table><tr><td class="code"><pre><span class="line">-DENIED Redis is running in protected mode because protected mode is enabled, no bind address was specified, no authentication password is requested to clients. In this mode connections are only accepted from the loopback interface. If you want to connect from external computers to Redis you may adopt one of the following solutions: </span><br><span class="line">1) Just disable protected mode sending the command &#x27;CONFIG SET protected-mode no&#x27; from the loopback interface by connecting to Redis from the same host the server is running, however MAKE SURE Redis is not publicly accessible from internet if you do so. Use CONFIG REWRITE to make this change permanent. </span><br><span class="line">2) Alternatively you can just disable the protected mode by editing the Redis configuration file, and setting the protected mode option to &#x27;no&#x27;, and then restarting the server. </span><br><span class="line">3) If you started the server manually just for testing, restart it with the &#x27;--protected-mode no&#x27; option. </span><br><span class="line">4) Setup a bind address or an authentication password. </span><br><span class="line">NOTE: You only need to do one of the above things in order for the server to start accepting connections from the outside. </span><br></pre></td></tr></table></figure>

<p>ä½¿ç”¨å®¢æˆ·ç«¯å·¥å…· redis-cli è®¿é—®</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@localhost bin]# redis-cli</span><br><span class="line">127.0.0.1:6379&gt; ping</span><br><span class="line">PONG</span><br></pre></td></tr></table></figure>

<h3 id="å…³é—­è¿æ¥"><a href="#å…³é—­è¿æ¥" class="headerlink" title="å…³é—­è¿æ¥"></a>å…³é—­è¿æ¥</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">redis-cli shutdown</span></span><br><span class="line">[root@localhost bin]# ps -ef |grep redis|grep -v grep</span><br><span class="line">root      97843      1  0 09:30 ?        00:00:00 redis-server 127.0.0.1:6379</span><br><span class="line">[root@localhost bin]# redis-cli shutdown</span><br><span class="line">[root@localhost bin]# ps -ef |grep redis</span><br><span class="line">root      97884  93182  0 09:33 pts/1    00:00:00 grep --color=auto redis</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="Redisç›¸å…³çŸ¥è¯†"><a href="#Redisç›¸å…³çŸ¥è¯†" class="headerlink" title="Redisç›¸å…³çŸ¥è¯†"></a>Redisç›¸å…³çŸ¥è¯†</h2><p>â€‹		ç«¯å£6379ï¼šAlessia  Merz</p>
<ol>
<li>é»˜è®¤16ä¸ªæ•°æ®åº“ï¼Œç±»ä¼¼æ•°ç»„ä¸‹æ ‡ä»0å¼€å§‹ï¼Œåˆå§‹é»˜è®¤ä½¿ç”¨0å·åº“</li>
<li>ä½¿ç”¨å‘½ä»¤ select  <dbid>æ¥åˆ‡æ¢æ•°æ®åº“ã€‚å¦‚: select 8 </dbid></li>
<li>ç»Ÿä¸€å¯†ç ç®¡ç†ï¼Œæ‰€æœ‰åº“åŒæ ·å¯†ç ã€‚</li>
<li>dbsize æŸ¥çœ‹å½“å‰æ•°æ®åº“çš„ key çš„æ•°é‡</li>
<li>flushdb æ¸…ç©ºå½“å‰åº“</li>
<li>flushall é€šæ€å…¨éƒ¨åº“</li>
</ol>
<p><strong>Redisæ˜¯å•çº¿ç¨‹ + å¤šè·¯IOå¤ç”¨æŠ€æœ¯</strong></p>
<p>â€‹		å¤šè·¯å¤ç”¨æ˜¯æŒ‡ä½¿ç”¨ä¸€ä¸ªçº¿ç¨‹æ¥æ£€æŸ¥å¤šä¸ªæ–‡ä»¶æè¿°ç¬¦ï¼ˆSocketï¼‰çš„å°±ç»ªçŠ¶æ€ï¼Œæ¯”å¦‚è°ƒç”¨selectå’Œpollå‡½æ•°ï¼Œä¼ å…¥å¤šä¸ªæ–‡ä»¶æè¿°ç¬¦ï¼Œå¦‚æœæœ‰ä¸€ä¸ªæ–‡ä»¶æè¿°ç¬¦å°±ç»ªï¼Œåˆ™è¿”å›ï¼Œå¦åˆ™é˜»å¡ç›´åˆ°è¶…æ—¶ã€‚å¾—åˆ°å°±ç»ªçŠ¶æ€åè¿›è¡ŒçœŸæ­£çš„æ“ä½œå¯ä»¥åœ¨åŒä¸€ä¸ªçº¿ç¨‹é‡Œæ‰§è¡Œï¼Œä¹Ÿå¯ä»¥å¯åŠ¨çº¿ç¨‹æ‰§è¡Œï¼ˆæ¯”å¦‚ä½¿ç”¨çº¿ç¨‹æ± ï¼‰</p>
<p>ä¸²è¡Œ  vs  å¤šçº¿ç¨‹+é”ï¼ˆmemcachedï¼‰ vs  å•çº¿ç¨‹+å¤šè·¯IOå¤ç”¨ï¼ˆRedisï¼‰</p>
<p>ï¼ˆä¸Memcacheä¸‰ç‚¹ä¸åŒï¼šæ”¯æŒå¤šæ•°æ®ç±»å‹ï¼Œæ”¯æŒæŒä¹…åŒ–ï¼Œå•çº¿ç¨‹+å¤šè·¯IOå¤ç”¨ï¼‰</p>
<h1 id="å¸¸ç”¨äº”å¤§æ•°æ®ç±»å‹"><a href="#å¸¸ç”¨äº”å¤§æ•°æ®ç±»å‹" class="headerlink" title="å¸¸ç”¨äº”å¤§æ•°æ®ç±»å‹"></a><strong>å¸¸ç”¨äº”å¤§æ•°æ®ç±»å‹</strong></h1><p>rediså¸¸è§æ•°æ®ç±»å‹æ“ä½œå‘½ä»¤ï¼š<a href="http://www.redis.cn/commands.html">http://www.redis.cn/commands.html</a></p>
<h2 id="Redisé”®ï¼ˆkeyï¼‰"><a href="#Redisé”®ï¼ˆkeyï¼‰" class="headerlink" title="Redisé”®ï¼ˆkeyï¼‰"></a><strong>Redisé”®ï¼ˆkeyï¼‰</strong></h2><ol>
<li><p>keys * æŸ¥çœ‹å½“å‰åº“æ‰€æœ‰key  (åŒ¹é…ï¼škeys * 1)ï¼Œ*** ä½œä¸ºé€šé…ç¬¦å­˜åœ¨ã€‚**</p>
</li>
<li><p>exists key åˆ¤æ–­æŸä¸ªkeyæ˜¯å¦å­˜åœ¨</p>
</li>
<li><p>type key æŸ¥çœ‹ä½ çš„keyæ˜¯ä»€ä¹ˆç±»å‹</p>
</li>
<li><p>del key    åˆ é™¤æŒ‡å®šçš„keyæ•°æ®</p>
</li>
<li><p>unlink key  æ ¹æ®valueé€‰æ‹©éé˜»å¡åˆ é™¤</p>
<p> ä»…å°†keysä»keyspaceå…ƒæ•°æ®ä¸­åˆ é™¤ï¼ŒçœŸæ­£çš„åˆ é™¤ä¼šåœ¨åç»­å¼‚æ­¥æ“ä½œã€‚</p>
</li>
<li><p>expire key 10  10ç§’é’Ÿï¼šä¸ºç»™å®šçš„keyè®¾ç½®è¿‡æœŸæ—¶é—´</p>
</li>
<li><p>ttl key æŸ¥çœ‹è¿˜æœ‰å¤šå°‘ç§’è¿‡æœŸï¼Œ-1è¡¨ç¤ºæ°¸ä¸è¿‡æœŸï¼Œ-2è¡¨ç¤ºå·²è¿‡æœŸ</p>
</li>
</ol>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">127.0.0.1:6379&gt; set k1 v1</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; set k2 v2</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; set k3 v3</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; keys *</span><br><span class="line">1) &quot;k3&quot;</span><br><span class="line">2) &quot;k2&quot;</span><br><span class="line">3) &quot;k1&quot;</span><br><span class="line">127.0.0.1:6379&gt; dbsize</span><br><span class="line">(integer) 3</span><br><span class="line">127.0.0.1:6379&gt; exists k2</span><br><span class="line">(integer) 1</span><br><span class="line">127.0.0.1:6379&gt; type k1</span><br><span class="line">string</span><br><span class="line">127.0.0.1:6379&gt; expire k3 10</span><br><span class="line">(integer) 1</span><br><span class="line">127.0.0.1:6379&gt; ttl k3</span><br><span class="line">(integer) 7</span><br><span class="line">127.0.0.1:6379&gt; ttl k3</span><br><span class="line">(integer) 4</span><br><span class="line">127.0.0.1:6379&gt; ttl k3</span><br><span class="line">(integer) -2</span><br><span class="line">127.0.0.1:6379&gt; keys *</span><br><span class="line">1) &quot;k2&quot;</span><br><span class="line">2) &quot;k1&quot;</span><br><span class="line">127.0.0.1:6379&gt; del k2</span><br><span class="line">(integer) 1</span><br><span class="line">127.0.0.1:6379&gt; keys *</span><br><span class="line">1) &quot;k1&quot;</span><br></pre></td></tr></table></figure>



<h2 id="Rediså­—ç¬¦ä¸²-String"><a href="#Rediså­—ç¬¦ä¸²-String" class="headerlink" title="Rediså­—ç¬¦ä¸²**(String)**"></a><strong>Redis</strong>å­—ç¬¦ä¸²**(String)**</h2><h3 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h3><p>String æ˜¯ Redis æœ€åŸºæœ¬çš„ç±»å‹ï¼Œä½ å¯ä»¥ç†è§£æˆä¸ Memcached ä¸€æ¨¡ä¸€æ ·çš„ç±»å‹ï¼Œä¸€ä¸ª key å¯¹åº”ä¸€ä¸ª valueã€‚</p>
<p>String ç±»å‹æ˜¯äºŒè¿›åˆ¶å®‰å…¨çš„ã€‚æ„å‘³ç€ Redis çš„ String å¯ä»¥åŒ…å«ä»»ä½•æ•°æ®ã€‚æ¯”å¦‚ jpg å›¾ç‰‡æˆ–è€…åºåˆ—åŒ–çš„å¯¹è±¡ã€‚</p>
<p>String ç±»å‹æ˜¯ Redis æœ€åŸºæœ¬çš„æ•°æ®ç±»å‹ï¼Œä¸€ä¸ª Redis ä¸­å­—ç¬¦ä¸² value æœ€å¤šå¯ä»¥æ˜¯512M</p>
<h3 id="å¸¸ç”¨å‘½ä»¤"><a href="#å¸¸ç”¨å‘½ä»¤" class="headerlink" title="å¸¸ç”¨å‘½ä»¤"></a>å¸¸ç”¨å‘½ä»¤</h3><ol>
<li>set  <key><value>æ·»åŠ é”®å€¼å¯¹</value></key></li>
</ol>
<ul>
<li><p>*NXï¼šå½“æ•°æ®åº“ä¸­keyä¸å­˜åœ¨æ—¶ï¼Œå¯ä»¥å°†key-valueæ·»åŠ æ•°æ®åº“</p>
</li>
<li><p>*XXï¼šå½“æ•°æ®åº“ä¸­keyå­˜åœ¨æ—¶ï¼Œå¯ä»¥å°†key-valueæ·»åŠ æ•°æ®åº“ï¼Œä¸NXå‚æ•°äº’æ–¥</p>
</li>
<li><p>*EXï¼škeyçš„è¶…æ—¶ç§’æ•°ï¼Œsetex k2 10 v2</p>
</li>
<li><p>*PXï¼škeyçš„è¶…æ—¶æ¯«ç§’æ•°ï¼Œä¸EXäº’æ–¥</p>
  <figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span><span class="operator">&gt;</span> <span class="keyword">set</span> k1 v1</span><br><span class="line">OK</span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span><span class="operator">&gt;</span> setnx k1 v11</span><br><span class="line">(<span class="type">integer</span>) <span class="number">0</span></span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span><span class="operator">&gt;</span> setex k2 <span class="number">10</span> v2</span><br><span class="line">OK</span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span><span class="operator">&gt;</span> ttl k2</span><br><span class="line">(<span class="type">integer</span>) <span class="number">7</span></span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span><span class="operator">&gt;</span> ttl k2</span><br><span class="line">(<span class="type">integer</span>) <span class="number">3</span></span><br></pre></td></tr></table></figure></li>
</ul>
<ol start="2">
<li><p>get  <key>æŸ¥è¯¢å¯¹åº”é”®å€¼</key></p>
 <figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span><span class="operator">&gt;</span> <span class="keyword">get</span> k1</span><br><span class="line">&quot;v1&quot;</span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span><span class="operator">&gt;</span> <span class="keyword">get</span> k2</span><br><span class="line">(nil)</span><br></pre></td></tr></table></figure>
</li>
<li><p>append <key><value>å°†ç»™å®šçš„<value> è¿½åŠ åˆ°åŸå€¼çš„æœ«å°¾</value></value></key></p>
 <figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span><span class="operator">&gt;</span> append k1 v1v1</span><br><span class="line">(<span class="type">integer</span>) <span class="number">6</span></span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span><span class="operator">&gt;</span> <span class="keyword">get</span> k1</span><br><span class="line">&quot;v1v1v1&quot;</span><br></pre></td></tr></table></figure>
</li>
<li><p>strlen <key>è·å¾—å€¼çš„é•¿åº¦</key></p>
 <figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span><span class="operator">&gt;</span> strlen k1</span><br><span class="line">(<span class="type">integer</span>) <span class="number">6</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>setnx <key><value>åªæœ‰åœ¨ key ä¸å­˜åœ¨æ—¶  è®¾ç½® key çš„å€¼</value></key></p>
</li>
<li><p>incr <key>  å°† key ä¸­å‚¨å­˜çš„æ•°å­—å€¼å¢1ï¼Œåªèƒ½å¯¹æ•°å­—å€¼æ“ä½œï¼Œå¦‚æœä¸ºç©ºï¼Œæ–°å¢å€¼ä¸º 1</key></p>
</li>
<li><p>decr <key> å°† key ä¸­å‚¨å­˜çš„æ•°å­—å€¼å‡1ï¼Œåªèƒ½å¯¹æ•°å­—å€¼æ“ä½œï¼Œå¦‚æœä¸ºç©ºï¼Œæ–°å¢å€¼ä¸º -1</key></p>
</li>
<li><p>incrby &#x2F; decrby <key>&lt;æ­¥é•¿&gt; å°† key ä¸­å‚¨å­˜çš„æ•°å­—å€¼å¢å‡ã€‚è‡ªå®šä¹‰æ­¥é•¿ã€‚</key></p>
 <figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span><span class="operator">&gt;</span> <span class="keyword">get</span> k1</span><br><span class="line">v1</span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span><span class="operator">&gt;</span> incr k1</span><br><span class="line">(error) ERR <span class="keyword">value</span> <span class="keyword">is</span> <span class="keyword">not</span> an <span class="type">integer</span> <span class="keyword">or</span> <span class="keyword">out</span> <span class="keyword">of</span> <span class="keyword">range</span></span><br><span class="line"></span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span><span class="operator">&gt;</span> <span class="keyword">set</span> k2 <span class="number">2</span></span><br><span class="line">OK</span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span><span class="operator">&gt;</span> incr k2</span><br><span class="line">(<span class="type">integer</span>) <span class="number">3</span></span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span><span class="operator">&gt;</span> incr k2</span><br><span class="line">(<span class="type">integer</span>) <span class="number">4</span></span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span><span class="operator">&gt;</span> <span class="keyword">get</span> k2</span><br><span class="line">&quot;4&quot;</span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span><span class="operator">&gt;</span> decr k2</span><br><span class="line">(<span class="type">integer</span>) <span class="number">3</span></span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span><span class="operator">&gt;</span> incrby k2 <span class="number">3</span></span><br><span class="line">(<span class="type">integer</span>) <span class="number">6</span></span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span><span class="operator">&gt;</span> incrby k2 <span class="number">3</span></span><br><span class="line">(<span class="type">integer</span>) <span class="number">9</span></span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span><span class="operator">&gt;</span> decrby k2 <span class="number">1</span></span><br><span class="line">(<span class="type">integer</span>) <span class="number">8</span></span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span><span class="operator">&gt;</span> <span class="keyword">get</span> k2</span><br><span class="line">&quot;8&quot;</span><br></pre></td></tr></table></figure>
</li>
<li><p>mset <key1><value1><key2><value2>  åŒæ—¶è®¾ç½®ä¸€ä¸ªæˆ–å¤šä¸ª key-valueå¯¹ </value2></key2></value1></key1></p>
</li>
<li><p>mget <key1><key2><key3>  åŒæ—¶è·å–ä¸€ä¸ªæˆ–å¤šä¸ª value </key3></key2></key1></p>
</li>
<li><p>msetnx <key1><value1><key2><value2>  åŒæ—¶è®¾ç½®ä¸€ä¸ªæˆ–å¤šä¸ª key-value å¯¹ï¼Œå½“ä¸”ä»…å½“æ‰€æœ‰ç»™å®š key éƒ½ä¸å­˜åœ¨ã€‚</value2></key2></value1></key1></p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span><span class="operator">&gt;</span> mset k1 v1 k2 v2</span><br><span class="line">OK</span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span><span class="operator">&gt;</span> mget k1 k2</span><br><span class="line"><span class="number">1</span>) &quot;v1&quot;</span><br><span class="line"><span class="number">2</span>) &quot;v2&quot;</span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span><span class="operator">&gt;</span> msetnx k3 v3 k4 v4</span><br><span class="line">(<span class="type">integer</span>) <span class="number">1</span></span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span><span class="operator">&gt;</span> msetnx k3 k33 k5 v5</span><br><span class="line">(<span class="type">integer</span>) <span class="number">0</span></span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span><span class="operator">&gt;</span> <span class="keyword">get</span> k5</span><br><span class="line">(nil)</span><br></pre></td></tr></table></figure></li>
</ol>
<p><strong>åŸå­æ€§ï¼Œæœ‰ä¸€ä¸ªå¤±è´¥åˆ™éƒ½å¤±è´¥</strong></p>
<ol start="12">
<li><p>getrange <key>&lt;èµ·å§‹ä½ç½®&gt;&lt;ç»“æŸä½ç½®&gt;  è·å¾—å€¼çš„èŒƒå›´ï¼Œç±»ä¼¼ substringï¼Œ<strong>å‰åŒ…ï¼ŒååŒ…</strong></key></p>
</li>
<li><p>setrange <key>&lt;èµ·å§‹ä½ç½®&gt;<value> ç”¨ <value> è¦†å†™<key>æ‰€å‚¨å­˜çš„å­—ç¬¦ä¸²å€¼ï¼Œä»&lt;èµ·å§‹ä½ç½®&gt;å¼€å§‹ï¼ˆç´¢å¼•ä»0å¼€å§‹ï¼‰ã€‚</key></value></value></key></p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span><span class="operator">&gt;</span> <span class="keyword">set</span> k1 abcdefg</span><br><span class="line">OK</span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span><span class="operator">&gt;</span> getrange k1 <span class="number">2</span> <span class="number">4</span></span><br><span class="line">&quot;cde&quot;</span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span><span class="operator">&gt;</span> setrange k1 <span class="number">1</span> xxx</span><br><span class="line">(<span class="type">integer</span>) <span class="number">7</span></span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span><span class="operator">&gt;</span> <span class="keyword">get</span> k1</span><br><span class="line">&quot;axxxefg&quot;</span><br></pre></td></tr></table></figure>
</li>
<li><p>setex <key>&lt;è¿‡æœŸæ—¶é—´&gt;<value> è®¾ç½®é”®å€¼çš„åŒæ—¶ï¼Œè®¾ç½®è¿‡æœŸæ—¶é—´ï¼Œå•ä½ç§’ã€‚</value></key></p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span><span class="operator">&gt;</span> setex k2 <span class="number">10</span> v2</span><br><span class="line">OK</span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span><span class="operator">&gt;</span> ttl k2</span><br><span class="line">(<span class="type">integer</span>) <span class="number">7</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>getset <key><value> ä»¥æ–°æ¢æ—§ï¼Œè®¾ç½®äº†æ–°å€¼åŒæ—¶è·å¾—æ—§å€¼ã€‚</value></key></p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span><span class="operator">&gt;</span> <span class="keyword">set</span> k3 v3</span><br><span class="line">OK</span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span><span class="operator">&gt;</span> getset k3 v33</span><br><span class="line">&quot;v3&quot;</span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span><span class="operator">&gt;</span> <span class="keyword">get</span> k3</span><br><span class="line">&quot;v33&quot;</span><br></pre></td></tr></table></figure></li>
</ol>
<p>åŸå­æ€§ï¼š</p>
<p>æ‰€è°“ <strong>åŸå­æ“ä½œ</strong> æ˜¯æŒ‡ä¸ä¼šè¢«çº¿ç¨‹è°ƒåº¦æœºåˆ¶æ‰“æ–­çš„æ“ä½œï¼›</p>
<p>è¿™ç§æ“ä½œä¸€æ—¦å¼€å§‹ï¼Œå°±ä¸€ç›´è¿è¡Œåˆ°ç»“æŸï¼Œä¸­é—´ä¸ä¼šæœ‰ä»»ä½• context switch ï¼ˆåˆ‡æ¢åˆ°å¦ä¸€ä¸ªçº¿ç¨‹ï¼‰ã€‚</p>
<p>ï¼ˆ1ï¼‰åœ¨å•çº¿ç¨‹ä¸­ï¼Œ èƒ½å¤Ÿåœ¨å•æ¡æŒ‡ä»¤ä¸­å®Œæˆçš„æ“ä½œéƒ½å¯ä»¥è®¤ä¸ºæ˜¯ â€œåŸå­æ“ä½œâ€ï¼Œå› ä¸ºä¸­æ–­åªèƒ½å‘ç”ŸäºæŒ‡ä»¤ä¹‹é—´ã€‚</p>
<p>ï¼ˆ2ï¼‰åœ¨å¤šçº¿ç¨‹ä¸­ï¼Œä¸èƒ½è¢«å…¶å®ƒè¿›ç¨‹ï¼ˆçº¿ç¨‹ï¼‰æ‰“æ–­çš„æ“ä½œå°±å«åŸå­æ“ä½œã€‚</p>
<p>Rediså•å‘½ä»¤çš„åŸå­æ€§ä¸»è¦å¾—ç›Šäº Redis çš„å•çº¿ç¨‹ã€‚</p>
<p><mark> Redis ä¸­çš„ incr&#x2F;decr æ˜¯åŸå­æ“ä½œ</mark></p>
<p><strong>æ¡ˆä¾‹ï¼š</strong></p>
<p>javaä¸­çš„ i++ æ˜¯å¦æ˜¯åŸå­æ“ä½œï¼Ÿ<strong>ä¸æ˜¯</strong></p>
<p>i&#x3D;0;ä¸¤ä¸ªçº¿ç¨‹åˆ†åˆ«å¯¹ i è¿›è¡Œ ++100æ¬¡ï¼Œå€¼æ˜¯å¤šå°‘ï¼Ÿã€2-200ã€‘</p>
<p><img src="/2023/02/28/Redis/Java\Document\Redis\Redis.assets\image-20220513101000926.png" alt="image-20220513101000926"></p>
<p>è¯´æ˜ï¼š</p>
<p>i++ çš„æ“ä½œåˆ†ä¸ºä¸‰æ­¥ï¼šå–å€¼ï¼Œ++ï¼Œå†èµ‹å€¼</p>
<p>a çº¿ç¨‹åŠ åˆ° 99 ä½†æœªèµ‹å€¼ï¼Œè¢« b çº¿ç¨‹æ‰“æ–­å¹¶è¿›è¡ŒåŠ  1 æ“ä½œï¼Œæ­¤æ—¶ açº¿ç¨‹æ‰§è¡Œèµ‹å€¼æ“ä½œ i&#x3D;1ï¼Œb çº¿ç¨‹æ‰“æ–­å¹¶åŠ åˆ° 99ï¼Œi++ å i &#x3D; 100ï¼Œa çº¿ç¨‹æ‰“æ–­ï¼Œå†æ¬¡ i++ ï¼Œæœ€ç»ˆå€¼ä¸º 2ï¼Œä¸¤ä¸ªçº¿ç¨‹éƒ½æ‰§è¡Œäº†100æ¬¡ï¼Œæ‰€ä»¥æœ€ç»ˆçš„èŒƒå›´æ˜¯ [2, 200]</p>
<h3 id="æ•°æ®ç»“æ„"><a href="#æ•°æ®ç»“æ„" class="headerlink" title="æ•°æ®ç»“æ„"></a>æ•°æ®ç»“æ„</h3><p>â€‹		String çš„æ•°æ®ç»“æ„ä¸ºç®€å•åŠ¨æ€å­—ç¬¦ä¸²ï¼ˆSimple Dynamic Stringï¼Œç¼©å†™SDSï¼‰ã€‚æ˜¯å¯ä»¥ä¿®æ”¹çš„å­—ç¬¦ä¸²ï¼Œå†…éƒ¨ç»“æ„å®ç°ä¸Šç±»ä¼¼äºJavaçš„ArrayListï¼Œ<strong>é‡‡ç”¨é¢„åˆ†é…å†—ä½™ç©ºé—´çš„æ–¹å¼æ¥å‡å°‘å†…å­˜çš„é¢‘ç¹åˆ†é…ã€‚</strong></p>
<p><img src="/2023/02/28/Redis/Java\Document\Redis\Redis.assets\image-20220513095346071.png" alt="image-20220513095346071"></p>
<p>â€‹		å¦‚å›¾ä¸­æ‰€ç¤ºï¼Œå†…éƒ¨ä¸ºå½“å‰å­—ç¬¦ä¸²å®é™…åˆ†é…çš„ç©ºé—´capacityä¸€èˆ¬è¦é«˜äºå®é™…å­—ç¬¦ä¸²é•¿åº¦lenã€‚å½“å­—ç¬¦ä¸²é•¿åº¦å°äº1Mæ—¶ï¼Œæ‰©å®¹éƒ½æ˜¯åŠ å€ç°æœ‰çš„ç©ºé—´ï¼Œå¦‚æœè¶…è¿‡1Mï¼Œæ‰©å®¹æ—¶ä¸€æ¬¡åªä¼šå¤šæ‰©1Mçš„ç©ºé—´ã€‚éœ€è¦æ³¨æ„çš„æ˜¯å­—ç¬¦ä¸²æœ€å¤§é•¿åº¦ä¸º512Mã€‚</p>
<h2 id="Redisåˆ—è¡¨ï¼ˆListï¼‰"><a href="#Redisåˆ—è¡¨ï¼ˆListï¼‰" class="headerlink" title="Redisåˆ—è¡¨ï¼ˆListï¼‰"></a>Redisåˆ—è¡¨ï¼ˆListï¼‰</h2><h3 id="ç®€ä»‹-1"><a href="#ç®€ä»‹-1" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h3><p>å•é”®å¤šå€¼</p>
<p>â€‹		Redis åˆ—è¡¨æ˜¯ç®€å•çš„å­—ç¬¦ä¸²åˆ—è¡¨ï¼ŒæŒ‰ç…§æ’å…¥é¡ºåºæ’åºã€‚ä½ å¯ä»¥æ·»åŠ ä¸€ä¸ªå…ƒç´ åˆ°åˆ—è¡¨çš„å¤´éƒ¨ï¼ˆå·¦è¾¹ï¼‰æˆ–è€…å°¾éƒ¨ï¼ˆå³è¾¹ï¼‰ã€‚å®ƒçš„åº•å±‚å®é™…æ˜¯ä¸ªåŒå‘é“¾è¡¨ï¼Œå¯¹ä¸¤ç«¯çš„æ“ä½œæ€§èƒ½å¾ˆé«˜ï¼Œé€šè¿‡ç´¢å¼•ä¸‹æ ‡çš„æ“ä½œä¸­é—´çš„èŠ‚ç‚¹æ€§èƒ½ä¼šè¾ƒå·®ã€‚</p>
<p><img src="/2023/02/28/Redis/Java\Document\Redis\Redis.assets\image-20220513101420250.png" alt="image-20220513101420250"></p>
<h3 id="å¸¸ç”¨å‘½ä»¤-1"><a href="#å¸¸ç”¨å‘½ä»¤-1" class="headerlink" title="å¸¸ç”¨å‘½ä»¤"></a>å¸¸ç”¨å‘½ä»¤</h3><ol>
<li><p>lpush&#x2F;rpush <key><value1><value2><value3> â€¦. ä»å·¦è¾¹&#x2F;å³è¾¹æ’å…¥ä¸€ä¸ªæˆ–å¤šä¸ªå€¼ã€‚</value3></value2></value1></key></p>
 <figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span><span class="operator">&gt;</span> lpush code java go c<span class="operator">+</span><span class="operator">+</span></span><br><span class="line">(<span class="type">integer</span>) <span class="number">3</span></span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span><span class="operator">&gt;</span> lrange code <span class="number">0</span> <span class="number">-1</span></span><br><span class="line"><span class="number">1</span>) &quot;c++&quot;</span><br><span class="line"><span class="number">2</span>) &quot;go&quot;</span><br><span class="line"><span class="number">3</span>) &quot;java&quot;</span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span><span class="operator">&gt;</span> rpush code python scala</span><br><span class="line">(<span class="type">integer</span>) <span class="number">5</span></span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span><span class="operator">&gt;</span> lrange code <span class="number">0</span> <span class="number">-1</span></span><br><span class="line"><span class="number">1</span>) &quot;c++&quot;</span><br><span class="line"><span class="number">2</span>) &quot;go&quot;</span><br><span class="line"><span class="number">3</span>) &quot;java&quot;</span><br><span class="line"><span class="number">4</span>) &quot;python&quot;</span><br><span class="line"><span class="number">5</span>) &quot;scala&quot;</span><br></pre></td></tr></table></figure>
</li>
<li><p>lrange <key><start><stop></stop> æŒ‰ç…§ç´¢å¼•ä¸‹æ ‡è·å¾—å…ƒç´ (ä»å·¦åˆ°å³)ï¼Œï¼ˆ0-1è¡¨ç¤ºè·å–æ‰€æœ‰ï¼‰</start></key></p>
 <figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span><span class="operator">&gt;</span> lrange code <span class="number">0</span> <span class="number">2</span></span><br><span class="line"><span class="number">1</span>) &quot;c++&quot;</span><br><span class="line"><span class="number">2</span>) &quot;go&quot;</span><br><span class="line"><span class="number">3</span>) &quot;java&quot;</span><br></pre></td></tr></table></figure>
</li>
<li><p>lpop&#x2F;rpop <key> <count>ä»å·¦è¾¹&#x2F;å³è¾¹å¼¹å‡ºä¸€ä¸ªæˆ–å¤šä¸ªå€¼ã€‚</count></key></p>
 <figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span><span class="operator">&gt;</span> lpop code</span><br><span class="line">&quot;c++&quot;</span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span><span class="operator">&gt;</span> rpop code <span class="number">2</span></span><br><span class="line"><span class="number">1</span>) &quot;scala&quot;</span><br><span class="line"><span class="number">2</span>) &quot;python&quot;</span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span><span class="operator">&gt;</span> lrange code <span class="number">0</span> <span class="number">-1</span></span><br><span class="line"><span class="number">1</span>) &quot;go&quot;</span><br><span class="line"><span class="number">2</span>) &quot;java&quot;</span><br></pre></td></tr></table></figure>
</li>
<li><p>rpoplpush <key1><key2>ä»<key1>åˆ—è¡¨å³è¾¹å¼¹å‡ºä¸€ä¸ªå€¼ï¼Œæ’åˆ°<key2>åˆ—è¡¨å·¦è¾¹ã€‚</key2></key1></key2></key1></p>
 <figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span><span class="operator">&gt;</span> rpush list01 A B C</span><br><span class="line">(<span class="type">integer</span>) <span class="number">3</span></span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span><span class="operator">&gt;</span> rpush list02 D E F</span><br><span class="line">(<span class="type">integer</span>) <span class="number">3</span></span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span><span class="operator">&gt;</span> rpoplpush list01 list02</span><br><span class="line">&quot;C&quot;</span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span><span class="operator">&gt;</span> lrange list01 <span class="number">0</span> <span class="number">-1</span></span><br><span class="line"><span class="number">1</span>) &quot;A&quot;</span><br><span class="line"><span class="number">2</span>) &quot;B&quot;</span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span><span class="operator">&gt;</span> lrange list02 <span class="number">0</span> <span class="number">-1</span></span><br><span class="line"><span class="number">1</span>) &quot;C&quot;</span><br><span class="line"><span class="number">2</span>) &quot;D&quot;</span><br><span class="line"><span class="number">3</span>) &quot;E&quot;</span><br><span class="line"><span class="number">4</span>) &quot;F&quot;</span><br></pre></td></tr></table></figure>
</li>
<li><p>lindex <key><index>æŒ‰ç…§ç´¢å¼•ä¸‹æ ‡è·å¾—å…ƒç´ (ä»å·¦åˆ°å³)</index></key></p>
 <figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span><span class="operator">&gt;</span> lrange list02 <span class="number">0</span> <span class="number">-1</span></span><br><span class="line"><span class="number">1</span>) &quot;C&quot;</span><br><span class="line"><span class="number">2</span>) &quot;D&quot;</span><br><span class="line"><span class="number">3</span>) &quot;E&quot;</span><br><span class="line"><span class="number">4</span>) &quot;F&quot;</span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span><span class="operator">&gt;</span> lindex list02 <span class="number">2</span></span><br><span class="line">&quot;E&quot;</span><br></pre></td></tr></table></figure>
</li>
<li><p>llen <key>è·å¾—åˆ—è¡¨é•¿åº¦ </key></p>
 <figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span><span class="operator">&gt;</span> llen list02</span><br><span class="line">(<span class="type">integer</span>) <span class="number">4</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>linsert <key> before <value><newvalue>åœ¨<value>çš„åé¢æ’å…¥<newvalue>æ’å…¥å€¼</newvalue></value></newvalue></value></key></p>
 <figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span><span class="operator">&gt;</span> rpush list A B C D</span><br><span class="line">(<span class="type">integer</span>) <span class="number">4</span></span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span><span class="operator">&gt;</span> linsert list before C X</span><br><span class="line">(<span class="type">integer</span>) <span class="number">5</span></span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span><span class="operator">&gt;</span> lrange list <span class="number">0</span> <span class="number">-1</span></span><br><span class="line"><span class="number">1</span>) &quot;A&quot;</span><br><span class="line"><span class="number">2</span>) &quot;B&quot;</span><br><span class="line"><span class="number">3</span>) &quot;X&quot;</span><br><span class="line"><span class="number">4</span>) &quot;C&quot;</span><br><span class="line"><span class="number">5</span>) &quot;D&quot;</span><br></pre></td></tr></table></figure>
</li>
<li><p>lrem <key><n><value>ä»å·¦è¾¹åˆ é™¤ n ä¸ª value (ä»å·¦åˆ°å³)</value></n></key></p>
 <figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span><span class="operator">&gt;</span> rpush list A B B B C D</span><br><span class="line">(<span class="type">integer</span>) <span class="number">6</span></span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span><span class="operator">&gt;</span> lrem list <span class="number">2</span> B</span><br><span class="line">(<span class="type">integer</span>) <span class="number">2</span></span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span><span class="operator">&gt;</span> lrange list <span class="number">0</span> <span class="number">-1</span></span><br><span class="line"><span class="number">1</span>) &quot;A&quot;</span><br><span class="line"><span class="number">2</span>) &quot;B&quot;</span><br><span class="line"><span class="number">3</span>) &quot;C&quot;</span><br><span class="line"><span class="number">4</span>) &quot;D&quot;</span><br></pre></td></tr></table></figure>
</li>
<li><p>lset<key><index><value>å°†åˆ—è¡¨keyä¸‹æ ‡ä¸ºindexçš„å€¼æ›¿æ¢æˆvalue</value></index></key></p>
 <figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span><span class="operator">&gt;</span> lset list <span class="number">2</span> CC</span><br><span class="line">OK</span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span><span class="operator">&gt;</span> lrange list <span class="number">0</span> <span class="number">-1</span></span><br><span class="line"><span class="number">1</span>) &quot;A&quot;</span><br><span class="line"><span class="number">2</span>) &quot;B&quot;</span><br><span class="line"><span class="number">3</span>) &quot;CC&quot;</span><br><span class="line"><span class="number">4</span>) &quot;D&quot;</span><br></pre></td></tr></table></figure></li>
</ol>
<h3 id="æ•°æ®ç»“æ„-1"><a href="#æ•°æ®ç»“æ„-1" class="headerlink" title="æ•°æ®ç»“æ„"></a>æ•°æ®ç»“æ„</h3><p>Listçš„æ•°æ®ç»“æ„ä¸ºå¿«é€Ÿé“¾è¡¨ quickListã€‚</p>
<p>é¦–å…ˆåœ¨åˆ—è¡¨å…ƒç´ è¾ƒå°‘çš„æƒ…å†µä¸‹ä¼šä½¿ç”¨ä¸€å—è¿ç»­çš„å†…å­˜å­˜å‚¨ï¼Œè¿™ä¸ªç»“æ„æ˜¯ ziplistï¼Œä¹Ÿå³æ˜¯å‹ç¼©åˆ—è¡¨ã€‚</p>
<p>å®ƒå°†æ‰€æœ‰çš„å…ƒç´ ç´§æŒ¨ç€ä¸€èµ·å­˜å‚¨ï¼Œåˆ†é…çš„æ˜¯ä¸€å—è¿ç»­çš„å†…å­˜ã€‚</p>
<p>å½“æ•°æ®é‡æ¯”è¾ƒå¤šçš„æ—¶å€™æ‰ä¼šæ”¹æˆ quicklistã€‚</p>
<p>å› ä¸ºæ™®é€šçš„é“¾è¡¨éœ€è¦çš„é™„åŠ æŒ‡é’ˆç©ºé—´å¤ªå¤§ï¼Œä¼šæ¯”è¾ƒæµªè´¹ç©ºé—´ã€‚æ¯”å¦‚è¿™ä¸ªåˆ—è¡¨é‡Œå­˜çš„åªæ˜¯ int ç±»å‹çš„æ•°æ®ï¼Œç»“æ„ä¸Šè¿˜éœ€è¦ä¸¤ä¸ªé¢å¤–çš„æŒ‡é’ˆ prev å’Œ nextã€‚</p>
<p><img src="/2023/02/28/Redis/Java\Document\Redis\Redis.assets\image-20220513101547127.png" alt="image-20220513101547127"></p>
<p>Redis å°†é“¾è¡¨å’Œ ziplist ç»“åˆèµ·æ¥ç»„æˆäº† quicklistã€‚ä¹Ÿå°±æ˜¯å°†å¤šä¸ª ziplist ä½¿ç”¨åŒå‘æŒ‡é’ˆä¸²èµ·æ¥ä½¿ç”¨ã€‚è¿™æ ·æ—¢æ»¡è¶³äº†å¿«é€Ÿçš„æ’å…¥åˆ é™¤æ€§èƒ½ï¼Œåˆä¸ä¼šå‡ºç°å¤ªå¤§çš„ç©ºé—´å†—ä½™ã€‚</p>
<h2 id="Redisé›†åˆï¼ˆSetï¼‰"><a href="#Redisé›†åˆï¼ˆSetï¼‰" class="headerlink" title="Redisé›†åˆï¼ˆSetï¼‰"></a>Redisé›†åˆï¼ˆSetï¼‰</h2><h3 id="ç®€ä»‹-2"><a href="#ç®€ä»‹-2" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h3><p>â€‹		Redis Set å¯¹å¤–æä¾›çš„åŠŸèƒ½ä¸ List ç±»ä¼¼æ˜¯ä¸€ä¸ªåˆ—è¡¨çš„åŠŸèƒ½ï¼Œç‰¹æ®Šä¹‹å¤„åœ¨äº Set æ˜¯å¯ä»¥<strong>è‡ªåŠ¨æ’é‡</strong>çš„ï¼Œå½“ä½ éœ€è¦å­˜å‚¨ä¸€ä¸ªåˆ—è¡¨æ•°æ®ï¼Œåˆä¸å¸Œæœ›å‡ºç°é‡å¤æ•°æ®æ—¶ï¼ŒSet æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„é€‰æ‹©ï¼Œå¹¶ä¸” Set æä¾›äº†åˆ¤æ–­æŸä¸ªæˆå‘˜æ˜¯å¦åœ¨ä¸€ä¸ª Set é›†åˆå†…çš„é‡è¦æ¥å£ï¼Œè¿™ä¸ªä¹Ÿæ˜¯ List æ‰€ä¸èƒ½æä¾›çš„ã€‚</p>
<p>â€‹		Redis çš„ Set æ˜¯ String ç±»å‹çš„æ— åºé›†åˆã€‚å®ƒåº•å±‚å…¶å®æ˜¯ä¸€ä¸ª value ä¸ºnull çš„ hash è¡¨ï¼Œæ‰€ä»¥æ·»åŠ ï¼Œåˆ é™¤ï¼ŒæŸ¥æ‰¾çš„<strong>å¤æ‚åº¦éƒ½æ˜¯</strong>O(1)ã€‚ä¸€ä¸ªç®—æ³•ï¼Œéšç€æ•°æ®çš„å¢åŠ ï¼Œæ‰§è¡Œæ—¶é—´çš„é•¿çŸ­ï¼Œå¦‚æœæ˜¯O(1)ï¼Œæ•°æ®å¢åŠ ï¼ŒæŸ¥æ‰¾æ•°æ®çš„æ—¶é—´ä¸å˜ã€‚</p>
<h3 id="å¸¸ç”¨å‘½ä»¤-2"><a href="#å¸¸ç”¨å‘½ä»¤-2" class="headerlink" title="å¸¸ç”¨å‘½ä»¤"></a>å¸¸ç”¨å‘½ä»¤</h3><ol>
<li><p>sadd <key><value1><value2> å°†ä¸€ä¸ªæˆ–å¤šä¸ª member å…ƒç´ åŠ å…¥åˆ°é›†åˆ key ä¸­ï¼Œå·²å­˜åœ¨çš„ member å…ƒç´ å°†è¢«å¿½ç•¥</value2></value1></key></p>
</li>
<li><p>smembers <key>  å–å‡ºè¯¥é›†åˆçš„æ‰€æœ‰å€¼ã€‚</key></p>
</li>
<li><p>sismember <key><value>  åˆ¤æ–­é›†åˆ<key>æ˜¯å¦ä¸ºå«æœ‰è¯¥<value>å€¼ï¼Œæœ‰1ï¼Œæ²¡æœ‰0</value></key></value></key></p>
</li>
<li><p>scard<key>  è¿”å›è¯¥é›†åˆçš„å…ƒç´ ä¸ªæ•°ã€‚</key></p>
 <figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span><span class="operator">&gt;</span> sadd set01 A A B C C</span><br><span class="line">(<span class="type">integer</span>) <span class="number">3</span></span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span><span class="operator">&gt;</span> smembers set01</span><br><span class="line"><span class="number">1</span>) &quot;B&quot;</span><br><span class="line"><span class="number">2</span>) &quot;C&quot;</span><br><span class="line"><span class="number">3</span>) &quot;A&quot;</span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span><span class="operator">&gt;</span> sismember set01 C</span><br><span class="line">(<span class="type">integer</span>) <span class="number">1</span></span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span><span class="operator">&gt;</span> scard set01</span><br><span class="line">(<span class="type">integer</span>) <span class="number">3</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>srem <key><value1><value2>  åˆ é™¤é›†åˆä¸­çš„æŸä¸ªå…ƒç´ ã€‚</value2></value1></key></p>
</li>
<li><p>spop <key>  <strong>éšæœºä»è¯¥é›†åˆä¸­å¼¹å‡ºä¸€ä¸ªå€¼ã€‚</strong></key></p>
 <figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span><span class="operator">&gt;</span> smembers set01</span><br><span class="line"><span class="number">1</span>) &quot;F&quot;</span><br><span class="line"><span class="number">2</span>) &quot;B&quot;</span><br><span class="line"><span class="number">3</span>) &quot;E&quot;</span><br><span class="line"><span class="number">4</span>) &quot;A&quot;</span><br><span class="line"><span class="number">5</span>) &quot;C&quot;</span><br><span class="line"><span class="number">6</span>) &quot;D&quot;</span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span><span class="operator">&gt;</span> srem set01 D</span><br><span class="line">(<span class="type">integer</span>) <span class="number">1</span></span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span><span class="operator">&gt;</span> smembers set01</span><br><span class="line"><span class="number">1</span>) &quot;F&quot;</span><br><span class="line"><span class="number">2</span>) &quot;B&quot;</span><br><span class="line"><span class="number">3</span>) &quot;E&quot;</span><br><span class="line"><span class="number">4</span>) &quot;A&quot;</span><br><span class="line"><span class="number">5</span>) &quot;C&quot;</span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span><span class="operator">&gt;</span> spop set01 <span class="number">2</span></span><br><span class="line"><span class="number">1</span>) &quot;A&quot;</span><br><span class="line"><span class="number">2</span>) &quot;C&quot;</span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span><span class="operator">&gt;</span> smembers set01</span><br><span class="line"><span class="number">1</span>) &quot;F&quot;</span><br><span class="line"><span class="number">2</span>) &quot;B&quot;</span><br><span class="line"><span class="number">3</span>) &quot;E&quot;</span><br></pre></td></tr></table></figure>
</li>
<li><p>srandmember <key><n> éšæœºä»è¯¥é›†åˆä¸­å–å‡ºnä¸ªå€¼ã€‚ä¸ä¼šä»é›†åˆä¸­åˆ é™¤ ã€‚</n></key></p>
 <figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span><span class="operator">&gt;</span> sadd set01  A B C D E F</span><br><span class="line">(<span class="type">integer</span>) <span class="number">6</span></span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span><span class="operator">&gt;</span> srandmember set01 <span class="number">2</span></span><br><span class="line"><span class="number">1</span>) &quot;E&quot;</span><br><span class="line"><span class="number">2</span>) &quot;C&quot;</span><br></pre></td></tr></table></figure>
</li>
<li><p>smove <source><destination>  value  æŠŠé›†åˆä¸­ä¸€ä¸ªå€¼ä»ä¸€ä¸ªé›†åˆç§»åŠ¨åˆ°å¦ä¸€ä¸ªé›†åˆã€‚</destination></p>
 <figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span><span class="operator">&gt;</span> sadd set01 A B C</span><br><span class="line">(<span class="type">integer</span>) <span class="number">3</span></span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span><span class="operator">&gt;</span> smove set01 set02 A</span><br><span class="line">(<span class="type">integer</span>) <span class="number">1</span></span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span><span class="operator">&gt;</span> smembers set02</span><br><span class="line"><span class="number">1</span>) &quot;A&quot;</span><br></pre></td></tr></table></figure>
</li>
<li><p>sinter <key1><key2>  è¿”å›ä¸¤ä¸ªé›†åˆçš„äº¤é›†å…ƒç´ ã€‚</key2></key1></p>
</li>
<li><p>sunion <key1><key2>è¿”å›ä¸¤ä¸ªé›†åˆçš„å¹¶é›†å…ƒç´ ã€‚</key2></key1></p>
</li>
<li><p>sdiff <key1><key2>    è¿”å›ä¸¤ä¸ªé›†åˆçš„<strong>å·®é›†</strong>å…ƒç´ ï¼ˆkey1ä¸­çš„ï¼Œä¸åŒ…å«key2ä¸­çš„ï¼‰ã€‚</key2></key1></p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span><span class="operator">&gt;</span> sadd set01 A C D</span><br><span class="line">(<span class="type">integer</span>) <span class="number">3</span></span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span><span class="operator">&gt;</span> sadd set02 B C E</span><br><span class="line">(<span class="type">integer</span>) <span class="number">3</span></span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span><span class="operator">&gt;</span> sinter set01 set02</span><br><span class="line"><span class="number">1</span>) &quot;C&quot;</span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span><span class="operator">&gt;</span> sunion set01 set02</span><br><span class="line"><span class="number">1</span>) &quot;A&quot;</span><br><span class="line"><span class="number">2</span>) &quot;C&quot;</span><br><span class="line"><span class="number">3</span>) &quot;D&quot;</span><br><span class="line"><span class="number">4</span>) &quot;B&quot;</span><br><span class="line"><span class="number">5</span>) &quot;E&quot;</span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span><span class="operator">&gt;</span> sdiff set01 set02</span><br><span class="line"><span class="number">1</span>) &quot;A&quot;</span><br><span class="line"><span class="number">2</span>) &quot;D&quot;</span><br></pre></td></tr></table></figure></li>
</ol>
<h3 id="æ•°æ®ç»“æ„-2"><a href="#æ•°æ®ç»“æ„-2" class="headerlink" title="æ•°æ®ç»“æ„"></a>æ•°æ®ç»“æ„</h3><p>Set æ•°æ®ç»“æ„æ˜¯ dict å­—å…¸ï¼Œå­—å…¸æ˜¯ç”¨å“ˆå¸Œè¡¨å®ç°çš„ã€‚</p>
<p>â€‹		Javaä¸­ HashSet çš„å†…éƒ¨å®ç°ä½¿ç”¨çš„æ˜¯ HashMapï¼Œåªä¸è¿‡æ‰€æœ‰çš„ value éƒ½æŒ‡å‘åŒä¸€ä¸ªå¯¹è±¡ã€‚Redis çš„ Set ç»“æ„ä¹Ÿæ˜¯ä¸€æ ·ï¼Œå®ƒçš„å†…éƒ¨ä¹Ÿä½¿ç”¨ hash ç»“æ„ï¼Œæ‰€æœ‰çš„ value éƒ½æŒ‡å‘åŒä¸€ä¸ªå†…éƒ¨å€¼ã€‚</p>
<h2 id="Rediså“ˆå¸Œï¼ˆHashï¼‰"><a href="#Rediså“ˆå¸Œï¼ˆHashï¼‰" class="headerlink" title="Rediså“ˆå¸Œï¼ˆHashï¼‰"></a>Rediså“ˆå¸Œï¼ˆHashï¼‰</h2><h3 id="ç®€ä»‹-3"><a href="#ç®€ä»‹-3" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h3><p>Redis hash æ˜¯ä¸€ä¸ªé”®å€¼å¯¹é›†åˆã€‚</p>
<p>Redis hash æ˜¯ä¸€ä¸ª String ç±»å‹çš„ field å’Œ value çš„æ˜ å°„è¡¨ï¼Œ<mark>hashç‰¹åˆ«é€‚åˆç”¨äºå­˜å‚¨å¯¹è±¡ã€‚</mark></p>
<p>ç±»ä¼¼ Java é‡Œé¢çš„ Map&lt;String, Object&gt;</p>
<h3 id="å¸¸ç”¨å‘½ä»¤-3"><a href="#å¸¸ç”¨å‘½ä»¤-3" class="headerlink" title="å¸¸ç”¨å‘½ä»¤"></a>å¸¸ç”¨å‘½ä»¤</h3><ol>
<li><p>hset <key><field><value>    ç»™<key>é›†åˆä¸­çš„ <field>é”®èµ‹å€¼<value></value></field></key></value></field></key></p>
</li>
<li><p>hget <key1><field>                 ä»<key1>é›†åˆ<field>å–å‡º value </field></key1></field></key1></p>
</li>
<li><p>hmset <key1><field1><value1><field2><value2>                æ‰¹é‡è®¾ç½®hashçš„å€¼</value2></field2></value1></field1></key1></p>
</li>
<li><p>hexists<key1><field>             æŸ¥çœ‹å“ˆå¸Œè¡¨ key ä¸­ï¼Œç»™å®šåŸŸ field æ˜¯å¦å­˜åœ¨ã€‚ </field></key1></p>
</li>
<li><p>hkeys <key>                               åˆ—å‡ºè¯¥hashé›†åˆçš„æ‰€æœ‰field</key></p>
</li>
<li><p>hvals <key>                                åˆ—å‡ºè¯¥hashé›†åˆçš„æ‰€æœ‰value</key></p>
 <figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span><span class="operator">&gt;</span> hset hash01 id <span class="number">1</span></span><br><span class="line">(<span class="type">integer</span>) <span class="number">1</span></span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span><span class="operator">&gt;</span> hget hash01 id</span><br><span class="line">&quot;1&quot;</span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span><span class="operator">&gt;</span> hmset hash02 name tom age <span class="number">12</span> gender man</span><br><span class="line">OK</span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span><span class="operator">&gt;</span> hexists hash02 birth</span><br><span class="line">(<span class="type">integer</span>) <span class="number">0</span></span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span><span class="operator">&gt;</span> hkeys hash02</span><br><span class="line"><span class="number">1</span>) &quot;name&quot;</span><br><span class="line"><span class="number">2</span>) &quot;age&quot;</span><br><span class="line"><span class="number">3</span>) &quot;gender&quot;</span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span><span class="operator">&gt;</span> hvals hash02</span><br><span class="line"><span class="number">1</span>) &quot;tom&quot;</span><br><span class="line"><span class="number">2</span>) &quot;12&quot;</span><br><span class="line"><span class="number">3</span>) &quot;man&quot;</span><br></pre></td></tr></table></figure>
</li>
<li><p>hincrby <key><field><increment>      ä¸ºå“ˆå¸Œè¡¨ key ä¸­çš„åŸŸ field çš„å€¼åŠ ä¸Šå¢é‡ 1  -1</increment></field></key></p>
 <figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span><span class="operator">&gt;</span> hget hash02 age</span><br><span class="line">&quot;12&quot;</span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span><span class="operator">&gt;</span> hincrby hash02 age <span class="number">2</span></span><br><span class="line">(<span class="type">integer</span>) <span class="number">14</span></span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span><span class="operator">&gt;</span> hget hash02 age</span><br><span class="line">&quot;14&quot;</span><br></pre></td></tr></table></figure>
</li>
<li><p>hsetnx <key><field><value>                å°†å“ˆå¸Œè¡¨ key ä¸­çš„åŸŸ field çš„å€¼è®¾ç½®ä¸º value ï¼Œå½“ä¸”ä»…å½“åŸŸ field ä¸å­˜åœ¨ã€‚</value></field></key></p>
 <figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span><span class="operator">&gt;</span> hkeys hash02</span><br><span class="line"><span class="number">1</span>) &quot;name&quot;</span><br><span class="line"><span class="number">2</span>) &quot;age&quot;</span><br><span class="line"><span class="number">3</span>) &quot;gender&quot;</span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span><span class="operator">&gt;</span> hsetnx hash02 age <span class="number">10</span></span><br><span class="line">(<span class="type">integer</span>) <span class="number">0</span></span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span><span class="operator">&gt;</span> hsetnx hash02 birth <span class="number">1997</span><span class="operator">/</span><span class="number">01</span><span class="operator">/</span><span class="number">20</span></span><br><span class="line">(<span class="type">integer</span>) <span class="number">1</span></span><br></pre></td></tr></table></figure></li>
</ol>
<h3 id="æ•°æ®ç»“æ„-3"><a href="#æ•°æ®ç»“æ„-3" class="headerlink" title="æ•°æ®ç»“æ„"></a>æ•°æ®ç»“æ„</h3><p>â€‹		Hashç±»å‹å¯¹åº”çš„æ•°æ®ç»“æ„æ˜¯ä¸¤ç§ï¼šziplistï¼ˆå‹ç¼©åˆ—è¡¨ï¼‰ï¼Œhashtableï¼ˆå“ˆå¸Œè¡¨ï¼‰ã€‚å½“ field-value é•¿åº¦è¾ƒçŸ­ä¸”ä¸ªæ•°è¾ƒå°‘æ—¶ï¼Œä½¿ç”¨ziplistï¼Œå¦åˆ™ä½¿ç”¨hashtableã€‚</p>
<h2 id="Redisæœ‰åºé›†åˆZsetï¼ˆSorted-setï¼‰"><a href="#Redisæœ‰åºé›†åˆZsetï¼ˆSorted-setï¼‰" class="headerlink" title="Redisæœ‰åºé›†åˆZsetï¼ˆSorted setï¼‰"></a>Redisæœ‰åºé›†åˆZsetï¼ˆSorted setï¼‰</h2><h3 id="ç®€ä»‹-4"><a href="#ç®€ä»‹-4" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h3><p>Redis æœ‰åºé›†åˆ Sorted Set ä¸æ™®é€šé›†åˆ set éå¸¸ç›¸ä¼¼ï¼Œæ˜¯ä¸€ä¸ªæ²¡æœ‰é‡å¤å…ƒç´ çš„å­—ç¬¦ä¸²é›†åˆã€‚</p>
<p>ä¸åŒä¹‹å¤„æ˜¯æœ‰åºé›†åˆçš„æ¯ä¸ªæˆå‘˜éƒ½å…³è”äº†ä¸€ä¸ª<strong>è¯„åˆ†ï¼ˆscoreï¼‰</strong>ï¼Œè¿™ä¸ªè¯„åˆ†ï¼ˆscoreï¼‰è¢«ç”¨æ¥æŒ‰ç…§ä»æœ€ä½åˆ†åˆ°æœ€é«˜åˆ†çš„æ–¹å¼æ’åºé›†åˆä¸­çš„æˆå‘˜ã€‚é›†åˆçš„æˆå‘˜æ˜¯å”¯ä¸€çš„ï¼Œä½†æ˜¯è¯„åˆ†å¯ä»¥é‡å¤ ã€‚</p>
<p>å› ä¸ºå…ƒç´ æ˜¯æœ‰åºçš„ï¼Œ æ‰€ä»¥å¯ä»¥å¾ˆå¿«çš„æ ¹æ®è¯„åˆ†ï¼ˆscoreï¼‰æˆ–è€…æ¬¡åºï¼ˆpositionï¼‰æ¥è·å–ä¸€ä¸ªèŒƒå›´çš„å…ƒç´ ã€‚</p>
<p>è®¿é—®æœ‰åºé›†åˆçš„ä¸­é—´å…ƒç´ ä¹Ÿæ˜¯éå¸¸å¿«çš„ï¼Œå› æ­¤ä½ èƒ½å¤Ÿä½¿ç”¨æœ‰åºé›†åˆä½œä¸ºä¸€ä¸ªæ²¡æœ‰é‡å¤æˆå‘˜çš„æ™ºèƒ½åˆ—è¡¨ã€‚</p>
<h3 id="å¸¸ç”¨å‘½ä»¤-4"><a href="#å¸¸ç”¨å‘½ä»¤-4" class="headerlink" title="å¸¸ç”¨å‘½ä»¤"></a>å¸¸ç”¨å‘½ä»¤</h3><ol>
<li><p>zadd <key><score1><value1><score2><value2></value2></score2></value1></score1></key></p>
<p> å°†ä¸€ä¸ªæˆ–å¤šä¸ª member å…ƒç´ åŠå…¶ score å€¼åŠ å…¥åˆ°æœ‰åºé›† key å½“ä¸­ã€‚</p>
</li>
<li><p><strong>zrange <key><start><stop></stop> [WITHSCORES]</start></key></strong>  </p>
<p> è¿”å›æœ‰åºé›† key ä¸­ï¼Œ<mark>ä¸‹æ ‡åœ¨<start><stop></stop>ä¹‹é—´çš„å…ƒç´ </start></mark>ï¼Œå¸¦WITHSCORESï¼Œå¯ä»¥è®©åˆ†æ•°ä¸€èµ·å’Œå€¼è¿”å›åˆ°ç»“æœé›†ã€‚</p>
 <figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span><span class="operator">&gt;</span> zadd zset01 <span class="number">30</span> A <span class="number">40</span> B <span class="number">10</span> C</span><br><span class="line">(<span class="type">integer</span>) <span class="number">3</span></span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span><span class="operator">&gt;</span> zrange zset01 <span class="number">0</span> <span class="number">-1</span></span><br><span class="line"><span class="number">1</span>) &quot;C&quot;</span><br><span class="line"><span class="number">2</span>) &quot;A&quot;</span><br><span class="line"><span class="number">3</span>) &quot;B&quot;</span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span><span class="operator">&gt;</span> zrange zset01 <span class="number">0</span> <span class="number">-1</span> withscores</span><br><span class="line"><span class="number">1</span>) &quot;C&quot;</span><br><span class="line"><span class="number">2</span>) &quot;10&quot;</span><br><span class="line"><span class="number">3</span>) &quot;A&quot;</span><br><span class="line"><span class="number">4</span>) &quot;30&quot;</span><br><span class="line"><span class="number">5</span>) &quot;B&quot;</span><br><span class="line"><span class="number">6</span>) &quot;40&quot;</span><br></pre></td></tr></table></figure>
</li>
<li><p>zrangebyscore key minmax [withscores] [limit offset count]</p>
<p> è¿”å›æœ‰åºé›† key ä¸­ï¼Œ<mark>æ‰€æœ‰ score å€¼ä»‹äº min å’Œ max ä¹‹é—´</mark>ï¼ˆåŒ…æ‹¬ç­‰äº min æˆ– max ï¼‰æˆå‘˜ã€‚æœ‰åºé›†æˆå‘˜æŒ‰ score å€¼é€’å¢ï¼ˆä»å°åˆ°å¤§ï¼‰æ¬¡åºæ’åˆ—ã€‚ </p>
</li>
<li><p>zrevrangebyscore key maxmin [withscores] [limit offset count]      åŒä¸Šï¼Œæ”¹ä¸ºä»å¤§åˆ°å°æ’åˆ—ã€‚ </p>
 <figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span><span class="operator">&gt;</span> zrangebyscore zset01 <span class="number">20</span> <span class="number">40</span> withscores</span><br><span class="line"><span class="number">1</span>) &quot;A&quot;</span><br><span class="line"><span class="number">2</span>) &quot;30&quot;</span><br><span class="line"><span class="number">3</span>) &quot;B&quot;</span><br><span class="line"><span class="number">4</span>) &quot;40&quot;</span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span><span class="operator">&gt;</span> zrevrangebyscore zset01 <span class="number">30</span> <span class="number">10</span>  withscores</span><br><span class="line"><span class="number">1</span>) &quot;A&quot;</span><br><span class="line"><span class="number">2</span>) &quot;30&quot;</span><br><span class="line"><span class="number">3</span>) &quot;C&quot;</span><br><span class="line"><span class="number">4</span>) &quot;10&quot;</span><br></pre></td></tr></table></figure>
</li>
<li><p>zincrby <key><increment><value>   ä¸ºå…ƒç´ çš„scoreåŠ ä¸Šå¢é‡</value></increment></key></p>
 <figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span><span class="operator">&gt;</span> zincrby zset01 <span class="number">10</span> B</span><br><span class="line">&quot;50&quot;</span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span><span class="operator">&gt;</span> zrange zset01 <span class="number">0</span> <span class="number">-1</span> withscores</span><br><span class="line"><span class="number">1</span>) &quot;C&quot;</span><br><span class="line"><span class="number">2</span>) &quot;10&quot;</span><br><span class="line"><span class="number">3</span>) &quot;A&quot;</span><br><span class="line"><span class="number">4</span>) &quot;30&quot;</span><br><span class="line"><span class="number">5</span>) &quot;B&quot;</span><br><span class="line"><span class="number">6</span>) &quot;50&quot;</span><br></pre></td></tr></table></figure>
</li>
<li><p>zcount <key><min><max>ç»Ÿè®¡è¯¥é›†åˆï¼Œåˆ†æ•°åŒºé—´å†…çš„å…ƒç´ ä¸ªæ•° </max></min></key></p>
</li>
<li><p>zrank <key><value>è¿”å›è¯¥å€¼åœ¨é›†åˆä¸­çš„æ’åï¼Œä»0å¼€å§‹ã€‚</value></key></p>
</li>
<li><p>zrem <key><value>åˆ é™¤è¯¥é›†åˆä¸‹ï¼ŒæŒ‡å®šå€¼çš„å…ƒç´ </value></key></p>
 <figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span><span class="operator">&gt;</span> zcount zset01 <span class="number">10</span> <span class="number">50</span></span><br><span class="line">(<span class="type">integer</span>) <span class="number">3</span></span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span><span class="operator">&gt;</span> zrank zset01 A</span><br><span class="line">(<span class="type">integer</span>) <span class="number">1</span></span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span><span class="operator">&gt;</span> zrem zset01 C</span><br><span class="line">(<span class="type">integer</span>) <span class="number">1</span></span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span><span class="operator">&gt;</span> zrange zset01 <span class="number">0</span> <span class="number">-1</span></span><br><span class="line"><span class="number">1</span>) &quot;A&quot;</span><br><span class="line"><span class="number">2</span>) &quot;B&quot;</span><br></pre></td></tr></table></figure></li>
</ol>
<h3 id="æ•°æ®ç»“æ„-4"><a href="#æ•°æ®ç»“æ„-4" class="headerlink" title="æ•°æ®ç»“æ„"></a>æ•°æ®ç»“æ„</h3><p>â€‹		SortedSetï¼ˆzsetï¼‰æ˜¯Redisæä¾›çš„ä¸€ä¸ªéå¸¸ç‰¹åˆ«çš„æ•°æ®ç»“æ„ï¼Œä¸€æ–¹é¢å®ƒç­‰ä»·äºJavaçš„æ•°æ®ç»“æ„Map&lt;String, Double&gt;ï¼Œå¯ä»¥ç»™æ¯ä¸€ä¸ªå…ƒç´ valueèµ‹äºˆä¸€ä¸ªæƒé‡scoreï¼Œå¦ä¸€æ–¹é¢å®ƒåˆç±»ä¼¼äºTreeSetï¼Œå†…éƒ¨çš„å…ƒç´ ä¼šæŒ‰ç…§æƒé‡scoreè¿›è¡Œæ’åºï¼Œå¯ä»¥å¾—åˆ°æ¯ä¸ªå…ƒç´ çš„åæ¬¡ï¼Œè¿˜å¯ä»¥é€šè¿‡scoreçš„èŒƒå›´æ¥è·å–å…ƒç´ çš„åˆ—è¡¨ã€‚</p>
<p>zset åº•å±‚ä½¿ç”¨äº†ä¸¤ä¸ªæ•°æ®ç»“æ„ï¼š</p>
<p>ï¼ˆ1ï¼‰hashï¼Œhashçš„ä½œç”¨å°±æ˜¯å…³è”å…ƒç´  value å’Œæƒé‡ scoreï¼Œä¿éšœå…ƒç´  value çš„å”¯ä¸€æ€§ï¼Œå¯ä»¥é€šè¿‡å…ƒç´ valueæ‰¾åˆ°ç›¸åº”çš„scoreå€¼ã€‚</p>
<p>ï¼ˆ2ï¼‰è·³è·ƒè¡¨ï¼Œ<mark>è·³è·ƒè¡¨çš„ç›®çš„åœ¨äºç»™å…ƒç´ valueæ’åºï¼Œæ ¹æ®scoreçš„èŒƒå›´è·å–å…ƒç´ åˆ—è¡¨ã€‚</mark></p>
<h3 id="è·³è·ƒè¡¨"><a href="#è·³è·ƒè¡¨" class="headerlink" title="è·³è·ƒè¡¨"></a>è·³è·ƒè¡¨</h3><ol>
<li>ç®€ä»‹</li>
</ol>
<p>â€‹		æœ‰åºé›†åˆåœ¨ç”Ÿæ´»ä¸­æ¯”è¾ƒå¸¸è§ï¼Œä¾‹å¦‚æ ¹æ®æˆç»©å¯¹å­¦ç”Ÿæ’åï¼Œæ ¹æ®å¾—åˆ†å¯¹ç©å®¶æ’åç­‰ã€‚å¯¹äºæœ‰åºé›†åˆçš„åº•å±‚å®ç°ï¼Œå¯ä»¥ç”¨æ•°ç»„ã€å¹³è¡¡æ ‘ã€é“¾è¡¨ç­‰ã€‚æ•°ç»„ä¸ä¾¿å…ƒç´ çš„æ’å…¥ã€åˆ é™¤ï¼›å¹³è¡¡æ ‘æˆ–çº¢é»‘æ ‘è™½ç„¶æ•ˆç‡é«˜ä½†ç»“æ„å¤æ‚ï¼›é“¾è¡¨æŸ¥è¯¢éœ€è¦éå†æ‰€æœ‰æ•ˆç‡ä½ã€‚Redisé‡‡ç”¨çš„æ˜¯è·³è·ƒè¡¨ã€‚è·³è·ƒè¡¨æ•ˆç‡å ªæ¯”çº¢é»‘æ ‘ï¼Œå®ç°è¿œæ¯”çº¢é»‘æ ‘ç®€å•ã€‚</p>
<ol start="2">
<li>å®ä¾‹</li>
</ol>
<p>â€‹		å¯¹æ¯”æœ‰åºé“¾è¡¨å’Œè·³è·ƒè¡¨ï¼Œä»é“¾è¡¨ä¸­æŸ¥è¯¢å‡º51ã€‚</p>
<p>â€‹	2.1 æœ‰åºé“¾è¡¨</p>
<p><img src="/2023/02/28/Redis/Java\Document\Redis\Redis.assets\image-20220513110841045.png" alt="image-20220513110841045"></p>
<p>â€‹		è¦æŸ¥æ‰¾å€¼ä¸º51çš„å…ƒç´ ï¼Œéœ€è¦ä»ç¬¬ä¸€ä¸ªå…ƒç´ å¼€å§‹ä¾æ¬¡æŸ¥æ‰¾ã€æ¯”è¾ƒæ‰èƒ½æ‰¾åˆ°ï¼Œå…±éœ€è¦6æ¬¡æ¯”è¾ƒã€‚</p>
<p>â€‹	2.2 è·³è·ƒè¡¨</p>
<p><img src="/2023/02/28/Redis/Java\Document\Redis\Redis.assets\image-20220513110851298.png" alt="image-20220513110851298"></p>
<ol>
<li>ä»ç¬¬2å±‚å¼€å§‹ï¼Œ1èŠ‚ç‚¹æ¯”51èŠ‚ç‚¹å°ï¼Œå‘åæ¯”è¾ƒã€‚</li>
<li>21èŠ‚ç‚¹æ¯”51èŠ‚ç‚¹å°ï¼Œç»§ç»­å‘åæ¯”è¾ƒï¼Œåé¢å°±æ˜¯NULLäº†ï¼Œæ‰€ä»¥ä»21èŠ‚ç‚¹å‘ä¸‹åˆ°ç¬¬1å±‚</li>
<li>åœ¨ç¬¬1å±‚ï¼Œ41èŠ‚ç‚¹æ¯”51èŠ‚ç‚¹å°ï¼Œç»§ç»­å‘åï¼Œ61èŠ‚ç‚¹æ¯”51èŠ‚ç‚¹å¤§ï¼Œæ‰€ä»¥ä»41å‘ä¸‹</li>
<li>åœ¨ç¬¬0å±‚ï¼Œ51èŠ‚ç‚¹ä¸ºè¦æŸ¥æ‰¾çš„èŠ‚ç‚¹ï¼ŒèŠ‚ç‚¹è¢«æ‰¾åˆ°ï¼Œå…±æŸ¥æ‰¾4æ¬¡ã€‚</li>
<li>ä»æ­¤å¯ä»¥çœ‹å‡ºè·³è·ƒè¡¨æ¯”æœ‰åºé“¾è¡¨æ•ˆç‡è¦é«˜ã€‚</li>
</ol>
<h1 id="Redis-é…ç½®æ–‡ä»¶ä»‹ç»"><a href="#Redis-é…ç½®æ–‡ä»¶ä»‹ç»" class="headerlink" title="Redis é…ç½®æ–‡ä»¶ä»‹ç»"></a>Redis é…ç½®æ–‡ä»¶ä»‹ç»</h1><p>&#x2F;etc&#x2F;redis.conf</p>
<h2 id="Unitså•ä½"><a href="#Unitså•ä½" class="headerlink" title="Unitså•ä½"></a>Unitså•ä½</h2><p>é…ç½®å¤§å°å•ä½ï¼Œå¼€å¤´å®šä¹‰äº†ä¸€äº›åŸºæœ¬çš„åº¦é‡å•ä½ï¼Œåªæ”¯æŒbytesï¼Œä¸æ”¯æŒbitï¼Œå¤§å°å†™ä¸æ•æ„Ÿã€‚</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"> 1  # Redis configuration file example.</span><br><span class="line"> 4  # started with the file path as first argument:</span><br><span class="line"> 6  # ./redis-server /path/to/redis.conf</span><br><span class="line"> 8  # Note on units: when memory size is needed, it is possible to specify</span><br><span class="line"> 9  # it in the usual form of 1k 5GB 4M and so forth:</span><br><span class="line">10  #</span><br><span class="line">11  # 1k =&gt; 1000 bytes</span><br><span class="line">12  # 1kb =&gt; 1024 bytes</span><br><span class="line">13  # 1m =&gt; 1000000 bytes</span><br><span class="line">14  # 1mb =&gt; 1024*1024 bytes</span><br><span class="line">15  # 1g =&gt; 1000000000 bytes</span><br><span class="line">16  # 1gb =&gt; 1024*1024*1024 bytes</span><br><span class="line">17  #</span><br><span class="line">18  # units are case insensitive so 1GB 1Gb 1gB are all the same.</span><br></pre></td></tr></table></figure>

<h2 id="INCLUDESåŒ…å«"><a href="#INCLUDESåŒ…å«" class="headerlink" title="INCLUDESåŒ…å«"></a>INCLUDESåŒ…å«</h2><p>å¼•å…¥å…¶ä»–é…ç½®</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">20	################################## INCLUDES ###################################</span><br><span class="line">21	</span><br><span class="line">22	# Include one or more other config files here.  This is useful if you</span><br><span class="line">23	# have a standard template that goes to all Redis servers but also need</span><br><span class="line">24	# to customize a few per-server settings.  Include files can include</span><br><span class="line">25	# other files, so use this wisely.</span><br><span class="line">26	#</span><br><span class="line">27	# Note that option &quot;include&quot; won&#x27;t be rewritten by command &quot;CONFIG REWRITE&quot;</span><br><span class="line">28	# from admin or Redis Sentinel. Since Redis always uses the last processed</span><br><span class="line">29	# line as value of a configuration directive, you&#x27;d better put includes</span><br><span class="line">30	# at the beginning of this file to avoid overwriting config change at runtime.</span><br><span class="line">31	#</span><br><span class="line">32	# If instead you are interested in using includes to override configuration</span><br><span class="line">33	# options, it is better to use include as the last line.</span><br><span class="line">34	#</span><br><span class="line">35	# include /path/to/local.conf</span><br><span class="line">36	# include /path/to/other.conf</span><br></pre></td></tr></table></figure>

<h2 id="ç½‘ç»œç›¸å…³é…ç½®"><a href="#ç½‘ç»œç›¸å…³é…ç½®" class="headerlink" title="ç½‘ç»œç›¸å…³é…ç½®"></a>ç½‘ç»œç›¸å…³é…ç½®</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"> 46	################################## NETWORK #####################################</span><br><span class="line"> 47	</span><br><span class="line"> 48	# By default, if no &quot;bind&quot; configuration directive is specified, Redis listens</span><br><span class="line"> 49	# for connections from all available network interfaces on the host machine.</span><br><span class="line"> 50	# It is possible to listen to just one or multiple selected interfaces using</span><br><span class="line"> 51	# the &quot;bind&quot; configuration directive, followed by one or more IP addresses.</span><br><span class="line"> 52	# Each address can be prefixed by &quot;-&quot;, which means that redis will not fail to</span><br><span class="line"> 53	# start if the address is not available. Being not available only refers to</span><br><span class="line"> 54	# addresses that does not correspond to any network interfece. Addresses that</span><br><span class="line"> 55	# are already in use will always fail, and unsupported protocols will always BE</span><br><span class="line"> 56	# silently skipped.</span><br><span class="line"> 57	#</span><br><span class="line"> 58	# Examples:</span><br><span class="line"> 59	#</span><br><span class="line"> 60	# bind 192.168.1.100 10.0.0.1     # listens on two specific IPv4 addresses</span><br><span class="line"> 61	# bind 127.0.0.1 ::1              # listens on loopback IPv4 and IPv6</span><br><span class="line"> 62	# bind * -::*                     # like the default, all available interfaces</span><br><span class="line"> 63	#</span><br><span class="line"> 64	# ~~~ WARNING ~~~ If the computer running Redis is directly exposed to the</span><br><span class="line"> 65	# internet, binding to all the interfaces is dangerous and will expose the</span><br><span class="line"> 66	# instance to everybody on the internet. So by default we uncomment the</span><br><span class="line"> 67	# following bind directive, that will force Redis to listen only on the</span><br><span class="line"> 68	# IPv4 and IPv6 (if available) loopback interface addresses (this means Redis</span><br><span class="line"> 69	# will only be able to accept client connections from the same host that it is</span><br><span class="line"> 70	# running on).</span><br><span class="line"> 71	#</span><br><span class="line"> 72	# IF YOU ARE SURE YOU WANT YOUR INSTANCE TO LISTEN TO ALL THE INTERFACES</span><br><span class="line"> 73	# JUST COMMENT OUT THE FOLLOWING LINE.</span><br><span class="line"> 74	# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span><br><span class="line"> 75	bind 127.0.0.1 -::1</span><br><span class="line"> 76	</span><br><span class="line"> 77	# Protected mode is a layer of security protection, in order to avoid that</span><br><span class="line"> 78	# Redis instances left open on the internet are accessed and exploited.</span><br><span class="line"> 79	#</span><br><span class="line"> 80	# When protected mode is on and if:</span><br><span class="line"> 81	#</span><br><span class="line"> 82	# 1) The server is not binding explicitly to a set of addresses using the</span><br><span class="line"> 83	#    &quot;bind&quot; directive.</span><br><span class="line"> 84	# 2) No password is configured.</span><br><span class="line"> 85	#</span><br><span class="line"> 86	# The server only accepts connections from clients connecting from the</span><br><span class="line"> 87	# IPv4 and IPv6 loopback addresses 127.0.0.1 and ::1, and from Unix domain</span><br><span class="line"> 88	# sockets.</span><br><span class="line"> 89	#</span><br><span class="line"> 90	# By default protected mode is enabled. You should disable it only if</span><br><span class="line"> 91	# you are sure you want clients from other hosts to connect to Redis</span><br><span class="line"> 92	# even if no authentication is configured, nor a specific set of interfaces</span><br><span class="line"> 93	# are explicitly listed using the &quot;bind&quot; directive.</span><br><span class="line"> 94	protected-mode yes</span><br><span class="line"> 95	</span><br><span class="line"> 96	# Accept connections on the specified port, default is 6379 (IANA #815344).</span><br><span class="line"> 97	# If port 0 is specified Redis will not listen on a TCP socket.</span><br><span class="line"> 98	port 6379</span><br><span class="line"> 99	</span><br><span class="line">100	# TCP listen() backlog.</span><br><span class="line">101	#</span><br><span class="line">102	# In high requests-per-second environments you need a high backlog in order</span><br><span class="line">103	# to avoid slow clients connection issues. Note that the Linux kernel</span><br><span class="line">104	# will silently truncate it to the value of /proc/sys/net/core/somaxconn so</span><br><span class="line">105	# make sure to raise both the value of somaxconn and tcp_max_syn_backlog</span><br><span class="line">106	# in order to get the desired effect.</span><br><span class="line">107	tcp-backlog 511</span><br><span class="line">108	</span><br><span class="line">109	# Unix socket.</span><br><span class="line">110	#</span><br><span class="line">111	# Specify the path for the Unix socket that will be used to listen for</span><br><span class="line">112	# incoming connections. There is no default, so Redis will not listen</span><br><span class="line">113	# on a unix socket when not specified.</span><br><span class="line">114	#</span><br><span class="line">115	# unixsocket /run/redis.sock</span><br><span class="line">116	# unixsocketperm 700</span><br><span class="line">117	</span><br><span class="line">118	# Close the connection after a client is idle for N seconds (0 to disable)</span><br><span class="line">119	timeout 0</span><br><span class="line">120	</span><br><span class="line">121	# TCP keepalive.</span><br><span class="line">122	#</span><br><span class="line">123	# If non-zero, use SO_KEEPALIVE to send TCP ACKs to clients in absence</span><br><span class="line">124	# of communication. This is useful for two reasons:</span><br><span class="line">125	#</span><br><span class="line">126	# 1) Detect dead peers.</span><br><span class="line">127	# 2) Force network equipment in the middle to consider the connection to be</span><br><span class="line">128	#    alive.</span><br><span class="line">129	#</span><br><span class="line">130	# On Linux, the specified value (in seconds) is the period used to send ACKs.</span><br><span class="line">131	# Note that to close the connection the double of the time is needed.</span><br><span class="line">132	# On other kernels the period depends on the kernel configuration.</span><br><span class="line">133	#</span><br><span class="line">134	# A reasonable value for this option is 300 seconds, which is the new</span><br><span class="line">135	# Redis default starting with Redis 3.2.1.</span><br><span class="line">136	tcp-keepalive 300</span><br></pre></td></tr></table></figure>

<h3 id="bind"><a href="#bind" class="headerlink" title="bind"></a>bind</h3><p>é»˜è®¤æƒ…å†µ bind&#x3D;127.0.0.1 åªèƒ½æ¥å—æœ¬æœºçš„è®¿é—®è¯·æ±‚ï¼Œä¸å†™çš„æƒ…å†µä¸‹ï¼Œæ— é™åˆ¶æ¥å—ä»»ä½•ipåœ°å€çš„è®¿é—®ã€‚</p>
<p>ç”Ÿäº§ç¯å¢ƒè‚¯å®šè¦å†™åº”ç”¨æœåŠ¡å™¨çš„åœ°å€ï¼›æœåŠ¡å™¨æ˜¯éœ€è¦è¿œç¨‹è®¿é—®çš„ï¼Œæ‰€ä»¥éœ€è¦å°†å…¶æ³¨é‡Šæ‰ã€‚</p>
<p>å¦‚æœå¼€å¯äº† protected-modeï¼Œé‚£ä¹ˆåœ¨æ²¡æœ‰è®¾å®š bind ipä¸”æ²¡æœ‰è®¾å¯†ç çš„æƒ…å†µä¸‹ï¼ŒRedisåªå…è®¸æ¥å—æœ¬æœºçš„å“åº”ã€‚</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@localhost bin]# ps -ef |grep redis|grep -v grep</span><br><span class="line">root      97989      1  0 09:43 ?        00:00:31 redis-server 127.0.0.1:6379</span><br></pre></td></tr></table></figure>

<p>æ³¨é‡Šæ‰bind</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@localhost bin]# redis-server /etc/redis.conf</span><br><span class="line">[root@localhost bin]# ps -ef |grep redis|grep -v grep</span><br><span class="line">root      99498      1  0 11:39 ?        00:00:00 redis-server *:6379</span><br></pre></td></tr></table></figure>

<h3 id="protected-mode"><a href="#protected-mode" class="headerlink" title="protected-mode"></a>protected-mode</h3><p>æœ¬æœºè®¿é—®ä¿æŠ¤æ¨¡å¼</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">protected-mode no</span><br></pre></td></tr></table></figure>

<h3 id="port"><a href="#port" class="headerlink" title="port"></a>port</h3><p>ç«¯å£é»˜è®¤6379</p>
<h3 id="tcp-backlog"><a href="#tcp-backlog" class="headerlink" title="tcp-backlog"></a>tcp-backlog</h3><p>è®¾ç½® tcp çš„ backlogï¼Œbacklog å…¶å®æ˜¯ä¸€ä¸ªè¿æ¥é˜Ÿåˆ—ï¼Œbacklog é˜Ÿåˆ—æ€»å’Œ &#x3D; æœªå®Œæˆä¸‰æ¬¡æ¡æ‰‹é˜Ÿåˆ— + å·²ç»å®Œæˆä¸‰æ¬¡æ¡æ‰‹é˜Ÿåˆ—ã€‚</p>
<p>åœ¨é«˜å¹¶å‘ç¯å¢ƒä¸‹ä½ éœ€è¦ä¸€ä¸ªé«˜ backlog å€¼æ¥é¿å…æ…¢å®¢æˆ·ç«¯è¿æ¥é—®é¢˜ã€‚</p>
<p>æ³¨æ„ Linux å†…æ ¸ä¼šå°†è¿™ä¸ªå€¼å‡å°åˆ° &#x2F;proc&#x2F;sys&#x2F;net&#x2F;core&#x2F;somaxconn çš„å€¼ï¼ˆ128ï¼‰ï¼Œæ‰€ä»¥éœ€è¦ç¡®è®¤å¢å¤§ &#x2F;proc&#x2F;sys&#x2F;net&#x2F;core&#x2F;somaxconn å’Œ &#x2F;proc&#x2F;sys&#x2F;net&#x2F;ipv4&#x2F;tcp_max_syn_backlogï¼ˆ128ï¼‰ä¸¤ä¸ªå€¼æ¥è¾¾åˆ°æƒ³è¦çš„æ•ˆæœ</p>
<h3 id="timeout"><a href="#timeout" class="headerlink" title="timeout"></a>timeout</h3><p>ä¸€ä¸ªç©ºé—²çš„å®¢æˆ·ç«¯ç»´æŒå¤šå°‘ç§’ä¼šå…³é—­ï¼Œ0è¡¨ç¤ºå…³é—­è¯¥åŠŸèƒ½ã€‚å³æ°¸ä¸å…³é—­ã€‚</p>
<h3 id="tcp-keepalive"><a href="#tcp-keepalive" class="headerlink" title="tcp-keepalive"></a>tcp-keepalive</h3><p>å¯¹è®¿é—®å®¢æˆ·ç«¯çš„ä¸€ç§å¿ƒè·³æ£€æµ‹ï¼Œæ¯éš” n ç§’æ£€æµ‹ä¸€æ¬¡ã€‚</p>
<p>å•ä½ä¸ºç§’ï¼Œå¦‚æœè®¾ç½®ä¸º0ï¼Œåˆ™ä¸ä¼šè¿›è¡ŒKeepaliveæ£€æµ‹ï¼Œå»ºè®®è®¾ç½®æˆ60 ã€‚</p>
<h2 id="GENERALé€šç”¨"><a href="#GENERALé€šç”¨" class="headerlink" title="GENERALé€šç”¨"></a>GENERALé€šç”¨</h2><h3 id="daemonize"><a href="#daemonize" class="headerlink" title="daemonize"></a>daemonize</h3><p>æ˜¯å¦ä¸ºåå°è¿›ç¨‹ï¼Œè®¾ç½®ä¸ºyes</p>
<h3 id="pidfile"><a href="#pidfile" class="headerlink" title="pidfile"></a>pidfile</h3><p>å­˜æ”¾pidæ–‡ä»¶çš„ä½ç½®ï¼Œæ¯ä¸ªå®ä¾‹ä¼šäº§ç”Ÿä¸€ä¸ªä¸åŒçš„pidæ–‡ä»¶</p>
<h3 id="loglevel"><a href="#loglevel" class="headerlink" title="loglevel"></a>loglevel</h3><p>æŒ‡å®šæ—¥å¿—è®°å½•çº§åˆ«ï¼ŒRedis æ€»å…±æ”¯æŒå››ä¸ªçº§åˆ«ï¼šdebugã€verboseã€noticeã€warningï¼Œé»˜è®¤ä¸º<strong>notice</strong></p>
<p>å››ä¸ªçº§åˆ«æ ¹æ®ä½¿ç”¨é˜¶æ®µæ¥é€‰æ‹©ï¼Œç”Ÿäº§ç¯å¢ƒé€‰æ‹©notice æˆ–è€…warning</p>
<h3 id="logfile"><a href="#logfile" class="headerlink" title="logfile"></a>logfile</h3><p>æ—¥å¿—æ–‡ä»¶åç§°</p>
<h3 id="database-16"><a href="#database-16" class="headerlink" title="database  16"></a>database  16</h3><p>è®¾å®šåº“çš„æ•°é‡ é»˜è®¤16ï¼Œé»˜è®¤æ•°æ®åº“ä¸º0ï¼Œå¯ä»¥ä½¿ç”¨SELECT <dbid>å‘½ä»¤åœ¨è¿æ¥ä¸ŠæŒ‡å®šæ•°æ®åº“id</dbid></p>
<h2 id="SECURITYå®‰å…¨"><a href="#SECURITYå®‰å…¨" class="headerlink" title="SECURITYå®‰å…¨"></a>SECURITYå®‰å…¨</h2><h3 id="è®¾ç½®å¯†ç "><a href="#è®¾ç½®å¯†ç " class="headerlink" title="è®¾ç½®å¯†ç "></a>è®¾ç½®å¯†ç </h3><p>è®¿é—®å¯†ç çš„æŸ¥çœ‹ã€è®¾ç½®å’Œå–æ¶ˆ</p>
<p>åœ¨å‘½ä»¤ä¸­è®¾ç½®å¯†ç ï¼Œåªæ˜¯ä¸´æ—¶çš„ã€‚é‡å¯ redis æœåŠ¡å™¨ï¼Œå¯†ç å°±è¿˜åŸäº†ã€‚</p>
<p>æ°¸ä¹…è®¾ç½®ï¼Œéœ€è¦å†é…ç½®æ–‡ä»¶ä¸­è¿›è¡Œè®¾ç½®ã€‚</p>
<h2 id="LIMITé™åˆ¶"><a href="#LIMITé™åˆ¶" class="headerlink" title="LIMITé™åˆ¶"></a>LIMITé™åˆ¶</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">946 ############################## MEMORY MANAGEMENT ################################</span><br><span class="line"> 947</span><br><span class="line"> 948 # Set a memory usage limit to the specified amount of bytes.</span><br><span class="line"> 949 # When the memory limit is reached Redis will try to remove keys</span><br><span class="line"> 950 # according to the eviction policy selected (see maxmemory-policy).</span><br><span class="line"> 951 #</span><br><span class="line"> 952 # If Redis can&#x27;t remove keys according to the policy, or if the policy is</span><br><span class="line"> 953 # set to &#x27;noeviction&#x27;, Redis will start to reply with errors to commands</span><br><span class="line"> 954 # that would use more memory, like SET, LPUSH, and so on, and will continue</span><br><span class="line"> 955 # to reply to read-only commands like GET.</span><br><span class="line"> 956 #</span><br><span class="line"> 957 # This option is usually useful when using Redis as an LRU or LFU cache, or to</span><br><span class="line"> 958 # set a hard memory limit for an instance (using the &#x27;noeviction&#x27; policy).</span><br><span class="line"> 959 #</span><br><span class="line"> 960 # WARNING: If you have replicas attached to an instance with maxmemory on,</span><br><span class="line"> 961 # the size of the output buffers needed to feed the replicas are subtracted</span><br><span class="line"> 962 # from the used memory count, so that network problems / resyncs will</span><br><span class="line"> 963 # not trigger a loop where keys are evicted, and in turn the output</span><br><span class="line"> 964 # buffer of replicas is full with DELs of keys evicted triggering the deletion</span><br><span class="line"> 965 # of more keys, and so forth until the database is completely emptied.</span><br><span class="line"> 966 #</span><br><span class="line"> 967 # In short... if you have replicas attached it is suggested that you set a lower</span><br><span class="line"> 968 # limit for maxmemory so that there is some free RAM on the system for replica</span><br><span class="line"> 969 # output buffers (but this is not needed if the policy is &#x27;noeviction&#x27;).</span><br><span class="line"> 970 #</span><br><span class="line"> 971 # maxmemory &lt;bytes&gt;</span><br><span class="line"> 972</span><br><span class="line"> 973 # MAXMEMORY POLICY: how Redis will select what to remove when maxmemory</span><br><span class="line"> 974 # is reached. You can select one from the following behaviors:</span><br><span class="line"> 975 #</span><br><span class="line"> 976 # volatile-lru -&gt; Evict using approximated LRU, only keys with an expire set.</span><br><span class="line"> 977 # allkeys-lru -&gt; Evict any key using approximated LRU.</span><br><span class="line"> 978 # volatile-lfu -&gt; Evict using approximated LFU, only keys with an expire set.</span><br><span class="line"> 979 # allkeys-lfu -&gt; Evict any key using approximated LFU.</span><br><span class="line"> 980 # volatile-random -&gt; Remove a random key having an expire set.</span><br><span class="line"> 981 # allkeys-random -&gt; Remove a random key, any key.</span><br><span class="line"> 982 # volatile-ttl -&gt; Remove the key with the nearest expire time (minor TTL)</span><br><span class="line"> 983 # noeviction -&gt; Don&#x27;t evict anything, just return an error on write operations.</span><br><span class="line"> 984 #</span><br><span class="line"> 985 # LRU means Least Recently Used</span><br><span class="line"> 986 # LFU means Least Frequently Used</span><br><span class="line"> 987 #</span><br><span class="line"> 988 # Both LRU, LFU and volatile-ttl are implemented using approximated</span><br><span class="line"> 989 # randomized algorithms.</span><br><span class="line"> 990 #</span><br><span class="line"> 991 # Note: with any of the above policies, when there are no suitable keys for</span><br><span class="line"> 992 # eviction, Redis will return an error on write operations that require</span><br><span class="line"> 993 # more memory. These are usually commands that create new keys, add data or</span><br><span class="line"> 994 # modify existing keys. A few examples are: SET, INCR, HSET, LPUSH, SUNIONSTORE,</span><br><span class="line"> 995 # SORT (due to the STORE argument), and EXEC (if the transaction includes any</span><br><span class="line"> 996 # command that requires memory).</span><br><span class="line"> 997 #</span><br><span class="line"> 998 # The default is:</span><br><span class="line"> 999 #</span><br><span class="line">1000 # maxmemory-policy noeviction</span><br><span class="line">1001</span><br><span class="line">1002 # LRU, LFU and minimal TTL algorithms are not precise algorithms but approximated</span><br><span class="line">1003 # algorithms (in order to save memory), so you can tune it for speed or</span><br><span class="line">1004 # accuracy. By default Redis will check five keys and pick the one that was</span><br><span class="line">1005 # used least recently, you can change the sample size using the following</span><br><span class="line">1006 # configuration directive.</span><br><span class="line">1007 #</span><br><span class="line">1008 # The default of 5 produces good enough results. 10 Approximates very closely</span><br><span class="line">1009 # true LRU but costs more CPU. 3 is faster but not very accurate.</span><br><span class="line">1010 #</span><br><span class="line">1011 # maxmemory-samples 5</span><br><span class="line">1012</span><br><span class="line">1013 # Eviction processing is designed to function well with the default setting.</span><br><span class="line">1014 # If there is an unusually large amount of write traffic, this value may need to</span><br><span class="line">1015 # be increased.  Decreasing this value may reduce latency at the risk of</span><br><span class="line">1016 # eviction processing effectiveness</span><br><span class="line">1017 #   0 = minimum latency, 10 = default, 100 = process without regard to latency</span><br><span class="line">1018 #</span><br><span class="line">1019 # maxmemory-eviction-tenacity 10</span><br><span class="line">1020</span><br><span class="line">1021 # Starting from Redis 5, by default a replica will ignore its maxmemory setting</span><br><span class="line">1022 # (unless it is promoted to master after a failover or manually). It means</span><br><span class="line">1023 # that the eviction of keys will be just handled by the master, sending the</span><br><span class="line">1024 # DEL commands to the replica as keys evict in the master side.</span><br></pre></td></tr></table></figure>

<h3 id="maxclients"><a href="#maxclients" class="headerlink" title="maxclients"></a>maxclients</h3><ol>
<li>è®¾ç½® redis åŒæ—¶å¯ä»¥ä¸å¤šå°‘ä¸ªå®¢æˆ·ç«¯è¿›è¡Œè¿æ¥ã€‚</li>
<li>é»˜è®¤æƒ…å†µä¸‹ä¸º 10000 ä¸ªå®¢æˆ·ç«¯ã€‚</li>
<li>å¦‚æœè¾¾åˆ°äº†æ­¤é™åˆ¶ï¼Œredis åˆ™ä¼šæ‹’ç»æ–°çš„è¿æ¥è¯·æ±‚ï¼Œå¹¶ä¸”å‘è¿™äº›è¿æ¥è¯·æ±‚æ–¹å‘å‡º â€œmax number of clients reachedâ€ ä»¥ä½œå›åº”ã€‚</li>
</ol>
<h3 id="maxmemory"><a href="#maxmemory" class="headerlink" title="maxmemory"></a>maxmemory</h3><ol>
<li><p>å»ºè®®<strong>å¿…é¡»è®¾ç½®</strong>ï¼Œå¦åˆ™ï¼Œå°†å†…å­˜å æ»¡ï¼Œé€ æˆæœåŠ¡å™¨å®•æœº</p>
</li>
<li><p>è®¾ç½® redis å¯ä»¥ä½¿ç”¨çš„å†…å­˜é‡ã€‚ä¸€æ—¦åˆ°è¾¾å†…å­˜ä½¿ç”¨ä¸Šé™ï¼Œredis å°†ä¼šè¯•å›¾ç§»é™¤å†…éƒ¨æ•°æ®ï¼Œç§»é™¤è§„åˆ™å¯ä»¥é€šè¿‡maxmemory-policy æ¥æŒ‡å®šã€‚</p>
</li>
<li><p>å¦‚æœ redis æ— æ³•æ ¹æ®ç§»é™¤è§„åˆ™æ¥ç§»é™¤å†…å­˜ä¸­çš„æ•°æ®ï¼Œæˆ–è€…è®¾ç½®äº†â€œä¸å…è®¸ç§»é™¤â€ï¼Œé‚£ä¹ˆ redis åˆ™ä¼šé’ˆå¯¹é‚£äº›éœ€è¦ç”³è¯·å†…å­˜çš„æŒ‡ä»¤è¿”å›é”™è¯¯ä¿¡æ¯ï¼Œæ¯”å¦‚ SETã€LPUSH ç­‰ã€‚</p>
</li>
<li><p>ä½†æ˜¯å¯¹äºæ— å†…å­˜ç”³è¯·çš„æŒ‡ä»¤ï¼Œä»ç„¶ä¼šæ­£å¸¸å“åº”ï¼Œæ¯”å¦‚ GET ç­‰ã€‚å¦‚æœä½ çš„ redis æ˜¯ä¸» redisï¼ˆè¯´æ˜ä½ çš„redisæœ‰ä»redisï¼‰ï¼Œé‚£ä¹ˆåœ¨è®¾ç½®å†…å­˜ä½¿ç”¨ä¸Šé™æ—¶ï¼Œéœ€è¦åœ¨ç³»ç»Ÿä¸­ç•™å‡ºä¸€äº›å†…å­˜ç©ºé—´ç»™åŒæ­¥é˜Ÿåˆ—ç¼“å­˜ï¼Œåªæœ‰åœ¨ä½ è®¾ç½®çš„æ˜¯â€œä¸ç§»é™¤â€çš„æƒ…å†µä¸‹ï¼Œæ‰ä¸ç”¨è€ƒè™‘è¿™ä¸ªå› ç´ ã€‚</p>
</li>
</ol>
<h3 id="maxmemory-policy"><a href="#maxmemory-policy" class="headerlink" title="maxmemory-policy"></a>maxmemory-policy</h3><ol>
<li>volatile-lruï¼šä½¿ç”¨ LRU ç®—æ³•ç§»é™¤ keyï¼Œåªå¯¹è®¾ç½®äº†è¿‡æœŸæ—¶é—´çš„é”®ï¼›ï¼ˆæœ€è¿‘æœ€å°‘ä½¿ç”¨ï¼‰</li>
<li>allkeys-lruï¼šåœ¨æ‰€æœ‰é›†åˆkeyä¸­ï¼Œä½¿ç”¨LRUç®—æ³•ç§»é™¤key</li>
<li>volatile-randomï¼šåœ¨è¿‡æœŸé›†åˆä¸­ç§»é™¤éšæœºçš„keyï¼Œåªå¯¹è®¾ç½®äº†è¿‡æœŸæ—¶é—´çš„é”®</li>
<li>allkeys-randomï¼šåœ¨æ‰€æœ‰é›†åˆkeyä¸­ï¼Œç§»é™¤éšæœºçš„key</li>
<li>volatile-ttlï¼šç§»é™¤é‚£äº›TTLå€¼æœ€å°çš„keyï¼Œå³é‚£äº›æœ€è¿‘è¦è¿‡æœŸçš„key</li>
<li>noevictionï¼šä¸è¿›è¡Œç§»é™¤ã€‚é’ˆå¯¹å†™æ“ä½œï¼Œåªæ˜¯è¿”å›é”™è¯¯ä¿¡æ¯</li>
</ol>
<h3 id="maxmemory-samples"><a href="#maxmemory-samples" class="headerlink" title="maxmemory-samples"></a>maxmemory-samples</h3><ol>
<li><p>è®¾ç½®æ ·æœ¬æ•°é‡ï¼ŒLRUç®—æ³•å’Œæœ€å°TTLç®—æ³•éƒ½å¹¶éæ˜¯ç²¾ç¡®çš„ç®—æ³•ï¼Œè€Œæ˜¯ä¼°ç®—å€¼ï¼Œæ‰€ä»¥ä½ å¯ä»¥è®¾ç½®æ ·æœ¬çš„å¤§å°ï¼Œredis é»˜è®¤ä¼šæ£€æŸ¥è¿™ä¹ˆå¤šä¸ª key å¹¶é€‰æ‹©å…¶ä¸­ LRU çš„é‚£ä¸ªã€‚</p>
</li>
<li><p>ä¸€èˆ¬è®¾ç½® 3 åˆ° 7 çš„æ•°å­—ï¼Œæ•°å€¼è¶Šå°æ ·æœ¬è¶Šä¸å‡†ç¡®ï¼Œä½†æ€§èƒ½æ¶ˆè€—è¶Šå°ã€‚</p>
</li>
</ol>
<h1 id="Redisçš„å‘å¸ƒå’Œè®¢é˜…"><a href="#Redisçš„å‘å¸ƒå’Œè®¢é˜…" class="headerlink" title="Redisçš„å‘å¸ƒå’Œè®¢é˜…"></a>Redisçš„å‘å¸ƒå’Œè®¢é˜…</h1><h2 id="å‘å¸ƒå’Œè®¢é˜…"><a href="#å‘å¸ƒå’Œè®¢é˜…" class="headerlink" title="å‘å¸ƒå’Œè®¢é˜…"></a>å‘å¸ƒå’Œè®¢é˜…</h2><p>Redis å‘å¸ƒè®¢é˜… (pub&#x2F;sub) æ˜¯ä¸€ç§æ¶ˆæ¯é€šä¿¡æ¨¡å¼ï¼šå‘é€è€… (pub) å‘é€æ¶ˆæ¯ï¼Œè®¢é˜…è€… (sub) æ¥æ”¶æ¶ˆæ¯ã€‚</p>
<p>Redis å®¢æˆ·ç«¯å¯ä»¥è®¢é˜…ä»»æ„æ•°é‡çš„é¢‘é“ã€‚</p>
<h2 id="Redisçš„å‘å¸ƒå’Œè®¢é˜…-1"><a href="#Redisçš„å‘å¸ƒå’Œè®¢é˜…-1" class="headerlink" title="Redisçš„å‘å¸ƒå’Œè®¢é˜…"></a>Redisçš„å‘å¸ƒå’Œè®¢é˜…</h2><ol>
<li><p>å®¢æˆ·ç«¯å¯ä»¥è®¢é˜…é¢‘é“å¦‚ä¸‹å›¾ï¼Œå½“ç»™è¿™ä¸ªé¢‘é“å‘å¸ƒæ¶ˆæ¯åï¼Œæ¶ˆæ¯å°±ä¼šå‘é€ç»™è®¢é˜…çš„å®¢æˆ·ç«¯ã€‚</p>
<p> <img src="/2023/02/28/Redis/Java\Document\Redis\Redis.assets\image-20220513115243769.png" alt="image-20220513115243769"></p>
</li>
<li><p>ç¤ºä¾‹</p>
<ol>
<li><p>æ‰“å¼€ä¸€ä¸ªå®¢æˆ·ç«¯è®¢é˜… channel1</p>
</li>
<li><p>æ‰“å¼€å¦ä¸€ä¸ªå®¢æˆ·ç«¯ï¼Œç»™channel1å‘å¸ƒæ¶ˆæ¯helloï¼Œè¿”å›çš„1æ˜¯è®¢é˜…è€…æ•°é‡</p>
</li>
<li><p>æ‰“å¼€ç¬¬ä¸€ä¸ªå®¢æˆ·ç«¯å¯ä»¥çœ‹åˆ°å‘é€çš„æ¶ˆæ¯</p>
</li>
<li><p>æ³¨æ„ï¼šå‘å¸ƒçš„æ¶ˆæ¯æ²¡æœ‰æŒä¹…åŒ–ï¼Œå¦‚æœåœ¨è®¢é˜…çš„å®¢æˆ·ç«¯æ”¶ä¸åˆ°helloï¼Œåªèƒ½æ”¶åˆ°è®¢é˜…åå‘å¸ƒçš„æ¶ˆæ¯</p>
</li>
</ol>
 <figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">127.0.0.1:6379&gt; subscribe channel01</span><br><span class="line">Reading messages... (press Ctrl-C to quit)</span><br><span class="line">1) &quot;subscribe&quot;</span><br><span class="line">2) &quot;channel01&quot;</span><br><span class="line">3) (integer) 1</span><br></pre></td></tr></table></figure>

 <figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@localhost ~]# redis-cli</span><br><span class="line">127.0.0.1:6379&gt; publish channel01 hello redis</span><br><span class="line">(error) ERR wrong number of arguments for &#x27;publish&#x27; command</span><br><span class="line">127.0.0.1:6379&gt; publish channel01 &quot;hello redis&quot;</span><br><span class="line">(integer) 1</span><br></pre></td></tr></table></figure>

 <figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">127.0.0.1:6379&gt; subscribe channel01</span><br><span class="line">Reading messages... (press Ctrl-C to quit)</span><br><span class="line">1) &quot;subscribe&quot;</span><br><span class="line">2) &quot;channel01&quot;</span><br><span class="line">3) (integer) 1</span><br><span class="line">1) &quot;message&quot;</span><br><span class="line">2) &quot;channel01&quot;</span><br><span class="line">3) &quot;hello redis&quot;</span><br></pre></td></tr></table></figure></li>
</ol>
<h1 id="Redisæ–°æ•°æ®ç±»å‹"><a href="#Redisæ–°æ•°æ®ç±»å‹" class="headerlink" title="Redisæ–°æ•°æ®ç±»å‹"></a>Redisæ–°æ•°æ®ç±»å‹</h1><h2 id="Bitmaps"><a href="#Bitmaps" class="headerlink" title="Bitmaps"></a>Bitmaps</h2><h3 id="ç®€ä»‹-5"><a href="#ç®€ä»‹-5" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h3><p>â€‹		ç°ä»£è®¡ç®—æœºç”¨äºŒè¿›åˆ¶ï¼ˆä½ï¼‰ ä½œä¸ºä¿¡æ¯çš„åŸºç¡€å•ä½ï¼Œ 1ä¸ªå­—èŠ‚ç­‰äº8ä½ï¼Œ ä¾‹å¦‚â€œabcâ€å­—ç¬¦ä¸²æ˜¯ç”±3ä¸ªå­—èŠ‚ç»„æˆï¼Œ ä½†å®é™…åœ¨è®¡ç®—æœºå­˜å‚¨æ—¶å°†å…¶ç”¨äºŒè¿›åˆ¶è¡¨ç¤ºï¼Œ â€œabcâ€åˆ†åˆ«å¯¹åº”çš„ASCIIç åˆ†åˆ«æ˜¯97ã€ 98ã€ 99ï¼Œ å¯¹åº”çš„äºŒè¿›åˆ¶åˆ†åˆ«æ˜¯01100001ã€ 01100010å’Œ01100011ï¼Œå¦‚ä¸‹å›¾ï¼š</p>
<img src="/2023/02/28/Redis/Java\Document\Redis\Redis.assets\image-20221009163649599.png" alt="image-20221009163649599" style="zoom:80%;">

<p>åˆç†åœ°ä½¿ç”¨æ“ä½œä½èƒ½å¤Ÿæœ‰æ•ˆåœ°æé«˜å†…å­˜ä½¿ç”¨ç‡å’Œå¼€å‘æ•ˆç‡ã€‚</p>
<p>Redisæä¾›äº†Bitmapsè¿™ä¸ªâ€œæ•°æ®ç±»å‹â€å¯ä»¥å®ç°å¯¹ä½çš„æ“ä½œï¼š</p>
<p>ï¼ˆ1ï¼‰  Bitmapsæœ¬èº«ä¸æ˜¯ä¸€ç§æ•°æ®ç±»å‹ï¼Œ å®é™…ä¸Šå®ƒå°±æ˜¯å­—ç¬¦ä¸²ï¼ˆkey-valueï¼‰ ï¼Œ ä½†æ˜¯å®ƒå¯ä»¥å¯¹å­—ç¬¦ä¸²çš„ä½è¿›è¡Œæ“ä½œã€‚</p>
<p>ï¼ˆ2ï¼‰  Bitmapså•ç‹¬æä¾›äº†ä¸€å¥—å‘½ä»¤ï¼Œ æ‰€ä»¥åœ¨Redisä¸­ä½¿ç”¨Bitmapså’Œä½¿ç”¨å­—ç¬¦ä¸²çš„æ–¹æ³•ä¸å¤ªç›¸åŒã€‚ å¯ä»¥æŠŠBitmapsæƒ³è±¡æˆä¸€ä¸ªä»¥ä½ä¸ºå•ä½çš„æ•°ç»„ï¼Œ æ•°ç»„çš„æ¯ä¸ªå•å…ƒåªèƒ½å­˜å‚¨0å’Œ1ï¼Œ æ•°ç»„çš„ä¸‹æ ‡åœ¨ Bitmaps ä¸­å«åšåç§»é‡ã€‚</p>
<h3 id="å‘½ä»¤"><a href="#å‘½ä»¤" class="headerlink" title="å‘½ä»¤"></a>å‘½ä»¤</h3><ol>
<li><p>setbit</p>
<p> â€‹	setbit<key><offset><value></value></offset></key></p>
<p> â€‹	è®¾ç½®Bitmapsä¸­æŸä¸ªåç§»é‡çš„å€¼ï¼ˆ0æˆ–1ï¼‰ï¼Œ*offsetï¼šåç§»é‡ä»0å¼€å§‹</p>
</li>
</ol>
<blockquote>
<p>ç¤ºä¾‹ï¼š</p>
<p>â€‹		æ¯ä¸ªç‹¬ç«‹ç”¨æˆ·æ˜¯å¦è®¿é—®è¿‡ç½‘ç«™å­˜æ”¾åœ¨Bitmapsä¸­ï¼Œ å°†è®¿é—®çš„ç”¨æˆ·è®°åš1ï¼Œ æ²¡æœ‰è®¿é—®çš„ç”¨æˆ·è®°åš0ï¼Œ ç”¨åç§»é‡ä½œä¸ºç”¨æˆ·çš„idã€‚è®¾ç½®é”®çš„ç¬¬offsetä¸ªä½çš„å€¼ï¼ˆä»0ç®—èµ·ï¼‰ ï¼Œ å‡è®¾ç°åœ¨æœ‰20ä¸ªç”¨æˆ·ï¼Œuserid&#x3D;1ï¼Œ 6ï¼Œ 11ï¼Œ 15ï¼Œ 19çš„ç”¨æˆ·å¯¹ç½‘ç«™è¿›è¡Œäº†è®¿é—®ï¼Œ é‚£ä¹ˆå½“å‰Bitmapsåˆå§‹åŒ–ç»“æœå¦‚å›¾ï¼š</p>
<img src="/2023/02/28/Redis/Java\Document\Redis\Redis.assets\image-20221009171946723.png" alt="image-20221009171946723" style="zoom:80%;">

<p>unique:users:20201106ä»£è¡¨2020-11-06è¿™å¤©çš„ç‹¬ç«‹è®¿é—®ç”¨æˆ·çš„Bitmaps</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">127.0.0.1:6379&gt; setbit unique:user:20220202 1 1</span><br><span class="line">(integer) 0</span><br><span class="line">127.0.0.1:6379&gt; setbit unique:user:20220202 6 1</span><br><span class="line">(integer) 0</span><br><span class="line">127.0.0.1:6379&gt; setbit unique:user:20220202 11 1</span><br><span class="line">(integer) 0</span><br><span class="line">127.0.0.1:6379&gt; setbit unique:user:20220202 15 1</span><br><span class="line">(integer) 0</span><br><span class="line">127.0.0.1:6379&gt; setbit unique:user:20220202 19 1</span><br><span class="line">(integer) 0</span><br></pre></td></tr></table></figure>

<p>æ³¨æ„ï¼š</p>
<p>â€‹		å¾ˆå¤šåº”ç”¨çš„ç”¨æˆ· id ä»¥ä¸€ä¸ªæŒ‡å®šæ•°å­—ï¼ˆä¾‹å¦‚10000ï¼‰ å¼€å¤´ï¼Œ ç›´æ¥å°†ç”¨æˆ· id å’Œ Bitmaps çš„åç§»é‡å¯¹åº”åŠ¿å¿…ä¼šé€ æˆä¸€å®šçš„æµªè´¹ï¼Œ é€šå¸¸çš„åšæ³•æ˜¯æ¯æ¬¡åš setbit æ“ä½œæ—¶å°†ç”¨æˆ· id å‡å»è¿™ä¸ªæŒ‡å®šæ•°å­—ã€‚</p>
<p>åœ¨ç¬¬ä¸€æ¬¡åˆå§‹åŒ–Bitmapsæ—¶ï¼Œ å‡å¦‚åç§»é‡éå¸¸å¤§ï¼Œ é‚£ä¹ˆæ•´ä¸ªåˆå§‹åŒ–è¿‡ç¨‹æ‰§è¡Œä¼šæ¯”è¾ƒæ…¢ï¼Œ å¯èƒ½ä¼šé€ æˆRedisçš„é˜»å¡ã€‚</p>
</blockquote>
<p>ï¼ˆ2ï¼‰getbit</p>
<p>â€‹		getbit<key><offset></offset></key></p>
<p>â€‹		è·å–Bitmapsä¸­æŸä¸ªåç§»é‡çš„å€¼ï¼ˆè·å–é”®çš„ç¬¬offsetä½çš„å€¼ï¼ˆä»0å¼€å§‹ç®—ï¼‰ï¼‰</p>
<blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">127.0.0.1:6379&gt; getbit unique:user:20220202 1</span><br><span class="line">(integer) 1</span><br><span class="line">127.0.0.1:6379&gt; getbit unique:user:20220202 3</span><br><span class="line">(integer) 0</span><br><span class="line">127.0.0.1:6379&gt; getbit unique:user:20220202 6</span><br><span class="line">(integer) 1</span><br></pre></td></tr></table></figure>
</blockquote>
<p>ï¼ˆ3ï¼‰bitcount</p>
<p>â€‹		bitcount<key>[start end] </key></p>
<p>â€‹		ç»Ÿè®¡å­—ç¬¦ä¸²<strong>ä» start å­—èŠ‚åˆ° end å­—èŠ‚</strong>æ¯”ç‰¹å€¼ä¸º1çš„æ•°é‡</p>
<blockquote>
<p>â€‹		ç»Ÿè®¡<strong>å­—ç¬¦ä¸²</strong>è¢«è®¾ç½®ä¸º1çš„bitæ•°ã€‚ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œç»™å®šçš„æ•´ä¸ªå­—ç¬¦ä¸²éƒ½ä¼šè¢«è¿›è¡Œè®¡æ•°ï¼Œé€šè¿‡æŒ‡å®šé¢å¤–çš„ start æˆ– end å‚æ•°ï¼Œå¯ä»¥è®©è®¡æ•°åªåœ¨ç‰¹å®šçš„ä½ä¸Šè¿›è¡Œã€‚start å’Œ end å‚æ•°çš„è®¾ç½®ï¼Œéƒ½å¯ä»¥ä½¿ç”¨è´Ÿæ•°å€¼ï¼šæ¯”å¦‚ -1 è¡¨ç¤ºæœ€åä¸€ä¸ªä½ï¼Œè€Œ -2 è¡¨ç¤ºå€’æ•°ç¬¬äºŒä¸ªä½ï¼Œstartã€end æ˜¯æŒ‡bitç»„çš„å­—èŠ‚çš„ä¸‹æ ‡æ•°ï¼ŒäºŒè€…çš†åŒ…å«ã€‚</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">127.0.0.1:6379&gt; bitcount unique:user:20220202</span><br><span class="line">(integer) 5</span><br><span class="line">127.0.0.1:6379&gt; bitcount unique:user:20220202 1 3</span><br><span class="line">(integer) 3</span><br></pre></td></tr></table></figure>

<p>start å’Œ end ä»£è¡¨èµ·å§‹å’Œç»“æŸå­—èŠ‚æ•°ï¼Œ ä¸‹é¢æ“ä½œè®¡ç®—ç”¨æˆ·idåœ¨ç¬¬1ä¸ªå­—èŠ‚åˆ°ç¬¬3ä¸ªå­—èŠ‚ä¹‹é—´çš„ç‹¬ç«‹è®¿é—®ç”¨æˆ·æ•°ï¼Œ å¯¹åº”çš„ç”¨æˆ·idæ˜¯11ï¼Œ 15ï¼Œ 19ã€‚</p>
<p>è¯´æ˜ï¼š</p>
<p>ä¸¾ä¾‹ï¼š K1 ã€01000001 01000000 00000000 00100001ã€‘ï¼Œå¯¹åº”ã€0ï¼Œ1ï¼Œ2ï¼Œ3ã€‘</p>
<p>bitcount K1 1 2 ï¼š ç»Ÿè®¡ä¸‹æ ‡1ã€2å­—èŠ‚ç»„ä¸­bit&#x3D;1çš„ä¸ªæ•°ï¼Œå³01000000 00000000  ç»“æœä¸º1</p>
<p>bitcount K1 1 3 ï¼š ç»Ÿè®¡ä¸‹æ ‡1ã€2å­—èŠ‚ç»„ä¸­bit&#x3D;1çš„ä¸ªæ•°ï¼Œå³01000000 00000000 00100001  ç»“æœä¸º3</p>
<p>bitcount K1 0 -2 ï¼š ç»Ÿè®¡ä¸‹æ ‡0åˆ°ä¸‹æ ‡å€’æ•°ç¬¬2ï¼Œå­—èŠ‚ç»„ä¸­bit&#x3D;1çš„ä¸ªæ•°ï¼Œå³01000001 01000000  00000000 ç»“æœä¸º3</p>
<p> æ³¨æ„ï¼šredisçš„setbitè®¾ç½®æˆ–æ¸…é™¤çš„æ˜¯bitä½ç½®ï¼Œè€Œbitcountè®¡ç®—çš„æ˜¯byteä½ç½®ã€‚</p>
</blockquote>
<p>ï¼ˆ4ï¼‰bitop</p>
<p>â€‹		bitop and(or&#x2F;not&#x2F;xor) <destkey> [keyâ€¦]</destkey></p>
<p>â€‹		bitopæ˜¯ä¸€ä¸ªå¤åˆæ“ä½œï¼Œ å®ƒå¯ä»¥åšå¤šä¸ªBitmapsçš„ <strong>andï¼ˆäº¤é›†ï¼‰ ã€ orï¼ˆå¹¶é›†ï¼‰ ã€ notï¼ˆéï¼‰ ã€ xorï¼ˆå¼‚æˆ–ï¼‰</strong> æ“ä½œå¹¶å°†ç»“æœä¿å­˜åœ¨destkeyä¸­ã€‚</p>
<blockquote>
<p>2022-02-02 æ—¥è®¿é—®ç½‘ç«™çš„userid&#x3D;1, 2, 5, 9ã€‚</p>
<p>setbit unique:users:20220202 1 1</p>
<p>setbit unique:users:20220202 2 1</p>
<p>setbit unique:users:20220202 5 1</p>
<p>setbit unique:users:20220202 9 1</p>
<p>2022-02-03 æ—¥è®¿é—®ç½‘ç«™çš„userid&#x3D;0, 1, 4, 9ã€‚</p>
<p>setbit unique:users:20220203 0 1</p>
<p>setbit unique:users:20220203 1 1</p>
<p>setbit unique:users:20220203 4 1</p>
<p>setbit unique:users:20220203 9 1</p>
<p>è®¡ç®—å‡ºä¸¤å¤©éƒ½è®¿é—®è¿‡ç½‘ç«™çš„ç”¨æˆ·æ•°é‡ï¼š</p>
<p>bitop	and	unique:users:and:20220202_03	unique:users:20220203	unique:users:20220202</p>
<p>è®¡ç®—å‡ºä»»æ„ä¸€å¤©éƒ½è®¿é—®è¿‡ç½‘ç«™çš„ç”¨æˆ·æ•°é‡ï¼ˆä¾‹å¦‚æœˆæ´»è·ƒå°±æ˜¯ç±»ä¼¼è¿™ç§ï¼‰ ï¼Œ å¯ä»¥ä½¿ç”¨oræ±‚å¹¶é›†</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">127.0.0.1:6379&gt; BITOP and unique:users:and:20220202_03 unique:users:20220203 unique:users:20220202</span><br><span class="line">(integer) 2</span><br><span class="line">127.0.0.1:6379&gt; BITOP or unique:users:and:20220202_03 unique:users:20220203 unique:users:20220202</span><br><span class="line">(integer) 2</span><br><span class="line">127.0.0.1:6379&gt;</span><br></pre></td></tr></table></figure>
</blockquote>
<h3 id="Bitmapsä¸setå¯¹æ¯”"><a href="#Bitmapsä¸setå¯¹æ¯”" class="headerlink" title="Bitmapsä¸setå¯¹æ¯”"></a>Bitmapsä¸setå¯¹æ¯”</h3><p>å‡è®¾ç½‘ç«™æœ‰1äº¿ç”¨æˆ·ï¼Œ æ¯å¤©ç‹¬ç«‹è®¿é—®çš„ç”¨æˆ·æœ‰5åƒä¸‡ï¼Œ å¦‚æœæ¯å¤©ç”¨é›†åˆç±»å‹å’ŒBitmapsåˆ†åˆ«å­˜å‚¨æ´»è·ƒç”¨æˆ·å¯ä»¥å¾—åˆ°è¡¨ï¼š</p>
<table>
<thead>
<tr>
<th>setå’ŒBitmapså­˜å‚¨ä¸€å¤©æ´»è·ƒç”¨æˆ·å¯¹æ¯”</th>
<th></th>
<th></th>
<th></th>
</tr>
</thead>
<tbody><tr>
<td>æ•°æ®  ç±»å‹</td>
<td>æ¯ä¸ªç”¨æˆ·idå ç”¨ç©ºé—´</td>
<td>éœ€è¦å­˜å‚¨çš„ç”¨æˆ·é‡</td>
<td>å…¨éƒ¨å†…å­˜é‡</td>
</tr>
<tr>
<td>é›†åˆ  ç±»å‹</td>
<td>64ä½</td>
<td>50000000</td>
<td>64ä½*50000000 &#x3D; 400MB</td>
</tr>
<tr>
<td>Bitmaps</td>
<td>1ä½</td>
<td>100000000</td>
<td>1ä½*100000000 &#x3D; 12.5MB</td>
</tr>
</tbody></table>
<p>å¾ˆæ˜æ˜¾ï¼Œ è¿™ç§æƒ…å†µä¸‹ä½¿ç”¨Bitmapsèƒ½èŠ‚çœå¾ˆå¤šçš„å†…å­˜ç©ºé—´ï¼Œ å°¤å…¶æ˜¯éšç€æ—¶é—´æ¨ç§»èŠ‚çœçš„å†…å­˜è¿˜æ˜¯éå¸¸å¯è§‚çš„ã€‚</p>
<table>
<thead>
<tr>
<th>setå’ŒBitmapså­˜å‚¨ç‹¬ç«‹ç”¨æˆ·ç©ºé—´å¯¹æ¯”</th>
<th></th>
<th></th>
<th></th>
</tr>
</thead>
<tbody><tr>
<td>æ•°æ®ç±»å‹</td>
<td>ä¸€å¤©</td>
<td>ä¸€ä¸ªæœˆ</td>
<td>ä¸€å¹´</td>
</tr>
<tr>
<td>é›†åˆç±»å‹</td>
<td>400MB</td>
<td>12GB</td>
<td>144GB</td>
</tr>
<tr>
<td>Bitmaps</td>
<td>12.5MB</td>
<td>375MB</td>
<td>4.5GB</td>
</tr>
</tbody></table>
<p>ä½†Bitmapså¹¶ä¸æ˜¯ä¸‡é‡‘æ²¹ï¼Œ å‡å¦‚è¯¥ç½‘ç«™æ¯å¤©çš„ç‹¬ç«‹è®¿é—®ç”¨æˆ·å¾ˆå°‘ï¼Œ ä¾‹å¦‚åªæœ‰10ä¸‡ï¼ˆå¤§é‡çš„åƒµå°¸ç”¨æˆ·ï¼‰ ï¼Œ é‚£ä¹ˆä¸¤è€…çš„å¯¹æ¯”å¦‚ä¸‹è¡¨æ‰€ç¤ºï¼Œ å¾ˆæ˜¾ç„¶ï¼Œ è¿™æ—¶å€™ä½¿ç”¨Bitmapså°±ä¸å¤ªåˆé€‚äº†ï¼Œ å› ä¸ºåŸºæœ¬ä¸Šå¤§éƒ¨åˆ†ä½éƒ½æ˜¯0ã€‚</p>
<table>
<thead>
<tr>
<th>setå’ŒBitmapså­˜å‚¨ä¸€å¤©æ´»è·ƒç”¨æˆ·å¯¹æ¯” ç‹¬ç«‹ç”¨æˆ·æ¯”è¾ƒå°‘ï¼‰</th>
<th></th>
<th></th>
<th></th>
</tr>
</thead>
<tbody><tr>
<td>æ•°æ®ç±»å‹</td>
<td>æ¯ä¸ªuseridå ç”¨ç©ºé—´</td>
<td>éœ€è¦å­˜å‚¨çš„ç”¨æˆ·é‡</td>
<td>å…¨éƒ¨å†…å­˜é‡</td>
</tr>
<tr>
<td>é›†åˆç±»å‹</td>
<td>64ä½</td>
<td>100000</td>
<td>64ä½*100000 &#x3D; 800KB</td>
</tr>
<tr>
<td>Bitmaps</td>
<td>1ä½</td>
<td>100000000</td>
<td>1ä½*100000000 &#x3D; 12.5MB</td>
</tr>
</tbody></table>
<h2 id="HyperLogLog"><a href="#HyperLogLog" class="headerlink" title="HyperLogLog"></a><strong>HyperLogLog</strong></h2><h3 id="ç®€ä»‹-6"><a href="#ç®€ä»‹-6" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h3><p>â€‹		åœ¨å·¥ä½œå½“ä¸­ï¼Œæˆ‘ä»¬ç»å¸¸ä¼šé‡åˆ°ä¸ç»Ÿè®¡ç›¸å…³çš„åŠŸèƒ½éœ€æ±‚ï¼Œæ¯”å¦‚ç»Ÿè®¡ç½‘ç«™PVï¼ˆPageViewé¡µé¢è®¿é—®é‡ï¼‰,å¯ä»¥ä½¿ç”¨Redisçš„incrã€incrbyè½»æ¾å®ç°ã€‚</p>
<p>â€‹		ä½†åƒUVï¼ˆUniqueVisitorï¼Œç‹¬ç«‹è®¿å®¢ï¼‰ã€ç‹¬ç«‹IPæ•°ã€æœç´¢è®°å½•æ•°ç­‰éœ€è¦å»é‡å’Œè®¡æ•°çš„é—®é¢˜å¦‚ä½•è§£å†³ï¼Ÿè¿™ç§æ±‚é›†åˆä¸­ä¸é‡å¤å…ƒç´ ä¸ªæ•°çš„é—®é¢˜ç§°ä¸ºåŸºæ•°é—®é¢˜ã€‚</p>
<p>è§£å†³åŸºæ•°é—®é¢˜æœ‰å¾ˆå¤šç§æ–¹æ¡ˆï¼š</p>
<p>ï¼ˆ1ï¼‰æ•°æ®å­˜å‚¨åœ¨MySQLè¡¨ä¸­ï¼Œä½¿ç”¨distinct countè®¡ç®—ä¸é‡å¤ä¸ªæ•°</p>
<p>ï¼ˆ2ï¼‰ä½¿ç”¨Redisæä¾›çš„hashã€setã€bitmapsç­‰æ•°æ®ç»“æ„æ¥å¤„ç†</p>
<p>ä»¥ä¸Šçš„æ–¹æ¡ˆç»“æœç²¾ç¡®ï¼Œä½†éšç€æ•°æ®ä¸æ–­å¢åŠ ï¼Œå¯¼è‡´å ç”¨ç©ºé—´è¶Šæ¥è¶Šå¤§ï¼Œå¯¹äºéå¸¸å¤§çš„æ•°æ®é›†æ˜¯ä¸åˆ‡å®é™…çš„ã€‚</p>
<p>èƒ½å¦èƒ½å¤Ÿé™ä½ä¸€å®šçš„ç²¾åº¦æ¥å¹³è¡¡å­˜å‚¨ç©ºé—´ï¼ŸRedisæ¨å‡ºäº†HyperLogLog</p>
<p>Redis HyperLogLog æ˜¯ç”¨æ¥åšåŸºæ•°ç»Ÿè®¡çš„ç®—æ³•ï¼ŒHyperLogLog çš„ä¼˜ç‚¹æ˜¯ï¼Œåœ¨è¾“å…¥å…ƒç´ çš„æ•°é‡æˆ–è€…ä½“ç§¯éå¸¸éå¸¸å¤§æ—¶ï¼Œè®¡ç®—åŸºæ•°æ‰€éœ€çš„ç©ºé—´æ€»æ˜¯å›ºå®šçš„ã€å¹¶ä¸”æ˜¯å¾ˆå°çš„ã€‚</p>
<p>åœ¨ Redis é‡Œé¢ï¼Œæ¯ä¸ª HyperLogLog é”®åªéœ€è¦èŠ±è´¹ 12 KB å†…å­˜ï¼Œå°±å¯ä»¥è®¡ç®—æ¥è¿‘ 2^64 ä¸ªä¸åŒå…ƒç´ çš„åŸºæ•°ã€‚è¿™å’Œè®¡ç®—åŸºæ•°æ—¶ï¼Œå…ƒç´ è¶Šå¤šè€—è´¹å†…å­˜å°±è¶Šå¤šçš„é›†åˆå½¢æˆé²œæ˜å¯¹æ¯”ã€‚</p>
<p>ä½†æ˜¯ï¼Œå› ä¸º HyperLogLog åªä¼šæ ¹æ®è¾“å…¥å…ƒç´ æ¥è®¡ç®—åŸºæ•°ï¼Œè€Œä¸ä¼šå‚¨å­˜è¾“å…¥å…ƒç´ æœ¬èº«ï¼Œæ‰€ä»¥ HyperLogLog ä¸èƒ½åƒé›†åˆé‚£æ ·ï¼Œè¿”å›è¾“å…¥çš„å„ä¸ªå…ƒç´ ã€‚</p>
<p>ä»€ä¹ˆæ˜¯åŸºæ•°?</p>
<p>æ¯”å¦‚æ•°æ®é›† {1, 3, 5, 7, 5, 7, 8}ï¼Œ é‚£ä¹ˆè¿™ä¸ªæ•°æ®é›†çš„åŸºæ•°é›†ä¸º {1, 3, 5 ,7, 8}, åŸºæ•°(ä¸é‡å¤å…ƒç´ )ä¸º5ã€‚ åŸºæ•°ä¼°è®¡å°±æ˜¯åœ¨è¯¯å·®å¯æ¥å—çš„èŒƒå›´å†…ï¼Œå¿«é€Ÿè®¡ç®—åŸºæ•°ã€‚</p>
<h3 id="å‘½ä»¤-1"><a href="#å‘½ä»¤-1" class="headerlink" title="å‘½ä»¤"></a>å‘½ä»¤</h3><p>ï¼ˆ1ï¼‰pfadd</p>
<p>â€‹		pfadd <key>&lt; element&gt; [element â€¦]  </key></p>
<p>â€‹		æ·»åŠ æŒ‡å®šå…ƒç´ åˆ° HyperLogLog ä¸­</p>
<blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">127.0.0.1:6379&gt; pfadd hll1 &quot;redis&quot;</span><br><span class="line">(integer) 1</span><br><span class="line">127.0.0.1:6379&gt; pfadd hll1 &quot;mysql&quot;</span><br><span class="line">(integer) 1</span><br><span class="line">127.0.0.1:6379&gt; pfadd hll1 &quot;redis&quot;</span><br><span class="line">(integer) 0</span><br><span class="line">127.0.0.1:6379&gt;</span><br></pre></td></tr></table></figure>

<p>â€‹		å°†æ‰€æœ‰å…ƒç´ æ·»åŠ åˆ°æŒ‡å®šHyperLogLogæ•°æ®ç»“æ„ä¸­ã€‚å¦‚æœæ‰§è¡Œå‘½ä»¤åHLLä¼°è®¡çš„è¿‘ä¼¼åŸºæ•°å‘ç”Ÿå˜åŒ–ï¼Œåˆ™è¿”å›1ï¼Œå¦åˆ™è¿”å›0ã€‚</p>
</blockquote>
<p>ï¼ˆ2ï¼‰pfcount</p>
<p>â€‹		pfcount<key> [key â€¦] </key></p>
<p>â€‹		è®¡ç®—HLLçš„è¿‘ä¼¼åŸºæ•°ï¼Œå¯ä»¥è®¡ç®—å¤šä¸ªHLLï¼Œæ¯”å¦‚ç”¨HLLå­˜å‚¨æ¯å¤©çš„UVï¼Œè®¡ç®—ä¸€å‘¨çš„UVå¯ä»¥ä½¿ç”¨7å¤©çš„UVåˆå¹¶è®¡ç®—å³å¯</p>
<blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">127.0.0.1:6379&gt; pfadd hll1 &quot;redis&quot;</span><br><span class="line">(integer) 1</span><br><span class="line">127.0.0.1:6379&gt; pfadd hll1 &quot;mysql&quot;</span><br><span class="line">(integer) 1</span><br><span class="line">127.0.0.1:6379&gt; pfadd hll1 &quot;redis&quot;</span><br><span class="line">(integer) 0</span><br><span class="line">127.0.0.1:6379&gt; pfcount hll1</span><br><span class="line">(integer) 2</span><br><span class="line">127.0.0.1:6379&gt; pfadd hll2 &quot;kafka&quot;</span><br><span class="line">(integer) 1</span><br><span class="line">127.0.0.1:6379&gt; pfadd hll2 &quot;nginx&quot;</span><br><span class="line">(integer) 1</span><br><span class="line">127.0.0.1:6379&gt; pfcount hll1 hll2</span><br><span class="line">(integer) 4</span><br><span class="line">127.0.0.1:6379&gt;</span><br></pre></td></tr></table></figure>
</blockquote>
<p>ï¼ˆ3ï¼‰pfmerge</p>
<p>â€‹		pfmerge<destkey><sourcekey> [sourcekey â€¦] </sourcekey></destkey></p>
<p>â€‹		å°†ä¸€ä¸ªæˆ–å¤šä¸ªHLLåˆå¹¶åçš„ç»“æœå­˜å‚¨åœ¨å¦ä¸€ä¸ªHLLä¸­ï¼Œæ¯”å¦‚æ¯æœˆæ´»è·ƒç”¨æˆ·å¯ä»¥ä½¿ç”¨æ¯å¤©çš„æ´»è·ƒç”¨æˆ·æ¥åˆå¹¶è®¡ç®—å¯å¾—</p>
<blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">127.0.0.1:6379&gt; pfcount hll1 hll2</span><br><span class="line">(integer) 4</span><br><span class="line">127.0.0.1:6379&gt; pfmerge hll3 hll1 hll2</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; pfcount hll3</span><br><span class="line">(integer) 4</span><br></pre></td></tr></table></figure>
</blockquote>
<h2 id="Geospatial"><a href="#Geospatial" class="headerlink" title="Geospatial"></a><strong>Geospatial</strong></h2><h3 id="ç®€ä»‹-7"><a href="#ç®€ä»‹-7" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h3><p>â€‹		Redis 3.2 ä¸­å¢åŠ äº†å¯¹GEOç±»å‹çš„æ”¯æŒã€‚GEOï¼ŒGeographicï¼Œåœ°ç†ä¿¡æ¯çš„ç¼©å†™ã€‚è¯¥ç±»å‹ï¼Œå°±æ˜¯å…ƒç´ çš„äºŒç»´åæ ‡ï¼Œåœ¨åœ°å›¾ä¸Šå°±æ˜¯ç»çº¬åº¦ã€‚redisåŸºäºè¯¥ç±»å‹ï¼Œæä¾›äº†ç»çº¬åº¦è®¾ç½®ï¼ŒæŸ¥è¯¢ï¼ŒèŒƒå›´æŸ¥è¯¢ï¼Œè·ç¦»æŸ¥è¯¢ï¼Œç»çº¬åº¦Hashç­‰å¸¸è§æ“ä½œã€‚</p>
<h3 id="å‘½ä»¤-2"><a href="#å‘½ä»¤-2" class="headerlink" title="å‘½ä»¤"></a>å‘½ä»¤</h3><p>ï¼ˆ1ï¼‰geoadd</p>
<p>â€‹		geoadd<key>&lt; longitude&gt;<latitude><member> [longitude latitude memberâ€¦]  </member></latitude></key></p>
<p>â€‹		æ·»åŠ åœ°ç†ä½ç½®ï¼ˆç»åº¦ï¼Œçº¬åº¦ï¼Œåç§°ï¼‰</p>
<blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">127.0.0.1:6379&gt; geoadd china:city 121.47 31.23 shanghai</span><br><span class="line">(integer) 1</span><br><span class="line">127.0.0.1:6379&gt; geoadd china:city 106.50 29.53 chongqing 114.05 22.52 shenzhen 116.38 39.90 beijing</span><br><span class="line">(integer) 3</span><br><span class="line">127.0.0.1:6379&gt; geoadd china:city 121.47 31.23 shanghai</span><br><span class="line">(integer) 0</span><br></pre></td></tr></table></figure>

<ul>
<li>ä¸¤ææ— æ³•ç›´æ¥æ·»åŠ ï¼Œä¸€èˆ¬ä¼šä¸‹è½½åŸå¸‚æ•°æ®ï¼Œç›´æ¥é€šè¿‡ Java ç¨‹åºä¸€æ¬¡æ€§å¯¼å…¥ã€‚</li>
<li>æœ‰æ•ˆçš„ç»åº¦ä» -180 åº¦åˆ° 180 åº¦ã€‚æœ‰æ•ˆçš„çº¬åº¦ä» -85.05112878 åº¦åˆ° 85.05112878 åº¦ã€‚</li>
<li>å½“åæ ‡ä½ç½®è¶…å‡ºæŒ‡å®šèŒƒå›´æ—¶ï¼Œè¯¥å‘½ä»¤å°†ä¼šè¿”å›ä¸€ä¸ªé”™è¯¯ã€‚</li>
<li><strong>å·²ç»æ·»åŠ çš„æ•°æ®ï¼Œæ˜¯æ— æ³•å†æ¬¡å¾€é‡Œé¢æ·»åŠ çš„ã€‚</strong></li>
</ul>
</blockquote>
<p>ï¼ˆ2ï¼‰geopos </p>
<p>â€‹		geopos <key><member> [memberâ€¦]</member></key></p>
<p>â€‹		è·å¾—æŒ‡å®šåœ°åŒºçš„åæ ‡å€¼</p>
<blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">127.0.0.1:6379&gt; geopos china:city shanghai</span><br><span class="line">1) 1) &quot;121.47000163793563843&quot;</span><br><span class="line">   2) &quot;31.22999903975783553&quot;</span><br></pre></td></tr></table></figure>
</blockquote>
<p>ï¼ˆ3ï¼‰geodist</p>
<p>â€‹		geodist<key><member1><member2> [m|km|ft|mi ] </member2></member1></key></p>
<p>â€‹		è·å–ä¸¤ä¸ªä½ç½®ä¹‹é—´çš„ç›´çº¿è·ç¦»</p>
<blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">127.0.0.1:6379&gt; geodist china:city beijing shanghai</span><br><span class="line">&quot;1068153.5181&quot;</span><br><span class="line">127.0.0.1:6379&gt; geodist china:city beijing shanghai km</span><br><span class="line">&quot;1068.1535&quot;</span><br></pre></td></tr></table></figure>

<p>å•ä½ï¼š</p>
<ul>
<li><p>m è¡¨ç¤ºå•ä½ä¸ºç±³[é»˜è®¤å€¼]ã€‚</p>
</li>
<li><p>km è¡¨ç¤ºå•ä½ä¸ºåƒç±³ã€‚</p>
</li>
<li><p>mi è¡¨ç¤ºå•ä½ä¸ºè‹±é‡Œã€‚</p>
</li>
<li><p>ft è¡¨ç¤ºå•ä½ä¸ºè‹±å°ºã€‚</p>
<p>  å¦‚æœç”¨æˆ·æ²¡æœ‰æ˜¾å¼åœ°æŒ‡å®šå•ä½å‚æ•°ï¼Œ é‚£ä¹ˆ GEODIST é»˜è®¤ä½¿ç”¨ç±³ä½œä¸ºå•ä½</p>
</li>
</ul>
</blockquote>
<p>ï¼ˆ4ï¼‰georadius</p>
<p>â€‹		georadius<key>&lt; longitude&gt;<latitude>radius m|km|ft|mi </latitude></key></p>
<p>â€‹		ä»¥ç»™å®šçš„ç»çº¬åº¦ä¸ºä¸­å¿ƒï¼Œæ‰¾å‡ºæŸä¸€åŠå¾„å†…çš„å…ƒç´ </p>
<blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">127.0.0.1:6379&gt; georadius china:city 110 30 1000 km</span><br><span class="line">1) &quot;chongqing&quot;</span><br><span class="line">2) &quot;shenzhen&quot;</span><br></pre></td></tr></table></figure>
</blockquote>
<h1 id="Jedisè¿æ¥Redis"><a href="#Jedisè¿æ¥Redis" class="headerlink" title="Jedisè¿æ¥Redis"></a>Jedisè¿æ¥Redis</h1><h2 id="pom-xml"><a href="#pom-xml" class="headerlink" title="pom.xml"></a>pom.xml</h2><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>redis.clients<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jedis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.2.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="è¿æ¥-Redis-æ³¨æ„äº‹é¡¹"><a href="#è¿æ¥-Redis-æ³¨æ„äº‹é¡¹" class="headerlink" title="è¿æ¥ Redis æ³¨æ„äº‹é¡¹"></a>è¿æ¥ Redis æ³¨æ„äº‹é¡¹</h2><p>ç¦ç”¨Linuxçš„é˜²ç«å¢™ï¼šLinux(CentOS7)é‡Œæ‰§è¡Œå‘½ä»¤</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">systemctl stop/disable firewalld.service</span><br></pre></td></tr></table></figure>

<p>æˆ–è€…å¼€æ”¾ç«¯å£ 6379</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æŸ¥çœ‹å¼€æ”¾çš„ç«¯å£å·</span></span><br><span class="line">firewall-cmd --list-all</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">è®¾ç½®å¼€æ”¾çš„ç«¯å£å·</span></span><br><span class="line">firewall-cmd --add-service=redis --permanent</span><br><span class="line">firewall-cmd --add-port=6379/tcp --permanent</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">é‡å¯é˜²ç«å¢™</span></span><br><span class="line">firewall-cmd --reload</span><br></pre></td></tr></table></figure>

<p>redis.conf ä¸­æ³¨é‡Šæ‰ bind 127.0.0.1ï¼Œå¹¶ä¸”è®¾ç½®ï¼š protected-mode no</p>
<p>ã€<strong>æ”¹é…ç½®å‰å¿…é¡»å…³æ‰ redisï¼Œå¦åˆ™ä¸ç”Ÿæ•ˆ</strong>ã€‘</p>
<figure class="highlight tex"><table><tr><td class="code"><pre><span class="line">-DENIED Redis is running in protected mode because protected mode is enabled, no bind address was specified, no authentication password is requested to clients. In this mode connections are only accepted from the loopback interface. If you want to connect from external computers to Redis you may adopt one of the following solutions: </span><br><span class="line">1) Just disable protected mode sending the command &#x27;CONFIG SET protected-mode no&#x27; from the loopback interface by connecting to Redis from the same host the server is running, however MAKE SURE Redis is not publicly accessible from internet if you do so. Use CONFIG REWRITE to make this change permanent. </span><br><span class="line">2) Alternatively you can just disable the protected mode by editing the Redis configuration file, and setting the protected mode option to &#x27;no&#x27;, and then restarting the server. </span><br><span class="line">3) If you started the server manually just for testing, restart it with the &#x27;--protected-mode no&#x27; option. </span><br><span class="line">4) Setup a bind address or an authentication password. </span><br><span class="line">NOTE: You only need to do one of the above things in order for the server to start accepting connections from the outside. </span><br></pre></td></tr></table></figure>

<h2 id="æµ‹è¯•è¿æ¥"><a href="#æµ‹è¯•è¿æ¥" class="headerlink" title="æµ‹è¯•è¿æ¥"></a>æµ‹è¯•è¿æ¥</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JedisTest</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">REDIS_HOST</span> <span class="operator">=</span> <span class="string">&quot;192.168.248.100&quot;</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">REDIS_PORT</span> <span class="operator">=</span> <span class="number">6379</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">Jedis</span> <span class="variable">jedis</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Jedis</span>(REDIS_HOST, REDIS_PORT);</span><br><span class="line">        <span class="type">String</span> <span class="variable">pong</span> <span class="operator">=</span> jedis.ping(<span class="string">&quot;Hello Redis!&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;pong: &quot;</span> + pong);</span><br><span class="line">        jedis.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="æµ‹è¯•æ•°æ®ç±»å‹"><a href="#æµ‹è¯•æ•°æ®ç±»å‹" class="headerlink" title="æµ‹è¯•æ•°æ®ç±»å‹"></a>æµ‹è¯•æ•°æ®ç±»å‹</h2><h3 id="key"><a href="#key" class="headerlink" title="key"></a>key</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JedisTest</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">REDIS_HOST</span> <span class="operator">=</span> <span class="string">&quot;192.168.248.100&quot;</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">REDIS_PORT</span> <span class="operator">=</span> <span class="number">6379</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">Jedis</span> <span class="variable">jedis</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Before</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">init</span><span class="params">()</span> &#123;</span><br><span class="line">        jedis = <span class="keyword">new</span> <span class="title class_">Jedis</span>(REDIS_HOST, REDIS_PORT);</span><br><span class="line">        jedis.flushDB();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@After</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">destroy</span><span class="params">()</span> &#123;</span><br><span class="line">        jedis.close();</span><br><span class="line">    &#125;  </span><br><span class="line">	<span class="comment">// æµ‹è¯• key</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testKey</span><span class="params">()</span> &#123;</span><br><span class="line">        jedis.set(<span class="string">&quot;k1&quot;</span>, <span class="string">&quot;v1&quot;</span>);</span><br><span class="line">        jedis.set(<span class="string">&quot;k2&quot;</span>, <span class="string">&quot;v2&quot;</span>);</span><br><span class="line">        jedis.set(<span class="string">&quot;k3&quot;</span>, <span class="string">&quot;v3&quot;</span>);</span><br><span class="line">        Set&lt;String&gt; keys = jedis.keys(<span class="string">&quot;*&quot;</span>);</span><br><span class="line">        keys.forEach(System.out::println);</span><br><span class="line"></span><br><span class="line">        System.out.println(jedis.exists(<span class="string">&quot;k1&quot;</span>));</span><br><span class="line">        System.out.println(jedis.ttl(<span class="string">&quot;k1&quot;</span>));</span><br><span class="line">        System.out.println(jedis.get(<span class="string">&quot;k1&quot;</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="string"><a href="#string" class="headerlink" title="string"></a>string</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// æµ‹è¯• string</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testString</span><span class="params">()</span> &#123;</span><br><span class="line">    jedis.mset(<span class="string">&quot;k1&quot;</span>, <span class="string">&quot;v1&quot;</span>, <span class="string">&quot;k2&quot;</span>, <span class="string">&quot;v2&quot;</span>, <span class="string">&quot;k3&quot;</span>, <span class="string">&quot;v3&quot;</span>);</span><br><span class="line">    System.out.println(jedis.mget(<span class="string">&quot;k1&quot;</span>, <span class="string">&quot;k2&quot;</span>, <span class="string">&quot;k3&quot;</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="list"><a href="#list" class="headerlink" title="list"></a>list</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// æµ‹è¯• list</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testList</span><span class="params">()</span> &#123;</span><br><span class="line">    jedis.rpush(<span class="string">&quot;list01&quot;</span>, <span class="string">&quot;A&quot;</span>, <span class="string">&quot;B&quot;</span>, <span class="string">&quot;C&quot;</span>);</span><br><span class="line">    System.out.println(jedis.lrange(<span class="string">&quot;list01&quot;</span>, <span class="number">0</span>, -<span class="number">1</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="set"><a href="#set" class="headerlink" title="set"></a>set</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// æµ‹è¯• set</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testSet</span><span class="params">()</span> &#123;</span><br><span class="line">    jedis.sadd(<span class="string">&quot;set01&quot;</span>, <span class="string">&quot;A&quot;</span>, <span class="string">&quot;A&quot;</span>, <span class="string">&quot;B&quot;</span>, <span class="string">&quot;C&quot;</span>);</span><br><span class="line">    System.out.println(jedis.smembers(<span class="string">&quot;set01&quot;</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="hash"><a href="#hash" class="headerlink" title="hash"></a>hash</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// æµ‹è¯• hash</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testHash</span><span class="params">()</span> &#123;</span><br><span class="line">    Map&lt;String, String&gt; map = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;String, String&gt;();</span><br><span class="line">    map.put(<span class="string">&quot;name&quot;</span>, <span class="string">&quot;tom&quot;</span>);</span><br><span class="line">    map.put(<span class="string">&quot;address&quot;</span>, <span class="string">&quot;NewYork&quot;</span>);</span><br><span class="line">    map.put(<span class="string">&quot;age&quot;</span>, <span class="string">&quot;12&quot;</span>);</span><br><span class="line">    jedis.hmset(<span class="string">&quot;hash01&quot;</span>, map);</span><br><span class="line">    System.out.println(jedis.hmget(<span class="string">&quot;hash01&quot;</span>, <span class="string">&quot;name&quot;</span>, <span class="string">&quot;address&quot;</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="zset"><a href="#zset" class="headerlink" title="zset"></a>zset</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// æµ‹è¯• zset</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testZset</span><span class="params">()</span> &#123;</span><br><span class="line">    jedis.zadd(<span class="string">&quot;zset01&quot;</span>, <span class="number">30</span>, <span class="string">&quot;A&quot;</span>);</span><br><span class="line">    jedis.zadd(<span class="string">&quot;zset01&quot;</span>, <span class="number">40</span>, <span class="string">&quot;B&quot;</span>);</span><br><span class="line">    jedis.zadd(<span class="string">&quot;zset01&quot;</span>, <span class="number">10</span>, <span class="string">&quot;C&quot;</span>);</span><br><span class="line">    System.out.println(jedis.zrange(<span class="string">&quot;zset01&quot;</span>, <span class="number">0</span>, -<span class="number">1</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Jedis-éªŒè¯ç ç¤ºä¾‹"><a href="#Jedis-éªŒè¯ç ç¤ºä¾‹" class="headerlink" title="Jedis éªŒè¯ç ç¤ºä¾‹"></a>Jedis éªŒè¯ç ç¤ºä¾‹</h2><p>éœ€æ±‚ï¼š</p>
<ol>
<li><p>è¾“å…¥æ‰‹æœºå·ï¼Œç‚¹å‡»å‘é€åéšæœºç”Ÿæˆ 6 ä½æ•°å­—ç ï¼Œ2åˆ†é’Ÿæœ‰æ•ˆ</p>
</li>
<li><p>è¾“å…¥éªŒè¯ç ï¼Œç‚¹å‡»éªŒè¯ï¼Œè¿”å›æˆåŠŸæˆ–å¤±è´¥</p>
</li>
<li><p>æ¯ä¸ªæ‰‹æœºå·æ¯å¤©åªèƒ½è¾“å…¥3æ¬¡</p>
</li>
</ol>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> redis.clients.jedis.Jedis;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Random;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 1. è¾“å…¥æ‰‹æœºå·ï¼Œç‚¹å‡»å‘é€åéšæœºç”Ÿæˆ6ä½æ•°å­—ç ï¼Œ2åˆ†é’Ÿæœ‰æ•ˆ</span></span><br><span class="line"><span class="comment"> * 2. è¾“å…¥éªŒè¯ç ï¼Œç‚¹å‡»éªŒè¯ï¼Œè¿”å›æˆåŠŸæˆ–å¤±è´¥</span></span><br><span class="line"><span class="comment"> * 3. æ¯ä¸ªæ‰‹æœºå·æ¯å¤©åªèƒ½è¾“å…¥3æ¬¡</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">VerifyCode</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">REDIS_HOST</span> <span class="operator">=</span> <span class="string">&quot;192.168.100.100&quot;</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">REDIS_PORT</span> <span class="operator">=</span> <span class="number">6379</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">Jedis</span> <span class="variable">jedis</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">Random</span> <span class="variable">random</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Random</span>();</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">char</span>[] srcArr = <span class="string">&quot;abcdefghijklmnopqrstuvwxyz1234567890&quot;</span>.toCharArray();</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å‘é€éªŒè¯ç </span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> phone</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">sendCodeToClient</span><span class="params">(String phone)</span> &#123;</span><br><span class="line">        jedis = <span class="keyword">new</span> <span class="title class_">Jedis</span>(REDIS_HOST, REDIS_PORT);</span><br><span class="line">        <span class="type">String</span> <span class="variable">phoneCountKey</span> <span class="operator">=</span> <span class="string">&quot;code:&quot;</span> + phone + <span class="string">&quot;:count&quot;</span>;</span><br><span class="line">        <span class="type">String</span> <span class="variable">phoneCount</span> <span class="operator">=</span> jedis.get(phoneCountKey);</span><br><span class="line">        <span class="comment">// æ ¡éªŒå‘é€æ¬¡æ•°</span></span><br><span class="line">        <span class="keyword">if</span> (phoneCount == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="comment">// è®¾ç½®å‘é€æ¬¡æ•°ä¸º 1</span></span><br><span class="line">            jedis.setex(phoneCountKey, <span class="number">60</span> * <span class="number">60</span> * <span class="number">24</span>, <span class="string">&quot;1&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (Integer.parseInt(phoneCount) &lt;= <span class="number">2</span>) &#123;</span><br><span class="line">            jedis.incr(phoneCountKey);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;éªŒè¯ç å·²ç»å‘é€ä¸‰æ¬¡...&quot;</span>);</span><br><span class="line">            jedis.close();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// åˆ›å»ºå¹¶å‘é€éªŒè¯ç </span></span><br><span class="line">        <span class="type">String</span> <span class="variable">code</span> <span class="operator">=</span> createCode();</span><br><span class="line">        System.out.println(<span class="string">&quot;code: &quot;</span> + code);</span><br><span class="line">        <span class="type">String</span> <span class="variable">phoneCodeKey</span> <span class="operator">=</span> <span class="string">&quot;code:&quot;</span> + phone + <span class="string">&quot;:code&quot;</span>;</span><br><span class="line">        jedis.setex(phoneCodeKey, <span class="number">60</span> * <span class="number">2</span>, code);</span><br><span class="line">        jedis.close();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * åˆ›å»ºéªŒè¯ç </span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">createCode</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">StringBuilder</span> <span class="variable">sb</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuilder</span>();</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">6</span>; i++) &#123;</span><br><span class="line">            sb.append(srcArr[random.nextInt(srcArr.length)]);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> sb.toString();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">checkCode</span><span class="params">(String phone, String code)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (phone == <span class="literal">null</span> || code == <span class="literal">null</span>) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;å‚æ•°æ ¡éªŒå‡ºé”™...&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            jedis = <span class="keyword">new</span> <span class="title class_">Jedis</span>(REDIS_HOST, REDIS_PORT);</span><br><span class="line">            <span class="type">String</span> <span class="variable">redisCode</span> <span class="operator">=</span> jedis.get(<span class="string">&quot;code:&quot;</span> + phone + <span class="string">&quot;:code&quot;</span>);</span><br><span class="line">            <span class="keyword">if</span> (code.equals(redisCode)) &#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;éªŒè¯ç æ­£ç¡®...&quot;</span>);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;éªŒè¯ç é”™è¯¯...&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">VerifyCode</span> <span class="variable">verify</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">VerifyCode</span>();</span><br><span class="line">        <span class="type">String</span> <span class="variable">phone</span> <span class="operator">=</span> <span class="string">&quot;18220549581&quot;</span>;</span><br><span class="line">        verify.sendCodeToClient(phone);</span><br><span class="line">        <span class="comment">// verify.checkCode(phone,&quot;grnddt&quot;);</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h1 id="SpringBootæ•´åˆRedis"><a href="#SpringBootæ•´åˆRedis" class="headerlink" title="SpringBootæ•´åˆRedis"></a>SpringBootæ•´åˆRedis</h1><h2 id="å¼•å…¥ä¾èµ–"><a href="#å¼•å…¥ä¾èµ–" class="headerlink" title="å¼•å…¥ä¾èµ–"></a>å¼•å…¥ä¾èµ–</h2><p>åˆ›å»ºSpringBootå·¥ç¨‹ï¼Œå¼•å…¥ä¾èµ–</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-data-redis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- spring2.Xé›†æˆredisæ‰€éœ€common-pool2ï¼Œå¯ä»¥ä¸ç”¨å¼•å…¥--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.commons<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>commons-pool2<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--æ³¨æ„è¯¥ç‰ˆæœ¬åº”è¯¥ç”±spring bootä»²è£--&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--&lt;version&gt;2.6.0&lt;/version&gt;--&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="é…ç½®"><a href="#é…ç½®" class="headerlink" title="é…ç½®"></a>é…ç½®</h2><p>application.properties</p>
<figure class="highlight properties"><table><tr><td class="code"><pre><span class="line"><span class="comment">#RedisæœåŠ¡å™¨åœ°å€</span></span><br><span class="line"><span class="attr">spring.redis.host</span>=<span class="string">192.168.248.100</span></span><br><span class="line"><span class="comment">#RedisæœåŠ¡å™¨è¿æ¥ç«¯å£</span></span><br><span class="line"><span class="attr">spring.redis.port</span>=<span class="string">6379</span></span><br><span class="line"><span class="comment">#Redisæ•°æ®åº“ç´¢å¼•ï¼ˆé»˜è®¤ä¸º0ï¼‰</span></span><br><span class="line"><span class="attr">spring.redis.database</span>= <span class="string">0</span></span><br><span class="line"><span class="comment">#è¿æ¥è¶…æ—¶æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰</span></span><br><span class="line"><span class="attr">spring.redis.timeout</span>=<span class="string">1800000</span></span><br><span class="line"><span class="comment">#è¿æ¥æ± æœ€å¤§è¿æ¥æ•°ï¼ˆä½¿ç”¨è´Ÿå€¼è¡¨ç¤ºæ²¡æœ‰é™åˆ¶ï¼‰</span></span><br><span class="line"><span class="attr">spring.redis.lettuce.pool.max-active</span>=<span class="string">20</span></span><br><span class="line"><span class="comment">#æœ€å¤§é˜»å¡ç­‰å¾…æ—¶é—´(è´Ÿæ•°è¡¨ç¤ºæ²¡é™åˆ¶)</span></span><br><span class="line"><span class="attr">spring.redis.lettuce.pool.max-wait</span>=<span class="string">-1</span></span><br><span class="line"><span class="comment">#è¿æ¥æ± ä¸­çš„æœ€å¤§ç©ºé—²è¿æ¥</span></span><br><span class="line"><span class="attr">spring.redis.lettuce.pool.max-idle</span>=<span class="string">5</span></span><br><span class="line"><span class="comment">#è¿æ¥æ± ä¸­çš„æœ€å°ç©ºé—²è¿æ¥</span></span><br><span class="line"><span class="attr">spring.redis.lettuce.pool.min-idle</span>=<span class="string">0</span></span><br></pre></td></tr></table></figure>

<p>é…ç½®ç±» RedisConfig</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.annotation.JsonAutoDetect;</span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.annotation.PropertyAccessor;</span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.databind.ObjectMapper;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cache.CacheManager;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cache.annotation.CachingConfigurerSupport;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cache.annotation.EnableCaching;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.redis.cache.RedisCacheConfiguration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.redis.cache.RedisCacheManager;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.redis.connection.RedisConnectionFactory;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.redis.core.RedisTemplate;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.redis.serializer.Jackson2JsonRedisSerializer;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.redis.serializer.RedisSerializationContext;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.redis.serializer.RedisSerializer;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.redis.serializer.StringRedisSerializer;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.time.Duration;</span><br><span class="line"></span><br><span class="line"><span class="meta">@EnableCaching</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RedisConfig</span> <span class="keyword">extends</span> <span class="title class_">CachingConfigurerSupport</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> RedisTemplate&lt;String, Object&gt; <span class="title function_">redisTemplate</span><span class="params">(RedisConnectionFactory factory)</span> &#123;</span><br><span class="line">        RedisTemplate&lt;String, Object&gt; template = <span class="keyword">new</span> <span class="title class_">RedisTemplate</span>&lt;&gt;();</span><br><span class="line">        RedisSerializer&lt;String&gt; redisSerializer = <span class="keyword">new</span> <span class="title class_">StringRedisSerializer</span>();</span><br><span class="line">        <span class="type">Jackson2JsonRedisSerializer</span> <span class="variable">jackson2JsonRedisSerializer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Jackson2JsonRedisSerializer</span>(Object.class);</span><br><span class="line">        <span class="type">ObjectMapper</span> <span class="variable">om</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectMapper</span>();</span><br><span class="line">        om.setVisibility(PropertyAccessor.ALL, JsonAutoDetect.Visibility.ANY);</span><br><span class="line">        om.enableDefaultTyping(ObjectMapper.DefaultTyping.NON_FINAL);</span><br><span class="line">        jackson2JsonRedisSerializer.setObjectMapper(om);</span><br><span class="line">        template.setConnectionFactory(factory);</span><br><span class="line">        <span class="comment">//keyåºåˆ—åŒ–æ–¹å¼</span></span><br><span class="line">        template.setKeySerializer(redisSerializer);</span><br><span class="line">        <span class="comment">//valueåºåˆ—åŒ–</span></span><br><span class="line">        template.setValueSerializer(jackson2JsonRedisSerializer);</span><br><span class="line">        <span class="comment">//value hashmapåºåˆ—åŒ–</span></span><br><span class="line">        template.setHashValueSerializer(jackson2JsonRedisSerializer);</span><br><span class="line">        <span class="keyword">return</span> template;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> CacheManager <span class="title function_">cacheManager</span><span class="params">(RedisConnectionFactory factory)</span> &#123;</span><br><span class="line">        RedisSerializer&lt;String&gt; redisSerializer = <span class="keyword">new</span> <span class="title class_">StringRedisSerializer</span>();</span><br><span class="line">        <span class="type">Jackson2JsonRedisSerializer</span> <span class="variable">jackson2JsonRedisSerializer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Jackson2JsonRedisSerializer</span>(Object.class);</span><br><span class="line"><span class="comment">//è§£å†³æŸ¥è¯¢ç¼“å­˜è½¬æ¢å¼‚å¸¸çš„é—®é¢˜</span></span><br><span class="line">        <span class="type">ObjectMapper</span> <span class="variable">om</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectMapper</span>();</span><br><span class="line">        om.setVisibility(PropertyAccessor.ALL, JsonAutoDetect.Visibility.ANY);</span><br><span class="line">        om.enableDefaultTyping(ObjectMapper.DefaultTyping.NON_FINAL);</span><br><span class="line">        jackson2JsonRedisSerializer.setObjectMapper(om);</span><br><span class="line"><span class="comment">// é…ç½®åºåˆ—åŒ–ï¼ˆè§£å†³ä¹±ç çš„é—®é¢˜ï¼‰,è¿‡æœŸæ—¶é—´600ç§’</span></span><br><span class="line">        <span class="type">RedisCacheConfiguration</span> <span class="variable">config</span> <span class="operator">=</span> RedisCacheConfiguration.defaultCacheConfig()</span><br><span class="line">                .entryTtl(Duration.ofSeconds(<span class="number">600</span>))</span><br><span class="line">                .serializeKeysWith(RedisSerializationContext.SerializationPair.fromSerializer(redisSerializer))</span><br><span class="line">                .serializeValuesWith(RedisSerializationContext.SerializationPair.fromSerializer(jackson2JsonRedisSerializer))</span><br><span class="line">                .disableCachingNullValues();</span><br><span class="line">        <span class="type">RedisCacheManager</span> <span class="variable">cacheManager</span> <span class="operator">=</span> RedisCacheManager.builder(factory)</span><br><span class="line">                .cacheDefaults(config)</span><br><span class="line">                .build();</span><br><span class="line">        <span class="keyword">return</span> cacheManager;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="æµ‹è¯•"><a href="#æµ‹è¯•" class="headerlink" title="æµ‹è¯•"></a>æµ‹è¯•</h2><p>RedisTestController</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.redis.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.redis.core.RedisTemplate;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.GetMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Set;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RedisTestController</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> RedisTemplate&lt;String, String&gt; redisTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/string&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">stringTest</span><span class="params">()</span> &#123;</span><br><span class="line">        redisTemplate.opsForValue().set(<span class="string">&quot;str&quot;</span>, <span class="string">&quot;Java&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> redisTemplate.opsForValue().get(<span class="string">&quot;str&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/set&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Set <span class="title function_">setTest</span><span class="params">()</span> &#123;</span><br><span class="line">        redisTemplate.opsForSet().add(<span class="string">&quot;set&quot;</span>, <span class="string">&quot;A&quot;</span>, <span class="string">&quot;B&quot;</span>, <span class="string">&quot;A&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> redisTemplate.opsForSet().members(<span class="string">&quot;set&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="Redisäº‹åŠ¡ä¸é”"><a href="#Redisäº‹åŠ¡ä¸é”" class="headerlink" title="Redisäº‹åŠ¡ä¸é”"></a>Redisäº‹åŠ¡ä¸é”</h1><h2 id="Redisäº‹åŠ¡å®šä¹‰"><a href="#Redisäº‹åŠ¡å®šä¹‰" class="headerlink" title="Redisäº‹åŠ¡å®šä¹‰"></a>Redisäº‹åŠ¡å®šä¹‰</h2><p>â€‹		Redis äº‹åŠ¡æ˜¯ä¸€ä¸ªå•ç‹¬çš„éš”ç¦»æ“ä½œï¼šäº‹åŠ¡ä¸­çš„æ‰€æœ‰å‘½ä»¤éƒ½ä¼šåºåˆ—åŒ–ã€æŒ‰é¡ºåºåœ°æ‰§è¡Œã€‚äº‹åŠ¡åœ¨æ‰§è¡Œçš„è¿‡ç¨‹ä¸­ï¼Œä¸ä¼šè¢«å…¶ä»–å®¢æˆ·ç«¯å‘é€æ¥çš„å‘½ä»¤è¯·æ±‚æ‰€æ‰“æ–­ã€‚<mark>Redisäº‹åŠ¡çš„ä¸»è¦ä½œç”¨å°±æ˜¯ä¸²è”å¤šä¸ªå‘½ä»¤é˜²æ­¢åˆ«çš„å‘½ä»¤æ’é˜Ÿã€‚</mark></p>
<h2 id="Multiã€Execã€discard"><a href="#Multiã€Execã€discard" class="headerlink" title="Multiã€Execã€discard"></a>Multiã€Execã€discard</h2><p>â€‹		ä»è¾“å…¥ Multi å‘½ä»¤å¼€å§‹ï¼Œè¾“å…¥çš„å‘½ä»¤éƒ½ä¼šä¾æ¬¡è¿›å…¥å‘½ä»¤é˜Ÿåˆ—ä¸­ï¼Œä½†ä¸ä¼šæ‰§è¡Œï¼Œç›´åˆ°è¾“å…¥ Exec åï¼ŒRedis ä¼šå°†ä¹‹å‰çš„å‘½ä»¤é˜Ÿåˆ—ä¸­çš„å‘½ä»¤ä¾æ¬¡æ‰§è¡Œã€‚<mark>ç»„é˜Ÿçš„è¿‡ç¨‹ä¸­å¯ä»¥é€šè¿‡discardæ¥æ”¾å¼ƒç»„é˜Ÿã€‚</mark></p>
<p><img src="/2023/02/28/Redis/Java\Document\Redis\Redis.assets\image-20220513194048072.png" alt="image-20220513194048072"></p>
<p>äº‹åŠ¡ç¤ºä¾‹ï¼š</p>
<ol>
<li><p>ç»„é˜ŸæˆåŠŸï¼Œæäº¤æˆåŠŸ</p>
<blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">127.0.0.1:6379&gt; multi</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379(TX)&gt; set k1 v1</span><br><span class="line">QUEUED</span><br><span class="line">127.0.0.1:6379(TX)&gt; set k2 v2</span><br><span class="line">QUEUED</span><br><span class="line">127.0.0.1:6379(TX)&gt; exec</span><br><span class="line">1) OK</span><br><span class="line">2) OK</span><br></pre></td></tr></table></figure>
</blockquote>
</li>
<li><p>ç»„é˜Ÿé˜¶æ®µæŠ¥é”™ï¼Œæäº¤å¤±è´¥</p>
<blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">127.0.0.1:6379&gt; multi</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379(TX)&gt; set k1 v1</span><br><span class="line">QUEUED</span><br><span class="line">127.0.0.1:6379(TX)&gt; set k2</span><br><span class="line">(error) ERR wrong number of arguments for &#x27;set&#x27; command</span><br><span class="line">127.0.0.1:6379(TX)&gt; exec</span><br><span class="line">(error) EXECABORT Transaction discarded because of previous errors.</span><br><span class="line">127.0.0.1:6379&gt;</span><br></pre></td></tr></table></figure>
</blockquote>
</li>
<li><p>ç»„é˜ŸæˆåŠŸï¼Œæäº¤æœ‰æˆåŠŸæœ‰å¤±è´¥æƒ…å†µ</p>
<blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">127.0.0.1:6379&gt; multi</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379(TX)&gt; set k1 v1</span><br><span class="line">QUEUED</span><br><span class="line">127.0.0.1:6379(TX)&gt; set k2 v2</span><br><span class="line">QUEUED</span><br><span class="line">127.0.0.1:6379(TX)&gt; incr k2</span><br><span class="line">QUEUED</span><br><span class="line">127.0.0.1:6379(TX)&gt; exec</span><br><span class="line">1) OK</span><br><span class="line">2) OK</span><br><span class="line">3) (error) ERR value is not an integer or out of range</span><br><span class="line">127.0.0.1:6379&gt; get k1</span><br><span class="line">&quot;v1&quot;</span><br><span class="line">127.0.0.1:6379&gt; get k2</span><br><span class="line">&quot;v2&quot;</span><br></pre></td></tr></table></figure></blockquote>
</li>
</ol>
<h2 id="äº‹åŠ¡çš„é”™è¯¯å¤„ç†"><a href="#äº‹åŠ¡çš„é”™è¯¯å¤„ç†" class="headerlink" title="äº‹åŠ¡çš„é”™è¯¯å¤„ç†"></a>äº‹åŠ¡çš„é”™è¯¯å¤„ç†</h2><p>ç»„é˜Ÿä¸­æŸä¸ªå‘½ä»¤å‡ºç°äº†æŠ¥å‘Šé”™è¯¯ï¼Œæ‰§è¡Œæ—¶æ•´ä¸ªçš„æ‰€æœ‰é˜Ÿåˆ—éƒ½ä¼šè¢«å–æ¶ˆã€‚</p>
<p>å¦‚æœæ‰§è¡Œé˜¶æ®µæŸä¸ªå‘½ä»¤æŠ¥é”™ï¼Œåˆ™åªæœ‰æŠ¥é”™çš„å‘½ä»¤ä¸ä¼šè¢«æ‰§è¡Œï¼Œè€Œå…¶ä»–çš„å‘½ä»¤éƒ½ä¼šæ‰§è¡Œï¼Œä¸ä¼šå›æ»šã€‚</p>
<h2 id="äº‹åŠ¡å†²çª"><a href="#äº‹åŠ¡å†²çª" class="headerlink" title="äº‹åŠ¡å†²çª"></a>äº‹åŠ¡å†²çª</h2><h3 id="æ‚²è§‚é”"><a href="#æ‚²è§‚é”" class="headerlink" title="æ‚²è§‚é”"></a><strong>æ‚²è§‚é”</strong></h3><p><img src="/2023/02/28/Redis/Java\Document\Redis\Redis.assets\image-20221007171853393.png" alt="image-20221007171853393"></p>
<p>â€‹		<strong>æ‚²è§‚é”(Pessimistic Lock)</strong>, é¡¾åæ€ä¹‰ï¼Œå°±æ˜¯å¾ˆæ‚²è§‚ï¼Œæ¯æ¬¡å»æ‹¿æ•°æ®çš„æ—¶å€™éƒ½è®¤ä¸ºåˆ«äººä¼šä¿®æ”¹ï¼Œæ‰€ä»¥æ¯æ¬¡åœ¨æ‹¿æ•°æ®çš„æ—¶å€™éƒ½ä¼šä¸Šé”ï¼Œè¿™æ ·åˆ«äººæƒ³æ‹¿è¿™ä¸ªæ•°æ®å°±ä¼šblockç›´åˆ°å®ƒæ‹¿åˆ°é”ã€‚<strong>ä¼ ç»Ÿçš„å…³ç³»å‹æ•°æ®åº“é‡Œè¾¹å°±ç”¨åˆ°äº†å¾ˆå¤šè¿™ç§é”æœºåˆ¶</strong>ï¼Œæ¯”å¦‚<strong>è¡Œé”</strong>ï¼Œ<strong>è¡¨é”</strong>ç­‰ï¼Œ<strong>è¯»é”</strong>ï¼Œ<strong>å†™é”</strong>ç­‰ï¼Œéƒ½æ˜¯åœ¨åšæ“ä½œä¹‹å‰å…ˆä¸Šé”ã€‚</p>
<h3 id="ä¹è§‚é”"><a href="#ä¹è§‚é”" class="headerlink" title="ä¹è§‚é”"></a><strong>ä¹è§‚é”</strong></h3><p><img src="/2023/02/28/Redis/Java\Document\Redis\Redis.assets\image-20221007172000166.png" alt="image-20221007172000166"></p>
<p>â€‹		<strong>ä¹è§‚é”(Optimistic Lock)ï¼Œé¡¾åæ€ä¹‰ï¼Œå°±æ˜¯å¾ˆä¹è§‚ï¼Œæ¯æ¬¡å»æ‹¿æ•°æ®çš„æ—¶å€™éƒ½è®¤ä¸ºåˆ«äººä¸ä¼šä¿®æ”¹ï¼Œæ‰€ä»¥ä¸ä¼šä¸Šé”ï¼Œä½†æ˜¯åœ¨æ›´æ–°çš„æ—¶å€™ä¼šåˆ¤æ–­ä¸€ä¸‹åœ¨æ­¤æœŸé—´åˆ«äººæœ‰æ²¡æœ‰å»æ›´æ–°è¿™ä¸ªæ•°æ®ï¼Œå¯ä»¥ä½¿ç”¨ç‰ˆæœ¬å·ç­‰æœºåˆ¶ã€‚</strong>ä¹è§‚é”é€‚ç”¨äºå¤šè¯»çš„åº”ç”¨ç±»å‹ï¼Œè¿™æ ·å¯ä»¥æé«˜ååé‡ã€‚Redis å°±æ˜¯åˆ©ç”¨è¿™ç§ check-and-set æœºåˆ¶å®ç°äº‹åŠ¡çš„ã€‚</p>
<h3 id="WATCH-key"><a href="#WATCH-key" class="headerlink" title="WATCH key"></a><strong>WATCH</strong> <strong>key</strong></h3><p>â€‹		åœ¨æ‰§è¡Œ multi ä¹‹å‰ï¼Œå…ˆæ‰§è¡Œ watch key1 [key2]ï¼Œå¯ä»¥ç›‘è§†ä¸€ä¸ª(æˆ–å¤šä¸ª) key ï¼Œ<strong>å¦‚æœåœ¨äº‹åŠ¡æ‰§è¡Œä¹‹å‰è¿™ä¸ª(æˆ–è¿™äº›) keyè¢«å…¶ä»–å‘½ä»¤æ‰€æ”¹åŠ¨ï¼Œé‚£ä¹ˆäº‹åŠ¡å°†è¢«æ‰“æ–­ã€‚</strong></p>
<p>ç¤ºä¾‹ï¼šå¼€å¯ä¸¤ä¸ªå®¢æˆ·ç«¯æµ‹è¯•</p>
<p>å®¢æˆ·ç«¯ä¸€ï¼š</p>
<blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">127.0.0.1:6379&gt; watch balance</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; multi</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379(TX)&gt; decrby balance 20</span><br><span class="line">QUEUED</span><br><span class="line">127.0.0.1:6379(TX)&gt; exec</span><br><span class="line">1) (integer) 80</span><br><span class="line">127.0.0.1:6379&gt;</span><br></pre></td></tr></table></figure>
</blockquote>
<p>å®¢æˆ·ç«¯äºŒï¼š</p>
<blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">127.0.0.1:6379&gt; watch balance</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; multi</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379(TX)&gt; incrby balance 10</span><br><span class="line">QUEUED</span><br><span class="line">127.0.0.1:6379(TX)&gt; exec</span><br><span class="line">(nil)</span><br><span class="line">127.0.0.1:6379&gt;</span><br></pre></td></tr></table></figure>

<p>å®¢æˆ·ç«¯äºŒ exec æ—¶ï¼Œä¸ä¼šæ‰§è¡Œæ“ä½œï¼Œè¿”å› nilã€‚</p>
</blockquote>
<h3 id="unwatch"><a href="#unwatch" class="headerlink" title="unwatch"></a><strong>unwatch</strong></h3><p>å–æ¶ˆ WATCH å‘½ä»¤å¯¹æ‰€æœ‰ key çš„ç›‘è§†ã€‚</p>
<p>å¦‚æœåœ¨æ‰§è¡Œ WATCH å‘½ä»¤ä¹‹åï¼ŒEXEC å‘½ä»¤æˆ–DISCARD å‘½ä»¤å…ˆè¢«æ‰§è¡Œäº†çš„è¯ï¼Œé‚£ä¹ˆå°±ä¸éœ€è¦å†æ‰§è¡ŒUNWATCH äº†ã€‚</p>
<p><a href="http://doc.redisfans.com/transaction/exec.html">http://doc.redisfans.com/transaction/exec.html</a></p>
<h2 id="Redis-äº‹åŠ¡ä¸‰ç‰¹æ€§"><a href="#Redis-äº‹åŠ¡ä¸‰ç‰¹æ€§" class="headerlink" title="**Redis **äº‹åŠ¡ä¸‰ç‰¹æ€§"></a>**Redis **äº‹åŠ¡ä¸‰ç‰¹æ€§</h2><ol>
<li><p>å•ç‹¬çš„éš”ç¦»æ“ä½œ </p>
<p> â€‹	äº‹åŠ¡ä¸­çš„æ‰€æœ‰å‘½ä»¤éƒ½ä¼šåºåˆ—åŒ–ã€æŒ‰é¡ºåºåœ°æ‰§è¡Œã€‚äº‹åŠ¡åœ¨æ‰§è¡Œçš„è¿‡ç¨‹ä¸­ï¼Œä¸ä¼šè¢«å…¶ä»–å®¢æˆ·ç«¯å‘é€æ¥çš„å‘½ä»¤è¯·æ±‚æ‰€æ‰“æ–­ã€‚ </p>
</li>
<li><p>æ²¡æœ‰éš”ç¦»çº§åˆ«çš„æ¦‚å¿µ </p>
<p> â€‹	é˜Ÿåˆ—ä¸­çš„å‘½ä»¤æ²¡æœ‰æäº¤ä¹‹å‰éƒ½ä¸ä¼šå®é™…è¢«æ‰§è¡Œï¼Œå› ä¸ºäº‹åŠ¡æäº¤å‰ä»»ä½•æŒ‡ä»¤éƒ½ä¸ä¼šè¢«å®é™…æ‰§è¡Œ</p>
</li>
<li><p>ä¸ä¿è¯åŸå­æ€§ </p>
<p> â€‹	äº‹åŠ¡ä¸­å¦‚æœæœ‰ä¸€æ¡å‘½ä»¤æ‰§è¡Œå¤±è´¥ï¼Œå…¶åçš„å‘½ä»¤ä»ç„¶ä¼šè¢«æ‰§è¡Œï¼Œæ²¡æœ‰å›æ»š</p>
</li>
</ol>
<h2 id="Redisäº‹åŠ¡ï¼šç§’æ€ç¤ºä¾‹"><a href="#Redisäº‹åŠ¡ï¼šç§’æ€ç¤ºä¾‹" class="headerlink" title="Redisäº‹åŠ¡ï¼šç§’æ€ç¤ºä¾‹"></a>Redisäº‹åŠ¡ï¼šç§’æ€ç¤ºä¾‹</h2><p>å°†åº“å­˜ä¿¡æ¯ä»¥åŠç§’æ€æˆåŠŸç”¨æˆ·æ”¾å…¥Redis</p>
<h3 id="åŸºæœ¬ä»£ç "><a href="#åŸºæœ¬ä»£ç " class="headerlink" title="åŸºæœ¬ä»£ç "></a>åŸºæœ¬ä»£ç </h3><p>Idea å»ºç«‹ web å·¥ç¨‹ï¼š</p>
<p>index.jsp</p>
<blockquote>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line">&lt;%@ page language=&quot;java&quot; contentType=&quot;text/html; charset=UTF-8&quot;</span><br><span class="line">         pageEncoding=&quot;UTF-8&quot; %&gt;</span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span> <span class="keyword">PUBLIC</span> <span class="string">&quot;-//W3C//DTD HTML 4.01 Transitional//EN&quot;</span> <span class="string">&quot;http://www.w3.org/TR/html4/loose.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">&quot;Content-Type&quot;</span> <span class="attr">content</span>=<span class="string">&quot;text/html; charset=UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Insert title here<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>å•†å“ç§’æ€ï¼ï¼ï¼<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">id</span>=<span class="string">&quot;msform&quot;</span> <span class="attr">action</span>=<span class="string">&quot;$&#123;pageContext.request.contextPath&#125;/doseckill&quot;</span> <span class="attr">enctype</span>=<span class="string">&quot;application/x-www-form-urlencoded&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;hidden&quot;</span> <span class="attr">id</span>=<span class="string">&quot;prodid&quot;</span> <span class="attr">name</span>=<span class="string">&quot;prodId&quot;</span> <span class="attr">value</span>=<span class="string">&quot;0101&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;button&quot;</span> <span class="attr">id</span>=<span class="string">&quot;miaosha_btn&quot;</span> <span class="attr">name</span>=<span class="string">&quot;seckill_btn&quot;</span> <span class="attr">value</span>=<span class="string">&quot;ç‚¹å‡»ç§’æ€&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span> <span class="attr">src</span>=<span class="string">&quot;$&#123;pageContext.request.contextPath&#125;/script/jquery/jquery-3.1.0.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    $(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        $(<span class="string">&quot;#miaosha_btn&quot;</span>).<span class="title function_">click</span>(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">var</span> url = $(<span class="string">&quot;#msform&quot;</span>).<span class="title function_">attr</span>(<span class="string">&quot;action&quot;</span>);</span></span><br><span class="line"><span class="language-javascript">            $.<span class="title function_">post</span>(url, $(<span class="string">&quot;#msform&quot;</span>).<span class="title function_">serialize</span>(), <span class="keyword">function</span> (<span class="params">data</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="keyword">if</span> (data == <span class="string">&quot;false&quot;</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="title function_">alert</span>(<span class="string">&quot;æŠ¢å…‰äº†&quot;</span>);</span></span><br><span class="line"><span class="language-javascript">                    $(<span class="string">&quot;#miaosha_btn&quot;</span>).<span class="title function_">attr</span>(<span class="string">&quot;disabled&quot;</span>, <span class="literal">true</span>);</span></span><br><span class="line"><span class="language-javascript">                &#125;</span></span><br><span class="line"><span class="language-javascript">            &#125;);</span></span><br><span class="line"><span class="language-javascript">        &#125;)</span></span><br><span class="line"><span class="language-javascript">    &#125;)</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
</blockquote>
<p>servletï¼š</p>
<blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.servlet;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.util.Random;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SecondKillServlet</span> <span class="keyword">extends</span> <span class="title class_">HttpServlet</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">long</span> <span class="variable">serialVersionUID</span> <span class="operator">=</span> <span class="number">1L</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doGet</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        <span class="built_in">this</span>.doPost(req, resp);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ä½¿ç”¨ ab å·¥å…·æ¨¡æ‹Ÿæµ‹è¯•ï¼š</span></span><br><span class="line"><span class="comment">     * vim postfile</span></span><br><span class="line"><span class="comment">     *      prodId=0101&amp;</span></span><br><span class="line"><span class="comment">     * ab -n 2000 -c 200 -p ~/postfile -T application/x-www-form-urlencoded http://192.168.50.211:8080/seckill/doseckill</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> request</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> response</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doPost</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">userId</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Random</span>().nextInt(<span class="number">50000</span>) + <span class="string">&quot;&quot;</span>;</span><br><span class="line">        <span class="type">String</span> <span class="variable">prodId</span> <span class="operator">=</span> request.getParameter(<span class="string">&quot;prodId&quot;</span>);</span><br><span class="line">        <span class="comment">// æ¨¡æ‹Ÿåº“å­˜ï¼šset sc:0101:qt 10</span></span><br><span class="line">        <span class="type">boolean</span> <span class="variable">result</span> <span class="operator">=</span> SecondKill_redis.doSecondKill(userId, prodId);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</blockquote>
<p><strong>è¿æ¥æ± ï¼šä½¿ç”¨è¿æ¥æ± è§£å†³è¯·æ±‚æ•°é‡è¿‡å¤šæ—¶é€ æˆçš„è¿æ¥è¶…æ—¶é—®é¢˜ã€‚</strong></p>
<p>è¿æ¥æ± å‚æ•°ï¼š</p>
<ul>
<li>MaxTotalï¼šæ§åˆ¶ä¸€ä¸ªpoolå¯åˆ†é…å¤šå°‘ä¸ªjediså®ä¾‹ï¼Œé€šè¿‡pool.getResource()æ¥è·å–ï¼›å¦‚æœèµ‹å€¼ä¸º-1ï¼Œåˆ™è¡¨ç¤ºä¸é™åˆ¶ï¼›å¦‚æœpoolå·²ç»åˆ†é…äº†MaxTotalä¸ªjediså®ä¾‹ï¼Œåˆ™æ­¤æ—¶poolçš„çŠ¶æ€ä¸ºexhaustedã€‚</li>
<li>maxIdleï¼šæ§åˆ¶ä¸€ä¸ªpoolæœ€å¤šæœ‰å¤šå°‘ä¸ªçŠ¶æ€ä¸ºidle(ç©ºé—²)çš„jediså®ä¾‹ã€‚</li>
<li>MaxWaitMillisï¼šè¡¨ç¤ºå½“borrowä¸€ä¸ªjediså®ä¾‹æ—¶ï¼Œæœ€å¤§çš„ç­‰å¾…æ¯«ç§’æ•°ï¼Œå¦‚æœè¶…è¿‡ç­‰å¾…æ—¶é—´ï¼Œåˆ™ç›´æ¥æŠ›JedisConnectionExceptionã€‚</li>
<li>testOnBorrowï¼šè·å¾—ä¸€ä¸ªjediså®ä¾‹çš„æ—¶å€™æ˜¯å¦æ£€æŸ¥è¿æ¥å¯ç”¨æ€§ï¼ˆping()ï¼‰ï¼›å¦‚æœä¸ºtrueï¼Œåˆ™å¾—åˆ°çš„jediså®ä¾‹å‡æ˜¯å¯ç”¨çš„ã€‚</li>
</ul>
<blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.servlet;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> redis.clients.jedis.Jedis;</span><br><span class="line"><span class="keyword">import</span> redis.clients.jedis.JedisPool;</span><br><span class="line"><span class="keyword">import</span> redis.clients.jedis.JedisPoolConfig;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JedisPoolUtil</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">volatile</span> JedisPool jedisPool;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">JedisPoolUtil</span><span class="params">()</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> JedisPool <span class="title function_">getJedisPoolInstance</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (jedisPool == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">synchronized</span> (JedisPoolUtil.class) &#123;</span><br><span class="line">                <span class="keyword">if</span> (jedisPool == <span class="literal">null</span>) &#123;</span><br><span class="line">                    <span class="type">JedisPoolConfig</span> <span class="variable">poolConfig</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">JedisPoolConfig</span>();</span><br><span class="line">                    poolConfig.setMaxTotal(<span class="number">200</span>);</span><br><span class="line">                    poolConfig.setMaxIdle(<span class="number">32</span>);</span><br><span class="line">                    poolConfig.setMaxWaitMillis(<span class="number">100</span> * <span class="number">1000</span>);</span><br><span class="line">                    poolConfig.setBlockWhenExhausted(<span class="literal">true</span>);</span><br><span class="line">                    poolConfig.setTestOnBorrow(<span class="literal">true</span>);</span><br><span class="line">                    jedisPool = <span class="keyword">new</span> <span class="title class_">JedisPool</span>(poolConfig, <span class="string">&quot;192.168.100.100&quot;</span>, <span class="number">6379</span>, <span class="number">60000</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> jedisPool;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">release</span><span class="params">(JedisPool jedisPool, Jedis jedis)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (jedis != <span class="literal">null</span>) &#123;</span><br><span class="line">            jedisPool.returnResource(jedis);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</blockquote>
<p>ç§’æ€ä»£ç ï¼š</p>
<blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.servlet;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> redis.clients.jedis.Jedis;</span><br><span class="line"><span class="keyword">import</span> redis.clients.jedis.JedisPool;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SecondKill_redis</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">boolean</span> <span class="title function_">doSecondKill</span><span class="params">(String userId, String prodId)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (userId == <span class="literal">null</span> || prodId == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">JedisPool</span> <span class="variable">jedisPool</span> <span class="operator">=</span> JedisPoolUtil.getJedisPoolInstance();</span><br><span class="line">        <span class="type">Jedis</span> <span class="variable">jedis</span> <span class="operator">=</span> jedisPool.getResource();</span><br><span class="line">        <span class="type">String</span> <span class="variable">kcKey</span> <span class="operator">=</span> <span class="string">&quot;sk:&quot;</span> + prodId + <span class="string">&quot;:qt&quot;</span>;</span><br><span class="line">        <span class="type">String</span> <span class="variable">userKey</span> <span class="operator">=</span> <span class="string">&quot;sk:&quot;</span> + prodId + <span class="string">&quot;:user&quot;</span>;</span><br><span class="line">        <span class="type">String</span> <span class="variable">kc</span> <span class="operator">=</span> jedis.get(kcKey);</span><br><span class="line">        <span class="keyword">if</span> (kc == <span class="literal">null</span>) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;ç§’æ€è¿˜æ²¡å¼€å§‹ï¼Œè¯·ç­‰å¾…...&quot;</span>);</span><br><span class="line">            jedis.close();</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (jedis.sismember(userKey, userId)) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;ç§’æ€å·²ç»æˆåŠŸï¼Œä¸èƒ½é‡å¤ç§’æ€...&quot;</span>);</span><br><span class="line">            jedis.close();</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (Integer.parseInt(kc) &lt;= <span class="number">0</span>) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;ç§’æ€å·²ç»ç»“æŸ...&quot;</span>);</span><br><span class="line">            jedis.close();</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        jedis.decr(kcKey);</span><br><span class="line">        jedis.sadd(userKey, userId);</span><br><span class="line">        System.out.println(<span class="string">&quot;ç§’æ€æˆåŠŸ...&quot;</span>);</span><br><span class="line">        jedis.close();</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</blockquote>
<p>æµ‹è¯•ï¼š</p>
<p>redis è®¾ç½®å•†å“åº“å­˜ï¼šset sk:0101:qt 10</p>
<h3 id="ab-å·¥å…·ä½¿ç”¨"><a href="#ab-å·¥å…·ä½¿ç”¨" class="headerlink" title="ab å·¥å…·ä½¿ç”¨"></a>ab å·¥å…·ä½¿ç”¨</h3><p>ä½¿ç”¨ ab å·¥å…·æ¨¡æ‹Ÿå¹¶å‘æ“ä½œã€‚</p>
<p>CentOS6 é»˜è®¤å®‰è£…</p>
<p>CentOS7 éœ€è¦æ‰‹åŠ¨å®‰è£…ï¼šyum install httpd-tools</p>
<p><strong>æ— ç½‘ç»œ</strong></p>
<p>ï¼ˆ1ï¼‰ è¿›å…¥cd &#x2F;run&#x2F;media&#x2F;root&#x2F;CentOS 7 x86_64&#x2F;Packagesï¼ˆè·¯å¾„è·Ÿcentos6ä¸åŒï¼‰</p>
<p>ï¼ˆ2ï¼‰ é¡ºåºå®‰è£…</p>
<ul>
<li>apr-1.4.8-3.el7.x86_64.rpm</li>
<li>apr-util-1.5.2-6.el7.x86_64.rpm</li>
<li>httpd-tools-2.4.6-67.el7.centos.x86_64.rpm</li>
</ul>
<p>ab å‘½ä»¤ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">ab -n 2000 -c 200 -p ~/postfile -T application/x-www-form-urlencoded http://192.168.50.211:8080/seckill/doseckill</span><br></pre></td></tr></table></figure>

<p>-n	è¯·æ±‚æ•°é‡</p>
<p>-c	å¹¶å‘æ•°é‡</p>
<p>-T	application&#x2F;x-www-form-urlencoded </p>
<p>-p	postè¯·æ±‚æ–‡ä»¶ï¼Œéœ€è¦åˆ›å»ºè¯¥æ–‡ä»¶</p>
<p>â€‹		vim postfile æ¨¡æ‹Ÿè¡¨å•æäº¤å‚æ•°ï¼Œä»¥&amp;ç¬¦å·ç»“å°¾;å­˜æ”¾å½“å‰ç›®å½•ã€‚</p>
<p>â€‹		å†…å®¹ï¼šprodId&#x3D;0101&amp;</p>
<p>æµ‹è¯•ï¼š</p>
<p>å‡ºç°è¶…å–é—®é¢˜ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">127.0.0.1:6379&gt; get sk:0101:qt</span><br><span class="line">&quot;-4&quot;127.0.0.1:6379&gt; SMEMBERS sk:0101:user</span><br><span class="line"> 1) &quot;311&quot;</span><br><span class="line"> 2) &quot;1862&quot;</span><br><span class="line"> 3) &quot;4314&quot;</span><br><span class="line"> 4) &quot;7396&quot;</span><br><span class="line"> 5) &quot;21514&quot;</span><br><span class="line"> 6) &quot;22009&quot;</span><br><span class="line"> 7) &quot;24781&quot;</span><br><span class="line"> 8) &quot;24884&quot;</span><br><span class="line"> 9) &quot;29747&quot;</span><br><span class="line">10) &quot;33970&quot;</span><br><span class="line">11) &quot;35109&quot;</span><br><span class="line">12) &quot;35508&quot;</span><br><span class="line">13) &quot;36228&quot;</span><br><span class="line">14) &quot;49708&quot;</span><br><span class="line">127.0.0.1:6379&gt; get sk:0101:qt</span><br><span class="line">&quot;-&quot;</span><br><span class="line">127.0.0.1:6379&gt;</span><br></pre></td></tr></table></figure>



<h3 id="è¶…å–é—®é¢˜"><a href="#è¶…å–é—®é¢˜" class="headerlink" title="è¶…å–é—®é¢˜"></a>è¶…å–é—®é¢˜</h3><img src="/2023/02/28/Redis/Java\Document\Redis\Redis.assets\image-20221009174213877.png" alt="image-20221009174213877" style="zoom:80%;">

<p><strong>åˆ©ç”¨ä¹è§‚é”æ·˜æ±°ç”¨æˆ·ï¼Œè§£å†³è¶…å–é—®é¢˜ã€‚</strong>ã€watch multi execã€‘</p>
<p>ä¿®æ”¹ä»£ç ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.servlet;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> redis.clients.jedis.Jedis;</span><br><span class="line"><span class="keyword">import</span> redis.clients.jedis.JedisPool;</span><br><span class="line"><span class="keyword">import</span> redis.clients.jedis.Transaction;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SecondKill_redis_chaomai</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">boolean</span> <span class="title function_">doSecondKill</span><span class="params">(String userId, String prodId)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (userId == <span class="literal">null</span> || prodId == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">JedisPool</span> <span class="variable">jedisPool</span> <span class="operator">=</span> JedisPoolUtil.getJedisPoolInstance();</span><br><span class="line">        <span class="type">Jedis</span> <span class="variable">jedis</span> <span class="operator">=</span> jedisPool.getResource();</span><br><span class="line">        <span class="type">String</span> <span class="variable">kcKey</span> <span class="operator">=</span> <span class="string">&quot;sk:&quot;</span> + prodId + <span class="string">&quot;:qt&quot;</span>;</span><br><span class="line">        <span class="type">String</span> <span class="variable">userKey</span> <span class="operator">=</span> <span class="string">&quot;sk:&quot;</span> + prodId + <span class="string">&quot;:user&quot;</span>;</span><br><span class="line">        <span class="comment">// ç›‘è§†åº“å­˜</span></span><br><span class="line">        jedis.watch(kcKey);</span><br><span class="line"></span><br><span class="line">        <span class="type">String</span> <span class="variable">kc</span> <span class="operator">=</span> jedis.get(kcKey);</span><br><span class="line">        <span class="keyword">if</span> (kc == <span class="literal">null</span>) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;ç§’æ€è¿˜æ²¡å¼€å§‹ï¼Œè¯·ç­‰å¾…...&quot;</span>);</span><br><span class="line">            jedis.close();</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (jedis.sismember(userKey, userId)) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;ç§’æ€å·²ç»æˆåŠŸï¼Œä¸èƒ½é‡å¤ç§’æ€...&quot;</span>);</span><br><span class="line">            jedis.close();</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (Integer.parseInt(kc) &lt;= <span class="number">0</span>) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;ç§’æ€å·²ç»ç»“æŸ...&quot;</span>);</span><br><span class="line">            jedis.close();</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// ä½¿ç”¨äº‹åŠ¡</span></span><br><span class="line">        <span class="type">Transaction</span> <span class="variable">multi</span> <span class="operator">=</span> jedis.multi();</span><br><span class="line">        multi.decr(kcKey);</span><br><span class="line">        multi.sadd(userKey, userId);</span><br><span class="line">        List&lt;Object&gt; exec = multi.exec();</span><br><span class="line">        <span class="keyword">if</span> (exec == <span class="literal">null</span> || exec.size() == <span class="number">0</span>) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;ç§’æ€å¤±è´¥....&quot;</span>);</span><br><span class="line">            jedis.close();</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(<span class="string">&quot;ç§’æ€æˆåŠŸ...&quot;</span>);</span><br><span class="line">        jedis.close();</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å†æ¬¡æµ‹è¯•ï¼Œæ²¡æœ‰è¶…å–é—®é¢˜ã€‚</p>
<p>ä¿®æ”¹åº“å­˜æ•°é‡ï¼šset sk:0101:qt 500</p>
<p>å‡ºç°äº†åº“å­˜é—ç•™é—®é¢˜ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">127.0.0.1:6379&gt; set sk:0101:qt 500</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; get sk:0101:qt</span><br><span class="line">&quot;463&quot;</span><br></pre></td></tr></table></figure>

<h3 id="åº“å­˜é—ç•™é—®é¢˜"><a href="#åº“å­˜é—ç•™é—®é¢˜" class="headerlink" title="åº“å­˜é—ç•™é—®é¢˜"></a>åº“å­˜é—ç•™é—®é¢˜</h3><p>åº“å­˜é—ç•™é—®é¢˜æ˜¯ç”±äºä¹è§‚é”äº§ç”Ÿçš„ã€‚</p>
<p>ä½¿ç”¨ä¹è§‚é”æ—¶ï¼Œä¼šé”å®šå½“å‰æ“ä½œçš„æ•°æ®ç‰ˆæœ¬ï¼Œå…¶ä»–è¯·æ±‚ä¸ä¼šå¤„ç†ï¼Œé€ æˆåº“å­˜é—ç•™ã€‚</p>
<p>è§£å†³æ–¹æ¡ˆï¼š<strong>LUA</strong>è„šæœ¬</p>
<p>Lua æ˜¯ä¸€ä¸ªå°å·§çš„ <a href="http://baike.baidu.com/item/%E8%84%9A%E6%9C%AC%E8%AF%AD%E8%A8%80">è„šæœ¬è¯­è¨€</a>ï¼ŒLuaè„šæœ¬å¯ä»¥å¾ˆå®¹æ˜“çš„è¢«C&#x2F;C++ ä»£ç è°ƒç”¨ï¼Œä¹Ÿå¯ä»¥åè¿‡æ¥è°ƒç”¨C&#x2F;C++çš„å‡½æ•°ï¼ŒLuaå¹¶æ²¡æœ‰æä¾›å¼ºå¤§çš„åº“ï¼Œä¸€ä¸ªå®Œæ•´çš„Luaè§£é‡Šå™¨ä¸è¿‡200kï¼Œæ‰€ä»¥Luaä¸é€‚åˆä½œä¸ºå¼€å‘ç‹¬ç«‹åº”ç”¨ç¨‹åºçš„è¯­è¨€ï¼Œè€Œæ˜¯ä½œä¸ºåµŒå…¥å¼è„šæœ¬è¯­è¨€ã€‚</p>
<p>å¾ˆå¤šåº”ç”¨ç¨‹åºã€æ¸¸æˆä½¿ç”¨LUAä½œä¸ºè‡ªå·±çš„åµŒå…¥å¼è„šæœ¬è¯­è¨€ï¼Œä»¥æ­¤æ¥å®ç°å¯é…ç½®æ€§ã€å¯æ‰©å±•æ€§ã€‚</p>
<p><a href="https://www.w3cschool.cn/lua/">https://www.w3cschool.cn/lua/</a></p>
<p><strong>Lua è„šæœ¬å¤„ç†åº“å­˜é—ç•™é—®é¢˜ï¼š</strong></p>
<p><strong>å°†å¤æ‚çš„æˆ–è€…å¤šæ­¥çš„ redis æ“ä½œï¼Œå†™ä¸ºä¸€ä¸ªè„šæœ¬ï¼Œä¸€æ¬¡æäº¤ç»™ redis æ‰§è¡Œï¼Œå‡å°‘åå¤è¿æ¥ redis çš„æ¬¡æ•°ã€‚æå‡æ€§èƒ½ã€‚</strong></p>
<p>LUA è„šæœ¬æ˜¯ç±»ä¼¼ redis äº‹åŠ¡ï¼Œæœ‰ä¸€å®šçš„åŸå­æ€§ï¼Œä¸ä¼šè¢«å…¶ä»–å‘½ä»¤æ’é˜Ÿï¼Œå¯ä»¥å®Œæˆä¸€äº› redis äº‹åŠ¡æ€§çš„æ“ä½œã€‚</p>
<p>ä½†æ˜¯æ³¨æ„ redis çš„ lua è„šæœ¬åŠŸèƒ½ï¼Œåªæœ‰åœ¨ Redis 2.6 ä»¥ä¸Šçš„ç‰ˆæœ¬æ‰å¯ä»¥ä½¿ç”¨ã€‚</p>
<p>åˆ©ç”¨ lua è„šæœ¬æ·˜æ±°ç”¨æˆ·ï¼Œè§£å†³è¶…å–é—®é¢˜ã€‚</p>
<p>redis 2.6 ç‰ˆæœ¬ä»¥åï¼Œé€šè¿‡ lua è„šæœ¬è§£å†³<strong>äº‰æŠ¢é—®é¢˜</strong>ï¼Œå®é™…ä¸Šæ˜¯ <strong>redis</strong> <strong>åˆ©ç”¨å…¶å•çº¿ç¨‹çš„ç‰¹æ€§ï¼Œç”¨ä»»åŠ¡é˜Ÿåˆ—çš„æ–¹å¼è§£å†³å¤šä»»åŠ¡å¹¶å‘é—®é¢˜</strong>ã€‚</p>
<p>Luaï¼š</p>
<blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">local userid=KEYS[1]; </span><br><span class="line">local prodid=KEYS[2];</span><br><span class="line">local qtkey=&quot;sk:&quot;..prodid..&quot;:qt&quot;;</span><br><span class="line">local usersKey=&quot;sk:&quot;..prodid.&quot;:usr&#x27;; </span><br><span class="line">local userExists=redis.call(&quot;sismember&quot;,usersKey,userid);</span><br><span class="line">if tonumber(userExists)==1 then </span><br><span class="line">  return 2;</span><br><span class="line">end</span><br><span class="line">local num= redis.call(&quot;get&quot; ,qtkey);</span><br><span class="line">if tonumber(num)&lt;=0 then </span><br><span class="line">  return 0; </span><br><span class="line">else </span><br><span class="line">  redis.call(&quot;decr&quot;,qtkey);</span><br><span class="line">  redis.call(&quot;sadd&quot;,usersKey,userid);</span><br><span class="line">end</span><br><span class="line">return 1;</span><br></pre></td></tr></table></figure>
</blockquote>
<p>ä»£ç ä¿®æ”¹ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.servlet;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> redis.clients.jedis.Jedis;</span><br><span class="line"><span class="keyword">import</span> redis.clients.jedis.JedisPool;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SecondKill_Redis_LuaScript</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">static</span> <span class="type">String</span> <span class="variable">secKillScript</span> <span class="operator">=</span> <span class="string">&quot;local userId=KEYS[1];\r\n&quot;</span> +</span><br><span class="line">            <span class="string">&quot;local prodId=KEYS[2];\r\n&quot;</span> +</span><br><span class="line">            <span class="string">&quot;local qtkey=&#x27;sk:&#x27;..prodId..\&quot;:qt\&quot;;\r\n&quot;</span> +</span><br><span class="line">            <span class="string">&quot;local usersKey=&#x27;sk:&#x27;..prodId..\&quot;:usr\&quot;;\r\n&quot;</span> +</span><br><span class="line">            <span class="string">&quot;local userExists=redis.call(\&quot;sismember\&quot;,usersKey,userId);\r\n&quot;</span> +</span><br><span class="line">            <span class="string">&quot;if tonumber(userExists)==1 then \r\n&quot;</span> +</span><br><span class="line">            <span class="string">&quot;   return 2;\r\n&quot;</span> +</span><br><span class="line">            <span class="string">&quot;end\r\n&quot;</span> +</span><br><span class="line">            <span class="string">&quot;local num= redis.call(\&quot;get\&quot; ,qtkey);\r\n&quot;</span> +</span><br><span class="line">            <span class="string">&quot;if tonumber(num)&lt;=0 then \r\n&quot;</span> +</span><br><span class="line">            <span class="string">&quot;   return 0;\r\n&quot;</span> +</span><br><span class="line">            <span class="string">&quot;else \r\n&quot;</span> +</span><br><span class="line">            <span class="string">&quot;   redis.call(\&quot;decr\&quot;,qtkey);\r\n&quot;</span> +</span><br><span class="line">            <span class="string">&quot;   redis.call(\&quot;sadd\&quot;,usersKey,userId);\r\n&quot;</span> +</span><br><span class="line">            <span class="string">&quot;end\r\n&quot;</span> +</span><br><span class="line">            <span class="string">&quot;return 1&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="type">String</span> <span class="variable">secKillScript2</span> <span class="operator">=</span></span><br><span class="line">            <span class="string">&quot;local userExists=redis.call(\&quot;sismember\&quot;,\&quot;&#123;sk&#125;:0101:usr\&quot;,userid);\r\n&quot;</span> +</span><br><span class="line">                    <span class="string">&quot; return 1&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">boolean</span> <span class="title function_">doSecKill</span><span class="params">(String userId, String prodId)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line"></span><br><span class="line">        <span class="type">JedisPool</span> <span class="variable">jedispool</span> <span class="operator">=</span> JedisPoolUtil.getJedisPoolInstance();</span><br><span class="line">        <span class="type">Jedis</span> <span class="variable">jedis</span> <span class="operator">=</span> jedispool.getResource();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//String sha1=  .secKillScript;</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">sha1</span> <span class="operator">=</span> jedis.scriptLoad(secKillScript);</span><br><span class="line">        <span class="type">Object</span> <span class="variable">result</span> <span class="operator">=</span> jedis.evalsha(sha1, <span class="number">2</span>, userId, prodId);</span><br><span class="line"></span><br><span class="line">        <span class="type">String</span> <span class="variable">reString</span> <span class="operator">=</span> String.valueOf(result);</span><br><span class="line">        <span class="keyword">if</span> (<span class="string">&quot;0&quot;</span>.equals(reString)) &#123;</span><br><span class="line">            System.err.println(<span class="string">&quot;å·²æŠ¢ç©ºï¼ï¼&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="string">&quot;1&quot;</span>.equals(reString)) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;æŠ¢è´­æˆåŠŸï¼ï¼ï¼ï¼&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="string">&quot;2&quot;</span>.equals(reString)) &#123;</span><br><span class="line">            System.err.println(<span class="string">&quot;è¯¥ç”¨æˆ·å·²æŠ¢è¿‡ï¼ï¼&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            System.err.println(<span class="string">&quot;æŠ¢è´­å¼‚å¸¸ï¼ï¼&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        jedis.close();</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h1 id="Redis-æŒä¹…åŒ–"><a href="#Redis-æŒä¹…åŒ–" class="headerlink" title="Redis æŒä¹…åŒ–"></a>Redis æŒä¹…åŒ–</h1><p>Redis æä¾›äº†2ä¸ªä¸åŒå½¢å¼çš„æŒä¹…åŒ–æ–¹å¼ã€‚</p>
<ul>
<li>RDBï¼ˆRedis DataBaseï¼‰</li>
<li>AOFï¼ˆAppend Of Fileï¼‰</li>
</ul>
<p><img src="/2023/02/28/Redis/Java\Document\Redis\Redis.assets\image-20221008145146719.png" alt="image-20221008145146719"></p>
<h2 id="RDB-Redis-DataBase"><a href="#RDB-Redis-DataBase" class="headerlink" title="RDB (Redis DataBase)"></a>RDB (Redis DataBase)</h2><h3 id="å®˜ç½‘ä»‹ç»"><a href="#å®˜ç½‘ä»‹ç»" class="headerlink" title="å®˜ç½‘ä»‹ç»"></a>å®˜ç½‘ä»‹ç»</h3><p><img src="/2023/02/28/Redis/Java\Document\Redis\Redis.assets\image-20221008151537055.png" alt="image-20221008151537055"></p>
<h3 id="å®šä¹‰"><a href="#å®šä¹‰" class="headerlink" title="å®šä¹‰"></a>å®šä¹‰</h3><p>â€‹		åœ¨æŒ‡å®šçš„æ—¶é—´é—´éš”å†…å°†å†…å­˜ä¸­çš„æ•°æ®é›†å¿«ç…§å†™å…¥ç£ç›˜ï¼Œ å³ Snapshot å¿«ç…§ï¼Œå®ƒæ¢å¤æ—¶æ˜¯å°†å¿«ç…§æ–‡ä»¶ç›´æ¥è¯»åˆ°å†…å­˜é‡Œã€‚</p>
<h3 id="å¤‡ä»½æ–‡ä»¶çš„æ‰§è¡Œ"><a href="#å¤‡ä»½æ–‡ä»¶çš„æ‰§è¡Œ" class="headerlink" title="å¤‡ä»½æ–‡ä»¶çš„æ‰§è¡Œ"></a>å¤‡ä»½æ–‡ä»¶çš„æ‰§è¡Œ</h3><p>â€‹		Redisä¼šå•ç‹¬åˆ›å»ºï¼ˆforkï¼‰ä¸€ä¸ªå­è¿›ç¨‹æ¥è¿›è¡ŒæŒä¹…åŒ–ï¼Œä¼šå…ˆå°†æ•°æ®å†™å…¥åˆ° ä¸€ä¸ªä¸´æ—¶æ–‡ä»¶ä¸­ï¼Œå¾…æŒä¹…åŒ–è¿‡ç¨‹éƒ½ç»“æŸäº†ï¼Œå†ç”¨è¿™ä¸ªä¸´æ—¶æ–‡ä»¶æ›¿æ¢ä¸Šæ¬¡æŒä¹…åŒ–å¥½çš„æ–‡ä»¶ï¼ˆé˜²æ­¢ä¸­é—´å‡ºç°å®•æœºå¯¼è‡´æ•°æ®ä¸¢å¤±ï¼‰ã€‚ æ•´ä¸ªè¿‡ç¨‹ä¸­ï¼Œä¸»è¿›ç¨‹æ˜¯ä¸è¿›è¡Œä»»ä½• IO æ“ä½œçš„ï¼Œè¿™å°±ç¡®ä¿äº†æé«˜çš„æ€§èƒ½ã€‚<strong>å¦‚æœéœ€è¦è¿›è¡Œå¤§è§„æ¨¡æ•°æ®çš„æ¢å¤ï¼Œä¸”å¯¹äºæ•°æ®æ¢å¤çš„å®Œæ•´æ€§ä¸æ˜¯éå¸¸æ•æ„Ÿï¼Œé‚£RDBæ–¹å¼è¦æ¯”AOFæ–¹å¼æ›´åŠ çš„é«˜æ•ˆã€‚RDBçš„ç¼ºç‚¹æ˜¯æœ€åä¸€æ¬¡æŒä¹…åŒ–åçš„æ•°æ®å¯èƒ½ä¸¢å¤±ã€‚</strong></p>
<h3 id="Fork"><a href="#Fork" class="headerlink" title="Fork"></a>Fork</h3><ol>
<li><p>Forkçš„ä½œç”¨æ˜¯å¤åˆ¶ä¸€ä¸ªä¸å½“å‰è¿›ç¨‹ä¸€æ ·çš„è¿›ç¨‹ã€‚æ–°è¿›ç¨‹çš„æ‰€æœ‰æ•°æ®ï¼ˆå˜é‡ã€ç¯å¢ƒå˜é‡ã€ç¨‹åºè®¡æ•°å™¨ç­‰ï¼‰ æ•°å€¼éƒ½å’ŒåŸè¿›ç¨‹ä¸€è‡´ï¼Œä½†æ˜¯æ˜¯ä¸€ä¸ªå…¨æ–°çš„è¿›ç¨‹ï¼Œå¹¶ä½œä¸ºåŸè¿›ç¨‹çš„å­è¿›ç¨‹ã€‚</p>
</li>
<li><p>åœ¨Linuxç¨‹åºä¸­ï¼Œfork()ä¼šäº§ç”Ÿä¸€ä¸ªå’Œçˆ¶è¿›ç¨‹å®Œå…¨ç›¸åŒçš„å­è¿›ç¨‹ï¼Œä½†å­è¿›ç¨‹åœ¨æ­¤åå¤šä¼šexecç³»ç»Ÿè°ƒç”¨ï¼Œå‡ºäºæ•ˆç‡è€ƒè™‘ï¼ŒLinuxä¸­å¼•å…¥äº†<strong>å†™æ—¶å¤åˆ¶æŠ€æœ¯</strong></p>
</li>
<li><p><strong>ä¸€èˆ¬æƒ…å†µçˆ¶è¿›ç¨‹å’Œå­è¿›ç¨‹ä¼šå…±ç”¨åŒä¸€æ®µç‰©ç†å†…å­˜</strong>ï¼Œåªæœ‰è¿›ç¨‹ç©ºé—´çš„å„æ®µçš„å†…å®¹è¦å‘ç”Ÿå˜åŒ–æ—¶ï¼Œæ‰ä¼šå°†çˆ¶è¿›ç¨‹çš„å†…å®¹å¤åˆ¶ä¸€ä»½ç»™å­è¿›ç¨‹ã€‚</p>
</li>
</ol>
<h3 id="RDB-æŒä¹…åŒ–æµç¨‹"><a href="#RDB-æŒä¹…åŒ–æµç¨‹" class="headerlink" title="RDB æŒä¹…åŒ–æµç¨‹"></a><strong>RDB</strong> æŒä¹…åŒ–æµç¨‹</h3><p><img src="/2023/02/28/Redis/Java\Document\Redis\Redis.assets\image-20221008151945129.png" alt="image-20221008151945129"></p>
<h3 id="rdb-æ–‡ä»¶é…ç½®"><a href="#rdb-æ–‡ä»¶é…ç½®" class="headerlink" title="rdb æ–‡ä»¶é…ç½®"></a>rdb æ–‡ä»¶é…ç½®</h3><p>â€‹		åœ¨ redis.conf ä¸­é…ç½®æ–‡ä»¶åç§°ï¼Œé»˜è®¤ä¸º dump.rdbã€‚</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">406 # Enables or disables full sanitation checks for ziplist and listpack etc when</span><br><span class="line">407 # loading an RDB or RESTORE payload. This reduces the chances of a assertion or</span><br><span class="line">408 # crash later on while processing commands.</span><br><span class="line">409 # Options:</span><br><span class="line">410 #   no         - Never perform full sanitation</span><br><span class="line">411 #   yes        - Always perform full sanitation</span><br><span class="line">412 #   clients    - Perform full sanitation only for user connections.</span><br><span class="line">413 #                Excludes: RDB files, RESTORE commands received from the master</span><br><span class="line">414 #                connection, and client connections which have the</span><br><span class="line">415 #                skip-sanitize-payload ACL flag.</span><br><span class="line">416 # The default should be &#x27;clients&#x27; but since it currently affects cluster</span><br><span class="line">417 # resharding via MIGRATE, it is temporarily set to &#x27;no&#x27; by default.</span><br><span class="line">418 #</span><br><span class="line">419 # sanitize-dump-payload no</span><br><span class="line">420</span><br><span class="line">421 # The filename where to dump the DB</span><br><span class="line">422 dbfilename dump.rdb</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">The working directory.</span></span><br><span class="line">438 #</span><br><span class="line">439 # The DB will be written inside this directory, with the filename specified</span><br><span class="line">440 # above using the &#x27;dbfilename&#x27; configuration directive.</span><br><span class="line">441 #</span><br><span class="line">442 # The Append Only File will also be created inside this directory.</span><br><span class="line">443 #</span><br><span class="line">444 # Note that you must specify a directory here, not a file name.</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">é»˜è®¤å½“å‰å¯åŠ¨ç›®å½•ä¸‹çš„ dump.rdb</span></span><br><span class="line">445 dir ./</span><br></pre></td></tr></table></figure>

<h3 id="RDB-å¿«ç…§è§¦å‘"><a href="#RDB-å¿«ç…§è§¦å‘" class="headerlink" title="RDB å¿«ç…§è§¦å‘"></a>RDB å¿«ç…§è§¦å‘</h3><h4 id="é»˜è®¤é…ç½®"><a href="#é»˜è®¤é…ç½®" class="headerlink" title="é»˜è®¤é…ç½®"></a>é»˜è®¤é…ç½®</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">351 ################################ SNAPSHOTTING  ################################</span><br><span class="line">352</span><br><span class="line">353 # Save the DB to disk.</span><br><span class="line">354 #</span><br><span class="line">355 # save &lt;seconds&gt; &lt;changes&gt;</span><br><span class="line">356 #</span><br><span class="line">357 # Redis will save the DB if both the given number of seconds and the given</span><br><span class="line">358 # number of write operations against the DB occurred.</span><br><span class="line">359 #</span><br><span class="line">360 # Snapshotting can be completely disabled with a single empty string argument</span><br><span class="line">361 # as in following example:</span><br><span class="line">362 #</span><br><span class="line">363 # save &quot;&quot;</span><br><span class="line">364 #</span><br><span class="line">365 # Unless specified otherwise, by default Redis will save the DB:</span><br><span class="line">366 #   * After 3600 seconds (an hour) if at least 1 key changed</span><br><span class="line">367 #   * After 300 seconds (5 minutes) if at least 100 keys changed</span><br><span class="line">368 #   * After 60 seconds if at least 10000 keys changed</span><br><span class="line">369 #</span><br><span class="line">370 # You can set these explicitly by uncommenting the three following lines.</span><br><span class="line">371 #</span><br><span class="line">372 # save 3600 1</span><br><span class="line">373 # save 300 100</span><br><span class="line">374 # save 60 10000</span><br></pre></td></tr></table></figure>

<p>è¯´æ˜ï¼š</p>
<p>é»˜è®¤1å°æ—¶å†…è‡³å°‘æœ‰ä¸ªkeyå‘ç”Ÿæ”¹å˜</p>
<p>5åˆ†é’Ÿå†…è‡³å°‘æœ‰100ä¸ªkeyå‘ç”Ÿæ”¹å˜</p>
<p>1åˆ†é’Ÿå†…è‡³å°‘æœ‰10000ä¸ªkeyå‘ç”Ÿæ”¹å˜ã€‚</p>
<p>æ ¼å¼ï¼šsave ç§’é’Ÿ å†™æ“ä½œæ¬¡æ•°</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æ”¹å˜çš„è¶Šé¢‘ç¹ï¼Œå¤‡ä»½çš„é—´éš”æ—¶é—´è¶Šå°ã€‚</span></span><br><span class="line">save 20 3</span><br></pre></td></tr></table></figure>

<p>RDBæ˜¯æ•´ä¸ªå†…å­˜çš„å‹ç¼©è¿‡çš„Snapshotï¼ŒRDBçš„æ•°æ®ç»“æ„ï¼Œå¯ä»¥é…ç½®å¤åˆçš„å¿«ç…§è§¦å‘æ¡ä»¶ã€‚</p>
<p>ä¸è®¾ç½® save æŒ‡ä»¤ï¼Œæˆ–è€…ç»™ save ä¼ å…¥ç©ºå­—ç¬¦ä¸²ï¼šsave â€œâ€</p>
<h4 id="save-ä¸-bgsave-å‘½ä»¤"><a href="#save-ä¸-bgsave-å‘½ä»¤" class="headerlink" title="save ä¸ bgsave å‘½ä»¤"></a>save ä¸ bgsave å‘½ä»¤</h4><p>save ï¼šsaveæ—¶åªç®¡ä¿å­˜ï¼Œå…¶å®ƒä¸ç®¡ï¼Œå…¨éƒ¨é˜»å¡ã€‚æ‰‹åŠ¨ä¿å­˜ã€‚ä¸å»ºè®®ã€‚</p>
<p><strong>bgsave</strong>ï¼šRedisä¼šåœ¨åå°å¼‚æ­¥è¿›è¡Œå¿«ç…§æ“ä½œï¼Œå¿«ç…§åŒæ—¶è¿˜å¯ä»¥å“åº”å®¢æˆ·ç«¯è¯·æ±‚ã€‚</p>
<p>å¯ä»¥é€šè¿‡ lastsave å‘½ä»¤è·å–æœ€åä¸€æ¬¡æˆåŠŸæ‰§è¡Œå¿«ç…§çš„æ—¶é—´</p>
<h4 id="flushall-å‘½ä»¤"><a href="#flushall-å‘½ä»¤" class="headerlink" title="flushall å‘½ä»¤"></a>flushall å‘½ä»¤</h4><p>â€‹		æ‰§è¡Œflushallå‘½ä»¤ï¼Œä¹Ÿä¼šäº§ç”Ÿ dump.rdb æ–‡ä»¶ï¼Œä½†é‡Œé¢æ˜¯ç©ºçš„ï¼Œæ— æ„ä¹‰</p>
<h4 id="stop-writes-on-bgsave-error"><a href="#stop-writes-on-bgsave-error" class="headerlink" title="stop-writes-on-bgsave-error"></a>stop-writes-on-bgsave-error</h4><p>â€‹		å½“Redisæ— æ³•å†™å…¥ç£ç›˜çš„è¯ï¼Œç›´æ¥å…³æ‰Redisçš„å†™æ“ä½œã€‚æ¨èyes</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">376 # By default Redis will stop accepting writes if RDB snapshots are enabled</span><br><span class="line">377 # (at least one save point) and the latest background save failed.</span><br><span class="line">378 # This will make the user aware (in a hard way) that data is not persisting</span><br><span class="line">379 # on disk properly, otherwise chances are that no one will notice and some</span><br><span class="line">380 # disaster will happen.</span><br><span class="line">381 #</span><br><span class="line">382 # If the background saving process will start working again Redis will</span><br><span class="line">383 # automatically allow writes again.</span><br><span class="line">384 #</span><br><span class="line">385 # However if you have setup your proper monitoring of the Redis server</span><br><span class="line">386 # and persistence, you may want to disable this feature so that Redis will</span><br><span class="line">387 # continue to work as usual even if there are problems with disk,</span><br><span class="line">388 # permissions, and so forth.</span><br><span class="line">389 stop-writes-on-bgsave-error yes</span><br></pre></td></tr></table></figure>

<p><strong>rdbcompression</strong> <strong>å‹ç¼©æ–‡ä»¶</strong></p>
<p>å¯¹äºå­˜å‚¨åˆ°ç£ç›˜ä¸­çš„å¿«ç…§ï¼Œå¯ä»¥è®¾ç½®æ˜¯å¦è¿›è¡Œå‹ç¼©å­˜å‚¨ã€‚å¦‚æœæ˜¯çš„è¯ï¼Œredisä¼šé‡‡ç”¨LZFç®—æ³•è¿›è¡Œå‹ç¼©ã€‚</p>
<p>å¦‚æœä½ ä¸æƒ³æ¶ˆè€—CPUæ¥è¿›è¡Œå‹ç¼©çš„è¯ï¼Œå¯ä»¥è®¾ç½®ä¸ºå…³é—­æ­¤åŠŸèƒ½ã€‚æ¨èyesã€‚</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">391 # Compress string objects using LZF when dump .rdb databases?</span><br><span class="line">392 # By default compression is enabled as it&#x27;s almost always a win.</span><br><span class="line">393 # If you want to save some CPU in the saving child set it to &#x27;no&#x27; but</span><br><span class="line">394 # the dataset will likely be bigger if you have compressible values or keys.</span><br><span class="line">395 rdbcompression yes</span><br></pre></td></tr></table></figure>

<p><strong>rdbchecksum æ£€æŸ¥å®Œæ•´æ€§</strong></p>
<p>â€‹		åœ¨å­˜å‚¨å¿«ç…§åï¼Œè¿˜å¯ä»¥è®©redisä½¿ç”¨CRC64ç®—æ³•æ¥è¿›è¡Œæ•°æ®æ ¡éªŒï¼Œä½†æ˜¯è¿™æ ·åšä¼šå¢åŠ å¤§çº¦10%çš„æ€§èƒ½æ¶ˆè€—ï¼Œå¦‚æœå¸Œæœ›è·å–åˆ°æœ€å¤§çš„æ€§èƒ½æå‡ï¼Œå¯ä»¥å…³é—­æ­¤åŠŸèƒ½ï¼Œæ¨èyesã€‚</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">391 # Compress string objects using LZF when dump .rdb databases?</span><br><span class="line">392 # By default compression is enabled as it&#x27;s almost always a win.</span><br><span class="line">393 # If you want to save some CPU in the saving child set it to &#x27;no&#x27; but</span><br><span class="line">394 # the dataset will likely be bigger if you have compressible values or keys.</span><br><span class="line">395 rdbcompression yes</span><br></pre></td></tr></table></figure>

<h4 id="rdb-çš„å¤‡ä»½"><a href="#rdb-çš„å¤‡ä»½" class="headerlink" title="**rdb **çš„å¤‡ä»½"></a>**rdb **çš„å¤‡ä»½</h4><p>å…ˆé€šè¿‡config get dir æŸ¥è¯¢rdbæ–‡ä»¶çš„ç›®å½• ï¼Œå°† *.rdb çš„æ–‡ä»¶æ‹·è´åˆ°åˆ«çš„åœ°æ–¹ã€‚</p>
<p>rdbçš„æ¢å¤</p>
<ul>
<li>å…³é—­Redis</li>
<li>å…ˆæŠŠå¤‡ä»½çš„æ–‡ä»¶æ‹·è´åˆ°å·¥ä½œç›®å½•ä¸‹ cp dump2.rdb dump.rdb</li>
<li>å¯åŠ¨Redis, å¤‡ä»½æ•°æ®ä¼šç›´æ¥åŠ è½½</li>
</ul>
<h3 id="RDB-ä¼˜åŠ¿"><a href="#RDB-ä¼˜åŠ¿" class="headerlink" title="RDB ä¼˜åŠ¿"></a>RDB ä¼˜åŠ¿</h3><ol>
<li>é€‚åˆå¤§è§„æ¨¡æ•°æ®çš„æ¢å¤</li>
<li>å¯¹æ•°æ®çš„å®Œæ•´æ€§å’Œä¸€è‡´æ€§è¦æ±‚ä¸é«˜æ—¶é€‚åˆä½¿ç”¨</li>
<li>èŠ‚çœç£ç›˜ç©ºé—´ï¼ˆç›¸æ¯”è¾ƒäºAOFï¼Œæ²¡æœ‰å‘½ä»¤å­˜å‚¨ï¼‰</li>
<li>æ¢å¤é€Ÿåº¦å¿«</li>
</ol>
<h3 id="RDB-åŠ£åŠ¿"><a href="#RDB-åŠ£åŠ¿" class="headerlink" title="RDB åŠ£åŠ¿"></a>RDB <strong>åŠ£åŠ¿</strong></h3><ol>
<li>Forkçš„æ—¶å€™ï¼Œå†…å­˜ä¸­çš„æ•°æ®è¢«å…‹éš†äº†ä¸€ä»½ï¼Œå¤§è‡´2å€çš„è†¨èƒ€æ€§éœ€è¦è€ƒè™‘</li>
</ol>
<p>l Forkçš„æ—¶å€™ï¼Œå†…å­˜ä¸­çš„æ•°æ®è¢«å…‹éš†äº†ä¸€ä»½ï¼Œå¤§è‡´2å€çš„è†¨èƒ€æ€§éœ€è¦è€ƒè™‘</p>
<ol start="2">
<li><p>è™½ç„¶Redisåœ¨forkæ—¶ä½¿ç”¨äº†<strong>å†™æ—¶æ‹·è´æŠ€æœ¯</strong>ï¼Œä½†æ˜¯å¦‚æœæ•°æ®åºå¤§æ—¶è¿˜æ˜¯æ¯”è¾ƒæ¶ˆè€—æ€§èƒ½ã€‚</p>
</li>
<li><p>åœ¨å¤‡ä»½å‘¨æœŸåœ¨ä¸€å®šé—´éš”æ—¶é—´åšä¸€æ¬¡å¤‡ä»½ï¼Œæ‰€ä»¥å¦‚æœRedisæ„å¤–downæ‰çš„è¯ï¼Œå°±ä¼šä¸¢å¤±æœ€åä¸€æ¬¡å¿«ç…§åçš„æ‰€æœ‰ä¿®æ”¹ã€‚</p>
</li>
</ol>
<h3 id="åŠ¨æ€åœæ­¢RDB"><a href="#åŠ¨æ€åœæ­¢RDB" class="headerlink" title="åŠ¨æ€åœæ­¢RDB"></a>åŠ¨æ€åœæ­¢RDB</h3><p>åŠ¨æ€åœæ­¢RDBï¼šredis-cli config set save â€œâ€ #saveåç»™ç©ºå€¼ï¼Œè¡¨ç¤ºç¦ç”¨ä¿å­˜ç­–ç•¥</p>
<h3 id="RDB-æ€»ç»“"><a href="#RDB-æ€»ç»“" class="headerlink" title="RDB æ€»ç»“"></a>RDB æ€»ç»“</h3><p><img src="/2023/02/28/Redis/Java\Document\Redis\Redis.assets\image-20221008153853024.png" alt="image-20221008153853024"></p>
<h2 id="AOFï¼ˆAppend-Only-Fileï¼‰"><a href="#AOFï¼ˆAppend-Only-Fileï¼‰" class="headerlink" title="AOFï¼ˆAppend Only Fileï¼‰"></a>AOFï¼ˆAppend Only Fileï¼‰</h2><h3 id="å®šä¹‰-1"><a href="#å®šä¹‰-1" class="headerlink" title="å®šä¹‰"></a>å®šä¹‰</h3><p>â€‹		ä»¥<strong>æ—¥å¿—</strong>çš„å½¢å¼æ¥è®°å½•æ¯ä¸ªå†™æ“ä½œï¼ˆå¢é‡ä¿å­˜ï¼‰ï¼Œå°†Redisæ‰§è¡Œè¿‡çš„æ‰€æœ‰å†™æŒ‡ä»¤è®°å½•ä¸‹æ¥ï¼ˆ<strong>è¯»æ“ä½œä¸è®°å½•</strong>ï¼‰ï¼Œ <strong>åªè®¸è¿½åŠ æ–‡ä»¶ä½†ä¸å¯ä»¥æ”¹å†™æ–‡ä»¶</strong>ï¼Œrediså¯åŠ¨ä¹‹åˆä¼šè¯»å–è¯¥æ–‡ä»¶é‡æ–°æ„å»ºæ•°æ®ï¼Œæ¢è¨€ä¹‹ï¼Œredis é‡å¯çš„è¯å°±æ ¹æ®æ—¥å¿—æ–‡ä»¶çš„å†…å®¹å°†å†™æŒ‡ä»¤ä»å‰åˆ°åæ‰§è¡Œä¸€æ¬¡ä»¥å®Œæˆæ•°æ®çš„æ¢å¤å·¥ä½œã€‚</p>
<h3 id="AOFæŒä¹…åŒ–æµç¨‹"><a href="#AOFæŒä¹…åŒ–æµç¨‹" class="headerlink" title="AOFæŒä¹…åŒ–æµç¨‹"></a><strong>AOF</strong>æŒä¹…åŒ–æµç¨‹</h3><p>ï¼ˆ1ï¼‰å®¢æˆ·ç«¯çš„è¯·æ±‚å†™å‘½ä»¤ä¼šè¢«appendè¿½åŠ åˆ°AOFç¼“å†²åŒºå†…</p>
<p>ï¼ˆ2ï¼‰AOFç¼“å†²åŒºæ ¹æ®AOFæŒä¹…åŒ–ç­–ç•¥[always,everysec,no]å°†æ“ä½œsyncåŒæ­¥åˆ°ç£ç›˜çš„AOFæ–‡ä»¶ä¸­</p>
<p>ï¼ˆ3ï¼‰AOFæ–‡ä»¶å¤§å°è¶…è¿‡é‡å†™ç­–ç•¥æˆ–æ‰‹åŠ¨é‡å†™æ—¶ï¼Œä¼šå¯¹AOFæ–‡ä»¶rewriteé‡å†™ï¼Œå‹ç¼©AOFæ–‡ä»¶å®¹é‡</p>
<p>ï¼ˆ4ï¼‰RedisæœåŠ¡é‡å¯æ—¶ï¼Œä¼šé‡æ–°loadåŠ è½½AOFæ–‡ä»¶ä¸­çš„å†™æ“ä½œè¾¾åˆ°æ•°æ®æ¢å¤çš„ç›®çš„</p>
<img src="/2023/02/28/Redis/Java\Document\Redis\Redis.assets\image-20221008154119947.png" alt="image-20221008154119947" style="zoom:67%;">

<h3 id="AOF-é»˜è®¤é…ç½®"><a href="#AOF-é»˜è®¤é…ç½®" class="headerlink" title="AOF é»˜è®¤é…ç½®"></a>AOF é»˜è®¤é…ç½®</h3><p>åœ¨ redis.conf ä¸­é…ç½®æ–‡ä»¶åç§°ï¼Œé»˜è®¤ä¸º appendonly.aofï¼ŒAOFæ–‡ä»¶çš„ä¿å­˜è·¯å¾„ï¼ŒåŒRDBçš„è·¯å¾„ä¸€è‡´ã€‚</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">1211 ############################## APPEND ONLY MODE ###############################</span><br><span class="line">1212</span><br><span class="line">1213 # By default Redis asynchronously dumps the dataset on disk. This mode is</span><br><span class="line">1214 # good enough in many applications, but an issue with the Redis process or</span><br><span class="line">1215 # a power outage may result into a few minutes of writes lost (depending on</span><br><span class="line">1216 # the configured save points).</span><br><span class="line">1217 #</span><br><span class="line">1218 # The Append Only File is an alternative persistence mode that provides</span><br><span class="line">1219 # much better durability. For instance using the default data fsync policy</span><br><span class="line">1220 # (see later in the config file) Redis can lose just one second of writes in a</span><br><span class="line">1221 # dramatic event like a server power outage, or a single write if something</span><br><span class="line">1222 # wrong with the Redis process itself happens, but the operating system is</span><br><span class="line">1223 # still running correctly.</span><br><span class="line">1224 #</span><br><span class="line">1225 # AOF and RDB persistence can be enabled at the same time without problems.</span><br><span class="line">1226 # If the AOF is enabled on startup Redis will load the AOF, that is the file</span><br><span class="line">1227 # with the better durability guarantees.</span><br><span class="line">1228 #</span><br><span class="line">1229 # Please check http://redis.io/topics/persistence for more information.</span><br><span class="line">1230</span><br><span class="line">1231 appendonly no</span><br><span class="line">1232</span><br><span class="line">1233 # The name of the append only file (default: &quot;appendonly.aof&quot;)</span><br><span class="line">1234</span><br><span class="line">1235 appendfilename &quot;appendonly.aof&quot;</span><br></pre></td></tr></table></figure>

<h3 id="AOFå’Œ-RDB-åŒæ—¶å¼€å¯"><a href="#AOFå’Œ-RDB-åŒæ—¶å¼€å¯" class="headerlink" title="AOFå’Œ RDB åŒæ—¶å¼€å¯"></a><strong>AOF</strong>å’Œ RDB åŒæ—¶å¼€å¯</h3><p><strong>AOF å’Œ RDB åŒæ—¶å¼€å¯ï¼Œç³»ç»Ÿé»˜è®¤å–AOFçš„æ•°æ®ï¼ˆæ•°æ®ä¸ä¼šå­˜åœ¨ä¸¢å¤±ï¼‰</strong>ï¼Œå¦‚æœ aof æ–‡ä»¶ä¸ºç©ºï¼Œåˆ™é‡å¯åçš„redisæ²¡æœ‰æ•°æ®ã€‚</p>
<p>ç¤ºä¾‹ï¼š</p>
<h3 id="AOFå¯åŠ¨ã€æ¢å¤"><a href="#AOFå¯åŠ¨ã€æ¢å¤" class="headerlink" title="AOFå¯åŠ¨ã€æ¢å¤"></a><strong>AOF</strong>å¯åŠ¨ã€æ¢å¤</h3><p>AOF çš„å¤‡ä»½æœºåˆ¶å’Œæ€§èƒ½è™½ç„¶å’Œ RDB ä¸åŒ, ä½†æ˜¯å¤‡ä»½å’Œæ¢å¤çš„æ“ä½œåŒ RDBä¸€æ ·ï¼Œéƒ½æ˜¯æ‹·è´å¤‡ä»½æ–‡ä»¶ï¼Œéœ€è¦æ¢å¤æ—¶å†æ‹·è´åˆ°Rediså·¥ä½œç›®å½•ä¸‹ï¼Œå¯åŠ¨ç³»ç»Ÿå³åŠ è½½ã€‚</p>
<p>æ­£å¸¸æ¢å¤</p>
<ul>
<li>â€‹	ä¿®æ”¹é»˜è®¤çš„appendonly noï¼Œæ”¹ä¸ºyes</li>
<li>â€‹	å°†æœ‰æ•°æ®çš„aofæ–‡ä»¶å¤åˆ¶ä¸€ä»½ä¿å­˜åˆ°å¯¹åº”ç›®å½•(æŸ¥çœ‹ç›®å½•ï¼šconfig get dir)</li>
<li>â€‹	æ¢å¤ï¼šé‡å¯redisç„¶åé‡æ–°åŠ è½½</li>
</ul>
<p>å¼‚å¸¸æ¢å¤</p>
<ul>
<li>â€‹		ä¿®æ”¹é»˜è®¤çš„appendonly noï¼Œæ”¹ä¸ºyes</li>
<li>â€‹		å¦‚é‡åˆ°<strong>AOF</strong>æ–‡ä»¶æŸå**ï¼Œé€šè¿‡ &#x2F;usr&#x2F;local&#x2F;bin&#x2F;**redis-check-aofâ€“fix appendonly.aof â€“fixed è¿›è¡Œæ¢å¤</li>
<li>â€‹		å¤‡ä»½è¢«å†™åçš„AOFæ–‡ä»¶</li>
<li>â€‹		æ¢å¤ï¼šé‡å¯redisï¼Œç„¶åé‡æ–°åŠ è½½</li>
</ul>
<p>ç¤ºä¾‹ï¼š</p>
<h3 id="AOF-åŒæ­¥é¢‘ç‡è®¾ç½®"><a href="#AOF-åŒæ­¥é¢‘ç‡è®¾ç½®" class="headerlink" title="AOF åŒæ­¥é¢‘ç‡è®¾ç½®"></a><strong>AOF</strong> åŒæ­¥é¢‘ç‡è®¾ç½®</h3><ol>
<li><p>appendfsync	always</p>
<p> â€‹	å§‹ç»ˆåŒæ­¥ï¼Œæ¯æ¬¡Redisçš„å†™å…¥éƒ½ä¼šç«‹åˆ»è®°å…¥æ—¥å¿—ï¼›æ€§èƒ½è¾ƒå·®ä½†æ•°æ®å®Œæ•´æ€§æ¯”è¾ƒå¥½</p>
</li>
<li><p>appendfsync everysec</p>
<p> â€‹	æ¯ç§’åŒæ­¥ï¼Œæ¯ç§’è®°å…¥æ—¥å¿—ä¸€æ¬¡ï¼Œå¦‚æœå®•æœºï¼Œæœ¬ç§’çš„æ•°æ®å¯èƒ½ä¸¢å¤±ã€‚</p>
</li>
<li><p>appendfsync no</p>
<p> â€‹	redisä¸ä¸»åŠ¨è¿›è¡ŒåŒæ­¥ï¼ŒæŠŠåŒæ­¥æ—¶æœºäº¤ç»™æ“ä½œç³»ç»Ÿã€‚</p>
</li>
</ol>
<h3 id="Rewriteå‹ç¼©"><a href="#Rewriteå‹ç¼©" class="headerlink" title="Rewriteå‹ç¼©"></a><strong>Rewrite</strong>å‹ç¼©</h3><h4 id="å®šä¹‰-2"><a href="#å®šä¹‰-2" class="headerlink" title="å®šä¹‰"></a>å®šä¹‰</h4><p>â€‹		AOFé‡‡ç”¨æ–‡ä»¶è¿½åŠ æ–¹å¼ï¼Œæ–‡ä»¶ä¼šè¶Šæ¥è¶Šå¤§ä¸ºé¿å…å‡ºç°æ­¤ç§æƒ…å†µï¼Œæ–°å¢äº†é‡å†™æœºåˆ¶, å½“AOFæ–‡ä»¶çš„å¤§å°è¶…è¿‡æ‰€è®¾å®šçš„é˜ˆå€¼æ—¶ï¼ŒRediså°±ä¼šå¯åŠ¨AOFæ–‡ä»¶çš„å†…å®¹å‹ç¼©ï¼Œ åªä¿ç•™å¯ä»¥æ¢å¤æ•°æ®çš„æœ€å°æŒ‡ä»¤é›†.å¯ä»¥ä½¿ç”¨å‘½ä»¤ bgrewriteaof</p>
<h4 id="é‡å†™åŸç†ï¼Œå¦‚ä½•å®ç°é‡å†™"><a href="#é‡å†™åŸç†ï¼Œå¦‚ä½•å®ç°é‡å†™" class="headerlink" title="é‡å†™åŸç†ï¼Œå¦‚ä½•å®ç°é‡å†™"></a>é‡å†™åŸç†ï¼Œå¦‚ä½•å®ç°é‡å†™</h4><p>AOFæ–‡ä»¶æŒç»­å¢é•¿è€Œè¿‡å¤§æ—¶ï¼Œä¼šforkå‡ºä¸€æ¡æ–°è¿›ç¨‹æ¥å°†æ–‡ä»¶é‡å†™(ä¹Ÿæ˜¯å…ˆå†™ä¸´æ—¶æ–‡ä»¶æœ€åå†rename)ï¼Œredis4.0ç‰ˆæœ¬åçš„é‡å†™ï¼Œæ˜¯æŒ‡ä¸Šå°±æ˜¯æŠŠrdb çš„å¿«ç…§ï¼Œä»¥äºŒçº§åˆ¶çš„å½¢å¼é™„åœ¨æ–°çš„aofå¤´éƒ¨ï¼Œä½œä¸ºå·²æœ‰çš„å†å²æ•°æ®ï¼Œæ›¿æ¢æ‰åŸæ¥çš„æµæ°´è´¦æ“ä½œã€‚</p>
<p><strong>no-appendfsync-on-rewriteï¼š</strong></p>
<p>å¦‚æœ no-appendfsync-on-rewrite&#x3D;yes ,ä¸å†™å…¥aofæ–‡ä»¶åªå†™å…¥ç¼“å­˜ï¼Œç”¨æˆ·è¯·æ±‚ä¸ä¼šé˜»å¡ï¼Œä½†æ˜¯åœ¨è¿™æ®µæ—¶é—´å¦‚æœå®•æœºä¼šä¸¢å¤±è¿™æ®µæ—¶é—´çš„ç¼“å­˜æ•°æ®ã€‚ï¼ˆé™ä½æ•°æ®å®‰å…¨æ€§ï¼Œæé«˜æ€§èƒ½ï¼‰</p>
<p>å¦‚æœ no-appendfsync-on-rewrite&#x3D;no, è¿˜æ˜¯ä¼šæŠŠæ•°æ®å¾€ç£ç›˜é‡Œåˆ·ï¼Œä½†æ˜¯é‡åˆ°é‡å†™æ“ä½œï¼Œå¯èƒ½ä¼šå‘ç”Ÿé˜»å¡ã€‚ï¼ˆæ•°æ®å®‰å…¨ï¼Œä½†æ˜¯æ€§èƒ½é™ä½ï¼‰</p>
<h4 id="è§¦å‘æœºåˆ¶ï¼Œä½•æ—¶é‡å†™"><a href="#è§¦å‘æœºåˆ¶ï¼Œä½•æ—¶é‡å†™" class="headerlink" title="è§¦å‘æœºåˆ¶ï¼Œä½•æ—¶é‡å†™"></a>è§¦å‘æœºåˆ¶ï¼Œä½•æ—¶é‡å†™</h4><p>Redisä¼šè®°å½•ä¸Šæ¬¡é‡å†™æ—¶çš„AOFå¤§å°ï¼Œé»˜è®¤é…ç½®æ˜¯å½“AOFæ–‡ä»¶å¤§å°æ˜¯ä¸Šæ¬¡rewriteåå¤§å°çš„ä¸€å€ä¸”æ–‡ä»¶å¤§äº64Mæ—¶è§¦å‘</p>
<p>é‡å†™è™½ç„¶å¯ä»¥èŠ‚çº¦å¤§é‡ç£ç›˜ç©ºé—´ï¼Œå‡å°‘æ¢å¤æ—¶é—´ã€‚ä½†æ˜¯æ¯æ¬¡é‡å†™è¿˜æ˜¯æœ‰ä¸€å®šçš„è´Ÿæ‹…çš„ï¼Œå› æ­¤è®¾å®šRedisè¦æ»¡è¶³ä¸€å®šæ¡ä»¶æ‰ä¼šè¿›è¡Œé‡å†™ã€‚ </p>
<p>auto-aof-rewrite-percentageï¼šè®¾ç½®é‡å†™çš„åŸºå‡†å€¼ï¼Œæ–‡ä»¶è¾¾åˆ°100%æ—¶å¼€å§‹é‡å†™ï¼ˆæ–‡ä»¶æ˜¯åŸæ¥é‡å†™åæ–‡ä»¶çš„2å€æ—¶è§¦å‘ï¼‰</p>
<p>auto-aof-rewrite-min-sizeï¼šè®¾ç½®é‡å†™çš„åŸºå‡†å€¼ï¼Œæœ€å°æ–‡ä»¶64MBã€‚è¾¾åˆ°è¿™ä¸ªå€¼å¼€å§‹é‡å†™ã€‚</p>
<p>ä¾‹å¦‚ï¼šæ–‡ä»¶è¾¾åˆ°70MBå¼€å§‹é‡å†™ï¼Œé™åˆ°50MBï¼Œä¸‹æ¬¡ä»€ä¹ˆæ—¶å€™å¼€å§‹é‡å†™ï¼Ÿ100MB</p>
<p>ç³»ç»Ÿè½½å…¥æ—¶æˆ–è€…ä¸Šæ¬¡é‡å†™å®Œæ¯•æ—¶ï¼ŒRedisä¼šè®°å½•æ­¤æ—¶AOFå¤§å°ï¼Œè®¾ä¸ºbase_size,</p>
<p>å¦‚æœRedisçš„AOFå½“å‰å¤§å°&gt;&#x3D; base_size +base_size*100% (é»˜è®¤)ä¸”å½“å‰å¤§å°&gt;&#x3D;64mb(é»˜è®¤)çš„æƒ…å†µä¸‹ï¼ŒRedisä¼šå¯¹AOFè¿›è¡Œé‡å†™ã€‚ </p>
<h4 id="é‡å†™æµç¨‹"><a href="#é‡å†™æµç¨‹" class="headerlink" title="é‡å†™æµç¨‹"></a>é‡å†™æµç¨‹</h4><p>ï¼ˆ1ï¼‰bgrewriteaofè§¦å‘é‡å†™ï¼Œåˆ¤æ–­æ˜¯å¦å½“å‰æœ‰bgsaveæˆ–bgrewriteaofåœ¨è¿è¡Œï¼Œå¦‚æœæœ‰ï¼Œåˆ™ç­‰å¾…è¯¥å‘½ä»¤ç»“æŸåå†ç»§ç»­æ‰§è¡Œã€‚</p>
<p>ï¼ˆ2ï¼‰ä¸»è¿›ç¨‹forkå‡ºå­è¿›ç¨‹æ‰§è¡Œé‡å†™æ“ä½œï¼Œä¿è¯ä¸»è¿›ç¨‹ä¸ä¼šé˜»å¡ã€‚</p>
<p>ï¼ˆ3ï¼‰å­è¿›ç¨‹éå†rediså†…å­˜ä¸­æ•°æ®åˆ°ä¸´æ—¶æ–‡ä»¶ï¼Œå®¢æˆ·ç«¯çš„å†™è¯·æ±‚åŒæ—¶å†™å…¥aof_bufç¼“å†²åŒºå’Œaof_rewrite_bufé‡å†™ç¼“å†²åŒºä¿è¯åŸAOFæ–‡ä»¶å®Œæ•´ä»¥åŠæ–°AOFæ–‡ä»¶ç”ŸæˆæœŸé—´çš„æ–°çš„æ•°æ®ä¿®æ”¹åŠ¨ä½œä¸ä¼šä¸¢å¤±ã€‚</p>
<p>ï¼ˆ4ï¼‰å­è¿›ç¨‹å†™å®Œæ–°çš„AOFæ–‡ä»¶åï¼Œå‘ä¸»è¿›ç¨‹å‘ä¿¡å·ï¼Œçˆ¶è¿›ç¨‹æ›´æ–°ç»Ÿè®¡ä¿¡æ¯ã€‚2).ä¸»è¿›ç¨‹æŠŠaof_rewrite_bufä¸­çš„æ•°æ®å†™å…¥åˆ°æ–°çš„AOFæ–‡ä»¶ã€‚</p>
<p>ï¼ˆ5ï¼‰ä½¿ç”¨æ–°çš„AOFæ–‡ä»¶è¦†ç›–æ—§çš„AOFæ–‡ä»¶ï¼Œå®ŒæˆAOFé‡å†™ã€‚</p>
<p><img src="/2023/02/28/Redis/Java\Document\Redis\Redis.assets\image-20221008155125490.png" alt="image-20221008155125490"></p>
<h3 id="ä¼˜åŠ¿"><a href="#ä¼˜åŠ¿" class="headerlink" title="ä¼˜åŠ¿"></a>ä¼˜åŠ¿</h3><ol>
<li><p>å¤‡ä»½æœºåˆ¶æ›´ç¨³å¥ï¼Œä¸¢å¤±æ•°æ®æ¦‚ç‡æ›´ä½ã€‚</p>
</li>
<li><p>å¯è¯»çš„æ—¥å¿—æ–‡æœ¬ï¼Œé€šè¿‡æ“ä½œAOFç¨³å¥ï¼Œå¯ä»¥å¤„ç†è¯¯æ“ä½œã€‚</p>
</li>
</ol>
<h3 id="åŠ£åŠ¿"><a href="#åŠ£åŠ¿" class="headerlink" title="åŠ£åŠ¿"></a><strong>åŠ£åŠ¿</strong></h3><ul>
<li>æ¯”èµ·RDBå ç”¨æ›´å¤šçš„ç£ç›˜ç©ºé—´ã€‚</li>
<li>æ¢å¤å¤‡ä»½é€Ÿåº¦è¦æ…¢ã€‚</li>
<li>æ¯æ¬¡è¯»å†™éƒ½åŒæ­¥çš„è¯ï¼Œæœ‰ä¸€å®šçš„æ€§èƒ½å‹åŠ›ã€‚</li>
<li>å­˜åœ¨ä¸ªåˆ«Bugï¼Œé€ æˆæ¢å¤ä¸èƒ½ã€‚</li>
</ul>
<p><img src="/2023/02/28/Redis/Java\Document\Redis\Redis.assets\image-20221008155241481.png" alt="image-20221008155241481"></p>
<h2 id="åº”è¯¥ä½¿ç”¨é‚£ä¸ªç­–ç•¥"><a href="#åº”è¯¥ä½¿ç”¨é‚£ä¸ªç­–ç•¥" class="headerlink" title="åº”è¯¥ä½¿ç”¨é‚£ä¸ªç­–ç•¥"></a>åº”è¯¥ä½¿ç”¨é‚£ä¸ªç­–ç•¥</h2><h3 id="å®˜æ–¹æ¨è"><a href="#å®˜æ–¹æ¨è" class="headerlink" title="å®˜æ–¹æ¨è"></a>å®˜æ–¹æ¨è</h3><ul>
<li>å®˜æ–¹æ¨èä¸¤ä¸ªéƒ½å¯ç”¨ã€‚</li>
<li>å¦‚æœå¯¹æ•°æ®ä¸æ•æ„Ÿï¼Œå¯ä»¥é€‰å•ç‹¬ç”¨RDBã€‚</li>
<li>ä¸å»ºè®®å•ç‹¬ç”¨ AOFï¼Œå› ä¸ºå¯èƒ½ä¼šå‡ºç°Bugã€‚</li>
<li>å¦‚æœåªæ˜¯åšçº¯å†…å­˜ç¼“å­˜ï¼Œå¯ä»¥éƒ½ä¸ç”¨ã€‚</li>
</ul>
<p><img src="/2023/02/28/Redis/Java\Document\Redis\Redis.assets\image-20221008155404670.png" alt="image-20221008155404670"></p>
<ul>
<li>RDBæŒä¹…åŒ–æ–¹å¼èƒ½å¤Ÿåœ¨æŒ‡å®šçš„æ—¶é—´é—´éš”èƒ½å¯¹ä½ çš„æ•°æ®è¿›è¡Œå¿«ç…§å­˜å‚¨</li>
<li>AOFæŒä¹…åŒ–æ–¹å¼è®°å½•æ¯æ¬¡å¯¹æœåŠ¡å™¨å†™çš„æ“ä½œ,å½“æœåŠ¡å™¨é‡å¯çš„æ—¶å€™ä¼šé‡æ–°æ‰§è¡Œè¿™äº›å‘½ä»¤æ¥æ¢å¤åŸå§‹çš„æ•°æ®,AOFå‘½ä»¤ä»¥redisåè®®è¿½åŠ ä¿å­˜æ¯æ¬¡å†™çš„æ“ä½œåˆ°æ–‡ä»¶æœ«å°¾. </li>
<li>Redisè¿˜èƒ½å¯¹AOFæ–‡ä»¶è¿›è¡Œåå°é‡å†™,ä½¿å¾—AOFæ–‡ä»¶çš„ä½“ç§¯ä¸è‡³äºè¿‡å¤§</li>
<li>åªåšç¼“å­˜ï¼šå¦‚æœä½ åªå¸Œæœ›ä½ çš„æ•°æ®åœ¨æœåŠ¡å™¨è¿è¡Œçš„æ—¶å€™å­˜åœ¨,ä½ ä¹Ÿå¯ä»¥ä¸ä½¿ç”¨ä»»ä½•æŒä¹…åŒ–æ–¹å¼.</li>
<li>åŒæ—¶å¼€å¯ä¸¤ç§æŒä¹…åŒ–æ–¹å¼</li>
<li>åœ¨è¿™ç§æƒ…å†µä¸‹,å½“redisé‡å¯çš„æ—¶å€™ä¼šä¼˜å…ˆè½½å…¥AOFæ–‡ä»¶æ¥æ¢å¤åŸå§‹çš„æ•°æ®, å› ä¸ºåœ¨é€šå¸¸æƒ…å†µä¸‹AOFæ–‡ä»¶ä¿å­˜çš„æ•°æ®é›†è¦æ¯”RDBæ–‡ä»¶ä¿å­˜çš„æ•°æ®é›†è¦å®Œæ•´.</li>
<li>RDBçš„æ•°æ®ä¸å®æ—¶ï¼ŒåŒæ—¶ä½¿ç”¨ä¸¤è€…æ—¶æœåŠ¡å™¨é‡å¯ä¹Ÿåªä¼šæ‰¾AOFæ–‡ä»¶ã€‚é‚£è¦ä¸è¦åªä½¿ç”¨AOFå‘¢ï¼Ÿ </li>
<li>å»ºè®®ä¸è¦ï¼Œå› ä¸ºRDBæ›´é€‚åˆç”¨äºå¤‡ä»½æ•°æ®åº“(AOFåœ¨ä¸æ–­å˜åŒ–ä¸å¥½å¤‡ä»½)ï¼Œ å¿«é€Ÿé‡å¯ï¼Œè€Œä¸”ä¸ä¼šæœ‰AOFå¯èƒ½æ½œåœ¨çš„bugï¼Œç•™ç€ä½œä¸ºä¸€ä¸ªä¸‡ä¸€çš„æ‰‹æ®µã€‚</li>
</ul>
<h3 id="æ€§èƒ½å»ºè®®"><a href="#æ€§èƒ½å»ºè®®" class="headerlink" title="æ€§èƒ½å»ºè®®"></a>æ€§èƒ½å»ºè®®</h3><ol>
<li><p>å› ä¸ºRDBæ–‡ä»¶åªç”¨ä½œåå¤‡ç”¨é€”ï¼Œå»ºè®®åªåœ¨Slaveä¸ŠæŒä¹…åŒ–RDBæ–‡ä»¶ï¼Œè€Œä¸”åªè¦15åˆ†é’Ÿå¤‡ä»½ä¸€æ¬¡å³å¯ï¼Œåªä¿ç•™save 900 1è¿™æ¡è§„åˆ™ã€‚</p>
</li>
<li><p>å¦‚æœä½¿ç”¨AOFï¼Œå¥½å¤„æ˜¯åœ¨æœ€æ¶åŠ£æƒ…å†µä¸‹ä¹Ÿåªä¼šä¸¢å¤±ä¸è¶…è¿‡ä¸¤ç§’æ•°æ®ï¼Œå¯åŠ¨è„šæœ¬è¾ƒç®€å•åªloadè‡ªå·±çš„AOFæ–‡ä»¶å°±å¯ä»¥äº†ã€‚ ä»£ä»·,ä¸€æ˜¯å¸¦æ¥äº†æŒç»­çš„IOï¼ŒäºŒæ˜¯AOF rewriteçš„æœ€åå°†rewriteè¿‡ç¨‹ä¸­äº§ç”Ÿçš„æ–°æ•°æ®å†™åˆ°æ–°æ–‡ä»¶é€ æˆçš„é˜»å¡å‡ ä¹æ˜¯ä¸å¯é¿å…çš„ã€‚  </p>
</li>
<li><p><strong>åªè¦ç¡¬ç›˜è®¸å¯ï¼Œåº”è¯¥å°½é‡å‡å°‘AOF  rewriteçš„é¢‘ç‡</strong>ï¼ŒAOFé‡å†™çš„åŸºç¡€å¤§å°é»˜è®¤å€¼64Må¤ªå°äº†ï¼Œå¯ä»¥è®¾åˆ°5Gä»¥ä¸Šã€‚  é»˜è®¤è¶…è¿‡åŸå¤§å°100%å¤§å°æ—¶é‡å†™å¯ä»¥æ”¹åˆ°é€‚å½“çš„æ•°å€¼ã€‚</p>
</li>
</ol>
<h1 id="Redisä¸»ä»å¤åˆ¶"><a href="#Redisä¸»ä»å¤åˆ¶" class="headerlink" title="Redisä¸»ä»å¤åˆ¶"></a><strong>Redis</strong>ä¸»ä»å¤åˆ¶</h1><h2 id="å®šä¹‰-3"><a href="#å®šä¹‰-3" class="headerlink" title="å®šä¹‰"></a>å®šä¹‰</h2><p>â€‹		ä¸»æœºæ•°æ®æ›´æ–°åæ ¹æ®é…ç½®å’Œç­–ç•¥ï¼Œ è‡ªåŠ¨åŒæ­¥åˆ°å¤‡æœºçš„master&#x2F;slaveræœºåˆ¶ï¼Œ<strong>Master</strong>ä»¥å†™ä¸ºä¸»ï¼ŒSlaveä»¥è¯»ä¸ºä¸»ã€‚</p>
<h2 id="ä½œç”¨"><a href="#ä½œç”¨" class="headerlink" title="ä½œç”¨"></a>ä½œç”¨</h2><ol>
<li><p>è¯»å†™åˆ†ç¦»ï¼Œæ€§èƒ½æ‰©å±•</p>
</li>
<li><p>å®¹ç¾å¿«é€Ÿæ¢å¤</p>
</li>
</ol>
<img src="/2023/02/28/Redis/Java\Document\Redis\Redis.assets\image-20221008155953090.png" alt="image-20221008155953090" style="zoom:50%;">



<h2 id="æ­å»ºä¸»ä»å¤åˆ¶"><a href="#æ­å»ºä¸»ä»å¤åˆ¶" class="headerlink" title="æ­å»ºä¸»ä»å¤åˆ¶"></a>æ­å»ºä¸»ä»å¤åˆ¶</h2><p>æ‹·è´å¤šä»½ redis.conf æ–‡ä»¶ï¼Œä½¿ç”¨ include å‘½ä»¤å¼•å…¥ &#x2F;etc&#x2F;redis.conf</p>
<ul>
<li>å¼€å¯daemonize yes</li>
<li>Pidæ–‡ä»¶åå­—pidfile</li>
<li>æŒ‡å®šç«¯å£port</li>
<li>Logæ–‡ä»¶åå­—</li>
<li>dump.rdbåå­—dbfilename</li>
<li>Appendonly å…³æ‰æˆ–è€…æ¢åå­—</li>
</ul>
<h3 id="ç¬¬ä¸€æ­¥ï¼šæ–°å»ºé…ç½®æ–‡ä»¶"><a href="#ç¬¬ä¸€æ­¥ï¼šæ–°å»ºé…ç½®æ–‡ä»¶" class="headerlink" title="ç¬¬ä¸€æ­¥ï¼šæ–°å»ºé…ç½®æ–‡ä»¶"></a>ç¬¬ä¸€æ­¥ï¼šæ–°å»ºé…ç½®æ–‡ä»¶</h3><p>åœ¨ &#x2F;opt&#x2F;redis&#x2F;redisConf ä¸‹æ–°å»ºé…ç½®æ–‡ä»¶ redis6379.confï¼Œredis6380.confï¼Œredis6381.conf</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">include /etc/redis.conf</span><br><span class="line">pidfile /var/run/redis_6381.pid</span><br><span class="line">port 6381</span><br><span class="line">dbfilename dump6381.rdb</span><br></pre></td></tr></table></figure>

<h3 id="ç¬¬äºŒæ­¥ï¼šå¯åŠ¨ä¸‰å°Redisï¼ŒæŸ¥çœ‹è¿›ç¨‹"><a href="#ç¬¬äºŒæ­¥ï¼šå¯åŠ¨ä¸‰å°Redisï¼ŒæŸ¥çœ‹è¿›ç¨‹" class="headerlink" title="ç¬¬äºŒæ­¥ï¼šå¯åŠ¨ä¸‰å°Redisï¼ŒæŸ¥çœ‹è¿›ç¨‹"></a>ç¬¬äºŒæ­¥ï¼šå¯åŠ¨ä¸‰å°Redisï¼ŒæŸ¥çœ‹è¿›ç¨‹</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@localhost redis]# redis-server /opt/redis/redisConf/redis6379.conf</span><br><span class="line">[root@localhost redis]# redis-server /opt/redis/redisConf/redis6380.conf</span><br><span class="line">[root@localhost redis]# redis-server /opt/redis/redisConf/redis6381.conf</span><br><span class="line">[root@localhost redis]# ps -ef|grep redis</span><br><span class="line">root       1279      1  0 15:22 ?        00:00:12 redis-server *:6379</span><br><span class="line">root       1365      1  0 16:12 ?        00:00:00 redis-server *:6380</span><br><span class="line">root       1371      1  1 16:12 ?        00:00:00 redis-server *:6381</span><br><span class="line">root       1377   1254  0 16:12 pts/0    00:00:00 grep --color=auto redis</span><br></pre></td></tr></table></figure>

<h3 id="ç¬¬ä¸‰æ­¥ï¼šä½¿ç”¨-info-replication-æ‰“å°ä¸»ä»å¤åˆ¶ä¿¡æ¯"><a href="#ç¬¬ä¸‰æ­¥ï¼šä½¿ç”¨-info-replication-æ‰“å°ä¸»ä»å¤åˆ¶ä¿¡æ¯" class="headerlink" title="ç¬¬ä¸‰æ­¥ï¼šä½¿ç”¨ info replication æ‰“å°ä¸»ä»å¤åˆ¶ä¿¡æ¯"></a>ç¬¬ä¸‰æ­¥ï¼šä½¿ç”¨ info replication æ‰“å°ä¸»ä»å¤åˆ¶ä¿¡æ¯</h3><p>ä½¿ç”¨å‘½ä»¤ redis-cli -p 6379 è¿æ¥ï¼Œæ­¤æ—¶ä¸‰å°Redis æ²¡æœ‰ç›¸å…³æ€§ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@localhost redis]# redis-cli -p 6379</span><br><span class="line">127.0.0.1:6379&gt; info replication</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Replication</span></span><br><span class="line">role:master</span><br><span class="line">connected_slaves:0</span><br><span class="line">master_failover_state:no-failover</span><br><span class="line">master_replid:b000a8297805ddb0f87b16a334ac5192fc090a9b</span><br><span class="line">master_replid2:0000000000000000000000000000000000000000</span><br><span class="line">master_repl_offset:0</span><br><span class="line">second_repl_offset:-1</span><br><span class="line">repl_backlog_active:0</span><br><span class="line">repl_backlog_size:1048576</span><br><span class="line">repl_backlog_first_byte_offset:0</span><br><span class="line">repl_backlog_histlen:0</span><br></pre></td></tr></table></figure>

<h3 id="ç¬¬å››æ­¥ï¼šé…ç½®ä¸»æœºå’Œä»æœº"><a href="#ç¬¬å››æ­¥ï¼šé…ç½®ä¸»æœºå’Œä»æœº" class="headerlink" title="ç¬¬å››æ­¥ï¼šé…ç½®ä¸»æœºå’Œä»æœº"></a>ç¬¬å››æ­¥ï¼šé…ç½®ä¸»æœºå’Œä»æœº</h3><p>ä½¿ç”¨ slaveof <ip><port> å‘½ä»¤ï¼Œåœ¨ä»æœºä¸Šé…ç½®å®ƒçš„ä¸»æœºã€‚</port></ip></p>
<p>redis6379ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@localhost redis]# redis-cli -p 6379</span><br><span class="line">127.0.0.1:6379&gt; info replication</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Replication</span></span><br><span class="line">role:master</span><br><span class="line">connected_slaves:2</span><br><span class="line">slave0:ip=127.0.0.1,port=6380,state=online,offset=56,lag=0</span><br><span class="line">slave1:ip=127.0.0.1,port=6381,state=online,offset=56,lag=0</span><br><span class="line">master_failover_state:no-failover</span><br><span class="line">master_replid:8c04d0a2552ad18119aa3b0d037e957646a294ac</span><br><span class="line">master_replid2:0000000000000000000000000000000000000000</span><br><span class="line">master_repl_offset:56</span><br><span class="line">second_repl_offset:-1</span><br><span class="line">repl_backlog_active:1</span><br><span class="line">repl_backlog_size:1048576</span><br><span class="line">repl_backlog_first_byte_offset:1</span><br><span class="line">repl_backlog_histlen:56</span><br><span class="line">127.0.0.1:6379&gt;</span><br></pre></td></tr></table></figure>

<p>redis6380ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@localhost ~]# redis-cli -p 6380</span><br><span class="line">127.0.0.1:6380&gt; slaveof 127.0.0.1 6379</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6380&gt; info replication</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Replication</span></span><br><span class="line">role:slave</span><br><span class="line">master_host:127.0.0.1</span><br><span class="line">master_port:6379</span><br><span class="line">master_link_status:up</span><br><span class="line">master_last_io_seconds_ago:2</span><br><span class="line">master_sync_in_progress:0</span><br><span class="line">slave_repl_offset:56</span><br><span class="line">slave_priority:100</span><br><span class="line">slave_read_only:1</span><br><span class="line">connected_slaves:0</span><br><span class="line">master_failover_state:no-failover</span><br><span class="line">master_replid:8c04d0a2552ad18119aa3b0d037e957646a294ac</span><br><span class="line">master_replid2:0000000000000000000000000000000000000000</span><br><span class="line">master_repl_offset:56</span><br><span class="line">second_repl_offset:-1</span><br><span class="line">repl_backlog_active:1</span><br><span class="line">repl_backlog_size:1048576</span><br><span class="line">repl_backlog_first_byte_offset:1</span><br><span class="line">repl_backlog_histlen:56</span><br><span class="line">127.0.0.1:6380&gt;</span><br></pre></td></tr></table></figure>

<p>redis6381ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@localhost ~]# redis-cli -p 6381</span><br><span class="line">127.0.0.1:6381&gt; slaveof 127.0.0.1 6379</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6381&gt; info replication</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Replication</span></span><br><span class="line">role:slave</span><br><span class="line">master_host:127.0.0.1</span><br><span class="line">master_port:6379</span><br><span class="line">master_link_status:up</span><br><span class="line">master_last_io_seconds_ago:2</span><br><span class="line">master_sync_in_progress:0</span><br><span class="line">slave_repl_offset:42</span><br><span class="line">slave_priority:100</span><br><span class="line">slave_read_only:1</span><br><span class="line">connected_slaves:0</span><br><span class="line">master_failover_state:no-failover</span><br><span class="line">master_replid:8c04d0a2552ad18119aa3b0d037e957646a294ac</span><br><span class="line">master_replid2:0000000000000000000000000000000000000000</span><br><span class="line">master_repl_offset:42</span><br><span class="line">second_repl_offset:-1</span><br><span class="line">repl_backlog_active:1</span><br><span class="line">repl_backlog_size:1048576</span><br><span class="line">repl_backlog_first_byte_offset:29</span><br><span class="line">repl_backlog_histlen:14</span><br><span class="line">127.0.0.1:6381&gt;</span><br></pre></td></tr></table></figure>

<h3 id="ç¬¬äº”æ­¥ï¼šè¯»å†™æ•°æ®"><a href="#ç¬¬äº”æ­¥ï¼šè¯»å†™æ•°æ®" class="headerlink" title="ç¬¬äº”æ­¥ï¼šè¯»å†™æ•°æ®"></a>ç¬¬äº”æ­¥ï¼šè¯»å†™æ•°æ®</h3><p>åœ¨ä¸»æœºä¸Šå†™ï¼Œåœ¨ä»æœºä¸Šå¯ä»¥è¯»å–æ•°æ®ï¼Œåœ¨ä»æœºä¸Šå†™æ•°æ®æŠ¥é”™ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@localhost ~]# redis-cli -p 6381</span><br><span class="line">127.0.0.1:6381&gt; get k1</span><br><span class="line">&quot;v1&quot;</span><br><span class="line">127.0.0.1:6381&gt; set k1 v2</span><br><span class="line">(error) READONLY You can&#x27;t write against a read only replica.</span><br><span class="line">127.0.0.1:6381&gt;</span><br></pre></td></tr></table></figure>

<h3 id="ç¬¬å…­æ­¥ï¼šä¸»æœºæŒ‚æ‰ï¼Œé‡å¯ä»æ˜¯master"><a href="#ç¬¬å…­æ­¥ï¼šä¸»æœºæŒ‚æ‰ï¼Œé‡å¯ä»æ˜¯master" class="headerlink" title="ç¬¬å…­æ­¥ï¼šä¸»æœºæŒ‚æ‰ï¼Œé‡å¯ä»æ˜¯master"></a>ç¬¬å…­æ­¥ï¼šä¸»æœºæŒ‚æ‰ï¼Œé‡å¯ä»æ˜¯master</h3><h3 id="ç¬¬ä¸ƒæ­¥ï¼šä»æœºé‡å¯ï¼Œéœ€è¦é‡è®¾ï¼šslaveof-127-0-0-1-6379"><a href="#ç¬¬ä¸ƒæ­¥ï¼šä»æœºé‡å¯ï¼Œéœ€è¦é‡è®¾ï¼šslaveof-127-0-0-1-6379" class="headerlink" title="ç¬¬ä¸ƒæ­¥ï¼šä»æœºé‡å¯ï¼Œéœ€è¦é‡è®¾ï¼šslaveof 127.0.0.1 6379"></a>ç¬¬ä¸ƒæ­¥ï¼šä»æœºé‡å¯ï¼Œéœ€è¦é‡è®¾ï¼šslaveof 127.0.0.1 6379</h3><p>å¯ä»¥å°†é…ç½®å¢åŠ åˆ°æ–‡ä»¶ä¸­ã€‚æ°¸ä¹…ç”Ÿæ•ˆã€‚</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@localhost ~]# ps -ef |grep redis</span><br><span class="line">root       1459      1  0 16:19 ?        00:00:02 redis-server *:6379</span><br><span class="line">root       1466      1  0 16:19 ?        00:00:02 redis-server *:6380</span><br><span class="line">root       1472      1  0 16:20 ?        00:00:02 redis-server *:6381</span><br><span class="line">root       1483   1254  0 16:25 pts/0    00:00:00 redis-cli -p 6379</span><br><span class="line">root       1485   1386  0 16:25 pts/2    00:00:00 redis-cli -p 6380</span><br><span class="line">root       1492   1424  0 16:28 pts/1    00:00:00 grep --color=auto redis</span><br><span class="line">[root@localhost ~]# kill -9 1466</span><br><span class="line">[root@localhost ~]# redis-server /opt/redis/redisConf/redis6380.conf</span><br><span class="line">[root@localhost ~]# redis-cli -p 6380</span><br><span class="line">127.0.0.1:6380&gt; info replication</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Replication</span></span><br><span class="line">role:master</span><br><span class="line">connected_slaves:0</span><br><span class="line">master_failover_state:no-failover</span><br><span class="line">master_replid:8628d72c430b24fa92275794735788802033a865</span><br><span class="line">master_replid2:0000000000000000000000000000000000000000</span><br><span class="line">master_repl_offset:0</span><br><span class="line">second_repl_offset:-1</span><br><span class="line">repl_backlog_active:0</span><br><span class="line">repl_backlog_size:1048576</span><br><span class="line">repl_backlog_first_byte_offset:0</span><br><span class="line">repl_backlog_histlen:0</span><br></pre></td></tr></table></figure>



<h2 id="ä¸»ä»å¤åˆ¶åŸç†"><a href="#ä¸»ä»å¤åˆ¶åŸç†" class="headerlink" title="ä¸»ä»å¤åˆ¶åŸç†"></a><strong>ä¸»ä»å¤åˆ¶åŸç†</strong></h2><ol>
<li>Slave å¯åŠ¨æˆåŠŸè¿æ¥åˆ° master åä¼šå‘é€ä¸€ä¸ª sync å‘½ä»¤</li>
<li>Masteræ¥åˆ°å‘½ä»¤å¯åŠ¨åå°çš„å­˜ç›˜è¿›ç¨‹ï¼ŒåŒæ—¶æ”¶é›†æ‰€æœ‰æ¥æ”¶åˆ°çš„ç”¨äºä¿®æ”¹æ•°æ®é›†å‘½ä»¤ï¼Œ åœ¨åå°è¿›ç¨‹æ‰§è¡Œå®Œæ¯•ä¹‹åï¼Œmasterå°†ä¼ é€æ•´ä¸ªæ•°æ®æ–‡ä»¶åˆ° slaveï¼Œä»¥å®Œæˆä¸€æ¬¡å®Œå…¨åŒæ­¥</li>
<li>å…¨é‡å¤åˆ¶ï¼šè€ŒslaveæœåŠ¡åœ¨æ¥æ”¶åˆ°æ•°æ®åº“æ–‡ä»¶æ•°æ®åï¼Œå°†å…¶å­˜ç›˜å¹¶åŠ è½½åˆ°å†…å­˜ä¸­</li>
<li>å¢é‡å¤åˆ¶ï¼šMasterç»§ç»­å°†æ–°çš„æ‰€æœ‰æ”¶é›†åˆ°çš„ä¿®æ”¹å‘½ä»¤ä¾æ¬¡ä¼ ç»™ slaveï¼Œå®ŒæˆåŒæ­¥</li>
<li><strong>ä½†æ˜¯åªè¦æ˜¯é‡æ–°è¿æ¥ masterï¼Œä¸€æ¬¡å®Œå…¨åŒæ­¥ï¼ˆå…¨é‡å¤åˆ¶ï¼‰å°†è¢«è‡ªåŠ¨æ‰§è¡Œ</strong></li>
</ol>
<h2 id="é—®é¢˜ï¼šä¸»æœºä»æœºå®•æœºæ•°æ®å¤åˆ¶é—®é¢˜"><a href="#é—®é¢˜ï¼šä¸»æœºä»æœºå®•æœºæ•°æ®å¤åˆ¶é—®é¢˜" class="headerlink" title="é—®é¢˜ï¼šä¸»æœºä»æœºå®•æœºæ•°æ®å¤åˆ¶é—®é¢˜"></a>é—®é¢˜ï¼šä¸»æœºä»æœºå®•æœºæ•°æ®å¤åˆ¶é—®é¢˜</h2><ol>
<li>ä»æœº slave æ˜¯å…¨é‡èµ‹å€¼ï¼Œä»å¤´å¼€å§‹å¤åˆ¶ï¼Œæ–°å¢çš„é”®ä¼šé‡æ–°å¤åˆ¶</li>
<li>ä»æœº slave å¯ä»¥åªèƒ½è¯»ï¼Œä¸èƒ½å†™</li>
<li>ä¸»æœº shutdown åï¼Œä»æœºåŸåœ°å¾…å‘½ï¼Œä¸ä¼šå˜ä¸ºä¸»æœº</li>
<li>ä¸»æœº shutdown åï¼Œåˆé‡æ–°å¯åŠ¨ï¼Œä»æœºä»èƒ½æ¥å—æ•°æ®</li>
<li>ä»æœº shutdown åï¼Œé‡æ–°å¯åŠ¨ï¼Œä¼šé‡å¤´å¼€å§‹å¯åŠ¨</li>
</ol>
<p>ç¤ºä¾‹ï¼š</p>
<h2 id="é—®é¢˜ï¼šSlaveä¹Ÿå¯ä»¥æ˜¯-Master"><a href="#é—®é¢˜ï¼šSlaveä¹Ÿå¯ä»¥æ˜¯-Master" class="headerlink" title="é—®é¢˜ï¼šSlaveä¹Ÿå¯ä»¥æ˜¯ Master"></a>é—®é¢˜ï¼šSlaveä¹Ÿå¯ä»¥æ˜¯ Master</h2><p>ä¸Šä¸€ä¸ª Slave å¯ä»¥æ˜¯ä¸‹ä¸€ä¸ª Slave çš„ Masterï¼ŒSlave åŒæ ·å¯ä»¥æ¥æ”¶å…¶ä»– Slaves çš„è¿æ¥å’ŒåŒæ­¥è¯·æ±‚ï¼Œé‚£ä¹ˆè¯¥ Slave ä½œä¸ºäº†é“¾æ¡ä¸­ä¸‹ä¸€ä¸ªçš„ Master, å¯ä»¥æœ‰æ•ˆå‡è½» Master çš„å†™å‹åŠ›ï¼Œå»ä¸­å¿ƒåŒ–é™ä½é£é™©ã€‚</p>
<p>ç”¨ Slaveof <ip><port></port></ip></p>
<p>ä¸­é€”å˜æ›´è½¬å‘ï¼šä¼šæ¸…é™¤ä¹‹å‰çš„æ•°æ®ï¼Œé‡æ–°å»ºç«‹æ‹·è´æœ€æ–°çš„</p>
<p>é£é™©æ˜¯ä¸€æ—¦æŸä¸ª Slave å®•æœºï¼Œåé¢çš„ Slave éƒ½æ²¡æ³•å¤‡ä»½</p>
<p>ä¸»æœºæŒ‚äº†ï¼Œä»æœºè¿˜æ˜¯ä»æœºï¼Œæ— æ³•å†™æ•°æ®äº†</p>
<h2 id="é—®é¢˜ï¼šMasterå®•æœºåï¼Œä»æœºå˜ä¸ºä¸»æœº"><a href="#é—®é¢˜ï¼šMasterå®•æœºåï¼Œä»æœºå˜ä¸ºä¸»æœº" class="headerlink" title="é—®é¢˜ï¼šMasterå®•æœºåï¼Œä»æœºå˜ä¸ºä¸»æœº"></a>é—®é¢˜ï¼šMasterå®•æœºåï¼Œä»æœºå˜ä¸ºä¸»æœº</h2><p>å½“ä¸€ä¸ªmasterå®•æœºåï¼Œä½¿ç”¨ slaveof no one  å°†ä»æœºå˜ä¸ºä¸»æœºã€‚</p>
<p>åé¢çš„slaveå¯ä»¥ç«‹åˆ»å‡ä¸ºmasterï¼Œå…¶åé¢çš„slaveä¸ç”¨åšä»»ä½•ä¿®æ”¹ã€‚</p>
<h2 id="å“¨å…µæ¨¡å¼ï¼ˆsentinelï¼‰"><a href="#å“¨å…µæ¨¡å¼ï¼ˆsentinelï¼‰" class="headerlink" title="å“¨å…µæ¨¡å¼ï¼ˆsentinelï¼‰"></a><strong>å“¨å…µæ¨¡å¼</strong>ï¼ˆsentinelï¼‰</h2><p>ä¸»æœº shutdown åï¼Œåœ¨ä»æœºä¸­é€‰å‡ºä¸»æœºã€‚</p>
<p>é€šè¿‡å“¨å…µèƒ½å¤Ÿåå°ç›‘æ§ä¸»æœºæ˜¯å¦æ•…éšœï¼Œå¦‚æœå‡ºç°æ•…éšœï¼Œåˆ™æ ¹æ®æŠ•ç¥¨æ•°è‡ªåŠ¨å°†ä»åº“è½¬æ¢ä¸ºä¸»åº“ã€‚</p>
<h3 id="ç¬¬ä¸€æ­¥ï¼šæ–°å»º-sentinel-conf-æ–‡ä»¶"><a href="#ç¬¬ä¸€æ­¥ï¼šæ–°å»º-sentinel-conf-æ–‡ä»¶" class="headerlink" title="ç¬¬ä¸€æ­¥ï¼šæ–°å»º sentinel.conf æ–‡ä»¶"></a>ç¬¬ä¸€æ­¥ï¼šæ–°å»º sentinel.conf æ–‡ä»¶</h3><p><strong>æ–‡ä»¶åå¿…é¡»åŒ¹é…</strong></p>
<h3 id="ç¬¬äºŒæ­¥ï¼šé…ç½®æ–‡ä»¶å†…å®¹"><a href="#ç¬¬äºŒæ­¥ï¼šé…ç½®æ–‡ä»¶å†…å®¹" class="headerlink" title="ç¬¬äºŒæ­¥ï¼šé…ç½®æ–‡ä»¶å†…å®¹"></a>ç¬¬äºŒæ­¥ï¼šé…ç½®æ–‡ä»¶å†…å®¹</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">mymaster: ä¸»æœºåˆ«åï¼Œ1ï¼šè‡³å°‘æœ‰å¤šå°‘ä¸ªå“¨å…µåŒæ„è¿ç§»çš„æ•°é‡ã€‚</span> </span><br><span class="line">sentinel monitor mymaster 127.0.0.1 6379 1</span><br></pre></td></tr></table></figure>

<h3 id="ç¬¬ä¸‰æ­¥ï¼šå¯åŠ¨å“¨å…µ"><a href="#ç¬¬ä¸‰æ­¥ï¼šå¯åŠ¨å“¨å…µ" class="headerlink" title="ç¬¬ä¸‰æ­¥ï¼šå¯åŠ¨å“¨å…µ"></a>ç¬¬ä¸‰æ­¥ï¼šå¯åŠ¨å“¨å…µ</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@localhost redis]# vim redisConf/sentinel.conf</span><br><span class="line">sentinel monitor mymaster 127.0.0.1 6379 1</span><br><span class="line">[root@localhost redis]# ls /usr/local/bin/</span><br><span class="line">redis-benchmark  redis-check-aof  redis-check-rdb  redis-cli  redis-sentinel  redis-server</span><br><span class="line">[root@localhost redis]# redis-sentinel /opt/redis/redisConf/sentinel.conf</span><br></pre></td></tr></table></figure>

<p><img src="/2023/02/28/Redis/Java\Document\Redis\Redis.assets\image-20221008170523011.png" alt="image-20221008170523011"></p>
<h3 id="ç¬¬å››æ­¥ï¼šå½“ä¸»æœºæŒ‚æ‰ï¼Œä»æœºé€‰ä¸¾ä¸­äº§ç”Ÿæ–°çš„ä¸»æœº"><a href="#ç¬¬å››æ­¥ï¼šå½“ä¸»æœºæŒ‚æ‰ï¼Œä»æœºé€‰ä¸¾ä¸­äº§ç”Ÿæ–°çš„ä¸»æœº" class="headerlink" title="ç¬¬å››æ­¥ï¼šå½“ä¸»æœºæŒ‚æ‰ï¼Œä»æœºé€‰ä¸¾ä¸­äº§ç”Ÿæ–°çš„ä¸»æœº"></a>ç¬¬å››æ­¥ï¼šå½“ä¸»æœºæŒ‚æ‰ï¼Œä»æœºé€‰ä¸¾ä¸­äº§ç”Ÿæ–°çš„ä¸»æœº</h3><p>é€‰ä¸¾åŸåˆ™ï¼šæ ¹æ®ä¼˜å…ˆçº§åˆ«ï¼šslave-priority ï¼ŒåŸä¸»æœºé‡å¯åä¼šå˜ä¸ºä»æœºã€‚</p>
<p>slave-priority é»˜è®¤100ï¼Œæ•°å€¼è¶Šå°ï¼Œä¼˜å…ˆçº§è¶Šé«˜ã€‚</p>
<p><img src="/2023/02/28/Redis/Java\Document\Redis\Redis.assets\image-20221008171004905.png" alt="image-20221008171004905"></p>
<h3 id="å¤åˆ¶å»¶æ—¶"><a href="#å¤åˆ¶å»¶æ—¶" class="headerlink" title="å¤åˆ¶å»¶æ—¶"></a><strong>å¤åˆ¶å»¶æ—¶</strong></h3><p>ç”±äºæ‰€æœ‰çš„å†™æ“ä½œéƒ½æ˜¯å…ˆåœ¨Masterä¸Šæ“ä½œï¼Œç„¶ååŒæ­¥æ›´æ–°åˆ°Slaveä¸Šï¼Œæ‰€ä»¥ä»MasteråŒæ­¥åˆ°Slaveæœºå™¨æœ‰ä¸€å®šçš„å»¶è¿Ÿï¼Œå½“ç³»ç»Ÿå¾ˆç¹å¿™çš„æ—¶å€™ï¼Œå»¶è¿Ÿé—®é¢˜ä¼šæ›´åŠ ä¸¥é‡ï¼ŒSlaveæœºå™¨æ•°é‡çš„å¢åŠ ä¹Ÿä¼šä½¿è¿™ä¸ªé—®é¢˜æ›´åŠ ä¸¥é‡ã€‚</p>
<h3 id="æ•…éšœæ¢å¤"><a href="#æ•…éšœæ¢å¤" class="headerlink" title="æ•…éšœæ¢å¤"></a>æ•…éšœæ¢å¤</h3><h4 id="é€‰æ‹©æ¡ä»¶"><a href="#é€‰æ‹©æ¡ä»¶" class="headerlink" title="é€‰æ‹©æ¡ä»¶"></a>é€‰æ‹©æ¡ä»¶</h4><p>é€‰æ‹©ä¼˜å…ˆçº§é«˜çš„ï¼Œåç§»é‡å¤§çš„ï¼Œrunid æœ€å°çš„æœåŠ¡ã€‚</p>
<ul>
<li>ä¼˜å…ˆçº§åœ¨ redis.conf ä¸­é»˜è®¤ï¼šslave-priority 100ï¼Œå€¼è¶Šå°ä¼˜å…ˆçº§è¶Šé«˜</li>
<li>åç§»é‡ï¼šæŒ‡è·å¾—åŸä¸»æœºæ•°æ®æœ€å…¨çš„</li>
<li>æ¯ä¸ª redis å®ä¾‹å¯åŠ¨åéƒ½ä¼šéšæœºç”Ÿæˆä¸€ä¸ª40ä½çš„ runid</li>
</ul>
<p>æŒ‘é€‰å‡ºæ–°çš„ä¸»æœåŠ¡åï¼Œsentinelä¼šå‘åŸä¸»æœåŠ¡çš„ä»æœåŠ¡å‘é€ slaveof æ–°ä¸»æœºçš„å‘½ä»¤ï¼Œå¤åˆ¶æ–°çš„ masterã€‚</p>
<p>å½“åŸä¸»æœºé‡æ–°ä¸Šçº¿åï¼Œsentinel åŒæ ·ä¼šå‘é€ slaveof å‘½ä»¤ï¼Œè®©å…¶æˆä¸ºæ–°ä¸»æœºçš„ä»æœºã€‚</p>
<h2 id="Javaä»£ç å®ç°ä¸»ä»å¤åˆ¶"><a href="#Javaä»£ç å®ç°ä¸»ä»å¤åˆ¶" class="headerlink" title="Javaä»£ç å®ç°ä¸»ä»å¤åˆ¶"></a>Javaä»£ç å®ç°ä¸»ä»å¤åˆ¶</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> JedisSentinelPool jedisSentinelPool=<span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span>  Jedis <span class="title function_">getJedisFromSentinel</span><span class="params">()</span>&#123;</span><br><span class="line"><span class="keyword">if</span>(jedisSentinelPool==<span class="literal">null</span>)&#123;</span><br><span class="line">            Set&lt;String&gt; sentinelSet=<span class="keyword">new</span> <span class="title class_">HashSet</span>&lt;&gt;();</span><br><span class="line">            sentinelSet.add(<span class="string">&quot;192.168.100.100:26379&quot;</span>);</span><br><span class="line">            <span class="type">JedisPoolConfig</span> <span class="variable">jedisPoolConfig</span> <span class="operator">=</span><span class="keyword">new</span> <span class="title class_">JedisPoolConfig</span>();</span><br><span class="line">            jedisPoolConfig.setMaxTotal(<span class="number">10</span>); <span class="comment">//æœ€å¤§å¯ç”¨è¿æ¥æ•°</span></span><br><span class="line">jedisPoolConfig.setMaxIdle(<span class="number">5</span>); <span class="comment">//æœ€å¤§é—²ç½®è¿æ¥æ•°</span></span><br><span class="line">jedisPoolConfig.setMinIdle(<span class="number">5</span>); <span class="comment">//æœ€å°é—²ç½®è¿æ¥æ•°</span></span><br><span class="line">jedisPoolConfig.setBlockWhenExhausted(<span class="literal">true</span>); <span class="comment">//è¿æ¥è€—å°½æ˜¯å¦ç­‰å¾…</span></span><br><span class="line">jedisPoolConfig.setMaxWaitMillis(<span class="number">2000</span>); <span class="comment">//ç­‰å¾…æ—¶é—´</span></span><br><span class="line">jedisPoolConfig.setTestOnBorrow(<span class="literal">true</span>); <span class="comment">//å–è¿æ¥çš„æ—¶å€™è¿›è¡Œä¸€ä¸‹æµ‹è¯• ping pong</span></span><br><span class="line"></span><br><span class="line">jedisSentinelPool=<span class="keyword">new</span> <span class="title class_">JedisSentinelPool</span>(<span class="string">&quot;mymaster&quot;</span>,sentinelSet,jedisPoolConfig);</span><br><span class="line"><span class="keyword">return</span> jedisSentinelPool.getResource();</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line"><span class="keyword">return</span> jedisSentinelPool.getResource();</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h1 id="Redis-é›†ç¾¤"><a href="#Redis-é›†ç¾¤" class="headerlink" title="Redis é›†ç¾¤"></a><strong>Redis</strong> é›†ç¾¤</h1><h2 id="è§£å†³çš„é—®é¢˜"><a href="#è§£å†³çš„é—®é¢˜" class="headerlink" title="è§£å†³çš„é—®é¢˜"></a>è§£å†³çš„é—®é¢˜</h2><ul>
<li><p>å®¹é‡ä¸å¤Ÿï¼ŒRedis æ‰©å®¹é—®é¢˜</p>
</li>
<li><p>å¹¶å‘å†™æ“ä½œï¼Œ Redis åˆ†æ‘Šæ“ä½œ</p>
<p>  å¦‚ä¸åŒçš„è¯·æ±‚æ•°æ®ä¼šæ”¾åœ¨ä¸åŒçš„ Redis ä¸­è¿›è¡Œç¼“å­˜ï¼Œå¯ä»¥é€šè¿‡ä»£ç†ä¸»æœºè¿›è¡Œè§£å†³ã€‚ä½†æ˜¯ Redis3.0 ä¸­æä¾›äº†è§£å†³æ–¹æ¡ˆã€‚å°±æ˜¯æ— ä¸­å¿ƒåŒ–é›†ç¾¤é…ç½®ï¼šæ¯ä¸€ä¸ª Redis æœåŠ¡éƒ½ä¼šè½¬å‘ç»™å…¶ä»–çš„ Redisã€‚</p>
</li>
</ul>
<h2 id="é›†ç¾¤"><a href="#é›†ç¾¤" class="headerlink" title="é›†ç¾¤"></a>é›†ç¾¤</h2><p>Redis é›†ç¾¤å®ç°äº†å¯¹ Redis çš„æ°´å¹³æ‰©å®¹ï¼Œå³å¯åŠ¨ N ä¸ª redis èŠ‚ç‚¹ï¼Œå°†æ•´ä¸ªæ•°æ®åº“åˆ†å¸ƒå­˜å‚¨åœ¨è¿™ N ä¸ªèŠ‚ç‚¹ä¸­ï¼Œæ¯ä¸ªèŠ‚ç‚¹å­˜å‚¨æ€»æ•°æ®çš„1&#x2F;Nã€‚</p>
<p><strong>Redis é›†ç¾¤é€šè¿‡åˆ†åŒºï¼ˆpartitionï¼‰æ¥æä¾›ä¸€å®šç¨‹åº¦çš„å¯ç”¨æ€§ï¼ˆavailabilityï¼‰</strong>ï¼š å³ä½¿é›†ç¾¤ä¸­æœ‰ä¸€éƒ¨åˆ†èŠ‚ç‚¹å¤±æ•ˆæˆ–è€…æ— æ³•è¿›è¡Œé€šè®¯ï¼Œ é›†ç¾¤ä¹Ÿå¯ä»¥ç»§ç»­å¤„ç†å‘½ä»¤è¯·æ±‚ã€‚</p>
<h2 id="æ­å»ºé›†ç¾¤ç¯å¢ƒ"><a href="#æ­å»ºé›†ç¾¤ç¯å¢ƒ" class="headerlink" title="æ­å»ºé›†ç¾¤ç¯å¢ƒ"></a>æ­å»ºé›†ç¾¤ç¯å¢ƒ</h2><h3 id="ç¬¬ä¸€æ­¥ï¼šæ–°å»ºé…ç½®æ–‡ä»¶-1"><a href="#ç¬¬ä¸€æ­¥ï¼šæ–°å»ºé…ç½®æ–‡ä»¶-1" class="headerlink" title="ç¬¬ä¸€æ­¥ï¼šæ–°å»ºé…ç½®æ–‡ä»¶"></a>ç¬¬ä¸€æ­¥ï¼šæ–°å»ºé…ç½®æ–‡ä»¶</h3><p>åœ¨ &#x2F;opt&#x2F;redis&#x2F;redisClusterConf ä¸‹æ–°å»º redis6379.conf é…ç½®</p>
<p>ä½¿ç”¨ç«¯å£ï¼š6379	6380	6381	6389	6390	6391</p>
<p><strong>é…ç½®ä¿¡æ¯ï¼š</strong></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">include /etc/redis.conf</span><br><span class="line">pidfile /var/run/redis_6379.pid</span><br><span class="line">port 6379</span><br><span class="line">dbfilename dump6379.rdb</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æ‰“å¼€é›†ç¾¤æ¨¡å¼</span></span><br><span class="line">cluster-enabled yes</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">è®¾å®šèŠ‚ç‚¹é…ç½®æ–‡ä»¶å</span></span><br><span class="line">cluster-config-file nodes-6379.conf</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">è®¾å®šèŠ‚ç‚¹å¤±è”æ—¶é—´ï¼Œè¶…è¿‡è¯¥æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰ï¼Œé›†ç¾¤è‡ªåŠ¨è¿›è¡Œä¸»ä»åˆ‡æ¢ã€‚</span></span><br><span class="line">cluster-node-timeout 15000</span><br></pre></td></tr></table></figure>

<p>æ‹·è´å¤šä»½æ–‡ä»¶ï¼Œå¹¶åœ¨ vim ä¸­ä½¿ç”¨å‘½ä»¤æ›¿æ¢ï¼š%s&#x2F;6379&#x2F;6380 </p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@localhost redisClusterConf]# ll</span><br><span class="line">æ€»ç”¨é‡ 24</span><br><span class="line">-rw-r--r--. 1 root root 318 10æœˆ  8 17:40 redis6379.conf</span><br><span class="line">-rw-r--r--. 1 root root 318 10æœˆ  8 17:42 redis6380.conf</span><br><span class="line">-rw-r--r--. 1 root root 318 10æœˆ  8 17:42 redis6381.conf</span><br><span class="line">-rw-r--r--. 1 root root 318 10æœˆ  8 17:42 redis6389.conf</span><br><span class="line">-rw-r--r--. 1 root root 318 10æœˆ  8 17:43 redis6390.conf</span><br><span class="line">-rw-r--r--. 1 root root 318 10æœˆ  8 17:44 redis6391.conf</span><br></pre></td></tr></table></figure>

<h3 id="ç¬¬äºŒæ­¥ï¼šå¯åŠ¨6ä¸ªå®ä¾‹"><a href="#ç¬¬äºŒæ­¥ï¼šå¯åŠ¨6ä¸ªå®ä¾‹" class="headerlink" title="ç¬¬äºŒæ­¥ï¼šå¯åŠ¨6ä¸ªå®ä¾‹"></a>ç¬¬äºŒæ­¥ï¼šå¯åŠ¨6ä¸ªå®ä¾‹</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@localhost redisClusterConf]# redis-server /opt/redis/redisClusterConf/redis6379.conf</span><br><span class="line">[root@localhost redisClusterConf]# redis-server /opt/redis/redisClusterConf/redis6380.conf</span><br><span class="line">[root@localhost redisClusterConf]# redis-server /opt/redis/redisClusterConf/redis6381.conf</span><br><span class="line">[root@localhost redisClusterConf]# redis-server /opt/redis/redisClusterConf/redis6389.conf</span><br><span class="line">[root@localhost redisClusterConf]# redis-server /opt/redis/redisClusterConf/redis6390.conf</span><br><span class="line">[root@localhost redisClusterConf]# redis-server /opt/redis/redisClusterConf/redis6391.conf</span><br><span class="line">[root@localhost redisClusterConf]# ps -ef|grep redis</span><br><span class="line">root       1620      1  0 17:58 ?        00:00:00 redis-server *:6379 [cluster]</span><br><span class="line">root       1626      1  0 17:58 ?        00:00:00 redis-server *:6380 [cluster]</span><br><span class="line">root       1632      1  0 17:58 ?        00:00:00 redis-server *:6381 [cluster]</span><br><span class="line">root       1638      1  1 17:58 ?        00:00:00 redis-server *:6389 [cluster]</span><br><span class="line">root       1644      1  1 17:58 ?        00:00:00 redis-server *:6390 [cluster]</span><br><span class="line">root       1650      1  1 17:58 ?        00:00:00 redis-server *:6391 [cluster]</span><br><span class="line">root       1656   1254  0 17:59 pts/0    00:00:00 grep --color=auto redis</span><br><span class="line">[root@localhost redisClusterConf]#</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="ç¬¬ä¸‰æ­¥ï¼šå¯åŠ¨é›†ç¾¤"><a href="#ç¬¬ä¸‰æ­¥ï¼šå¯åŠ¨é›†ç¾¤" class="headerlink" title="ç¬¬ä¸‰æ­¥ï¼šå¯åŠ¨é›†ç¾¤"></a>ç¬¬ä¸‰æ­¥ï¼šå¯åŠ¨é›†ç¾¤</h3><p>å‘½ä»¤ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@localhost redisClusterConf]# redis-cli --cluster create --cluster-replicas 1 192.168.100.100:6379 192.168.100.100:6380 192.168.100.100:6381 192.168.100.100:6389 192.168.100.100:6390 192.168.100.100:6391</span><br></pre></td></tr></table></figure>

<p>æ³¨æ„ï¼šæ­¤å¤„ä¸è¦ç”¨127.0.0.1ï¼Œ è¯·ç”¨çœŸå®IPåœ°å€ï¼Œ**â€“replicas 1 é‡‡ç”¨æœ€ç®€å•çš„æ–¹å¼é…ç½®é›†ç¾¤ï¼Œä¸€å°ä¸»æœºï¼Œä¸€å°ä»æœºï¼Œæ­£å¥½ä¸‰ç»„ã€‚**</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@localhost redisClusterConf]# redis-cli --cluster create --cluster-replicas 1 192.168.100.100:6379 192.168.100.100:6380 192.168.100.100:6381 192.168.100.100:6389 192.168.100.100:6390 192.168.100.100:6391</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash">&gt;&gt; Performing <span class="built_in">hash</span> slots allocation on 6 nodes...</span></span><br><span class="line">Master[0] -&gt; Slots 0 - 5460</span><br><span class="line">Master[1] -&gt; Slots 5461 - 10922</span><br><span class="line">Master[2] -&gt; Slots 10923 - 16383</span><br><span class="line">Adding replica 192.168.100.100:6390 to 192.168.100.100:6379</span><br><span class="line">Adding replica 192.168.100.100:6391 to 192.168.100.100:6380</span><br><span class="line">Adding replica 192.168.100.100:6389 to 192.168.100.100:6381</span><br><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash">&gt;&gt; Trying to optimize slaves allocation <span class="keyword">for</span> anti-affinity</span></span><br><span class="line">[WARNING] Some slaves are in the same host as their master</span><br><span class="line">M: a0db3d6715900a287d3222ae4b40cc43f8857a95 192.168.100.100:6379</span><br><span class="line">   slots:[0-5460] (5461 slots) master</span><br><span class="line">M: e37ee97bc6f1479f01515f51dc595ede9a21a0de 192.168.100.100:6380</span><br><span class="line">   slots:[5461-10922] (5462 slots) master</span><br><span class="line">M: 622309a93a73692b81b62481c89c5098da6232f4 192.168.100.100:6381</span><br><span class="line">   slots:[10923-16383] (5461 slots) master</span><br><span class="line">S: 2a7798be8210b18bac7bbdbaed7a51d76e9a0a59 192.168.100.100:6389</span><br><span class="line">   replicates 622309a93a73692b81b62481c89c5098da6232f4</span><br><span class="line">S: d265240801f512f9df68562029dc6df65afe6ddc 192.168.100.100:6390</span><br><span class="line">   replicates a0db3d6715900a287d3222ae4b40cc43f8857a95</span><br><span class="line">S: dc245aad961e75cb71d0ff86de5f83aa3c4bee22 192.168.100.100:6391</span><br><span class="line">   replicates e37ee97bc6f1479f01515f51dc595ede9a21a0de</span><br><span class="line">Can I set the above configuration? (type &#x27;yes&#x27; to accept): yes</span><br><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash">&gt;&gt; Nodes configuration updated</span></span><br><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash">&gt;&gt; Assign a different config epoch to each node</span></span><br><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash">&gt;&gt; Sending CLUSTER MEET messages to <span class="built_in">join</span> the cluster</span></span><br><span class="line">Waiting for the cluster to join</span><br><span class="line">.</span><br><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash">&gt;&gt; Performing Cluster Check (using node 192.168.100.100:6379)</span></span><br><span class="line">M: a0db3d6715900a287d3222ae4b40cc43f8857a95 192.168.100.100:6379</span><br><span class="line">   slots:[0-5460] (5461 slots) master</span><br><span class="line">   1 additional replica(s)</span><br><span class="line">S: dc245aad961e75cb71d0ff86de5f83aa3c4bee22 192.168.100.100:6391</span><br><span class="line">   slots: (0 slots) slave</span><br><span class="line">   replicates e37ee97bc6f1479f01515f51dc595ede9a21a0de</span><br><span class="line">S: 2a7798be8210b18bac7bbdbaed7a51d76e9a0a59 192.168.100.100:6389</span><br><span class="line">   slots: (0 slots) slave</span><br><span class="line">   replicates 622309a93a73692b81b62481c89c5098da6232f4</span><br><span class="line">M: 622309a93a73692b81b62481c89c5098da6232f4 192.168.100.100:6381</span><br><span class="line">   slots:[10923-16383] (5461 slots) master</span><br><span class="line">   1 additional replica(s)</span><br><span class="line">S: d265240801f512f9df68562029dc6df65afe6ddc 192.168.100.100:6390</span><br><span class="line">   slots: (0 slots) slave</span><br><span class="line">   replicates a0db3d6715900a287d3222ae4b40cc43f8857a95</span><br><span class="line">M: e37ee97bc6f1479f01515f51dc595ede9a21a0de 192.168.100.100:6380</span><br><span class="line">   slots:[5461-10922] (5462 slots) master</span><br><span class="line">   1 additional replica(s)</span><br><span class="line">[OK] All nodes agree about slots configuration.</span><br><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash">&gt;&gt; Check <span class="keyword">for</span> open slots...</span></span><br><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash">&gt;&gt; Check slots coverage...</span></span><br><span class="line">[OK] All 16384 slots covered.</span><br><span class="line">[root@localhost redisClusterConf]#</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="ç¬¬å››æ­¥ï¼šç™»å½•"><a href="#ç¬¬å››æ­¥ï¼šç™»å½•" class="headerlink" title="ç¬¬å››æ­¥ï¼šç™»å½•"></a>ç¬¬å››æ­¥ï¼šç™»å½•</h3><h4 id="æ™®é€šæ–¹å¼ç™»å½•"><a href="#æ™®é€šæ–¹å¼ç™»å½•" class="headerlink" title="æ™®é€šæ–¹å¼ç™»å½•"></a>æ™®é€šæ–¹å¼ç™»å½•</h4><p>â€‹		å¯èƒ½ç›´æ¥è¿›å…¥è¯»ä¸»æœºï¼Œå­˜å‚¨æ•°æ®æ—¶ï¼Œä¼šå‡ºç° MOVED é‡å®šå‘æ“ä½œã€‚åº”è¯¥ä»¥é›†ç¾¤æ–¹å¼ç™»å½•ã€‚</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@localhost redisClusterConf]# redis-cli -p 6379</span><br><span class="line">127.0.0.1:6379&gt; keys *</span><br><span class="line">(empty array)</span><br><span class="line">127.0.0.1:6379&gt; set k1 v1</span><br><span class="line">(error) MOVED 12706 192.168.100.100:6381</span><br></pre></td></tr></table></figure>

<h4 id="é›†ç¾¤æ–¹å¼ç™»å½•"><a href="#é›†ç¾¤æ–¹å¼ç™»å½•" class="headerlink" title="é›†ç¾¤æ–¹å¼ç™»å½•"></a>é›†ç¾¤æ–¹å¼ç™»å½•</h4><p> <strong>-c</strong>	<strong>é‡‡ç”¨é›†ç¾¤ç­–ç•¥è¿æ¥ï¼Œè®¾ç½®æ•°æ®ä¼šè‡ªåŠ¨åˆ‡æ¢åˆ°ç›¸åº”çš„å†™ä¸»æœº</strong></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@localhost ~]# redis-cli -c -p 6379</span><br><span class="line">127.0.0.1:6379&gt; keys *</span><br><span class="line">(empty array)</span><br><span class="line">127.0.0.1:6379&gt; set k1 v1</span><br><span class="line"><span class="meta prompt_">-&gt; </span><span class="language-bash">Redirected to slot [12706] located at 192.168.100.100:6381</span></span><br><span class="line">OK</span><br><span class="line">192.168.100.100:6381&gt;</span><br></pre></td></tr></table></figure>

<p>è¿æ¥é›†ç¾¤ï¼Œå†™å…¥æ•°æ®æ—¶ï¼Œä¼šå°†æ•°æ®æ”¾å…¥slot ä¸º 12706ä¸­ï¼Œå¹¶é‡å®šå‘åˆ°è¯¥ä¸»æœºã€‚</p>
<h3 id="æŸ¥çœ‹é›†ç¾¤ä¿¡æ¯"><a href="#æŸ¥çœ‹é›†ç¾¤ä¿¡æ¯" class="headerlink" title="æŸ¥çœ‹é›†ç¾¤ä¿¡æ¯"></a><strong>æŸ¥çœ‹é›†ç¾¤ä¿¡æ¯</strong></h3><p>é€šè¿‡ cluster nodes å‘½ä»¤æŸ¥çœ‹é›†ç¾¤ä¿¡æ¯ï¼š</p>
<p><img src="/2023/02/28/Redis/Java\Document\Redis\Redis.assets\image-20221008192527530.png" alt="image-20221008192527530"></p>
<h3 id="redis-cluster-èŠ‚ç‚¹åˆ†é…"><a href="#redis-cluster-èŠ‚ç‚¹åˆ†é…" class="headerlink" title="redis cluster èŠ‚ç‚¹åˆ†é…"></a><strong>redis cluster èŠ‚ç‚¹åˆ†é…</strong></h3><p>ä¸€ä¸ªé›†ç¾¤è‡³å°‘è¦æœ‰ä¸‰ä¸ªä¸»èŠ‚ç‚¹ã€‚</p>
<p>é€‰é¡¹ <strong>â€“cluster-replicas 1</strong> è¡¨ç¤ºæˆ‘ä»¬å¸Œæœ›ä¸ºé›†ç¾¤ä¸­çš„æ¯ä¸ªä¸»èŠ‚ç‚¹åˆ›å»ºä¸€ä¸ªä»èŠ‚ç‚¹ã€‚</p>
<p>åˆ†é…åŸåˆ™å°½é‡ä¿è¯æ¯ä¸ªä¸»æ•°æ®åº“è¿è¡Œåœ¨ä¸åŒçš„IPåœ°å€ï¼Œæ¯ä¸ªä»åº“å’Œä¸»åº“ä¸åœ¨ä¸€ä¸ªIPåœ°å€ä¸Šã€‚</p>
<h2 id="slots"><a href="#slots" class="headerlink" title="slots"></a>slots</h2><blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[OK] All nodes agree about slots configuration.</span><br><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash">&gt;&gt; Check <span class="keyword">for</span> open slots...</span></span><br><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash">&gt;&gt; Check slots coverage...</span></span><br><span class="line">[OK] All 16384 slots covered.</span><br></pre></td></tr></table></figure>
</blockquote>
<ol>
<li><p>ä¸€ä¸ª Redis é›†ç¾¤åŒ…å« 16384 ä¸ªæ’æ§½ï¼ˆhash slotï¼‰ï¼Œ æ•°æ®åº“ä¸­çš„æ¯ä¸ªé”®éƒ½å±äºè¿™ 16384 ä¸ªæ’æ§½çš„å…¶ä¸­ä¸€ä¸ªã€‚ </p>
</li>
<li><p>é›†ç¾¤ä½¿ç”¨å…¬å¼ CRC16(key) % 16384 æ¥è®¡ç®—é”® key å±äºå“ªä¸ªæ§½ï¼Œ  CRC16(key) è¯­å¥ç”¨äºè®¡ç®—é”® key çš„ CRC16 æ ¡éªŒå’Œ </p>
</li>
<li><p>é›†ç¾¤ä¸­çš„æ¯ä¸ªèŠ‚ç‚¹è´Ÿè´£å¤„ç†ä¸€éƒ¨åˆ†æ’æ§½ã€‚ å¦‚ä¸€ä¸ªé›†ç¾¤ä¸­ï¼š</p>
<p> èŠ‚ç‚¹ A è´Ÿè´£å¤„ç† 0 å·è‡³ 5460 å·æ’æ§½ã€‚</p>
<p> èŠ‚ç‚¹ B è´Ÿè´£å¤„ç† 5461 å·è‡³ 10922 å·æ’æ§½ã€‚</p>
<p> èŠ‚ç‚¹ C è´Ÿè´£å¤„ç† 10923 å·è‡³ 16383 å·æ’æ§½ã€‚</p>
</li>
</ol>
<h2 id="é›†ç¾¤ä¸­è¯»å†™æ•°æ®"><a href="#é›†ç¾¤ä¸­è¯»å†™æ•°æ®" class="headerlink" title="é›†ç¾¤ä¸­è¯»å†™æ•°æ®"></a>é›†ç¾¤ä¸­è¯»å†™æ•°æ®</h2><p>â€‹		åœ¨ redis-cli æ¯æ¬¡å½•å…¥ã€æŸ¥è¯¢é”®å€¼ï¼Œredis éƒ½ä¼šè®¡ç®—å‡ºè¯¥ key åº”è¯¥é€å¾€çš„æ’æ§½ï¼Œå¦‚æœä¸æ˜¯è¯¥å®¢æˆ·ç«¯å¯¹åº”æœåŠ¡å™¨çš„æ’æ§½ï¼Œredis ä¼šæŠ¥é”™ï¼Œå¹¶å‘ŠçŸ¥åº”å‰å¾€çš„ redis å®ä¾‹åœ°å€å’Œç«¯å£ã€‚</p>
<p>redis-cli å®¢æˆ·ç«¯æä¾›äº† â€“c å‚æ•°å®ç°è‡ªåŠ¨é‡å®šå‘ã€‚</p>
<p>å¦‚ redis-cli -c â€“p 6379 ç™»å…¥åï¼Œå†å½•å…¥ã€æŸ¥è¯¢é”®å€¼å¯¹å¯ä»¥è‡ªåŠ¨é‡å®šå‘ã€‚</p>
<p>ä¸åœ¨ä¸€ä¸ª slot ä¸‹çš„é”®å€¼ï¼Œæ˜¯ä¸èƒ½ä½¿ç”¨ mgetï¼Œmset ç­‰å¤šé”®æ“ä½œï¼Œä½†å¯ä»¥é€šè¿‡ { } æ¥å®šä¹‰ç»„çš„æ¦‚å¿µï¼Œä»è€Œä½¿keyä¸­ { } å†…ç›¸åŒå†…å®¹çš„é”®å€¼å¯¹æ”¾åˆ°ä¸€ä¸ª slot ä¸­å»ã€‚</p>
<p>CLUSTER GETKEYSINSLOT <slot><count> 	è¿”å› count ä¸ª slot æ§½ä¸­çš„é”®ã€‚</count></slot></p>
<p><strong>æ³¨æ„ï¼šå„å®¢æˆ·ç«¯åªèƒ½çœ‹è‡ªå·±æ’æ§½èŒƒå›´å†…çš„å€¼ã€‚</strong></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">127.0.0.1:6379&gt; mset k1 v1 k2 v2 k3 v3</span><br><span class="line">(error) CROSSSLOT Keys in request don&#x27;t hash to the same slot</span><br><span class="line">127.0.0.1:6379&gt; mset k1&#123;cust&#125; v1 k2&#123;cust&#125; v2 k3&#123;cust&#125; v3</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; cluster keyslot k1</span><br><span class="line">(integer) 12706</span><br><span class="line">127.0.0.1:6379&gt; CLUSTER COUNTKEYSINSLOT 12706</span><br><span class="line">(integer) 0</span><br><span class="line"></span><br><span class="line">127.0.0.1:6379&gt; cluster keyslot cust</span><br><span class="line">(integer) 4847</span><br><span class="line">127.0.0.1:6379&gt; cluster countKeysinslot 4847</span><br><span class="line">(integer) 3</span><br><span class="line">127.0.0.1:6379&gt; CLUSTER GETKEYSINSLOT 4847 5</span><br><span class="line">1) &quot;k1&#123;cust&#125;&quot;</span><br><span class="line">2) &quot;k2&#123;cust&#125;&quot;</span><br><span class="line">3) &quot;k3&#123;cust&#125;&quot;</span><br><span class="line">127.0.0.1:6379&gt; get k1&#123;cust&#125;</span><br><span class="line">&quot;v1&quot;</span><br><span class="line">127.0.0.1:6379&gt; get k1</span><br><span class="line"><span class="meta prompt_">-&gt; </span><span class="language-bash">Redirected to slot [12706] located at 192.168.100.100:6381</span></span><br><span class="line">&quot;v1&quot;</span><br><span class="line">192.168.100.100:6381&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="æ•…éšœæ¢å¤-1"><a href="#æ•…éšœæ¢å¤-1" class="headerlink" title="æ•…éšœæ¢å¤"></a>æ•…éšœæ¢å¤</h2><p>å¦‚æœä¸»èŠ‚ç‚¹ä¸‹çº¿ï¼Œä»èŠ‚ç‚¹ä¼šå‡ä¸ºä¸»èŠ‚ç‚¹ï¼Œä¸»èŠ‚ç‚¹æ¢å¤åï¼Œä¸»èŠ‚ç‚¹ä¼šå˜ä¸ºä»æœºã€‚</p>
<p>ç¤ºä¾‹ï¼šå…³æ‰ 6380</p>
<p><img src="/2023/02/28/Redis/Java\Document\Redis\Redis.assets\image-20221008192932653.png" alt="image-20221008192932653"></p>
<p>å¦‚æœæ‰€æœ‰æŸä¸€æ®µæ’æ§½çš„ä¸»ä»èŠ‚ç‚¹éƒ½å®•æ‰ï¼ŒredisæœåŠ¡æ˜¯å¦è¿˜èƒ½ç»§ç»­?</p>
<p>å¦‚æœæŸä¸€æ®µæ’æ§½çš„ä¸»ä»éƒ½æŒ‚æ‰ï¼Œè€Œ cluster-require-full-coverage ä¸º yes ï¼Œé‚£ä¹ˆæ•´ä¸ªé›†ç¾¤éƒ½æŒ‚æ‰</p>
<p>å¦‚æœæŸä¸€æ®µæ’æ§½çš„ä¸»ä»éƒ½æŒ‚æ‰ï¼Œè€Œ cluster-require-full-coverage ä¸º no ï¼Œé‚£ä¹ˆè¯¥æ’æ§½æ•°æ®å…¨éƒ½ä¸èƒ½ä½¿ç”¨ï¼Œä¹Ÿæ— æ³•å­˜å‚¨ã€‚</p>
<p><strong>redis.conf</strong> ä¸­çš„å‚æ•° <strong>cluster-require-full-coverage</strong></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">By default Redis Cluster nodes stop accepting queries <span class="keyword">if</span> they detect there</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">is at least a <span class="built_in">hash</span> slot uncovered (no available node is serving it).</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">This way <span class="keyword">if</span> the cluster is partially down (<span class="keyword">for</span> example a range of <span class="built_in">hash</span> slots</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">are no longer covered) all the cluster becomes, eventually, unavailable.</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">It automatically returns available as soon as all the slots are covered again.</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment"># However sometimes you want the subset of the cluster which is working,</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">to <span class="built_in">continue</span> to accept queries <span class="keyword">for</span> the part of the key space that is still</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">covered. In order to <span class="keyword">do</span> so, just <span class="built_in">set</span> the cluster-require-full-coverage</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">option to no.</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment"># cluster-require-full-coverage yes</span></span></span><br></pre></td></tr></table></figure>

<h2 id="é›†ç¾¤çš„-Jedis-å¼€å‘"><a href="#é›†ç¾¤çš„-Jedis-å¼€å‘" class="headerlink" title="é›†ç¾¤çš„ Jedis å¼€å‘"></a>é›†ç¾¤çš„ Jedis å¼€å‘</h2><p>å³ä½¿è¿æ¥çš„ä¸æ˜¯ä¸»æœºï¼Œé›†ç¾¤ä¼šè‡ªåŠ¨åˆ‡æ¢ä¸»æœºå­˜å‚¨ã€‚ä¸»æœºå†™ï¼Œä»æœºè¯»ã€‚</p>
<p>æ— ä¸­å¿ƒåŒ–ä¸»ä»é›†ç¾¤ã€‚æ— è®ºä»å“ªå°ä¸»æœºå†™çš„æ•°æ®ï¼Œå…¶ä»–ä¸»æœºä¸Šéƒ½èƒ½è¯»åˆ°æ•°æ®ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> redis.clients.jedis.HostAndPort;</span><br><span class="line"><span class="keyword">import</span> redis.clients.jedis.JedisCluster;</span><br><span class="line"><span class="keyword">import</span> java.util.HashSet;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Redis é›†ç¾¤æµ‹è¯•ï¼šå…³é—­é˜²ç«å¢™</span></span><br><span class="line"><span class="comment"> * å³ä½¿è¿æ¥çš„ä¸æ˜¯ä¸»æœºï¼Œé›†ç¾¤ä¼šè‡ªåŠ¨åˆ‡æ¢ä¸»æœºå­˜å‚¨ã€‚ä¸»æœºå†™ï¼Œä»æœºè¯»ã€‚</span></span><br><span class="line"><span class="comment"> * æ— ä¸­å¿ƒåŒ–ä¸»ä»é›†ç¾¤ã€‚æ— è®ºä»å“ªå°ä¸»æœºå†™çš„æ•°æ®ï¼Œå…¶ä»–ä¸»æœºä¸Šéƒ½èƒ½è¯»åˆ°æ•°æ®ã€‚</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JedisClusterTest</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        HashSet&lt;HostAndPort&gt; set = <span class="keyword">new</span> <span class="title class_">HashSet</span>&lt;&gt;();</span><br><span class="line">        set.add(<span class="keyword">new</span> <span class="title class_">HostAndPort</span>(<span class="string">&quot;192.168.100.100&quot;</span>,<span class="number">6379</span>));</span><br><span class="line">        <span class="type">JedisCluster</span> <span class="variable">jedisCluster</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">JedisCluster</span>(set);</span><br><span class="line">        jedisCluster.set(<span class="string">&quot;k&quot;</span>,<span class="string">&quot;v&quot;</span>);</span><br><span class="line">        System.out.println(jedisCluster.get(<span class="string">&quot;k&quot;</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Redis-é›†ç¾¤ä¼˜ç‚¹"><a href="#Redis-é›†ç¾¤ä¼˜ç‚¹" class="headerlink" title="Redis é›†ç¾¤ä¼˜ç‚¹"></a><strong>Redis</strong> é›†ç¾¤ä¼˜ç‚¹</h2><ul>
<li>å®ç°æ‰©å®¹</li>
<li>åˆ†æ‘Šå‹åŠ›</li>
<li>æ— ä¸­å¿ƒé…ç½®ç›¸å¯¹ç®€å•</li>
</ul>
<h2 id="Redis-é›†ç¾¤çš„ä¸è¶³"><a href="#Redis-é›†ç¾¤çš„ä¸è¶³" class="headerlink" title="Redis é›†ç¾¤çš„ä¸è¶³"></a><strong>Redis</strong> <strong>é›†ç¾¤çš„ä¸è¶³</strong></h2><ul>
<li>å¤šé”®æ“ä½œæ˜¯ä¸è¢«æ”¯æŒçš„ </li>
<li>å¤šé”®çš„Redisäº‹åŠ¡æ˜¯ä¸è¢«æ”¯æŒçš„ã€‚luaè„šæœ¬ä¸è¢«æ”¯æŒ</li>
<li>ç”±äºé›†ç¾¤æ–¹æ¡ˆå‡ºç°è¾ƒæ™šï¼Œå¾ˆå¤šå…¬å¸å·²ç»é‡‡ç”¨äº†å…¶ä»–çš„é›†ç¾¤æ–¹æ¡ˆï¼Œè€Œä»£ç†æˆ–è€…å®¢æˆ·ç«¯åˆ†ç‰‡çš„æ–¹æ¡ˆæƒ³è¦è¿ç§»è‡³redis clusterï¼Œéœ€è¦æ•´ä½“è¿ç§»è€Œä¸æ˜¯é€æ­¥è¿‡æ¸¡ï¼Œå¤æ‚åº¦è¾ƒå¤§ã€‚</li>
</ul>
<h1 id="Redis-åº”ç”¨é—®é¢˜"><a href="#Redis-åº”ç”¨é—®é¢˜" class="headerlink" title="Redis åº”ç”¨é—®é¢˜"></a>Redis åº”ç”¨é—®é¢˜</h1><h2 id="ç¼“å­˜ç©¿é€"><a href="#ç¼“å­˜ç©¿é€" class="headerlink" title="ç¼“å­˜ç©¿é€"></a>ç¼“å­˜ç©¿é€</h2><h3 id="é—®é¢˜æè¿°"><a href="#é—®é¢˜æè¿°" class="headerlink" title="é—®é¢˜æè¿°"></a>é—®é¢˜æè¿°</h3><p>â€‹		key å¯¹åº”çš„æ•°æ®åœ¨æ•°æ®æºå¹¶ä¸å­˜åœ¨ï¼Œæ¯æ¬¡é’ˆå¯¹æ­¤ key çš„è¯·æ±‚ä»ç¼“å­˜è·å–ä¸åˆ°ï¼Œè¯·æ±‚éƒ½ä¼šå‹åˆ°æ•°æ®æºï¼Œä»è€Œå¯èƒ½å‹å®æ•°æ®æºã€‚æ¯”å¦‚ç”¨ä¸€ä¸ªä¸å­˜åœ¨çš„ç”¨æˆ· id è·å–ç”¨æˆ·ä¿¡æ¯ï¼Œä¸è®ºç¼“å­˜è¿˜æ˜¯æ•°æ®åº“éƒ½æ²¡æœ‰ï¼Œè‹¥é»‘å®¢åˆ©ç”¨æ­¤æ¼æ´è¿›è¡Œæ”»å‡»å¯èƒ½å‹å®æ•°æ®åº“ã€‚</p>
<h3 id="è§£å†³æ–¹æ¡ˆ"><a href="#è§£å†³æ–¹æ¡ˆ" class="headerlink" title="è§£å†³æ–¹æ¡ˆ"></a>è§£å†³æ–¹æ¡ˆ</h3><p>â€‹		ä¸€ä¸ªä¸€å®šä¸å­˜åœ¨ç¼“å­˜åŠæŸ¥è¯¢ä¸åˆ°çš„æ•°æ®ï¼Œç”±äºç¼“å­˜æ˜¯ä¸å‘½ä¸­æ—¶è¢«åŠ¨å†™çš„ï¼Œå¹¶ä¸”å‡ºäºå®¹é”™è€ƒè™‘ï¼Œå¦‚æœä»å­˜å‚¨å±‚æŸ¥ä¸åˆ°æ•°æ®åˆ™ä¸å†™å…¥ç¼“å­˜ï¼Œè¿™å°†å¯¼è‡´è¿™ä¸ªä¸å­˜åœ¨çš„æ•°æ®æ¯æ¬¡è¯·æ±‚éƒ½è¦åˆ°å­˜å‚¨å±‚å»æŸ¥è¯¢ï¼Œå¤±å»äº†ç¼“å­˜çš„æ„ä¹‰ã€‚</p>
<p>è§£å†³æ–¹æ¡ˆï¼š</p>
<p>ï¼ˆ1ï¼‰  <strong>å¯¹ç©ºå€¼ç¼“å­˜ï¼š</strong>å¦‚æœä¸€ä¸ªæŸ¥è¯¢è¿”å›çš„æ•°æ®ä¸ºç©ºï¼ˆä¸ç®¡æ˜¯æ•°æ®æ˜¯å¦ä¸å­˜åœ¨ï¼‰ï¼Œæˆ‘ä»¬ä»ç„¶æŠŠè¿™ä¸ªç©ºç»“æœï¼ˆnullï¼‰è¿›è¡Œç¼“			å­˜ï¼Œè®¾ç½®ç©ºç»“æœçš„è¿‡æœŸæ—¶é—´ä¼šå¾ˆçŸ­ï¼Œæœ€é•¿ä¸è¶…è¿‡äº”åˆ†é’Ÿ</p>
<p>ï¼ˆ2ï¼‰  <strong>è®¾ç½®å¯è®¿é—®çš„åå•ï¼ˆç™½åå•ï¼‰ï¼š</strong></p>
<p>â€‹			ä½¿ç”¨ bitmaps ç±»å‹å®šä¹‰ä¸€ä¸ªå¯ä»¥è®¿é—®çš„åå•ï¼Œåå• id ä½œä¸º bitmaps çš„åç§»é‡ï¼Œæ¯æ¬¡è®¿é—®å’Œ bitmap é‡Œé¢çš„ id è¿›è¡Œ			æ¯”è¾ƒï¼Œå¦‚æœè®¿é—® id ä¸åœ¨ bitmaps é‡Œé¢ï¼Œè¿›è¡Œæ‹¦æˆªï¼Œä¸å…è®¸è®¿é—®ã€‚</p>
<p>ï¼ˆ3ï¼‰  <strong>é‡‡ç”¨å¸ƒéš†è¿‡æ»¤å™¨</strong>ï¼š(å¸ƒéš†è¿‡æ»¤å™¨ï¼ˆBloom Filterï¼‰æ˜¯1970å¹´ç”±å¸ƒéš†æå‡ºçš„ã€‚å®ƒå®é™…ä¸Šæ˜¯ä¸€ä¸ªå¾ˆé•¿çš„äºŒè¿›åˆ¶å‘é‡(ä½å›¾)			å’Œä¸€ç³»åˆ—éšæœºæ˜ å°„å‡½æ•°ï¼ˆå“ˆå¸Œå‡½æ•°ï¼‰ã€‚</p>
<p>â€‹			å¸ƒéš†è¿‡æ»¤å™¨å¯ä»¥ç”¨äºæ£€ç´¢ä¸€ä¸ªå…ƒç´ æ˜¯å¦åœ¨ä¸€ä¸ªé›†åˆä¸­ã€‚å®ƒçš„ä¼˜ç‚¹æ˜¯ç©ºé—´æ•ˆç‡å’ŒæŸ¥è¯¢æ—¶é—´éƒ½è¿œè¿œè¶…è¿‡ä¸€èˆ¬çš„ç®—æ³•ï¼Œç¼º			ç‚¹æ˜¯æœ‰ä¸€å®šçš„è¯¯è¯†åˆ«ç‡å’Œåˆ é™¤å›°éš¾ã€‚)</p>
<p>â€‹			å°†æ‰€æœ‰å¯èƒ½å­˜åœ¨çš„æ•°æ®å“ˆå¸Œåˆ°ä¸€ä¸ªè¶³å¤Ÿå¤§çš„ bitmaps ä¸­ï¼Œä¸€ä¸ªä¸€å®šä¸å­˜åœ¨çš„æ•°æ®ä¼šè¢«è¿™ä¸ª bitmaps æ‹¦æˆªæ‰ï¼Œä»è€Œ			é¿å…äº†å¯¹åº•å±‚å­˜å‚¨ç³»ç»Ÿçš„æŸ¥è¯¢å‹åŠ›ã€‚</p>
<p><strong>ï¼ˆ4ï¼‰</strong>  <strong>è¿›è¡Œå®æ—¶ç›‘æ§ï¼š</strong>å½“å‘ç° Redis çš„å‘½ä¸­ç‡å¼€å§‹æ€¥é€Ÿé™ä½ï¼Œéœ€è¦æ’æŸ¥è®¿é—®å¯¹è±¡å’Œè®¿é—®çš„æ•°æ®ï¼Œå’Œè¿ç»´äººå‘˜é…åˆï¼Œå¯ä»¥è®¾			ç½®é»‘åå•é™åˆ¶æœåŠ¡ã€‚</p>
<h2 id="ç¼“å­˜å‡»ç©¿"><a href="#ç¼“å­˜å‡»ç©¿" class="headerlink" title="ç¼“å­˜å‡»ç©¿"></a>ç¼“å­˜å‡»ç©¿</h2><h3 id="é—®é¢˜æè¿°-1"><a href="#é—®é¢˜æè¿°-1" class="headerlink" title="é—®é¢˜æè¿°"></a>é—®é¢˜æè¿°</h3><p>â€‹		key å¯¹åº”çš„æ•°æ®å­˜åœ¨ï¼Œä½†åœ¨ redis ä¸­è¿‡æœŸï¼Œæ­¤æ—¶è‹¥æœ‰å¤§é‡å¹¶å‘è¯·æ±‚è¿‡æ¥ï¼Œè¿™äº›è¯·æ±‚å‘ç°ç¼“å­˜è¿‡æœŸä¸€èˆ¬éƒ½ä¼šä»åç«¯DBåŠ è½½æ•°æ®å¹¶å›è®¾åˆ°ç¼“å­˜ï¼Œè¿™ä¸ªæ—¶å€™å¤§å¹¶å‘çš„è¯·æ±‚å¯èƒ½ä¼šç¬é—´æŠŠåç«¯DBå‹å®ã€‚</p>
<h3 id="è§£å†³æ–¹æ¡ˆ-1"><a href="#è§£å†³æ–¹æ¡ˆ-1" class="headerlink" title="è§£å†³æ–¹æ¡ˆ"></a>è§£å†³æ–¹æ¡ˆ</h3><p>â€‹		key å¯èƒ½ä¼šåœ¨æŸäº›æ—¶é—´ç‚¹è¢«è¶…é«˜å¹¶å‘åœ°è®¿é—®ï¼Œæ˜¯ä¸€ç§éå¸¸ â€œçƒ­ç‚¹â€ çš„æ•°æ®ã€‚è¿™ä¸ªæ—¶å€™ï¼Œéœ€è¦è€ƒè™‘ä¸€ä¸ªé—®é¢˜ï¼šç¼“å­˜è¢« â€œå‡»ç©¿â€ çš„é—®é¢˜ã€‚</p>
<p>è§£å†³é—®é¢˜ï¼š</p>
<p>ï¼ˆ1ï¼‰é¢„å…ˆè®¾ç½®çƒ­é—¨æ•°æ®ï¼šåœ¨redisé«˜å³°è®¿é—®ä¹‹å‰ï¼ŒæŠŠä¸€äº›çƒ­é—¨æ•°æ®æå‰å­˜å…¥åˆ°redisé‡Œé¢ï¼ŒåŠ å¤§è¿™äº›çƒ­é—¨æ•°æ®keyçš„æ—¶é•¿</p>
<p>ï¼ˆ2ï¼‰å®æ—¶è°ƒæ•´ï¼šç°åœºç›‘æ§å“ªäº›æ•°æ®çƒ­é—¨ï¼Œå®æ—¶è°ƒæ•´ key çš„è¿‡æœŸæ—¶é•¿</p>
<p>ï¼ˆ3ï¼‰ä½¿ç”¨é”ï¼š</p>
<ul>
<li>å°±æ˜¯åœ¨ç¼“å­˜å¤±æ•ˆçš„æ—¶å€™ï¼ˆåˆ¤æ–­æ‹¿å‡ºæ¥çš„å€¼ä¸ºç©ºï¼‰ï¼Œä¸æ˜¯ç«‹å³å»load dbã€‚</li>
<li>å…ˆä½¿ç”¨ç¼“å­˜å·¥å…·çš„æŸäº›å¸¦æˆåŠŸæ“ä½œè¿”å›å€¼çš„æ“ä½œï¼ˆæ¯”å¦‚ Redis çš„ SETNXï¼‰å»setä¸€ä¸ªmutex key</li>
<li>å½“æ“ä½œè¿”å›æˆåŠŸæ—¶ï¼Œå†è¿›è¡Œload dbçš„æ“ä½œï¼Œå¹¶å›è®¾ç¼“å­˜ï¼Œæœ€ååˆ é™¤ mutex keyï¼›</li>
<li>å½“æ“ä½œè¿”å›å¤±è´¥ï¼Œè¯æ˜æœ‰çº¿ç¨‹åœ¨load dbï¼Œå½“å‰çº¿ç¨‹ç¡çœ ä¸€æ®µæ—¶é—´å†é‡è¯•æ•´ä¸ª get ç¼“å­˜çš„æ–¹æ³•ã€‚</li>
</ul>
<img src="/2023/02/28/Redis/Java\Document\Redis\Redis.assets\image-20221008200000951.png" alt="image-20221008200000951" style="zoom:67%;">

<h2 id="ç¼“å­˜é›ªå´©"><a href="#ç¼“å­˜é›ªå´©" class="headerlink" title="ç¼“å­˜é›ªå´©"></a>ç¼“å­˜é›ªå´©</h2><h3 id="é—®é¢˜æè¿°-2"><a href="#é—®é¢˜æè¿°-2" class="headerlink" title="é—®é¢˜æè¿°"></a>é—®é¢˜æè¿°</h3><p>â€‹		key å¯¹åº”çš„æ•°æ®å­˜åœ¨ï¼Œä½†åœ¨ redis ä¸­è¿‡æœŸï¼Œæ­¤æ—¶è‹¥æœ‰å¤§é‡å¹¶å‘è¯·æ±‚è¿‡æ¥ï¼Œè¿™äº›è¯·æ±‚å‘ç°ç¼“å­˜è¿‡æœŸä¸€èˆ¬éƒ½ä¼šä»åç«¯DBåŠ è½½æ•°æ®å¹¶å›è®¾åˆ°ç¼“å­˜ï¼Œè¿™ä¸ªæ—¶å€™å¤§å¹¶å‘çš„è¯·æ±‚å¯èƒ½ä¼šç¬é—´æŠŠåç«¯DBå‹å®ã€‚</p>
<p><strong>ç¼“å­˜é›ªå´©ä¸ç¼“å­˜å‡»ç©¿çš„åŒºåˆ«åœ¨äºè¿™é‡Œé’ˆå¯¹å¾ˆå¤škeyç¼“å­˜ï¼Œå‰è€…åˆ™æ˜¯æŸä¸€ä¸ªkeyã€‚</strong></p>
<h3 id="è§£å†³æ–¹æ¡ˆ-2"><a href="#è§£å†³æ–¹æ¡ˆ-2" class="headerlink" title="è§£å†³æ–¹æ¡ˆ"></a>è§£å†³æ–¹æ¡ˆ</h3><p>ç¼“å­˜å¤±æ•ˆæ—¶çš„é›ªå´©æ•ˆåº”å¯¹åº•å±‚ç³»ç»Ÿçš„å†²å‡»éå¸¸å¯æ€•ï¼</p>
<p>è§£å†³æ–¹æ¡ˆï¼š</p>
<p><strong>ï¼ˆ1ï¼‰</strong>  <strong>æ„å»ºå¤šçº§ç¼“å­˜æ¶æ„ï¼š</strong>nginxç¼“å­˜ + redisç¼“å­˜ +å…¶ä»–ç¼“å­˜ï¼ˆehcacheç­‰ï¼‰</p>
<p><strong>ï¼ˆ2ï¼‰</strong>  <strong>ä½¿ç”¨é”æˆ–é˜Ÿåˆ—ï¼š</strong></p>
<p>â€‹		ç”¨åŠ é”æˆ–è€…é˜Ÿåˆ—çš„æ–¹å¼ä¿è¯æ¥ä¿è¯ä¸ä¼šæœ‰å¤§é‡çš„çº¿ç¨‹å¯¹æ•°æ®åº“ä¸€æ¬¡æ€§è¿›è¡Œè¯»å†™ï¼Œä»è€Œé¿å…å¤±æ•ˆæ—¶å¤§é‡çš„å¹¶å‘è¯·æ±‚è½åˆ°		åº•å±‚å­˜å‚¨ç³»ç»Ÿä¸Šã€‚ä¸é€‚ç”¨é«˜å¹¶å‘æƒ…å†µã€‚</p>
<p><strong>ï¼ˆ3ï¼‰</strong>  <strong>è®¾ç½®è¿‡æœŸæ ‡å¿—æ›´æ–°ç¼“å­˜ï¼š</strong></p>
<p>â€‹		è®°å½•ç¼“å­˜æ•°æ®æ˜¯å¦è¿‡æœŸï¼ˆè®¾ç½®æå‰é‡ï¼‰ï¼Œå¦‚æœè¿‡æœŸä¼šè§¦å‘é€šçŸ¥å¦å¤–çš„çº¿ç¨‹åœ¨åå°å»æ›´æ–°å®é™…keyçš„ç¼“å­˜ã€‚</p>
<p><strong>ï¼ˆ4ï¼‰</strong>  <strong>å°†ç¼“å­˜å¤±æ•ˆæ—¶é—´åˆ†æ•£å¼€ï¼š</strong></p>
<p>â€‹		æ¯”å¦‚æˆ‘ä»¬å¯ä»¥åœ¨åŸæœ‰çš„å¤±æ•ˆæ—¶é—´åŸºç¡€ä¸Šå¢åŠ ä¸€ä¸ªéšæœºå€¼ï¼Œæ¯”å¦‚1-5åˆ†é’Ÿéšæœºï¼Œè¿™æ ·æ¯ä¸€ä¸ªç¼“å­˜çš„è¿‡æœŸæ—¶é—´çš„é‡å¤ç‡å°±ä¼š		é™ä½ï¼Œå°±å¾ˆéš¾å¼•å‘é›†ä½“å¤±æ•ˆçš„äº‹ä»¶ã€‚</p>
<h2 id="åˆ†å¸ƒå¼é”"><a href="#åˆ†å¸ƒå¼é”" class="headerlink" title="åˆ†å¸ƒå¼é”"></a>åˆ†å¸ƒå¼é”</h2><p>â€‹		éšç€ä¸šåŠ¡å‘å±•çš„éœ€è¦ï¼ŒåŸå•ä½“å•æœºéƒ¨ç½²çš„ç³»ç»Ÿè¢«æ¼”åŒ–æˆåˆ†å¸ƒå¼é›†ç¾¤ç³»ç»Ÿåï¼Œç”±äºåˆ†å¸ƒå¼ç³»ç»Ÿå¤šçº¿ç¨‹ã€å¤šè¿›ç¨‹å¹¶ä¸”åˆ†å¸ƒåœ¨ä¸åŒæœºå™¨ä¸Šï¼Œè¿™å°†ä½¿åŸå•æœºéƒ¨ç½²æƒ…å†µä¸‹çš„å¹¶å‘æ§åˆ¶é”ç­–ç•¥å¤±æ•ˆï¼Œå•çº¯çš„ Java API å¹¶ä¸èƒ½æä¾›åˆ†å¸ƒå¼é”çš„èƒ½åŠ›ã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜å°±éœ€è¦ä¸€ç§è·¨ JVM çš„äº’æ–¥æœºåˆ¶æ¥æ§åˆ¶å…±äº«èµ„æºçš„è®¿é—®ï¼Œè¿™å°±æ˜¯åˆ†å¸ƒå¼é”è¦è§£å†³çš„é—®é¢˜ã€‚</p>
<p>åˆ†å¸ƒå¼é”ä¸»æµçš„å®ç°æ–¹æ¡ˆï¼š</p>
<ol>
<li><p>åŸºäºæ•°æ®åº“å®ç°åˆ†å¸ƒå¼é”</p>
</li>
<li><p>åŸºäºç¼“å­˜ï¼ˆRedisç­‰ï¼‰</p>
</li>
<li><p>åŸºäºZookeeper</p>
</li>
</ol>
<p>æ¯ä¸€ç§åˆ†å¸ƒå¼é”è§£å†³æ–¹æ¡ˆéƒ½æœ‰å„è‡ªçš„ä¼˜ç¼ºç‚¹ï¼š</p>
<ol>
<li><p>æ€§èƒ½ï¼šredisæœ€é«˜</p>
</li>
<li><p>å¯é æ€§ï¼šzookeeperæœ€é«˜</p>
<p> è¿™é‡Œï¼Œæˆ‘ä»¬å°±åŸºäº redis å®ç°åˆ†å¸ƒå¼é”ã€‚</p>
</li>
</ol>
<h3 id="Rediså®ç°åˆ†å¸ƒå¼é”"><a href="#Rediså®ç°åˆ†å¸ƒå¼é”" class="headerlink" title="Rediså®ç°åˆ†å¸ƒå¼é”"></a>Rediså®ç°åˆ†å¸ƒå¼é”</h3><h3 id="è®¾ç½®é”çš„è¿‡æœŸæ—¶é—´"><a href="#è®¾ç½®é”çš„è¿‡æœŸæ—¶é—´" class="headerlink" title="è®¾ç½®é”çš„è¿‡æœŸæ—¶é—´"></a>è®¾ç½®é”çš„è¿‡æœŸæ—¶é—´</h3><p>å‘½ä»¤ï¼šset	k	v	nx	px	10000</p>
<p>ä»¥ä¸Šå¯ä»¥ä¿è¯åŸå­æ€§ï¼Œå¦‚æœ Setnx ååœ¨ expireï¼Œä¸­é—´ Server å®•æœºä¸èƒ½ä¿è¯åŸå­æ€§ã€‚</p>
<p>EX second </p>
<p>â€‹		è®¾ç½®é”®çš„è¿‡æœŸæ—¶é—´ä¸º Second ç§’ã€‚ SET key value EX second æ•ˆæœç­‰åŒäº SETEX key second value ã€‚</p>
<p>PX millisecond</p>
<p>â€‹		è®¾ç½®é”®çš„è¿‡æœŸæ—¶é—´ä¸º millisecond æ¯«ç§’ã€‚ SET key value PX millisecond æ•ˆæœç­‰åŒäº PSETEX key millisecond value </p>
<p>NX		åªåœ¨é”®ä¸å­˜åœ¨æ—¶ï¼Œæ‰å¯¹é”®è¿›è¡Œè®¾ç½®æ“ä½œã€‚ SET key value NX æ•ˆæœç­‰åŒäº SETNX key value ã€‚</p>
<p>XX		åªåœ¨é”®å·²ç»å­˜åœ¨æ—¶ï¼Œæ‰å¯¹é”®è¿›è¡Œè®¾ç½®æ“ä½œã€‚</p>
<p>ç¤ºä¾‹ï¼š</p>
<ol>
<li><p>å¤šä¸ªå®¢æˆ·ç«¯åŒæ—¶è·å–é”ï¼ˆsetnxï¼‰</p>
</li>
<li><p>è·å–æˆåŠŸï¼Œæ‰§è¡Œä¸šåŠ¡é€»è¾‘{ä»dbè·å–æ•°æ®ï¼Œæ”¾å…¥ç¼“å­˜}ï¼Œæ‰§è¡Œå®Œæˆé‡Šæ”¾é”ï¼ˆdelï¼‰</p>
</li>
<li><p>å…¶ä»–å®¢æˆ·ç«¯ç­‰å¾…é‡è¯•</p>
</li>
</ol>
<p>ä»£ç ç¤ºä¾‹ï¼š</p>
<p>application.propertiesï¼šæ³¨æ„é›†ç¾¤ç‰ˆå’Œå•æœºç‰ˆçš„åŒºåˆ«</p>
<figure class="highlight properties"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Redis: å•æœºé…ç½®</span></span><br><span class="line"><span class="comment">#spring.redis.host=192.168.100.100</span></span><br><span class="line"><span class="comment">##RedisæœåŠ¡å™¨è¿æ¥ç«¯å£</span></span><br><span class="line"><span class="comment">#spring.redis.port=6379</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># Redisé›†ç¾¤é…ç½®</span></span><br><span class="line"><span class="attr">spring.redis.cluster.nodes</span>=<span class="string">192.168.100.100:6379</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">#Redisæ•°æ®åº“ç´¢å¼•ï¼ˆé»˜è®¤ä¸º0ï¼‰</span></span><br><span class="line"><span class="attr">spring.redis.database</span>= <span class="string">0</span></span><br><span class="line"><span class="comment">#è¿æ¥è¶…æ—¶æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰</span></span><br><span class="line"><span class="attr">spring.redis.timeout</span>=<span class="string">1800000</span></span><br><span class="line"><span class="comment">#è¿æ¥æ± æœ€å¤§è¿æ¥æ•°ï¼ˆä½¿ç”¨è´Ÿå€¼è¡¨ç¤ºæ²¡æœ‰é™åˆ¶ï¼‰</span></span><br><span class="line"><span class="attr">spring.redis.lettuce.pool.max-active</span>=<span class="string">20</span></span><br><span class="line"><span class="comment">#æœ€å¤§é˜»å¡ç­‰å¾…æ—¶é—´(è´Ÿæ•°è¡¨ç¤ºæ²¡é™åˆ¶)</span></span><br><span class="line"><span class="attr">spring.redis.lettuce.pool.max-wait</span>=<span class="string">-1</span></span><br><span class="line"><span class="comment">#è¿æ¥æ± ä¸­çš„æœ€å¤§ç©ºé—²è¿æ¥</span></span><br><span class="line"><span class="attr">spring.redis.lettuce.pool.max-idle</span>=<span class="string">5</span></span><br><span class="line"><span class="comment">#è¿æ¥æ± ä¸­çš„æœ€å°ç©ºé—²è¿æ¥</span></span><br><span class="line"><span class="attr">spring.redis.lettuce.pool.min-idle</span>=<span class="string">0</span></span><br></pre></td></tr></table></figure>

<p>controllerï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.redis.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.redis.core.RedisTemplate;</span><br><span class="line"><span class="keyword">import</span> org.springframework.util.StringUtils;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.GetMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æµ‹è¯•Redisåˆ†å¸ƒå¼é”ï¼š</span></span><br><span class="line"><span class="comment"> * æå‰è®¾ç½® num å€¼</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/test&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LockController</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> RedisTemplate redisTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/testLock&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testLock</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// è·å–é”</span></span><br><span class="line">        <span class="type">Boolean</span> <span class="variable">lock</span> <span class="operator">=</span> redisTemplate.opsForValue().setIfAbsent(<span class="string">&quot;lock&quot;</span>, <span class="string">&quot;001&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span> (lock) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;è·å¾—é”ï¼š&quot;</span>+lock);</span><br><span class="line">            <span class="type">Object</span> <span class="variable">value</span> <span class="operator">=</span> redisTemplate.opsForValue().get(<span class="string">&quot;num&quot;</span>);</span><br><span class="line">            <span class="comment">// åˆ¤ç©º</span></span><br><span class="line">            <span class="keyword">if</span> (StringUtils.isEmpty(value)) &#123;</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// ä¸šåŠ¡é€»è¾‘</span></span><br><span class="line">            <span class="type">int</span> <span class="variable">num</span> <span class="operator">=</span> Integer.parseInt(String.valueOf(value));</span><br><span class="line">            redisTemplate.opsForValue().set(<span class="string">&quot;num&quot;</span>, ++num);</span><br><span class="line">            <span class="comment">// é‡Šæ”¾é”</span></span><br><span class="line">            <span class="type">Boolean</span> <span class="variable">released</span> <span class="operator">=</span> redisTemplate.delete(<span class="string">&quot;lock&quot;</span>);</span><br><span class="line">            System.out.println(<span class="string">&quot;é‡Šæ”¾é”ï¼š&quot;</span>+released);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// è·å–é”å¤±è´¥ï¼Œæ¯éš”0.1ç§’å†è¯•</span></span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                Thread.sleep(<span class="number">100</span>);</span><br><span class="line">                testLock();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æµ‹è¯•ï¼š</p>
<p>å…ˆè®¾ç½® num çš„å€¼ set num 0</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">192.168.100.100:6391&gt; set num 0</span><br><span class="line"><span class="meta prompt_">-&gt; </span><span class="language-bash">Redirected to slot [2765] located at 192.168.100.100:6379</span></span><br><span class="line">OK</span><br><span class="line">192.168.100.100:6379&gt;</span><br></pre></td></tr></table></figure>

<p>ä½¿ç”¨ <a href="http://192.168.25.211:8080/test/testLock">http://192.168.25.211:8080/test/testLock</a> æµ‹è¯•ã€‚</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">192.168.100.100:6379&gt; get num</span><br><span class="line">&quot;1000&quot;</span><br></pre></td></tr></table></figure>



<p>é—®é¢˜ï¼š</p>
<p>å¦‚æœä¸Šé”ä¹‹åå‡ºç°å¼‚å¸¸ï¼Œé”æ— æ³•é‡Šæ”¾ï¼Œé”åº”è¯¥è®¾ç½®ä¸€ä¸ªè¿‡æœŸæ—¶é—´ã€‚</p>
<p>ä¿®æ”¹ä»£ç ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">Boolean</span> <span class="variable">lock</span> <span class="operator">=</span> redisTemplate.opsForValue().setIfAbsent(<span class="string">&quot;lock&quot;</span>, <span class="string">&quot;001&quot;</span>,<span class="number">3</span>, TimeUnit.SECONDS);</span><br></pre></td></tr></table></figure>

<h3 id="UUIDé˜²æ­¢è¯¯åˆ "><a href="#UUIDé˜²æ­¢è¯¯åˆ " class="headerlink" title="UUIDé˜²æ­¢è¯¯åˆ "></a>UUIDé˜²æ­¢è¯¯åˆ </h3><p>é—®é¢˜ï¼šæ¯ä¸€ä¸ªçº¿ç¨‹éƒ½åº”è¯¥æœ‰è‡ªå·±çš„ä¸€æŠŠé”</p>
<img src="/2023/02/28/Redis/Java\Document\Redis\Redis.assets\image-20221008220617532.png" alt="image-20221008220617532" style="zoom:50%;">

<p>ä»£ç ä¿®æ”¹ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.redis.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.redis.core.RedisTemplate;</span><br><span class="line"><span class="keyword">import</span> org.springframework.util.StringUtils;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.GetMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.UUID;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.TimeUnit;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æµ‹è¯•Redisåˆ†å¸ƒå¼é”ï¼š</span></span><br><span class="line"><span class="comment"> * æå‰è®¾ç½® num å€¼</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/test&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LockController</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> RedisTemplate redisTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/testLock&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testLock</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// è·å–é”</span></span><br><span class="line">        <span class="comment">// Boolean lock = redisTemplate.opsForValue().setIfAbsent(&quot;lock&quot;, &quot;001&quot;,3, TimeUnit.SECONDS);</span></span><br><span class="line">        <span class="comment">// ä½¿ç”¨ UUID ä¼˜åŒ–é˜²æ­¢è¯¯åˆ </span></span><br><span class="line">        <span class="type">String</span> <span class="variable">uuid</span> <span class="operator">=</span> UUID.randomUUID().toString();</span><br><span class="line">        <span class="type">Boolean</span> <span class="variable">lock</span> <span class="operator">=</span> redisTemplate.opsForValue().setIfAbsent(<span class="string">&quot;lock&quot;</span>, uuid, <span class="number">3</span>, TimeUnit.SECONDS);</span><br><span class="line">        <span class="keyword">if</span> (lock) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;è·å¾—é”ï¼š&quot;</span> + lock);</span><br><span class="line">            <span class="type">Object</span> <span class="variable">value</span> <span class="operator">=</span> redisTemplate.opsForValue().get(<span class="string">&quot;num&quot;</span>);</span><br><span class="line">            <span class="comment">// åˆ¤ç©º</span></span><br><span class="line">            <span class="keyword">if</span> (StringUtils.isEmpty(value)) &#123;</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// ä¸šåŠ¡é€»è¾‘</span></span><br><span class="line">            <span class="type">int</span> <span class="variable">num</span> <span class="operator">=</span> Integer.parseInt(String.valueOf(value));</span><br><span class="line">            redisTemplate.opsForValue().set(<span class="string">&quot;num&quot;</span>, ++num);</span><br><span class="line">            <span class="comment">// é‡Šæ”¾é”: åˆ¤æ–­UUIDæ˜¯å¦ç›¸åŒ</span></span><br><span class="line">            <span class="type">Object</span> <span class="variable">lockUuid</span> <span class="operator">=</span> redisTemplate.opsForValue().get(<span class="string">&quot;lock&quot;</span>);</span><br><span class="line">            <span class="keyword">if</span> (uuid.equals(String.valueOf(lockUuid))) &#123;</span><br><span class="line">                <span class="type">Boolean</span> <span class="variable">released</span> <span class="operator">=</span> redisTemplate.delete(<span class="string">&quot;lock&quot;</span>);</span><br><span class="line">                System.out.println(<span class="string">&quot;é‡Šæ”¾é”ï¼š&quot;</span> + released);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// è·å–é”å¤±è´¥ï¼Œæ¯éš”0.1ç§’å†è¯•</span></span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                Thread.sleep(<span class="number">100</span>);</span><br><span class="line">                testLock();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="Lua-è„šæœ¬ä¼˜åŒ–ï¼šåŸå­æ€§é—®é¢˜"><a href="#Lua-è„šæœ¬ä¼˜åŒ–ï¼šåŸå­æ€§é—®é¢˜" class="headerlink" title="Lua è„šæœ¬ä¼˜åŒ–ï¼šåŸå­æ€§é—®é¢˜"></a>Lua è„šæœ¬ä¼˜åŒ–ï¼šåŸå­æ€§é—®é¢˜</h3><p>â€‹		åœ¨åˆ¤æ–­UUIDæ˜¯å¦ç›¸åŒåï¼Œè¯¥é”å¯¹è±¡è¿‡æœŸæ—¶é—´ç»“æŸï¼Œè‡ªåŠ¨é‡Šæ”¾é”ï¼Œæ­¤æ—¶å…¶ä»–çº¿ç¨‹æ‹¿åˆ°é”ï¼Œä¹‹åå½“å‰çº¿ç¨‹å†æ¬¡é€šè¿‡æ‰‹åŠ¨é‡Šæ”¾é”ï¼Œåˆ¤æ–­ç›¸ç­‰çš„è¿‡ç¨‹å·²ç»ç»“æŸï¼Œé‡Šæ”¾çš„æ˜¯å…¶ä»–çº¿ç¨‹çš„é”ï¼Œè¯¥è¿‡ç¨‹åº”è¯¥æ˜¯åŸå­æ€§çš„ï¼Œä½¿ç”¨Luaè„šæœ¬ç¡®ä¿åŸå­æ€§ã€‚</p>
<img src="/2023/02/28/Redis/Java\Document\Redis\Redis.assets\image-20221008224023193.png" alt="image-20221008224023193" style="zoom:50%;">

<p>ä»£ç ä¿®æ”¹ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;testLockLua&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testLockLua</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">// å£°æ˜ä¸€ä¸ªuuid ,å°†åšä¸ºä¸€ä¸ªvalue æ”¾å…¥æˆ‘ä»¬çš„keyæ‰€å¯¹åº”çš„å€¼ä¸­</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">uuid</span> <span class="operator">=</span> UUID.randomUUID().toString();</span><br><span class="line">    <span class="comment">// å®šä¹‰ä¸€ä¸ªé”ï¼šlua è„šæœ¬å¯ä»¥ä½¿ç”¨åŒä¸€æŠŠé”ï¼Œæ¥å®ç°åˆ é™¤ï¼</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">skuId</span> <span class="operator">=</span> <span class="string">&quot;25&quot;</span>; <span class="comment">// è®¿é—®skuId ä¸º25å·çš„å•†å“ 100008348542</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">locKey</span> <span class="operator">=</span> <span class="string">&quot;lock:&quot;</span> + skuId; <span class="comment">// é”ä½çš„æ˜¯æ¯ä¸ªå•†å“çš„æ•°æ®</span></span><br><span class="line">    <span class="comment">// è·å–é”</span></span><br><span class="line">    <span class="type">Boolean</span> <span class="variable">lock</span> <span class="operator">=</span> redisTemplate.opsForValue().setIfAbsent(locKey, uuid, <span class="number">3</span>, TimeUnit.SECONDS);</span><br><span class="line">    <span class="keyword">if</span> (lock) &#123;</span><br><span class="line">        <span class="comment">// æ‰§è¡Œçš„ä¸šåŠ¡é€»è¾‘å¼€å§‹</span></span><br><span class="line">        <span class="type">Object</span> <span class="variable">value</span> <span class="operator">=</span> redisTemplate.opsForValue().get(<span class="string">&quot;num&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span> (StringUtils.isEmpty(value)) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// ä¸æ˜¯ç©º å¦‚æœè¯´åœ¨è¿™å‡ºç°äº†å¼‚å¸¸ï¼ é‚£ä¹ˆdelete å°±åˆ é™¤å¤±è´¥ï¼ ä¹Ÿå°±æ˜¯è¯´é”æ°¸è¿œå­˜åœ¨ï¼</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">num</span> <span class="operator">=</span> Integer.parseInt(value + <span class="string">&quot;&quot;</span>);</span><br><span class="line">        <span class="comment">// ä½¿num æ¯æ¬¡+1 æ”¾å…¥ç¼“å­˜</span></span><br><span class="line">        redisTemplate.opsForValue().set(<span class="string">&quot;num&quot;</span>, String.valueOf(++num));</span><br><span class="line">        <span class="comment">/*ä½¿ç”¨luaè„šæœ¬æ¥é”*/</span></span><br><span class="line">        <span class="comment">// å®šä¹‰lua è„šæœ¬</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">script</span> <span class="operator">=</span> <span class="string">&quot;if redis.call(&#x27;get&#x27;, KEYS[1]) == ARGV[1] then return redis.call(&#x27;del&#x27;, KEYS[1]) else return 0 end&quot;</span>;</span><br><span class="line">        <span class="comment">// ä½¿ç”¨redisæ‰§è¡Œluaæ‰§è¡Œ</span></span><br><span class="line">        DefaultRedisScript&lt;Long&gt; redisScript = <span class="keyword">new</span> <span class="title class_">DefaultRedisScript</span>&lt;&gt;();</span><br><span class="line">        redisScript.setScriptText(script);</span><br><span class="line">        <span class="comment">// è®¾ç½®ä¸€ä¸‹è¿”å›å€¼ç±»å‹ä¸º Long</span></span><br><span class="line">        <span class="comment">// å› ä¸ºåˆ é™¤åˆ¤æ–­çš„æ—¶å€™ï¼Œè¿”å›çš„0, ç»™å…¶å°è£…ä¸ºæ•°æ®ç±»å‹ã€‚</span></span><br><span class="line">        <span class="comment">// å¦‚æœä¸å°è£…é‚£ä¹ˆé»˜è®¤è¿”å›String ç±»å‹ï¼Œé‚£ä¹ˆè¿”å›å­—ç¬¦ä¸²ä¸ 0 ä¼šæœ‰å‘ç”Ÿé”™è¯¯ã€‚</span></span><br><span class="line">        redisScript.setResultType(Long.class);</span><br><span class="line">        <span class="comment">// ç¬¬ä¸€ä¸ªè¦æ˜¯script è„šæœ¬ ï¼Œç¬¬äºŒä¸ªéœ€è¦åˆ¤æ–­çš„keyï¼Œç¬¬ä¸‰ä¸ªå°±æ˜¯keyæ‰€å¯¹åº”çš„å€¼ã€‚</span></span><br><span class="line">        redisTemplate.execute(redisScript, Arrays.asList(locKey), uuid);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Thread.sleep(<span class="number">1000</span>);</span><br><span class="line">            testLockLua();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p>ä¸ºäº†ç¡®ä¿åˆ†å¸ƒå¼é”å¯ç”¨ï¼Œæˆ‘ä»¬è‡³å°‘è¦ç¡®ä¿é”çš„å®ç°åŒæ—¶<strong>æ»¡è¶³ä»¥ä¸‹å››ä¸ªæ¡ä»¶</strong>ï¼š</p>
<ol>
<li>äº’æ–¥æ€§ã€‚åœ¨ä»»æ„æ—¶åˆ»ï¼Œåªæœ‰ä¸€ä¸ªå®¢æˆ·ç«¯èƒ½æŒæœ‰é”ã€‚</li>
<li>ä¸ä¼šå‘ç”Ÿæ­»é”ã€‚å³ä½¿æœ‰ä¸€ä¸ªå®¢æˆ·ç«¯åœ¨æŒæœ‰é”çš„æœŸé—´å´©æºƒè€Œæ²¡æœ‰ä¸»åŠ¨è§£é”ï¼Œä¹Ÿèƒ½ä¿è¯åç»­å…¶ä»–å®¢æˆ·ç«¯èƒ½åŠ é”ã€‚</li>
<li>è§£é“ƒè¿˜é¡»ç³»é“ƒäººã€‚åŠ é”å’Œè§£é”å¿…é¡»æ˜¯åŒä¸€ä¸ªå®¢æˆ·ç«¯ï¼Œå®¢æˆ·ç«¯è‡ªå·±ä¸èƒ½æŠŠåˆ«äººåŠ çš„é”ç»™è§£äº†ã€‚</li>
<li>åŠ é”å’Œè§£é”å¿…é¡»å…·æœ‰åŸå­æ€§ã€‚</li>
</ol>
<h1 id="Redis6-æ–°åŠŸèƒ½"><a href="#Redis6-æ–°åŠŸèƒ½" class="headerlink" title="Redis6 æ–°åŠŸèƒ½"></a>Redis6 æ–°åŠŸèƒ½</h1><h2 id="ACL"><a href="#ACL" class="headerlink" title="ACL"></a>ACL</h2><h3 id="ç®€ä»‹-8"><a href="#ç®€ä»‹-8" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h3><p>â€‹		Redis ACLæ˜¯Access Control Listï¼ˆè®¿é—®æ§åˆ¶åˆ—è¡¨ï¼‰çš„ç¼©å†™ï¼Œè¯¥åŠŸèƒ½å…è®¸æ ¹æ®å¯ä»¥æ‰§è¡Œçš„å‘½ä»¤å’Œå¯ä»¥è®¿é—®çš„é”®æ¥é™åˆ¶æŸäº›è¿æ¥ã€‚åœ¨Redis 5ç‰ˆæœ¬ä¹‹å‰ï¼ŒRedis å®‰å…¨è§„åˆ™åªæœ‰å¯†ç æ§åˆ¶ï¼Œè¿˜æœ‰é€šè¿‡ rename æ¥è°ƒæ•´é«˜å±å‘½ä»¤æ¯”å¦‚ flushdb ï¼Œ KEYS* ï¼Œ shutdown ç­‰ã€‚Redis 6 åˆ™æä¾›ACLçš„åŠŸèƒ½å¯¹ç”¨æˆ·è¿›è¡Œæ›´ç»†ç²’åº¦çš„æƒé™æ§åˆ¶ ï¼š</p>
<p>ï¼ˆ1ï¼‰æ¥å…¥æƒé™ï¼šç”¨æˆ·åå’Œå¯†ç  </p>
<p>ï¼ˆ2ï¼‰å¯ä»¥æ‰§è¡Œçš„å‘½ä»¤ </p>
<p>ï¼ˆ3ï¼‰å¯ä»¥æ“ä½œçš„ KEY</p>
<p>å‚è€ƒå®˜ç½‘ï¼š<a href="https://redis.io/topics/acl">https://redis.io/topics/acl</a></p>
<h3 id="å‘½ä»¤-3"><a href="#å‘½ä»¤-3" class="headerlink" title="å‘½ä»¤"></a>å‘½ä»¤</h3><ol>
<li>ä½¿ç”¨ acl list å‘½ä»¤å±•ç°ç”¨æˆ·æƒé™åˆ—è¡¨</li>
</ol>
<p>ï¼ˆ1ï¼‰æ•°æ®è¯´æ˜</p>
<p>â€‹	user	ç”¨æˆ·å	æ˜¯å¦å¯ç”¨	æ²¡æœ‰å¯†ç 	å¯æ“ä½œçš„Key	å¯æ‰§è¡Œçš„å‘½ä»¤</p>
<p><img src="/2023/02/28/Redis/Java\Document\Redis\Redis.assets\image-20221008234251310.png" alt="image-20221008234251310"></p>
<ol start="2">
<li><p>ä½¿ç”¨ acl whoami å‘½ä»¤æŸ¥çœ‹å½“å‰ç”¨æˆ·</p>
 <figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">127.0.0.1:6379&gt; ACL WHOAMI</span><br><span class="line">&quot;default&quot;</span><br></pre></td></tr></table></figure>
</li>
<li><p>ä½¿ç”¨ acl cat å‘½ä»¤</p>
</li>
</ol>
<p>ï¼ˆ1ï¼‰æŸ¥çœ‹æ·»åŠ æƒé™æŒ‡ä»¤ç±»åˆ«</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">192.168.100.100:6391&gt; acl cat</span><br><span class="line"> 1) &quot;keyspace&quot;</span><br><span class="line"> 2) &quot;read&quot;</span><br><span class="line"> 3) &quot;write&quot;</span><br><span class="line"> 4) &quot;set&quot;</span><br><span class="line"> 5) &quot;sortedset&quot;</span><br><span class="line"> 6) &quot;list&quot;</span><br><span class="line"> 7) &quot;hash&quot;</span><br><span class="line"> 8) &quot;string&quot;</span><br><span class="line"> 9) &quot;bitmap&quot;</span><br><span class="line">10) &quot;hyperloglog&quot;</span><br><span class="line">11) &quot;geo&quot;</span><br><span class="line">12) &quot;stream&quot;</span><br><span class="line">13) &quot;pubsub&quot;</span><br><span class="line">14) &quot;admin&quot;</span><br><span class="line">15) &quot;fast&quot;</span><br><span class="line">16) &quot;slow&quot;</span><br><span class="line">17) &quot;blocking&quot;</span><br><span class="line">18) &quot;dangerous&quot;</span><br><span class="line">19) &quot;connection&quot;</span><br><span class="line">20) &quot;transaction&quot;</span><br><span class="line">21) &quot;scripting&quot;</span><br></pre></td></tr></table></figure>

<p>ï¼ˆ2ï¼‰åŠ å‚æ•°ç±»å‹åå¯ä»¥æŸ¥çœ‹ç±»å‹ä¸‹å…·ä½“å‘½ä»¤</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">127.0.0.1:6379&gt; acl cat string</span><br><span class="line"> 1) &quot;msetnx&quot;</span><br><span class="line"> 2) &quot;setrange&quot;</span><br><span class="line"> 3) &quot;get&quot;</span><br><span class="line"> 4) &quot;getrange&quot;</span><br><span class="line"> 5) &quot;setnx&quot;</span><br><span class="line"> 6) &quot;getset&quot;</span><br><span class="line"> 7) &quot;decrby&quot;</span><br><span class="line"> 8) &quot;getex&quot;</span><br><span class="line"> 9) &quot;mset&quot;</span><br><span class="line">10) &quot;substr&quot;</span><br><span class="line">11) &quot;stralgo&quot;</span><br><span class="line">12) &quot;incr&quot;</span><br><span class="line">13) &quot;setex&quot;</span><br><span class="line">14) &quot;set&quot;</span><br><span class="line">15) &quot;incrby&quot;</span><br><span class="line">16) &quot;decr&quot;</span><br><span class="line">17) &quot;append&quot;</span><br><span class="line">18) &quot;incrbyfloat&quot;</span><br><span class="line">19) &quot;strlen&quot;</span><br><span class="line">20) &quot;mget&quot;</span><br><span class="line">21) &quot;psetex&quot;</span><br><span class="line">22) &quot;getdel&quot;</span><br></pre></td></tr></table></figure>

<ol start="4">
<li>ä½¿ç”¨  aclsetuser  å‘½ä»¤åˆ›å»ºå’Œç¼–è¾‘ç”¨æˆ·ACL</li>
</ol>
<p>ï¼ˆ1ï¼‰ACLè§„åˆ™</p>
<p>â€‹		ä¸‹é¢æ˜¯æœ‰æ•ˆACLè§„åˆ™çš„åˆ—è¡¨ã€‚æŸäº›è§„åˆ™åªæ˜¯ç”¨äºæ¿€æ´»æˆ–åˆ é™¤æ ‡å¿—ï¼Œæˆ–å¯¹ç”¨æˆ·ACLæ‰§è¡Œç»™å®šæ›´æ”¹çš„å•ä¸ªå•è¯ã€‚å…¶ä»–è§„åˆ™æ˜¯å­—ç¬¦å‰ç¼€ï¼Œå®ƒä»¬ä¸å‘½ä»¤æˆ–ç±»åˆ«åç§°ã€é”®æ¨¡å¼ç­‰è¿æ¥åœ¨ä¸€èµ·ã€‚</p>
<table>
<thead>
<tr>
<th>ACLè§„åˆ™</th>
<th></th>
<th></th>
</tr>
</thead>
<tbody><tr>
<td>ç±»å‹</td>
<td>å‚æ•°</td>
<td>è¯´æ˜</td>
</tr>
<tr>
<td>å¯åŠ¨å’Œç¦ç”¨ç”¨æˆ·</td>
<td><strong>on</strong></td>
<td>æ¿€æ´»æŸç”¨æˆ·è´¦å·</td>
</tr>
<tr>
<td><strong>off</strong></td>
<td>ç¦ç”¨æŸç”¨æˆ·è´¦å·ã€‚æ³¨æ„ï¼Œå·²éªŒè¯çš„è¿æ¥ä»ç„¶å¯ä»¥å·¥ä½œã€‚å¦‚æœé»˜è®¤ç”¨æˆ·è¢«æ ‡è®°ä¸ºoffï¼Œåˆ™æ–°è¿æ¥å°†åœ¨æœªè¿›è¡Œèº«ä»½éªŒè¯çš„æƒ…å†µä¸‹å¯åŠ¨ï¼Œå¹¶è¦æ±‚ç”¨æˆ·ä½¿ç”¨AUTHé€‰é¡¹å‘é€AUTHæˆ–HELLOï¼Œä»¥ä¾¿ä»¥æŸç§æ–¹å¼è¿›è¡Œèº«ä»½éªŒè¯ã€‚</td>
<td></td>
</tr>
<tr>
<td>æƒé™çš„æ·»åŠ åˆ é™¤</td>
<td><strong>+<command></strong></td>
<td>å°†æŒ‡ä»¤æ·»åŠ åˆ°ç”¨æˆ·å¯ä»¥è°ƒç”¨çš„æŒ‡ä»¤åˆ—è¡¨ä¸­</td>
</tr>
<tr>
<td><strong>-<command></strong></td>
<td>ä»ç”¨æˆ·å¯æ‰§è¡ŒæŒ‡ä»¤åˆ—è¡¨ç§»é™¤æŒ‡ä»¤</td>
<td></td>
</tr>
<tr>
<td><strong>+@<category></category></strong></td>
<td>æ·»åŠ è¯¥ç±»åˆ«ä¸­ç”¨æˆ·è¦è°ƒç”¨çš„æ‰€æœ‰æŒ‡ä»¤ï¼Œæœ‰æ•ˆç±»åˆ«ä¸º@adminã€@setã€@sortedsetâ€¦ç­‰ï¼Œé€šè¿‡è°ƒç”¨ACL CATå‘½ä»¤æŸ¥çœ‹å®Œæ•´åˆ—è¡¨ã€‚ç‰¹æ®Šç±»åˆ«@allè¡¨ç¤ºæ‰€æœ‰å‘½ä»¤ï¼ŒåŒ…æ‹¬å½“å‰å­˜åœ¨äºæœåŠ¡å™¨ä¸­çš„å‘½ä»¤ï¼Œä»¥åŠå°†æ¥å°†é€šè¿‡æ¨¡å—åŠ è½½çš„å‘½ä»¤ã€‚</td>
<td></td>
</tr>
<tr>
<td>-@<actegory></actegory></td>
<td>ä»ç”¨æˆ·å¯è°ƒç”¨æŒ‡ä»¤ä¸­ç§»é™¤ç±»åˆ«</td>
<td></td>
</tr>
<tr>
<td><strong>allcommands</strong></td>
<td>+@allçš„åˆ«å</td>
<td></td>
</tr>
<tr>
<td><strong>nocommand</strong></td>
<td>-@allçš„åˆ«å</td>
<td></td>
</tr>
<tr>
<td>å¯æ“ä½œé”®çš„æ·»åŠ æˆ–åˆ é™¤</td>
<td><strong>~<pattern></pattern></strong></td>
<td>æ·»åŠ å¯ä½œä¸ºç”¨æˆ·å¯æ“ä½œçš„é”®çš„æ¨¡å¼ã€‚ä¾‹å¦‚~*å…è®¸æ‰€æœ‰çš„é”®</td>
</tr>
</tbody></table>
<p>ï¼ˆ2ï¼‰é€šè¿‡å‘½ä»¤åˆ›å»ºæ–°ç”¨æˆ·é»˜è®¤æƒé™</p>
<p>â€‹	acl setuser user1</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">127.0.0.1:6379&gt; acl setuser user01</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; acl list</span><br><span class="line">1) &quot;user default on nopass ~* &amp;* +@all&quot;</span><br><span class="line">2) &quot;user user01 off &amp;* -@all&quot;</span><br></pre></td></tr></table></figure>

<p>â€‹		ä¸Šè¿°ç¤ºä¾‹ä¸­ï¼Œå¦‚æœç”¨æˆ·ä¸å­˜åœ¨ï¼Œè¿™å°†ä½¿ç”¨ just created çš„é»˜è®¤å±æ€§æ¥åˆ›å»ºç”¨æˆ·ã€‚å¦‚æœç”¨æˆ·å·²ç»å­˜åœ¨ï¼Œåˆ™ä¸Šé¢çš„å‘½ä»¤å°†ä¸æ‰§è¡Œä»»ä½•æ“ä½œã€‚</p>
<p>ï¼ˆ3ï¼‰è®¾ç½®æœ‰ç”¨æˆ·åã€å¯†ç ã€ACLæƒé™ã€å¹¶å¯ç”¨çš„ç”¨æˆ·</p>
<p>â€‹		acl setuser user02 on &gt;password ~cached:* +get</p>
<p>â€‹		<em><em>&gt;åæ¥å¯†ç (passwordå³ä¸ºå¯†ç )ï¼Œ~cached:</em>	ä»¥cachedå¼€å¤´çš„é”®å¯ä»¥è¢«æ“ä½œ	+get	åªèƒ½ä½¿ç”¨getå‘½ä»¤</em>*</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">127.0.0.1:6379&gt; acl setuser user02 on &gt;password ~cached:* +get</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; acl list</span><br><span class="line">1) &quot;user default on nopass ~* &amp;* +@all&quot;</span><br><span class="line">2) &quot;user user01 off &amp;* -@all&quot;</span><br><span class="line">3) &quot;user user02 on #5e884898da28047151d0e56f8dc6292773603d0d6aabbdd62a11ef721d1542d8 ~cached:* &amp;* -@all +get&quot;</span><br><span class="line">127.0.0.1:6379&gt;</span><br></pre></td></tr></table></figure>

<p>ï¼ˆ4ï¼‰åˆ‡æ¢ç”¨æˆ·ï¼ŒéªŒè¯æƒé™</p>
<p>â€‹	auth user02 password</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@localhost ~]# redis-cli -c -p 6379</span><br><span class="line">127.0.0.1:6379&gt; acl whoami</span><br><span class="line">&quot;default&quot;</span><br><span class="line">127.0.0.1:6379&gt; acl list</span><br><span class="line">1) &quot;user default on nopass ~* &amp;* +@all&quot;</span><br><span class="line">2) &quot;user user01 off &amp;* -@all&quot;</span><br><span class="line">3) &quot;user user02 on #5e884898da28047151d0e56f8dc6292773603d0d6aabbdd62a11ef721d1542d8 ~cached:* &amp;* -@all +get&quot;</span><br><span class="line">127.0.0.1:6379&gt; auth user02 password</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; set k1 v1</span><br><span class="line">(error) NOPERM this user has no permissions to run the &#x27;set&#x27; command or its subcommand</span><br><span class="line">127.0.0.1:6379&gt; get k1</span><br><span class="line">(error) NOPERM this user has no permissions to access one of the keys used as arguments</span><br><span class="line">127.0.0.1:6379&gt; get cached:001</span><br><span class="line"><span class="meta prompt_">-&gt; </span><span class="language-bash">Redirected to slot [8807] located at 192.168.100.100:6391</span></span><br><span class="line">(nil)</span><br><span class="line">192.168.100.100:6391&gt;</span><br></pre></td></tr></table></figure>

<h2 id="IO-å¤šçº¿ç¨‹"><a href="#IO-å¤šçº¿ç¨‹" class="headerlink" title="IO å¤šçº¿ç¨‹"></a><strong>IO</strong> å¤šçº¿ç¨‹</h2><h3 id="ç®€ä»‹-9"><a href="#ç®€ä»‹-9" class="headerlink" title="ç®€ä»‹"></a><strong>ç®€ä»‹</strong></h3><p>Redis6ç»ˆäºæ”¯æŒå¤šçº¿ç¨‹äº†ï¼Œå‘Šåˆ«å•çº¿ç¨‹äº†å—ï¼Ÿ</p>
<p>IOå¤šçº¿ç¨‹å…¶å®æŒ‡ <strong>å®¢æˆ·ç«¯äº¤äº’éƒ¨åˆ†</strong>çš„<strong>ç½‘ç»œIO</strong> äº¤äº’å¤„ç†æ¨¡å—<strong>å¤šçº¿ç¨‹</strong>ï¼Œè€Œé<strong>æ‰§è¡Œå‘½ä»¤å¤šçº¿ç¨‹</strong>ã€‚Redis6æ‰§è¡Œå‘½ä»¤ä¾ç„¶æ˜¯å•çº¿ç¨‹ã€‚</p>
<h3 id="åŸç†æ¶æ„"><a href="#åŸç†æ¶æ„" class="headerlink" title="åŸç†æ¶æ„"></a><strong>åŸç†æ¶æ„</strong></h3><p>â€‹		Redis 6 åŠ å…¥å¤šçº¿ç¨‹ï¼Œä½†è·Ÿ Memcached è¿™ç§ä» IOå¤„ç†åˆ°æ•°æ®è®¿é—®å¤šçº¿ç¨‹çš„å®ç°æ¨¡å¼æœ‰äº›å·®å¼‚ã€‚<strong>Redis çš„å¤šçº¿ç¨‹éƒ¨åˆ†åªæ˜¯ç”¨æ¥å¤„ç†ç½‘ç»œæ•°æ®çš„è¯»å†™å’Œåè®®è§£æï¼Œæ‰§è¡Œå‘½ä»¤ä»ç„¶æ˜¯å•</strong>çº¿ç¨‹ã€‚ä¹‹æ‰€ä»¥è¿™ä¹ˆè®¾è®¡æ˜¯ä¸æƒ³å› ä¸ºå¤šçº¿ç¨‹è€Œå˜å¾—å¤æ‚ï¼Œéœ€è¦å»æ§åˆ¶ keyã€luaã€äº‹åŠ¡ï¼ŒLPUSH&#x2F;LPOP ç­‰ç­‰çš„å¹¶å‘é—®é¢˜ã€‚æ•´ä½“çš„è®¾è®¡å¤§ä½“å¦‚ä¸‹ï¼š</p>
<img src="/2023/02/28/Redis/Java\Document\Redis\Redis.assets\image-20221008233535092.png" alt="image-20221008233535092" style="zoom:80%;">

<p>å¦å¤–ï¼Œå¤šçº¿ç¨‹IOé»˜è®¤ä¹Ÿæ˜¯ä¸å¼€å¯çš„ï¼Œéœ€è¦å†é…ç½®æ–‡ä»¶ä¸­é…ç½®</p>
<ul>
<li>â€‹	io-threads 4</li>
<li>â€‹	io-threads-do-reads yes</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">1141 # So for instance if you have a four cores boxes, try to use 2 or 3 I/O</span><br><span class="line">1142 # threads, if you have a 8 cores, try to use 6 threads. In order to</span><br><span class="line">1143 # enable I/O threads use the following configuration directive:</span><br><span class="line">1144 #</span><br><span class="line">1145 # io-threads 4</span><br><span class="line">1146 #</span><br><span class="line">1147 # Setting io-threads to 1 will just use the main thread as usual.</span><br><span class="line">1148 # When I/O threads are enabled, we only use threads for writes, that is</span><br><span class="line">1149 # to thread the write(2) syscall and transfer the client buffers to the</span><br><span class="line">1150 # socket. However it is also possible to enable threading of reads and</span><br><span class="line">1151 # protocol parsing using the following configuration directive, by setting</span><br><span class="line">1152 # it to yes:</span><br><span class="line">1153 #</span><br><span class="line">1154 # io-threads-do-reads no</span><br><span class="line">1155 #</span><br><span class="line">1156 # Usually threading reads doesn&#x27;t help much.</span><br><span class="line">1157 #</span><br><span class="line">1158 # NOTE 1: This configuration directive cannot be changed at runtime via</span><br><span class="line">1159 # CONFIG SET. Aso this feature currently does not work when SSL is</span><br><span class="line">1160 # enabled.</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="å·¥å…·æ”¯æŒ-Cluster"><a href="#å·¥å…·æ”¯æŒ-Cluster" class="headerlink" title="å·¥å…·æ”¯æŒ Cluster"></a><strong>å·¥å…·æ”¯æŒ</strong> <strong>Cluster</strong></h2><p>ä¹‹å‰è€ç‰ˆ Redis æƒ³è¦æ­é›†ç¾¤éœ€è¦å•ç‹¬å®‰è£… ruby ç¯å¢ƒï¼ŒRedis 5 å°† redis-trib.rb çš„åŠŸèƒ½é›†æˆåˆ° redis-cli ã€‚å¦å¤–å®˜æ–¹ redis-benchmark å·¥å…·å¼€å§‹æ”¯æŒ cluster æ¨¡å¼äº†ï¼Œé€šè¿‡å¤šçº¿ç¨‹çš„æ–¹å¼å¯¹å¤šä¸ªåˆ†ç‰‡è¿›è¡Œå‹æµ‹ã€‚</p>
<h2 id="Redis-æ–°åŠŸèƒ½æŒç»­å…³æ³¨"><a href="#Redis-æ–°åŠŸèƒ½æŒç»­å…³æ³¨" class="headerlink" title="Redis æ–°åŠŸèƒ½æŒç»­å…³æ³¨"></a><strong>Redis</strong> æ–°åŠŸèƒ½æŒç»­å…³æ³¨</h2><p>Redis6 æ–°åŠŸèƒ½è¿˜æœ‰ï¼š</p>
<ol>
<li><p>RESP3 æ–°çš„ Redis é€šä¿¡åè®®ï¼šä¼˜åŒ–æœåŠ¡ç«¯ä¸å®¢æˆ·ç«¯ä¹‹é—´é€šä¿¡</p>
</li>
<li><p>Client Side Caching å®¢æˆ·ç«¯ç¼“å­˜ï¼šåŸºäº RESP3 åè®®å®ç°çš„å®¢æˆ·ç«¯ç¼“å­˜åŠŸèƒ½ã€‚ä¸ºäº†è¿›ä¸€æ­¥æå‡ç¼“å­˜çš„æ€§èƒ½ï¼Œå°†å®¢æˆ·ç«¯ç»å¸¸è®¿é—®çš„æ•°æ® Cache åˆ°å®¢æˆ·ç«¯ï¼Œå‡å°‘TCPç½‘ç»œäº¤äº’ã€‚</p>
</li>
<li><p>Proxyé›†ç¾¤ä»£ç†æ¨¡å¼ï¼šProxy åŠŸèƒ½ï¼Œè®© Cluster æ‹¥æœ‰åƒå•å®ä¾‹ä¸€æ ·çš„æ¥å…¥æ–¹å¼ï¼Œé™ä½å¤§å®¶ä½¿ç”¨ Cluster çš„é—¨æ§›ã€‚ä¸è¿‡éœ€è¦æ³¨æ„çš„æ˜¯ä»£ç†ä¸æ”¹å˜ Cluster çš„åŠŸèƒ½é™åˆ¶ï¼Œä¸æ”¯æŒçš„å‘½ä»¤è¿˜æ˜¯ä¸ä¼šæ”¯æŒï¼Œæ¯”å¦‚è·¨ Slot çš„å¤šKeyæ“ä½œã€‚</p>
</li>
<li><p>Modules API</p>
<p> â€‹	Redis 6 ä¸­æ¨¡å—APIå¼€å‘è¿›å±•éå¸¸å¤§ï¼Œå› ä¸º Redis Labs ä¸ºäº†å¼€å‘å¤æ‚çš„åŠŸèƒ½ï¼Œä»ä¸€å¼€å§‹å°±ç”¨ä¸Š Redis æ¨¡å—ã€‚Rediså¯ä»¥å˜æˆä¸€ä¸ªæ¡†æ¶ï¼Œåˆ©ç”¨ Modules æ¥æ„å»ºä¸åŒç³»ç»Ÿï¼Œè€Œä¸éœ€è¦ä»å¤´å¼€å§‹å†™ç„¶åè¿˜è¦ BSD è®¸å¯ã€‚Redisä¸€å¼€å§‹å°±æ˜¯ä¸€ä¸ªå‘ç¼–å†™å„ç§ç³»ç»Ÿå¼€æ”¾çš„å¹³å°ã€‚</p>
</li>
</ol>
]]></content>
  </entry>
  <entry>
    <title>æ“ä½œç³»ç»Ÿ</title>
    <url>/2023/02/28/OperatingSystem/</url>
    <content><![CDATA[]]></content>
  </entry>
  <entry>
    <title>Spring</title>
    <url>/2023/02/28/Spring/</url>
    <content><![CDATA[<h1 id><a href="#" class="headerlink" title></a></h1><h1 id="Spring-æ³¨è§£é©±åŠ¨å¼€å‘"><a href="#Spring-æ³¨è§£é©±åŠ¨å¼€å‘" class="headerlink" title="Spring æ³¨è§£é©±åŠ¨å¼€å‘"></a>Spring æ³¨è§£é©±åŠ¨å¼€å‘</h1><h2 id="å®¹å™¨"><a href="#å®¹å™¨" class="headerlink" title="å®¹å™¨"></a>å®¹å™¨</h2><p>å‰ç½®å‡†å¤‡ï¼š</p>
<p>å¼•å…¥ä¾èµ–ï¼š</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-context<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.3.30.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.18.24<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.12<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>Beanï¼š</p>
<p>Personï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.bean;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.AllArgsConstructor;</span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"><span class="keyword">import</span> lombok.NoArgsConstructor;</span><br><span class="line"><span class="keyword">import</span> lombok.ToString;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="meta">@ToString</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Person</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> Integer age;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="ç»„ä»¶æ·»åŠ "><a href="#ç»„ä»¶æ·»åŠ " class="headerlink" title="ç»„ä»¶æ·»åŠ "></a>ç»„ä»¶æ·»åŠ </h3><h4 id="ç»„ä»¶æ³¨å†Œï¼š-Configuration-Bean"><a href="#ç»„ä»¶æ³¨å†Œï¼š-Configuration-Bean" class="headerlink" title="ç»„ä»¶æ³¨å†Œï¼š@Configuration + @Bean"></a>ç»„ä»¶æ³¨å†Œï¼š@Configuration + @Bean</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.example.bean.Person;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span>  <span class="comment">//æŒ‡æ˜ä¸ºé…ç½®ç±»</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MainConfig</span> &#123;</span><br><span class="line">    <span class="comment">// @Beanç»™å®¹å™¨ä¸­æ³¨å…¥ä¸€ä¸ªBeanï¼Œç±»å‹ä¸ºè¿”å›å€¼çš„ç±»å‹ï¼Œæ–¹æ³•åé»˜è®¤ä¸ºBeançš„ID</span></span><br><span class="line">    <span class="meta">@Bean(&quot;person&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Person <span class="title function_">person01</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Person</span>(<span class="string">&quot;Tom&quot;</span>, <span class="number">12</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æµ‹è¯•ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test01</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">// ClassPathXmlApplicationContext applicationContext = </span></span><br><span class="line">             <span class="keyword">new</span> <span class="title class_">ClassPathXmlApplicationContext</span>(<span class="string">&quot;bean.xml&quot;</span>);</span><br><span class="line">    <span class="type">ApplicationContext</span> <span class="variable">applicationContext</span> <span class="operator">=</span> </span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">AnnotationConfigApplicationContext</span>(MainConfig.class);</span><br><span class="line">    <span class="type">Person</span> <span class="variable">person</span> <span class="operator">=</span> applicationContext.getBean(Person.class, <span class="string">&quot;person&quot;</span>);</span><br><span class="line">    System.out.println(<span class="string">&quot;person: &quot;</span> + person);</span><br><span class="line"></span><br><span class="line">    String[] beanNamesForType = applicationContext.getBeanNamesForType(Person.class);</span><br><span class="line">    <span class="keyword">for</span> (String beanName : beanNamesForType) &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;beanName: &quot;</span> + beanName);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="ç»„ä»¶æ³¨å†Œï¼š-ComponentScan-Controllerã€-Serviceã€-Repository"><a href="#ç»„ä»¶æ³¨å†Œï¼š-ComponentScan-Controllerã€-Serviceã€-Repository" class="headerlink" title="ç»„ä»¶æ³¨å†Œï¼š@ComponentScan + @Controllerã€@Serviceã€@Repository"></a>ç»„ä»¶æ³¨å†Œï¼š@ComponentScan + @Controllerã€@Serviceã€@Repository</h4><p>åŒ…æ‰«ææŒ‡å®šè§„åˆ™ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class="line"><span class="meta">@Target(&#123;&#125;)</span></span><br><span class="line"><span class="meta">@interface</span> Filter &#123;</span><br><span class="line">	<span class="comment">// æ ¹æ®æ³¨è§£è¿‡æ»¤</span></span><br><span class="line">	FilterType <span class="title function_">type</span><span class="params">()</span> <span class="keyword">default</span> FilterType.ANNOTATION;</span><br><span class="line">       </span><br><span class="line">	<span class="comment">// æ ¹æ®ç±»å</span></span><br><span class="line">	<span class="meta">@AliasFor(&quot;classes&quot;)</span></span><br><span class="line">	Class&lt;?&gt;[] value() <span class="keyword">default</span> &#123;&#125;;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@AliasFor(&quot;value&quot;)</span></span><br><span class="line">	Class&lt;?&gt;[] classes() <span class="keyword">default</span> &#123;&#125;;</span><br><span class="line">       </span><br><span class="line">	<span class="comment">// æ ¹æ®æ­£åˆ™è¿‡æ»¤</span></span><br><span class="line">	String[] pattern() <span class="keyword">default</span> &#123;&#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>FilterTypeï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">enum</span> <span class="title class_">FilterType</span> &#123;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * Filter candidates marked with a given annotation.</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	ANNOTATION,</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * Filter candidates assignable to a given type.</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	ASSIGNABLE_TYPE,</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * Filter candidates matching a given AspectJ type pattern expression.</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	ASPECTJ,</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * Filter candidates matching a given regex pattern.</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	REGEX,</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** Filter candidates using a given custom</span></span><br><span class="line"><span class="comment">	 * &#123;<span class="doctag">@link</span> org.springframework.core.type.filter.TypeFilter&#125; implementation.</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	CUSTOM</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç¤ºä¾‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Configuration</span>  <span class="comment">//æŒ‡æ˜ä¸ºé…ç½®ç±»</span></span><br><span class="line"><span class="comment">//excludeFiltersï¼šæ’é™¤ç»„ä»¶</span></span><br><span class="line"><span class="meta">@ComponentScan(value = &quot;com.example&quot;, includeFilters = &#123;</span></span><br><span class="line"><span class="meta">        @ComponentScan.Filter(type = FilterType.ANNOTATION, classes = &#123;Controller.class&#125;),</span></span><br><span class="line"><span class="meta">        @ComponentScan.Filter(type = FilterType.ASSIGNABLE_TYPE, classes = ProtoService.class),</span></span><br><span class="line"><span class="meta">        @ComponentScan.Filter(type = FilterType.CUSTOM, classes = CustomTypeFilter.class)&#125;,</span></span><br><span class="line"><span class="meta">        useDefaultFilters = false)</span></span><br><span class="line"><span class="comment">//includeFiltersï¼šä»…å¼•å…¥ç»„ä»¶</span></span><br><span class="line"><span class="comment">//@ComponentScan(value = &quot;com.example&quot;, excludeFilters = &#123;</span></span><br><span class="line"><span class="comment">//        @ComponentScan.Filter(type = FilterType.ANNOTATION, classes = &#123;Controller.class, Service.class&#125;)&#125;)</span></span><br><span class="line"><span class="comment">//@ComponentScans()</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MainConfig</span> &#123;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä½œç”¨åŸŸï¼š@Scope</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MainConfig02</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ConfigurableBeanFactory.SCOPE_PROTOTYPE,</span></span><br><span class="line"><span class="comment">     * ConfigurableBeanFactory.SCOPE_SINGLETON,</span></span><br><span class="line"><span class="comment">     * org.springframework.web.context.WebApplicationContext.SCOPE_REQUEST,</span></span><br><span class="line"><span class="comment">     * org.springframework.web.context.WebApplicationContext.SCOPE_SESSION,</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * singletonï¼šé»˜è®¤å•å®ä¾‹ï¼Œå®¹å™¨å¯åŠ¨å°±ä¼šåˆ›å»ºå¯¹è±¡ï¼Œæ¯æ¬¡è·å–çš„éƒ½æ˜¯åŒä¸€å¯¹è±¡</span></span><br><span class="line"><span class="comment">     * prototypeï¼šå¤šå®ä¾‹ï¼Œä»å®¹å™¨ä¸­è·å–æ—¶æ‰ä¼šåˆ›å»ºå¯¹è±¡ï¼Œæ¯æ¬¡è·å–åˆ°çš„æ˜¯ä¸åŒå¯¹è±¡</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * requestï¼šåŒä¸€æ¬¡requeståˆ›å»ºä¸€ä¸ªå®ä¾‹</span></span><br><span class="line"><span class="comment">     * sessionï¼šåŒä¸€æ¬¡sessionåˆ›å»ºä¸€ä¸ªå®ä¾‹</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="comment">//@Scope(value = &quot;prototype&quot;)</span></span><br><span class="line">    <span class="meta">@Scope(value = &quot;singleton&quot;)</span></span><br><span class="line">    <span class="comment">//@Lazyï¼šé»˜è®¤å•å®ä¾‹ï¼Œä½¿ç”¨@Lazyï¼Œç¬¬ä¸€æ¬¡ä½¿ç”¨æ—¶æ‰ä¼šåˆ›å»ºå¯¹è±¡</span></span><br><span class="line">    <span class="meta">@Lazy</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> Person <span class="title function_">person</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Person()...&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Person</span>(<span class="string">&quot;Jack&quot;</span>, <span class="number">8</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æµ‹è¯•ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Scope</span>æµ‹è¯•</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test03</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">ApplicationContext</span> <span class="variable">applicationContext</span> <span class="operator">=</span></span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">AnnotationConfigApplicationContext</span>(MainConfig02.class);</span><br><span class="line">    <span class="comment">/*Person person01 = applicationContext.getBean(Person.class);</span></span><br><span class="line"><span class="comment">    Person person02 = applicationContext.getBean(Person.class);</span></span><br><span class="line"><span class="comment">    System.out.println(&quot;person01 == person02: &quot; + (person02 == person01));*/</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="ç»„ä»¶æ³¨å†Œï¼š-Conditional"><a href="#ç»„ä»¶æ³¨å†Œï¼š-Conditional" class="headerlink" title="ç»„ä»¶æ³¨å†Œï¼š@Conditional"></a>ç»„ä»¶æ³¨å†Œï¼š@Conditional</h4><p>å¯ä»¥ä½œç”¨äºæ–¹æ³•å’Œç±»ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MainConfig02</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@Conditional</span>æ³¨è§£ï¼šBeanæ ¹æ®æ¡ä»¶æ³¨å†Œ</span></span><br><span class="line"><span class="comment">     * å®ç°Conditionæ¥å£</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Conditional(WindowsConditional.class)</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> Person <span class="title function_">bill</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Person</span>(<span class="string">&quot;Bill&quot;</span>, <span class="number">65</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Conditional(LinuxConditional.class)</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> Person <span class="title function_">linus</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Person</span>(<span class="string">&quot;Linus&quot;</span>, <span class="number">54</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Conditionï¼šWindowsConditional</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Windowsç»„ä»¶æ³¨å†Œæ¡ä»¶</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WindowsConditional</span> <span class="keyword">implements</span> <span class="title class_">Condition</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> context ä¸Šä¸‹æ–‡ç¯å¢ƒ</span></span><br><span class="line"><span class="comment">     *          the condition context</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> metadataï¼šç±»æ³¨è§£ä¿¡æ¯</span></span><br><span class="line"><span class="comment">     *          metadata of the class or method being checked.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">matches</span><span class="params">(ConditionContext context, AnnotatedTypeMetadata metadata)</span> &#123;</span><br><span class="line">        <span class="comment">//è·å–è¿è¡Œæ—¶ç¯å¢ƒ</span></span><br><span class="line">        <span class="type">Environment</span> <span class="variable">environment</span> <span class="operator">=</span> context.getEnvironment();</span><br><span class="line">        <span class="comment">//è·å–Beanå®šä¹‰çš„æ³¨å†Œç±»</span></span><br><span class="line">        <span class="type">BeanDefinitionRegistry</span> <span class="variable">registry</span> <span class="operator">=</span> context.getRegistry();</span><br><span class="line">        <span class="comment">//åˆ¤æ–­å®¹å™¨ä¸­çš„Beanæ³¨å†Œæƒ…å†µ</span></span><br><span class="line">        <span class="type">boolean</span> <span class="variable">linus</span> <span class="operator">=</span> registry.containsBeanDefinition(<span class="string">&quot;Bill&quot;</span>);</span><br><span class="line">		</span><br><span class="line">        <span class="type">String</span> <span class="variable">env</span> <span class="operator">=</span> environment.getProperty(<span class="string">&quot;os.name&quot;</span>);</span><br><span class="line">        <span class="comment">//å¦‚æœè¿è¡Œç¯å¢ƒä¸ºWindowsï¼Œåˆ™è¯¥æ¡ä»¶ç”Ÿæ•ˆï¼Œå¯ä»¥è®¾ç½®ï¼š-Dos.name=Windows</span></span><br><span class="line">        <span class="keyword">if</span> (env.contains(<span class="string">&quot;Windows&quot;</span>)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Conditionï¼šLinuxConditional</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Linuxç»„ä»¶æ³¨å†Œæ¡ä»¶</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LinuxConditional</span> <span class="keyword">implements</span> <span class="title class_">Condition</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> context ä¸Šä¸‹æ–‡ç¯å¢ƒ</span></span><br><span class="line"><span class="comment">     *          the condition context</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> metadataï¼šç±»æ³¨è§£ä¿¡æ¯</span></span><br><span class="line"><span class="comment">     *          metadata of the class or method being checked.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">matches</span><span class="params">(ConditionContext context, AnnotatedTypeMetadata metadata)</span> &#123;</span><br><span class="line">        <span class="comment">//è·å–è¿è¡Œæ—¶ç¯å¢ƒ</span></span><br><span class="line">        <span class="type">Environment</span> <span class="variable">environment</span> <span class="operator">=</span> context.getEnvironment();</span><br><span class="line">        <span class="comment">//è·å–Beanå®šä¹‰çš„æ³¨å†Œç±»</span></span><br><span class="line">        <span class="type">BeanDefinitionRegistry</span> <span class="variable">registry</span> <span class="operator">=</span> context.getRegistry();</span><br><span class="line">        <span class="comment">//åˆ¤æ–­å®¹å™¨ä¸­çš„Beanæ³¨å†Œæƒ…å†µ</span></span><br><span class="line">        <span class="type">boolean</span> <span class="variable">linus</span> <span class="operator">=</span> registry.containsBeanDefinition(<span class="string">&quot;Linus&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="type">String</span> <span class="variable">env</span> <span class="operator">=</span> environment.getProperty(<span class="string">&quot;os.name&quot;</span>);</span><br><span class="line">        <span class="comment">//å¦‚æœè¿è¡Œç¯å¢ƒä¸ºlinuxï¼Œåˆ™è¯¥æ¡ä»¶ç”Ÿæ•ˆï¼Œå¯ä»¥è®¾ç½®ï¼š-Dos.name=linux</span></span><br><span class="line">        <span class="keyword">if</span> (env.contains(<span class="string">&quot;linux&quot;</span>)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="Import"><a href="#Import" class="headerlink" title="@Import"></a>@Import</h4><p>{@link Configuration}, {@link ImportSelector}, {@link ImportBeanDefinitionRegistrar}</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * public <span class="doctag">@interface</span> Import &#123;</span></span><br><span class="line"><span class="comment"> *      &#123;<span class="doctag">@link</span> Configuration&#125;, &#123;<span class="doctag">@link</span> ImportSelector&#125;, &#123;<span class="doctag">@link</span> ImportBeanDefinitionRegistrar&#125;</span></span><br><span class="line"><span class="comment"> *      or regular component classes to import.</span></span><br><span class="line"><span class="comment"> *      Class&lt;?&gt;[] value();</span></span><br><span class="line"><span class="comment"> * &#125;</span></span><br><span class="line"><span class="comment"> * è¯´æ˜ï¼š</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Import(value = &#123;Spring.class, Summer.class,</span></span><br><span class="line"><span class="meta">        CustomImportSelector.class,</span></span><br><span class="line"><span class="meta">        CustomImportBeanDefinitionRegistrar.class&#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MainConfig03</span> &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CustomImportSelector</span> <span class="keyword">implements</span> <span class="title class_">ImportSelector</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Select and return the names of which class(es) should be imported</span></span><br><span class="line"><span class="comment">     * based on the AnnotationMetadata of the importing <span class="doctag">@Configuration</span> class.</span></span><br><span class="line"><span class="comment">     * Returns:</span></span><br><span class="line"><span class="comment">     * the class names, or an empty array if none</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> importingClassMetadata å½“å‰æ ‡æ³¨<span class="doctag">@Import</span>æ³¨è§£çš„ç±»çš„æ‰€æœ‰æ³¨è§£ä¿¡æ¯</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> éœ€è¦å¯¼å…¥åˆ°å®¹å™¨ä¸­çš„ç»„ä»¶å…¨ç±»å</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String[] selectImports(AnnotationMetadata importingClassMetadata) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">String</span>[]&#123;<span class="string">&quot;com.example.bean.Autumn&quot;</span>, <span class="string">&quot;com.example.bean.Winter&quot;</span>&#125;;</span><br><span class="line">        <span class="comment">//return new String[0];</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CustomImportBeanDefinitionRegistrar</span> <span class="keyword">implements</span> <span class="title class_">ImportBeanDefinitionRegistrar</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Params:</span></span><br><span class="line"><span class="comment">     * importingClassMetadata â€“ annotation metadata of the importing class registry â€“ current bean definition registry</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> importingClassMetadata annotation metadata of the importing class</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> registry current bean definition registry</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">registerBeanDefinitions</span><span class="params">(AnnotationMetadata importingClassMetadata, BeanDefinitionRegistry registry)</span> &#123;</span><br><span class="line">        <span class="type">boolean</span> <span class="variable">winter</span> <span class="operator">=</span> registry.containsBeanDefinition(<span class="string">&quot;com.example.bean.Winter&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span>(winter)&#123;</span><br><span class="line">            registry.registerBeanDefinition(<span class="string">&quot;snow&quot;</span>,<span class="keyword">new</span> <span class="title class_">RootBeanDefinition</span>(Snow.class));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="FactoryBean"><a href="#FactoryBean" class="headerlink" title="FactoryBean"></a>FactoryBean</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure>



<h3 id="ç”Ÿå‘½å‘¨æœŸ"><a href="#ç”Ÿå‘½å‘¨æœŸ" class="headerlink" title="ç”Ÿå‘½å‘¨æœŸ"></a>ç”Ÿå‘½å‘¨æœŸ</h3><h3 id="ç»„ä»¶èµ‹å€¼"><a href="#ç»„ä»¶èµ‹å€¼" class="headerlink" title="ç»„ä»¶èµ‹å€¼"></a>ç»„ä»¶èµ‹å€¼</h3><h3 id="ç»„ä»¶æ³¨å…¥"><a href="#ç»„ä»¶æ³¨å…¥" class="headerlink" title="ç»„ä»¶æ³¨å…¥"></a>ç»„ä»¶æ³¨å…¥</h3><h3 id="AOP"><a href="#AOP" class="headerlink" title="AOP"></a>AOP</h3><h3 id="å£°æ˜å¼äº‹åŠ¡"><a href="#å£°æ˜å¼äº‹åŠ¡" class="headerlink" title="å£°æ˜å¼äº‹åŠ¡"></a>å£°æ˜å¼äº‹åŠ¡</h3><h2 id="æ‰©å±•åŸç†"><a href="#æ‰©å±•åŸç†" class="headerlink" title="æ‰©å±•åŸç†"></a>æ‰©å±•åŸç†</h2><h3 id="BeanFactoryPostProcessor"><a href="#BeanFactoryPostProcessor" class="headerlink" title="BeanFactoryPostProcessor"></a>BeanFactoryPostProcessor</h3><h3 id="BeanDefinitionRegistryPostProcessor"><a href="#BeanDefinitionRegistryPostProcessor" class="headerlink" title="BeanDefinitionRegistryPostProcessor"></a>BeanDefinitionRegistryPostProcessor</h3><h3 id="ApplicationListener"><a href="#ApplicationListener" class="headerlink" title="ApplicationListener"></a>ApplicationListener</h3><h3 id="Springå®¹å™¨å¤„ç†è¿‡ç¨‹"><a href="#Springå®¹å™¨å¤„ç†è¿‡ç¨‹" class="headerlink" title="Springå®¹å™¨å¤„ç†è¿‡ç¨‹"></a>Springå®¹å™¨å¤„ç†è¿‡ç¨‹</h3><h2 id="Web"><a href="#Web" class="headerlink" title="Web"></a>Web</h2><h2 id="Servlet3-0"><a href="#Servlet3-0" class="headerlink" title="Servlet3.0"></a>Servlet3.0</h2><h2 id="å¼‚æ­¥è¯·æ±‚"><a href="#å¼‚æ­¥è¯·æ±‚" class="headerlink" title="å¼‚æ­¥è¯·æ±‚"></a>å¼‚æ­¥è¯·æ±‚</h2>]]></content>
  </entry>
  <entry>
    <title>Shiro</title>
    <url>/2023/02/27/Shiro/</url>
    <content><![CDATA[]]></content>
  </entry>
  <entry>
    <title>RabbitMQ</title>
    <url>/2023/02/28/RabbitMQ/</url>
    <content><![CDATA[<h1 id><a href="#" class="headerlink" title></a></h1><h1 id="RabbitMQ"><a href="#RabbitMQ" class="headerlink" title="RabbitMQ"></a>RabbitMQ</h1><h1 id="MQ-æ¦‚è¿°"><a href="#MQ-æ¦‚è¿°" class="headerlink" title="MQ æ¦‚è¿°"></a>MQ æ¦‚è¿°</h1><h2 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h2><p>â€‹		MQï¼ŒMessage Queueï¼Œæœ¬è´¨æ˜¯ä¸€ä¸ªé˜Ÿåˆ—ï¼Œé˜Ÿåˆ—ä¸­å­˜æ”¾çš„æ˜¯æ¶ˆæ¯ï¼ŒåŒæ—¶ä¹Ÿæ˜¯ä¸€ç§è·¨è¿›ç¨‹çš„é€šä¿¡æœºåˆ¶ï¼Œç”¨äºä¸Šä¸‹æ¸¸ä¼ é€’æ•°æ®ã€‚</p>
<h2 id="ä½œç”¨"><a href="#ä½œç”¨" class="headerlink" title="ä½œç”¨"></a>ä½œç”¨</h2><h3 id="æµé‡æ¶ˆå³°"><a href="#æµé‡æ¶ˆå³°" class="headerlink" title="æµé‡æ¶ˆå³°"></a>æµé‡æ¶ˆå³°</h3><p>â€‹		ä¸¾ä¸ªä¾‹å­ï¼Œå¦‚æœè®¢å•ç³»ç»Ÿæœ€å¤šèƒ½å¤„ç†ä¸€ä¸‡æ¬¡è®¢å•ï¼Œè¿™ä¸ªå¤„ç†èƒ½åŠ›åº”ä»˜æ­£å¸¸æ—¶æ®µçš„ä¸‹å•æ—¶ç»°ç»°æœ‰ä½™ï¼Œæ­£å¸¸æ—¶æ®µæˆ‘ä»¬ä¸‹å•ä¸€ç§’åå°±èƒ½è¿”å›ç»“æœã€‚ä½†æ˜¯åœ¨é«˜å³°æœŸï¼Œå¦‚æœæœ‰ä¸¤ä¸‡æ¬¡ä¸‹å•æ“ä½œç³»ç»Ÿæ˜¯å¤„ç†ä¸äº†çš„ï¼Œåªèƒ½é™åˆ¶è®¢å•è¶…è¿‡ä¸€ä¸‡åä¸å…è®¸ç”¨æˆ·ä¸‹å•ã€‚ä½¿ç”¨æ¶ˆæ¯é˜Ÿåˆ—åšç¼“å†²ï¼Œæˆ‘ä»¬å¯ä»¥å–æ¶ˆè¿™ä¸ªé™åˆ¶ï¼ŒæŠŠä¸€ç§’å†…ä¸‹çš„è®¢å•åˆ†æ•£æˆä¸€æ®µæ—¶é—´æ¥å¤„ç†ï¼Œè¿™æ—¶æœ‰äº›ç”¨æˆ·å¯èƒ½åœ¨ä¸‹å•åå‡ ç§’åæ‰èƒ½æ”¶åˆ°ä¸‹å•æˆåŠŸçš„æ“ä½œï¼Œä½†æ˜¯æ¯”ä¸èƒ½ä¸‹å•çš„ä½“éªŒè¦å¥½ã€‚</p>
<h3 id="åº”ç”¨è§£è€¦"><a href="#åº”ç”¨è§£è€¦" class="headerlink" title="åº”ç”¨è§£è€¦"></a>åº”ç”¨è§£è€¦</h3><p>â€‹		ä»¥ç”µå•†åº”ç”¨ä¸ºä¾‹ï¼Œåº”ç”¨ä¸­æœ‰è®¢å•ç³»ç»Ÿã€åº“å­˜ç³»ç»Ÿã€ç‰©æµç³»ç»Ÿã€æ”¯ä»˜ç³»ç»Ÿã€‚ç”¨æˆ·åˆ›å»ºè®¢å•åï¼Œå¦‚æœè€¦åˆè°ƒç”¨åº“å­˜ç³»ç»Ÿã€ç‰©æµç³»ç»Ÿã€æ”¯ä»˜ç³»ç»Ÿï¼Œä»»ä½•ä¸€ä¸ªå­ç³»ç»Ÿå‡ºäº†æ•…éšœï¼Œéƒ½ä¼šé€ æˆä¸‹å•æ“ä½œå¼‚å¸¸ã€‚å½“è½¬å˜æˆåŸºäºæ¶ˆæ¯é˜Ÿåˆ—çš„æ–¹å¼åï¼Œç³»ç»Ÿé—´è°ƒç”¨çš„é—®é¢˜ä¼šå‡å°‘å¾ˆå¤šï¼Œæ¯”å¦‚ç‰©æµç³»ç»Ÿå› ä¸ºå‘ç”Ÿæ•…éšœï¼Œéœ€è¦å‡ åˆ†é’Ÿæ¥ä¿®å¤ã€‚åœ¨è¿™å‡ åˆ†é’Ÿçš„æ—¶é—´é‡Œï¼Œç‰©æµç³»ç»Ÿè¦å¤„ç†çš„å†…å­˜è¢«ç¼“å­˜åœ¨æ¶ˆæ¯é˜Ÿåˆ—ä¸­ï¼Œç”¨æˆ·çš„ä¸‹å•æ“ä½œå¯ä»¥æ­£å¸¸å®Œæˆã€‚å½“ç‰©æµç³»ç»Ÿæ¢å¤åï¼Œç»§ç»­å¤„ç†è®¢å•ä¿¡æ¯å³å¯ï¼Œä¸­å•ç”¨æˆ·æ„Ÿå—ä¸åˆ°ç‰©æµç³»ç»Ÿçš„æ•…éšœï¼Œæå‡ç³»ç»Ÿçš„å¯ç”¨æ€§ã€‚</p>
<h3 id="å¼‚æ­¥å¤„ç†"><a href="#å¼‚æ­¥å¤„ç†" class="headerlink" title="å¼‚æ­¥å¤„ç†"></a>å¼‚æ­¥å¤„ç†</h3><p>â€‹		æœ‰äº›æœåŠ¡é—´è°ƒç”¨æ˜¯å¼‚æ­¥çš„ï¼Œä¾‹å¦‚ A è°ƒç”¨ Bï¼ŒB éœ€è¦èŠ±è´¹å¾ˆé•¿æ—¶é—´æ‰§è¡Œï¼Œä½†æ˜¯ A éœ€è¦çŸ¥é“ B ä»€ä¹ˆæ—¶å€™å¯ ä»¥æ‰§è¡Œå®Œï¼Œä»¥å‰ä¸€èˆ¬æœ‰ä¸¤ç§æ–¹å¼ï¼ŒA è¿‡ä¸€æ®µæ—¶é—´å»è°ƒç”¨ B çš„æŸ¥è¯¢ api æŸ¥è¯¢ã€‚æˆ–è€… A æä¾›ä¸€ä¸ª callback apiï¼Œ B æ‰§è¡Œå®Œä¹‹åè°ƒç”¨ api é€šçŸ¥ A æœåŠ¡ã€‚è¿™ä¸¤ç§æ–¹å¼éƒ½ä¸æ˜¯å¾ˆä¼˜é›…ï¼Œä½¿ç”¨æ¶ˆæ¯æ€»çº¿ï¼Œå¯ä»¥å¾ˆæ–¹ä¾¿è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œ A è°ƒç”¨ B æœåŠ¡åï¼Œåªéœ€è¦ç›‘å¬ B å¤„ç†å®Œæˆçš„æ¶ˆæ¯ï¼Œå½“ B å¤„ç†å®Œæˆåï¼Œä¼šå‘é€ä¸€æ¡æ¶ˆæ¯ç»™ MQï¼ŒMQ ä¼šå°†æ­¤ æ¶ˆæ¯è½¬å‘ç»™ A æœåŠ¡ã€‚è¿™æ · A æœåŠ¡æ—¢ä¸ç”¨å¾ªç¯è°ƒç”¨ B çš„æŸ¥è¯¢ apiï¼Œä¹Ÿä¸ç”¨æä¾› callback apiã€‚åŒæ · B æœåŠ¡ä¹Ÿä¸ ç”¨åšè¿™äº›æ“ä½œã€‚A æœåŠ¡è¿˜èƒ½åŠæ—¶çš„å¾—åˆ°å¼‚æ­¥å¤„ç†æˆåŠŸçš„æ¶ˆæ¯ã€‚</p>
<h2 id="MQ-çš„åˆ†ç±»"><a href="#MQ-çš„åˆ†ç±»" class="headerlink" title="MQ çš„åˆ†ç±»"></a>MQ çš„åˆ†ç±»</h2><h3 id="ActiveMQ"><a href="#ActiveMQ" class="headerlink" title="ActiveMQ"></a>ActiveMQ</h3><p>ä¼˜ç‚¹ï¼šå•æœºååé‡ä¸‡çº§ï¼Œæ—¶æ•ˆæ€§ ms çº§ï¼Œå¯ç”¨æ€§é«˜ï¼ŒåŸºäºä¸»ä»æ¶æ„å®ç°é«˜å¯ç”¨æ€§ï¼Œæ¶ˆæ¯å¯é æ€§è¾ƒä½çš„æ¦‚ç‡ä¸¢å¤±æ•°æ®ã€‚</p>
<p>ç¼ºç‚¹ï¼šå®˜æ–¹ç¤¾åŒºç°åœ¨å¯¹ ActiveMQ 5.x ç»´æŠ¤è¶Šæ¥è¶Šå°‘ï¼Œé«˜ååé‡åœºæ™¯è¾ƒå°‘ä½¿ç”¨ã€‚ </p>
<h3 id="Kafka"><a href="#Kafka" class="headerlink" title="Kafka"></a>Kafka</h3><p>â€‹		å¤§æ•°æ®çš„æ€æ‰‹é”ï¼Œè°ˆåˆ°å¤§æ•°æ®é¢†åŸŸå†…çš„æ¶ˆæ¯ä¼ è¾“ï¼Œåˆ™ç»•ä¸å¼€ Kafkaï¼Œè¿™æ¬¾ä¸ºå¤§æ•°æ®è€Œç”Ÿçš„æ¶ˆæ¯ä¸­é—´ä»¶ï¼Œ ä»¥å…¶ç™¾ä¸‡çº§ TPS çš„ååé‡åå£°å¤§å™ªï¼Œè¿…é€Ÿæˆä¸ºå¤§æ•°æ®é¢†åŸŸçš„å® å„¿ï¼Œåœ¨æ•°æ®é‡‡é›†ã€ä¼ è¾“ã€å­˜å‚¨çš„è¿‡ç¨‹ä¸­å‘æŒ¥ç€ä¸¾è¶³è½»é‡çš„ä½œç”¨ã€‚ç›®å‰å·²ç»è¢« LinkedInï¼ŒUber, Twitter, Netflix ç­‰å¤§å…¬å¸æ‰€é‡‡çº³ã€‚ </p>
<p>ä¼˜ç‚¹: æ€§èƒ½å“è¶Šï¼Œå•æœºå†™å…¥ TPS çº¦åœ¨ç™¾ä¸‡æ¡&#x2F;ç§’ï¼Œæœ€å¤§çš„ä¼˜ç‚¹ï¼Œå°±æ˜¯ååé‡é«˜ã€‚æ—¶æ•ˆæ€§ ms çº§å¯ç”¨æ€§é å¸¸é«˜ï¼Œkafka æ˜¯åˆ†å¸ƒå¼çš„ï¼Œä¸€ä¸ªæ•°æ®å¤šä¸ªå‰¯æœ¬ï¼Œå°‘æ•°æœºå™¨å®•æœºï¼Œä¸ä¼šä¸¢å¤±æ•°æ®ï¼Œä¸ä¼šå¯¼è‡´ä¸å¯ç”¨ï¼Œæ¶ˆè´¹è€…é‡‡ç”¨ Pull æ–¹å¼è·å–æ¶ˆæ¯, æ¶ˆæ¯æœ‰åº, é€šè¿‡æ§åˆ¶èƒ½å¤Ÿä¿è¯æ‰€æœ‰æ¶ˆæ¯è¢«æ¶ˆè´¹ä¸”ä»…è¢«æ¶ˆè´¹ä¸€æ¬¡;æœ‰ä¼˜ç§€çš„ç¬¬ä¸‰æ–¹ Kafka Web ç®¡ç†ç•Œé¢ Kafka-Managerï¼›åœ¨æ—¥å¿—é¢†åŸŸæ¯”è¾ƒæˆç†Ÿï¼Œè¢«å¤šå®¶å…¬å¸å’Œå¤šä¸ªå¼€æºé¡¹ç›®ä½¿ç”¨ï¼›åŠŸèƒ½æ”¯æŒï¼š åŠŸèƒ½è¾ƒä¸ºç®€å•ï¼Œä¸»è¦æ”¯æŒç®€å•çš„ MQ åŠŸèƒ½ï¼Œåœ¨å¤§æ•°æ®é¢†åŸŸçš„å®æ—¶è®¡ç®—ä»¥åŠæ—¥å¿—é‡‡é›†è¢«å¤§è§„æ¨¡ä½¿ç”¨ã€‚</p>
<p>ç¼ºç‚¹ï¼šKafka å•æœºè¶…è¿‡ 64 ä¸ªé˜Ÿåˆ—&#x2F;åˆ†åŒºï¼ŒLoad ä¼šå‘ç”Ÿæ˜æ˜¾çš„é£™é«˜ç°è±¡ï¼Œé˜Ÿåˆ—è¶Šå¤šï¼Œload è¶Šé«˜ï¼Œå‘é€æ¶ˆæ¯å“åº”æ—¶é—´å˜é•¿ï¼Œä½¿ç”¨çŸ­è½®è¯¢æ–¹å¼ï¼Œå®æ—¶æ€§å–å†³äºè½®è¯¢é—´éš”æ—¶é—´ï¼Œæ¶ˆè´¹å¤±è´¥ä¸æ”¯æŒé‡è¯•ï¼›æ”¯æŒæ¶ˆæ¯é¡ºåºï¼Œ ä½†æ˜¯ä¸€å°ä»£ç†å®•æœºåï¼Œå°±ä¼šäº§ç”Ÿæ¶ˆæ¯ä¹±åºï¼Œç¤¾åŒºæ›´æ–°è¾ƒæ…¢ï¼›</p>
<h3 id="RocketMQ"><a href="#RocketMQ" class="headerlink" title="RocketMQ"></a>RocketMQ</h3><p>â€‹		RocketMQ å‡ºè‡ªé˜¿é‡Œå·´å·´çš„å¼€æºäº§å“ï¼Œç”¨ Java è¯­è¨€å®ç°ï¼Œåœ¨è®¾è®¡æ—¶å‚è€ƒäº† Kafkaï¼Œå¹¶åšå‡ºäº†è‡ªå·±çš„ä¸€ äº›æ”¹è¿›ã€‚è¢«é˜¿é‡Œå·´å·´å¹¿æ³›åº”ç”¨åœ¨è®¢å•ï¼Œäº¤æ˜“ï¼Œå……å€¼ï¼Œæµè®¡ç®—ï¼Œæ¶ˆæ¯æ¨é€ï¼Œæ—¥å¿—æµå¼å¤„ç†ï¼Œbinglog åˆ†å‘ç­‰åœº æ™¯ã€‚</p>
<p>ç¼ºç‚¹ï¼šæ”¯æŒçš„å®¢æˆ·ç«¯è¯­è¨€ä¸å¤šï¼Œç›®å‰æ˜¯ java åŠ c++ï¼Œå…¶ä¸­ c++ä¸æˆç†Ÿï¼›ç¤¾åŒºæ´»è·ƒåº¦ä¸€èˆ¬ï¼Œæ²¡æœ‰åœ¨ MQ æ ¸å¿ƒä¸­å»å®ç° JMS ç­‰æ¥å£ï¼Œæœ‰äº›ç³»ç»Ÿè¦è¿ç§»éœ€è¦ä¿®æ”¹å¤§é‡ä»£ç ã€‚</p>
<h3 id="RabbitMQ-1"><a href="#RabbitMQ-1" class="headerlink" title="RabbitMQ"></a>RabbitMQ</h3><p>â€‹		2007 å¹´å‘å¸ƒï¼Œæ˜¯ä¸€ä¸ªåœ¨ AMQPï¼ˆé«˜çº§æ¶ˆæ¯é˜Ÿåˆ—åè®®ï¼‰åŸºç¡€ä¸Šå®Œæˆçš„ï¼Œå¯å¤ç”¨çš„ä¼ä¸šæ¶ˆæ¯ç³»ç»Ÿï¼Œæ˜¯å½“å‰æœ€ä¸»æµçš„æ¶ˆæ¯ä¸­é—´ä»¶ä¹‹ä¸€ã€‚ </p>
<p>ä¼˜ç‚¹ï¼šç”±äº erlang è¯­è¨€çš„é«˜å¹¶å‘ç‰¹æ€§ï¼Œæ€§èƒ½è¾ƒå¥½ï¼›ååé‡åˆ°ä¸‡çº§ï¼ŒMQ åŠŸèƒ½æ¯”è¾ƒå®Œå¤‡,å¥å£®ã€ç¨³å®šã€æ˜“ ç”¨ã€è·¨å¹³å°ã€æ”¯æŒå¤šç§è¯­è¨€ å¦‚ï¼šPythonã€Rubyã€.NETã€Javaã€JMSã€Cã€PHPã€ActionScriptã€XMPPã€STOMP ç­‰ï¼Œæ”¯æŒ AJAX æ–‡æ¡£é½å…¨ï¼›å¼€æºæä¾›çš„ç®¡ç†ç•Œé¢éå¸¸æ£’ï¼Œç”¨èµ·æ¥å¾ˆå¥½ç”¨,ç¤¾åŒºæ´»è·ƒåº¦é«˜ï¼›æ›´æ–°é¢‘ç‡ç›¸å½“é«˜ã€‚</p>
<p>ç¼ºç‚¹ï¼šå•†ä¸šç‰ˆéœ€è¦æ”¶è´¹ï¼Œå­¦ä¹ æˆæœ¬è¾ƒé«˜</p>
<h2 id="MQ-çš„é€‰æ‹©"><a href="#MQ-çš„é€‰æ‹©" class="headerlink" title="MQ çš„é€‰æ‹©"></a>MQ çš„é€‰æ‹©</h2><h3 id="Kafka-1"><a href="#Kafka-1" class="headerlink" title="Kafka"></a>Kafka</h3><p>â€‹		Kafka ä¸»è¦ç‰¹ç‚¹æ˜¯åŸºäº Pull çš„æ¨¡å¼æ¥å¤„ç†æ¶ˆæ¯æ¶ˆè´¹ï¼Œè¿½æ±‚é«˜ååé‡ï¼Œä¸€å¼€å§‹çš„ç›®çš„å°±æ˜¯ç”¨äºæ—¥å¿—æ”¶é›† å’Œä¼ è¾“ï¼Œé€‚åˆäº§ç”Ÿå¤§é‡æ•°æ®çš„äº’è”ç½‘æœåŠ¡çš„æ•°æ®æ”¶é›†ä¸šåŠ¡ã€‚å¤§å‹å…¬å¸å»ºè®®å¯ä»¥é€‰ç”¨ï¼Œå¦‚æœæœ‰æ—¥å¿—é‡‡é›†åŠŸèƒ½ï¼Œ è‚¯å®šæ˜¯é¦–é€‰ kafka äº†ã€‚</p>
<h3 id="RocketMQ-1"><a href="#RocketMQ-1" class="headerlink" title="RocketMQ"></a>RocketMQ</h3><p>â€‹		å¤©ç”Ÿä¸ºé‡‘èäº’è”ç½‘é¢†åŸŸè€Œç”Ÿï¼Œå¯¹äºå¯é æ€§è¦æ±‚å¾ˆé«˜çš„åœºæ™¯ï¼Œå°¤å…¶æ˜¯ç”µå•†é‡Œé¢çš„è®¢å•æ‰£æ¬¾ï¼Œä»¥åŠä¸šåŠ¡å‰Šå³°ï¼Œåœ¨å¤§é‡äº¤æ˜“æ¶Œå…¥æ—¶ï¼Œåç«¯å¯èƒ½æ— æ³•åŠæ—¶å¤„ç†çš„æƒ…å†µã€‚RoketMQ åœ¨ç¨³å®šæ€§ä¸Šå¯èƒ½æ›´å€¼å¾—ä¿¡èµ–ï¼Œè¿™äº›ä¸šåŠ¡åœºæ™¯åœ¨é˜¿é‡ŒåŒ 11 å·²ç»ç»å†äº†å¤šæ¬¡è€ƒéªŒï¼Œå¦‚æœä½ çš„ä¸šåŠ¡æœ‰ä¸Šè¿°å¹¶å‘åœºæ™¯ï¼Œå»ºè®®å¯ä»¥é€‰æ‹© RocketMQã€‚</p>
<h3 id="RabbitMQ-2"><a href="#RabbitMQ-2" class="headerlink" title="RabbitMQ"></a>RabbitMQ</h3><p>â€‹		ç»“åˆ erlang è¯­è¨€æœ¬èº«çš„å¹¶å‘ä¼˜åŠ¿ï¼Œæ€§èƒ½å¥½æ—¶æ•ˆæ€§å¾®ç§’çº§ï¼Œç¤¾åŒºæ´»è·ƒåº¦ä¹Ÿæ¯”è¾ƒé«˜ï¼Œç®¡ç†ç•Œé¢ç”¨èµ·æ¥ååˆ†æ–¹ä¾¿ï¼Œå¦‚æœä½ çš„æ•°æ®é‡æ²¡æœ‰é‚£ä¹ˆå¤§ï¼Œä¸­å°å‹å…¬å¸ä¼˜å…ˆé€‰æ‹©åŠŸèƒ½æ¯”è¾ƒå®Œå¤‡çš„ RabbitMQã€‚</p>
<h2 id="RabbitMQ-3"><a href="#RabbitMQ-3" class="headerlink" title="RabbitMQ"></a>RabbitMQ</h2><p>åœ°å€ï¼š<a href="https://www.rabbitmq.com/">https://www.rabbitmq.com</a></p>
<h3 id="å››å¤§æ ¸å¿ƒæ¦‚å¿µ"><a href="#å››å¤§æ ¸å¿ƒæ¦‚å¿µ" class="headerlink" title="å››å¤§æ ¸å¿ƒæ¦‚å¿µ"></a>å››å¤§æ ¸å¿ƒæ¦‚å¿µ</h3><h4 id="ç”Ÿäº§è€…"><a href="#ç”Ÿäº§è€…" class="headerlink" title="ç”Ÿäº§è€…"></a>ç”Ÿäº§è€…</h4><p>â€‹		äº§ç”Ÿæ•°æ®å‘é€æ¶ˆæ¯çš„ç¨‹åºæ˜¯ç”Ÿäº§è€…</p>
<h4 id="äº¤æ¢æœº"><a href="#äº¤æ¢æœº" class="headerlink" title="äº¤æ¢æœº"></a>äº¤æ¢æœº</h4><p>â€‹		äº¤æ¢æœºæ˜¯ RabbitMQ éå¸¸é‡è¦çš„ä¸€ä¸ªéƒ¨ä»¶ï¼Œä¸€æ–¹é¢å®ƒæ¥æ”¶æ¥è‡ªç”Ÿäº§è€…çš„æ¶ˆæ¯ï¼Œå¦ä¸€æ–¹é¢å®ƒå°†æ¶ˆæ¯æ¨é€åˆ°é˜Ÿåˆ—ä¸­ã€‚äº¤æ¢æœºå¿…é¡»ç¡®åˆ‡çŸ¥é“å¦‚ä½•å¤„ç†å®ƒæ¥æ”¶åˆ°çš„æ¶ˆæ¯ï¼Œæ˜¯å°†è¿™äº›æ¶ˆæ¯æ¨é€åˆ°ç‰¹å®šé˜Ÿåˆ—è¿˜æ˜¯æ¨é€åˆ°å¤šä¸ªé˜Ÿåˆ—ï¼Œäº¦æˆ–è€…æ˜¯æŠŠæ¶ˆæ¯ä¸¢å¼ƒï¼Œè¿™ä¸ªå¾—æœ‰äº¤æ¢æœºç±»å‹å†³å®šã€‚</p>
<h4 id="é˜Ÿåˆ—"><a href="#é˜Ÿåˆ—" class="headerlink" title="é˜Ÿåˆ—"></a>é˜Ÿåˆ—</h4><p>â€‹		é˜Ÿåˆ—æ˜¯ RabbitMQ å†…éƒ¨ä½¿ç”¨çš„ä¸€ç§æ•°æ®ç»“æ„ï¼Œå°½ç®¡æ¶ˆæ¯æµç» RabbitMQ å’Œåº”ç”¨ç¨‹åºï¼Œä½†å®ƒä»¬åªèƒ½å­˜å‚¨åœ¨é˜Ÿåˆ—ä¸­ã€‚é˜Ÿåˆ—ä»…å—ä¸»æœºçš„å†…å­˜å’Œç£ç›˜é™åˆ¶çš„çº¦æŸï¼Œ<strong>æœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªå¤§çš„æ¶ˆæ¯ç¼“å†²åŒº</strong>ã€‚è®¸å¤šç”Ÿäº§è€…å¯ ä»¥å°†æ¶ˆæ¯å‘é€åˆ°ä¸€ä¸ªé˜Ÿåˆ—ï¼Œè®¸å¤šæ¶ˆè´¹è€…å¯ä»¥å°è¯•ä»ä¸€ä¸ªé˜Ÿåˆ—æ¥æ”¶æ•°æ®ã€‚</p>
<h4 id="æ¶ˆè´¹è€…"><a href="#æ¶ˆè´¹è€…" class="headerlink" title="æ¶ˆè´¹è€…"></a>æ¶ˆè´¹è€…</h4><p>â€‹		æ¶ˆè´¹ä¸æ¥æ”¶å…·æœ‰ç›¸ä¼¼çš„å«ä¹‰ã€‚æ¶ˆè´¹è€…å¤§å¤šæ—¶å€™æ˜¯ä¸€ä¸ªç­‰å¾…æ¥æ”¶æ¶ˆæ¯çš„ç¨‹åºã€‚è¯·æ³¨æ„ç”Ÿäº§è€…ï¼Œæ¶ˆè´¹è€…å’Œæ¶ˆæ¯ä¸­é—´ä»¶å¾ˆå¤šæ—¶å€™å¹¶ä¸åœ¨åŒä¸€æœºå™¨ä¸Šã€‚åŒä¸€ä¸ªåº”ç”¨ç¨‹åºæ—¢å¯ä»¥æ˜¯ç”Ÿäº§è€…åˆæ˜¯å¯ä»¥æ˜¯æ¶ˆè´¹è€…ã€‚</p>
<h3 id="RabbitMQ-æ ¸å¿ƒéƒ¨åˆ†"><a href="#RabbitMQ-æ ¸å¿ƒéƒ¨åˆ†" class="headerlink" title="RabbitMQ æ ¸å¿ƒéƒ¨åˆ†"></a>RabbitMQ æ ¸å¿ƒéƒ¨åˆ†</h3><p><img src="/2023/02/28/RabbitMQ/Java\RabbitMQ\RabbitMQ.assets\image-20221014144642167.png" alt="image-20221014144642167"></p>
<h3 id="å„ä¸ªåè¯ä»‹ç»"><a href="#å„ä¸ªåè¯ä»‹ç»" class="headerlink" title="å„ä¸ªåè¯ä»‹ç»"></a>å„ä¸ªåè¯ä»‹ç»</h3><img src="/2023/02/28/RabbitMQ/Java\RabbitMQ\RabbitMQ.assets\image-20221014144657597.png" alt="image-20221014144657597" style="zoom:80%;">

<ul>
<li>Brokerï¼šæ¥æ”¶å’Œåˆ†å‘æ¶ˆæ¯çš„åº”ç”¨ï¼ŒRabbitMQ Server å°±æ˜¯ Message Brokerã€‚</li>
<li>Virtual hostï¼šå‡ºäºå¤šç§Ÿæˆ·å’Œå®‰å…¨å› ç´ è®¾è®¡çš„ï¼ŒæŠŠ AMQP çš„åŸºæœ¬ç»„ä»¶åˆ’åˆ†åˆ°ä¸€ä¸ªè™šæ‹Ÿçš„åˆ†ç»„ä¸­ï¼Œç±»ä¼¼äºç½‘ç»œä¸­çš„ namespace æ¦‚å¿µã€‚å½“å¤šä¸ªä¸åŒçš„ç”¨æˆ·ä½¿ç”¨åŒä¸€ä¸ª RabbitMQ server æä¾›çš„æœåŠ¡æ—¶ï¼Œå¯ä»¥åˆ’åˆ†å‡ºå¤šä¸ª vhostï¼Œæ¯ä¸ªç”¨æˆ·åœ¨è‡ªå·±çš„ vhost åˆ›å»º exchangeï¼queue ç­‰ã€‚</li>
<li>Connectionï¼špublisherï¼consumer å’Œ broker ä¹‹é—´çš„ TCP è¿æ¥ Channelï¼šå¦‚æœæ¯ä¸€æ¬¡è®¿é—® RabbitMQ éƒ½å»ºç«‹ä¸€ä¸ª Connectionï¼Œåœ¨æ¶ˆæ¯é‡å¤§çš„æ—¶å€™å»ºç«‹ TCP Connection çš„å¼€é”€å°†æ˜¯å·¨å¤§çš„ï¼Œæ•ˆç‡ä¹Ÿè¾ƒä½ã€‚Channel æ˜¯åœ¨ connection å†…éƒ¨å»ºç«‹çš„é€»è¾‘è¿æ¥ï¼Œå¦‚æœåº”ç”¨ç¨‹åºæ”¯æŒå¤šçº¿ç¨‹ï¼Œé€šå¸¸æ¯ä¸ª thread åˆ›å»ºå•ç‹¬çš„ channel è¿›è¡Œé€šè®¯ï¼Œ<strong>AMQP method åŒ…å«äº† channel id å¸®åŠ©å®¢ æˆ·ç«¯å’Œ message broker è¯†åˆ« channel</strong>ï¼Œæ‰€ä»¥ channel ä¹‹é—´æ˜¯å®Œå…¨éš”ç¦»çš„ã€‚Channel ä½œä¸ºè½»é‡çº§çš„ Connection æå¤§å‡å°‘äº†æ“ä½œç³»ç»Ÿå»ºç«‹ TCP connection çš„å¼€é”€ã€‚</li>
<li>Exchangeï¼šmessage åˆ°è¾¾ broker çš„ç¬¬ä¸€ç«™ï¼Œæ ¹æ®åˆ†å‘è§„åˆ™ï¼ŒåŒ¹é…æŸ¥è¯¢è¡¨ä¸­çš„ routing keyï¼Œåˆ†å‘æ¶ˆæ¯åˆ° queue ä¸­å»ã€‚å¸¸ç”¨çš„ç±»å‹æœ‰ï¼šdirect (point-to-point), topic (publish-subscribe) and fanout (multicast) </li>
<li>Queueï¼šæ¶ˆæ¯æœ€ç»ˆè¢«é€åˆ°è¿™é‡Œç­‰å¾… consumer å–èµ°ã€‚</li>
<li>Bindingï¼šexchange å’Œ queue ä¹‹é—´çš„è™šæ‹Ÿè¿æ¥ï¼Œbinding ä¸­å¯ä»¥åŒ…å« routing keyï¼ŒBinding ä¿¡æ¯è¢«ä¿å­˜åˆ° exchange ä¸­çš„æŸ¥è¯¢è¡¨ä¸­ï¼Œç”¨äº message çš„åˆ†å‘ä¾æ®ã€‚</li>
</ul>
<h3 id="å®‰è£…åŠå¯åŠ¨"><a href="#å®‰è£…åŠå¯åŠ¨" class="headerlink" title="å®‰è£…åŠå¯åŠ¨"></a>å®‰è£…åŠå¯åŠ¨</h3><p>ä¸‹è½½åœ°å€ï¼š<a href="https://www.rabbitmq.com/download.html">https://www.rabbitmq.com/download.html</a></p>
<p>ä»¥ rabbitmq-server-3.8.8-1.el7.noarch.rpm ã€ erlang-21.3-1.el7.x86_64.rpm ä¸ºä¾‹ï¼š</p>
<h4 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h4><p>ä¸Šä¼ è‡³ &#x2F;usr&#x2F;local&#x2F;src ç›®å½•ä¸‹ï¼Œé€šè¿‡ rpm å®‰è£…ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@localhost ~]# cd /usr/local/src/</span><br><span class="line">[root@localhost src]# ls</span><br><span class="line">erlang-21.3-1.el7.x86_64.rpm rabbitmq-server-3.8.8-1.el7.noarch.rpm</span><br><span class="line">    </span><br><span class="line">[root@localhost src]# rpm -ivh erlang-21.3-1.el7.x86_64.rpm</span><br><span class="line"></span><br><span class="line">[root@localhost src]# yum install socat -y</span><br><span class="line"></span><br><span class="line">[root@localhost src]# rpm -ivh rabbitmq-server-3.8.8-1.el7.noarch.rpm</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>å¼€æœºè‡ªå¯åŠ¨</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@localhost src]# chkconfig rabbitmq-server on</span><br></pre></td></tr></table></figure>

<p>å¯åŠ¨æœåŠ¡</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@localhost src]# /sbin/service rabbitmq-server start</span><br></pre></td></tr></table></figure>

<p>æŸ¥çœ‹æœåŠ¡çŠ¶æ€</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@localhost src]# /sbin/service rabbitmq-server status</span><br></pre></td></tr></table></figure>

<p>åœæ­¢æœåŠ¡</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@localhost src]# /sbin/service rabbitmq-server stop </span><br></pre></td></tr></table></figure>

<p>å¼€å¯ web ç®¡ç†æ’ä»¶</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@localhost src]# rabbitmq-plugins enable rabbitmq_management</span><br></pre></td></tr></table></figure>

<p>å…³é—­é˜²ç«å¢™ï¼Œä½¿ç”¨é»˜è®¤è´¦å·ï¼ˆguestï¼‰ï¼Œå¯†ç ï¼ˆguestï¼‰ç™»å½•ï¼š192.168.100.100:15672</p>
<img src="/2023/02/28/RabbitMQ/Java\RabbitMQ\RabbitMQ.assets\image-20221014150804190.png" alt="image-20221014150804190" style="zoom:80%;">

<p>å‡ºç°æƒé™é—®é¢˜ï¼š</p>
<p>â€‹		ç”¨æˆ·åªèƒ½é€šè¿‡æœ¬åœ°ä¸»æœºç™»å½•ã€‚</p>
<h4 id="æ·»åŠ ç”¨æˆ·"><a href="#æ·»åŠ ç”¨æˆ·" class="headerlink" title="æ·»åŠ ç”¨æˆ·"></a>æ·»åŠ ç”¨æˆ·</h4><p>åˆ›å»ºè´¦å·</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@localhost src]# rabbitmqctl add_user admin admin</span><br></pre></td></tr></table></figure>

<p>è®¾ç½®ç”¨æˆ·è§’è‰²</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@localhost src]# rabbitmqctl set_user_tags admin administrator </span><br></pre></td></tr></table></figure>

<p>è®¾ç½®ç”¨æˆ·æƒé™</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">set_permissions [-p &lt;vhostpath&gt;] &lt;user&gt; &lt;conf&gt; &lt;write&gt; &lt;<span class="built_in">read</span>&gt;</span></span><br><span class="line">[root@localhost src]# rabbitmqctl set_permissions -p &quot;/&quot; admin &quot;.*&quot; &quot;.*&quot; &quot;.*&quot; </span><br></pre></td></tr></table></figure>

<p>ç”¨æˆ· user_admin å…·æœ‰ &#x2F;vhost1 è¿™ä¸ª virtual host ä¸­æ‰€æœ‰èµ„æºçš„é…ç½®ã€å†™ã€è¯»æƒé™ </p>
<p>å½“å‰ç”¨æˆ·å’Œè§’è‰²</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@localhost src]# rabbitmqctl list_users</span><br></pre></td></tr></table></figure>

<p>å†æ¬¡åˆ©ç”¨ admin ç”¨æˆ·ç™»å½•ï¼š</p>
<p><img src="/2023/02/28/RabbitMQ/Java\RabbitMQ\RabbitMQ.assets\image-20221014151648674.png" alt="image-20221014151648674"></p>
<h4 id="é‡ç½®å‘½ä»¤"><a href="#é‡ç½®å‘½ä»¤" class="headerlink" title="é‡ç½®å‘½ä»¤"></a>é‡ç½®å‘½ä»¤</h4><p>å…³é—­åº”ç”¨çš„å‘½ä»¤</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">rabbitmqctl stop_app</span><br></pre></td></tr></table></figure>

<p>æ¸…é™¤çš„å‘½ä»¤</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">rabbitmqctl reset</span><br></pre></td></tr></table></figure>

<p>é‡æ–°å¯åŠ¨å‘½ä»¤</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">rabbitmqctl start_app</span><br></pre></td></tr></table></figure>

<h1 id="ç®€å•ç¤ºä¾‹"><a href="#ç®€å•ç¤ºä¾‹" class="headerlink" title="ç®€å•ç¤ºä¾‹"></a>ç®€å•ç¤ºä¾‹</h1><h2 id="HelloWorld"><a href="#HelloWorld" class="headerlink" title="HelloWorld"></a>HelloWorld</h2><p>å¼•å…¥ä¾èµ–ï¼š</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.rabbitmq<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>amqp-client<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.8.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>commons-io<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>commons-io<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.6<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.maven.plugins<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-compiler-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">source</span>&gt;</span>8<span class="tag">&lt;/<span class="name">source</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">target</span>&gt;</span>8<span class="tag">&lt;/<span class="name">target</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>è¿æ¥ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.rabbitmq.util;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.rabbitmq.client.Channel;</span><br><span class="line"><span class="keyword">import</span> com.rabbitmq.client.Connection;</span><br><span class="line"><span class="keyword">import</span> com.rabbitmq.client.ConnectionFactory;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RabbitConnectUtil</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Channel <span class="title function_">getChannel</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">ConnectionFactory</span> <span class="variable">factory</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ConnectionFactory</span>();</span><br><span class="line">        factory.setHost(<span class="string">&quot;192.168.100.100&quot;</span>);</span><br><span class="line">        factory.setUsername(<span class="string">&quot;admin&quot;</span>);</span><br><span class="line">        factory.setPassword(<span class="string">&quot;admin&quot;</span>);</span><br><span class="line">        <span class="type">Connection</span> <span class="variable">connection</span> <span class="operator">=</span> factory.newConnection();</span><br><span class="line">        <span class="keyword">return</span> connection.createChannel();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç”Ÿäº§è€…ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.rabbitmq.demo;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.example.rabbitmq.util.RabbitConnectUtil;</span><br><span class="line"><span class="keyword">import</span> com.rabbitmq.client.Channel;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Producer</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">QUEUE_NAME</span> <span class="operator">=</span> <span class="string">&quot;demo&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">Channel</span> <span class="variable">channel</span> <span class="operator">=</span> RabbitConnectUtil.getChannel();</span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * ç”Ÿæˆä¸€ä¸ªé˜Ÿåˆ—</span></span><br><span class="line"><span class="comment">         * 1. é˜Ÿåˆ—åç§°</span></span><br><span class="line"><span class="comment">         * 2. é˜Ÿåˆ—é‡Œé¢çš„æ¶ˆæ¯æ˜¯å¦æŒä¹…åŒ–ï¼Œé»˜è®¤æ¶ˆæ¯å­˜å‚¨åœ¨å†…å­˜ä¸­</span></span><br><span class="line"><span class="comment">         * 3. è¯¥é˜Ÿåˆ—æ˜¯å¦åªä¾›ä¸€ä¸ªæ¶ˆè´¹è€…è¿›è¡Œæ¶ˆè´¹ï¼Œæ˜¯å¦è¿›è¡Œå…±äº«ï¼Œé»˜è®¤trueï¼Œå¯ä»¥å¤šä¸ªæ¶ˆè´¹è€…æ¶ˆè´¹</span></span><br><span class="line"><span class="comment">         * 4. æ˜¯å¦è‡ªåŠ¨åˆ é™¤ï¼šæœ€åä¸€ä¸ªæ¶ˆè´¹è€…ç«¯å¼€è¿æ¥ä»¥åï¼Œè¯¥é˜Ÿåˆ—æ˜¯å¦è‡ªåŠ¨åˆ é™¤ï¼Œtrueï¼šè‡ªåŠ¨åˆ é™¤</span></span><br><span class="line"><span class="comment">         * 5. å…¶ä»–å‚æ•°</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        channel.queueDeclare(QUEUE_NAME, <span class="literal">false</span>, <span class="literal">false</span>, <span class="literal">false</span>, <span class="literal">null</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">message</span> <span class="operator">=</span> <span class="string">&quot;Hello RabbitMQ&quot;</span>;</span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * å‘é€æ¶ˆæ¯</span></span><br><span class="line"><span class="comment">         * 1. å‘é€åˆ°é‚£ä¸ªäº¤æ¢æœº</span></span><br><span class="line"><span class="comment">         * 2. è·¯ç”±çš„ key</span></span><br><span class="line"><span class="comment">         * 3. å…¶ä»–çš„å‚æ•°ä¿¡æ¯</span></span><br><span class="line"><span class="comment">         * 4. å‘é€æ¶ˆæ¯çš„æ¶ˆæ¯ä½“</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        channel.basicPublish(<span class="string">&quot;&quot;</span>, QUEUE_NAME, <span class="literal">null</span>, message.getBytes());</span><br><span class="line">        System.out.println(<span class="string">&quot;æ¶ˆæ¯å‘é€å®Œæ¯•...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ¶ˆè´¹è€…ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.rabbitmq.demo;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.example.rabbitmq.util.RabbitConnectUtil;</span><br><span class="line"><span class="keyword">import</span> com.rabbitmq.client.CancelCallback;</span><br><span class="line"><span class="keyword">import</span> com.rabbitmq.client.Channel;</span><br><span class="line"><span class="keyword">import</span> com.rabbitmq.client.DeliverCallback;</span><br><span class="line"><span class="keyword">import</span> com.rabbitmq.client.Delivery;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Consumer</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">QUEUE_NAME</span> <span class="operator">=</span> <span class="string">&quot;demo&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">Channel</span> <span class="variable">channel</span> <span class="operator">=</span> RabbitConnectUtil.getChannel();</span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * æ¶ˆè´¹è€…æ¶ˆè´¹æ¶ˆæ¯</span></span><br><span class="line"><span class="comment">         * 1.æ¶ˆè´¹å“ªä¸ªé˜Ÿåˆ—</span></span><br><span class="line"><span class="comment">         * 2.æ¶ˆè´¹æˆåŠŸä¹‹åæ˜¯å¦è¦è‡ªåŠ¨åº”ç­” true ä»£è¡¨è‡ªåŠ¨åº”ç­” false æ‰‹åŠ¨åº”ç­”</span></span><br><span class="line"><span class="comment">         * 3.æ¶ˆè´¹è€…æœªæˆåŠŸæ¶ˆè´¹çš„å›è°ƒ</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        channel.basicConsume(</span><br><span class="line">                QUEUE_NAME,</span><br><span class="line">                <span class="literal">true</span>,</span><br><span class="line">                <span class="comment">// æ¨é€çš„æ¶ˆæ¯è¿›è¡Œæ¶ˆè´¹çš„å›è°ƒ</span></span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">DeliverCallback</span>() &#123;</span><br><span class="line">                    <span class="meta">@Override</span></span><br><span class="line">                    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">handle</span><span class="params">(String s, Delivery delivery)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">                        System.out.println(<span class="keyword">new</span> <span class="title class_">String</span>(delivery.getBody()));</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;,</span><br><span class="line">                <span class="comment">// å–æ¶ˆæ¶ˆè´¹çš„å›è°ƒ</span></span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">CancelCallback</span>() &#123;</span><br><span class="line">                    <span class="meta">@Override</span></span><br><span class="line">                    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">handle</span><span class="params">(String s)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">                        System.out.println(<span class="string">&quot;æ¶ˆæ¯æ¶ˆè´¹è¢«ä¸­æ–­&quot;</span>);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æµ‹è¯•ï¼š</p>
<p>â€‹		å…ˆå¯åŠ¨ç”Ÿäº§è€…ï¼Œåœ¨å¯åŠ¨æ¶ˆè´¹è€…ã€‚</p>
<h2 id="Work-Queues"><a href="#Work-Queues" class="headerlink" title="Work Queues"></a>Work Queues</h2><p>â€‹		å·¥ä½œé˜Ÿåˆ—ï¼ˆåˆç§°ä»»åŠ¡é˜Ÿåˆ—ï¼‰ä¸»è¦æ€æƒ³ï¼š<strong>é¿å…ç«‹å³æ‰§è¡Œèµ„æºå¯†é›†å‹ä»»åŠ¡ï¼Œè€Œä¸å¾—ä¸ç­‰å¾…å®ƒå®Œæˆã€‚</strong> ç›¸åæˆ‘ä»¬å®‰æ’ä»»åŠ¡åœ¨ä¹‹åæ‰§è¡Œã€‚æˆ‘ä»¬æŠŠä»»åŠ¡å°è£…ä¸ºæ¶ˆæ¯å¹¶å°†å…¶å‘é€åˆ°é˜Ÿåˆ—ã€‚åœ¨åå°è¿è¡Œçš„å·¥ä½œè¿› ç¨‹å°†å¼¹å‡ºä»»åŠ¡å¹¶æœ€ç»ˆæ‰§è¡Œä½œä¸šã€‚å½“æœ‰å¤šä¸ªå·¥ä½œçº¿ç¨‹æ—¶ï¼Œè¿™äº›å·¥ä½œçº¿ç¨‹å°†ä¸€èµ·å¤„ç†è¿™äº›ä»»åŠ¡ã€‚</p>
<h3 id="è½®è®­åˆ†å‘æ¶ˆæ¯"><a href="#è½®è®­åˆ†å‘æ¶ˆæ¯" class="headerlink" title="è½®è®­åˆ†å‘æ¶ˆæ¯"></a>è½®è®­åˆ†å‘æ¶ˆæ¯</h3><p>â€‹		å¯åŠ¨ä¸¤ä¸ªæ¶ˆè´¹è€…ï¼Œä¸€ä¸ªç”Ÿäº§è€…ï¼Œä¼šå‘ç°å¯¹äºç”Ÿäº§çš„æ¶ˆæ¯ä¼šè½®è¯¢ä¾æ¬¡è¿›è¡Œæ¶ˆè´¹ã€‚</p>
<p>ç”Ÿäº§è€…ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.rabbitmq.workqueue;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.example.rabbitmq.util.RabbitConnectUtil;</span><br><span class="line"><span class="keyword">import</span> com.rabbitmq.client.Channel;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Scanner;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Producer</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">QUEUE_NAME</span> <span class="operator">=</span> <span class="string">&quot;demo&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">Channel</span> <span class="variable">channel</span> <span class="operator">=</span> RabbitConnectUtil.getChannel();</span><br><span class="line">        channel.queueDeclare(QUEUE_NAME, <span class="literal">false</span>, <span class="literal">false</span>, <span class="literal">false</span>, <span class="literal">null</span>);</span><br><span class="line">        <span class="type">Scanner</span> <span class="variable">sc</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Scanner</span>(System.in);</span><br><span class="line">        <span class="keyword">while</span> (sc.hasNext()) &#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">message</span> <span class="operator">=</span> sc.nextLine();</span><br><span class="line">            channel.basicPublish(<span class="string">&quot;&quot;</span>, QUEUE_NAME, <span class="literal">null</span>, message.getBytes());</span><br><span class="line">            System.out.println(<span class="string">&quot;æ¶ˆæ¯å‘é€å®Œæˆï¼š&quot;</span> + message);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ¶ˆè´¹è€…ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.rabbitmq.workqueue;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.example.rabbitmq.util.RabbitConnectUtil;</span><br><span class="line"><span class="keyword">import</span> com.rabbitmq.client.CancelCallback;</span><br><span class="line"><span class="keyword">import</span> com.rabbitmq.client.Channel;</span><br><span class="line"><span class="keyword">import</span> com.rabbitmq.client.DeliverCallback;</span><br><span class="line"><span class="keyword">import</span> com.rabbitmq.client.Delivery;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Consumer</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">QUEUE_NAME</span> <span class="operator">=</span> <span class="string">&quot;demo&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">Channel</span> <span class="variable">channel</span> <span class="operator">=</span> RabbitConnectUtil.getChannel();</span><br><span class="line">        System.out.println(<span class="string">&quot;ç­‰å¾…æ¥å—æ¶ˆæ¯...&quot;</span>);</span><br><span class="line">        channel.basicConsume(QUEUE_NAME, <span class="literal">true</span>,</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">DeliverCallback</span>() &#123;</span><br><span class="line">                    <span class="meta">@Override</span></span><br><span class="line">                    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">handle</span><span class="params">(String s, Delivery delivery)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">                        System.out.println(<span class="string">&quot;Consumer æ”¶åˆ°æ¶ˆæ¯ï¼š&quot;</span> + </span><br><span class="line">                                           <span class="keyword">new</span> <span class="title class_">String</span>(delivery.getBody()));</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;,</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">CancelCallback</span>() &#123;</span><br><span class="line">                    <span class="meta">@Override</span></span><br><span class="line">                    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">handle</span><span class="params">(String s)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">                        System.out.println(s + <span class="string">&quot;æ¶ˆè´¹è€…å–æ¶ˆæ¶ˆè´¹æ¥å£å›è°ƒé€»è¾‘&quot;</span>);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">        );</span><br><span class="line">        System.out.println(<span class="string">&quot;Consumer01 ç­‰å¾…...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æµ‹è¯•ï¼š</p>
<p>ç”Ÿäº§è€…ä¾æ¬¡å‘é€ï¼šA	B	C	D</p>
<p>æ¶ˆè´¹è€…ä¸€æ”¶åˆ°ï¼šA	Cï¼Œæ¶ˆè´¹è€…äºŒæ”¶åˆ°ï¼šB	D</p>
<h3 id="æ¶ˆæ¯åº”ç­”"><a href="#æ¶ˆæ¯åº”ç­”" class="headerlink" title="æ¶ˆæ¯åº”ç­”"></a>æ¶ˆæ¯åº”ç­”</h3><p>â€‹		æ¶ˆè´¹è€…å®Œæˆä¸€ä¸ªä»»åŠ¡å¯èƒ½éœ€è¦ä¸€æ®µæ—¶é—´ï¼Œå¦‚æœå…¶ä¸­ä¸€ä¸ªæ¶ˆè´¹è€…å¤„ç†ä¸€ä¸ªé•¿çš„ä»»åŠ¡å¹¶ä»…åªå®Œæˆäº†éƒ¨åˆ†çªç„¶å®ƒæŒ‚æ‰äº†ï¼Œä¼šå‘ç”Ÿä»€ä¹ˆæƒ…å†µã€‚RabbitMQ ä¸€æ—¦å‘æ¶ˆè´¹è€…ä¼ é€’äº†ä¸€æ¡æ¶ˆæ¯ï¼Œä¾¿ç«‹å³å°†è¯¥æ¶ˆæ¯æ ‡è®°ä¸ºåˆ é™¤ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œçªç„¶æœ‰ä¸ªæ¶ˆè´¹è€…æŒ‚æ‰äº†ï¼Œæˆ‘ä»¬å°†ä¸¢å¤±æ­£åœ¨å¤„ç†çš„æ¶ˆæ¯ã€‚ä»¥åŠåç»­å‘é€ç»™è¯¥æ¶ˆè´¹è€…çš„æ¶ˆæ¯ï¼Œå› ä¸ºå®ƒæ— æ³•æ¥æ”¶åˆ°ã€‚</p>
<p>â€‹		ä¸ºäº†ä¿è¯æ¶ˆæ¯åœ¨å‘é€è¿‡ç¨‹ä¸­ä¸ä¸¢å¤±ï¼Œrabbitmq å¼•å…¥æ¶ˆæ¯åº”ç­”æœºåˆ¶ï¼Œæ¶ˆæ¯åº”ç­”å°±æ˜¯ï¼šæ¶ˆè´¹è€…åœ¨æ¥æ”¶åˆ°æ¶ˆæ¯å¹¶ä¸”å¤„ç†è¯¥æ¶ˆæ¯ä¹‹åï¼Œå‘Šè¯‰ rabbitmq å®ƒå·²ç»å¤„ç†äº†ï¼Œrabbitmq å¯ä»¥æŠŠè¯¥æ¶ˆæ¯åˆ é™¤äº†ã€‚</p>
<h4 id="è‡ªåŠ¨åº”ç­”"><a href="#è‡ªåŠ¨åº”ç­”" class="headerlink" title="è‡ªåŠ¨åº”ç­”"></a>è‡ªåŠ¨åº”ç­”</h4><p>â€‹		æ¶ˆæ¯å‘é€åç«‹å³è¢«è®¤ä¸ºå·²ç»ä¼ é€æˆåŠŸï¼Œè¿™ç§æ¨¡å¼éœ€è¦åœ¨é«˜ååé‡å’Œæ•°æ®ä¼ è¾“å®‰å…¨æ€§æ–¹é¢åšæƒ è¡¡,å› ä¸ºè¿™ç§æ¨¡å¼å¦‚æœæ¶ˆæ¯åœ¨æ¥æ”¶åˆ°ä¹‹å‰ï¼Œæ¶ˆè´¹è€…é‚£è¾¹å‡ºç°è¿æ¥æˆ–è€… channel å…³é—­ï¼Œé‚£ä¹ˆæ¶ˆæ¯å°±ä¸¢ å¤±äº†,å½“ç„¶å¦ä¸€æ–¹é¢è¿™ç§æ¨¡å¼æ¶ˆè´¹è€…é‚£è¾¹å¯ä»¥ä¼ é€’è¿‡è½½çš„æ¶ˆæ¯ï¼Œæ²¡æœ‰å¯¹ä¼ é€’çš„æ¶ˆæ¯æ•°é‡è¿›è¡Œé™åˆ¶ï¼Œ å½“ç„¶è¿™æ ·æœ‰å¯èƒ½ä½¿å¾—æ¶ˆè´¹è€…è¿™è¾¹ç”±äºæ¥æ”¶å¤ªå¤šè¿˜æ¥ä¸åŠå¤„ç†çš„æ¶ˆæ¯ï¼Œå¯¼è‡´è¿™äº›æ¶ˆæ¯çš„ç§¯å‹ï¼Œæœ€ç»ˆä½¿å¾—å†…å­˜è€—å°½ï¼Œæœ€ç»ˆè¿™äº›æ¶ˆè´¹è€…çº¿ç¨‹è¢«æ“ä½œç³»ç»Ÿæ€æ­»ï¼Œæ‰€ä»¥è¿™ç§æ¨¡å¼ä»…é€‚ç”¨åœ¨æ¶ˆè´¹è€…å¯ä»¥é«˜æ•ˆå¹¶ ä»¥æŸç§é€Ÿç‡èƒ½å¤Ÿå¤„ç†è¿™äº›æ¶ˆæ¯çš„æƒ…å†µä¸‹ä½¿ç”¨ã€‚</p>
<h4 id="æ¶ˆæ¯åº”ç­”çš„æ–¹æ³•"><a href="#æ¶ˆæ¯åº”ç­”çš„æ–¹æ³•" class="headerlink" title="æ¶ˆæ¯åº”ç­”çš„æ–¹æ³•"></a>æ¶ˆæ¯åº”ç­”çš„æ–¹æ³•</h4><ul>
<li>Channel.basicAckï¼ˆç”¨äºè‚¯å®šç¡®è®¤ï¼‰ï¼šRabbitMQ å·²çŸ¥é“è¯¥æ¶ˆæ¯å¹¶ä¸”æˆåŠŸçš„å¤„ç†æ¶ˆæ¯ï¼Œå¯ä»¥å°†å…¶ä¸¢å¼ƒäº†</li>
<li>Channel.basicNackï¼ˆç”¨äºå¦å®šç¡®è®¤ï¼‰ </li>
<li>Channel.basicRejectï¼ˆç”¨äºå¦å®šç¡®è®¤ï¼‰ï¼šä¸ Channel.basicNack ç›¸æ¯”å°‘ä¸€ä¸ªå‚æ•°ï¼Œç›´æ¥æ‹’ç»å¤„ç†æ”¹å‚æ•°ï¼Œå¯ä»¥ä¸¢å¼ƒ</li>
</ul>
<h4 id="Multiple"><a href="#Multiple" class="headerlink" title="Multiple"></a>Multiple</h4><p>â€‹		æ‰‹åŠ¨åº”ç­”çš„å¥½å¤„æ˜¯å¯ä»¥æ‰¹é‡åº”ç­”å¹¶ä¸”å‡å°‘ç½‘ç»œæ‹¥å µ ã€‚</p>
<p>multiple çš„ true å’Œ false ä»£è¡¨ä¸åŒæ„æ€ï¼š</p>
<p>trueï¼šä»£è¡¨æ‰¹é‡åº”ç­”channel ä¸Šæœªåº”ç­”çš„æ¶ˆæ¯ï¼Œæ¯”å¦‚è¯´ channel ä¸Šæœ‰ä¼ é€ tag çš„æ¶ˆæ¯ 5, 6, 7, 8 ï¼Œå½“å‰ tag æ˜¯ 8 ï¼Œé‚£ä¹ˆæ­¤æ—¶ 5-8 çš„è¿™äº›è¿˜æœªåº”ç­”çš„æ¶ˆæ¯éƒ½ä¼šè¢«ç¡®è®¤æ”¶åˆ°æ¶ˆæ¯åº”ç­”ã€‚</p>
<p>falseï¼šåŒä¸Šé¢ç›¸æ¯”åªä¼šåº”ç­” tag&#x3D;8 çš„æ¶ˆæ¯ 5, 6, 7 è¿™ä¸‰ä¸ªæ¶ˆæ¯ä¾ç„¶ä¸ä¼šè¢«ç¡®è®¤æ”¶åˆ°æ¶ˆæ¯åº”ç­”ã€‚</p>
<p><img src="/2023/02/28/RabbitMQ/Java\RabbitMQ\RabbitMQ.assets\image-20221014164805126.png" alt="image-20221014164805126"></p>
<p><strong>ä¸€èˆ¬é‡‡ç”¨ falseï¼Œä¿è¯æ•°æ®ä¸ä¼šä¸¢å¤±</strong>ï¼Œä»¥ä¸Šæ‰¹é‡å¯èƒ½ä¼šå¯¼è‡´ 5ï¼Œ6, 7ä¸¢å¤±ã€‚</p>
<h4 id="æ¶ˆæ¯è‡ªåŠ¨é‡æ–°å…¥é˜Ÿ"><a href="#æ¶ˆæ¯è‡ªåŠ¨é‡æ–°å…¥é˜Ÿ" class="headerlink" title="æ¶ˆæ¯è‡ªåŠ¨é‡æ–°å…¥é˜Ÿ"></a>æ¶ˆæ¯è‡ªåŠ¨é‡æ–°å…¥é˜Ÿ</h4><p>â€‹		å¦‚æœæ¶ˆè´¹è€…ç”±äºæŸäº›åŸå› å¤±å»è¿æ¥ï¼ˆå…¶é€šé“å·²å…³é—­ï¼Œè¿æ¥å·²å…³é—­æˆ– TCP è¿æ¥ä¸¢å¤±ï¼‰ï¼Œå¯¼è‡´æ¶ˆæ¯ æœªå‘é€ ACK ç¡®è®¤ï¼ŒRabbitMQ å°†äº†è§£åˆ°æ¶ˆæ¯æœªå®Œå…¨å¤„ç†ï¼Œå¹¶å°†å¯¹å…¶é‡æ–°æ’é˜Ÿã€‚å¦‚æœæ­¤æ—¶å…¶ä»–æ¶ˆè´¹è€… å¯ä»¥å¤„ç†ï¼Œå®ƒå°†å¾ˆå¿«å°†å…¶é‡æ–°åˆ†å‘ç»™å¦ä¸€ä¸ªæ¶ˆè´¹è€…ã€‚è¿™æ ·å³ä½¿æŸä¸ªæ¶ˆè´¹è€…å¶å°”æ­»äº¡ï¼Œä¹Ÿå¯ä»¥ç¡®ä¿ä¸ä¼šä¸¢å¤±ä»»ä½•æ¶ˆæ¯ã€‚</p>
<h4 id="æ‰‹åŠ¨åº”ç­”ç¤ºä¾‹"><a href="#æ‰‹åŠ¨åº”ç­”ç¤ºä¾‹" class="headerlink" title="æ‰‹åŠ¨åº”ç­”ç¤ºä¾‹"></a>æ‰‹åŠ¨åº”ç­”ç¤ºä¾‹</h4><p>â€‹		é»˜è®¤æ¶ˆæ¯é‡‡ç”¨çš„æ˜¯è‡ªåŠ¨åº”ç­”ã€‚</p>
<p>â€‹		åˆ›å»ºä¸¤ä¸ªæ¶ˆè´¹è€…ï¼Œåˆ†åˆ« sleep ä¸€å®šæ—¶é—´ã€‚</p>
<p>ç”Ÿäº§è€…ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.rabbitmq.ack;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.example.rabbitmq.util.RabbitConnectUtil;</span><br><span class="line"><span class="keyword">import</span> com.rabbitmq.client.Channel;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Scanner;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Producer</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">QUEUE_NAME</span> <span class="operator">=</span> <span class="string">&quot;ack_queue&quot;</span>;</span><br><span class="line">	</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">Channel</span> <span class="variable">channel</span> <span class="operator">=</span> RabbitConnectUtil.getChannel();</span><br><span class="line">        channel.queueDeclare(QUEUE_NAME, <span class="literal">false</span>, <span class="literal">false</span>, <span class="literal">false</span>, <span class="literal">null</span>);</span><br><span class="line">        <span class="type">Scanner</span> <span class="variable">sc</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Scanner</span>(System.in);</span><br><span class="line">        <span class="keyword">while</span> (sc.hasNext()) &#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">message</span> <span class="operator">=</span> sc.nextLine();</span><br><span class="line">            channel.basicPublish(<span class="string">&quot;&quot;</span>, QUEUE_NAME, <span class="literal">null</span>, message.getBytes());</span><br><span class="line">            System.out.println(<span class="string">&quot;æ¶ˆæ¯å‘é€å®Œæˆï¼š&quot;</span> + message);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ¶ˆè´¹è€…ä¸€ï¼šsleep 2ç§’</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.rabbitmq.ack;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.example.rabbitmq.util.RabbitConnectUtil;</span><br><span class="line"><span class="keyword">import</span> com.rabbitmq.client.Channel;</span><br><span class="line"><span class="keyword">import</span> com.rabbitmq.client.DeliverCallback;</span><br><span class="line"><span class="keyword">import</span> com.rabbitmq.client.Delivery;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.TimeUnit;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æµ‹è¯•æ¶ˆæ¯åº”ç­”</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Consumer</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">QUEUE_NAME</span> <span class="operator">=</span> <span class="string">&quot;ack_queue&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">Channel</span> <span class="variable">channel</span> <span class="operator">=</span> RabbitConnectUtil.getChannel();</span><br><span class="line">        System.out.println(<span class="string">&quot;Consumer01ç­‰å¾…æ¥å—æ¶ˆæ¯...&quot;</span>);</span><br><span class="line">        <span class="type">DeliverCallback</span> <span class="variable">deliverCallback</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DeliverCallback</span>() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">handle</span><span class="params">(String s, Delivery delivery)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">                System.out.println(s); <span class="comment">// amq.ctag-Gi369GilFESPvGyykhK3pg</span></span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    TimeUnit.SECONDS.sleep(<span class="number">2</span>);</span><br><span class="line">                    System.out.println(<span class="string">&quot;Consumerï¼š&quot;</span> + <span class="keyword">new</span> <span class="title class_">String</span>(delivery.getBody()));</span><br><span class="line">                &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">// å‚æ•°ä¸€ï¼šæ¶ˆæ¯æ ‡è®°ï¼Œå‚æ•°äºŒï¼šæ˜¯å¦æ‰¹é‡åº”ç­”</span></span><br><span class="line">                channel.basicAck(delivery.getEnvelope().getDeliveryTag(), <span class="literal">false</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">        <span class="comment">// æ‰‹åŠ¨åº”ç­”</span></span><br><span class="line">        <span class="type">boolean</span> <span class="variable">autoAck</span> <span class="operator">=</span> <span class="literal">false</span>;</span><br><span class="line">        channel.basicConsume(QUEUE_NAME, autoAck, deliverCallback, (consumerTag) -&gt; &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;æ¶ˆè´¹è€…å–æ¶ˆæ¶ˆè´¹æ¥å£å›è°ƒé€»è¾‘&quot;</span>);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ¶ˆè´¹è€…äºŒï¼šsleep 20ç§’</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.rabbitmq.ack;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.example.rabbitmq.util.RabbitConnectUtil;</span><br><span class="line"><span class="keyword">import</span> com.rabbitmq.client.Channel;</span><br><span class="line"><span class="keyword">import</span> com.rabbitmq.client.DeliverCallback;</span><br><span class="line"><span class="keyword">import</span> com.rabbitmq.client.Delivery;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.TimeUnit;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æµ‹è¯•æ¶ˆæ¯åº”ç­”</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Consumer</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">QUEUE_NAME</span> <span class="operator">=</span> <span class="string">&quot;ack_queue&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">Channel</span> <span class="variable">channel</span> <span class="operator">=</span> RabbitConnectUtil.getChannel();</span><br><span class="line">        System.out.println(<span class="string">&quot;Consumer02ç­‰å¾…æ¥å—æ¶ˆæ¯...&quot;</span>);</span><br><span class="line">        <span class="type">DeliverCallback</span> <span class="variable">deliverCallback</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DeliverCallback</span>() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">handle</span><span class="params">(String s, Delivery delivery)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">                System.out.println(s); <span class="comment">// amq.ctag-Gi369GilFESPvGyykhK3pg</span></span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    TimeUnit.SECONDS.sleep(<span class="number">20</span>);</span><br><span class="line">                    System.out.println(<span class="string">&quot;Consumerï¼š&quot;</span> + <span class="keyword">new</span> <span class="title class_">String</span>(delivery.getBody()));</span><br><span class="line">                &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">// å‚æ•°ä¸€ï¼šæ¶ˆæ¯æ ‡è®°ï¼Œå‚æ•°äºŒï¼šæ˜¯å¦æ‰¹é‡åº”ç­”</span></span><br><span class="line">                channel.basicAck(delivery.getEnvelope().getDeliveryTag(), <span class="literal">false</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">        <span class="comment">// æ‰‹åŠ¨åº”ç­”</span></span><br><span class="line">        <span class="type">boolean</span> <span class="variable">autoAck</span> <span class="operator">=</span> <span class="literal">false</span>;</span><br><span class="line">        channel.basicConsume(QUEUE_NAME, autoAck, deliverCallback, (consumerTag) -&gt; &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;æ¶ˆè´¹è€…å–æ¶ˆæ¶ˆè´¹æ¥å£å›è°ƒé€»è¾‘&quot;</span>);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æµ‹è¯•ï¼š</p>
<p>â€‹		æ­£å¸¸æƒ…å†µä¸‹æ¶ˆæ¯å‘é€æ–¹å‘é€ä¸¤ä¸ªæ¶ˆæ¯ C1 å’Œ C2 åˆ†åˆ«æ¥æ”¶åˆ°æ¶ˆæ¯å¹¶è¿›è¡Œå¤„ç†ã€‚å¦‚æœä¸­é—´ C2 å¼‚å¸¸ä¸­æ–­ï¼Œé‚£ä¹ˆæ¶ˆæ¯ä¼šé‡æ–°å…¥é˜Ÿï¼Œç”± C1 è¿›è¡Œæ¶ˆè´¹ã€‚</p>
<p><img src="/2023/02/28/RabbitMQ/Java\RabbitMQ\RabbitMQ.assets\image-20221014171616373.png" alt="image-20221014171616373"></p>
<h3 id="RabbitMQ-æŒä¹…åŒ–"><a href="#RabbitMQ-æŒä¹…åŒ–" class="headerlink" title="RabbitMQ æŒä¹…åŒ–"></a>RabbitMQ æŒä¹…åŒ–</h3><p>â€‹		åˆšåˆšå·²ç»çœ‹åˆ°äº†å¦‚ä½•å¤„ç†ä»»åŠ¡ä¸ä¸¢å¤±çš„æƒ…å†µï¼Œä½†æ˜¯<strong>å¦‚ä½•ä¿éšœå½“ RabbitMQ æœåŠ¡åœæ‰ä»¥åæ¶ˆ æ¯ç”Ÿäº§è€…å‘é€è¿‡æ¥çš„æ¶ˆæ¯ä¸ä¸¢å¤±</strong>ã€‚é»˜è®¤æƒ…å†µä¸‹ RabbitMQ é€€å‡ºæˆ–ç”±äºæŸç§åŸå› å´©æºƒæ—¶ï¼Œå®ƒå¿½è§†é˜Ÿåˆ—å’Œæ¶ˆæ¯ï¼Œé™¤éå‘ŠçŸ¥å®ƒä¸è¦è¿™æ ·åšã€‚ç¡®ä¿æ¶ˆæ¯ä¸ä¼šä¸¢å¤±éœ€è¦åšä¸¤ä»¶äº‹ï¼š<strong>éœ€è¦å°†é˜Ÿåˆ—å’Œæ¶ˆæ¯éƒ½æ ‡è®°ä¸ºæŒä¹…åŒ–ã€‚</strong></p>
<h4 id="é˜Ÿåˆ—æŒä¹…åŒ–"><a href="#é˜Ÿåˆ—æŒä¹…åŒ–" class="headerlink" title="é˜Ÿåˆ—æŒä¹…åŒ–"></a>é˜Ÿåˆ—æŒä¹…åŒ–</h4><p>â€‹		ä¹‹å‰æˆ‘ä»¬åˆ›å»ºçš„é˜Ÿåˆ—éƒ½æ˜¯éæŒä¹…åŒ–çš„ï¼Œrabbitmq å¦‚æœé‡å¯çš„åŒ–ï¼Œè¯¥é˜Ÿåˆ—å°±ä¼šè¢«åˆ é™¤æ‰ï¼Œå¦‚æœ è¦é˜Ÿåˆ—å®ç°æŒä¹…åŒ–éœ€è¦åœ¨å£°æ˜é˜Ÿåˆ—çš„æ—¶å€™æŠŠ durable å‚æ•°è®¾ç½®ä¸ºæŒä¹…åŒ–ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// è®¾ç½®é˜Ÿåˆ—ä¸ºæŒä¹…åŒ–</span></span><br><span class="line"><span class="type">boolean</span> <span class="variable">durable</span> <span class="operator">=</span> <span class="literal">true</span>;</span><br><span class="line">channel.queueDeclare(QUEUE_NAME, durable, <span class="literal">false</span>, <span class="literal">false</span>, <span class="literal">null</span>);</span><br></pre></td></tr></table></figure>

<p>â€‹		ä½†æ˜¯éœ€è¦æ³¨æ„çš„å°±æ˜¯å¦‚æœä¹‹å‰å£°æ˜çš„é˜Ÿåˆ—ä¸æ˜¯æŒä¹…åŒ–çš„ï¼Œéœ€è¦æŠŠåŸå…ˆé˜Ÿåˆ—å…ˆåˆ é™¤ï¼Œæˆ–è€…é‡æ–°åˆ›å»ºä¸€ä¸ªæŒä¹…åŒ–çš„é˜Ÿåˆ—ï¼Œä¸ç„¶å°±ä¼šå‡ºç°é”™è¯¯ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Caused by: com.rabbitmq.client.ShutdownSignalException: channel error; protocol method: #method&lt;channel.close&gt;(reply-code=<span class="number">406</span>, reply-text=PRECONDITION_FAILED - inequivalent arg <span class="string">&#x27;durable&#x27;</span> <span class="keyword">for</span> queue <span class="string">&#x27;ack_queue&#x27;</span> in vhost <span class="string">&#x27;/&#x27;</span>: received <span class="string">&#x27;true&#x27;</span> but current is <span class="string">&#x27;false&#x27;</span>, class-id=<span class="number">50</span>, method-id=<span class="number">10</span>)</span><br><span class="line">	at com.rabbitmq.utility.ValueOrException.getValue(ValueOrException.java:<span class="number">66</span>)</span><br></pre></td></tr></table></figure>

<p>åˆ é™¤ä¹‹å‰çš„é˜Ÿåˆ—ï¼š</p>
<p><img src="/2023/02/28/RabbitMQ/Java\RabbitMQ\RabbitMQ.assets\image-20221014215102286.png" alt="image-20221014215102286"></p>
<p>é‡æ–°åˆ›å»ºé˜Ÿåˆ—ï¼Œæ ‡è¯† D æ ‡è¯†æŒä¹…é˜Ÿåˆ—ï¼š</p>
<p><img src="/2023/02/28/RabbitMQ/Java\RabbitMQ\RabbitMQ.assets\image-20221014231741320.png" alt="image-20221014231741320"></p>
<h4 id="æ¶ˆæ¯æŒä¹…åŒ–"><a href="#æ¶ˆæ¯æŒä¹…åŒ–" class="headerlink" title="æ¶ˆæ¯æŒä¹…åŒ–"></a>æ¶ˆæ¯æŒä¹…åŒ–</h4><p>â€‹		è®©æ¶ˆæ¯å®ç°æŒä¹…åŒ–éœ€è¦åœ¨æ¶ˆæ¯ç”Ÿäº§è€…ä¿®æ”¹ä»£ç ï¼ŒMessageProperties.PERSISTENT_TEXT_PLAIN æ·» åŠ è¿™ä¸ªå±æ€§ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// channel.basicPublish(&quot;&quot;, QUEUE_NAME, null, message.getBytes());</span></span><br><span class="line">channel.basicPublish(<span class="string">&quot;&quot;</span>, QUEUE_NAME, MessageProperties.PERSISTENT_TEXT_PLAIN, message.getBytes());</span><br></pre></td></tr></table></figure>

<p>â€‹		å°†æ¶ˆæ¯æ ‡è®°ä¸ºæŒä¹…åŒ–å¹¶ä¸èƒ½å®Œå…¨ä¿è¯ä¸ä¼šä¸¢å¤±æ¶ˆæ¯ã€‚å°½ç®¡å®ƒå‘Šè¯‰ RabbitMQ å°†æ¶ˆæ¯ä¿å­˜åˆ°ç£ç›˜ï¼Œä½†æ˜¯è¿™é‡Œä¾ç„¶å­˜åœ¨å½“æ¶ˆæ¯åˆšå‡†å¤‡å­˜å‚¨åœ¨ç£ç›˜çš„æ—¶å€™ä½†æ˜¯è¿˜æ²¡æœ‰å­˜å‚¨å®Œï¼Œæ¶ˆæ¯è¿˜åœ¨ç¼“å­˜çš„ä¸€ä¸ªé—´éš”ç‚¹ï¼Œæ­¤æ—¶å¹¶æ²¡æœ‰çœŸæ­£å†™å…¥ç£ç›˜ã€‚</p>
<h4 id="ä¸å…¬å¹³åˆ†å‘"><a href="#ä¸å…¬å¹³åˆ†å‘" class="headerlink" title="ä¸å…¬å¹³åˆ†å‘"></a>ä¸å…¬å¹³åˆ†å‘</h4><p>â€‹		RabbitMQ åˆ†å‘æ¶ˆæ¯é‡‡ç”¨çš„è½®è®­åˆ†å‘ï¼Œä½†æ˜¯åœ¨æŸç§åœºæ™¯ä¸‹è¿™ç§ç­–ç•¥å¹¶ä¸æ˜¯å¾ˆå¥½ï¼Œæ¯”æ–¹è¯´æœ‰ä¸¤ä¸ªæ¶ˆè´¹è€…åœ¨å¤„ç†ä»»åŠ¡ï¼Œå…¶ä¸­æœ‰ä¸ªæ¶ˆè´¹è€… 1 å¤„ç†ä»»åŠ¡çš„é€Ÿåº¦éå¸¸å¿«ï¼Œè€Œå¦å¤–ä¸€ä¸ªæ¶ˆè´¹è€… 2 å¤„ç†é€Ÿåº¦å´å¾ˆæ…¢ï¼Œè¿™ä¸ªæ—¶å€™æˆ‘ä»¬è¿˜æ˜¯é‡‡ç”¨è½®è®­åˆ†å‘çš„åŒ–å°±ä¼šåˆ°è¿™å¤„ç†é€Ÿåº¦å¿«çš„è¿™ä¸ªæ¶ˆè´¹è€…å¾ˆå¤§ä¸€éƒ¨åˆ†æ—¶é—´å¤„äºç©ºé—²çŠ¶æ€ï¼Œè€Œå¤„ç†æ…¢çš„é‚£ä¸ªæ¶ˆè´¹è€…ä¸€ç›´åœ¨å¹²æ´»ï¼Œè¿™ç§åˆ†é…æ–¹å¼åœ¨è¿™ç§æƒ…å†µä¸‹å…¶å®å°±ä¸å¤ªå¥½ï¼Œä½†æ˜¯ RabbitMQ å¹¶ä¸çŸ¥é“è¿™ç§æƒ…å†µå®ƒä¾ç„¶å¾ˆå…¬å¹³çš„è¿›è¡Œåˆ†å‘ã€‚</p>
<p>â€‹		ä¸ºäº†é¿å…è¿™ç§æƒ…å†µï¼Œå¯ä»¥è®¾ç½®æ¶ˆè´¹è€…å‚æ•° <strong>channel.basicQos(1);</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// ä¸å…¬å¹³åˆ†å‘</span></span><br><span class="line">channel.basicQos(<span class="number">1</span>);</span><br><span class="line"><span class="comment">// æ‰‹åŠ¨åº”ç­”</span></span><br><span class="line"><span class="type">boolean</span> <span class="variable">autoAck</span> <span class="operator">=</span> <span class="literal">false</span>;</span><br><span class="line">channel.basicConsume(QUEUE_NAME, autoAck, deliverCallback, cancleCallBack&#125;);</span><br></pre></td></tr></table></figure>

<p>â€‹		æ„æ€å°±æ˜¯å¦‚æœè¿™ä¸ªä»»åŠ¡æˆ‘è¿˜æ²¡æœ‰å¤„ç†å®Œæˆ–è€…æˆ‘è¿˜æ²¡æœ‰åº”ç­”ä½ ï¼Œä½ å…ˆåˆ«åˆ†é…ç»™æˆ‘ï¼Œæˆ‘ç›®å‰åªèƒ½å¤„ç†ä¸€ä¸ªä»»åŠ¡ï¼Œç„¶å rabbitmq å°±ä¼šæŠŠè¯¥ä»»åŠ¡åˆ†é…ç»™æ²¡æœ‰é‚£ä¹ˆå¿™çš„é‚£ä¸ªç©ºé—²æ¶ˆè´¹è€…ï¼Œ<strong>å½“ç„¶å¦‚æœæ‰€æœ‰çš„æ¶ˆè´¹è€…éƒ½æ²¡æœ‰å®Œæˆæ‰‹ä¸Šä»»åŠ¡ï¼Œé˜Ÿåˆ—è¿˜åœ¨ä¸åœçš„æ·»åŠ æ–°ä»»åŠ¡ï¼Œé˜Ÿåˆ—æœ‰å¯èƒ½å°±ä¼šé‡åˆ°é˜Ÿåˆ—è¢«æ’‘æ»¡çš„æƒ…å†µï¼Œè¿™ä¸ªæ—¶å€™å°±åªèƒ½æ·»åŠ æ–°çš„ worker æˆ–è€…æ”¹å˜å…¶ä»–å­˜å‚¨ä»»åŠ¡çš„ç­–ç•¥ã€‚</strong></p>
<p><img src="/2023/02/28/RabbitMQ/Java\RabbitMQ\RabbitMQ.assets\image-20221014233054025.png" alt="image-20221014233054025"></p>
<h4 id="é¢„å–å€¼"><a href="#é¢„å–å€¼" class="headerlink" title="é¢„å–å€¼"></a>é¢„å–å€¼</h4><p>â€‹		æœ¬èº«æ¶ˆæ¯çš„å‘é€å°±æ˜¯å¼‚æ­¥å‘é€çš„ï¼Œæ‰€ä»¥åœ¨ä»»ä½•æ—¶å€™ï¼Œchannel ä¸Šè‚¯å®šä¸æ­¢åªæœ‰ä¸€ä¸ªæ¶ˆæ¯å¦å¤–æ¥è‡ªæ¶ˆè´¹è€…çš„æ‰‹åŠ¨ç¡®è®¤æœ¬è´¨ä¸Šä¹Ÿæ˜¯å¼‚æ­¥çš„ã€‚å› æ­¤è¿™é‡Œå°±å­˜åœ¨ä¸€ä¸ªæœªç¡®è®¤çš„æ¶ˆæ¯ç¼“å†²åŒºï¼Œå› æ­¤å¸Œæœ›å¼€å‘äººå‘˜èƒ½é™åˆ¶æ­¤ç¼“å†²åŒºçš„å¤§å°ï¼Œä»¥é¿å…ç¼“å†²åŒºé‡Œé¢æ— é™åˆ¶çš„æœªç¡®è®¤æ¶ˆæ¯é—®é¢˜ã€‚</p>
<p>â€‹		è¿™ä¸ªæ—¶å€™å°±å¯ä»¥é€šè¿‡ä½¿ç”¨ basic.qos æ–¹æ³•è®¾ ç½® â€œé¢„å–è®¡æ•°â€ å€¼æ¥å®Œæˆçš„ã€‚<strong>è¯¥å€¼å®šä¹‰é€šé“ä¸Šå…è®¸çš„æœªç¡®è®¤æ¶ˆæ¯çš„æœ€å¤§æ•°é‡ã€‚ä¸€æ—¦æ•°é‡è¾¾åˆ°é…ç½®çš„æ•°é‡ï¼Œ RabbitMQ å°†åœæ­¢åœ¨é€šé“ä¸Šä¼ é€’æ›´å¤šæ¶ˆæ¯ï¼Œé™¤éè‡³å°‘æœ‰ä¸€ä¸ªæœªå¤„ç†çš„æ¶ˆæ¯è¢«ç¡®è®¤</strong>ã€‚</p>
<p>â€‹		ä¾‹å¦‚å‡è®¾åœ¨é€šé“ä¸Šæœ‰æœªç¡®è®¤çš„æ¶ˆæ¯ 5ã€6ã€7ï¼Œ8ï¼Œå¹¶ä¸”é€šé“çš„é¢„å–è®¡æ•°è®¾ç½®ä¸º 4ï¼Œæ­¤æ—¶ RabbitMQ å°†ä¸ä¼šåœ¨è¯¥é€šé“ä¸Šå†ä¼ é€’ä»»ä½•æ¶ˆæ¯ï¼Œé™¤éè‡³å°‘æœ‰ä¸€ä¸ªæœªåº”ç­”çš„æ¶ˆæ¯è¢« ackã€‚æ¯”æ–¹è¯´ tag&#x3D;6 è¿™ä¸ªæ¶ˆæ¯åˆšåˆšè¢«ç¡®è®¤ ACKï¼ŒRabbitMQ å°†ä¼šæ„ŸçŸ¥è¿™ä¸ªæƒ…å†µåˆ°å¹¶å†å‘é€ä¸€æ¡æ¶ˆæ¯ã€‚<strong>æ¶ˆæ¯åº”ç­”å’Œ QoS é¢„å–å€¼å¯¹ç”¨æˆ·ååé‡æœ‰é‡å¤§å½±å“</strong>ã€‚é€šå¸¸ï¼Œå¢åŠ é¢„å–å°†æé«˜å‘æ¶ˆè´¹è€…ä¼ é€’æ¶ˆæ¯çš„é€Ÿåº¦ã€‚è™½ç„¶è‡ªåŠ¨åº”ç­”ä¼ è¾“æ¶ˆæ¯é€Ÿç‡æ˜¯æœ€ä½³çš„ï¼Œä½†æ˜¯ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹å·²ä¼ é€’ä½†å°šæœªå¤„ç†çš„æ¶ˆæ¯çš„æ•°é‡ä¹Ÿä¼šå¢åŠ ï¼Œä»è€Œå¢åŠ äº†æ¶ˆè´¹è€…çš„ RAM æ¶ˆè€—åº”è¯¥å°å¿ƒä½¿ç”¨å…·æœ‰æ— é™é¢„å¤„ç†çš„è‡ªåŠ¨ç¡®è®¤æ¨¡å¼æˆ–æ‰‹åŠ¨ç¡®è®¤æ¨¡å¼ï¼Œæ¶ˆè´¹è€…æ¶ˆè´¹äº†å¤§é‡çš„æ¶ˆæ¯å¦‚æœæ²¡æœ‰ç¡®è®¤çš„è¯ï¼Œä¼šå¯¼è‡´æ¶ˆè´¹è€…è¿æ¥èŠ‚ç‚¹çš„å†…å­˜æ¶ˆè€—å˜å¤§ï¼Œæ‰€ä»¥æ‰¾åˆ°åˆé€‚çš„é¢„å–å€¼æ˜¯ä¸€ä¸ªåå¤è¯•éªŒçš„è¿‡ç¨‹ã€‚</p>
<p>â€‹		ä¸åŒçš„è´Ÿè½½è¯¥å€¼å–å€¼ä¹Ÿä¸åŒ 100 åˆ° 300 èŒƒ å›´å†…çš„å€¼é€šå¸¸å¯æä¾›æœ€ä½³çš„ååé‡ï¼Œå¹¶ä¸”ä¸ä¼šç»™æ¶ˆè´¹è€…å¸¦æ¥å¤ªå¤§çš„é£é™©ã€‚é¢„å–å€¼ä¸º 1 æ˜¯æœ€ä¿å®ˆçš„ã€‚å½“ç„¶è¿™å°†ä½¿ååé‡å˜å¾—å¾ˆä½ï¼Œç‰¹åˆ«æ˜¯æ¶ˆè´¹è€…è¿æ¥å»¶è¿Ÿå¾ˆä¸¥é‡çš„æƒ…å†µä¸‹ï¼Œç‰¹åˆ«æ˜¯åœ¨æ¶ˆè´¹è€…è¿æ¥ç­‰å¾…æ—¶é—´è¾ƒé•¿çš„ç¯å¢ƒä¸­ã€‚å¯¹äºå¤§å¤šæ•°åº”ç”¨æ¥è¯´ï¼Œç¨å¾®é«˜ä¸€ç‚¹çš„å€¼å°†æ˜¯æœ€ä½³çš„ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * è®¾ç½®Qos=0ï¼šæ ‡è¯†è½®è¯¢</span></span><br><span class="line"><span class="comment"> * è®¾ç½®Qos=1ï¼šè¡¨ç¤ºä¸å…¬å¹³åˆ†å‘</span></span><br><span class="line"><span class="comment"> * è®¾ç½®ä¸ºå…¶ä»–ï¼šè¡¨ç¤ºæŒ‡å®šé¢„å–å€¼</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="comment">// channel.basicQos(1);</span></span><br><span class="line">channel.basicQos(<span class="number">2</span>);</span><br></pre></td></tr></table></figure>

<p>æµ‹è¯•ï¼š</p>
<p>ä¸¤ä¸ªæ¶ˆè´¹è€…ï¼Œä¸€ä¸ªé¢„å–å€¼è®¾ç½®ä¸º2ï¼Œä¸€ä¸ªè®¾ç½®ä¸º5ï¼Œå¯¹åº”çš„ç¡çœ æ—¶é—´åˆ†åˆ«ä¸º 2 å’Œ 30Sï¼Œé¢„å–å€¼åªæ˜¯ä¸€ä¸ªç¼“å†²åŒºï¼Œåªè¦æ¶ˆè´¹è€…æ¶ˆè´¹æ‰æ¶ˆæ¯å°±ä¼šé‡æ–°æ¶ˆè´¹å…¶ä»–çš„æ¶ˆæ¯ï¼Œæ‰€ä»¥æµ‹è¯•çš„ç»“æœä¸­ï¼Œç¬¬äºŒä¸ªæ¶ˆè´¹è€…èƒ½å †ç§¯  5 æ¡æ¶ˆæ¯ã€‚</p>
<p>Producerï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Producer</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">QUEUE_NAME</span> <span class="operator">=</span> <span class="string">&quot;durable_queue&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">Channel</span> <span class="variable">channel</span> <span class="operator">=</span> RabbitConnectUtil.getChannel();</span><br><span class="line">        <span class="comment">// è®¾ç½®é˜Ÿåˆ—ä¸ºæŒä¹…åŒ–</span></span><br><span class="line">        <span class="type">boolean</span> <span class="variable">durable</span> <span class="operator">=</span> <span class="literal">true</span>;</span><br><span class="line">        channel.queueDeclare(QUEUE_NAME, durable, <span class="literal">false</span>, <span class="literal">false</span>, <span class="literal">null</span>);</span><br><span class="line">        <span class="type">Scanner</span> <span class="variable">sc</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Scanner</span>(System.in);</span><br><span class="line">        <span class="keyword">while</span> (sc.hasNext()) &#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">message</span> <span class="operator">=</span> sc.nextLine();</span><br><span class="line">            <span class="comment">// channel.basicPublish(&quot;&quot;, QUEUE_NAME, null, message.getBytes());</span></span><br><span class="line">            channel.basicPublish(<span class="string">&quot;&quot;</span>, QUEUE_NAME, MessageProperties.PERSISTENT_TEXT_PLAIN, message.getBytes());</span><br><span class="line">            System.out.println(<span class="string">&quot;æ¶ˆæ¯å‘é€å®Œæˆï¼š&quot;</span> + message);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Consumerï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Consumer</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">QUEUE_NAME</span> <span class="operator">=</span> <span class="string">&quot;durable_queue&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">Channel</span> <span class="variable">channel</span> <span class="operator">=</span> RabbitConnectUtil.getChannel();</span><br><span class="line">        System.out.println(<span class="string">&quot;Consumer01ç­‰å¾…æ¥å—æ¶ˆæ¯...&quot;</span>);</span><br><span class="line">        <span class="type">DeliverCallback</span> <span class="variable">deliverCallback</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DeliverCallback</span>() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">handle</span><span class="params">(String s, Delivery delivery)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">                System.out.println(s); <span class="comment">// amq.ctag-Gi369GilFESPvGyykhK3pg</span></span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    TimeUnit.SECONDS.sleep(<span class="number">2</span>);</span><br><span class="line">                    System.out.println(<span class="string">&quot;Consumerï¼š&quot;</span> + <span class="keyword">new</span> <span class="title class_">String</span>(delivery.getBody()));</span><br><span class="line">                &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">// å‚æ•°ä¸€ï¼šæ¶ˆæ¯æ ‡è®°ï¼Œå‚æ•°äºŒï¼šæ˜¯å¦æ‰¹é‡åº”ç­”</span></span><br><span class="line">                channel.basicAck(delivery.getEnvelope().getDeliveryTag(), <span class="literal">false</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * è®¾ç½®Qos=0ï¼šæ ‡è¯†è½®è¯¢</span></span><br><span class="line"><span class="comment">         * è®¾ç½®Qos=1ï¼šè¡¨ç¤ºä¸å…¬å¹³åˆ†å‘</span></span><br><span class="line"><span class="comment">         * è®¾ç½®ä¸ºå…¶ä»–ï¼šè¡¨ç¤ºæŒ‡å®šé¢„å–å€¼</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="comment">// channel.basicQos(1);</span></span><br><span class="line">        channel.basicQos(<span class="number">2</span>);</span><br><span class="line">        <span class="comment">// æ‰‹åŠ¨åº”ç­”</span></span><br><span class="line">        <span class="type">boolean</span> <span class="variable">autoAck</span> <span class="operator">=</span> <span class="literal">false</span>;</span><br><span class="line">        channel.basicConsume(QUEUE_NAME, autoAck, deliverCallback, (consumerTag) -&gt; &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;æ¶ˆè´¹è€…å–æ¶ˆæ¶ˆè´¹æ¥å£å›è°ƒé€»è¾‘&quot;</span>);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="å‘å¸ƒç¡®è®¤"><a href="#å‘å¸ƒç¡®è®¤" class="headerlink" title="å‘å¸ƒç¡®è®¤"></a>å‘å¸ƒç¡®è®¤</h3><h4 id="å‘å¸ƒç¡®è®¤åŸç†"><a href="#å‘å¸ƒç¡®è®¤åŸç†" class="headerlink" title="å‘å¸ƒç¡®è®¤åŸç†"></a>å‘å¸ƒç¡®è®¤åŸç†</h4><p>â€‹		ç”Ÿäº§è€…å°†ä¿¡é“è®¾ç½®æˆ confirm æ¨¡å¼ï¼Œä¸€æ—¦ä¿¡é“è¿›å…¥ confirm æ¨¡å¼ï¼Œæ‰€æœ‰åœ¨è¯¥ä¿¡é“ä¸Šé¢å‘å¸ƒçš„æ¶ˆæ¯éƒ½å°†ä¼šè¢«æŒ‡æ´¾ä¸€ä¸ªå”¯ä¸€çš„ IDï¼ˆä» 1 å¼€å§‹ï¼‰ï¼Œ<strong>ä¸€æ—¦æ¶ˆæ¯è¢«æŠ•é€’åˆ°æ‰€æœ‰åŒ¹é…çš„é˜Ÿåˆ—ä¹‹åï¼Œbroker å°±ä¼šå‘é€ä¸€ä¸ªç¡®è®¤ç»™ç”Ÿäº§è€…</strong>ï¼ˆåŒ…å«æ¶ˆæ¯çš„å”¯ä¸€ IDï¼‰ï¼Œè¿™å°±ä½¿å¾—ç”Ÿäº§è€…çŸ¥é“æ¶ˆæ¯å·²ç»æ­£ç¡®åˆ°è¾¾ç›®çš„é˜Ÿåˆ—äº†ï¼Œå¦‚æœæ¶ˆæ¯å’Œé˜Ÿåˆ—æ˜¯å¯æŒä¹…åŒ–çš„ï¼Œé‚£ä¹ˆç¡®è®¤æ¶ˆæ¯ä¼šåœ¨å°†æ¶ˆæ¯å†™å…¥ç£ç›˜ä¹‹åå‘å‡ºï¼Œbroker å›ä¼ ç»™ç”Ÿäº§è€…çš„ç¡®è®¤æ¶ˆæ¯ä¸­ delivery-tag åŸŸåŒ…å«äº†ç¡®è®¤æ¶ˆæ¯çš„åºåˆ—å·ï¼Œæ­¤å¤– broker ä¹Ÿå¯ä»¥è®¾ç½® basic.ack çš„ multiple åŸŸï¼Œè¡¨ç¤ºåˆ°è¿™ä¸ªåºåˆ—å·ä¹‹å‰çš„æ‰€æœ‰æ¶ˆæ¯éƒ½å·²ç»å¾—åˆ°äº†å¤„ç†ã€‚</p>
<p>â€‹		<strong>confirm æ¨¡å¼æœ€å¤§çš„å¥½å¤„åœ¨äºå®ƒæ˜¯å¼‚æ­¥çš„ï¼Œä¸€æ—¦å‘å¸ƒä¸€æ¡æ¶ˆæ¯ï¼Œç”Ÿäº§è€…åº”ç”¨ç¨‹åºå°±å¯ä»¥åœ¨ç­‰ä¿¡é“è¿”å›ç¡®è®¤çš„åŒæ—¶ç»§ç»­å‘é€ä¸‹ä¸€æ¡æ¶ˆæ¯ï¼Œå½“æ¶ˆæ¯æœ€ç»ˆå¾—åˆ°ç¡®è®¤ä¹‹åï¼Œç”Ÿäº§è€…åº”ç”¨ä¾¿å¯ä»¥é€šè¿‡å›è°ƒæ–¹æ³•æ¥å¤„ç†è¯¥ç¡®è®¤æ¶ˆæ¯ï¼Œå¦‚æœ RabbitMQ å› ä¸ºè‡ªèº«å†…éƒ¨é”™è¯¯å¯¼è‡´æ¶ˆæ¯ä¸¢å¤±ï¼Œå°±ä¼šå‘é€ä¸€æ¡ nack æ¶ˆ æ¯ï¼Œç”Ÿäº§è€…åº”ç”¨ç¨‹åºåŒæ ·å¯ä»¥åœ¨å›è°ƒæ–¹æ³•ä¸­å¤„ç†è¯¥ nack æ¶ˆæ¯ã€‚</strong></p>
<h4 id="å‘å¸ƒç¡®è®¤çš„ç­–ç•¥"><a href="#å‘å¸ƒç¡®è®¤çš„ç­–ç•¥" class="headerlink" title="å‘å¸ƒç¡®è®¤çš„ç­–ç•¥"></a>å‘å¸ƒç¡®è®¤çš„ç­–ç•¥</h4><h5 id="å¼€å¯å‘å¸ƒç¡®è®¤"><a href="#å¼€å¯å‘å¸ƒç¡®è®¤" class="headerlink" title="å¼€å¯å‘å¸ƒç¡®è®¤"></a>å¼€å¯å‘å¸ƒç¡®è®¤</h5><p>â€‹		å‘å¸ƒç¡®è®¤é»˜è®¤æ˜¯æ²¡æœ‰å¼€å¯çš„ï¼Œå¦‚æœè¦å¼€å¯éœ€è¦è°ƒç”¨æ–¹æ³• confirmSelectï¼Œæ¯å½“ä½ è¦æƒ³ä½¿ç”¨å‘å¸ƒç¡®è®¤ï¼Œéƒ½éœ€è¦åœ¨ channel ä¸Šè°ƒç”¨è¯¥æ–¹æ³•ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">Channel</span> <span class="variable">channel</span> <span class="operator">=</span> connection.createChannel();</span><br><span class="line"><span class="comment">// å¼€å¯ç¡®è®¤å‘å¸ƒ</span></span><br><span class="line">channel.confirmSelect();</span><br></pre></td></tr></table></figure>

<h5 id="å•ä¸ªç¡®è®¤å‘å¸ƒ"><a href="#å•ä¸ªç¡®è®¤å‘å¸ƒ" class="headerlink" title="å•ä¸ªç¡®è®¤å‘å¸ƒ"></a>å•ä¸ªç¡®è®¤å‘å¸ƒ</h5><p>â€‹		è¿™æ˜¯ä¸€ç§ç®€å•çš„ç¡®è®¤æ–¹å¼ï¼Œå®ƒæ˜¯ä¸€ç§åŒæ­¥ç¡®è®¤å‘å¸ƒçš„æ–¹å¼ï¼Œä¹Ÿå°±æ˜¯<strong>å‘å¸ƒä¸€ä¸ªæ¶ˆæ¯ä¹‹ååªæœ‰å®ƒè¢«ç¡®è®¤å‘å¸ƒï¼Œåç»­çš„æ¶ˆæ¯æ‰èƒ½ç»§ç»­å‘å¸ƒ</strong>ï¼ŒwaitForConfirmsOrDie(long) è¿™ä¸ªæ–¹æ³•åªæœ‰åœ¨æ¶ˆæ¯è¢«ç¡®è®¤çš„æ—¶å€™æ‰è¿”å›ï¼Œå¦‚æœåœ¨æŒ‡å®šæ—¶é—´èŒƒå›´å†…è¿™ä¸ªæ¶ˆæ¯æ²¡æœ‰è¢«ç¡®è®¤é‚£ä¹ˆå®ƒå°†æŠ›å‡ºå¼‚å¸¸ã€‚ </p>
<p>â€‹		è¿™ç§ç¡®è®¤æ–¹å¼æœ‰ä¸€ä¸ªæœ€å¤§çš„ç¼ºç‚¹å°±æ˜¯ï¼šå‘å¸ƒé€Ÿåº¦ç‰¹åˆ«çš„æ…¢ï¼Œå› ä¸ºå¦‚æœæ²¡æœ‰ç¡®è®¤å‘å¸ƒçš„æ¶ˆæ¯å°±ä¼šé˜»å¡æ‰€æœ‰åç»­æ¶ˆæ¯çš„å‘å¸ƒï¼Œè¿™ç§æ–¹å¼æœ€å¤šæä¾›æ¯ç§’ä¸è¶…è¿‡æ•°ç™¾æ¡å‘å¸ƒæ¶ˆæ¯çš„ååé‡ã€‚å½“ç„¶å¯¹äºæŸäº›åº”ç”¨ç¨‹åºæ¥è¯´è¿™å¯èƒ½å·²ç»è¶³å¤Ÿäº†ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">MESSAGE_COUNT</span> <span class="operator">=</span> <span class="number">1000</span>;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * å•ä¸ªæ¶ˆæ¯å‘å¸ƒ</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">singleMessagePublish</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    <span class="type">Channel</span> <span class="variable">channel</span> <span class="operator">=</span> RabbitConnectUtil.getChannel();</span><br><span class="line">    <span class="type">String</span> <span class="variable">queue_name</span> <span class="operator">=</span> UUID.randomUUID().toString().substring(<span class="number">0</span>, <span class="number">8</span>);</span><br><span class="line">    <span class="comment">// è®¾ç½®é˜Ÿåˆ—ä¸ºæŒä¹…åŒ–</span></span><br><span class="line">    <span class="type">boolean</span> <span class="variable">durable</span> <span class="operator">=</span> <span class="literal">true</span>;</span><br><span class="line">    channel.queueDeclare(queue_name, durable, <span class="literal">false</span>, <span class="literal">false</span>, <span class="literal">null</span>);</span><br><span class="line">    <span class="comment">// å¼€å¯ç¡®è®¤å‘å¸ƒ</span></span><br><span class="line">    channel.confirmSelect();</span><br><span class="line">    <span class="type">long</span> <span class="variable">start</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; MESSAGE_COUNT; i++) &#123;</span><br><span class="line">        channel.basicPublish(<span class="string">&quot;&quot;</span>, queue_name, <span class="literal">null</span>, String.valueOf(i).getBytes());</span><br><span class="line">        <span class="type">boolean</span> <span class="variable">ret</span> <span class="operator">=</span> channel.waitForConfirms();</span><br><span class="line">        <span class="comment">//æœåŠ¡ç«¯è¿”å› false æˆ–è¶…æ—¶æ—¶é—´å†…æœªè¿”å›ï¼Œç”Ÿäº§è€…å¯ä»¥æ¶ˆæ¯é‡å‘</span></span><br><span class="line">        <span class="keyword">if</span> (ret) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;æ¶ˆæ¯å‘é€æˆåŠŸ&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">long</span> <span class="variable">end</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line">    System.out.println(<span class="string">&quot;å‘å¸ƒ&quot;</span> + MESSAGE_COUNT + <span class="string">&quot;ä¸ªå•ç‹¬ç¡®è®¤æ¶ˆæ¯,è€—æ—¶&quot;</span> + (end - start) + <span class="string">&quot;ms&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="æ‰¹é‡ç¡®è®¤å‘å¸ƒ"><a href="#æ‰¹é‡ç¡®è®¤å‘å¸ƒ" class="headerlink" title="æ‰¹é‡ç¡®è®¤å‘å¸ƒ"></a>æ‰¹é‡ç¡®è®¤å‘å¸ƒ</h5><p>â€‹		ä¸Šé¢é‚£ç§æ–¹å¼éå¸¸æ…¢ï¼Œä¸å•ä¸ªç­‰å¾…ç¡®è®¤æ¶ˆæ¯ç›¸æ¯”ï¼Œå…ˆå‘å¸ƒä¸€æ‰¹æ¶ˆæ¯ç„¶åä¸€èµ·ç¡®è®¤å¯ä»¥æå¤§åœ°æé«˜ååé‡ï¼Œå½“ç„¶è¿™ç§æ–¹å¼çš„ç¼ºç‚¹æ˜¯ï¼šå½“å‘ç”Ÿæ•…éšœå¯¼è‡´å‘å¸ƒå‡ºç°é—®é¢˜æ—¶ï¼Œä¸çŸ¥é“æ˜¯å“ªä¸ªæ¶ˆæ¯å‡ºç°é—®é¢˜äº†ï¼Œæˆ‘ä»¬å¿…é¡»å°†æ•´ä¸ªæ‰¹å¤„ç†ä¿å­˜åœ¨å†…å­˜ä¸­ï¼Œä»¥è®°å½•é‡è¦çš„ä¿¡æ¯è€Œåé‡æ–°å‘å¸ƒæ¶ˆæ¯ã€‚å½“ç„¶è¿™ç§æ–¹æ¡ˆä»ç„¶æ˜¯åŒæ­¥çš„ï¼Œä¹Ÿä¸€æ ·é˜»å¡æ¶ˆæ¯çš„å‘å¸ƒã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ‰¹é‡æ¶ˆæ¯å‘å¸ƒ</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">batchMessagePublish</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    <span class="type">Channel</span> <span class="variable">channel</span> <span class="operator">=</span> RabbitConnectUtil.getChannel();</span><br><span class="line">    <span class="type">String</span> <span class="variable">queue_name</span> <span class="operator">=</span> UUID.randomUUID().toString().substring(<span class="number">0</span>, <span class="number">8</span>);</span><br><span class="line">    channel.confirmSelect();</span><br><span class="line">    channel.queueDeclare(queue_name, <span class="literal">true</span>, <span class="literal">false</span>, <span class="literal">false</span>, <span class="literal">null</span>);</span><br><span class="line">    <span class="type">long</span> <span class="variable">start</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; MESSAGE_COUNT; i++) &#123;</span><br><span class="line">        channel.basicPublish(<span class="string">&quot;&quot;</span>, queue_name, <span class="literal">null</span>, String.valueOf(i).getBytes());</span><br><span class="line">        <span class="comment">// æ¯100ä¸ªæ¶ˆæ¯æ‰¹é‡ç¡®è®¤ä¸€æ¬¡</span></span><br><span class="line">        <span class="keyword">if</span> (i % <span class="number">100</span> == <span class="number">0</span>) &#123;</span><br><span class="line">            channel.waitForConfirms();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">long</span> <span class="variable">end</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line">    System.out.println(<span class="string">&quot;å‘å¸ƒ&quot;</span> + MESSAGE_COUNT + <span class="string">&quot;ä¸ªå•æ‰¹é‡ç¡®è®¤æ¶ˆæ¯,è€—æ—¶&quot;</span> + (end - start) + <span class="string">&quot;ms&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="å¼‚æ­¥ç¡®è®¤å‘å¸ƒ"><a href="#å¼‚æ­¥ç¡®è®¤å‘å¸ƒ" class="headerlink" title="å¼‚æ­¥ç¡®è®¤å‘å¸ƒ"></a>å¼‚æ­¥ç¡®è®¤å‘å¸ƒ</h5><p>â€‹		å¼‚æ­¥ç¡®è®¤è™½ç„¶ç¼–ç¨‹é€»è¾‘æ¯”ä¸Šä¸¤ä¸ªè¦å¤æ‚ï¼Œä½†æ˜¯æ€§ä»·æ¯”æœ€é«˜ï¼Œæ— è®ºæ˜¯å¯é æ€§è¿˜æ˜¯æ•ˆç‡éƒ½æ²¡å¾—è¯´ï¼Œ <strong>å®ƒæ˜¯åˆ©ç”¨å›è°ƒå‡½æ•°æ¥è¾¾åˆ°æ¶ˆæ¯å¯é æ€§ä¼ é€’çš„</strong>ï¼Œè¿™ä¸ªä¸­é—´ä»¶ä¹Ÿæ˜¯é€šè¿‡å‡½æ•°å›è°ƒæ¥ä¿è¯æ˜¯å¦æŠ•é€’æˆåŠŸï¼Œ ä¸‹é¢å°±è®©æˆ‘ä»¬æ¥è¯¦ç»†è®²è§£å¼‚æ­¥ç¡®è®¤æ˜¯æ€ä¹ˆå®ç°çš„ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * å¼‚æ­¥æ¶ˆæ¯å‘å¸ƒ</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">asyncPublishMessage</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    <span class="type">Channel</span> <span class="variable">channel</span> <span class="operator">=</span> RabbitConnectUtil.getChannel();</span><br><span class="line">    <span class="type">String</span> <span class="variable">queue_name</span> <span class="operator">=</span> UUID.randomUUID().toString();</span><br><span class="line">    channel.queueDeclare(queue_name, <span class="literal">false</span>, <span class="literal">false</span>, <span class="literal">false</span>, <span class="literal">null</span>);</span><br><span class="line">    channel.confirmSelect();</span><br><span class="line">    <span class="comment">// å­˜æ”¾æ¶ˆæ¯ç¼–å·ä¸å…·ä½“ä¿¡æ¯</span></span><br><span class="line">    ConcurrentSkipListMap&lt;Long, String&gt; outstandingConfirms =</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">ConcurrentSkipListMap</span>&lt;&gt;();</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ç¡®è®¤æ”¶åˆ°æ¶ˆæ¯çš„ä¸€ä¸ªå›è°ƒ</span></span><br><span class="line"><span class="comment">     * å‚æ•°ä¸€ï¼šæ¶ˆæ¯åºåˆ—å·</span></span><br><span class="line"><span class="comment">     * å‚æ•°äºŒï¼štrue ï¼ˆæ‰¹é‡åˆ é™¤ï¼‰å¯ä»¥ç¡®è®¤å°äºç­‰äºå½“å‰åºåˆ—å·çš„æ¶ˆæ¯ï¼Œfalse ç¡®è®¤å½“å‰åºåˆ—å·æ¶ˆæ¯</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="type">ConfirmCallback</span> <span class="variable">confirmCallback</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ConfirmCallback</span>() &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">handle</span><span class="params">(<span class="type">long</span> sequenceNumber, <span class="type">boolean</span> multiple)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">            <span class="comment">// æ‰¹é‡åˆ é™¤</span></span><br><span class="line">            <span class="keyword">if</span> (multiple) &#123;</span><br><span class="line">                <span class="comment">//è¿”å›çš„æ˜¯å°äºç­‰äºå½“å‰åºåˆ—å·çš„æœªç¡®è®¤æ¶ˆæ¯ æ˜¯ä¸€ä¸ª map</span></span><br><span class="line">                ConcurrentNavigableMap&lt;Long, String&gt; confirmed =</span><br><span class="line">                    outstandingConfirms.headMap(sequenceNumber, <span class="literal">true</span>);</span><br><span class="line">                <span class="comment">//æ¸…é™¤è¯¥éƒ¨åˆ†æœªç¡®è®¤æ¶ˆæ¯(æ‰¹é‡æ¸…é™¤)</span></span><br><span class="line">                confirmed.clear();</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="comment">//åªæ¸…é™¤å½“å‰åºåˆ—å·çš„æ¶ˆæ¯ï¼ˆå•ä¸ªåˆ é™¤ï¼‰</span></span><br><span class="line">                outstandingConfirms.remove(sequenceNumber);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="type">ConfirmCallback</span> <span class="variable">nackCallback</span> <span class="operator">=</span> (sequenceNumber, multiple) -&gt; &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">message</span> <span class="operator">=</span> outstandingConfirms.get(sequenceNumber);</span><br><span class="line">        System.out.println(<span class="string">&quot;å‘å¸ƒçš„æ¶ˆæ¯&quot;</span> + message + <span class="string">&quot;æœªè¢«ç¡®è®¤ï¼Œåºåˆ—å·&quot;</span> + sequenceNumber);</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ·»åŠ ä¸€ä¸ªå¼‚æ­¥ç¡®è®¤çš„ç›‘å¬å™¨</span></span><br><span class="line"><span class="comment">     * 1.ç¡®è®¤æ”¶åˆ°æ¶ˆæ¯çš„å›è°ƒ</span></span><br><span class="line"><span class="comment">     * 2.æœªæ”¶åˆ°æ¶ˆæ¯çš„å›è°ƒ</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    channel.addConfirmListener(confirmCallback, nackCallback);</span><br><span class="line">    <span class="type">long</span> <span class="variable">begin</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; MESSAGE_COUNT; i++) &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">message</span> <span class="operator">=</span> <span class="string">&quot;æ¶ˆæ¯&quot;</span> + i;</span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * channel.getNextPublishSeqNo()è·å–ä¸‹ä¸€ä¸ªæ¶ˆæ¯çš„åºåˆ—å·</span></span><br><span class="line"><span class="comment">         * é€šè¿‡åºåˆ—å·ä¸æ¶ˆæ¯ä½“è¿›è¡Œä¸€ä¸ªå…³è”</span></span><br><span class="line"><span class="comment">         * å…¨éƒ¨éƒ½æ˜¯æœªç¡®è®¤çš„æ¶ˆæ¯ä½“</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        outstandingConfirms.put(channel.getNextPublishSeqNo(), message);</span><br><span class="line">        channel.basicPublish(<span class="string">&quot;&quot;</span>, queue_name, <span class="literal">null</span>, message.getBytes());</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">long</span> <span class="variable">end</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line">    System.out.println(<span class="string">&quot;å‘å¸ƒ&quot;</span> + MESSAGE_COUNT + <span class="string">&quot;ä¸ªå¼‚æ­¥ç¡®è®¤æ¶ˆæ¯,è€—æ—¶&quot;</span> + (end - begin) + <span class="string">&quot;ms&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h5 id="å¦‚ä½•å¤„ç†å¼‚æ­¥æœªç¡®è®¤æ¶ˆæ¯"><a href="#å¦‚ä½•å¤„ç†å¼‚æ­¥æœªç¡®è®¤æ¶ˆæ¯" class="headerlink" title="å¦‚ä½•å¤„ç†å¼‚æ­¥æœªç¡®è®¤æ¶ˆæ¯"></a>å¦‚ä½•å¤„ç†å¼‚æ­¥æœªç¡®è®¤æ¶ˆæ¯</h5><p>â€‹		æœ€å¥½çš„è§£å†³çš„è§£å†³æ–¹æ¡ˆå°±æ˜¯æŠŠæœªç¡®è®¤çš„æ¶ˆæ¯æ”¾åˆ°ä¸€ä¸ªåŸºäºå†…å­˜çš„èƒ½è¢«å‘å¸ƒçº¿ç¨‹è®¿é—®çš„é˜Ÿåˆ—ï¼Œ æ¯”å¦‚è¯´ç”¨ ConcurrentLinkedQueue è¿™ä¸ªé˜Ÿåˆ—åœ¨ confirm callbacks ä¸å‘å¸ƒçº¿ç¨‹ä¹‹é—´è¿›è¡Œæ¶ˆæ¯çš„ä¼  é€’ã€‚</p>
<h5 id="æ€»ç»“å¯¹æ¯”"><a href="#æ€»ç»“å¯¹æ¯”" class="headerlink" title="æ€»ç»“å¯¹æ¯”"></a>æ€»ç»“å¯¹æ¯”</h5><ul>
<li>å•ç‹¬å‘å¸ƒæ¶ˆæ¯ï¼šåŒæ­¥ç­‰å¾…ç¡®è®¤ï¼Œç®€å•ï¼Œä½†ååé‡éå¸¸æœ‰é™ã€‚ </li>
<li>æ‰¹é‡å‘å¸ƒæ¶ˆæ¯ï¼šæ‰¹é‡åŒæ­¥ç­‰å¾…ç¡®è®¤ï¼Œç®€å•ï¼Œåˆç†çš„ååé‡ï¼Œä¸€æ—¦å‡ºç°é—®é¢˜ä½†å¾ˆéš¾æ¨æ–­å‡ºæ˜¯é‚£æ¡æ¶ˆæ¯å‡ºç°äº†é—®é¢˜ã€‚ </li>
<li>å¼‚æ­¥å¤„ç†ï¼š æœ€ä½³æ€§èƒ½å’Œèµ„æºä½¿ç”¨ï¼Œåœ¨å‡ºç°é”™è¯¯çš„æƒ…å†µä¸‹å¯ä»¥å¾ˆå¥½åœ°æ§åˆ¶ã€‚</li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    <span class="comment">// singleMessagePublish(); //2329ms</span></span><br><span class="line">    <span class="comment">// batchMessagePublish();  // 376ms</span></span><br><span class="line">    asyncPublishMessage();     <span class="comment">// 102ms</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="äº¤æ¢æœº-1"><a href="#äº¤æ¢æœº-1" class="headerlink" title="äº¤æ¢æœº"></a>äº¤æ¢æœº</h3><p>â€‹		å°†æ¶ˆæ¯ä¼ è¾¾ç»™å¤šä¸ªæ¶ˆè´¹è€…ã€‚è¿™ç§æ¨¡å¼ ç§°ä¸º â€å‘å¸ƒ&#x2F;è®¢é˜…â€.</p>
<p>ç¤ºä¾‹ï¼š</p>
<p>â€‹		æ„å»ºä¸€ä¸ªç®€å•çš„æ—¥å¿—ç³»ç»Ÿã€‚å®ƒå°†ç”±ä¸¤ä¸ªç¨‹åºç»„æˆï¼šç¬¬ä¸€ä¸ªç¨‹åºå°†å‘å‡ºæ—¥å¿—æ¶ˆæ¯ï¼Œç¬¬äºŒä¸ªç¨‹åºæ˜¯æ¶ˆè´¹è€…ã€‚å…¶ä¸­æˆ‘ä»¬ä¼šå¯åŠ¨ä¸¤ä¸ªæ¶ˆè´¹è€…ï¼Œå…¶ä¸­ä¸€ä¸ªæ¶ˆè´¹è€…æ¥æ”¶åˆ°æ¶ˆæ¯åæŠŠæ—¥å¿—å­˜å‚¨åœ¨ç£ç›˜ï¼Œå¦å¤–ä¸€ä¸ªæ¶ˆè´¹è€…æ¥æ”¶åˆ°æ¶ˆæ¯åæŠŠæ¶ˆæ¯æ‰“å°åœ¨å±å¹•ä¸Šï¼Œäº‹å®ä¸Šç¬¬ä¸€ä¸ªç¨‹åºå‘å‡ºçš„æ—¥å¿—æ¶ˆæ¯å°†å¹¿æ’­ç»™æ‰€æœ‰æ¶ˆè´¹è€…ã€‚</p>
<img src="/2023/02/28/RabbitMQ/Java\RabbitMQ\RabbitMQ.assets\image-20221015124909401.png" alt="image-20221015124909401" style="zoom:80%;">



<p><img src="/2023/02/28/RabbitMQ/Java\RabbitMQ\RabbitMQ.assets\image-20221015124836840.png" alt="image-20221015124836840"></p>
<h4 id="Exchanges-æ¦‚å¿µ"><a href="#Exchanges-æ¦‚å¿µ" class="headerlink" title="Exchanges æ¦‚å¿µ"></a>Exchanges æ¦‚å¿µ</h4><p>â€‹		RabbitMQ æ¶ˆæ¯ä¼ é€’æ¨¡å‹çš„æ ¸å¿ƒæ€æƒ³æ˜¯: <strong>ç”Ÿäº§è€…ç”Ÿäº§çš„æ¶ˆæ¯ä»ä¸ä¼šç›´æ¥å‘é€åˆ°é˜Ÿåˆ—</strong>ã€‚å®é™…ä¸Šï¼Œé€šå¸¸ç”Ÿäº§è€…ç”šè‡³éƒ½ä¸çŸ¥é“è¿™äº›æ¶ˆæ¯ä¼ é€’ä¼ é€’åˆ°äº†å“ªäº›é˜Ÿåˆ—ä¸­ã€‚ ç›¸åï¼Œç”Ÿäº§è€…åªèƒ½å°†æ¶ˆæ¯å‘é€åˆ°äº¤æ¢æœºï¼ˆexchangeï¼‰ï¼Œäº¤æ¢æœºå·¥ä½œçš„å†…å®¹éå¸¸ç®€å•ï¼Œä¸€æ–¹é¢å®ƒæ¥æ”¶æ¥è‡ªç”Ÿäº§è€…çš„æ¶ˆæ¯ï¼Œå¦ä¸€æ–¹é¢å°†å®ƒä»¬æ¨å…¥é˜Ÿåˆ—ã€‚äº¤æ¢æœºå¿…é¡»ç¡®åˆ‡çŸ¥é“å¦‚ä½•å¤„ç†æ”¶åˆ°çš„æ¶ˆæ¯ã€‚æ˜¯åº”è¯¥æŠŠè¿™äº›æ¶ˆæ¯æ”¾åˆ°ç‰¹å®šé˜Ÿåˆ—è¿˜æ˜¯è¯´æ”¾åˆ°è®¸å¤šé˜Ÿåˆ—ä¸­è¿˜æ˜¯è¯´åº”è¯¥ä¸¢å¼ƒå®ƒä»¬ï¼Œè¿™å°±çš„ç”±äº¤æ¢æœºçš„ç±»å‹æ¥å†³å®šã€‚</p>
<h5 id="Exchanges-çš„ç±»å‹"><a href="#Exchanges-çš„ç±»å‹" class="headerlink" title="Exchanges çš„ç±»å‹"></a>Exchanges çš„ç±»å‹</h5><p>â€‹		ç›´æ¥ï¼ˆdirectï¼‰, ä¸»é¢˜ï¼ˆtopicï¼‰ ,æ ‡é¢˜ï¼ˆheadersï¼‰ , æ‰‡å‡ºï¼ˆfanoutï¼‰</p>
<h5 id="é»˜è®¤exchange"><a href="#é»˜è®¤exchange" class="headerlink" title="é»˜è®¤exchange"></a>é»˜è®¤exchange</h5><p>â€‹		é»˜è®¤äº¤æ¢æœºä½¿ç”¨ç©ºä¸²è¿›è¡Œæ ‡è¯†ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">channel.basicPublish(<span class="string">&quot;&quot;</span>, queue_name, <span class="literal">null</span>, String.valueOf(i).getBytes());</span><br></pre></td></tr></table></figure>

<p>â€‹		ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯äº¤æ¢æœºçš„åç§°ã€‚ç©ºå­—ç¬¦ä¸²è¡¨ç¤ºé»˜è®¤æˆ–æ— åç§°äº¤æ¢æœºï¼šæ¶ˆæ¯èƒ½è·¯ç”±å‘é€åˆ°é˜Ÿåˆ—ä¸­å…¶å®æ˜¯ç”± routingKeyï¼ˆbindingkeyï¼‰ç»‘å®š key æŒ‡å®šçš„ï¼Œå¦‚æœå®ƒå­˜åœ¨çš„è¯ã€‚</p>
<h5 id="ä¸´æ—¶é˜Ÿåˆ—"><a href="#ä¸´æ—¶é˜Ÿåˆ—" class="headerlink" title="ä¸´æ—¶é˜Ÿåˆ—"></a>ä¸´æ—¶é˜Ÿåˆ—</h5><p>â€‹		æ¯å½“æˆ‘ä»¬è¿æ¥åˆ° Rabbit æ—¶ï¼Œæˆ‘ä»¬éƒ½éœ€è¦ä¸€ä¸ªå…¨æ–°çš„ç©ºé˜Ÿåˆ—ï¼Œä¸ºæ­¤æˆ‘ä»¬å¯ä»¥åˆ›å»ºä¸€ä¸ªå…·æœ‰éšæœºåç§°çš„é˜Ÿåˆ—ï¼Œæˆ–è€…èƒ½è®©æœåŠ¡å™¨ä¸ºæˆ‘ä»¬é€‰æ‹©ä¸€ä¸ªéšæœºé˜Ÿåˆ—åç§°ã€‚å…¶æ¬¡ä¸€æ—¦æˆ‘ä»¬æ–­å¼€äº†æ¶ˆè´¹è€…çš„è¿æ¥ï¼Œé˜Ÿåˆ—å°†è¢«è‡ªåŠ¨åˆ é™¤ã€‚</p>
<p>åˆ›å»ºä¸´æ—¶é˜Ÿåˆ—çš„æ–¹å¼å¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">String</span> <span class="variable">queueName</span> <span class="operator">=</span> channel.queueDeclare().getQueue();</span><br></pre></td></tr></table></figure>

<h5 id="ç»‘å®šï¼ˆbindingsï¼‰"><a href="#ç»‘å®šï¼ˆbindingsï¼‰" class="headerlink" title="ç»‘å®šï¼ˆbindingsï¼‰"></a>ç»‘å®šï¼ˆbindingsï¼‰</h5><p>â€‹		binding å…¶å®æ˜¯ exchange å’Œ queue ä¹‹é—´çš„æ¡¥æ¢ï¼Œå®ƒå‘Šè¯‰æˆ‘ä»¬ exchange å’Œé‚£ä¸ªé˜Ÿåˆ—è¿›è¡Œäº†ç»‘å®šå…³ç³»ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">channel.queueBind(queueName, EXCHANGE_NAME, <span class="string">&quot;&quot;</span>);</span><br></pre></td></tr></table></figure>

<h4 id="Fanout"><a href="#Fanout" class="headerlink" title="Fanout"></a>Fanout</h4><p>â€‹		Fanout æ˜¯å°†æ¥æ”¶åˆ°çš„æ‰€æœ‰æ¶ˆæ¯å¹¿æ’­åˆ°å®ƒçŸ¥é“çš„æ‰€æœ‰é˜Ÿåˆ—ä¸­ï¼Œç³»ç»Ÿä¸­é»˜è®¤æœ‰äº› exchange ç±»å‹ã€‚</p>
<img src="/2023/02/28/RabbitMQ/Java\RabbitMQ\RabbitMQ.assets\image-20221015192457355.png" alt="image-20221015192457355" style="zoom:80%;">

<p>ç¤ºä¾‹ï¼š</p>
<p>â€‹		ç”Ÿäº§è€…å‘é€æ—¥å¿—ä¿¡æ¯åˆ° broker ä¸Šé¢ï¼Œæ¶ˆè´¹è€…ä¸€å°†ä¿¡æ¯æ˜¾ç¤ºåˆ°æ§åˆ¶å°ä¸Šï¼Œæ¶ˆè´¹è€…äºŒå°†æ—¥å¿—ä¿¡æ¯å­˜å…¥ç£ç›˜ã€‚</p>
<p>ReceiveLogs01 å°†æ¥æ”¶åˆ°çš„æ¶ˆæ¯æ‰“å°åœ¨æ§åˆ¶å°ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æµ‹è¯•äº¤æ¢æœºç±»å‹</span></span><br><span class="line"><span class="comment"> * å°†æ¥æ”¶åˆ°çš„æ¶ˆæ¯æ‰“å°åˆ°æ§åˆ¶å°</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ReceiveLogs01</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">EXCHANGE_NAME</span> <span class="operator">=</span> <span class="string">&quot;logs&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">Channel</span> <span class="variable">channel</span> <span class="operator">=</span> RabbitConnectUtil.getChannel();</span><br><span class="line">        channel.exchangeDeclare(EXCHANGE_NAME, BuiltinExchangeType.FANOUT);</span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * ç”Ÿæˆä¸€ä¸ªéšæœºé˜Ÿåˆ—ï¼šå½“æ¶ˆè´¹è€…æ–­å¼€å’Œè¯¥é˜Ÿåˆ—çš„è¿æ¥æ—¶é˜Ÿåˆ—è‡ªåŠ¨åˆ é™¤</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">queueName</span> <span class="operator">=</span> channel.queueDeclare().getQueue();</span><br><span class="line">        <span class="comment">// ç»‘å®šé˜Ÿåˆ—ä¸äº¤æ¢æœºï¼Œå…¶ä¸­routingkey(ä¹Ÿç§°ä¹‹ä¸º binding key)è®¾ç½®ä¸ºç©ºå­—ç¬¦ä¸²</span></span><br><span class="line">        channel.queueBind(queueName, EXCHANGE_NAME, <span class="string">&quot;&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;ReceiveLogs01ç­‰å¾…æ¥å—æ¶ˆæ¯...&quot;</span>);</span><br><span class="line">        <span class="type">DeliverCallback</span> <span class="variable">deliverCallback</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DeliverCallback</span>() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">handle</span><span class="params">(String s, Delivery delivery)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;æ§åˆ¶å°æ‰“å°æ¶ˆæ¯ï¼š&quot;</span> + <span class="keyword">new</span> <span class="title class_">String</span>(delivery.getBody()));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">        <span class="type">CancelCallback</span> <span class="variable">cancelCallback</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CancelCallback</span>() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">handle</span><span class="params">(String s)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">        channel.basicConsume(queueName, <span class="literal">true</span>, deliverCallback, cancelCallback);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ReceiveLogs02 å°†æ¥æ”¶åˆ°çš„æ¶ˆæ¯å­˜å‚¨åœ¨ç£ç›˜ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æµ‹è¯•äº¤æ¢æœºç±»å‹</span></span><br><span class="line"><span class="comment"> * å°†æ¥æ”¶åˆ°çš„æ¶ˆæ¯å†™å…¥æ–‡ä»¶</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ReceiveLogs02</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">EXCHANGE_NAME</span> <span class="operator">=</span> <span class="string">&quot;logs&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">Channel</span> <span class="variable">channel</span> <span class="operator">=</span> RabbitConnectUtil.getChannel();</span><br><span class="line">        channel.exchangeDeclare(EXCHANGE_NAME, BuiltinExchangeType.FANOUT);</span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * ç”Ÿæˆä¸€ä¸ªéšæœºé˜Ÿåˆ—ï¼šå½“æ¶ˆè´¹è€…æ–­å¼€å’Œè¯¥é˜Ÿåˆ—çš„è¿æ¥æ—¶é˜Ÿåˆ—è‡ªåŠ¨åˆ é™¤</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">queueName</span> <span class="operator">=</span> channel.queueDeclare().getQueue();</span><br><span class="line">        <span class="comment">// ç»‘å®šé˜Ÿåˆ—ä¸äº¤æ¢æœºï¼Œå…¶ä¸­routingkey(ä¹Ÿç§°ä¹‹ä¸º binding key)è®¾ç½®ä¸ºç©ºå­—ç¬¦ä¸²</span></span><br><span class="line">        channel.queueBind(queueName, EXCHANGE_NAME, <span class="string">&quot;&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;ReceiveLogs01ç­‰å¾…æ¥å—æ¶ˆæ¯...&quot;</span>);</span><br><span class="line">        <span class="type">DeliverCallback</span> <span class="variable">deliverCallback</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DeliverCallback</span>() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">handle</span><span class="params">(String s, Delivery delivery)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">                <span class="type">String</span> <span class="variable">message</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">String</span>(delivery.getBody());</span><br><span class="line">                FileUtils.writeStringToFile(<span class="keyword">new</span> <span class="title class_">File</span>(<span class="string">&quot;C:\\rabbit.txt&quot;</span>), message);</span><br><span class="line">                System.out.println(<span class="string">&quot;æ•°æ®å†™å…¥æ–‡ä»¶æˆåŠŸ&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">        <span class="type">CancelCallback</span> <span class="variable">cancelCallback</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CancelCallback</span>() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">handle</span><span class="params">(String s)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">        channel.basicConsume(queueName, <span class="literal">true</span>, deliverCallback, cancelCallback);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>EmitLog å‘é€æ¶ˆæ¯ç»™ä¸¤ä¸ªæ¶ˆè´¹è€…æ¥æ”¶ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * äº¤æ¢æœºæµ‹è¯•ï¼š</span></span><br><span class="line"><span class="comment"> * æäº¤æ—¥å¿—</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">EmitLog</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">EXCHANGE_NAME</span> <span class="operator">=</span> <span class="string">&quot;logs&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">Channel</span> <span class="variable">channel</span> <span class="operator">=</span> RabbitConnectUtil.getChannel();</span><br><span class="line">        channel.exchangeDeclare(EXCHANGE_NAME, BuiltinExchangeType.FANOUT);</span><br><span class="line">        <span class="type">Scanner</span> <span class="variable">sc</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Scanner</span>(System.in);</span><br><span class="line">        <span class="keyword">while</span> (sc.hasNext()) &#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">message</span> <span class="operator">=</span> sc.nextLine();</span><br><span class="line">            channel.basicPublish(EXCHANGE_NAME, <span class="string">&quot;&quot;</span>, <span class="literal">null</span>, message.getBytes());</span><br><span class="line">            System.out.println(<span class="string">&quot;æ¶ˆæ¯å‘é€å®Œæˆï¼š&quot;</span> + message);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="Direct-exchange"><a href="#Direct-exchange" class="headerlink" title="Direct exchange"></a>Direct exchange</h4><p>â€‹		ä¸Šé¢å¯ä»¥å‘è®¸å¤šæ¥æ”¶è€…å¹¿æ’­æ—¥å¿—æ¶ˆæ¯ã€‚ä½†å¦‚ä½•åªè®©æŸä¸ªæ¶ˆè´¹è€…è®¢é˜…å‘å¸ƒçš„éƒ¨åˆ†æ¶ˆæ¯ã€‚ä¾‹å¦‚åªæŠŠä¸¥é‡é”™è¯¯æ¶ˆæ¯å®šå‘å­˜å‚¨åˆ°æ—¥å¿—æ–‡ä»¶ï¼ŒåŒæ—¶ä»ç„¶èƒ½å¤Ÿåœ¨æ§åˆ¶å°ä¸Šæ‰“å°æ‰€æœ‰æ—¥å¿—æ¶ˆæ¯ã€‚å¯¹äº bindingsï¼Œé˜Ÿåˆ—åªå¯¹å®ƒç»‘å®šçš„äº¤æ¢æœºçš„æ¶ˆæ¯æ„Ÿå…´è¶£ã€‚</p>
<p>ç»‘å®šå‚æ•°ï¼šroutingKey ï¼Œä¹Ÿå¯ç§°è¯¥å‚æ•°ä¸º binding keyï¼Œ åˆ›å»ºç»‘å®šä»£ç ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">channel.queueBind(queueName, EXCHANGE_NAME, <span class="string">&quot;routingKey&quot;</span>);</span><br></pre></td></tr></table></figure>

<h5 id="Direct-exchange-ä»‹ç»"><a href="#Direct-exchange-ä»‹ç»" class="headerlink" title="Direct exchange ä»‹ç»"></a>Direct exchange ä»‹ç»</h5><p>â€‹		å¸Œæœ›å°†æ—¥å¿—æ¶ˆæ¯å†™å…¥ç£ç›˜çš„ç¨‹åºä»…æ¥æ”¶ä¸¥é‡é”™è¯¯ï¼ˆerrrosï¼‰ï¼Œè€Œä¸å­˜å‚¨å“ªäº›è­¦å‘Šï¼ˆwarningï¼‰æˆ–ä¿¡æ¯ï¼ˆinfoï¼‰æ—¥å¿—æ¶ˆæ¯é¿å…æµªè´¹ç£ç›˜ç©ºé—´ã€‚<strong>Fanout è¿™ç§äº¤æ¢ç±»å‹å¹¶ä¸èƒ½ç»™æˆ‘ä»¬å¸¦æ¥å¾ˆå¤§çš„çµæ´»æ€§ï¼Œå®ƒåªèƒ½è¿›è¡Œæ— æ„è¯†çš„å¹¿æ’­</strong>ï¼Œåœ¨è¿™é‡Œæˆ‘ä»¬å°†ä½¿ç”¨ direct è¿™ç§ç±»å‹æ¥è¿›è¡Œæ›¿æ¢ï¼Œè¿™ç§ç±»å‹çš„å·¥ä½œæ–¹å¼æ˜¯ï¼Œæ¶ˆæ¯åªå»åˆ°å®ƒç»‘å®šçš„ routingKey é˜Ÿåˆ—ä¸­å»ã€‚</p>
<img src="/2023/02/28/RabbitMQ/Java\RabbitMQ\RabbitMQ.assets\image-20221015195638838.png" alt="image-20221015195638838" style="zoom:60%;">

<p>â€‹		åœ¨ä¸Šé¢è¿™å¼ å›¾ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ° X ç»‘å®šäº†ä¸¤ä¸ªé˜Ÿåˆ—ï¼Œç»‘å®šç±»å‹æ˜¯ directã€‚é˜Ÿåˆ— Q1 ç»‘å®šé”®ä¸º orangeï¼Œ é˜Ÿåˆ— Q2 ç»‘å®šé”®æœ‰ä¸¤ä¸ªï¼šä¸€ä¸ªç»‘å®šé”®ä¸º blackï¼Œå¦ä¸€ä¸ªç»‘å®šé”®ä¸º greenã€‚åœ¨è¿™ç§ç»‘å®šæƒ…å†µä¸‹ï¼Œç”Ÿäº§è€…å‘å¸ƒæ¶ˆæ¯åˆ° exchange ä¸Šï¼Œç»‘å®šé”®ä¸º orange çš„æ¶ˆæ¯ä¼šè¢«å‘å¸ƒåˆ°é˜Ÿåˆ— Q1ã€‚ç»‘å®šé”®ä¸º black å’Œ greençš„æ¶ˆæ¯ä¼šè¢«å‘å¸ƒåˆ°é˜Ÿåˆ— Q2ï¼Œå…¶ä»–æ¶ˆæ¯ç±»å‹çš„æ¶ˆæ¯å°†è¢«ä¸¢å¼ƒã€‚</p>
<h5 id="å¤šé‡ç»‘å®š"><a href="#å¤šé‡ç»‘å®š" class="headerlink" title="å¤šé‡ç»‘å®š"></a>å¤šé‡ç»‘å®š</h5><img src="/2023/02/28/RabbitMQ/Java\RabbitMQ\RabbitMQ.assets\image-20221015195852282.png" alt="image-20221015195852282" style="zoom:67%;">

<p>â€‹		å¦‚æœ exchange çš„ç»‘å®šç±»å‹æ˜¯ directï¼Œä½†æ˜¯å®ƒç»‘å®šçš„å¤šä¸ªé˜Ÿåˆ—çš„ key å¦‚æœéƒ½ç›¸åŒï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹è™½ç„¶ç»‘å®šç±»å‹æ˜¯ direct ä½†æ˜¯å®ƒè¡¨ç°çš„å°±å’Œ fanout æœ‰ç‚¹ç±»ä¼¼äº†ï¼Œå°±è·Ÿå¹¿æ’­å·®ä¸å¤šã€‚</p>
<h5 id="ç¤ºä¾‹"><a href="#ç¤ºä¾‹" class="headerlink" title="ç¤ºä¾‹"></a>ç¤ºä¾‹</h5><img src="/2023/02/28/RabbitMQ/Java\RabbitMQ\RabbitMQ.assets\image-20221015195948064.png" alt="image-20221015195948064" style="zoom:67%;">

<p>ReceiveLogsDirect01ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * äº¤æ¢æœºç±»å‹ï¼šdirect</span></span><br><span class="line"><span class="comment"> * æ¥æ”¶errorç±»å‹</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ReceiveLogsDirect01</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">EXCHANGE_NAME</span> <span class="operator">=</span> <span class="string">&quot;direct_logs&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">Channel</span> <span class="variable">channel</span> <span class="operator">=</span> RabbitConnectUtil.getChannel();</span><br><span class="line">        channel.exchangeDeclare(EXCHANGE_NAME, BuiltinExchangeType.DIRECT);</span><br><span class="line">        <span class="type">String</span> <span class="variable">queueName</span> <span class="operator">=</span> <span class="string">&quot;disk&quot;</span>;</span><br><span class="line">        channel.queueDeclare(queueName, <span class="literal">false</span>, <span class="literal">false</span>, <span class="literal">false</span>, <span class="literal">null</span>);</span><br><span class="line">        channel.queueBind(queueName, EXCHANGE_NAME, <span class="string">&quot;error&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;ç­‰å¾…æ¥æ”¶æ¶ˆæ¯...&quot;</span>);</span><br><span class="line">        <span class="type">DeliverCallback</span> <span class="variable">deliverCallback</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DeliverCallback</span>() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">handle</span><span class="params">(String s, Delivery delivery)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">                <span class="type">String</span> <span class="variable">message</span> <span class="operator">=</span> <span class="string">&quot;routingKey: &quot;</span> + delivery.getEnvelope().getRoutingKey() + <span class="string">&quot; : &quot;</span> + <span class="string">&quot;æ¶ˆæ¯ï¼š&quot;</span> + delivery.getEnvelope();</span><br><span class="line">                FileUtils.writeStringToFile(<span class="keyword">new</span> <span class="title class_">File</span>(<span class="string">&quot;C:\\rabbit.txt&quot;</span>), message);</span><br><span class="line">                System.out.println(<span class="string">&quot;é”™è¯¯æ—¥å¿—å·²ç»æ¥æ”¶...&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">        <span class="type">CancelCallback</span> <span class="variable">cancelCallback</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CancelCallback</span>() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">handle</span><span class="params">(String s)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">        channel.basicConsume(queueName, <span class="literal">true</span>, deliverCallback, cancelCallback);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ReceiveLogsDirect02ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * äº¤æ¢æœºç±»å‹ï¼šdirect</span></span><br><span class="line"><span class="comment"> * æ¥æ”¶infoï¼Œwarnç±»å‹</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ReceiveLogsDirect02</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">EXCHANGE_NAME</span> <span class="operator">=</span> <span class="string">&quot;direct_logs&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">Channel</span> <span class="variable">channel</span> <span class="operator">=</span> RabbitConnectUtil.getChannel();</span><br><span class="line">        channel.exchangeDeclare(EXCHANGE_NAME, BuiltinExchangeType.DIRECT);</span><br><span class="line">        <span class="type">String</span> <span class="variable">queueName</span> <span class="operator">=</span> <span class="string">&quot;console&quot;</span>;</span><br><span class="line">        channel.queueDeclare(queueName, <span class="literal">false</span>, <span class="literal">false</span>, <span class="literal">false</span>, <span class="literal">null</span>);</span><br><span class="line">        channel.queueBind(queueName, EXCHANGE_NAME, <span class="string">&quot;info&quot;</span>);</span><br><span class="line">        channel.queueBind(queueName, EXCHANGE_NAME, <span class="string">&quot;warn&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;ç­‰å¾…æ¥æ”¶æ¶ˆæ¯...&quot;</span>);</span><br><span class="line">        <span class="type">DeliverCallback</span> <span class="variable">deliverCallback</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DeliverCallback</span>() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">handle</span><span class="params">(String s, Delivery delivery)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">                <span class="type">String</span> <span class="variable">message</span> <span class="operator">=</span> <span class="string">&quot;routingKey: &quot;</span> + delivery.getEnvelope().getRoutingKey() + <span class="string">&quot; : &quot;</span> + <span class="string">&quot;æ¶ˆæ¯ï¼š&quot;</span> + <span class="keyword">new</span> <span class="title class_">String</span>(delivery.getBody());</span><br><span class="line">                System.out.println(message);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">        <span class="type">CancelCallback</span> <span class="variable">cancelCallback</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CancelCallback</span>() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">handle</span><span class="params">(String s)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">        channel.basicConsume(queueName, <span class="literal">true</span>, deliverCallback, cancelCallback);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>EmitLogDirectï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * äº¤æ¢æœºç±»å‹ï¼šdirect</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">EmitLogDirect</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">EXCHANGE_NAME</span> <span class="operator">=</span> <span class="string">&quot;direct_logs&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">Channel</span> <span class="variable">channel</span> <span class="operator">=</span> RabbitConnectUtil.getChannel();</span><br><span class="line">        channel.exchangeDeclare(EXCHANGE_NAME, BuiltinExchangeType.DIRECT);</span><br><span class="line">        Map&lt;String, String&gt; dataBindingMap = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        dataBindingMap.put(<span class="string">&quot;info&quot;</span>, <span class="string">&quot;info_message&quot;</span>);</span><br><span class="line">        dataBindingMap.put(<span class="string">&quot;error&quot;</span>, <span class="string">&quot;error_message&quot;</span>);</span><br><span class="line">        dataBindingMap.put(<span class="string">&quot;warn&quot;</span>, <span class="string">&quot;warn_message&quot;</span>);</span><br><span class="line">        dataBindingMap.put(<span class="string">&quot;debug&quot;</span>, <span class="string">&quot;debug_message&quot;</span>);</span><br><span class="line">        <span class="keyword">for</span> (Map.Entry&lt;String, String&gt; entry : dataBindingMap.entrySet()) &#123;</span><br><span class="line">            channel.basicPublish(EXCHANGE_NAME, entry.getKey(), <span class="literal">null</span>, </span><br><span class="line">                                 entry.getValue().getBytes());</span><br><span class="line">            System.out.println(<span class="string">&quot;ç”Ÿäº§è€…å‘é€æ¶ˆæ¯ï¼š&quot;</span> + entry.getValue());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h4 id="Topics"><a href="#Topics" class="headerlink" title="Topics"></a>Topics</h4><p>â€‹		å°½ç®¡ä½¿ç”¨ direct äº¤æ¢æœºæ”¹è¿›äº†ç³»ç»Ÿï¼Œä½†æ˜¯å®ƒä»ç„¶å­˜åœ¨å±€é™æ€§ã€‚æ¯”æ–¹è¯´æˆ‘ä»¬æƒ³æ¥æ”¶çš„æ—¥å¿—ç±»å‹æœ‰ info.base å’Œ info.advantageï¼ŒæŸä¸ªé˜Ÿåˆ—åªæƒ³ info.base çš„æ¶ˆæ¯ï¼Œé‚£è¿™ä¸ªæ—¶å€™ direct å°±åŠä¸åˆ°äº†ã€‚è¿™ä¸ªæ—¶å€™ å°±åªèƒ½ä½¿ç”¨ topic ç±»å‹</p>
<h5 id="Topic-çš„è¦æ±‚"><a href="#Topic-çš„è¦æ±‚" class="headerlink" title="Topic çš„è¦æ±‚"></a>Topic çš„è¦æ±‚</h5><p>â€‹		å‘é€åˆ°ç±»å‹æ˜¯ topic äº¤æ¢æœºçš„æ¶ˆæ¯çš„ routing_key ä¸èƒ½éšæ„å†™ï¼Œå¿…é¡»æ»¡è¶³ä¸€å®šçš„è¦æ±‚ï¼Œå®ƒå¿…é¡»æ˜¯ä¸€ä¸ªå•è¯åˆ—è¡¨ï¼Œä»¥ç‚¹å·åˆ†éš”å¼€ã€‚è¿™äº›å•è¯å¯ä»¥æ˜¯ä»»æ„å•è¯ï¼Œæ¯”å¦‚è¯´ï¼šâ€stock.usd.nyseâ€ï¼Œâ€nyse.vmwâ€ï¼Œâ€quick.orange.rabbitâ€ è¿™ç§ç±»å‹çš„ã€‚å½“ç„¶è¿™ä¸ªå•è¯åˆ—è¡¨æœ€å¤šä¸èƒ½è¶…è¿‡ 255 ä¸ªå­—èŠ‚ã€‚ </p>
<p>â€‹		åœ¨è¿™ä¸ªè§„åˆ™åˆ—è¡¨ä¸­ï¼Œ *ï¼ˆæ˜Ÿå·ï¼‰å¯ä»¥ä»£æ›¿ä¸€ä¸ªå•è¯ï¼Œ# å¯ä»¥æ›¿ä»£é›¶ä¸ªæˆ–å¤šä¸ªå•è¯ã€‚</p>
<h5 id="Topics-åŒ¹é…ç¤ºä¾‹"><a href="#Topics-åŒ¹é…ç¤ºä¾‹" class="headerlink" title="Topics åŒ¹é…ç¤ºä¾‹"></a>Topics åŒ¹é…ç¤ºä¾‹</h5><img src="/2023/02/28/RabbitMQ/Java\RabbitMQ\RabbitMQ.assets\image-20221015205310433.png" alt="image-20221015205310433" style="zoom:67%;">

<p>Q1 ç»‘å®šçš„æ˜¯ ä¸­é—´å¸¦ orange å¸¦ 3 ä¸ªå•è¯çš„å­—ç¬¦ä¸²ï¼ˆ*.orange.*ï¼‰</p>
<p>Q2 ç»‘å®šçš„æ˜¯æœ€åä¸€ä¸ªå•è¯æ˜¯ rabbit çš„ 3 ä¸ªå•è¯ï¼ˆ*.*.rabbitï¼‰ ç¬¬ä¸€ä¸ªå•è¯æ˜¯ lazy çš„å¤šä¸ªå•è¯ï¼ˆlazy.#ï¼‰</p>
<ul>
<li>quick.orange.rabbi				è¢«é˜Ÿåˆ— Q1Q2 æ¥æ”¶åˆ° </li>
<li>lazy.orange.elephant 			è¢«é˜Ÿåˆ— Q1Q2 æ¥æ”¶åˆ°</li>
<li>quick.orange.fox					è¢«é˜Ÿåˆ— Q1 æ¥æ”¶åˆ°</li>
<li>lazy.brown.fox						è¢«é˜Ÿåˆ— Q2 æ¥æ”¶åˆ°</li>
<li>lazy.pink.rabbit				   	è™½ç„¶æ»¡è¶³ä¸¤ä¸ªç»‘å®šä½†åªè¢«é˜Ÿåˆ— Q2 æ¥æ”¶ä¸€æ¬¡</li>
<li>quick.brown.fox				 	ä¸åŒ¹é…ä»»ä½•ç»‘å®šä¸ä¼šè¢«ä»»ä½•é˜Ÿåˆ—æ¥æ”¶åˆ°ä¼šè¢«ä¸¢å¼ƒ</li>
<li>quick.orange.male.rabbit 	æ˜¯å››ä¸ªå•è¯ä¸åŒ¹é…ä»»ä½•ç»‘å®šä¼šè¢«ä¸¢å¼ƒ</li>
<li>lazy.orange.male.rabbit		æ˜¯å››ä¸ªå•è¯ä½†åŒ¹é… Q2</li>
</ul>
<p>éœ€è¦æ³¨æ„ï¼š</p>
<ul>
<li>å½“ä¸€ä¸ªé˜Ÿåˆ—ç»‘å®šé”®æ˜¯ #ï¼Œé‚£ä¹ˆè¿™ä¸ªé˜Ÿåˆ—å°†æ¥æ”¶æ‰€æœ‰æ•°æ®ï¼Œç±»ä¼¼äº fanoutã€‚</li>
<li>å¦‚æœé˜Ÿåˆ—ç»‘å®šé”®å½“ä¸­æ²¡æœ‰ # å’Œ * å‡ºç°ï¼Œé‚£ä¹ˆè¯¥é˜Ÿåˆ—ç»‘å®šç±»å‹ç±»ä¼¼äº directã€‚</li>
</ul>
<p>ç¤ºä¾‹ï¼š</p>
<img src="/2023/02/28/RabbitMQ/Java\RabbitMQ\RabbitMQ.assets\image-20221015211233221.png" alt="image-20221015211233221" style="zoom:80%;">

<p>EmitLogTopicï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æµ‹è¯•äº¤æ¢æœº:topic</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">EmitLogTopic</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">EXCHANGE_NAME</span> <span class="operator">=</span> <span class="string">&quot;topic_logs&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] argv)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="keyword">try</span> (<span class="type">Channel</span> <span class="variable">channel</span> <span class="operator">=</span> RabbitConnectUtil.getChannel()) &#123;</span><br><span class="line">            channel.exchangeDeclare(EXCHANGE_NAME, <span class="string">&quot;topic&quot;</span>);</span><br><span class="line">            Map&lt;String, String&gt; bindingKeyMap = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">            bindingKeyMap.put(<span class="string">&quot;quick.orange.rabbit&quot;</span>, <span class="string">&quot;è¢«é˜Ÿåˆ— Q1Q2 æ¥æ”¶åˆ°&quot;</span>);</span><br><span class="line">            bindingKeyMap.put(<span class="string">&quot;lazy.orange.elephant&quot;</span>, <span class="string">&quot;è¢«é˜Ÿåˆ— Q1Q2 æ¥æ”¶åˆ°&quot;</span>);</span><br><span class="line">            bindingKeyMap.put(<span class="string">&quot;quick.orange.fox&quot;</span>, <span class="string">&quot;è¢«é˜Ÿåˆ— Q1 æ¥æ”¶åˆ°&quot;</span>);</span><br><span class="line">            bindingKeyMap.put(<span class="string">&quot;lazy.brown.fox&quot;</span>, <span class="string">&quot;è¢«é˜Ÿåˆ— Q2 æ¥æ”¶åˆ°&quot;</span>);</span><br><span class="line">            bindingKeyMap.put(<span class="string">&quot;lazy.pink.rabbit&quot;</span>, <span class="string">&quot;è™½ç„¶æ»¡è¶³ä¸¤ä¸ªç»‘å®šä½†åªè¢«é˜Ÿåˆ— Q2 æ¥æ”¶ä¸€æ¬¡&quot;</span>);</span><br><span class="line">            bindingKeyMap.put(<span class="string">&quot;quick.brown.fox&quot;</span>, <span class="string">&quot;ä¸åŒ¹é…ä»»ä½•ç»‘å®šä¸ä¼šè¢«ä»»ä½•é˜Ÿåˆ—æ¥æ”¶åˆ°ä¼šè¢«ä¸¢å¼ƒ&quot;</span>);</span><br><span class="line">            bindingKeyMap.put(<span class="string">&quot;quick.orange.male.rabbit&quot;</span>, <span class="string">&quot;æ˜¯å››ä¸ªå•è¯ä¸åŒ¹é…ä»»ä½•ç»‘å®šä¼šè¢«ä¸¢å¼ƒ&quot;</span>);</span><br><span class="line">            bindingKeyMap.put(<span class="string">&quot;lazy.orange.male.rabbit&quot;</span>, <span class="string">&quot;æ˜¯å››ä¸ªå•è¯ä½†åŒ¹é… Q2&quot;</span>);</span><br><span class="line">            <span class="keyword">for</span> (Map.Entry&lt;String, String&gt; bindingKeyEntry : bindingKeyMap.entrySet()) &#123;</span><br><span class="line">                <span class="type">String</span> <span class="variable">bindingKey</span> <span class="operator">=</span> bindingKeyEntry.getKey();</span><br><span class="line">                <span class="type">String</span> <span class="variable">message</span> <span class="operator">=</span> bindingKeyEntry.getValue();</span><br><span class="line">                channel.basicPublish(EXCHANGE_NAME, bindingKey, <span class="literal">null</span>,</span><br><span class="line">                        message.getBytes(<span class="string">&quot;UTF-8&quot;</span>));</span><br><span class="line">                System.out.println(<span class="string">&quot;ç”Ÿäº§è€…å‘å‡ºæ¶ˆæ¯ï¼š&quot;</span> + message);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ReceiveLogsTopic01ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ReceiveLogsTopic01</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">EXCHANGE_NAME</span> <span class="operator">=</span> <span class="string">&quot;topic_logs&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] argv)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">Channel</span> <span class="variable">channel</span> <span class="operator">=</span> RabbitConnectUtil.getChannel();</span><br><span class="line">        channel.exchangeDeclare(EXCHANGE_NAME, <span class="string">&quot;topic&quot;</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">queueName</span> <span class="operator">=</span> <span class="string">&quot;Q1&quot;</span>;</span><br><span class="line">        channel.queueDeclare(queueName, <span class="literal">false</span>, <span class="literal">false</span>, <span class="literal">false</span>, <span class="literal">null</span>);</span><br><span class="line">        channel.queueBind(queueName, EXCHANGE_NAME, <span class="string">&quot;*.orange.*&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;ç­‰å¾…æ¥æ”¶æ¶ˆæ¯...&quot;</span>);</span><br><span class="line">        <span class="type">DeliverCallback</span> <span class="variable">deliverCallback</span> <span class="operator">=</span> (consumerTag, delivery) -&gt; &#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">message</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">String</span>(delivery.getBody(), <span class="string">&quot;UTF-8&quot;</span>);</span><br><span class="line">            System.out.println(<span class="string">&quot;æ¥æ”¶é˜Ÿåˆ— :&quot;</span> + queueName + <span class="string">&quot; ç»‘å®šé”®:&quot;</span> + </span><br><span class="line">                               delivery.getEnvelope().getRoutingKey() + <span class="string">&quot;, æ¶ˆæ¯:&quot;</span> + message);</span><br><span class="line">        &#125;;</span><br><span class="line">        channel.basicConsume(queueName, <span class="literal">true</span>, deliverCallback, consumerTag -&gt; &#123;&#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ReceiveLogsTopic02ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ReceiveLogsTopic02</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">EXCHANGE_NAME</span> <span class="operator">=</span> <span class="string">&quot;topic_logs&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] argv)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">Channel</span> <span class="variable">channel</span> <span class="operator">=</span> RabbitConnectUtil.getChannel();</span><br><span class="line">        channel.exchangeDeclare(EXCHANGE_NAME, <span class="string">&quot;topic&quot;</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">queueName</span> <span class="operator">=</span> <span class="string">&quot;Q1&quot;</span>;</span><br><span class="line">        channel.queueDeclare(queueName, <span class="literal">false</span>, <span class="literal">false</span>, <span class="literal">false</span>, <span class="literal">null</span>);</span><br><span class="line">        channel.queueBind(queueName, EXCHANGE_NAME, <span class="string">&quot;*.*.rabbit&quot;</span>);</span><br><span class="line">        channel.queueBind(queueName, EXCHANGE_NAME, <span class="string">&quot;lazy.#&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;ç­‰å¾…æ¥æ”¶æ¶ˆæ¯...&quot;</span>);</span><br><span class="line">        <span class="type">DeliverCallback</span> <span class="variable">deliverCallback</span> <span class="operator">=</span> (consumerTag, delivery) -&gt; &#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">message</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">String</span>(delivery.getBody(), <span class="string">&quot;UTF-8&quot;</span>);</span><br><span class="line">            System.out.println(<span class="string">&quot;æ¥æ”¶é˜Ÿåˆ— :&quot;</span> + queueName + <span class="string">&quot; ç»‘å®šé”®:&quot;</span> + </span><br><span class="line">                               delivery.getEnvelope().getRoutingKey() + <span class="string">&quot;, æ¶ˆæ¯:&quot;</span> + message);</span><br><span class="line">        &#125;;</span><br><span class="line">        channel.basicConsume(queueName, <span class="literal">true</span>, deliverCallback, consumerTag -&gt; &#123;&#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="æ­»ä¿¡é˜Ÿåˆ—"><a href="#æ­»ä¿¡é˜Ÿåˆ—" class="headerlink" title="æ­»ä¿¡é˜Ÿåˆ—"></a>æ­»ä¿¡é˜Ÿåˆ—</h3><h4 id="æ­»ä¿¡æ¦‚å¿µ"><a href="#æ­»ä¿¡æ¦‚å¿µ" class="headerlink" title="æ­»ä¿¡æ¦‚å¿µ"></a>æ­»ä¿¡æ¦‚å¿µ</h4><p>â€‹		æ­»ä¿¡ï¼Œé¡¾åæ€ä¹‰å°±æ˜¯æ— æ³•è¢«æ¶ˆè´¹çš„æ¶ˆæ¯ï¼Œå­—é¢æ„æ€å¯ä»¥è¿™æ ·ç†è§£ï¼Œä¸€èˆ¬æ¥è¯´ï¼Œproducer å°†æ¶ˆæ¯æŠ•é€’åˆ° broker æˆ–è€…ç›´æ¥åˆ° queue é‡Œäº†ï¼Œconsumer ä» queue å–å‡ºæ¶ˆæ¯è¿›è¡Œæ¶ˆè´¹ï¼Œä½†æŸäº›æ—¶å€™ç”±äºç‰¹å®šçš„åŸå› å¯¼è‡´ queue ä¸­çš„æŸäº›æ¶ˆæ¯æ— æ³•è¢«æ¶ˆè´¹ï¼Œè¿™æ ·çš„æ¶ˆæ¯å¦‚æœæ²¡æœ‰åç»­çš„å¤„ç†ï¼Œå°±å˜æˆäº†æ­»ä¿¡ï¼Œæœ‰æ­»ä¿¡è‡ªç„¶å°±æœ‰äº†æ­»ä¿¡é˜Ÿåˆ—ã€‚</p>
<p>åº”ç”¨åœºæ™¯ï¼šä¸ºäº†ä¿è¯è®¢å•ä¸šåŠ¡çš„æ¶ˆæ¯æ•°æ®ä¸ä¸¢å¤±ï¼Œéœ€è¦ä½¿ç”¨åˆ° RabbitMQ çš„æ­»ä¿¡é˜Ÿåˆ—æœºåˆ¶ï¼Œå½“æ¶ˆæ¯æ¶ˆè´¹å‘ç”Ÿå¼‚å¸¸æ—¶ï¼Œå°†æ¶ˆæ¯æŠ•å…¥æ­»ä¿¡é˜Ÿåˆ—ä¸­ï¼Œè¿˜æœ‰æ¯”å¦‚è¯´ï¼šç”¨æˆ·åœ¨å•†åŸä¸‹å•æˆåŠŸå¹¶ç‚¹å‡»å»æ”¯ä»˜ååœ¨æŒ‡å®šæ—¶é—´æœªæ”¯ä»˜æ—¶è‡ªåŠ¨å¤±æ•ˆã€‚</p>
<h4 id="æ­»ä¿¡çš„æ¥æº"><a href="#æ­»ä¿¡çš„æ¥æº" class="headerlink" title="æ­»ä¿¡çš„æ¥æº"></a>æ­»ä¿¡çš„æ¥æº</h4><ul>
<li>æ¶ˆæ¯ TTL è¿‡æœŸ</li>
<li>é˜Ÿåˆ—è¾¾åˆ°æœ€å¤§é•¿åº¦ï¼ˆé˜Ÿåˆ—æ»¡äº†ï¼Œæ— æ³•å†æ·»åŠ æ•°æ®åˆ° mq ä¸­ï¼‰ </li>
<li>æ¶ˆæ¯è¢«æ‹’ç»ï¼ˆbasic.reject æˆ– basic.nackï¼‰å¹¶ä¸” requeue&#x3D;false</li>
</ul>
<img src="/2023/02/28/RabbitMQ/Java\RabbitMQ\RabbitMQ.assets\image-20221015211807927.png" alt="image-20221015211807927" style="zoom:80%;">

<p>è¯´æ˜ï¼š</p>
<p>â€‹		äº¤æ¢æœºç±»å‹ä¸º directï¼Œåç§°ä¸º normal_exchangeï¼Œå‘å¸ƒæ¶ˆæ¯ç»™ normal_queueï¼Œæ¶ˆè´¹è€…C1ç”±äºä»¥ä¸ŠåŸå› ä¸èƒ½æ¶ˆè´¹æ¶ˆæ¯ï¼Œæœªè¢«æ¶ˆè´¹çš„æ¶ˆæ¯æˆä¸ºæ­»ä¿¡ï¼Œæ”¾å…¥é˜Ÿåˆ— dead_queue ä¸­ï¼Œç±»å‹ä¸º directï¼Œç­‰å¾…è¢«å…¶ä»–çš„æ¶ˆè´¹è€…è¿›è¡Œæ¶ˆè´¹ï¼Œè¯¥é˜Ÿåˆ—å³ä¸ºæ­»ä¿¡é˜Ÿåˆ—ã€‚</p>
<h4 id="æ­»ä¿¡é˜Ÿåˆ—ç¤ºä¾‹"><a href="#æ­»ä¿¡é˜Ÿåˆ—ç¤ºä¾‹" class="headerlink" title="æ­»ä¿¡é˜Ÿåˆ—ç¤ºä¾‹"></a>æ­»ä¿¡é˜Ÿåˆ—ç¤ºä¾‹</h4><h5 id="æ¶ˆæ¯-TTL-è¿‡æœŸ"><a href="#æ¶ˆæ¯-TTL-è¿‡æœŸ" class="headerlink" title="æ¶ˆæ¯ TTL è¿‡æœŸ"></a>æ¶ˆæ¯ TTL è¿‡æœŸ</h5><p>ç”Ÿäº§è€…ä»£ç ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ­»ä¿¡é˜Ÿåˆ—ï¼š</span></span><br><span class="line"><span class="comment"> * TTLè¿‡æœŸ</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Producer</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">NORMAL_EXCHANGE</span> <span class="operator">=</span> <span class="string">&quot;normal_exchange&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">Channel</span> <span class="variable">channel</span> <span class="operator">=</span> RabbitConnectUtil.getChannel();</span><br><span class="line">        channel.exchangeDeclare(NORMAL_EXCHANGE, BuiltinExchangeType.DIRECT);</span><br><span class="line">        <span class="comment">// è®¾ç½®æ¶ˆæ¯çš„TTLè¿‡æœŸæ—¶é—´:10S</span></span><br><span class="line">        AMQP.<span class="type">BasicProperties</span> <span class="variable">properties</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AMQP</span>.BasicProperties().builder().expiration(<span class="string">&quot;10000&quot;</span>).build();</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">message</span> <span class="operator">=</span> <span class="string">&quot;info&quot;</span> + i;</span><br><span class="line">            channel.basicPublish(NORMAL_EXCHANGE, <span class="string">&quot;name&quot;</span>, properties, message.getBytes());</span><br><span class="line">            System.out.println(<span class="string">&quot;ç”Ÿäº§è€…å‘é€æ¶ˆæ¯ï¼š&quot;</span> + message);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ¶ˆè´¹è€… C1 ä»£ç ï¼ˆå¯åŠ¨ä¹‹åå…³é—­è¯¥æ¶ˆè´¹è€…ï¼Œæ¨¡æ‹Ÿå…¶æ¥æ”¶ä¸åˆ°æ¶ˆæ¯ï¼‰</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ­»ä¿¡é˜Ÿåˆ—ï¼šTTLè¿‡æœŸ</span></span><br><span class="line"><span class="comment"> * å¯åŠ¨ä¹‹åå…³é—­è¯¥æ¶ˆè´¹è€…ï¼Œæ¨¡æ‹Ÿå…¶æ¥æ”¶ä¸åˆ°æ¶ˆæ¯</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Consumer01</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">NORMAL_EXCHANGE</span> <span class="operator">=</span> <span class="string">&quot;normal_exchange&quot;</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">DEAD_EXCHANGE</span> <span class="operator">=</span> <span class="string">&quot;dead_exchange&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">Channel</span> <span class="variable">channel</span> <span class="operator">=</span> RabbitConnectUtil.getChannel();</span><br><span class="line">        <span class="comment">// å£°æ˜æ™®é€šå¯¹åˆ—å’Œæ­»ä¿¡é˜Ÿåˆ—äº¤æ¢æœº</span></span><br><span class="line">        channel.exchangeDeclare(NORMAL_EXCHANGE, BuiltinExchangeType.DIRECT);</span><br><span class="line">        channel.exchangeDeclare(DEAD_EXCHANGE, BuiltinExchangeType.DIRECT);</span><br><span class="line">        <span class="type">String</span> <span class="variable">queueName</span> <span class="operator">=</span> <span class="string">&quot;dead-queue&quot;</span>;</span><br><span class="line">        channel.queueDeclare(queueName, <span class="literal">false</span>, <span class="literal">false</span>, <span class="literal">false</span>, <span class="literal">null</span>);</span><br><span class="line">        <span class="comment">// ç»‘å®šæ­»ä¿¡é˜Ÿåˆ—å’Œäº¤æ¢æœº</span></span><br><span class="line">        channel.queueBind(queueName, DEAD_EXCHANGE, <span class="string">&quot;name02&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// æ­£å¸¸é˜Ÿåˆ—è®¾ç½®æ­»ä¿¡äº¤æ¢æœº å‚æ•° key æ˜¯å›ºå®šå€¼</span></span><br><span class="line">        HashMap&lt;String, Object&gt; params = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        params.put(<span class="string">&quot;x-dead-letter-exchange&quot;</span>, DEAD_EXCHANGE);</span><br><span class="line">        params.put(<span class="string">&quot;x-dead-letter-routing-key&quot;</span>, <span class="string">&quot;name02&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="type">String</span> <span class="variable">normalQueue</span> <span class="operator">=</span> <span class="string">&quot;normal-queue&quot;</span>;</span><br><span class="line">        channel.queueDeclare(normalQueue, <span class="literal">false</span>, <span class="literal">false</span>, <span class="literal">false</span>, params);</span><br><span class="line">        channel.queueBind(normalQueue, NORMAL_EXCHANGE, <span class="string">&quot;name&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;ç­‰å¾…æ¥æ”¶æ¶ˆæ¯.....&quot;</span>);</span><br><span class="line">        <span class="type">DeliverCallback</span> <span class="variable">deliverCallback</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DeliverCallback</span>() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">handle</span><span class="params">(String s, Delivery delivery)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">                System.out.println(<span class="keyword">new</span> <span class="title class_">String</span>(delivery.getBody()));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">        channel.basicConsume(normalQueue, <span class="literal">true</span>, deliverCallback, consumerTag -&gt; &#123;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ¶ˆè´¹è€… C2 ä»£ç ï¼ˆä»¥ä¸Šæ­¥éª¤å®Œæˆå å¯åŠ¨ C2 æ¶ˆè´¹è€… å®ƒæ¶ˆè´¹æ­»ä¿¡é˜Ÿåˆ—é‡Œé¢çš„æ¶ˆæ¯ï¼‰ </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ­»ä¿¡é˜Ÿåˆ—ï¼šTTLè¿‡æœŸ</span></span><br><span class="line"><span class="comment"> * å¯åŠ¨ C2 æ¶ˆè´¹è€…ï¼Œå®ƒæ¶ˆè´¹æ­»ä¿¡é˜Ÿåˆ—é‡Œé¢çš„æ¶ˆæ¯)</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Consumer02</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">DEAD_EXCHANGE</span> <span class="operator">=</span> <span class="string">&quot;dead_exchange&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">Channel</span> <span class="variable">channel</span> <span class="operator">=</span> RabbitConnectUtil.getChannel();</span><br><span class="line">        <span class="comment">// å£°æ˜æ™®é€šå¯¹åˆ—å’Œæ­»ä¿¡é˜Ÿåˆ—äº¤æ¢æœº</span></span><br><span class="line">        channel.exchangeDeclare(DEAD_EXCHANGE, BuiltinExchangeType.DIRECT);</span><br><span class="line">        <span class="type">String</span> <span class="variable">queueName</span> <span class="operator">=</span> <span class="string">&quot;dead-queue&quot;</span>;</span><br><span class="line">        channel.queueDeclare(queueName, <span class="literal">false</span>, <span class="literal">false</span>, <span class="literal">false</span>, <span class="literal">null</span>);</span><br><span class="line">        <span class="comment">// ç»‘å®šæ­»ä¿¡é˜Ÿåˆ—å’Œäº¤æ¢æœº</span></span><br><span class="line">        channel.queueBind(queueName, DEAD_EXCHANGE, <span class="string">&quot;name02&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;ç­‰å¾…æ¥æ”¶æ¶ˆæ¯.....&quot;</span>);</span><br><span class="line">        <span class="type">DeliverCallback</span> <span class="variable">deliverCallback</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DeliverCallback</span>() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">handle</span><span class="params">(String s, Delivery delivery)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;æ­»ä¿¡é˜Ÿåˆ—æ¥æ”¶æ¶ˆæ¯ï¼š&quot;</span> + <span class="keyword">new</span> <span class="title class_">String</span>(delivery.getBody()));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">        channel.basicConsume(queueName, <span class="literal">true</span>, deliverCallback, consumerTag -&gt; &#123;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æµ‹è¯•ï¼š</p>
<p>â€‹		å…ˆå¯åŠ¨æ¶ˆè´¹è€…C1ï¼Œä¹‹åå…³é—­ï¼Œå†å¯åŠ¨ç”Ÿäº§è€…ï¼š</p>
<img src="/2023/02/28/RabbitMQ/Java\RabbitMQ\RabbitMQ.assets\image-20221015232300156.png" alt="image-20221015232300156" style="zoom:80%;">

<p>å‘ç° normal_queue ä¸­çš„æ¶ˆæ¯å·²ç»è½¬ç§»åˆ°dead_queueä¸­ã€‚</p>
<p>æ­¤æ—¶å¯åŠ¨C2æ¶ˆè´¹è€…ï¼Œå‘ç°C2æ¶ˆè´¹äº†æ¶ˆæ¯ã€‚</p>
<h5 id="é˜Ÿåˆ—è¾¾åˆ°æœ€å¤§é•¿åº¦"><a href="#é˜Ÿåˆ—è¾¾åˆ°æœ€å¤§é•¿åº¦" class="headerlink" title="é˜Ÿåˆ—è¾¾åˆ°æœ€å¤§é•¿åº¦"></a>é˜Ÿåˆ—è¾¾åˆ°æœ€å¤§é•¿åº¦</h5><p>æ¶ˆæ¯ç”Ÿäº§è€…ä»£ç å»æ‰ TTL å±æ€§ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Producer02</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">NORMAL_EXCHANGE</span> <span class="operator">=</span> <span class="string">&quot;normal_exchange&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">Channel</span> <span class="variable">channel</span> <span class="operator">=</span> RabbitConnectUtil.getChannel();</span><br><span class="line">        channel.exchangeDeclare(NORMAL_EXCHANGE, BuiltinExchangeType.DIRECT);</span><br><span class="line">        <span class="comment">// è®¾ç½®æ¶ˆæ¯çš„TTLè¿‡æœŸæ—¶é—´:10S</span></span><br><span class="line">        <span class="comment">// AMQP.BasicProperties properties = new </span></span><br><span class="line">        <span class="comment">// 					AMQP.BasicProperties().builder().expiration(&quot;10000&quot;).build();</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">message</span> <span class="operator">=</span> <span class="string">&quot;info&quot;</span> + i;</span><br><span class="line">            channel.basicPublish(NORMAL_EXCHANGE, <span class="string">&quot;name&quot;</span>, <span class="literal">null</span>, message.getBytes());</span><br><span class="line">            System.out.println(<span class="string">&quot;ç”Ÿäº§è€…å‘é€æ¶ˆæ¯ï¼š&quot;</span> + message);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ¶ˆè´¹è€…C1ä¿®æ”¹é˜Ÿåˆ—é•¿åº¦é™åˆ¶ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">HashMap&lt;String, Object&gt; params = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">      params.put(<span class="string">&quot;x-dead-letter-exchange&quot;</span>, DEAD_EXCHANGE);</span><br><span class="line">      params.put(<span class="string">&quot;x-dead-letter-routing-key&quot;</span>, <span class="string">&quot;name02&quot;</span>);</span><br><span class="line">      <span class="comment">// è®¾ç½®æ­£å¸¸é˜Ÿåˆ—çš„é•¿åº¦é™åˆ¶</span></span><br><span class="line">      params.put(<span class="string">&quot;x-max-length&quot;</span>, <span class="number">6</span>);</span><br><span class="line">      <span class="type">String</span> <span class="variable">normalQueue</span> <span class="operator">=</span> <span class="string">&quot;normal-queue&quot;</span>;</span><br><span class="line">      channel.queueDeclare(normalQueue, <span class="literal">false</span>, <span class="literal">false</span>, <span class="literal">false</span>, params);</span><br><span class="line">      channel.queueBind(normalQueue, NORMAL_EXCHANGE, <span class="string">&quot;name&quot;</span>);</span><br><span class="line">      System.out.println(<span class="string">&quot;ç­‰å¾…æ¥æ”¶æ¶ˆæ¯.....&quot;</span>);</span><br></pre></td></tr></table></figure>

<p>åˆ é™¤åŸå…ˆé˜Ÿåˆ—è¿›è¡Œæµ‹è¯•ï¼š</p>
<p>å‘ç° normal_queue ä¸­æœ‰6æ¡æ•°æ®ï¼Œdead_queue ä¸­æœ‰4æ¡æ•°æ®ã€‚</p>
<p><img src="/2023/02/28/RabbitMQ/Java\RabbitMQ\RabbitMQ.assets\image-20221015233528463.png" alt="image-20221015233528463"></p>
<p>å¯åŠ¨ C2 æ¶ˆè´¹è€…ï¼š</p>
<p><img src="/2023/02/28/RabbitMQ/Java\RabbitMQ\RabbitMQ.assets\image-20221015233649967.png" alt="image-20221015233649967"></p>
<h5 id="æ¶ˆæ¯è¢«æ‹’"><a href="#æ¶ˆæ¯è¢«æ‹’" class="headerlink" title="æ¶ˆæ¯è¢«æ‹’"></a>æ¶ˆæ¯è¢«æ‹’</h5><p>ä¿®æ”¹ C1 æ¶ˆè´¹è€…ä»£ç ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ­»ä¿¡é˜Ÿåˆ—ï¼šæ¶ˆæ¯è¢«æ‹’</span></span><br><span class="line"><span class="comment"> * å¯åŠ¨ä¹‹åå…³é—­è¯¥æ¶ˆè´¹è€…ï¼Œæ¨¡æ‹Ÿå…¶æ¥æ”¶ä¸åˆ°æ¶ˆæ¯</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Consumer03</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">NORMAL_EXCHANGE</span> <span class="operator">=</span> <span class="string">&quot;normal_exchange&quot;</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">DEAD_EXCHANGE</span> <span class="operator">=</span> <span class="string">&quot;dead_exchange&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">Channel</span> <span class="variable">channel</span> <span class="operator">=</span> RabbitConnectUtil.getChannel();</span><br><span class="line">        <span class="comment">// å£°æ˜æ™®é€šå¯¹åˆ—å’Œæ­»ä¿¡é˜Ÿåˆ—äº¤æ¢æœº</span></span><br><span class="line">        channel.exchangeDeclare(NORMAL_EXCHANGE, BuiltinExchangeType.DIRECT);</span><br><span class="line">        channel.exchangeDeclare(DEAD_EXCHANGE, BuiltinExchangeType.DIRECT);</span><br><span class="line">        <span class="type">String</span> <span class="variable">queueName</span> <span class="operator">=</span> <span class="string">&quot;dead-queue&quot;</span>;</span><br><span class="line">        channel.queueDeclare(queueName, <span class="literal">false</span>, <span class="literal">false</span>, <span class="literal">false</span>, <span class="literal">null</span>);</span><br><span class="line">        <span class="comment">// ç»‘å®šæ­»ä¿¡é˜Ÿåˆ—å’Œäº¤æ¢æœº</span></span><br><span class="line">        channel.queueBind(queueName, DEAD_EXCHANGE, <span class="string">&quot;name02&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// æ­£å¸¸é˜Ÿåˆ—è®¾ç½®æ­»ä¿¡äº¤æ¢æœº å‚æ•° key æ˜¯å›ºå®šå€¼</span></span><br><span class="line">        HashMap&lt;String, Object&gt; params = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        params.put(<span class="string">&quot;x-dead-letter-exchange&quot;</span>, DEAD_EXCHANGE);</span><br><span class="line">        params.put(<span class="string">&quot;x-dead-letter-routing-key&quot;</span>, <span class="string">&quot;name02&quot;</span>);</span><br><span class="line">        <span class="comment">// è®¾ç½®æ­£å¸¸é˜Ÿåˆ—çš„é•¿åº¦é™åˆ¶</span></span><br><span class="line">        params.put(<span class="string">&quot;x-max-length&quot;</span>, <span class="number">6</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">normalQueue</span> <span class="operator">=</span> <span class="string">&quot;normal-queue&quot;</span>;</span><br><span class="line">        channel.queueDeclare(normalQueue, <span class="literal">false</span>, <span class="literal">false</span>, <span class="literal">false</span>, params);</span><br><span class="line">        channel.queueBind(normalQueue, NORMAL_EXCHANGE, <span class="string">&quot;name&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;ç­‰å¾…æ¥æ”¶æ¶ˆæ¯.....&quot;</span>);</span><br><span class="line">        <span class="type">DeliverCallback</span> <span class="variable">deliverCallback</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DeliverCallback</span>() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">handle</span><span class="params">(String s, Delivery delivery)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">                <span class="type">String</span> <span class="variable">message</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">String</span>(delivery.getBody());</span><br><span class="line">                <span class="keyword">if</span> (<span class="string">&quot;info5&quot;</span>.equals(message)) &#123;</span><br><span class="line">                    System.out.println(<span class="string">&quot;æ¥æ”¶åˆ°æ¶ˆæ¯: &quot;</span> + message + <span class="string">&quot; ï¼Œå¹¶æ‹’ç»ç­¾æ”¶è¯¥æ¶ˆæ¯&quot;</span>);</span><br><span class="line">                    <span class="comment">// requeue è®¾ç½®ä¸º false ä»£è¡¨æ‹’ç»é‡æ–°å…¥é˜Ÿï¼Œè¯¥é˜Ÿåˆ—å¦‚æœé…ç½®äº†æ­»ä¿¡äº¤æ¢æœºå°†å‘é€åˆ°æ­»ä¿¡é˜Ÿåˆ—ä¸­</span></span><br><span class="line">                    channel.basicReject(delivery.getEnvelope().getDeliveryTag(),<span class="literal">false</span>);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">// æ‰‹åŠ¨åº”ç­”</span></span><br><span class="line">                <span class="keyword">else</span>&#123;</span><br><span class="line">                    System.out.println(<span class="string">&quot;æ¥æ”¶åˆ°æ¶ˆæ¯: &quot;</span>+message);</span><br><span class="line">                    channel.basicAck(delivery.getEnvelope().getDeliveryTag(), <span class="literal">false</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">        <span class="type">boolean</span> <span class="variable">autoAck</span> <span class="operator">=</span> <span class="literal">false</span>;</span><br><span class="line">        channel.basicConsume(normalQueue, autoAck, deliverCallback, consumerTag -&gt; &#123;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æµ‹è¯•ï¼š</p>
<p>â€‹		å¯åŠ¨æ¶ˆè´¹è€… C1ï¼ŒC2ï¼Œå†å¯åŠ¨ç”Ÿäº§è€…ï¼Œå‘ç° C2 ç­¾æ”¶äº† C1 æ‹’ç»çš„æ¶ˆæ¯ã€‚</p>
<h3 id="å»¶è¿Ÿé˜Ÿåˆ—"><a href="#å»¶è¿Ÿé˜Ÿåˆ—" class="headerlink" title="å»¶è¿Ÿé˜Ÿåˆ—"></a>å»¶è¿Ÿé˜Ÿåˆ—</h3><h4 id="æ¦‚å¿µ"><a href="#æ¦‚å¿µ" class="headerlink" title="æ¦‚å¿µ"></a>æ¦‚å¿µ</h4><p>â€‹		å»¶æ—¶é˜Ÿåˆ—ï¼Œé˜Ÿåˆ—å†…éƒ¨æ˜¯æœ‰åºçš„ï¼Œæœ€é‡è¦çš„ç‰¹æ€§å°±ä½“ç°åœ¨å®ƒçš„å»¶æ—¶å±æ€§ä¸Šï¼Œå»¶æ—¶é˜Ÿåˆ—ä¸­çš„å…ƒç´ æ˜¯å¸Œæœ›åœ¨æŒ‡å®šæ—¶é—´åˆ°äº†ä»¥åæˆ–ä¹‹å‰å–å‡ºå’Œå¤„ç†ï¼Œç®€å•æ¥è¯´ï¼Œå»¶æ—¶é˜Ÿåˆ—å°±æ˜¯ç”¨æ¥å­˜æ”¾éœ€è¦åœ¨æŒ‡å®šæ—¶é—´è¢«å¤„ç†çš„å…ƒç´ çš„é˜Ÿåˆ—ã€‚</p>
<h4 id="å»¶è¿Ÿé˜Ÿåˆ—ä½¿ç”¨åœºæ™¯"><a href="#å»¶è¿Ÿé˜Ÿåˆ—ä½¿ç”¨åœºæ™¯" class="headerlink" title="å»¶è¿Ÿé˜Ÿåˆ—ä½¿ç”¨åœºæ™¯"></a>å»¶è¿Ÿé˜Ÿåˆ—ä½¿ç”¨åœºæ™¯</h4><ol>
<li>è®¢å•åœ¨ååˆ†é’Ÿä¹‹å†…æœªæ”¯ä»˜åˆ™è‡ªåŠ¨å–æ¶ˆ</li>
<li>æ–°åˆ›å»ºçš„åº—é“ºï¼Œå¦‚æœåœ¨åå¤©å†…éƒ½æ²¡æœ‰ä¸Šä¼ è¿‡å•†å“ï¼Œåˆ™è‡ªåŠ¨å‘é€æ¶ˆæ¯æé†’</li>
<li>ç”¨æˆ·æ³¨å†ŒæˆåŠŸåï¼Œå¦‚æœä¸‰å¤©å†…æ²¡æœ‰ç™»é™†åˆ™è¿›è¡ŒçŸ­ä¿¡æé†’</li>
<li>ç”¨æˆ·å‘èµ·é€€æ¬¾ï¼Œå¦‚æœä¸‰å¤©å†…æ²¡æœ‰å¾—åˆ°å¤„ç†åˆ™é€šçŸ¥ç›¸å…³è¿è¥äººå‘˜</li>
<li>é¢„å®šä¼šè®®åï¼Œéœ€è¦åœ¨é¢„å®šçš„æ—¶é—´ç‚¹å‰ååˆ†é’Ÿé€šçŸ¥å„ä¸ªä¸ä¼šäººå‘˜å‚åŠ ä¼šè®®</li>
</ol>
<p>â€‹		<strong>è¿™äº›åœºæ™¯éƒ½æœ‰ä¸€ä¸ªç‰¹ç‚¹ï¼Œéœ€è¦åœ¨æŸä¸ªäº‹ä»¶å‘ç”Ÿä¹‹åæˆ–è€…ä¹‹å‰çš„æŒ‡å®šæ—¶é—´ç‚¹å®ŒæˆæŸä¸€é¡¹ä»»åŠ¡</strong>ï¼Œå¦‚ï¼š å‘ç”Ÿè®¢å•ç”Ÿæˆäº‹ä»¶ï¼Œåœ¨ååˆ†é’Ÿä¹‹åæ£€æŸ¥è¯¥è®¢å•æ”¯ä»˜çŠ¶æ€ï¼Œç„¶åå°†æœªæ”¯ä»˜çš„è®¢å•è¿›è¡Œå…³é—­ï¼›çœ‹èµ·æ¥ä¼¼ä¹ä½¿ç”¨å®šæ—¶ä»»åŠ¡ï¼Œä¸€ç›´è½®è¯¢æ•°æ®ï¼Œæ¯ç§’æŸ¥ä¸€æ¬¡ï¼Œå–å‡ºéœ€è¦è¢«å¤„ç†çš„æ•°æ®ï¼Œç„¶åå¤„ç†ä¸å°±å®Œäº‹äº†å—ï¼Ÿå¦‚æœ æ•°æ®é‡æ¯”è¾ƒå°‘ï¼Œç¡®å®å¯ä»¥è¿™æ ·åšï¼Œæ¯”å¦‚ï¼šå¯¹äº â€œå¦‚æœè´¦å•ä¸€å‘¨å†…æœªæ”¯ä»˜åˆ™è¿›è¡Œè‡ªåŠ¨ç»“ç®—â€ è¿™æ ·çš„éœ€æ±‚ï¼Œ å¦‚æœå¯¹äºæ—¶é—´ä¸æ˜¯ä¸¥æ ¼é™åˆ¶ï¼Œè€Œæ˜¯å®½æ¾æ„ä¹‰ä¸Šçš„ä¸€å‘¨ï¼Œé‚£ä¹ˆæ¯å¤©æ™šä¸Šè·‘ä¸ªå®šæ—¶ä»»åŠ¡æ£€æŸ¥ä¸€ä¸‹æ‰€æœ‰æœªæ”¯ä»˜çš„è´¦å•ï¼Œç¡®å®ä¹Ÿæ˜¯ä¸€ä¸ªå¯è¡Œçš„æ–¹æ¡ˆã€‚<strong>ä½†å¯¹äºæ•°æ®é‡æ¯”è¾ƒå¤§ï¼Œå¹¶ä¸”æ—¶æ•ˆæ€§è¾ƒå¼ºçš„åœºæ™¯</strong>ï¼Œå¦‚ï¼šâ€œè®¢å•å åˆ†é’Ÿå†…æœªæ”¯ä»˜åˆ™å…³é—­â€œï¼ŒçŸ­æœŸå†…æœªæ”¯ä»˜çš„è®¢å•æ•°æ®å¯èƒ½ä¼šæœ‰å¾ˆå¤šï¼Œæ´»åŠ¨æœŸé—´ç”šè‡³ä¼šè¾¾åˆ°ç™¾ä¸‡ç”šè‡³åƒä¸‡çº§åˆ«ï¼Œå¯¹è¿™ä¹ˆåºå¤§çš„æ•°æ®é‡ä»æ—§ä½¿ç”¨è½®è¯¢çš„æ–¹å¼æ˜¾ç„¶æ˜¯ä¸å¯å–çš„ï¼Œå¾ˆå¯èƒ½åœ¨ä¸€ç§’å†…æ— æ³•å®Œæˆæ‰€æœ‰è®¢å•çš„æ£€æŸ¥ï¼ŒåŒæ—¶ä¼šç»™æ•°æ®åº“å¸¦æ¥å¾ˆå¤§å‹åŠ›ï¼Œæ— æ³•æ»¡è¶³ä¸šåŠ¡è¦æ±‚è€Œä¸”æ€§èƒ½ä½ä¸‹ã€‚</p>
<img src="/2023/02/28/RabbitMQ/Java\RabbitMQ\RabbitMQ.assets\image-20221016001651743.png" alt="image-20221016001651743" style="zoom:80%;">

<h4 id="RabbitMQ-ä¸­çš„-TTL"><a href="#RabbitMQ-ä¸­çš„-TTL" class="headerlink" title="RabbitMQ ä¸­çš„ TTL"></a>RabbitMQ ä¸­çš„ TTL</h4><p>â€‹		TTL æ˜¯ RabbitMQ ä¸­ä¸€ä¸ªæ¶ˆæ¯æˆ–è€…é˜Ÿåˆ—çš„å±æ€§ï¼Œè¡¨æ˜ä¸€æ¡æ¶ˆæ¯æˆ–è€…è¯¥é˜Ÿåˆ—ä¸­çš„æ‰€æœ‰æ¶ˆæ¯çš„æœ€å¤§å­˜æ´»æ—¶é—´ï¼Œå•ä½æ˜¯æ¯«ç§’ã€‚æ¢å¥è¯è¯´ï¼Œå¦‚æœä¸€æ¡æ¶ˆæ¯è®¾ç½®äº† TTL å±æ€§æˆ–è€…è¿›å…¥äº†è®¾ç½® TTL å±æ€§çš„é˜Ÿåˆ—ï¼Œé‚£ä¹ˆè¿™æ¡æ¶ˆæ¯å¦‚æœåœ¨ TTL è®¾ç½®çš„æ—¶é—´å†…æ²¡æœ‰è¢«æ¶ˆè´¹ï¼Œåˆ™ä¼šæˆä¸º â€œæ­»ä¿¡â€ã€‚<strong>å¦‚æœåŒæ—¶é…ç½®äº†é˜Ÿåˆ—çš„ TTL å’Œæ¶ˆæ¯çš„ TTLï¼Œé‚£ä¹ˆè¾ƒå°çš„é‚£ä¸ªå€¼å°†ä¼šè¢«ä½¿ç”¨</strong>ï¼Œæœ‰ä¸¤ç§æ–¹å¼è®¾ç½® TTLï¼š</p>
<p>æ¶ˆæ¯è®¾ç½®TTLï¼šï¼ˆé’ˆå¯¹æ¯æ¡æ¶ˆæ¯è®¾ç½® TTLï¼‰</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">rabbitTemplate.convertAndSend(DELAYED_EXCHANGE_NAME, DELAYED_ROUTING_KEY, message, correlationData -&gt; &#123;</span><br><span class="line">            correlationData.getMessageProperties().setExpiration(ttlTime);</span><br><span class="line">            <span class="keyword">return</span> correlationData;</span><br><span class="line">        &#125;);</span><br></pre></td></tr></table></figure>

<p>é˜Ÿåˆ—è®¾ç½® TTL ï¼šï¼ˆåˆ›å»ºé˜Ÿåˆ—çš„æ—¶å€™è®¾ç½®é˜Ÿåˆ—çš„ â€œx-message-ttlâ€ å±æ€§ï¼‰</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Bean(&quot;queueA&quot;)</span></span><br><span class="line">   <span class="keyword">public</span> Queue <span class="title function_">queueA</span><span class="params">()</span> &#123;</span><br><span class="line">       Map&lt;String, Object&gt; params = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;(<span class="number">3</span>);</span><br><span class="line">       <span class="comment">// å£°æ˜å½“å‰é˜Ÿåˆ—ç»‘å®šçš„æ­»ä¿¡äº¤æ¢æœº</span></span><br><span class="line">       params.put(<span class="string">&quot;x-dead-letter-exchange&quot;</span>, Y_DEAD_LETTER_EXCHANGE);</span><br><span class="line">       <span class="comment">// å£°æ˜å½“å‰é˜Ÿåˆ—çš„æ­»ä¿¡è·¯ç”± key</span></span><br><span class="line">       params.put(<span class="string">&quot;x-dead-letter-routing-key&quot;</span>, DEAD_LETTER_ROUTING_KEY);</span><br><span class="line">       <span class="comment">// å£°æ˜é˜Ÿåˆ—çš„ TTL</span></span><br><span class="line">       params.put(<span class="string">&quot;x-message-ttl&quot;</span>, <span class="number">10000</span>);</span><br><span class="line">       <span class="keyword">return</span> QueueBuilder.durable(QUEUE_A).withArguments(params).build();</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<p>ä¸¤è€…çš„åŒºåˆ«ï¼š</p>
<p>â€‹		å¦‚æœè®¾ç½®äº†é˜Ÿåˆ—çš„ TTL å±æ€§ï¼Œé‚£ä¹ˆä¸€æ—¦æ¶ˆæ¯è¿‡æœŸï¼Œå°±ä¼šè¢«é˜Ÿåˆ—ä¸¢å¼ƒï¼ˆå¦‚æœé…ç½®äº†æ­»ä¿¡é˜Ÿåˆ—è¢«ä¸¢åˆ°æ­»ä¿¡é˜Ÿåˆ—ä¸­ï¼‰ï¼Œè€Œç¬¬äºŒç§æ–¹å¼ï¼Œæ¶ˆæ¯å³ä½¿è¿‡æœŸï¼Œä¹Ÿä¸ä¸€å®šä¼šè¢«é©¬ä¸Šä¸¢å¼ƒï¼Œå› ä¸ºæ¶ˆæ¯æ˜¯å¦è¿‡æœŸæ˜¯åœ¨å³å°†æŠ•é€’åˆ°æ¶ˆè´¹è€…ä¹‹å‰åˆ¤å®šçš„ï¼Œå¦‚æœå½“å‰é˜Ÿåˆ—æœ‰ä¸¥é‡çš„æ¶ˆæ¯ç§¯å‹æƒ…å†µï¼Œåˆ™å·²è¿‡æœŸçš„æ¶ˆæ¯ä¹Ÿè®¸è¿˜èƒ½å­˜æ´»è¾ƒé•¿æ—¶é—´ï¼›å¦å¤–ï¼Œè¿˜éœ€è¦æ³¨æ„çš„ä¸€ç‚¹æ˜¯ï¼Œå¦‚æœä¸è®¾ç½® TTLï¼Œè¡¨ç¤ºæ¶ˆæ¯æ°¸è¿œä¸ä¼šè¿‡æœŸï¼Œå¦‚æœå°† TTL è®¾ç½®ä¸º 0ï¼Œåˆ™è¡¨ç¤ºé™¤éæ­¤æ—¶å¯ä»¥ç›´æ¥æŠ•é€’è¯¥æ¶ˆæ¯åˆ°æ¶ˆè´¹è€…ï¼Œå¦åˆ™è¯¥æ¶ˆæ¯å°†ä¼šè¢«ä¸¢å¼ƒã€‚</p>
<p>â€‹		å»¶æ—¶é˜Ÿåˆ—ï¼Œä¸å°±æ˜¯æƒ³è¦æ¶ˆæ¯å»¶è¿Ÿå¤šä¹…è¢«å¤„ç†å—ï¼ŒTTL åˆ™åˆšå¥½èƒ½è®©æ¶ˆæ¯åœ¨å»¶è¿Ÿå¤šä¹…ä¹‹åæˆä¸ºæ­»ä¿¡ï¼Œå¦ä¸€æ–¹é¢ï¼Œ æˆä¸ºæ­»ä¿¡çš„æ¶ˆæ¯éƒ½ä¼šè¢«æŠ•é€’åˆ°æ­»ä¿¡é˜Ÿåˆ—é‡Œï¼Œè¿™æ ·åªéœ€è¦æ¶ˆè´¹è€…ä¸€ç›´æ¶ˆè´¹æ­»ä¿¡é˜Ÿåˆ—é‡Œçš„æ¶ˆæ¯å°±å®Œäº‹äº†ï¼Œå› ä¸ºé‡Œé¢çš„æ¶ˆæ¯éƒ½æ˜¯å¸Œæœ›è¢«ç«‹å³å¤„ç†çš„æ¶ˆæ¯ã€‚</p>
<h4 id="æ•´åˆSpringBoot"><a href="#æ•´åˆSpringBoot" class="headerlink" title="æ•´åˆSpringBoot"></a>æ•´åˆSpringBoot</h4><p>pom.xml</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 </span></span></span><br><span class="line"><span class="string"><span class="tag">                             http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-parent<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.7.4<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">relativePath</span>/&gt;</span> <span class="comment">&lt;!-- lookup parent from repository --&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.example<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>RabbitMQSprintBoot<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">maven.compiler.source</span>&gt;</span>8<span class="tag">&lt;/<span class="name">maven.compiler.source</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">maven.compiler.target</span>&gt;</span>8<span class="tag">&lt;/<span class="name">maven.compiler.target</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--RabbitMQ ä¾èµ–--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-amqp<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>fastjson<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.2.47<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--swagger--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.springfox<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>springfox-swagger2<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.0.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.springfox<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>springfox-swagger-ui<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.9.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--RabbitMQ æµ‹è¯•ä¾èµ–--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.amqp<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-rabbit-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>application.propertiesï¼š</p>
<figure class="highlight properties"><table><tr><td class="code"><pre><span class="line"><span class="attr">spring.rabbitmq.host</span>=<span class="string">192.168.100.100</span></span><br><span class="line"><span class="attr">spring.rabbitmq.port</span>=<span class="string">5672</span></span><br><span class="line"><span class="attr">spring.rabbitmq.username</span>=<span class="string">admin</span></span><br><span class="line"><span class="attr">spring.rabbitmq.password</span>=<span class="string">admin</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># swaggeré«˜ç‰ˆæœ¬é…ç½®</span></span><br><span class="line"><span class="attr">spring.mvc.pathmatch.matching-strategy</span>=<span class="string">ant_path_matcher</span></span><br></pre></td></tr></table></figure>

<p>Swaggerï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@EnableSwagger2</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SwaggerConfig</span> &#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> Docket <span class="title function_">webApiConfig</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Docket</span>(DocumentationType.SWAGGER_2)</span><br><span class="line">                .groupName(<span class="string">&quot;webApi&quot;</span>)</span><br><span class="line">                .apiInfo(webApiInfo())</span><br><span class="line">                .select()</span><br><span class="line">                .build();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> ApiInfo <span class="title function_">webApiInfo</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ApiInfoBuilder</span>()</span><br><span class="line">                .title(<span class="string">&quot;rabbitmq æ¥å£æ–‡æ¡£&quot;</span>)</span><br><span class="line">                .description(<span class="string">&quot;æœ¬æ–‡æ¡£æè¿°äº† rabbitmq å¾®æœåŠ¡æ¥å£å®šä¹‰&quot;</span>)</span><br><span class="line">                .version(<span class="string">&quot;1.0&quot;</span>)</span><br><span class="line">                .contact(<span class="keyword">new</span> <span class="title class_">Contact</span>(<span class="string">&quot;tom&quot;</span>, <span class="string">&quot;https://gitee.com&quot;</span>,</span><br><span class="line">                        <span class="string">&quot;mineting@163.com&quot;</span>))</span><br><span class="line">                .build();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>MainApplicationï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.rabbitmq;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.SpringApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;</span><br><span class="line"></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MainApplication</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        SpringApplication.run(MainApplication.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="é˜Ÿåˆ—-TTL"><a href="#é˜Ÿåˆ—-TTL" class="headerlink" title="é˜Ÿåˆ— TTL"></a>é˜Ÿåˆ— TTL</h4><p>â€‹		åˆ›å»ºä¸¤ä¸ªé˜Ÿåˆ— QA å’Œ QBï¼Œä¸¤è€…é˜Ÿåˆ— TTL åˆ†åˆ«è®¾ç½®ä¸º 10S å’Œ 40Sï¼Œç„¶ååœ¨åˆ›å»ºä¸€ä¸ªäº¤æ¢æœº X å’Œæ­»ä¿¡äº¤ æ¢æœº Yï¼Œå®ƒä»¬çš„ç±»å‹éƒ½æ˜¯ directï¼Œåˆ›å»ºä¸€ä¸ªæ­»ä¿¡é˜Ÿåˆ— QDï¼Œï¼ˆåªåˆ›å»ºç§ä¿¡é˜Ÿåˆ—ï¼Œé¿å…è¢«å…¶ä»–é˜Ÿåˆ—æ¶ˆè´¹ï¼‰å®ƒä»¬çš„ç»‘å®šå…³ç³»å¦‚ä¸‹ï¼š</p>
<p><img src="/2023/02/28/RabbitMQ/Java\RabbitMQ\RabbitMQ.assets\image-20221019132536740.png" alt="image-20221019132536740"></p>
<h5 id="é…ç½®ç±»"><a href="#é…ç½®ç±»" class="headerlink" title="é…ç½®ç±»"></a>é…ç½®ç±»</h5><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.rabbitmq.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.amqp.core.*;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Qualifier;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TtlQueueConfig</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">X_EXCHANGE</span> <span class="operator">=</span> <span class="string">&quot;X&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">QUEUE_A</span> <span class="operator">=</span> <span class="string">&quot;QA&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">QUEUE_B</span> <span class="operator">=</span> <span class="string">&quot;QB&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">QUEUE_A_ROUTING_KEY</span> <span class="operator">=</span> <span class="string">&quot;XA&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">QUEUE_B_ROUTING_KEY</span> <span class="operator">=</span> <span class="string">&quot;XB&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">Y_DEAD_LETTER_EXCHANGE</span> <span class="operator">=</span> <span class="string">&quot;Y&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">DEAD_LETTER_QUEUE</span> <span class="operator">=</span> <span class="string">&quot;QD&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">DEAD_LETTER_ROUTING_KEY</span> <span class="operator">=</span> <span class="string">&quot;YD&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean(&quot;xExchange&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> DirectExchange <span class="title function_">xExchange</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">DirectExchange</span>(X_EXCHANGE);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean(&quot;yExchange&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> DirectExchange <span class="title function_">yExchange</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">DirectExchange</span>(Y_DEAD_LETTER_EXCHANGE);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å£°æ˜é˜Ÿåˆ— A ttl ä¸º 10s å¹¶ç»‘å®šåˆ°å¯¹åº”çš„æ­»ä¿¡äº¤æ¢æœº</span></span><br><span class="line">    <span class="meta">@Bean(&quot;queueA&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Queue <span class="title function_">queueA</span><span class="params">()</span> &#123;</span><br><span class="line">        Map&lt;String, Object&gt; params = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;(<span class="number">3</span>);</span><br><span class="line">        <span class="comment">// å£°æ˜å½“å‰é˜Ÿåˆ—ç»‘å®šçš„æ­»ä¿¡äº¤æ¢æœº</span></span><br><span class="line">        params.put(<span class="string">&quot;x-dead-letter-exchange&quot;</span>, Y_DEAD_LETTER_EXCHANGE);</span><br><span class="line">        <span class="comment">// å£°æ˜å½“å‰é˜Ÿåˆ—çš„æ­»ä¿¡è·¯ç”± key</span></span><br><span class="line">        params.put(<span class="string">&quot;x-dead-letter-routing-key&quot;</span>, DEAD_LETTER_ROUTING_KEY);</span><br><span class="line">        <span class="comment">// å£°æ˜é˜Ÿåˆ—çš„ TTL</span></span><br><span class="line">        params.put(<span class="string">&quot;x-message-ttl&quot;</span>, <span class="number">10000</span>);</span><br><span class="line">        <span class="keyword">return</span> QueueBuilder.durable(QUEUE_A).withArguments(params).build();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å£°æ˜é˜Ÿåˆ— A ç»‘å®š X äº¤æ¢æœº</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> Binding <span class="title function_">queueaBindingX</span><span class="params">(<span class="meta">@Qualifier(&quot;queueA&quot;)</span> Queue queueA,</span></span><br><span class="line"><span class="params">                                  <span class="meta">@Qualifier(&quot;xExchange&quot;)</span> DirectExchange xExchange)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> BindingBuilder.bind(queueA).to(xExchange).with(<span class="string">&quot;XA&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å£°æ˜é˜Ÿåˆ— B ttl ä¸º 40s å¹¶ç»‘å®šåˆ°å¯¹åº”çš„æ­»ä¿¡äº¤æ¢æœº</span></span><br><span class="line">    <span class="meta">@Bean(&quot;queueB&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Queue <span class="title function_">queueB</span><span class="params">()</span> &#123;</span><br><span class="line">        Map&lt;String, Object&gt; args = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;(<span class="number">3</span>);</span><br><span class="line">        <span class="comment">//å£°æ˜å½“å‰é˜Ÿåˆ—ç»‘å®šçš„æ­»ä¿¡äº¤æ¢æœº</span></span><br><span class="line">        args.put(<span class="string">&quot;x-dead-letter-exchange&quot;</span>, Y_DEAD_LETTER_EXCHANGE);</span><br><span class="line">        <span class="comment">//å£°æ˜å½“å‰é˜Ÿåˆ—çš„æ­»ä¿¡è·¯ç”± key</span></span><br><span class="line">        args.put(<span class="string">&quot;x-dead-letter-routing-key&quot;</span>, <span class="string">&quot;YD&quot;</span>);</span><br><span class="line">        <span class="comment">//å£°æ˜é˜Ÿåˆ—çš„ TTL</span></span><br><span class="line">        args.put(<span class="string">&quot;x-message-ttl&quot;</span>, <span class="number">40000</span>);</span><br><span class="line">        <span class="keyword">return</span> QueueBuilder.durable(QUEUE_B).withArguments(args).build();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å£°æ˜é˜Ÿåˆ— B ç»‘å®š X äº¤æ¢æœº</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> Binding <span class="title function_">queuebBindingX</span><span class="params">(<span class="meta">@Qualifier(&quot;queueB&quot;)</span> Queue queue1B,</span></span><br><span class="line"><span class="params">                                  <span class="meta">@Qualifier(&quot;xExchange&quot;)</span> DirectExchange xExchange)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> BindingBuilder.bind(queue1B).to(xExchange).with(<span class="string">&quot;XB&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å£°æ˜æ­»ä¿¡é˜Ÿåˆ— QD</span></span><br><span class="line">    <span class="meta">@Bean(&quot;queueD&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Queue <span class="title function_">queueD</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Queue</span>(DEAD_LETTER_QUEUE);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å£°æ˜æ­»ä¿¡é˜Ÿåˆ— QD ç»‘å®šå…³ç³»</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> Binding <span class="title function_">deadLetterBindingQAD</span><span class="params">(<span class="meta">@Qualifier(&quot;queueD&quot;)</span> Queue queueD,</span></span><br><span class="line"><span class="params">                                        <span class="meta">@Qualifier(&quot;yExchange&quot;)</span> DirectExchange yExchange)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> BindingBuilder.bind(queueD).to(yExchange).with(<span class="string">&quot;YD&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="æ¶ˆæ¯ç”Ÿäº§è€…"><a href="#æ¶ˆæ¯ç”Ÿäº§è€…" class="headerlink" title="æ¶ˆæ¯ç”Ÿäº§è€…"></a>æ¶ˆæ¯ç”Ÿäº§è€…</h5><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.rabbitmq.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.springframework.amqp.rabbit.core.RabbitTemplate;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.GetMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.PathVariable;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;ttl&quot;)</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SendMsgController</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> RabbitTemplate rabbitTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/sendMsg/&#123;message&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">sendMsg</span><span class="params">(<span class="meta">@PathVariable</span> String message)</span> &#123;</span><br><span class="line">        log.info(<span class="string">&quot;å½“å‰æ—¶é—´ï¼š&#123;&#125;,å‘é€ä¸€æ¡ä¿¡æ¯ç»™ä¸¤ä¸ª TTL é˜Ÿåˆ—:&#123;&#125;&quot;</span>, <span class="keyword">new</span> <span class="title class_">Date</span>(), message);</span><br><span class="line">        rabbitTemplate.convertAndSend(<span class="string">&quot;X&quot;</span>, <span class="string">&quot;XA&quot;</span>, <span class="string">&quot;æ¶ˆæ¯æ¥è‡ª ttl ä¸º 10S çš„é˜Ÿåˆ—: &quot;</span> + message);</span><br><span class="line">        rabbitTemplate.convertAndSend(<span class="string">&quot;X&quot;</span>, <span class="string">&quot;XB&quot;</span>, <span class="string">&quot;æ¶ˆæ¯æ¥è‡ª ttl ä¸º 40S çš„é˜Ÿåˆ—: &quot;</span> + message);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="æ¶ˆæ¯æ¶ˆè´¹è€…"><a href="#æ¶ˆæ¯æ¶ˆè´¹è€…" class="headerlink" title="æ¶ˆæ¯æ¶ˆè´¹è€…"></a>æ¶ˆæ¯æ¶ˆè´¹è€…</h5><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.rabbitmq.consumer;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.rabbitmq.client.Channel;</span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.springframework.amqp.core.Message;</span><br><span class="line"><span class="keyword">import</span> org.springframework.amqp.rabbit.annotation.RabbitListener;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DeadLetterQueueConsumer</span> &#123;</span><br><span class="line">    <span class="meta">@RabbitListener(queues = &#123;&quot;QD&quot;&#125;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">receiveD</span><span class="params">(Message message, Channel channel)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">msg</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">String</span>(message.getBody());</span><br><span class="line">        log.info(<span class="string">&quot;å½“å‰æ—¶é—´ï¼š&#123;&#125;,æ”¶åˆ°æ­»ä¿¡é˜Ÿåˆ—ä¿¡æ¯&#123;&#125;&quot;</span>, <span class="keyword">new</span> <span class="title class_">Date</span>().toString(), msg);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æµ‹è¯•ï¼šå‘é€è¯·æ±‚ <a href="http://localhost:8080/ttl/sendMsg/HelloWorld">http://localhost:8080/ttl/sendMsg/HelloWorld</a></p>
<p><img src="/2023/02/28/RabbitMQ/Java\RabbitMQ\RabbitMQ.assets\image-20221019134229276.png" alt="image-20221019134229276"></p>
<p>ç¬¬ä¸€æ¡æ¶ˆæ¯åœ¨ 10S åå˜æˆäº†æ­»ä¿¡æ¶ˆæ¯ï¼Œç„¶åè¢«æ¶ˆè´¹è€…æ¶ˆè´¹æ‰ï¼Œç¬¬äºŒæ¡æ¶ˆæ¯åœ¨ 40S ä¹‹åå˜æˆäº†æ­»ä¿¡æ¶ˆæ¯ï¼Œ ç„¶åè¢«æ¶ˆè´¹æ‰ï¼Œè¿™æ ·ä¸€ä¸ªå»¶æ—¶é˜Ÿåˆ—å°±æ‰“é€ å®Œæˆäº†ã€‚</p>
<p>å½“å‰é—®é¢˜ï¼šæ¯å¢åŠ ä¸€ä¸ªæ–°çš„æ—¶é—´éœ€æ±‚ï¼Œå°±è¦æ–°å¢ä¸€ä¸ªé˜Ÿåˆ—</p>
<h4 id="å»¶æ—¶é˜Ÿåˆ—ä¼˜åŒ–"><a href="#å»¶æ—¶é˜Ÿåˆ—ä¼˜åŒ–" class="headerlink" title="å»¶æ—¶é˜Ÿåˆ—ä¼˜åŒ–"></a>å»¶æ—¶é˜Ÿåˆ—ä¼˜åŒ–</h4><p>â€‹		åœ¨è¿™é‡Œæ–°å¢äº†ä¸€ä¸ªé˜Ÿåˆ— QCï¼Œç»‘å®šå…³ç³»å¦‚ä¸‹ï¼Œè¯¥é˜Ÿåˆ—ä¸è®¾ç½® TTL æ—¶é—´ï¼š</p>
<img src="/2023/02/28/RabbitMQ/Java\RabbitMQ\RabbitMQ.assets\image-20221019134322652.png" alt="image-20221019134322652" style="zoom:80%;">

<h5 id="é…ç½®ç±»-1"><a href="#é…ç½®ç±»-1" class="headerlink" title="é…ç½®ç±»"></a>é…ç½®ç±»</h5><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MsgTtlQueueConfig</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">Y_DEAD_LETTER_EXCHANGE</span> <span class="operator">=</span> <span class="string">&quot;Y&quot;</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">QUEUE_C</span> <span class="operator">=</span> <span class="string">&quot;QC&quot;</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">X_EXCHANGE_QUEUE_C_ROUTING_KEY</span> <span class="operator">=</span> <span class="string">&quot;XC&quot;</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">Y_DEAD_QUEUE_D_ROUTING_KEY</span> <span class="operator">=</span> <span class="string">&quot;YD&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean(&quot;queueC&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Queue <span class="title function_">queueC</span><span class="params">()</span> &#123;</span><br><span class="line">        HashMap&lt;String, Object&gt; params = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        params.put(<span class="string">&quot;x-dead-letter-exchange&quot;</span>, Y_DEAD_LETTER_EXCHANGE);</span><br><span class="line">        params.put(<span class="string">&quot;x-dead-letter-routing-key&quot;</span>, Y_DEAD_QUEUE_D_ROUTING_KEY);</span><br><span class="line">        <span class="keyword">return</span> QueueBuilder.durable(QUEUE_C).withArguments(params).build();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> Binding <span class="title function_">queuecBindingX</span><span class="params">(<span class="meta">@Qualifier(&quot;queueC&quot;)</span> Queue queue, </span></span><br><span class="line"><span class="params">                                  <span class="meta">@Qualifier(&quot;xExchange&quot;)</span> DirectExchange exchange)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> BindingBuilder.bind(queue).to(exchange).with(X_EXCHANGE_QUEUE_C_ROUTING_KEY);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="ç”Ÿäº§è€…ä»£ç "><a href="#ç”Ÿäº§è€…ä»£ç " class="headerlink" title="ç”Ÿäº§è€…ä»£ç "></a>ç”Ÿäº§è€…ä»£ç </h5><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/sendExpirationMsg/&#123;message&#125;/&#123;ttlTime&#125;&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">sendMsg</span><span class="params">(<span class="meta">@PathVariable</span> String message, <span class="meta">@PathVariable</span> String ttlTime)</span> &#123;</span><br><span class="line">    rabbitTemplate.convertAndSend(<span class="string">&quot;X&quot;</span>, <span class="string">&quot;XC&quot;</span>, message, (correlationData) -&gt; &#123;</span><br><span class="line">        correlationData.getMessageProperties().setExpiration(ttlTime);</span><br><span class="line">        <span class="keyword">return</span> correlationData;</span><br><span class="line">    &#125;);</span><br><span class="line">    log.info(<span class="string">&quot;å½“å‰æ—¶é—´ï¼š&#123;&#125;,å‘é€ä¸€æ¡æ—¶é•¿&#123;&#125;æ¯«ç§’ TTL ä¿¡æ¯ç»™é˜Ÿåˆ— C:&#123;&#125;&quot;</span>, <span class="keyword">new</span> <span class="title class_">Date</span>(), ttlTime, message);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æµ‹è¯•ï¼šä¾æ¬¡å‘é€è¯·æ±‚ï¼š</p>
<p><a href="http://localhost:8080/ttl/sendExpirationMsg/hello/20000">http://localhost:8080/ttl/sendExpirationMsg/hello/20000</a></p>
<p><a href="http://localhost:8080/ttl/sendExpirationMsg/world/2000">http://localhost:8080/ttl/sendExpirationMsg/world/2000</a></p>
<p><img src="/2023/02/28/RabbitMQ/Java\RabbitMQ\RabbitMQ.assets\image-20221019140141136.png" alt="image-20221019140141136"></p>
<p>é—®é¢˜ï¼šå¦‚æœä½¿ç”¨åœ¨æ¶ˆæ¯å±æ€§ä¸Šè®¾ç½® TTL çš„æ–¹å¼ï¼Œæ¶ˆ æ¯å¯èƒ½å¹¶ä¸ä¼šæŒ‰æ—¶ â€œæ­»äº¡â€œï¼Œå› ä¸º RabbitMQ åªä¼šæ£€æŸ¥ç¬¬ä¸€ä¸ªæ¶ˆæ¯æ˜¯å¦è¿‡æœŸï¼Œå¦‚æœè¿‡æœŸåˆ™ä¸¢åˆ°æ­»ä¿¡é˜Ÿåˆ—ï¼Œ å¦‚æœç¬¬ä¸€ä¸ªæ¶ˆæ¯çš„å»¶æ—¶æ—¶é•¿å¾ˆé•¿ï¼Œè€Œç¬¬äºŒä¸ªæ¶ˆæ¯çš„å»¶æ—¶æ—¶é•¿å¾ˆçŸ­ï¼Œç¬¬äºŒä¸ªæ¶ˆæ¯å¹¶ä¸ä¼šä¼˜å…ˆå¾—åˆ°æ‰§è¡Œã€‚</p>
<h4 id="Rabbitmq-æ’ä»¶å®ç°å»¶è¿Ÿé˜Ÿåˆ—"><a href="#Rabbitmq-æ’ä»¶å®ç°å»¶è¿Ÿé˜Ÿåˆ—" class="headerlink" title="Rabbitmq æ’ä»¶å®ç°å»¶è¿Ÿé˜Ÿåˆ—"></a>Rabbitmq æ’ä»¶å®ç°å»¶è¿Ÿé˜Ÿåˆ—</h4><p>â€‹		å¦‚æœä¸èƒ½å®ç°åœ¨æ¶ˆæ¯ç²’åº¦ä¸Šçš„ TTLï¼Œå¹¶ä½¿å…¶åœ¨è®¾ç½®çš„ TTL æ—¶é—´åŠæ—¶æ­»äº¡ï¼Œå°±æ— æ³•è®¾è®¡æˆä¸€ä¸ªé€šç”¨çš„å»¶æ—¶é˜Ÿåˆ—ã€‚é‚£å¦‚ä½•è§£å†³å‘¢ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬å°±å»è§£å†³è¯¥é—®é¢˜ã€‚</p>
<h5 id="å®‰è£…å»¶æ—¶é˜Ÿåˆ—æ’ä»¶"><a href="#å®‰è£…å»¶æ—¶é˜Ÿåˆ—æ’ä»¶" class="headerlink" title="å®‰è£…å»¶æ—¶é˜Ÿåˆ—æ’ä»¶"></a>å®‰è£…å»¶æ—¶é˜Ÿåˆ—æ’ä»¶</h5><blockquote>
<p>å®˜ç½‘ä¸‹è½½ rabbitmq_delayed_message_exchange æ’ä»¶</p>
<p>åœ°å€ï¼š<a href="https://www.rabbitmq.com/community-plugins.html">https://www.rabbitmq.com/community-plugins.html</a></p>
<p>è§£å‹æ”¾ç½®åˆ° RabbitMQ çš„æ’ä»¶ç›®å½•ã€‚ </p>
<p>è¿›å…¥ RabbitMQ çš„å®‰è£…ç›®å½•ä¸‹çš„ plgins ç›®å½•ï¼Œæ‰§è¡Œä¸‹é¢å‘½ä»¤è®©è¯¥æ’ä»¶ç”Ÿæ•ˆï¼Œç„¶åé‡å¯ RabbitMQã€‚</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">cd /usr/lib/rabbitmq/lib/rabbitmq_server-3.8.8/plugins</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">å°†ä¸‹è½½å¥½çš„æ’ä»¶æ”¾åœ¨è¿™ä¸ªç›®å½•,æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤ï¼Œä¸å¸¦ç‰ˆæœ¬å·</span></span><br><span class="line">rabbitmq-plugins enable rabbitmq_delayed_message_exchange</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">é‡å¯</span></span><br><span class="line">/sbin/service rabbitmq-server start</span><br></pre></td></tr></table></figure>

<p>æ·»åŠ æ’ä»¶ä¹‹å‰ï¼š</p>
<img src="/2023/02/28/RabbitMQ/Java\RabbitMQ\RabbitMQ.assets\image-20221019141132115.png" alt="image-20221019141132115" style="zoom:80%;">

<p>æ·»åŠ æ’ä»¶ä¹‹åï¼š</p>
<img src="/2023/02/28/RabbitMQ/Java\RabbitMQ\RabbitMQ.assets\image-20221019141640637.png" alt="image-20221019141640637" style="zoom:80%;">
</blockquote>
<h5 id="ç¤ºä¾‹-1"><a href="#ç¤ºä¾‹-1" class="headerlink" title="ç¤ºä¾‹"></a>ç¤ºä¾‹</h5><p>â€‹		æ–°å¢ä¸€ä¸ªé˜Ÿåˆ— delayed.queue,ä¸€ä¸ªè‡ªå®šä¹‰äº¤æ¢æœº delayed.exchangeï¼Œç»‘å®šå…³ç³»å¦‚ä¸‹ï¼š</p>
<img src="/2023/02/28/RabbitMQ/Java\RabbitMQ\RabbitMQ.assets\image-20221019141846272.png" alt="image-20221019141846272" style="zoom:80%;">

<p>â€‹		åœ¨æˆ‘ä»¬è‡ªå®šä¹‰çš„äº¤æ¢æœºä¸­ï¼Œè¿™æ˜¯ä¸€ç§æ–°çš„äº¤æ¢ç±»å‹ï¼Œè¯¥ç±»å‹æ¶ˆæ¯æ”¯æŒå»¶è¿ŸæŠ•é€’æœºåˆ¶ï¼Œæ¶ˆæ¯ä¼ é€’åå¹¶ä¸ä¼šç«‹å³æŠ•é€’åˆ°ç›®æ ‡é˜Ÿåˆ—ä¸­ï¼Œè€Œæ˜¯å­˜å‚¨åœ¨ mnesiaï¼ˆä¸€ä¸ªåˆ†å¸ƒå¼æ•°æ®ç³»ç»Ÿï¼‰è¡¨ä¸­ï¼Œå½“è¾¾åˆ°æŠ•é€’æ—¶é—´æ—¶ï¼Œæ‰æŠ•é€’åˆ°ç›®æ ‡é˜Ÿåˆ—ä¸­ã€‚</p>
<h5 id="é…ç½®ç±»-2"><a href="#é…ç½®ç±»-2" class="headerlink" title="é…ç½®ç±»"></a>é…ç½®ç±»</h5><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DelayedQueueConfig</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">DELAYED_QUEUE_NAME</span> <span class="operator">=</span> <span class="string">&quot;delayed.queue&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">DELAYED_EXCHANGE_NAME</span> <span class="operator">=</span> <span class="string">&quot;delayed.exchange&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">DELAYED_ROUTING_KEY</span> <span class="operator">=</span> <span class="string">&quot;delayed.routingkey&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> Queue <span class="title function_">delayedQueue</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Queue</span>(DELAYED_QUEUE_NAME);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> CustomExchange <span class="title function_">delayedExchange</span><span class="params">()</span> &#123;</span><br><span class="line">        Map&lt;String, Object&gt; args = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        args.put(<span class="string">&quot;x-delayed-type&quot;</span>, <span class="string">&quot;direct&quot;</span>);</span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * å»¶è¿Ÿäº¤æ¢æœºåç§°</span></span><br><span class="line"><span class="comment">         * äº¤æ¢æœºç±»å‹</span></span><br><span class="line"><span class="comment">         * æŒä¹…åŒ–</span></span><br><span class="line"><span class="comment">         * è‡ªåŠ¨åˆ é™¤</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">CustomExchange</span>(DELAYED_EXCHANGE_NAME, <span class="string">&quot;x-delayed-message&quot;</span>, <span class="literal">true</span>, <span class="literal">false</span>, args);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> Binding <span class="title function_">bindingDelayedQueue</span><span class="params">(<span class="meta">@Qualifier(&quot;delayedQueue&quot;)</span> Queue queue,</span></span><br><span class="line"><span class="params">                                       <span class="meta">@Qualifier(&quot;delayedExchange&quot;)</span> CustomExchange delayedExchange)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> BindingBuilder.bind(queue).to(delayedExchange).with(DELAYED_ROUTING_KEY).noargs();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="ç”Ÿäº§è€…-1"><a href="#ç”Ÿäº§è€…-1" class="headerlink" title="ç”Ÿäº§è€…"></a>ç”Ÿäº§è€…</h5><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/sendDelayedMsg/&#123;message&#125;/&#123;ttlTime&#125;&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">sendDelayedMsg</span><span class="params">(<span class="meta">@PathVariable</span> String message, <span class="meta">@PathVariable</span> String ttlTime)</span> &#123;</span><br><span class="line">    rabbitTemplate.convertAndSend(DELAYED_EXCHANGE_NAME, DELAYED_ROUTING_KEY, message, correlationData -&gt; &#123;</span><br><span class="line">        correlationData.getMessageProperties().setExpiration(ttlTime);</span><br><span class="line">        <span class="keyword">return</span> correlationData;</span><br><span class="line">    &#125;);</span><br><span class="line">    log.info(<span class="string">&quot;å½“ å‰ æ—¶ é—´ ï¼š &#123;&#125;, å‘é€ä¸€æ¡å»¶è¿Ÿ &#123;&#125; æ¯«ç§’çš„ä¿¡æ¯ç»™é˜Ÿåˆ— delayed.queue:&#123;&#125;&quot;</span>, <span class="keyword">new</span></span><br><span class="line">             <span class="title class_">Date</span>().toString(), ttlTime, message);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="æ¶ˆè´¹è€…-1"><a href="#æ¶ˆè´¹è€…-1" class="headerlink" title="æ¶ˆè´¹è€…"></a>æ¶ˆè´¹è€…</h5><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">DELAYED_QUEUE_NAME</span> <span class="operator">=</span> <span class="string">&quot;delayed.queue&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RabbitListener(queues = &#123;DELAYED_QUEUE_NAME&#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">receiveDelayedQueue</span><span class="params">(Message message)</span> &#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">msg</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">String</span>(message.getBody());</span><br><span class="line">    log.info(<span class="string">&quot;å½“å‰æ—¶é—´ï¼š&#123;&#125;ï¼Œæ”¶åˆ°å»¶æ—¶é˜Ÿåˆ—çš„æ¶ˆæ¯ï¼š&#123;&#125;&quot;</span>, <span class="keyword">new</span> <span class="title class_">Date</span>().toString(), msg);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æµ‹è¯•ï¼šä¾æ¬¡å‘é€è¯·æ±‚ï¼š</p>
<p><a href="http://localhost:8080/ttl/sendDelayedMsg/Hello/20000">http://localhost:8080/ttl/sendDelayedMsg/Hello/20000</a></p>
<p><a href="http://localhost:8080/ttl/sendDelayedMsg/world/2000">http://localhost:8080/ttl/sendDelayedMsg/world/2000</a></p>
<p><img src="/2023/02/28/RabbitMQ/Java\RabbitMQ\RabbitMQ.assets\image-20221019144719606.png" alt="image-20221019144719606"></p>
<p>ç¬¬äºŒä¸ªæ¶ˆæ¯è¢«å…ˆæ¶ˆè´¹æ‰äº†ï¼Œç¬¦åˆé¢„æœŸ</p>
<h4 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h4><blockquote>
<p>å»¶æ—¶é˜Ÿåˆ—åœ¨éœ€è¦å»¶æ—¶å¤„ç†çš„åœºæ™¯ä¸‹éå¸¸æœ‰ç”¨ï¼Œä½¿ç”¨ RabbitMQ æ¥å®ç°å»¶æ—¶é˜Ÿåˆ—å¯ä»¥å¾ˆå¥½çš„åˆ©ç”¨ RabbitMQ çš„ç‰¹æ€§ï¼Œå¦‚ï¼šæ¶ˆæ¯å¯é å‘é€ã€æ¶ˆæ¯å¯é æŠ•é€’ã€æ­»ä¿¡é˜Ÿåˆ—æ¥ä¿éšœæ¶ˆæ¯è‡³å°‘è¢«æ¶ˆè´¹ä¸€æ¬¡ä»¥åŠæœªè¢«æ­£ç¡®å¤„ç†çš„æ¶ˆæ¯ä¸ä¼šè¢«ä¸¢å¼ƒã€‚</p>
<p>å¦å¤–ï¼Œé€šè¿‡ RabbitMQ é›†ç¾¤çš„ç‰¹æ€§ï¼Œå¯ä»¥å¾ˆå¥½çš„è§£å†³å•ç‚¹æ•…éšœé—®é¢˜ï¼Œä¸ä¼šå› ä¸ºå•ä¸ªèŠ‚ç‚¹æŒ‚æ‰å¯¼è‡´å»¶æ—¶é˜Ÿåˆ—ä¸å¯ç”¨æˆ–è€…æ¶ˆæ¯ä¸¢å¤±ã€‚ å½“ç„¶ï¼Œå»¶æ—¶é˜Ÿåˆ—è¿˜æœ‰å¾ˆå¤šå…¶å®ƒé€‰æ‹©ï¼Œæ¯”å¦‚åˆ©ç”¨ Java çš„ DelayQueueï¼Œåˆ©ç”¨ Redis çš„ zsetï¼Œåˆ©ç”¨ Quartz æˆ–è€…åˆ©ç”¨ kafka çš„æ—¶é—´è½®ï¼Œè¿™äº›æ–¹å¼å„æœ‰ç‰¹ç‚¹,çœ‹éœ€è¦é€‚ç”¨çš„åœºæ™¯ã€‚</p>
</blockquote>
<h2 id="å‘å¸ƒç¡®è®¤é«˜çº§"><a href="#å‘å¸ƒç¡®è®¤é«˜çº§" class="headerlink" title="å‘å¸ƒç¡®è®¤é«˜çº§"></a>å‘å¸ƒç¡®è®¤é«˜çº§</h2><blockquote>
<p>â€‹		åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ç”±äºä¸€äº›ä¸æ˜åŸå› ï¼Œå¯¼è‡´ rabbitmq é‡å¯ï¼Œåœ¨ RabbitMQ é‡å¯æœŸé—´ç”Ÿäº§è€…æ¶ˆæ¯æŠ•é€’å¤±è´¥ï¼Œ å¯¼è‡´æ¶ˆæ¯ä¸¢å¤±ï¼Œéœ€è¦æ‰‹åŠ¨å¤„ç†å’Œæ¢å¤ã€‚äºæ˜¯ï¼Œæˆ‘ä»¬å¼€å§‹æ€è€ƒï¼Œå¦‚ä½•æ‰èƒ½è¿›è¡Œ RabbitMQ çš„æ¶ˆæ¯å¯é æŠ•é€’å‘¢ï¼Ÿ ç‰¹åˆ«æ˜¯åœ¨è¿™æ ·æ¯”è¾ƒæç«¯çš„æƒ…å†µï¼ŒRabbitMQ é›†ç¾¤ä¸å¯ç”¨çš„æ—¶å€™ï¼Œæ— æ³•æŠ•é€’çš„æ¶ˆæ¯è¯¥å¦‚ä½•å¤„ç†ï¼Ÿ</p>
<figure class="highlight tex"><table><tr><td class="code"><pre><span class="line">åº” ç”¨ [xxx] åœ¨ [08-1516:36:04] å‘ ç”Ÿ [ é”™è¯¯æ—¥å¿—å¼‚å¸¸ ] ï¼Œ alertId=[xxx] ã€‚ ç”±</span><br><span class="line">[org.springframework.amqp.rabbit.listener.BlockingQueueConsumer:start:620] è§¦å‘ã€‚</span><br><span class="line">åº”ç”¨ xxx å¯èƒ½åŸå› å¦‚ä¸‹</span><br><span class="line">æœåŠ¡åä¸ºï¼š</span><br><span class="line">å¼‚å¸¸ä¸ºï¼š org.springframework.amqp.rabbit.listener.BlockingQueueConsumer:start:620,</span><br><span class="line">äº§ ç”Ÿ åŸ å›  å¦‚ ä¸‹ :1.org.springframework.amqp.rabbit.listener.QueuesNotAvailableException:</span><br><span class="line">Cannot prepare queue for listener. Either the queue doesn&#x27;t exist or the broker will not</span><br><span class="line">allow us to use it.||Consumer received fatal=false exception on startup:</span><br></pre></td></tr></table></figure>
</blockquote>
<h3 id="å‘å¸ƒç¡®è®¤-springboot-ç‰ˆ"><a href="#å‘å¸ƒç¡®è®¤-springboot-ç‰ˆ" class="headerlink" title="å‘å¸ƒç¡®è®¤ springboot ç‰ˆ"></a>å‘å¸ƒç¡®è®¤ springboot ç‰ˆ</h3><h4 id="ç¡®è®¤æœºåˆ¶æ–¹æ¡ˆ"><a href="#ç¡®è®¤æœºåˆ¶æ–¹æ¡ˆ" class="headerlink" title="ç¡®è®¤æœºåˆ¶æ–¹æ¡ˆ"></a>ç¡®è®¤æœºåˆ¶æ–¹æ¡ˆ</h4><img src="/2023/02/28/RabbitMQ/Java\RabbitMQ\RabbitMQ.assets\image-20221019145017768.png" alt="image-20221019145017768" style="zoom:80%;">

<p><strong>ç¤ºä¾‹ï¼š</strong></p>
<img src="/2023/02/28/RabbitMQ/Java\RabbitMQ\RabbitMQ.assets\image-20221019145045146.png" alt="image-20221019145045146" style="zoom:80%;">

<h5 id="é…ç½®æ–‡ä»¶"><a href="#é…ç½®æ–‡ä»¶" class="headerlink" title="é…ç½®æ–‡ä»¶"></a>é…ç½®æ–‡ä»¶</h5><p>åœ¨é…ç½®æ–‡ä»¶å½“ä¸­éœ€è¦æ·»åŠ  <strong>spring.rabbitmq.publisher-confirm-type&#x3D;correlated</strong></p>
<blockquote>
<ul>
<li>NONE ç¦ç”¨å‘å¸ƒç¡®è®¤æ¨¡å¼ï¼Œæ˜¯é»˜è®¤å€¼</li>
<li>CORRELATED å‘å¸ƒæ¶ˆæ¯æˆåŠŸåˆ°äº¤æ¢å™¨åä¼šè§¦å‘å›è°ƒæ–¹æ³•</li>
<li>SIMPLE</li>
</ul>
<p>ç»æµ‹è¯•æœ‰ä¸¤ç§æ•ˆæœï¼Œå…¶ä¸€æ•ˆæœå’Œ CORRELATED å€¼ä¸€æ ·ä¼šè§¦å‘å›è°ƒæ–¹æ³•ï¼Œ å…¶äºŒåœ¨å‘å¸ƒæ¶ˆæ¯æˆåŠŸåä½¿ç”¨ rabbitTemplate è°ƒç”¨ waitForConfirms æˆ– waitForConfirmsOrDie æ–¹æ³• ç­‰å¾… broker èŠ‚ç‚¹è¿”å›å‘é€ç»“æœï¼Œæ ¹æ®è¿”å›ç»“æœæ¥åˆ¤å®šä¸‹ä¸€æ­¥çš„é€»è¾‘ï¼Œè¦æ³¨æ„çš„ç‚¹æ˜¯ waitForConfirmsOrDie æ–¹æ³•å¦‚æœè¿”å› false åˆ™ä¼šå…³é—­ channelï¼Œåˆ™æ¥ä¸‹æ¥æ— æ³•å‘é€æ¶ˆæ¯åˆ° brokerã€‚</p>
<figure class="highlight properties"><table><tr><td class="code"><pre><span class="line"><span class="attr">spring.rabbitmq.host</span>=<span class="string">192.168.100.100</span></span><br><span class="line"><span class="attr">spring.rabbitmq.port</span>=<span class="string">5672</span></span><br><span class="line"><span class="attr">spring.rabbitmq.username</span>=<span class="string">admin</span></span><br><span class="line"><span class="attr">spring.rabbitmq.password</span>=<span class="string">admin</span></span><br><span class="line"><span class="attr">spring.rabbitmq.publisher-confirm-type</span>=<span class="string">correlated</span></span><br></pre></td></tr></table></figure>
</blockquote>
<h5 id="é…ç½®ç±»-3"><a href="#é…ç½®ç±»-3" class="headerlink" title="é…ç½®ç±»"></a>é…ç½®ç±»</h5><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ConfirmConfig</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">CONFIRM_EXCHANGE_NAME</span> <span class="operator">=</span> <span class="string">&quot;confirm.exchange&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">CONFIRM_QUEUE_NAME</span> <span class="operator">=</span> <span class="string">&quot;confirm.queue&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean(&quot;confirmExchange&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> DirectExchange <span class="title function_">confirmExchange</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">DirectExchange</span>(CONFIRM_EXCHANGE_NAME);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean(&quot;confirmQueue&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Queue <span class="title function_">confirmQueue</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> QueueBuilder.durable(CONFIRM_QUEUE_NAME).build();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> Binding <span class="title function_">queueBinding</span><span class="params">(<span class="meta">@Qualifier(&quot;confirmQueue&quot;)</span> Queue queue,</span></span><br><span class="line"><span class="params">                                <span class="meta">@Qualifier(&quot;confirmExchange&quot;)</span> DirectExchange exchange)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> BindingBuilder.bind(queue).to(exchange).with(<span class="string">&quot;key1&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="å›è°ƒæ¥å£"><a href="#å›è°ƒæ¥å£" class="headerlink" title="å›è°ƒæ¥å£"></a>å›è°ƒæ¥å£</h5><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.rabbitmq.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.springframework.amqp.rabbit.connection.CorrelationData;</span><br><span class="line"><span class="keyword">import</span> org.springframework.amqp.rabbit.core.RabbitTemplate;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.annotation.PostConstruct;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyCallBack</span> <span class="keyword">implements</span> <span class="title class_">RabbitTemplate</span>.ConfirmCallback &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ³¨æ„éœ€è¦è®¾ç½® RabbitTemplate.ConfirmCallback çš„å€¼</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> RabbitTemplate rabbitTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@PostConstruct</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">init</span><span class="params">()</span> &#123;</span><br><span class="line">        rabbitTemplate.setConfirmCallback(<span class="built_in">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">confirm</span><span class="params">(CorrelationData correlationData, <span class="type">boolean</span> ack, String cause)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">id</span> <span class="operator">=</span> correlationData != <span class="literal">null</span> ? correlationData.getId() : <span class="string">&quot;&quot;</span>;</span><br><span class="line">        <span class="keyword">if</span> (ack) &#123;</span><br><span class="line">            log.info(<span class="string">&quot;äº¤æ¢æœºå·²ç»æ”¶åˆ° id ä¸º:&#123;&#125;çš„æ¶ˆæ¯&quot;</span>, id);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            log.info(<span class="string">&quot;äº¤æ¢æœºè¿˜æœªæ”¶åˆ° id ä¸º:&#123;&#125;æ¶ˆæ¯,ç”±äºåŸå› :&#123;&#125;&quot;</span>, id, cause);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="ç”Ÿäº§è€…-2"><a href="#ç”Ÿäº§è€…-2" class="headerlink" title="ç”Ÿäº§è€…"></a>ç”Ÿäº§è€…</h5><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/confirm&quot;)</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ProduceController</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">CONFIRM_EXCHANGE_NAME</span> <span class="operator">=</span> <span class="string">&quot;confirm.exchange&quot;</span>;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> RabbitTemplate rabbitTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;sendMessage/&#123;message&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">sendMessage</span><span class="params">(<span class="meta">@PathVariable</span> String message)</span> &#123;</span><br><span class="line">        <span class="comment">//æŒ‡å®šæ¶ˆæ¯ id ä¸º 1</span></span><br><span class="line">        <span class="type">CorrelationData</span> <span class="variable">correlationData1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CorrelationData</span>(<span class="string">&quot;1&quot;</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">routingKey</span> <span class="operator">=</span> <span class="string">&quot;key1&quot;</span>;</span><br><span class="line"></span><br><span class="line">        rabbitTemplate.convertAndSend(CONFIRM_EXCHANGE_NAME, routingKey, message + routingKey, correlationData1);</span><br><span class="line">        <span class="type">CorrelationData</span> <span class="variable">correlationData2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CorrelationData</span>(<span class="string">&quot;2&quot;</span>);</span><br><span class="line">        routingKey = <span class="string">&quot;key2&quot;</span>;</span><br><span class="line"></span><br><span class="line">        rabbitTemplate.convertAndSend(CONFIRM_EXCHANGE_NAME, routingKey, message + routingKey, correlationData2);</span><br><span class="line">        log.info(<span class="string">&quot;å‘é€æ¶ˆæ¯å†…å®¹:&#123;&#125;&quot;</span>, message);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="æ¶ˆè´¹è€…-2"><a href="#æ¶ˆè´¹è€…-2" class="headerlink" title="æ¶ˆè´¹è€…"></a>æ¶ˆè´¹è€…</h5><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ConfirmConsumer</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">CONFIRM_QUEUE_NAME</span> <span class="operator">=</span> <span class="string">&quot;confirm.queue&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RabbitListener(queues = CONFIRM_QUEUE_NAME)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">receiveMsg</span><span class="params">(Message message)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">msg</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">String</span>(message.getBody());</span><br><span class="line">        log.info(<span class="string">&quot;æ¥å—åˆ°é˜Ÿåˆ— confirm.queue æ¶ˆæ¯:&#123;&#125;&quot;</span>, msg);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æµ‹è¯•ï¼š<a href="http://localhost:8080/confirm/sendMessage/HelloWorld">http://localhost:8080/confirm/sendMessage/HelloWorld</a></p>
<img src="/2023/02/28/RabbitMQ/Java\RabbitMQ\RabbitMQ.assets\image-20221019170646211.png" alt="image-20221019170646211" style="zoom:80%;">

<p>â€‹		å¯ä»¥çœ‹åˆ°ï¼Œå‘é€äº†ä¸¤æ¡æ¶ˆæ¯ï¼Œç¬¬ä¸€æ¡æ¶ˆæ¯çš„ RoutingKey ä¸º â€œkey1â€ï¼Œç¬¬äºŒæ¡æ¶ˆæ¯çš„ RoutingKey ä¸º â€œkey2â€ï¼Œä¸¤æ¡æ¶ˆæ¯éƒ½æˆåŠŸè¢«äº¤æ¢æœºæ¥æ”¶ï¼Œä¹Ÿæ”¶åˆ°äº†äº¤æ¢æœºçš„ç¡®è®¤å›è°ƒï¼Œä½†æ¶ˆè´¹è€…åªæ”¶åˆ°äº†ä¸€æ¡æ¶ˆæ¯ï¼Œå› ä¸º ç¬¬äºŒæ¡æ¶ˆæ¯çš„ RoutingKey ä¸é˜Ÿåˆ—çš„ BindingKey ä¸ä¸€è‡´ï¼Œä¹Ÿæ²¡æœ‰å…¶å®ƒé˜Ÿåˆ—èƒ½æ¥æ”¶è¿™ä¸ªæ¶ˆæ¯ï¼Œæ‰€æœ‰ç¬¬äºŒæ¡ æ¶ˆæ¯è¢«ç›´æ¥ä¸¢å¼ƒäº†ã€‚</p>
<h4 id="å›é€€æ¶ˆæ¯"><a href="#å›é€€æ¶ˆæ¯" class="headerlink" title="å›é€€æ¶ˆæ¯"></a>å›é€€æ¶ˆæ¯</h4><h5 id="Mandatory-å‚æ•°"><a href="#Mandatory-å‚æ•°" class="headerlink" title="Mandatory å‚æ•°"></a>Mandatory å‚æ•°</h5><blockquote>
<p>â€‹		åœ¨ä»…å¼€å¯äº†ç”Ÿäº§è€…ç¡®è®¤æœºåˆ¶çš„æƒ…å†µä¸‹ï¼Œäº¤æ¢æœºæ¥æ”¶åˆ°æ¶ˆæ¯åï¼Œä¼šç›´æ¥ç»™æ¶ˆæ¯ç”Ÿäº§è€…å‘é€ç¡®è®¤æ¶ˆæ¯ï¼Œå¦‚æœå‘ç°è¯¥æ¶ˆæ¯ä¸å¯è·¯ç”±ï¼Œé‚£ä¹ˆæ¶ˆæ¯ä¼šè¢«ç›´æ¥ä¸¢å¼ƒï¼Œæ­¤æ—¶ç”Ÿäº§è€…æ˜¯ä¸çŸ¥é“æ¶ˆæ¯è¢«ä¸¢å¼ƒè¿™ä¸ªäº‹ä»¶çš„ã€‚é‚£ä¹ˆå¦‚ä½• è®©æ— æ³•è¢«è·¯ç”±çš„æ¶ˆæ¯å¸®æˆ‘æƒ³åŠæ³•å¤„ç†ä¸€ä¸‹ï¼Ÿæœ€èµ·ç é€šçŸ¥æˆ‘ä¸€å£°ï¼Œæˆ‘å¥½è‡ªå·±å¤„ç†å•Šã€‚é€šè¿‡è®¾ç½® mandatory å‚ æ•°å¯ä»¥åœ¨å½“æ¶ˆæ¯ä¼ é€’è¿‡ç¨‹ä¸­ä¸å¯è¾¾ç›®çš„åœ°æ—¶å°†æ¶ˆæ¯è¿”å›ç»™ç”Ÿäº§è€…ã€‚</p>
</blockquote>
<h5 id="é…ç½®æ–‡ä»¶-1"><a href="#é…ç½®æ–‡ä»¶-1" class="headerlink" title="é…ç½®æ–‡ä»¶"></a>é…ç½®æ–‡ä»¶</h5><figure class="highlight properties"><table><tr><td class="code"><pre><span class="line"><span class="attr">spring.rabbitmq.host</span>=<span class="string">192.168.100.100</span></span><br><span class="line"><span class="attr">spring.rabbitmq.port</span>=<span class="string">5672</span></span><br><span class="line"><span class="attr">spring.rabbitmq.username</span>=<span class="string">admin</span></span><br><span class="line"><span class="attr">spring.rabbitmq.password</span>=<span class="string">admin</span></span><br><span class="line"><span class="comment"># å‘å¸ƒç¡®è®¤</span></span><br><span class="line"><span class="attr">spring.rabbitmq.publisher-confirm-type</span>=<span class="string">correlated</span></span><br><span class="line"><span class="comment"># å›é€€ç¡®è®¤</span></span><br><span class="line"><span class="attr">spring.rabbitmq.publisher-returns</span>=<span class="string">true</span></span><br></pre></td></tr></table></figure>

<h5 id="ç”Ÿäº§è€…-3"><a href="#ç”Ÿäº§è€…-3" class="headerlink" title="ç”Ÿäº§è€…"></a>ç”Ÿäº§è€…</h5><p>æ–¹å¼ä¸€ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MessageProducer</span> <span class="keyword">implements</span> <span class="title class_">RabbitTemplate</span>.ConfirmCallback,</span><br><span class="line">RabbitTemplate.ReturnCallback &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> RabbitTemplate rabbitTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//rabbitTemplate æ³¨å…¥ä¹‹åå°±è®¾ç½®è¯¥å€¼</span></span><br><span class="line">    <span class="meta">@PostConstruct</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">init</span><span class="params">()</span> &#123;</span><br><span class="line">        rabbitTemplate.setConfirmCallback(<span class="built_in">this</span>);</span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * trueï¼š</span></span><br><span class="line"><span class="comment">         * äº¤æ¢æœºæ— æ³•å°†æ¶ˆæ¯è¿›è¡Œè·¯ç”±æ—¶ï¼Œä¼šå°†è¯¥æ¶ˆæ¯è¿”å›ç»™ç”Ÿäº§è€…</span></span><br><span class="line"><span class="comment">         * falseï¼š</span></span><br><span class="line"><span class="comment">         * å¦‚æœå‘ç°æ¶ˆæ¯æ— æ³•è¿›è¡Œè·¯ç”±ï¼Œåˆ™ç›´æ¥ä¸¢å¼ƒ</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        rabbitTemplate.setMandatory(<span class="literal">true</span>);</span><br><span class="line">        <span class="comment">//è®¾ç½®å›é€€æ¶ˆæ¯äº¤ç»™è°å¤„ç†</span></span><br><span class="line">        rabbitTemplate.setReturnCallback(<span class="built_in">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;sendMessage&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">sendMessage</span><span class="params">(String message)</span> &#123;</span><br><span class="line">        <span class="comment">//è®©æ¶ˆæ¯ç»‘å®šä¸€ä¸ª id å€¼</span></span><br><span class="line">        <span class="type">CorrelationData</span> <span class="variable">correlationData1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CorrelationData</span>(UUID.randomUUID().toString());</span><br><span class="line">        rabbitTemplate.convertAndSend(<span class="string">&quot;confirm.exchange&quot;</span>, <span class="string">&quot;key1&quot;</span>, message + <span class="string">&quot;key1&quot;</span>, correlationData1)</span><br><span class="line">        ;</span><br><span class="line">        log.info(<span class="string">&quot;å‘é€æ¶ˆæ¯ id ä¸º:&#123;&#125;å†…å®¹ä¸º&#123;&#125;&quot;</span>, correlationData1.getId(), message + <span class="string">&quot;key1&quot;</span>);</span><br><span class="line">        <span class="type">CorrelationData</span> <span class="variable">correlationData2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CorrelationData</span>(UUID.randomUUID().toString());</span><br><span class="line"></span><br><span class="line">        rabbitTemplate.convertAndSend(<span class="string">&quot;confirm.exchange&quot;</span>, <span class="string">&quot;key2&quot;</span>, message + <span class="string">&quot;key2&quot;</span>, correlationData2)</span><br><span class="line">        ;</span><br><span class="line">        log.info(<span class="string">&quot;å‘é€æ¶ˆæ¯ id ä¸º:&#123;&#125;å†…å®¹ä¸º&#123;&#125;&quot;</span>, correlationData2.getId(), message + <span class="string">&quot;key2&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">confirm</span><span class="params">(CorrelationData correlationData, <span class="type">boolean</span> ack, String cause)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">id</span> <span class="operator">=</span> correlationData != <span class="literal">null</span> ? correlationData.getId() : <span class="string">&quot;&quot;</span>;</span><br><span class="line">        <span class="keyword">if</span> (ack) &#123;</span><br><span class="line">            log.info(<span class="string">&quot;äº¤æ¢æœºæ”¶åˆ°æ¶ˆæ¯ç¡®è®¤æˆåŠŸ, id:&#123;&#125;&quot;</span>, id);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            log.error(<span class="string">&quot;æ¶ˆæ¯ id:&#123;&#125;æœªæˆåŠŸæŠ•é€’åˆ°äº¤æ¢æœº,åŸå› æ˜¯:&#123;&#125;&quot;</span>, id, cause);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">returnedMessage</span><span class="params">(Message message, <span class="type">int</span> replyCode, String replyText, String</span></span><br><span class="line"><span class="params">            exchange, String routingKey)</span> &#123;</span><br><span class="line">        log.info(<span class="string">&quot;æ¶ˆæ¯:&#123;&#125;è¢«æœåŠ¡å™¨é€€å›ï¼Œé€€å›åŸå› :&#123;&#125;, äº¤æ¢æœºæ˜¯:&#123;&#125;, è·¯ç”± key:&#123;&#125;&quot;</span>,</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">String</span>(message.getBody()), replyText, exchange, routingKey);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ–¹å¼äºŒï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyCallBack</span> <span class="keyword">implements</span> <span class="title class_">RabbitTemplate</span>.ConfirmCallback, RabbitTemplate.ReturnsCallback &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ³¨æ„éœ€è¦è®¾ç½® RabbitTemplate.ConfirmCallback çš„å€¼</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> RabbitTemplate rabbitTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@PostConstruct</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">init</span><span class="params">()</span> &#123;</span><br><span class="line">        rabbitTemplate.setConfirmCallback(<span class="built_in">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">confirm</span><span class="params">(CorrelationData correlationData, <span class="type">boolean</span> ack, String cause)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">id</span> <span class="operator">=</span> correlationData != <span class="literal">null</span> ? correlationData.getId() : <span class="string">&quot;&quot;</span>;</span><br><span class="line">        <span class="keyword">if</span> (ack) &#123;</span><br><span class="line">            log.info(<span class="string">&quot;äº¤æ¢æœºå·²ç»æ”¶åˆ° id ä¸º:&#123;&#125;çš„æ¶ˆæ¯&quot;</span>, id);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            log.info(<span class="string">&quot;äº¤æ¢æœºè¿˜æœªæ”¶åˆ° id ä¸º:&#123;&#125;æ¶ˆæ¯,ç”±äºåŸå› :&#123;&#125;&quot;</span>, id, cause);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">returnedMessage</span><span class="params">(ReturnedMessage returned)</span> &#123;</span><br><span class="line">        log.info(<span class="string">&quot;æ¶ˆæ¯:&#123;&#125;è¢«æœåŠ¡å™¨é€€å›ï¼Œé€€å›åŸå› :&#123;&#125;, äº¤æ¢æœºæ˜¯:&#123;&#125;, è·¯ç”± key:&#123;&#125;&quot;</span>,</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">String</span>(returned.getMessage().getBody()), returned.getReplyText(), </span><br><span class="line">                 returned.getExchange(), returned.getRoutingKey());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æµ‹è¯•ï¼š<a href="http://localhost:8080/confirm/sendMessage02?message=demo">http://localhost:8080/confirm/sendMessage02?message=demo</a></p>
<img src="/2023/02/28/RabbitMQ/Java\RabbitMQ\RabbitMQ.assets\image-20221019172228728.png" alt="image-20221019172228728" style="zoom:67%;">

<h4 id="å¤‡ä»½äº¤æ¢æœº"><a href="#å¤‡ä»½äº¤æ¢æœº" class="headerlink" title="å¤‡ä»½äº¤æ¢æœº"></a>å¤‡ä»½äº¤æ¢æœº</h4><blockquote>
<p>æœ‰äº† mandatory å‚æ•°å’Œå›é€€æ¶ˆæ¯ï¼Œæˆ‘ä»¬è·å¾—äº†å¯¹æ— æ³•æŠ•é€’æ¶ˆæ¯çš„æ„ŸçŸ¥èƒ½åŠ›ï¼Œæœ‰æœºä¼šåœ¨ç”Ÿäº§è€…çš„æ¶ˆæ¯æ— æ³•è¢«æŠ•é€’æ—¶å‘ç°å¹¶å¤„ç†ã€‚ä½†æœ‰æ—¶å€™ï¼Œæˆ‘ä»¬å¹¶ä¸çŸ¥é“è¯¥å¦‚ä½•å¤„ç†è¿™äº›æ— æ³•è·¯ç”±çš„æ¶ˆæ¯ï¼Œæœ€å¤šæ‰“ä¸ªæ—¥å¿—ï¼Œç„¶åè§¦å‘æŠ¥è­¦ï¼Œå†æ¥æ‰‹åŠ¨å¤„ç†ã€‚è€Œé€šè¿‡æ—¥å¿—æ¥å¤„ç†è¿™äº›æ— æ³•è·¯ç”±çš„æ¶ˆæ¯æ˜¯å¾ˆä¸ä¼˜é›…çš„åšæ³•ï¼Œç‰¹åˆ«æ˜¯å½“ç”Ÿäº§è€…æ‰€åœ¨çš„æœåŠ¡æœ‰å¤šå°æœºå™¨çš„æ—¶å€™ï¼Œæ‰‹åŠ¨å¤åˆ¶æ—¥å¿—ä¼šæ›´åŠ éº»çƒ¦è€Œä¸”å®¹æ˜“å‡ºé”™ã€‚è€Œä¸”è®¾ç½® mandatory å‚æ•°ä¼šå¢ åŠ ç”Ÿäº§è€…çš„å¤æ‚æ€§ï¼Œéœ€è¦æ·»åŠ å¤„ç†è¿™äº›è¢«é€€å›çš„æ¶ˆæ¯çš„é€»è¾‘ã€‚å¦‚æœæ—¢ä¸æƒ³ä¸¢å¤±æ¶ˆæ¯ï¼Œåˆä¸æƒ³å¢åŠ ç”Ÿäº§è€…çš„ å¤æ‚æ€§ï¼Œè¯¥æ€ä¹ˆåšå‘¢ï¼Ÿå‰é¢åœ¨è®¾ç½®æ­»ä¿¡é˜Ÿåˆ—çš„æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬æåˆ°ï¼Œå¯ä»¥ä¸ºé˜Ÿåˆ—è®¾ç½®æ­»ä¿¡äº¤æ¢æœºæ¥å­˜å‚¨é‚£äº›å¤„ç†å¤±è´¥çš„æ¶ˆæ¯ï¼Œå¯æ˜¯è¿™äº›ä¸å¯è·¯ç”±æ¶ˆæ¯æ ¹æœ¬æ²¡æœ‰æœºä¼šè¿›å…¥åˆ°é˜Ÿåˆ—ï¼Œå› æ­¤æ— æ³•ä½¿ç”¨æ­»ä¿¡é˜Ÿåˆ—æ¥ä¿å­˜æ¶ˆæ¯ã€‚ </p>
<p>åœ¨ RabbitMQ ä¸­ï¼Œæœ‰ä¸€ç§å¤‡ä»½äº¤æ¢æœºçš„æœºåˆ¶å­˜åœ¨ï¼Œå¯ä»¥å¾ˆå¥½çš„åº”å¯¹è¿™ä¸ªé—®é¢˜ã€‚ä»€ä¹ˆæ˜¯å¤‡ä»½äº¤æ¢æœºå‘¢ï¼Ÿå¤‡ä»½äº¤æ¢æœºå¯ä»¥ç†è§£ä¸º RabbitMQ ä¸­äº¤æ¢æœºçš„â€œå¤‡èƒâ€ï¼Œå½“æˆ‘ä»¬ä¸ºæŸä¸€ä¸ªäº¤æ¢æœºå£°æ˜ä¸€ä¸ªå¯¹åº”çš„å¤‡ä»½äº¤æ¢æœºæ—¶ï¼Œ å°±æ˜¯ä¸ºå®ƒåˆ›å»ºä¸€ä¸ªå¤‡èƒï¼Œ<strong>å½“äº¤æ¢æœºæ¥æ”¶åˆ°ä¸€æ¡ä¸å¯è·¯ç”±æ¶ˆæ¯æ—¶ï¼Œå°†ä¼šæŠŠè¿™æ¡æ¶ˆæ¯è½¬å‘åˆ°å¤‡ä»½äº¤æ¢æœºä¸­ï¼Œç”±å¤‡ä»½äº¤æ¢æœºæ¥è¿›è¡Œè½¬å‘å’Œå¤„ç†ï¼Œé€šå¸¸å¤‡ä»½äº¤æ¢æœºçš„ç±»å‹ä¸º Fanout ï¼Œè¿™æ ·å°±èƒ½æŠŠæ‰€æœ‰æ¶ˆæ¯éƒ½æŠ•é€’åˆ°ä¸å…¶ç»‘å®šçš„é˜Ÿåˆ—ä¸­ï¼Œç„¶åæˆ‘ä»¬åœ¨å¤‡ä»½äº¤æ¢æœºä¸‹ç»‘å®šä¸€ä¸ªé˜Ÿåˆ—ï¼Œè¿™æ ·æ‰€æœ‰é‚£äº›åŸäº¤æ¢æœºæ— æ³•è¢«è·¯ç”±çš„æ¶ˆæ¯ï¼Œå°±ä¼šéƒ½è¿›å…¥è¿™ä¸ªé˜Ÿåˆ—äº†ã€‚å½“ç„¶ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥å»ºç«‹ä¸€ä¸ªæŠ¥è­¦é˜Ÿåˆ—ï¼Œç”¨ç‹¬ç«‹çš„æ¶ˆè´¹è€…æ¥è¿›è¡Œç›‘æµ‹å’ŒæŠ¥è­¦ã€‚</strong></p>
</blockquote>
<h5 id="åº”ç”¨ç¤ºä¾‹"><a href="#åº”ç”¨ç¤ºä¾‹" class="headerlink" title="åº”ç”¨ç¤ºä¾‹"></a>åº”ç”¨ç¤ºä¾‹</h5><img src="/2023/02/28/RabbitMQ/Java\RabbitMQ\RabbitMQ.assets\image-20221019172602687.png" alt="image-20221019172602687" style="zoom:80%;">

<h5 id="é…ç½®ç±»-4"><a href="#é…ç½®ç±»-4" class="headerlink" title="é…ç½®ç±»"></a>é…ç½®ç±»</h5><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ConfirmConfig</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">CONFIRM_EXCHANGE_NAME</span> <span class="operator">=</span> <span class="string">&quot;confirm.exchange&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">CONFIRM_QUEUE_NAME</span> <span class="operator">=</span> <span class="string">&quot;confirm.queue&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">BACKUP_EXCHANGE_NAME</span> <span class="operator">=</span> <span class="string">&quot;backup.exchange&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">BACKUP_QUEUE_NAME</span> <span class="operator">=</span> <span class="string">&quot;backup.queue&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">WARNING_QUEUE_NAME</span> <span class="operator">=</span> <span class="string">&quot;warning.queue&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å£°æ˜ç¡®è®¤é˜Ÿåˆ—</span></span><br><span class="line">    <span class="meta">@Bean(&quot;confirmQueue&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Queue <span class="title function_">confirmQueue</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> QueueBuilder.durable(CONFIRM_QUEUE_NAME).build();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//å£°æ˜ç¡®è®¤é˜Ÿåˆ—ç»‘å®šå…³ç³»</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> Binding <span class="title function_">queueBinding</span><span class="params">(<span class="meta">@Qualifier(&quot;confirmQueue&quot;)</span> Queue queue,</span></span><br><span class="line"><span class="params">                                <span class="meta">@Qualifier(&quot;confirmExchange&quot;)</span> DirectExchange exchange)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> BindingBuilder.bind(queue).to(exchange).with(<span class="string">&quot;key1&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//å£°æ˜å¤‡ä»½ Exchange</span></span><br><span class="line">    <span class="meta">@Bean(&quot;backupExchange&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> FanoutExchange <span class="title function_">backupExchange</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">FanoutExchange</span>(BACKUP_EXCHANGE_NAME);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//å£°æ˜ç¡®è®¤ Exchange äº¤æ¢æœºçš„å¤‡ä»½äº¤æ¢æœº</span></span><br><span class="line">    <span class="meta">@Bean(&quot;confirmExchange&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> DirectExchange <span class="title function_">confirmExchange</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">ExchangeBuilder</span> <span class="variable">exchangeBuilder</span> <span class="operator">=</span></span><br><span class="line">                ExchangeBuilder.directExchange(CONFIRM_EXCHANGE_NAME)</span><br><span class="line">                        .durable(<span class="literal">true</span>)</span><br><span class="line">                        <span class="comment">//è®¾ç½®è¯¥äº¤æ¢æœºçš„å¤‡ä»½äº¤æ¢æœº</span></span><br><span class="line">                        .withArgument(<span class="string">&quot;alternate-exchange&quot;</span>, BACKUP_EXCHANGE_NAME);</span><br><span class="line">        <span class="keyword">return</span> (DirectExchange) exchangeBuilder.build();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å£°æ˜è­¦å‘Šé˜Ÿåˆ—</span></span><br><span class="line">    <span class="meta">@Bean(&quot;warningQueue&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Queue <span class="title function_">warningQueue</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> QueueBuilder.durable(WARNING_QUEUE_NAME).build();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å£°æ˜æŠ¥è­¦é˜Ÿåˆ—ç»‘å®šå…³ç³»</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> Binding <span class="title function_">warningBinding</span><span class="params">(<span class="meta">@Qualifier(&quot;warningQueue&quot;)</span> Queue queue,</span></span><br><span class="line"><span class="params">                                  <span class="meta">@Qualifier(&quot;backupExchange&quot;)</span> FanoutExchange</span></span><br><span class="line"><span class="params">                                          backupExchange)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> BindingBuilder.bind(queue).to(backupExchange);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å£°æ˜å¤‡ä»½é˜Ÿåˆ—</span></span><br><span class="line">    <span class="meta">@Bean(&quot;backQueue&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Queue <span class="title function_">backQueue</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> QueueBuilder.durable(BACKUP_QUEUE_NAME).build();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å£°æ˜å¤‡ä»½é˜Ÿåˆ—ç»‘å®šå…³ç³»</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> Binding <span class="title function_">backupBinding</span><span class="params">(<span class="meta">@Qualifier(&quot;backQueue&quot;)</span> Queue queue,</span></span><br><span class="line"><span class="params">                                 <span class="meta">@Qualifier(&quot;backupExchange&quot;)</span> FanoutExchange backupExchange)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> BindingBuilder.bind(queue).to(backupExchange);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="æŠ¥è­¦æ¶ˆè´¹è€…"><a href="#æŠ¥è­¦æ¶ˆè´¹è€…" class="headerlink" title="æŠ¥è­¦æ¶ˆè´¹è€…"></a>æŠ¥è­¦æ¶ˆè´¹è€…</h5><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WarningConsumer</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">WARNING_QUEUE_NAME</span> <span class="operator">=</span> <span class="string">&quot;warning.queue&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RabbitListener(queues = WARNING_QUEUE_NAME)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">receiveWarningMsg</span><span class="params">(Message message)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">msg</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">String</span>(message.getBody());</span><br><span class="line">        log.error(<span class="string">&quot;æŠ¥è­¦å‘ç°ä¸å¯è·¯ç”±æ¶ˆæ¯ï¼š&#123;&#125;&quot;</span>, msg);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="æµ‹è¯•"><a href="#æµ‹è¯•" class="headerlink" title="æµ‹è¯•"></a>æµ‹è¯•</h5><p>æ³¨æ„ï¼šæ—¶å€™éœ€è¦æŠŠåŸæ¥çš„ confirm.exchange åˆ é™¤å› ä¸ºæˆ‘ä»¬ä¿®æ”¹äº†å…¶ç»‘å®šå±æ€§ï¼Œä¸ç„¶æŠ¥é”™ã€‚</p>
<img src="/2023/02/28/RabbitMQ/Java\RabbitMQ\RabbitMQ.assets\image-20221019173231358.png" alt="image-20221019173231358" style="zoom:80%;">

<p>â€‹		mandatory å‚æ•°ä¸å¤‡ä»½äº¤æ¢æœºå¯ä»¥ä¸€èµ·ä½¿ç”¨çš„æ—¶å€™ï¼Œå¦‚æœä¸¤è€…åŒæ—¶å¼€å¯ï¼Œæ¶ˆæ¯ç©¶ç«Ÿä½•å»ä½•ä»ï¼Ÿè°ä¼˜å…ˆçº§é«˜ï¼Œç»è¿‡ä¸Šé¢ç»“æœæ˜¾ç¤ºç­”æ¡ˆæ˜¯å¤‡ä»½äº¤æ¢æœºä¼˜å…ˆçº§é«˜ã€‚</p>
<h3 id="RabbitMQ-ç›¸å…³å«ä¹‰"><a href="#RabbitMQ-ç›¸å…³å«ä¹‰" class="headerlink" title="RabbitMQ ç›¸å…³å«ä¹‰"></a>RabbitMQ ç›¸å…³å«ä¹‰</h3><h4 id="å¹‚ç­‰æ€§"><a href="#å¹‚ç­‰æ€§" class="headerlink" title="å¹‚ç­‰æ€§"></a>å¹‚ç­‰æ€§</h4><blockquote>
<p><strong>æ¦‚å¿µ</strong></p>
<p>â€‹		ç”¨æˆ·å¯¹äºåŒä¸€æ“ä½œå‘èµ·çš„ä¸€æ¬¡è¯·æ±‚æˆ–è€…å¤šæ¬¡è¯·æ±‚çš„ç»“æœæ˜¯ä¸€è‡´çš„ï¼Œä¸ä¼šå› ä¸ºå¤šæ¬¡ç‚¹å‡»è€Œäº§ç”Ÿäº†å‰¯ä½œç”¨ã€‚ ä¸¾ä¸ªæœ€ç®€å•çš„ä¾‹å­ï¼Œé‚£å°±æ˜¯æ”¯ä»˜ï¼Œç”¨æˆ·è´­ä¹°å•†å“åæ”¯ä»˜ï¼Œæ”¯ä»˜æ‰£æ¬¾æˆåŠŸï¼Œä½†æ˜¯è¿”å›ç»“æœçš„æ—¶å€™ç½‘ç»œå¼‚å¸¸ï¼Œ æ­¤æ—¶é’±å·²ç»æ‰£äº†ï¼Œç”¨æˆ·å†æ¬¡ç‚¹å‡»æŒ‰é’®ï¼Œæ­¤æ—¶ä¼šè¿›è¡Œç¬¬äºŒæ¬¡æ‰£æ¬¾ï¼Œè¿”å›ç»“æœæˆåŠŸï¼Œç”¨æˆ·æŸ¥è¯¢ä½™é¢å‘ç°å¤šæ‰£é’± äº†ï¼Œæµæ°´è®°å½•ä¹Ÿå˜æˆäº†ä¸¤æ¡ã€‚åœ¨ä»¥å‰çš„å•åº”ç”¨ç³»ç»Ÿä¸­ï¼Œæˆ‘ä»¬åªéœ€è¦æŠŠæ•°æ®æ“ä½œæ”¾å…¥äº‹åŠ¡ä¸­å³å¯ï¼Œå‘ç”Ÿé”™è¯¯ ç«‹å³å›æ»šï¼Œä½†æ˜¯å†å“åº”å®¢æˆ·ç«¯çš„æ—¶å€™ä¹Ÿæœ‰å¯èƒ½å‡ºç°ç½‘ç»œä¸­æ–­æˆ–è€…å¼‚å¸¸ç­‰ã€‚</p>
<p><strong>æ¶ˆæ¯é‡å¤æ¶ˆè´¹</strong></p>
<p>â€‹		æ¶ˆè´¹è€…åœ¨æ¶ˆè´¹ MQ ä¸­çš„æ¶ˆæ¯æ—¶ï¼ŒMQ å·²æŠŠæ¶ˆæ¯å‘é€ç»™æ¶ˆè´¹è€…ï¼Œæ¶ˆè´¹è€…åœ¨ç»™ MQ è¿”å› ack æ—¶ç½‘ç»œä¸­æ–­ï¼Œ æ•… MQ æœªæ”¶åˆ°ç¡®è®¤ä¿¡æ¯ï¼Œè¯¥æ¡æ¶ˆæ¯ä¼šé‡æ–°å‘ç»™å…¶ä»–çš„æ¶ˆè´¹è€…ï¼Œæˆ–è€…åœ¨ç½‘ç»œé‡è¿åå†æ¬¡å‘é€ç»™è¯¥æ¶ˆè´¹è€…ï¼Œä½†å®é™…ä¸Šè¯¥æ¶ˆè´¹è€…å·²æˆåŠŸæ¶ˆè´¹äº†è¯¥æ¡æ¶ˆæ¯ï¼Œé€ æˆæ¶ˆè´¹è€…æ¶ˆè´¹äº†é‡å¤çš„æ¶ˆæ¯ã€‚</p>
<p><strong>è§£å†³æ€è·¯</strong> </p>
<p>â€‹		MQ æ¶ˆè´¹è€…çš„å¹‚ç­‰æ€§çš„è§£å†³ä¸€èˆ¬ä½¿ç”¨å…¨å±€ ID æˆ–è€…å†™ä¸ªå”¯ä¸€æ ‡è¯†æ¯”å¦‚æ—¶é—´æˆ³ æˆ–è€… UUID æˆ–è€…è®¢å•æ¶ˆè´¹ è€…æ¶ˆè´¹ MQ ä¸­çš„æ¶ˆæ¯ä¹Ÿå¯åˆ©ç”¨ MQ çš„è¯¥ id æ¥åˆ¤æ–­ï¼Œæˆ–è€…å¯æŒ‰è‡ªå·±çš„è§„åˆ™ç”Ÿæˆä¸€ä¸ªå…¨å±€å”¯ä¸€ idï¼Œæ¯æ¬¡æ¶ˆè´¹æ¶ˆ æ¯æ—¶ç”¨è¯¥ id å…ˆåˆ¤æ–­è¯¥æ¶ˆæ¯æ˜¯å¦å·²æ¶ˆè´¹è¿‡ã€‚</p>
<p><strong>æ¶ˆè´¹ç«¯çš„å¹‚ç­‰æ€§ä¿éšœ</strong> </p>
<p>â€‹		åœ¨æµ·é‡è®¢å•ç”Ÿæˆçš„ä¸šåŠ¡é«˜å³°æœŸï¼Œç”Ÿäº§ç«¯æœ‰å¯èƒ½å°±ä¼šé‡å¤å‘ç”Ÿäº†æ¶ˆæ¯ï¼Œè¿™æ—¶å€™æ¶ˆè´¹ç«¯å°±è¦å®ç°å¹‚ç­‰æ€§ï¼Œ è¿™å°±æ„å‘³ç€æˆ‘ä»¬çš„æ¶ˆæ¯æ°¸è¿œä¸ä¼šè¢«æ¶ˆè´¹å¤šæ¬¡ï¼Œå³ä½¿æˆ‘ä»¬æ”¶åˆ°äº†ä¸€æ ·çš„æ¶ˆæ¯ã€‚ä¸šç•Œä¸»æµçš„å¹‚ç­‰æ€§æœ‰ä¸¤ç§æ“ä½œï¼ša. å”¯ä¸€ ID+æŒ‡çº¹ç æœºåˆ¶,åˆ©ç”¨æ•°æ®åº“ä¸»é”®å»é‡, b.åˆ©ç”¨ redis çš„åŸå­æ€§å»å®ç°ã€‚</p>
<p><strong>å”¯ä¸€ ID+æŒ‡çº¹ç æœºåˆ¶</strong></p>
<p>â€‹		æŒ‡çº¹ç ï¼šæˆ‘ä»¬çš„ä¸€äº›è§„åˆ™æˆ–è€…æ—¶é—´æˆ³åŠ åˆ«çš„æœåŠ¡ç»™åˆ°çš„å”¯ä¸€ä¿¡æ¯ç ,å®ƒå¹¶ä¸ä¸€å®šæ˜¯æˆ‘ä»¬ç³»ç»Ÿç”Ÿæˆçš„ï¼ŒåŸºæœ¬éƒ½æ˜¯ç”±æˆ‘ä»¬çš„ä¸šåŠ¡è§„åˆ™æ‹¼æ¥è€Œæ¥ï¼Œä½†æ˜¯ä¸€å®šè¦ä¿è¯å”¯ä¸€æ€§ï¼Œç„¶åå°±åˆ©ç”¨æŸ¥è¯¢è¯­å¥è¿›è¡Œåˆ¤æ–­è¿™ä¸ª id æ˜¯å¦å­˜åœ¨æ•°æ®åº“ä¸­ï¼Œä¼˜åŠ¿å°±æ˜¯å®ç°ç®€å•å°±ä¸€ä¸ªæ‹¼æ¥ï¼Œç„¶åæŸ¥è¯¢åˆ¤æ–­æ˜¯å¦é‡å¤ï¼›åŠ£åŠ¿å°±æ˜¯åœ¨é«˜å¹¶å‘æ—¶ï¼Œå¦‚æœæ˜¯å•ä¸ªæ•°æ®åº“å°±ä¼šæœ‰å†™å…¥æ€§èƒ½ç“¶é¢ˆå½“ç„¶ä¹Ÿå¯ä»¥é‡‡ç”¨åˆ†åº“åˆ†è¡¨æå‡æ€§èƒ½ï¼Œä½†ä¹Ÿä¸æ˜¯æˆ‘ä»¬æœ€æ¨èçš„æ–¹å¼ã€‚ </p>
<p><strong>Redis åŸå­æ€§</strong></p>
<p>â€‹		åˆ©ç”¨ redis æ‰§è¡Œ setnx å‘½ä»¤ï¼Œå¤©ç„¶å…·æœ‰å¹‚ç­‰æ€§ã€‚ä»è€Œå®ç°ä¸é‡å¤æ¶ˆè´¹ã€‚</p>
</blockquote>
<h4 id="ä¼˜å…ˆçº§é˜Ÿåˆ—"><a href="#ä¼˜å…ˆçº§é˜Ÿåˆ—" class="headerlink" title="ä¼˜å…ˆçº§é˜Ÿåˆ—"></a>ä¼˜å…ˆçº§é˜Ÿåˆ—</h4><h5 id="ä½¿ç”¨åœºæ™¯"><a href="#ä½¿ç”¨åœºæ™¯" class="headerlink" title="ä½¿ç”¨åœºæ™¯"></a>ä½¿ç”¨åœºæ™¯</h5><blockquote>
<p>â€‹		åœ¨æˆ‘ä»¬ç³»ç»Ÿä¸­æœ‰ä¸€ä¸ªè®¢å•å‚¬ä»˜çš„åœºæ™¯ï¼Œæˆ‘ä»¬çš„å®¢æˆ·åœ¨å¤©çŒ«ä¸‹çš„è®¢å•,æ·˜å®ä¼šåŠæ—¶å°†è®¢å•æ¨é€ç»™æˆ‘ä»¬ï¼Œå¦‚æœåœ¨ç”¨æˆ·è®¾å®šçš„æ—¶é—´å†…æœªä»˜æ¬¾é‚£ä¹ˆå°±ä¼šç»™ç”¨æˆ·æ¨é€ä¸€æ¡çŸ­ä¿¡æé†’ï¼Œå¾ˆç®€å•çš„ä¸€ä¸ªåŠŸèƒ½å¯¹å§ï¼Œä½†æ˜¯ï¼Œtmall å•†å®¶å¯¹æˆ‘ä»¬æ¥è¯´ï¼Œè‚¯å®šæ˜¯è¦åˆ†å¤§å®¢æˆ·å’Œå°å®¢æˆ·çš„å¯¹å§ï¼Œæ¯”å¦‚åƒè‹¹æœï¼Œå°ç±³è¿™æ ·å¤§å•†å®¶ä¸€å¹´èµ·ç èƒ½ç»™æˆ‘ä»¬åˆ›é€ å¾ˆå¤§çš„åˆ©æ¶¦ï¼Œæ‰€ä»¥ç†åº”å½“ç„¶ï¼Œä»–ä»¬çš„è®¢å•å¿…é¡»å¾—åˆ°ä¼˜å…ˆå¤„ç†ï¼Œè€Œæ›¾ç»æˆ‘ä»¬çš„åç«¯ç³»ç»Ÿæ˜¯ä½¿ç”¨ redis æ¥å­˜æ”¾çš„å®šæ—¶è½®è¯¢ï¼Œå¤§å®¶éƒ½çŸ¥é“ redis åªèƒ½ç”¨ List åšä¸€ä¸ªç®€ç®€å•å•çš„æ¶ˆæ¯é˜Ÿåˆ—ï¼Œå¹¶ä¸èƒ½å®ç°ä¸€ä¸ªä¼˜å…ˆçº§çš„åœºæ™¯ï¼Œæ‰€ä»¥è®¢å•é‡å¤§äº†åé‡‡ç”¨ RabbitMQ è¿›è¡Œæ”¹é€ å’Œä¼˜åŒ–,å¦‚æœå‘ç°æ˜¯å¤§å®¢æˆ·çš„è®¢å•ç»™ä¸€ä¸ªç›¸å¯¹æ¯”è¾ƒé«˜çš„ä¼˜å…ˆçº§ï¼Œ å¦åˆ™å°±æ˜¯é»˜è®¤ä¼˜å…ˆçº§ã€‚</p>
</blockquote>
<h5 id="å¦‚ä½•æ·»åŠ "><a href="#å¦‚ä½•æ·»åŠ " class="headerlink" title="å¦‚ä½•æ·»åŠ "></a>å¦‚ä½•æ·»åŠ </h5><p><strong>æ§åˆ¶å°é¡µé¢æ·»åŠ </strong></p>
<img src="/2023/02/28/RabbitMQ/Java\RabbitMQ\RabbitMQ.assets\image-20221019173732175.png" alt="image-20221019173732175" style="zoom:80%;">

<p><strong>é˜Ÿåˆ—ä¸­ä»£ç æ·»åŠ ä¼˜å…ˆçº§</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Map&lt;String, Object&gt; params = <span class="keyword">new</span> <span class="title class_">HashMap</span>();</span><br><span class="line">params.put(<span class="string">&quot;x-max-priority&quot;</span>, <span class="number">10</span>);</span><br><span class="line">channel.queueDeclare(<span class="string">&quot;hello&quot;</span>, <span class="literal">true</span>, <span class="literal">false</span>, <span class="literal">false</span>, params);</span><br></pre></td></tr></table></figure>

<p><strong>æ¶ˆæ¯ä¸­ä»£ç æ·»åŠ ä¼˜å…ˆçº§</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">AMQP.<span class="type">BasicProperties</span> <span class="variable">properties</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AMQP</span>.BasicProperties().builder().priority(<span class="number">5</span>).build();</span><br></pre></td></tr></table></figure>

<p><strong>æ³¨æ„äº‹é¡¹</strong></p>
<blockquote>
<p>â€‹		è¦è®©é˜Ÿåˆ—å®ç°ä¼˜å…ˆçº§éœ€è¦åšçš„äº‹æƒ…æœ‰å¦‚ä¸‹äº‹æƒ…:é˜Ÿåˆ—éœ€è¦è®¾ç½®ä¸ºä¼˜å…ˆçº§é˜Ÿåˆ—ï¼Œæ¶ˆæ¯éœ€è¦è®¾ç½®æ¶ˆæ¯çš„ä¼˜å…ˆ çº§ï¼Œæ¶ˆè´¹è€…éœ€è¦ç­‰å¾…æ¶ˆæ¯å·²ç»å‘é€åˆ°é˜Ÿåˆ—ä¸­æ‰å»æ¶ˆè´¹å› ä¸ºï¼Œè¿™æ ·æ‰æœ‰æœºä¼šå¯¹æ¶ˆæ¯è¿›è¡Œæ’åºã€‚</p>
</blockquote>
<h5 id="åº”ç”¨å®ä¾‹"><a href="#åº”ç”¨å®ä¾‹" class="headerlink" title="åº”ç”¨å®ä¾‹"></a>åº”ç”¨å®ä¾‹</h5><p>ç”Ÿäº§è€…ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Producer</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">QUEUE_NAME</span> <span class="operator">=</span> <span class="string">&quot;hello&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="keyword">try</span> (<span class="type">Channel</span> <span class="variable">channel</span> <span class="operator">=</span> RabbitConnectUtil.getChannel();) &#123;</span><br><span class="line">            <span class="comment">//ç»™æ¶ˆæ¯èµ‹äºˆä¸€ä¸ª priority å±æ€§</span></span><br><span class="line">            AMQP.<span class="type">BasicProperties</span> <span class="variable">properties</span> <span class="operator">=</span> <span class="keyword">new</span></span><br><span class="line">                    <span class="title class_">AMQP</span>.BasicProperties().builder().priority(<span class="number">5</span>).build();</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt; <span class="number">11</span>; i++) &#123;</span><br><span class="line">                <span class="type">String</span> <span class="variable">message</span> <span class="operator">=</span> <span class="string">&quot;info&quot;</span> + i;</span><br><span class="line">                <span class="keyword">if</span> (i == <span class="number">5</span>) &#123;</span><br><span class="line">                    channel.basicPublish(<span class="string">&quot;&quot;</span>, QUEUE_NAME, properties, message.getBytes());</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    channel.basicPublish(<span class="string">&quot;&quot;</span>, QUEUE_NAME, <span class="literal">null</span>, message.getBytes());</span><br><span class="line">                &#125;</span><br><span class="line">                System.out.println(<span class="string">&quot;å‘é€æ¶ˆæ¯å®Œæˆ:&quot;</span> + message);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ¶ˆè´¹è€…ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Consumer</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">QUEUE_NAME</span> <span class="operator">=</span> <span class="string">&quot;hello&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">Channel</span> <span class="variable">channel</span> <span class="operator">=</span> RabbitConnectUtil.getChannel();</span><br><span class="line">        <span class="comment">//è®¾ç½®é˜Ÿåˆ—çš„æœ€å¤§ä¼˜å…ˆçº§ æœ€å¤§å¯ä»¥è®¾ç½®åˆ° 255 å®˜ç½‘æ¨è 1-10 å¦‚æœè®¾ç½®å¤ªé«˜æ¯”è¾ƒåƒå†…å­˜å’Œ CPU</span></span><br><span class="line">        Map&lt;String, Object&gt; params = <span class="keyword">new</span> <span class="title class_">HashMap</span>();</span><br><span class="line">        params.put(<span class="string">&quot;x-max-priority&quot;</span>, <span class="number">10</span>);</span><br><span class="line">        channel.queueDeclare(QUEUE_NAME, <span class="literal">true</span>, <span class="literal">false</span>, <span class="literal">false</span>, params);</span><br><span class="line">        System.out.println(<span class="string">&quot;æ¶ˆè´¹è€…å¯åŠ¨ç­‰å¾…æ¶ˆè´¹......&quot;</span>);</span><br><span class="line">        <span class="type">DeliverCallback</span> <span class="variable">deliverCallback</span> <span class="operator">=</span> (consumerTag, delivery) -&gt; &#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">receivedMessage</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">String</span>(delivery.getBody());</span><br><span class="line">            System.out.println(<span class="string">&quot;æ¥æ”¶åˆ°æ¶ˆæ¯:&quot;</span> + receivedMessage);</span><br><span class="line">        &#125;;</span><br><span class="line">        channel.basicConsume(QUEUE_NAME, <span class="literal">true</span>, deliverCallback, (consumerTag) -&gt; &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;æ¶ˆè´¹è€…æ— æ³•æ¶ˆè´¹æ¶ˆæ¯æ—¶è°ƒç”¨ï¼Œå¦‚é˜Ÿåˆ—è¢«åˆ é™¤&quot;</span>);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="æƒ°æ€§é˜Ÿåˆ—"><a href="#æƒ°æ€§é˜Ÿåˆ—" class="headerlink" title="æƒ°æ€§é˜Ÿåˆ—"></a>æƒ°æ€§é˜Ÿåˆ—</h4><h5 id="ä½¿ç”¨åœºæ™¯-1"><a href="#ä½¿ç”¨åœºæ™¯-1" class="headerlink" title="ä½¿ç”¨åœºæ™¯"></a>ä½¿ç”¨åœºæ™¯</h5><blockquote>
<p>RabbitMQ ä» 3.6.0 ç‰ˆæœ¬å¼€å§‹å¼•å…¥äº†æƒ°æ€§é˜Ÿåˆ—çš„æ¦‚å¿µã€‚æƒ°æ€§é˜Ÿåˆ—ä¼šå°½å¯èƒ½çš„å°†æ¶ˆæ¯å­˜å…¥ç£ç›˜ä¸­ï¼Œè€Œåœ¨æ¶ˆè´¹è€…æ¶ˆè´¹åˆ°ç›¸åº”çš„æ¶ˆæ¯æ—¶æ‰ä¼šè¢«åŠ è½½åˆ°å†…å­˜ä¸­ï¼Œå®ƒçš„ä¸€ä¸ªé‡è¦çš„è®¾è®¡ç›®æ ‡æ˜¯èƒ½å¤Ÿæ”¯æŒæ›´é•¿çš„é˜Ÿåˆ—ï¼Œå³æ”¯æŒæ›´å¤šçš„æ¶ˆæ¯å­˜å‚¨ã€‚å½“æ¶ˆè´¹è€…ç”±äºå„ç§å„æ ·çš„åŸå› ï¼ˆæ¯”å¦‚æ¶ˆè´¹è€…ä¸‹çº¿ã€å®•æœºäº¦æˆ–è€…æ˜¯ç”±äºç»´æŠ¤è€Œå…³é—­ç­‰ï¼‰è€Œè‡´ä½¿é•¿æ—¶é—´å†…ä¸èƒ½æ¶ˆè´¹æ¶ˆæ¯é€ æˆå †ç§¯æ—¶ï¼Œæƒ°æ€§é˜Ÿåˆ—å°±å¾ˆæœ‰å¿…è¦äº†ã€‚ </p>
<p>é»˜è®¤æƒ…å†µä¸‹ï¼Œå½“ç”Ÿäº§è€…å°†æ¶ˆæ¯å‘é€åˆ° RabbitMQ çš„æ—¶å€™ï¼Œé˜Ÿåˆ—ä¸­çš„æ¶ˆæ¯ä¼šå°½å¯èƒ½çš„å­˜å‚¨åœ¨å†…å­˜ä¹‹ä¸­ï¼Œ è¿™æ ·å¯ä»¥æ›´åŠ å¿«é€Ÿçš„å°†æ¶ˆæ¯å‘é€ç»™æ¶ˆè´¹è€…ã€‚å³ä½¿æ˜¯æŒä¹…åŒ–çš„æ¶ˆæ¯ï¼Œåœ¨è¢«å†™å…¥ç£ç›˜çš„åŒæ—¶ä¹Ÿä¼šåœ¨å†…å­˜ä¸­é©»ç•™ ä¸€ä»½å¤‡ä»½ã€‚å½“ RabbitMQ éœ€è¦é‡Šæ”¾å†…å­˜çš„æ—¶å€™ï¼Œä¼šå°†å†…å­˜ä¸­çš„æ¶ˆæ¯æ¢é¡µè‡³ç£ç›˜ä¸­ï¼Œè¿™ä¸ªæ“ä½œä¼šè€—è´¹è¾ƒé•¿çš„æ—¶é—´ï¼Œä¹Ÿä¼šé˜»å¡é˜Ÿåˆ—çš„æ“ä½œï¼Œè¿›è€Œæ— æ³•æ¥æ”¶æ–°çš„æ¶ˆæ¯ã€‚è™½ç„¶ RabbitMQ çš„å¼€å‘è€…ä»¬ä¸€ç›´åœ¨å‡çº§ç›¸å…³çš„ç®—æ³•ï¼Œ ä½†æ˜¯æ•ˆæœå§‹ç»ˆä¸å¤ªç†æƒ³ï¼Œå°¤å…¶æ˜¯åœ¨æ¶ˆæ¯é‡ç‰¹åˆ«å¤§çš„æ—¶å€™ã€‚</p>
</blockquote>
<h5 id="ä¸¤ç§æ¨¡å¼"><a href="#ä¸¤ç§æ¨¡å¼" class="headerlink" title="ä¸¤ç§æ¨¡å¼"></a>ä¸¤ç§æ¨¡å¼</h5><blockquote>
<p>é˜Ÿåˆ—å…·å¤‡ä¸¤ç§æ¨¡å¼ï¼šdefault å’Œ lazyã€‚é»˜è®¤çš„ä¸º default æ¨¡å¼ï¼Œåœ¨ 3.6.0 ä¹‹å‰çš„ç‰ˆæœ¬æ— éœ€åšä»»ä½•å˜æ›´ã€‚lazy æ¨¡å¼å³ä¸ºæƒ°æ€§é˜Ÿåˆ—çš„æ¨¡å¼ï¼Œå¯ä»¥é€šè¿‡è°ƒç”¨ channel.queueDeclare æ–¹æ³•çš„æ—¶å€™åœ¨å‚æ•°ä¸­è®¾ç½®ï¼Œä¹Ÿå¯ä»¥é€šè¿‡ Policy çš„æ–¹å¼è®¾ç½®ï¼Œå¦‚æœä¸€ä¸ªé˜Ÿåˆ—åŒæ—¶ä½¿ç”¨è¿™ä¸¤ç§æ–¹å¼è®¾ç½®çš„è¯ï¼Œé‚£ä¹ˆ Policy çš„æ–¹å¼å…·å¤‡æ›´é«˜çš„ä¼˜å…ˆçº§ã€‚ å¦‚æœè¦é€šè¿‡å£°æ˜çš„æ–¹å¼æ”¹å˜å·²æœ‰é˜Ÿåˆ—çš„æ¨¡å¼çš„è¯ï¼Œé‚£ä¹ˆåªèƒ½å…ˆåˆ é™¤é˜Ÿåˆ—ï¼Œç„¶åå†é‡æ–°å£°æ˜ä¸€ä¸ªæ–°çš„ã€‚ åœ¨é˜Ÿåˆ—å£°æ˜çš„æ—¶å€™å¯ä»¥é€šè¿‡â€œx-queue-modeâ€å‚æ•°æ¥è®¾ç½®é˜Ÿåˆ—çš„æ¨¡å¼ï¼Œå–å€¼ä¸ºâ€œdefaultâ€å’Œâ€œlazyâ€ã€‚ä¸‹é¢ç¤ºä¾‹ä¸­æ¼”ç¤ºäº†ä¸€ä¸ªæƒ°æ€§é˜Ÿåˆ—çš„å£°æ˜ç»†èŠ‚ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Map&lt;String, Object&gt; args = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;String, Object&gt;();</span><br><span class="line">args.put(<span class="string">&quot;x-queue-mode&quot;</span>, <span class="string">&quot;lazy&quot;</span>);</span><br><span class="line">channel.queueDeclare(<span class="string">&quot;myqueue&quot;</span>, <span class="literal">false</span>, <span class="literal">false</span>, <span class="literal">false</span>, args);</span><br></pre></td></tr></table></figure>
</blockquote>
<h5 id="å†…å­˜å¼€é”€å¯¹æ¯”"><a href="#å†…å­˜å¼€é”€å¯¹æ¯”" class="headerlink" title="å†…å­˜å¼€é”€å¯¹æ¯”"></a>å†…å­˜å¼€é”€å¯¹æ¯”</h5><img src="/2023/02/28/RabbitMQ/Java\RabbitMQ\RabbitMQ.assets\image-20221019174449152.png" alt="image-20221019174449152" style="zoom:80%;">

<p>â€‹	åœ¨å‘é€ 1 ç™¾ä¸‡æ¡æ¶ˆæ¯ï¼Œæ¯æ¡æ¶ˆæ¯å¤§æ¦‚å  1KB çš„æƒ…å†µä¸‹ï¼Œæ™®é€šé˜Ÿåˆ—å ç”¨å†…å­˜æ˜¯ 1.2GBï¼Œè€Œæƒ°æ€§é˜Ÿåˆ—ä»…ä»… å ç”¨ 1.5MBã€‚</p>
<h3 id="RabbitMQ-é›†ç¾¤"><a href="#RabbitMQ-é›†ç¾¤" class="headerlink" title="RabbitMQ é›†ç¾¤"></a>RabbitMQ é›†ç¾¤</h3><h4 id="clustering"><a href="#clustering" class="headerlink" title="clustering"></a>clustering</h4><h5 id="ä½¿ç”¨é›†ç¾¤çš„åŸå› "><a href="#ä½¿ç”¨é›†ç¾¤çš„åŸå› " class="headerlink" title="ä½¿ç”¨é›†ç¾¤çš„åŸå› "></a>ä½¿ç”¨é›†ç¾¤çš„åŸå› </h5><blockquote>
<p>æœ€å¼€å§‹æˆ‘ä»¬ä»‹ç»äº†å¦‚ä½•å®‰è£…åŠè¿è¡Œ RabbitMQ æœåŠ¡ï¼Œä¸è¿‡è¿™äº›æ˜¯å•æœºç‰ˆçš„ï¼Œæ— æ³•æ»¡è¶³ç›®å‰çœŸå®åº”ç”¨çš„ è¦æ±‚ã€‚å¦‚æœ RabbitMQ æœåŠ¡å™¨é‡åˆ°å†…å­˜å´©æºƒã€æœºå™¨æ‰ç”µæˆ–è€…ä¸»æ¿æ•…éšœç­‰æƒ…å†µï¼Œè¯¥æ€ä¹ˆåŠï¼Ÿå•å° RabbitMQ æœåŠ¡å™¨å¯ä»¥æ»¡è¶³æ¯ç§’ 1000 æ¡æ¶ˆæ¯çš„ååé‡ï¼Œé‚£ä¹ˆå¦‚æœåº”ç”¨éœ€è¦ RabbitMQ æœåŠ¡æ»¡è¶³æ¯ç§’ 10 ä¸‡æ¡æ¶ˆæ¯çš„ååé‡å‘¢ï¼Ÿè´­ä¹°æ˜‚è´µçš„æœåŠ¡å™¨æ¥å¢å¼ºå•æœº RabbitMQ åŠ¡çš„æ€§èƒ½æ˜¾å¾—æ‰è¥Ÿè§è‚˜ï¼Œæ­å»ºä¸€ä¸ª RabbitMQ é›†ç¾¤æ‰æ˜¯ è§£å†³å®é™…é—®é¢˜çš„å…³é”®ã€‚</p>
</blockquote>
<h5 id="æ­å»ºæ­¥éª¤"><a href="#æ­å»ºæ­¥éª¤" class="headerlink" title="æ­å»ºæ­¥éª¤"></a>æ­å»ºæ­¥éª¤</h5><blockquote>
<p>1.ä¿®æ”¹ 3 å°æœºå™¨çš„ä¸»æœºåç§° vim &#x2F;etc&#x2F;hostname 2.é…ç½®å„ä¸ªèŠ‚ç‚¹çš„ hosts æ–‡ä»¶ï¼Œè®©å„ä¸ªèŠ‚ç‚¹éƒ½èƒ½äº’ç›¸è¯†åˆ«å¯¹æ–¹ vim &#x2F;etc&#x2F;hosts 10.211.55.74 node1 10.211.55.75 node2 10.211.55.76 node3</p>
<p>3.ä»¥ç¡®ä¿å„ä¸ªèŠ‚ç‚¹çš„ cookie æ–‡ä»¶ä½¿ç”¨çš„æ˜¯åŒä¸€ä¸ªå€¼ åœ¨ node1 ä¸Šæ‰§è¡Œè¿œç¨‹æ“ä½œå‘½ä»¤ scp &#x2F;var&#x2F;lib&#x2F;rabbitmq&#x2F;.erlang.cookie root@node2:&#x2F;var&#x2F;lib&#x2F;rabbitmq&#x2F;.erlang.cookie scp &#x2F;var&#x2F;lib&#x2F;rabbitmq&#x2F;.erlang.cookie root@node3:&#x2F;var&#x2F;lib&#x2F;rabbitmq&#x2F;.erlang.cookie 4.å¯åŠ¨ RabbitMQ æœåŠ¡,é¡ºå¸¦å¯åŠ¨ Erlang è™šæ‹Ÿæœºå’Œ RbbitMQ åº”ç”¨æœåŠ¡(åœ¨ä¸‰å°èŠ‚ç‚¹ä¸Šåˆ†åˆ«æ‰§è¡Œä»¥ ä¸‹å‘½ä»¤) rabbitmq-server -detached 5.åœ¨èŠ‚ç‚¹ 2 æ‰§è¡Œ rabbitmqctl stop_app (rabbitmqctl stop ä¼šå°† Erlang è™šæ‹Ÿæœºå…³é—­ï¼Œrabbitmqctl stop_app åªå…³é—­ RabbitMQ æœåŠ¡) rabbitmqctl reset rabbitmqctl join_cluster rabbit@node1 rabbitmqctl start_app(åªå¯åŠ¨åº”ç”¨æœåŠ¡)</p>
<p>6.åœ¨èŠ‚ç‚¹ 3 æ‰§è¡Œ</p>
<p>rabbitmqctl stop_app rabbitmqctl reset rabbitmqctl join_cluster rabbit@node2 rabbitmqctl start_app</p>
<p>7.é›†ç¾¤çŠ¶æ€ rabbitmqctl cluster_status 8.éœ€è¦é‡æ–°è®¾ç½®ç”¨æˆ· åˆ›å»ºè´¦å· rabbitmqctl add_user admin 123 è®¾ç½®ç”¨æˆ·è§’è‰² rabbitmqctl set_user_tags admin administrator è®¾ç½®ç”¨æˆ·æƒé™ rabbitmqctl set_permissions -p â€œ&#x2F;â€œ admin â€œ.<em>â€œ â€œ.</em>â€œ â€œ.*â€ 9.è§£é™¤é›†ç¾¤èŠ‚ç‚¹(node2 å’Œ node3 æœºå™¨åˆ†åˆ«æ‰§è¡Œ)</p>
<p>rabbitmqctl stop_app rabbitmqctl reset rabbitmqctl start_app rabbitmqctl cluster_status rabbitmqctl forget_cluster_node rabbit@node2(node1 æœºå™¨ä¸Šæ‰§è¡Œ)</p>
</blockquote>
<h4 id="é•œåƒé˜Ÿåˆ—"><a href="#é•œåƒé˜Ÿåˆ—" class="headerlink" title="é•œåƒé˜Ÿåˆ—"></a>é•œåƒé˜Ÿåˆ—</h4><h5 id="ä½¿ç”¨é•œåƒçš„åŸå› "><a href="#ä½¿ç”¨é•œåƒçš„åŸå› " class="headerlink" title="ä½¿ç”¨é•œåƒçš„åŸå› "></a>ä½¿ç”¨é•œåƒçš„åŸå› </h5><blockquote>
<p>å¦‚æœ RabbitMQ é›†ç¾¤ä¸­åªæœ‰ä¸€ä¸ª Broker èŠ‚ç‚¹ï¼Œé‚£ä¹ˆè¯¥èŠ‚ç‚¹çš„å¤±æ•ˆå°†å¯¼è‡´æ•´ä½“æœåŠ¡çš„ä¸´æ—¶æ€§ä¸å¯ç”¨ï¼Œå¹¶ ä¸”ä¹Ÿå¯èƒ½ä¼šå¯¼è‡´æ¶ˆæ¯çš„ä¸¢å¤±ã€‚å¯ä»¥å°†æ‰€æœ‰æ¶ˆæ¯éƒ½è®¾ç½®ä¸ºæŒä¹…åŒ–ï¼Œå¹¶ä¸”å¯¹åº”é˜Ÿåˆ—çš„durableå±æ€§ä¹Ÿè®¾ç½®ä¸ºtrueï¼Œ ä½†æ˜¯è¿™æ ·ä»ç„¶æ— æ³•é¿å…ç”±äºç¼“å­˜å¯¼è‡´çš„é—®é¢˜ï¼šå› ä¸ºæ¶ˆæ¯åœ¨å‘é€ä¹‹åå’Œè¢«å†™å…¥ç£ç›˜äº•æ‰§è¡Œåˆ·ç›˜åŠ¨ä½œä¹‹é—´å­˜åœ¨ ä¸€ä¸ªçŸ­æš‚å´ä¼šäº§ç”Ÿé—®é¢˜çš„æ—¶é—´çª—ã€‚é€šè¿‡ publisherconfirm æœºåˆ¶èƒ½å¤Ÿç¡®ä¿å®¢æˆ·ç«¯çŸ¥é“å“ªäº›æ¶ˆæ¯å·±ç»å­˜å…¥ç£ç›˜ï¼Œ å°½ç®¡å¦‚æ­¤ï¼Œä¸€èˆ¬ä¸å¸Œæœ›é‡åˆ°å› å•ç‚¹æ•…éšœå¯¼è‡´çš„æœåŠ¡ä¸å¯ç”¨ã€‚</p>
<p>å¼•å…¥é•œåƒé˜Ÿåˆ—(Mirror Queue)çš„æœºåˆ¶ï¼Œå¯ä»¥å°†é˜Ÿåˆ—é•œåƒåˆ°é›†ç¾¤ä¸­çš„å…¶ä»– Broker èŠ‚ç‚¹ä¹‹ä¸Šï¼Œå¦‚æœé›†ç¾¤ä¸­ çš„ä¸€ä¸ªèŠ‚ç‚¹å¤±æ•ˆäº†ï¼Œé˜Ÿåˆ—èƒ½è‡ªåŠ¨åœ°åˆ‡æ¢åˆ°é•œåƒä¸­çš„å¦ä¸€ä¸ªèŠ‚ç‚¹ä¸Šä»¥ä¿è¯æœåŠ¡çš„å¯ç”¨æ€§ã€‚</p>
</blockquote>
<h5 id="æ­å»ºæ­¥éª¤-1"><a href="#æ­å»ºæ­¥éª¤-1" class="headerlink" title="æ­å»ºæ­¥éª¤"></a>æ­å»ºæ­¥éª¤</h5><blockquote>
<p>1.å¯åŠ¨ä¸‰å°é›†ç¾¤èŠ‚ç‚¹ 2.éšä¾¿æ‰¾ä¸€ä¸ªèŠ‚ç‚¹æ·»åŠ  policy</p>
<img src="/2023/02/28/RabbitMQ/Java\RabbitMQ\RabbitMQ.assets\image-20221019175905823.png" alt="image-20221019175905823" style="zoom:67%;">

<p>3.åœ¨ node1 ä¸Šåˆ›å»ºä¸€ä¸ªé˜Ÿåˆ—å‘é€ä¸€æ¡æ¶ˆæ¯ï¼Œé˜Ÿåˆ—å­˜åœ¨é•œåƒé˜Ÿåˆ—</p>
<img src="/2023/02/28/RabbitMQ/Java\RabbitMQ\RabbitMQ.assets\image-20221019175923182.png" alt="image-20221019175923182" style="zoom:60%;">

<p>4.åœæ‰ node1 ä¹‹åå‘ç° node2 æˆä¸ºé•œåƒé˜Ÿåˆ—</p>
<p>5.å°±ç®—æ•´ä¸ªé›†ç¾¤åªå‰©ä¸‹ä¸€å°æœºå™¨äº† ä¾ç„¶èƒ½æ¶ˆè´¹é˜Ÿåˆ—é‡Œé¢çš„æ¶ˆæ¯ è¯´æ˜é˜Ÿåˆ—é‡Œé¢çš„æ¶ˆæ¯è¢«é•œåƒé˜Ÿåˆ—ä¼ é€’åˆ°ç›¸åº”æœºå™¨é‡Œé¢äº†</p>
<img src="/2023/02/28/RabbitMQ/Java\RabbitMQ\RabbitMQ.assets\image-20221019175951448.png" alt="image-20221019175951448" style="zoom:50%;">
</blockquote>
<h4 id="Haproxy-Keepalive-å®ç°é«˜å¯ç”¨è´Ÿè½½å‡è¡¡"><a href="#Haproxy-Keepalive-å®ç°é«˜å¯ç”¨è´Ÿè½½å‡è¡¡" class="headerlink" title="Haproxy+Keepalive å®ç°é«˜å¯ç”¨è´Ÿè½½å‡è¡¡"></a>Haproxy+Keepalive å®ç°é«˜å¯ç”¨è´Ÿè½½å‡è¡¡</h4><h5 id="æ¶æ„å›¾"><a href="#æ¶æ„å›¾" class="headerlink" title="æ¶æ„å›¾"></a>æ¶æ„å›¾</h5><img src="/2023/02/28/RabbitMQ/Java\RabbitMQ\RabbitMQ.assets\image-20221019175419543.png" alt="image-20221019175419543" style="zoom:67%;">

<h5 id="Haproxy-å®ç°è´Ÿè½½å‡è¡¡"><a href="#Haproxy-å®ç°è´Ÿè½½å‡è¡¡" class="headerlink" title="Haproxy å®ç°è´Ÿè½½å‡è¡¡"></a>Haproxy å®ç°è´Ÿè½½å‡è¡¡</h5><blockquote>
<p>HAProxy æä¾›é«˜å¯ç”¨æ€§ã€è´Ÿè½½å‡è¡¡åŠåŸºäº TCPHTTP åº”ç”¨çš„ä»£ç†ï¼Œæ”¯æŒè™šæ‹Ÿä¸»æœºï¼Œå®ƒæ˜¯å…è´¹ã€å¿«é€Ÿå¹¶ ä¸”å¯é çš„ä¸€ç§è§£å†³æ–¹æ¡ˆï¼ŒåŒ…æ‹¬ Twitter,Reddit,StackOverflow,GitHub åœ¨å†…çš„å¤šå®¶çŸ¥åäº’è”ç½‘å…¬å¸åœ¨ä½¿ç”¨ã€‚ HAProxy å®ç°äº†ä¸€ç§äº‹ä»¶é©±åŠ¨ã€å•ä¸€è¿›ç¨‹æ¨¡å‹ï¼Œæ­¤æ¨¡å‹æ”¯æŒéå¸¸å¤§çš„äº•å‘è¿æ¥æ•°ã€‚ </p>
<p>æ‰©å±• nginx,lvs,haproxy ä¹‹é—´çš„åŒºåˆ«ï¼š<a href="http://www.ha97.com/5646.html">http://www.ha97.com/5646.html</a></p>
</blockquote>
<h5 id="æ­å»ºæ­¥éª¤-2"><a href="#æ­å»ºæ­¥éª¤-2" class="headerlink" title="æ­å»ºæ­¥éª¤"></a>æ­å»ºæ­¥éª¤</h5><blockquote>
<p>1.ä¸‹è½½ haproxy(åœ¨ node1 å’Œ node2) yum -y install haproxy</p>
<p>2.ä¿®æ”¹ node1 å’Œ node2 çš„ haproxy.cfg</p>
<p>vim &#x2F;etc&#x2F;haproxy&#x2F;haproxy.cfg éœ€è¦ä¿®æ”¹çº¢è‰² IP ä¸ºå½“å‰æœºå™¨ IP</p>
<p>3.åœ¨ä¸¤å°èŠ‚ç‚¹å¯åŠ¨ haproxy haproxy -f &#x2F;etc&#x2F;haproxy&#x2F;haproxy.cfg ps -ef | grep haproxy </p>
<p>4.è®¿é—®åœ°å€ <a href="http://10.211.55.71:8888/stats">http://10.211.55.71:8888/stats</a></p>
</blockquote>
<h5 id="Keepalived-å®ç°åŒæœº-ä¸»å¤‡-çƒ­å¤‡"><a href="#Keepalived-å®ç°åŒæœº-ä¸»å¤‡-çƒ­å¤‡" class="headerlink" title="Keepalived å®ç°åŒæœº(ä¸»å¤‡)çƒ­å¤‡"></a>Keepalived å®ç°åŒæœº(ä¸»å¤‡)çƒ­å¤‡</h5><blockquote>
<p>è¯•æƒ³å¦‚æœå‰é¢é…ç½®çš„ HAProxy ä¸»æœºçªç„¶å®•æœºæˆ–è€…ç½‘å¡å¤±æ•ˆï¼Œé‚£ä¹ˆè™½ç„¶ RbbitMQ é›†ç¾¤æ²¡æœ‰ä»»ä½•æ•…éšœä½†æ˜¯ å¯¹äºå¤–ç•Œçš„å®¢æˆ·ç«¯æ¥è¯´æ‰€æœ‰çš„è¿æ¥éƒ½ä¼šè¢«æ–­å¼€ç»“æœå°†æ˜¯ç¾éš¾æ€§çš„ä¸ºäº†ç¡®ä¿è´Ÿè½½å‡è¡¡æœåŠ¡çš„å¯é æ€§åŒæ ·æ˜¾å¾— ååˆ†é‡è¦ï¼Œè¿™é‡Œå°±è¦å¼•å…¥ Keepalived å®ƒèƒ½å¤Ÿé€šè¿‡è‡ªèº«å¥åº·æ£€æŸ¥ã€èµ„æºæ¥ç®¡åŠŸèƒ½åšé«˜å¯ç”¨(åŒæœºçƒ­å¤‡)ï¼Œå®ç°æ•…éšœè½¬ç§»ã€‚</p>
</blockquote>
<h5 id="æ­å»ºæ­¥éª¤-3"><a href="#æ­å»ºæ­¥éª¤-3" class="headerlink" title="æ­å»ºæ­¥éª¤"></a>æ­å»ºæ­¥éª¤</h5><blockquote>
<p>1.ä¸‹è½½ keepalived yum -y install keepalived </p>
<p>2.èŠ‚ç‚¹ node1 é…ç½®æ–‡ä»¶ vim &#x2F;etc&#x2F;keepalived&#x2F;keepalived.conf æŠŠèµ„æ–™é‡Œé¢çš„ keepalived.conf ä¿®æ”¹ä¹‹åæ›¿æ¢ </p>
<p>3.èŠ‚ç‚¹ node2 é…ç½®æ–‡ä»¶ éœ€è¦ä¿®æ”¹ global_defs çš„ router_id,å¦‚:nodeB å…¶æ¬¡è¦ä¿®æ”¹ vrrp_instance_VI ä¸­ state ä¸ºâ€BACKUPâ€ï¼› æœ€åè¦å°† priority è®¾ç½®ä¸ºå°äº 100 çš„å€¼ </p>
<p>4.æ·»åŠ  haproxy_chk.sh (ä¸ºäº†é˜²æ­¢ HAProxy æœåŠ¡æŒ‚æ‰ä¹‹å Keepalived è¿˜åœ¨æ­£å¸¸å·¥ä½œè€Œæ²¡æœ‰åˆ‡æ¢åˆ° Backup ä¸Šï¼Œæ‰€ä»¥è¿™é‡Œéœ€è¦ç¼–å†™ä¸€ä¸ªè„šæœ¬æ¥æ£€æµ‹ HAProxy åŠ¡çš„çŠ¶æ€,å½“ HAProxy æœåŠ¡æŒ‚æ‰ä¹‹åè¯¥è„šæœ¬ä¼šè‡ªåŠ¨é‡å¯ HAProxy çš„æœåŠ¡ï¼Œå¦‚æœä¸æˆåŠŸåˆ™å…³é—­ Keepalived æœåŠ¡ï¼Œè¿™æ ·ä¾¿å¯ä»¥åˆ‡æ¢åˆ° Backup ç»§ç»­å·¥ä½œ) vim &#x2F;etc&#x2F;keepalived&#x2F;haproxy_chk.sh(å¯ä»¥ç›´æ¥ä¸Šä¼ æ–‡ä»¶) ä¿®æ”¹æƒé™ chmod 777 &#x2F;etc&#x2F;keepalived&#x2F;haproxy_chk.sh </p>
<p>5.å¯åŠ¨ keepalive å‘½ä»¤(node1 å’Œ node2 å¯åŠ¨) systemctl start keepalived </p>
<p>6.è§‚å¯Ÿ Keepalived çš„æ—¥å¿— tail -f &#x2F;var&#x2F;log&#x2F;messages -n 200 </p>
<p>7.è§‚å¯Ÿæœ€æ–°æ·»åŠ çš„ vip ip add show </p>
<p>8.node1 æ¨¡æ‹Ÿ keepalived å…³é—­çŠ¶æ€ systemctl stop keepalived </p>
<p>9.ä½¿ç”¨ vip åœ°å€æ¥è®¿é—® rabbitmq é›†ç¾¤</p>
</blockquote>
<h4 id="Federation-Exchange"><a href="#Federation-Exchange" class="headerlink" title="Federation Exchange"></a>Federation Exchange</h4><h5 id="ä½¿ç”¨å®ƒçš„åŸå› "><a href="#ä½¿ç”¨å®ƒçš„åŸå› " class="headerlink" title="ä½¿ç”¨å®ƒçš„åŸå› "></a>ä½¿ç”¨å®ƒçš„åŸå› </h5><blockquote>
<p>(broker åŒ—äº¬)ï¼Œ(broker æ·±åœ³)å½¼æ­¤ä¹‹é—´ç›¸è·ç”šè¿œï¼Œç½‘ç»œå»¶è¿Ÿæ˜¯ä¸€ä¸ªä¸å¾—ä¸é¢å¯¹çš„é—®é¢˜ã€‚æœ‰ä¸€ä¸ªåœ¨åŒ—äº¬ çš„ä¸šåŠ¡(Client åŒ—äº¬) éœ€è¦è¿æ¥(broker åŒ—äº¬)ï¼Œå‘å…¶ä¸­çš„äº¤æ¢å™¨ exchangeA å‘é€æ¶ˆæ¯ï¼Œæ­¤æ—¶çš„ç½‘ç»œå»¶è¿Ÿå¾ˆå°ï¼Œ (Client åŒ—äº¬)å¯ä»¥è¿…é€Ÿå°†æ¶ˆæ¯å‘é€è‡³ exchangeA ä¸­ï¼Œå°±ç®—åœ¨å¼€å¯äº† publisherconfirm æœºåˆ¶æˆ–è€…äº‹åŠ¡æœºåˆ¶çš„ æƒ…å†µä¸‹ï¼Œä¹Ÿå¯ä»¥è¿…é€Ÿæ”¶åˆ°ç¡®è®¤ä¿¡æ¯ã€‚æ­¤æ—¶åˆæœ‰ä¸ªåœ¨æ·±åœ³çš„ä¸šåŠ¡(Client æ·±åœ³)éœ€è¦å‘ exchangeA å‘é€æ¶ˆæ¯ï¼Œ é‚£ä¹ˆ(Client æ·±åœ³) (broker åŒ—äº¬)ä¹‹é—´æœ‰å¾ˆå¤§çš„ç½‘ç»œå»¶è¿Ÿï¼Œ(Client æ·±åœ³) å°†å‘é€æ¶ˆæ¯è‡³ exchangeA ä¼šç»å†ä¸€ å®šçš„å»¶è¿Ÿï¼Œå°¤å…¶æ˜¯åœ¨å¼€å¯äº† publisherconfirm æœºåˆ¶æˆ–è€…äº‹åŠ¡æœºåˆ¶çš„æƒ…å†µä¸‹ï¼Œ(Client æ·±åœ³) ä¼šç­‰å¾…å¾ˆé•¿çš„å»¶ è¿Ÿæ—¶é—´æ¥æ¥æ”¶(broker åŒ—äº¬)çš„ç¡®è®¤ä¿¡æ¯ï¼Œè¿›è€Œå¿…ç„¶é€ æˆè¿™æ¡å‘é€çº¿ç¨‹çš„æ€§èƒ½é™ä½ï¼Œç”šè‡³é€ æˆä¸€å®šç¨‹åº¦ä¸Šçš„ é˜»å¡ã€‚ å°†ä¸šåŠ¡(Client æ·±åœ³)éƒ¨ç½²åˆ°åŒ—äº¬çš„æœºæˆ¿å¯ä»¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œä½†æ˜¯å¦‚æœ(Client æ·±åœ³)è°ƒç”¨çš„å¦äº›æœåŠ¡éƒ½éƒ¨ ç½²åœ¨æ·±åœ³ï¼Œé‚£ä¹ˆåˆä¼šå¼•å‘æ–°çš„æ—¶å»¶é—®é¢˜ï¼Œæ€»ä¸è§å¾—å°†æ‰€æœ‰ä¸šåŠ¡å…¨éƒ¨éƒ¨ç½²åœ¨ä¸€ä¸ªæœºæˆ¿ï¼Œé‚£ä¹ˆå®¹ç¾åˆä½•ä»¥å®ç°ï¼Ÿ è¿™é‡Œä½¿ç”¨ Federation æ’ä»¶å°±å¯ä»¥å¾ˆå¥½åœ°è§£å†³è¿™ä¸ªé—®é¢˜ã€‚</p>
<img src="/2023/02/28/RabbitMQ/Java\RabbitMQ\RabbitMQ.assets\image-20221019180047485.png" alt="image-20221019180047485" style="zoom:80%;">
</blockquote>
<h5 id="æ­å»ºæ­¥éª¤-4"><a href="#æ­å»ºæ­¥éª¤-4" class="headerlink" title="æ­å»ºæ­¥éª¤"></a>æ­å»ºæ­¥éª¤</h5><blockquote>
<p>1.éœ€è¦ä¿è¯æ¯å°èŠ‚ç‚¹å•ç‹¬è¿è¡Œ 2.åœ¨æ¯å°æœºå™¨ä¸Šå¼€å¯ federation ç›¸å…³æ’ä»¶ rabbitmq-plugins enable rabbitmq_federation rabbitmq-plugins enable rabbitmq_federation_management 3.åŸç†å›¾(å…ˆè¿è¡Œ consumer åœ¨ node2 åˆ›å»º fed_exchange)</p>
<img src="/2023/02/28/RabbitMQ/Java\RabbitMQ\RabbitMQ.assets\image-20221019180132367.png" alt="image-20221019180132367" style="zoom:80%;">

<p>4.åœ¨ downstream(node2)é…ç½® upstream(node1)</p>
<p><img src="/2023/02/28/RabbitMQ/Java\RabbitMQ\RabbitMQ.assets\image-20221019180156711.png" alt="image-20221019180156711"></p>
<p>4.æ·»åŠ  policy</p>
<p><img src="/2023/02/28/RabbitMQ/Java\RabbitMQ\RabbitMQ.assets\image-20221019180221926.png" alt="image-20221019180221926"></p>
<p>5.æˆåŠŸçš„å‰æ</p>
<p><img src="/2023/02/28/RabbitMQ/Java\RabbitMQ\RabbitMQ.assets\image-20221019180242475.png" alt="image-20221019180242475"></p>
</blockquote>
<h4 id="Federation-Queue"><a href="#Federation-Queue" class="headerlink" title="Federation Queue"></a>Federation Queue</h4><h5 id="ä½¿ç”¨å®ƒçš„åŸå› -1"><a href="#ä½¿ç”¨å®ƒçš„åŸå› -1" class="headerlink" title="ä½¿ç”¨å®ƒçš„åŸå› "></a>ä½¿ç”¨å®ƒçš„åŸå› </h5><blockquote>
<p>è”é‚¦é˜Ÿåˆ—å¯ä»¥åœ¨å¤šä¸ª Broker èŠ‚ç‚¹(æˆ–è€…é›†ç¾¤)ä¹‹é—´ä¸ºå•ä¸ªé˜Ÿåˆ—æä¾›å‡è¡¡è´Ÿè½½çš„åŠŸèƒ½ã€‚ä¸€ä¸ªè”é‚¦é˜Ÿåˆ—å¯ä»¥ è¿æ¥ä¸€ä¸ªæˆ–è€…å¤šä¸ªä¸Šæ¸¸é˜Ÿåˆ—(upstream queue)ï¼Œå¹¶ä»è¿™äº›ä¸Šæ¸¸é˜Ÿåˆ—ä¸­è·å–æ¶ˆæ¯ä»¥æ»¡è¶³æœ¬åœ°æ¶ˆè´¹è€…æ¶ˆè´¹æ¶ˆæ¯ çš„éœ€æ±‚ã€‚</p>
</blockquote>
<h5 id="æ­å»ºæ­¥éª¤-5"><a href="#æ­å»ºæ­¥éª¤-5" class="headerlink" title="æ­å»ºæ­¥éª¤"></a>æ­å»ºæ­¥éª¤</h5><blockquote>
<p>åŸç†å›¾ï¼š</p>
<img src="/2023/02/28/RabbitMQ/Java\RabbitMQ\RabbitMQ.assets\image-20221019180344936.png" alt="image-20221019180344936" style="zoom:67%;">

<p>æ·»åŠ  upstream(åŒä¸Š)</p>
<p>æ·»åŠ  policy</p>
<img src="/2023/02/28/RabbitMQ/Java\RabbitMQ\RabbitMQ.assets\image-20221019180407746.png" alt="image-20221019180407746" style="zoom:80%;">
</blockquote>
<h4 id="Shovel"><a href="#Shovel" class="headerlink" title="Shovel"></a>Shovel</h4><h5 id="ä½¿ç”¨å®ƒçš„åŸå› -2"><a href="#ä½¿ç”¨å®ƒçš„åŸå› -2" class="headerlink" title="ä½¿ç”¨å®ƒçš„åŸå› "></a>ä½¿ç”¨å®ƒçš„åŸå› </h5><blockquote>
<p>Federation å…·å¤‡çš„æ•°æ®è½¬å‘åŠŸèƒ½ç±»ä¼¼ï¼ŒShovel å¤Ÿå¯é ã€æŒç»­åœ°ä»ä¸€ä¸ª Broker ä¸­çš„é˜Ÿåˆ—(ä½œä¸ºæºç«¯ï¼Œå³ source)æ‹‰å–æ•°æ®å¹¶è½¬å‘è‡³å¦ä¸€ä¸ª Broker ä¸­çš„äº¤æ¢å™¨(ä½œä¸ºç›®çš„ç«¯ï¼Œå³ destination)ã€‚ä½œä¸ºæºç«¯çš„é˜Ÿåˆ—å’Œä½œ ä¸ºç›®çš„ç«¯çš„äº¤æ¢å™¨å¯ä»¥åŒæ—¶ä½äºåŒä¸€ä¸ª Brokerï¼Œä¹Ÿå¯ä»¥ä½äºä¸åŒçš„ Broker ä¸Šã€‚Shovel å¯ä»¥ç¿»è¯‘ä¸ºâ€é“²å­â€ï¼Œ æ˜¯ä¸€ç§æ¯”è¾ƒå½¢è±¡çš„æ¯”å–»ï¼Œè¿™ä¸ªâ€é“²å­â€å¯ä»¥å°†æ¶ˆæ¯ä»ä¸€æ–¹â€é“²å­â€å¦ä¸€æ–¹ã€‚Shovel è¡Œä¸ºå°±åƒä¼˜ç§€çš„å®¢æˆ·ç«¯åº”ç”¨ ç¨‹åºèƒ½å¤Ÿè´Ÿè´£è¿æ¥æºå’Œç›®çš„åœ°ã€è´Ÿè´£æ¶ˆæ¯çš„è¯»å†™åŠè´Ÿè´£è¿æ¥å¤±è´¥é—®é¢˜çš„å¤„ç†ã€‚</p>
</blockquote>
<h5 id="æ­å»ºæ­¥éª¤-6"><a href="#æ­å»ºæ­¥éª¤-6" class="headerlink" title="æ­å»ºæ­¥éª¤"></a>æ­å»ºæ­¥éª¤</h5><blockquote>
<p>1.å¼€å¯æ’ä»¶(éœ€è¦çš„æœºå™¨éƒ½å¼€å¯) rabbitmq-plugins enable rabbitmq_shovel rabbitmq-plugins enable rabbitmq_shovel_management 2.åŸç†å›¾(åœ¨æºå¤´å‘é€çš„æ¶ˆæ¯ç›´æ¥å›è¿›å…¥åˆ°ç›®çš„åœ°é˜Ÿåˆ—)</p>
<img src="/2023/02/28/RabbitMQ/Java\RabbitMQ\RabbitMQ.assets\image-20221019180511955.png" alt="image-20221019180511955" style="zoom:67%;">

<p>æ·»åŠ  shovel æºå’Œç›®çš„åœ° </p>
<img src="/2023/02/28/RabbitMQ/Java\RabbitMQ\RabbitMQ.assets\image-20221019180529256.png" alt="image-20221019180529256" style="zoom:67%;">
</blockquote>
]]></content>
  </entry>
  <entry>
    <title>Vue</title>
    <url>/2023/02/28/Vue/</url>
    <content><![CDATA[<h1 id><a href="#" class="headerlink" title></a></h1><h1 id="Vue"><a href="#Vue" class="headerlink" title="Vue"></a>Vue</h1><h1 id="ç»„ä»¶"><a href="#ç»„ä»¶" class="headerlink" title="ç»„ä»¶"></a>ç»„ä»¶</h1><h2 id="ç»„ä»¶çš„ç†è§£"><a href="#ç»„ä»¶çš„ç†è§£" class="headerlink" title="ç»„ä»¶çš„ç†è§£"></a>ç»„ä»¶çš„ç†è§£</h2><p>ä¼ ç»Ÿæ–¹å¼å­˜åœ¨çš„ä¸¤ä¸ªé—®é¢˜ï¼š</p>
<ol>
<li><p>å…³ç³»æ··ä¹±ï¼šCSS&#x2F;JS æ–‡ä»¶ä¾èµ–ã€‚</p>
</li>
<li><p>ä»£ç å¤ç”¨ç‡ä¸é«˜</p>
<p> â€‹	ç»„ä»¶å…è®¸æˆ‘ä»¬å°† UI åˆ’åˆ†ä¸ºç‹¬ç«‹çš„ã€å¯é‡ç”¨çš„éƒ¨åˆ†ï¼Œå¹¶ä¸”å¯ä»¥å¯¹æ¯ä¸ªéƒ¨åˆ†è¿›è¡Œå•ç‹¬çš„æ€è€ƒã€‚åœ¨å®é™…åº”ç”¨ä¸­ï¼Œç»„ä»¶å¸¸å¸¸è¢«ç»„ç»‡æˆå±‚å±‚åµŒå¥—çš„æ ‘çŠ¶ç»“æ„ï¼š</p>
</li>
</ol>
<p><img src="/2023/02/28/Vue/Java\Document\Vue\Vue.assets\image-20220920191504407.png" alt="image-20220920191504407"></p>
]]></content>
  </entry>
  <entry>
    <title>SpringCloud</title>
    <url>/2023/02/28/SpringCloud/</url>
    <content><![CDATA[<h1 id><a href="#" class="headerlink" title></a></h1><h1 id="å®šä¹‰SpringCloud"><a href="#å®šä¹‰SpringCloud" class="headerlink" title="å®šä¹‰SpringCloud"></a>å®šä¹‰SpringCloud</h1><h1 id="å¾®æœåŠ¡æ¦‚è¿°ä¸SpringCloud"><a href="#å¾®æœåŠ¡æ¦‚è¿°ä¸SpringCloud" class="headerlink" title="å¾®æœåŠ¡æ¦‚è¿°ä¸SpringCloud"></a>å¾®æœåŠ¡æ¦‚è¿°ä¸SpringCloud</h1><h2 id="å¾®æœåŠ¡ä¸å¾®æœåŠ¡æ¶æ„"><a href="#å¾®æœåŠ¡ä¸å¾®æœåŠ¡æ¶æ„" class="headerlink" title="å¾®æœåŠ¡ä¸å¾®æœåŠ¡æ¶æ„"></a>å¾®æœåŠ¡ä¸å¾®æœåŠ¡æ¶æ„</h2><h3 id="å¾®æœåŠ¡"><a href="#å¾®æœåŠ¡" class="headerlink" title="å¾®æœåŠ¡"></a>å¾®æœåŠ¡</h3><p>é©¬ä¸.ç¦å‹’ï¼ˆMartin Fowlerï¼‰å¯¹å¾®æœåŠ¡çš„æè¿°ï¼š<a href="https://martinfowler.com/articles/microservices.html">https://martinfowler.com/articles/microservices.html</a></p>
<p>å¼ºè°ƒçš„æ˜¯æœåŠ¡çš„å¤§å°ï¼Œå®ƒå…³æ³¨çš„æ˜¯æŸä¸€ä¸ªç‚¹ï¼Œæ˜¯å…·ä½“è§£å†³æŸä¸€ä¸ªé—®é¢˜&#x2F;æä¾›è½åœ°å¯¹åº”æœåŠ¡çš„ä¸€ä¸ªæœåŠ¡åº”ç”¨ã€‚</p>
<blockquote>
<p>â€‹		å¾®æœåŠ¡æ¶æ„æ˜¯â¼€ç§æ¶æ„æ¨¡å¼ï¼Œå®ƒï¼Œ<mark>æå€¡å°†</mark>å•â¼€åº”â½¤ç¨‹åºåˆ’åˆ†æˆâ¼€ç»„â¼©çš„æœåŠ¡ï¼ŒæœåŠ¡ä¹‹é—´äº’ç›¸åè°ƒã€äº’ç›¸é…åˆï¼Œä¸ºâ½¤æˆ·æä¾›æœ€ç»ˆä»·å€¼ã€‚æ¯ä¸ªæœåŠ¡è¿â¾åœ¨å…¶ç‹¬â½´çš„è¿›ç¨‹ä¸­ï¼ŒæœåŠ¡ä¸æœåŠ¡é—´é‡‡â½¤è½»é‡çº§çš„é€šä¿¡æœºåˆ¶äº’ç›¸åä½œï¼ˆé€šå¸¸æ˜¯åŸºäºHTTPåè®®çš„RESTful APIï¼‰ã€‚æ¯ä¸ªæœåŠ¡éƒ½å›´ç»•ç€å…·ä½“ä¸šåŠ¡è¿›â¾æ„å»ºï¼Œå¹¶ä¸”èƒ½å¤Ÿè¢«ç‹¬â½´çš„éƒ¨ç½²åˆ°â½£äº§ç¯å¢ƒã€ç±»â½£äº§ç¯å¢ƒç­‰ã€‚å¦å¤–ï¼Œåº”å½“å°½é‡é¿å…ç»Ÿâ¼€çš„ã€é›†ä¸­å¼çš„æœåŠ¡ç®¡ç†æœºåˆ¶ï¼Œå¯¹å…·ä½“çš„â¼€ä¸ªæœåŠ¡â½½â¾”ï¼Œåº”æ ¹æ®ä¸šåŠ¡ä¸Šä¸‹â½‚ï¼Œé€‰æ‹©åˆé€‚çš„è¯­â¾”ã€â¼¯å…·å¯¹å…¶è¿›â¾æ„å»ºã€‚</p>
<p>æŠ€æœ¯è§’åº¦ç†è§£</p>
<p>â€‹		å¾®æœåŠ¡åŒ–çš„æ ¸å¿ƒå°±æ˜¯å°†ä¼ ç»Ÿçš„ä¸€ç«™å¼åº”ç”¨ï¼Œæ ¹æ®ä¸šåŠ¡æ‹†åˆ†æˆä¸€ä¸ªä¸€ä¸ªçš„æœåŠ¡ï¼Œå½»åº•åœ°å»è€¦åˆï¼Œæ¯ä¸€ä¸ªå¾®æœåŠ¡æä¾›å•ä¸ªä¸šåŠ¡åŠŸèƒ½çš„æœåŠ¡ï¼Œä¸€ä¸ªæœåŠ¡åšä¸€ä»¶äº‹ï¼Œä»æŠ€æœ¯è§’åº¦çœ‹å°±æ˜¯ä¸€ç§å°è€Œç‹¬ç«‹çš„å¤„ç†è¿‡ç¨‹ï¼Œç±»ä¼¼è¿›ç¨‹æ¦‚å¿µï¼Œèƒ½å¤Ÿè‡ªè¡Œå•ç‹¬å¯åŠ¨æˆ–é”€æ¯ï¼Œæ‹¥æœ‰è‡ªå·±ç‹¬ç«‹çš„æ•°æ®åº“ã€‚</p>
</blockquote>
<h3 id="å¾®æœåŠ¡çš„æŠ€æœ¯æ ˆ"><a href="#å¾®æœåŠ¡çš„æŠ€æœ¯æ ˆ" class="headerlink" title="å¾®æœåŠ¡çš„æŠ€æœ¯æ ˆ"></a>å¾®æœåŠ¡çš„æŠ€æœ¯æ ˆ</h3><h1 id="RestTemplateçš„ä½¿ç”¨"><a href="#RestTemplateçš„ä½¿ç”¨" class="headerlink" title="RestTemplateçš„ä½¿ç”¨"></a>RestTemplateçš„ä½¿ç”¨</h1><p>æ–‡æ¡£ï¼š<a href="https://docs.spring.io/spring-framework/docs/5.2.2.RELEASE/javadoc-api/org/springframework/web/client/RestTemplate.html">https://docs.spring.io/spring-framework/docs/5.2.2.RELEASE/javadoc-api/org/springframework/web/client/RestTemplate.html</a></p>
<p>Getè¯·æ±‚æ–¹æ³•ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">&lt;T&gt; T <span class="title function_">getForObject</span><span class="params">(String url, Class&lt;T&gt; responseType, Object... uriVariables)</span>;</span><br><span class="line"> </span><br><span class="line">&lt;T&gt; T <span class="title function_">getForObject</span><span class="params">(String url, Class&lt;T&gt; responseType, Map&lt;String, ?&gt; uriVariables)</span>;</span><br><span class="line"> </span><br><span class="line">&lt;T&gt; T <span class="title function_">getForObject</span><span class="params">(URI url, Class&lt;T&gt; responseType)</span>;</span><br><span class="line"> </span><br><span class="line">&lt;T&gt; ResponseEntity&lt;T&gt; <span class="title function_">getForEntity</span><span class="params">(String url, Class&lt;T&gt; responseType, Object... uriVariables)</span>;</span><br><span class="line"> </span><br><span class="line">&lt;T&gt; ResponseEntity&lt;T&gt; <span class="title function_">getForEntity</span><span class="params">(String url, Class&lt;T&gt; responseType, Map&lt;String, ?&gt; uriVariables)</span>;</span><br><span class="line"> </span><br><span class="line">&lt;T&gt; ResponseEntity&lt;T&gt; <span class="title function_">getForEntity</span><span class="params">(URI var1, Class&lt;T&gt; responseType)</span>;</span><br></pre></td></tr></table></figure>

<p>Postè¯·æ±‚æ–¹æ³•ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">&lt;T&gt; T <span class="title function_">postForObject</span><span class="params">(String url, <span class="meta">@Nullable</span> Object request, Class&lt;T&gt; responseType, Object... uriVariables)</span>;</span><br><span class="line"> </span><br><span class="line">&lt;T&gt; T <span class="title function_">postForObject</span><span class="params">(String url, <span class="meta">@Nullable</span> Object request, Class&lt;T&gt; responseType, Map&lt;String, ?&gt; uriVariables)</span>;</span><br><span class="line"> </span><br><span class="line">&lt;T&gt; T <span class="title function_">postForObject</span><span class="params">(URI url, <span class="meta">@Nullable</span> Object request, Class&lt;T&gt; responseType)</span>;</span><br><span class="line"> </span><br><span class="line">&lt;T&gt; ResponseEntity&lt;T&gt; <span class="title function_">postForEntity</span><span class="params">(String url, <span class="meta">@Nullable</span> Object request, Class&lt;T&gt; responseType, Object... uriVariables)</span>;</span><br><span class="line"> </span><br><span class="line">&lt;T&gt; ResponseEntity&lt;T&gt; <span class="title function_">postForEntity</span><span class="params">(String url, <span class="meta">@Nullable</span> Object request, Class&lt;T&gt; responseType, Map&lt;String, ?&gt; uriVariables)</span>;</span><br><span class="line"> </span><br><span class="line">&lt;T&gt; ResponseEntity&lt;T&gt; <span class="title function_">postForEntity</span><span class="params">(URI url, <span class="meta">@Nullable</span> Object request, Class&lt;T&gt; responseType)</span>;</span><br></pre></td></tr></table></figure>

<p>æ³¨æ„ï¼šgetForObjectæ–¹æ³•&#x2F;getForEntityæ–¹æ³•çš„åŒºåˆ«</p>
<blockquote>
<ol>
<li><p>getForObject() è¿”å›å¯¹è±¡ä¸ºå“åº”ä½“ä¸­æ•°æ®è½¬åŒ–æˆçš„å¯¹è±¡</p>
</li>
<li><p>getForEntity() è¿”å›å¯¹è±¡ä¸ºResponseEntityå¯¹è±¡ï¼ŒåŒ…å«äº†å“åº”ä¸­çš„ä¸€äº›é‡è¦ä¿¡æ¯ï¼Œæ¯”å¦‚å“åº”å¤´ã€å“åº”çŠ¶æ€ç ã€å“åº”ä½“ç­‰</p>
</li>
<li><p>ä½¿ç”¨ï¼š</p>
 <figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/consumer/payment/getForEntity/&#123;id&#125;&quot;)</span></span><br><span class="line"><span class="keyword">public</span> CommonResult&lt;Payment&gt; <span class="title function_">getPaymentForEntityById</span><span class="params">(</span></span><br><span class="line"><span class="params">    <span class="meta">@PathVariable(&quot;id&quot;)</span> Long id)</span> &#123;</span><br><span class="line">    ResponseEntity&lt;CommonResult&gt; entity =</span><br><span class="line">        restTemplate.getForEntity(</span><br><span class="line">        PAYMENT_INVOKE_URL + <span class="string">&quot;payment/get/&quot;</span> + id, CommonResult.class);</span><br><span class="line">    <span class="keyword">if</span> (entity.getStatusCode().is2xxSuccessful()) &#123;</span><br><span class="line">        <span class="keyword">return</span> entity.getBody();</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">CommonResult</span>&lt;&gt;(<span class="number">40000</span>, <span class="string">&quot;failed&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@GetMapping(&quot;/consumer/payment/createForEntity&quot;)</span></span><br><span class="line"><span class="keyword">public</span> CommonResult&lt;Long&gt; <span class="title function_">postPaymentForEntity</span><span class="params">(Payment payment)</span> &#123;</span><br><span class="line">    ResponseEntity&lt;CommonResult&gt; entity =</span><br><span class="line">        restTemplate.postForEntity(</span><br><span class="line">        PAYMENT_INVOKE_URL + <span class="string">&quot;payment/create/&quot;</span>, payment, CommonResult.class);</span><br><span class="line">    <span class="keyword">if</span> (entity.getStatusCode().is2xxSuccessful()) &#123;</span><br><span class="line">        <span class="keyword">return</span> entity.getBody();</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">CommonResult</span>&lt;&gt;(<span class="number">40000</span>, <span class="string">&quot;failed&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ol>
</blockquote>
<h1 id="EurekaæœåŠ¡æ³¨å†Œä¸å‘ç°"><a href="#EurekaæœåŠ¡æ³¨å†Œä¸å‘ç°" class="headerlink" title="EurekaæœåŠ¡æ³¨å†Œä¸å‘ç°"></a>EurekaæœåŠ¡æ³¨å†Œä¸å‘ç°</h1><h2 id="æœåŠ¡æ²»ç†"><a href="#æœåŠ¡æ²»ç†" class="headerlink" title="æœåŠ¡æ²»ç†"></a>æœåŠ¡æ²»ç†</h2><p>æœåŠ¡æ²»ç†ï¼šç®¡ç†æœåŠ¡ä¹‹é—´çš„ä¾èµ–å…³ç³»ã€‚</p>
<blockquote>
<ol>
<li><p>Spring Cloud å°è£…äº† Netflix å…¬å¸å¼€å‘çš„ Eureka æ¨¡å—æ¥å®ç°æœåŠ¡æ²»ç†</p>
</li>
<li><p>åœ¨ä¼ ç»Ÿçš„rpcè¿œç¨‹è°ƒç”¨æ¡†æ¶ä¸­ï¼Œç®¡ç†æ¯ä¸ªæœåŠ¡ä¸æœåŠ¡ä¹‹é—´ä¾èµ–å…³ç³»æ¯”è¾ƒå¤æ‚ï¼Œç®¡ç†æ¯”è¾ƒå¤æ‚ï¼Œæ‰€ä»¥éœ€è¦ä½¿ç”¨æœåŠ¡æ²»ç†ï¼Œç®¡ç†æœåŠ¡äºæœåŠ¡ä¹‹é—´ä¾èµ–å…³ç³»ï¼Œå¯ä»¥å®ç°æœåŠ¡è°ƒç”¨ã€è´Ÿè½½å‡è¡¡ã€å®¹é”™ç­‰ï¼Œå®ç°æœåŠ¡å‘ç°ä¸æ³¨å†Œã€‚</p>
</li>
</ol>
</blockquote>
<h2 id="æœåŠ¡æ³¨å†Œä¸å‘ç°"><a href="#æœåŠ¡æ³¨å†Œä¸å‘ç°" class="headerlink" title="æœåŠ¡æ³¨å†Œä¸å‘ç°"></a>æœåŠ¡æ³¨å†Œä¸å‘ç°</h2><blockquote>
<ol>
<li>Eurekaé‡‡ç”¨äº†CSçš„è®¾è®¡æ¶æ„ï¼ŒEureka Server ä½œä¸ºæœåŠ¡æ³¨å†ŒåŠŸèƒ½çš„æœåŠ¡å™¨ï¼Œå®ƒæ˜¯æœåŠ¡æ³¨å†Œä¸­å¿ƒã€‚è€Œç³»ç»Ÿä¸­çš„å…¶ä»–å¾®æœåŠ¡ï¼Œä½¿ç”¨ Eurekaçš„å®¢æˆ·ç«¯è¿æ¥åˆ° Eureka Serverå¹¶ç»´æŒå¿ƒè·³è¿æ¥ã€‚è¿™æ ·ï¼Œç³»ç»Ÿçš„ç»´æŠ¤äººå‘˜å°±å¯ä»¥é€šè¿‡ Eureka Server æ¥ç›‘æ§ç³»ç»Ÿä¸­å„ä¸ªå¾®æœåŠ¡æ˜¯å¦æ­£å¸¸è¿è¡Œã€‚</li>
<li>åœ¨æœåŠ¡æ³¨å†Œä¸å‘ç°ä¸­ï¼Œæœ‰ä¸€ä¸ªæ³¨å†Œä¸­å¿ƒã€‚å½“æœåŠ¡å™¨å¯åŠ¨çš„æ—¶å€™ï¼Œä¼šæŠŠå½“å‰è‡ªå·±æœåŠ¡å™¨çš„ä¿¡æ¯æ¯”å¦‚ï¼šæœåŠ¡åœ°å€é€šè®¯åœ°å€ç­‰ä»¥åˆ«åæ–¹å¼æ³¨å†Œåˆ°æ³¨å†Œä¸­å¿ƒä¸Šã€‚å¦ä¸€æ–¹ï¼ˆæ¶ˆè´¹è€…æˆ–è€…æœåŠ¡æä¾›è€…ï¼‰ï¼Œä»¥è¯¥åˆ«åçš„æ–¹å¼å»æ³¨å†Œä¸­å¿ƒä¸Šè·å–åˆ°å®é™…çš„æœåŠ¡é€šè®¯åœ°å€ï¼Œç„¶åå†å®ç°æœ¬åœ°RPCè°ƒç”¨ã€‚</li>
<li>RPCè¿œç¨‹è°ƒç”¨æ¡†æ¶æ ¸å¿ƒè®¾è®¡æ€æƒ³ï¼šåœ¨äºæ³¨å†Œä¸­å¿ƒï¼Œå› ä¸ºä½¿ç”¨æ³¨å†Œä¸­å¿ƒç®¡ç†æ¯ä¸ªæœåŠ¡ä¸æœåŠ¡ä¹‹é—´çš„ä¸€ä¸ªä¾èµ–å…³ç³»ï¼ˆæœåŠ¡æ²»ç†æ¦‚å¿µï¼‰ã€‚åœ¨ä»»ä½•rpcè¿œç¨‹æ¡†æ¶ä¸­ï¼Œéƒ½ä¼šæœ‰ä¸€ä¸ªæ³¨å†Œä¸­å¿ƒã€å­˜æ”¾æœåŠ¡åœ°å€ç›¸å…³ä¿¡æ¯ã€‘</li>
</ol>
</blockquote>
<h2 id="EurekaServerä¸EurekaClient"><a href="#EurekaServerä¸EurekaClient" class="headerlink" title="EurekaServerä¸EurekaClient"></a>EurekaServerä¸EurekaClient</h2><blockquote>
<ol>
<li><p>EurekaåŒ…å«ä¸¤ä¸ªç»„ä»¶ï¼šEureka Serverå’ŒEureka Client</p>
</li>
<li><p>Eureka Serveræä¾›æœåŠ¡æ³¨å†ŒæœåŠ¡<br> å„ä¸ªå¾®æœåŠ¡èŠ‚ç‚¹é€šè¿‡é…ç½®å¯åŠ¨åï¼Œä¼šåœ¨EurekaServerä¸­è¿›è¡Œæ³¨å†Œï¼Œè¿™æ ·EurekaServerä¸­çš„æœåŠ¡æ³¨å†Œè¡¨ä¸­å°†ä¼šå­˜å‚¨æ‰€æœ‰å¯ç”¨æœåŠ¡èŠ‚ç‚¹çš„ä¿¡æ¯ï¼ŒæœåŠ¡èŠ‚ç‚¹çš„ä¿¡æ¯å¯ä»¥åœ¨ç•Œé¢ä¸­ç›´è§‚çœ‹åˆ°ã€‚</p>
</li>
<li><p>EurekaClienté€šè¿‡æ³¨å†Œä¸­å¿ƒè¿›è¡Œè®¿é—®<br> EurekaClientæ˜¯ä¸€ä¸ªJavaå®¢æˆ·ç«¯ï¼Œç”¨äºç®€åŒ–Eureka Serverçš„äº¤äº’ï¼Œå®¢æˆ·ç«¯åŒæ—¶ä¹Ÿå…·å¤‡ä¸€ä¸ªå†…ç½®çš„ã€ä½¿ç”¨è½®è¯¢(round-robin)è´Ÿè½½ç®—æ³•çš„è´Ÿè½½å‡è¡¡å™¨ã€‚</p>
</li>
<li><p>åœ¨åº”ç”¨å¯åŠ¨åï¼Œå°†ä¼šå‘Eureka Serverå‘é€å¿ƒè·³ï¼ˆé»˜è®¤å‘¨æœŸä¸º30ç§’ï¼‰ã€‚å¦‚æœEureka Serveråœ¨å¤šä¸ªå¿ƒè·³å‘¨æœŸå†…æ²¡æœ‰æ¥æ”¶åˆ°æŸä¸ªèŠ‚ç‚¹çš„å¿ƒè·³ï¼ŒEurekaServerå°†ä¼šä»æœåŠ¡æ³¨å†Œè¡¨ä¸­æŠŠè¿™ä¸ªæœåŠ¡èŠ‚ç‚¹ç§»é™¤ï¼ˆé»˜è®¤90ç§’ï¼‰</p>
</li>
</ol>
</blockquote>
<h2 id="æ­å»ºEurekaæœåŠ¡"><a href="#æ­å»ºEurekaæœåŠ¡" class="headerlink" title="æ­å»ºEurekaæœåŠ¡"></a>æ­å»ºEurekaæœåŠ¡</h2><h3 id="å•æœºç‰ˆ"><a href="#å•æœºç‰ˆ" class="headerlink" title="å•æœºç‰ˆ"></a>å•æœºç‰ˆ</h3><blockquote>
<p>ä¸»è¦æ­¥éª¤ï¼š</p>
<ol>
<li><p>ã€å¼•å…¥ä¾èµ–ï¼š<strong>spring-cloud-starter-netflix-eureka-server</strong>ã€‘</p>
</li>
<li><p>å¯åŠ¨ç±»æ·»åŠ  @EnableEurekaServer</p>
</li>
<li><p>é…ç½®ï¼š</p>
 <figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">7001</span></span><br><span class="line"><span class="attr">eureka:</span></span><br><span class="line">  <span class="attr">instance:</span></span><br><span class="line">    <span class="comment">#hostname: localhost #eurekaæœåŠ¡ç«¯çš„å®ä¾‹åç§°</span></span><br><span class="line">    <span class="attr">hostname:</span> <span class="string">eureka7001.com</span> <span class="comment">#eurekaæœåŠ¡ç«¯çš„å®ä¾‹åç§°</span></span><br><span class="line">  <span class="attr">client:</span></span><br><span class="line">    <span class="comment">#falseè¡¨ç¤ºä¸å‘æ³¨å†Œä¸­å¿ƒæ³¨å†Œå½“å‰æœåŠ¡</span></span><br><span class="line">    <span class="attr">register-with-eureka:</span> <span class="literal">false</span></span><br><span class="line">    <span class="comment">#falseè¡¨ç¤ºå½“å‰æœåŠ¡å°±æ˜¯æ³¨å†Œä¸­å¿ƒï¼Œä¸»è¦èŒè´£å°±æ˜¯ç»´æŠ¤æœåŠ¡å®ä¾‹ï¼Œå¹¶ä¸éœ€è¦å»æ£€ç´¢æœåŠ¡</span></span><br><span class="line">    <span class="attr">fetch-registry:</span> <span class="literal">false</span></span><br><span class="line">    <span class="attr">service-url:</span></span><br><span class="line">      <span class="comment">#è®¾ç½®ä¸Eureka Serveräº¤äº’çš„åœ°å€æŸ¥è¯¢æœåŠ¡å’Œæ³¨å†ŒæœåŠ¡éƒ½éœ€è¦ä¾èµ–è¿™ä¸ªåœ°å€</span></span><br><span class="line">      <span class="comment">#defaultZone: http://$&#123;eureka.instance.hostname&#125;:$&#123;server.port&#125;/eureka/</span></span><br><span class="line">      <span class="attr">defaultZone:</span> <span class="string">http://eureka7002.com:7002/eureka/</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>è®¿é—®ï¼šlocalhost:7001</p>
</li>
</ol>
</blockquote>
<p>ç¬¬ä¸€æ­¥ï¼š&#x3D;&#x3D;æ–°&#x3D;&#x3D;<strong>å»ºå·¥ç¨‹</strong>ï¼šcloud-eureka-server7001</p>
<blockquote>
<p>åŒæ—¶æ·»åŠ åŸŸåæ˜ å°„ï¼Œ&#x3D;&#x3D;æ–¹ä¾¿æµ‹è¯•&#x3D;&#x3D;ï¼šC:\Windows\System32\drivers\etc\hosts</p>
<figure class="highlight tex"><table><tr><td class="code"><pre><span class="line">127.0.0.1  eureka7001.com</span><br><span class="line">127.0.0.1  eureka7002.com</span><br><span class="line">127.0.0.1  eureka7003.com</span><br></pre></td></tr></table></figure>
</blockquote>
<p>ç¬¬äºŒæ­¥ï¼špom.xml</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-netflix-eureka-server<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.example<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>cloud-commons<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-actuator<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-devtools<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>runtime<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>ç¬¬ä¸‰æ­¥ï¼š<mark>application.yml</mark></p>
<figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">7001</span></span><br><span class="line"><span class="attr">eureka:</span></span><br><span class="line">  <span class="attr">instance:</span></span><br><span class="line">    <span class="comment">#hostname: localhost #eurekaæœåŠ¡ç«¯çš„å®ä¾‹åç§°</span></span><br><span class="line">    <span class="attr">hostname:</span> <span class="string">eureka7001.com</span> <span class="comment">#eurekaæœåŠ¡ç«¯çš„å®ä¾‹åç§°</span></span><br><span class="line">  <span class="attr">client:</span></span><br><span class="line">    <span class="comment">#falseè¡¨ç¤ºä¸å‘æ³¨å†Œä¸­å¿ƒæ³¨å†Œå½“å‰æœåŠ¡</span></span><br><span class="line">    <span class="attr">register-with-eureka:</span> <span class="literal">false</span></span><br><span class="line">    <span class="comment">#falseè¡¨ç¤ºå½“å‰æœåŠ¡å°±æ˜¯æ³¨å†Œä¸­å¿ƒï¼Œä¸»è¦èŒè´£å°±æ˜¯ç»´æŠ¤æœåŠ¡å®ä¾‹ï¼Œå¹¶ä¸éœ€è¦å»æ£€ç´¢æœåŠ¡</span></span><br><span class="line">    <span class="attr">fetch-registry:</span> <span class="literal">false</span></span><br><span class="line">    <span class="attr">service-url:</span></span><br><span class="line">      <span class="comment">#è®¾ç½®ä¸Eureka Serveräº¤äº’çš„åœ°å€æŸ¥è¯¢æœåŠ¡å’Œæ³¨å†ŒæœåŠ¡éƒ½éœ€è¦ä¾èµ–è¿™ä¸ªåœ°å€</span></span><br><span class="line">      <span class="comment">#defaultZone: http://$&#123;eureka.instance.hostname&#125;:$&#123;server.port&#125;/eureka/</span></span><br><span class="line">      <span class="attr">defaultZone:</span> <span class="string">http://eureka7002.com:7002/eureka/</span></span><br></pre></td></tr></table></figure>

<p>ç¬¬å››æ­¥ï¼šè®¿é—® <a href="http://localhost:7001/">http://localhost:7001/</a></p>
<h3 id="é›†ç¾¤ç‰ˆ"><a href="#é›†ç¾¤ç‰ˆ" class="headerlink" title="é›†ç¾¤ç‰ˆ"></a>é›†ç¾¤ç‰ˆ</h3><p>IDEAä¸­ï¼Œå¤åˆ¶cloud-eureka-server7001ä¸ºcloud-eureka-server7002</p>
<p>å¤åˆ¶å·¥ç¨‹éœ€è¦æ³¨æ„ï¼š</p>
<ol>
<li>åœ¨çˆ¶å·¥ç¨‹æ·»åŠ module</li>
<li>ä¿®æ”¹cloud-eureka-server7002çš„ ã€<artifactId><name><description>ã€‘</description></name></artifactId></li>
<li>ä¿®æ”¹ä¸»å¯åŠ¨ç±»</li>
<li>å¦‚æœæ¨¡å—æ˜¾ç¤ºæœ‰é—®é¢˜ï¼Œæ‰“å¼€å·¥ç¨‹ç»“æ„ï¼Œé‡æ–°å¼•å…¥ cloud-eureka-server7002å³å¯ã€‚</li>
</ol>
<blockquote>
<p>é›†ç¾¤ç‰ˆåªéœ€è¦ä¿®æ”¹ yml é…ç½®æ–‡ä»¶å³å¯ã€‚</p>
<p>service-urlåœ°å€ï¼šâ€œç›¸äº’å®ˆæœ›â€</p>
<p>cloud-eureka-server7001 çš„é…ç½®</p>
<figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">7001</span></span><br><span class="line"><span class="attr">eureka:</span></span><br><span class="line">  <span class="attr">instance:</span></span><br><span class="line">    <span class="comment">#hostname: localhost #eurekaæœåŠ¡ç«¯çš„å®ä¾‹åç§°</span></span><br><span class="line">    <span class="attr">hostname:</span> <span class="string">eureka7001.com</span> <span class="comment">#eurekaæœåŠ¡ç«¯çš„å®ä¾‹åç§°</span></span><br><span class="line">  <span class="attr">client:</span></span><br><span class="line">    <span class="comment">#falseè¡¨ç¤ºä¸å‘æ³¨å†Œä¸­å¿ƒæ³¨å†Œå½“å‰æœåŠ¡</span></span><br><span class="line">    <span class="attr">register-with-eureka:</span> <span class="literal">false</span></span><br><span class="line">    <span class="comment">#falseè¡¨ç¤ºå½“å‰æœåŠ¡å°±æ˜¯æ³¨å†Œä¸­å¿ƒï¼Œä¸»è¦èŒè´£å°±æ˜¯ç»´æŠ¤æœåŠ¡å®ä¾‹ï¼Œå¹¶ä¸éœ€è¦å»æ£€ç´¢æœåŠ¡</span></span><br><span class="line">    <span class="attr">fetch-registry:</span> <span class="literal">false</span></span><br><span class="line">    <span class="attr">service-url:</span></span><br><span class="line">      <span class="comment">#è®¾ç½®ä¸Eureka Serveräº¤äº’çš„åœ°å€æŸ¥è¯¢æœåŠ¡å’Œæ³¨å†ŒæœåŠ¡éƒ½éœ€è¦ä¾èµ–è¿™ä¸ªåœ°å€</span></span><br><span class="line">      <span class="comment">#defaultZone: http://$&#123;eureka.instance.hostname&#125;:$&#123;server.port&#125;/eureka/</span></span><br><span class="line">      <span class="attr">defaultZone:</span> <span class="string">http://eureka7002.com:7002/eureka/</span></span><br></pre></td></tr></table></figure>

<p>cloud-eureka-server7002 çš„é…ç½®</p>
<figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">7002</span></span><br><span class="line"><span class="attr">eureka:</span></span><br><span class="line">  <span class="attr">instance:</span></span><br><span class="line">    <span class="comment">#hostname: localhost #eurekaæœåŠ¡ç«¯çš„å®ä¾‹åç§°</span></span><br><span class="line">    <span class="attr">hostname:</span> <span class="string">eureka7002.com</span> <span class="comment">#eurekaæœåŠ¡ç«¯çš„å®ä¾‹åç§°</span></span><br><span class="line">  <span class="attr">client:</span></span><br><span class="line">    <span class="comment">#falseè¡¨ç¤ºä¸å‘æ³¨å†Œä¸­å¿ƒæ³¨å†Œè‡ªå·±</span></span><br><span class="line">    <span class="attr">register-with-eureka:</span> <span class="literal">false</span></span><br><span class="line">    <span class="comment">#falseè¡¨ç¤ºè‡ªå·±ç«¯å°±æ˜¯æ³¨å†Œä¸­å¿ƒï¼Œæˆ‘çš„èŒè´£å°±æ˜¯ç»´æŠ¤æœåŠ¡å®ä¾‹ï¼Œå¹¶ä¸éœ€è¦å»æ£€ç´¢æœåŠ¡</span></span><br><span class="line">    <span class="attr">fetch-registry:</span> <span class="literal">false</span></span><br><span class="line">    <span class="attr">service-url:</span></span><br><span class="line">      <span class="comment">#è®¾ç½®ä¸Eureka Serveräº¤äº’çš„åœ°å€æŸ¥è¯¢æœåŠ¡å’Œæ³¨å†ŒæœåŠ¡éƒ½éœ€è¦ä¾èµ–è¿™ä¸ªåœ°å€</span></span><br><span class="line">      <span class="comment">#defaultZone: http://$&#123;eureka.instance.hostname&#125;:$&#123;server.port&#125;/eureka/</span></span><br><span class="line">      <span class="attr">defaultZone:</span> <span class="string">http://eureka7001.com:7001/eureka/</span></span><br></pre></td></tr></table></figure>


</blockquote>
<h3 id="å…¶ä»–æœåŠ¡æ³¨å†Œè¿›Eureka"><a href="#å…¶ä»–æœåŠ¡æ³¨å†Œè¿›Eureka" class="headerlink" title="å…¶ä»–æœåŠ¡æ³¨å†Œè¿›Eureka"></a>å…¶ä»–æœåŠ¡æ³¨å†Œè¿›Eureka</h3><blockquote>
<p>ä¸»è¦æ­¥éª¤ï¼š</p>
<ol>
<li><p>ã€å¼•å…¥ä¾èµ–ï¼šspring-cloud-starter-netflix-eureka-clientã€‘</p>
 <figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-netflix-eureka-client<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>å¯åŠ¨ç±»æ·»åŠ  @EnableEurekaClient</p>
</li>
<li><p>ä¿®æ”¹application.ymlé…ç½®ï¼š</p>
 <figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">8001</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">cloud-payment-service</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">datasource:</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">com.alibaba.druid.pool.DruidDataSource</span></span><br><span class="line">    <span class="attr">driver-class-name:</span> <span class="string">com.mysql.jdbc.Driver</span></span><br><span class="line">    <span class="attr">url:</span> <span class="string">jdbc:mysql://192.168.100.100:3306/springcloud?useUnicode=true&amp;characterEncoding=utf-8&amp;useSSL=false</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">    <span class="attr">password:</span> <span class="string">root</span></span><br><span class="line"></span><br><span class="line"><span class="attr">mybatis:</span></span><br><span class="line">  <span class="attr">mapper-locations:</span> <span class="string">classpath:/mapper/*.xml</span></span><br><span class="line">  <span class="attr">type-aliases-package:</span> <span class="string">com.example.springcloud.entities</span></span><br><span class="line"></span><br><span class="line"><span class="attr">eureka:</span></span><br><span class="line">  <span class="attr">client:</span></span><br><span class="line">    <span class="attr">register-with-eureka:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">fetchRegistry:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">service-url:</span></span><br><span class="line">      <span class="attr">defaultZone:</span> <span class="string">http://eureka7001.com:7001/eureka,http://eureka7002.com:7002/eureka</span></span><br></pre></td></tr></table></figure></li>
</ol>
</blockquote>
<h2 id="è´Ÿè½½å‡è¡¡"><a href="#è´Ÿè½½å‡è¡¡" class="headerlink" title="è´Ÿè½½å‡è¡¡"></a>è´Ÿè½½å‡è¡¡</h2><h3 id="æœåŠ¡æä¾›æ–¹æ­å»ºé›†ç¾¤"><a href="#æœåŠ¡æä¾›æ–¹æ­å»ºé›†ç¾¤" class="headerlink" title="æœåŠ¡æä¾›æ–¹æ­å»ºé›†ç¾¤"></a>æœåŠ¡æä¾›æ–¹æ­å»ºé›†ç¾¤</h3><p>ä¸ºäº†ä½“ç°è´Ÿè½½å‡è¡¡ï¼Œæ¯æ¬¡è®¿é—®ä½¿ç”¨ serverPort åŒºåˆ†ï¼Œä¿®æ”¹Paymentçš„Controllerï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PaymentController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;server.port&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String serverPort;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> PaymentService paymentService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/payment/get/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> CommonResult <span class="title function_">getPaymentById</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> Long id)</span> &#123;</span><br><span class="line">        <span class="type">Payment</span> <span class="variable">payment</span> <span class="operator">=</span> paymentService.getPaymentById(id);</span><br><span class="line">        <span class="keyword">if</span> (payment != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">CommonResult</span>(<span class="number">200</span>, <span class="string">&quot;success, serverPort: &quot;</span>+serverPort, payment);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">CommonResult</span>(<span class="number">40000</span>, <span class="string">&quot;failed&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>å¤åˆ¶cloud-provider-payment8001å·¥ç¨‹ä¸ºcloud-provider-payment8002ã€‚</p>
<h3 id="æœåŠ¡è°ƒç”¨æ–¹ä¿®æ”¹"><a href="#æœåŠ¡è°ƒç”¨æ–¹ä¿®æ”¹" class="headerlink" title="æœåŠ¡è°ƒç”¨æ–¹ä¿®æ”¹"></a>æœåŠ¡è°ƒç”¨æ–¹ä¿®æ”¹</h3><blockquote>
<p>æ³¨æ„ï¼š</p>
<ol>
<li>æ­¤æ—¶åº”è¯¥é€šè¿‡æœåŠ¡åå»è°ƒç”¨æä¾›æ–¹æ¥å£</li>
<li>åŒæ—¶ï¼Œä½¿ç”¨@LoadBanlanceèµ‹äºˆRestTemplateè´Ÿè½½å‡è¡¡çš„èƒ½åŠ›</li>
</ol>
</blockquote>
<p>ä¿®æ”¹OrderControllerï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OrderController</span> &#123;</span><br><span class="line">    <span class="comment">//private static final String PAYMENT_INVOKE_URL = &quot;http://localhost:8001/&quot;;</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">PAYMENT_INVOKE_URL</span> <span class="operator">=</span> <span class="string">&quot;http://CLOUD-PAYMENT-SERVICE/&quot;</span>;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>åŒæ—¶ä¿®æ”¹ï¼šã€@LoadBalancedã€‘</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ApplicationConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="meta">@LoadBalanced</span> <span class="comment">// èµ‹äºˆRestTemplateè´Ÿè½½å‡è¡¡çš„èƒ½åŠ›</span></span><br><span class="line">    <span class="keyword">public</span> RestTemplate <span class="title function_">restTemplate</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">RestTemplate</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¦‚æœä¸åŠ @LoadBalancedï¼ŒæŠ¥é”™ï¼š</p>
<figure class="highlight tex"><table><tr><td class="code"><pre><span class="line">Caused by: java.net.UnknownHostException: CLOUD-PAYMENT-SERVICE</span><br><span class="line">	at java.net.AbstractPlainSocketImpl.connect(AbstractPlainSocketImpl.java:184)</span><br><span class="line">	at java.net.PlainSocketImpl.connect(PlainSocketImpl.java:172)</span><br><span class="line">	at java.net.SocksSocketImpl.connect(SocksSocketImpl.java:392)</span><br><span class="line">	at java.net.Socket.connect(Socket.java:589)</span><br></pre></td></tr></table></figure>

<p>æ­¤æ—¶ï¼ŒæœåŠ¡è°ƒç”¨æ–¹ä¼šé»˜è®¤è½®è¯¢è®¿é—®æœåŠ¡æä¾›æ–¹çš„æ¥å£ã€‚</p>
<h2 id="actuatorå¾®æœåŠ¡ä¿¡æ¯å®Œå–„"><a href="#actuatorå¾®æœåŠ¡ä¿¡æ¯å®Œå–„" class="headerlink" title="actuatorå¾®æœåŠ¡ä¿¡æ¯å®Œå–„"></a>actuatorå¾®æœåŠ¡ä¿¡æ¯å®Œå–„</h2><p>æ­¤æ—¶çš„é—®é¢˜ï¼š</p>
<p><img src="/2023/02/28/SpringCloud/Java\Document\SpringCloud\images\image-20221227160300345.png" alt="image-20221227160300345"></p>
<p>ä¿®æ”¹application.ymlï¼šã€å¢åŠ instance-idã€‘</p>
<figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="attr">eureka:</span></span><br><span class="line">  <span class="attr">instance:</span></span><br><span class="line">    <span class="attr">instance-id:</span> <span class="string">payment8002</span>	<span class="comment">#æ˜¾ç¤ºæœåŠ¡å®ä¾‹åç§°</span></span><br><span class="line">    <span class="attr">prefer-ip-address:</span> <span class="literal">true</span>     <span class="comment">#è®¿é—®è·¯å¾„å¯ä»¥æ˜¾ç¤ºIPåœ°å€</span></span><br><span class="line">  <span class="attr">client:</span></span><br><span class="line">    <span class="attr">register-with-eureka:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">fetchRegistry:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">service-url:</span></span><br><span class="line">      <span class="attr">defaultZone:</span> <span class="string">http://eureka7001.com:7001/eureka,http://eureka7002.com:7002/eureka</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="æœåŠ¡å‘ç°"><a href="#æœåŠ¡å‘ç°" class="headerlink" title="æœåŠ¡å‘ç°"></a>æœåŠ¡å‘ç°</h2><p>â€‹		å¯¹äºæ³¨å†Œè¿›eurekaé‡Œé¢çš„å¾®æœåŠ¡ï¼Œå¯ä»¥é€šè¿‡æœåŠ¡å‘ç°æ¥è·å¾—è¯¥æœåŠ¡çš„ä¿¡æ¯ã€‚</p>
<blockquote>
<ol>
<li><p>ä¿®æ”¹ PaymentController</p>
 <figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> DiscoveryClient discoveryClient;</span><br><span class="line">    </span><br><span class="line"><span class="meta">@GetMapping(&quot;/payment/discovery&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Object <span class="title function_">discovery</span><span class="params">()</span> &#123;</span><br><span class="line">    List&lt;String&gt; serviceList = discoveryClient.getServices();</span><br><span class="line">    serviceList.forEach(service -&gt; System.out.println(<span class="string">&quot;Service: &quot;</span> + service));</span><br><span class="line">    List&lt;ServiceInstance&gt; instanceList =</span><br><span class="line">            discoveryClient.getInstances(<span class="string">&quot;CLOUD-PAYMENT-SERVICE&quot;</span>);</span><br><span class="line">    instanceList.forEach(instance -&gt;</span><br><span class="line">            System.out.println(<span class="string">&quot;Instance: &quot;</span> + instance.getServiceId() + <span class="string">&quot;\t&quot;</span> + instance.getHost() + <span class="string">&quot;\t&quot;</span> + instance.getPort()));</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>.discoveryClient;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>ä¸»å¯åŠ¨ç±»æ·»åŠ æ³¨è§£ï¼š@EnableDiscoveryClient</p>
</li>
<li><p>æµ‹è¯•ï¼Œæ§åˆ¶å°è¾“å‡ºï¼š</p>
 <figure class="highlight tex"><table><tr><td class="code"><pre><span class="line">Service: cloud-order-service</span><br><span class="line">Service: cloud-payment-service</span><br><span class="line">Instance: CLOUD-PAYMENT-SERVICE	localhost	8001</span><br><span class="line">Instance: CLOUD-PAYMENT-SERVICE	localhost	8002</span><br></pre></td></tr></table></figure></li>
</ol>
</blockquote>
<h2 id="Eurekaè‡ªæˆ‘ä¿æŠ¤"><a href="#Eurekaè‡ªæˆ‘ä¿æŠ¤" class="headerlink" title="Eurekaè‡ªæˆ‘ä¿æŠ¤"></a>Eurekaè‡ªæˆ‘ä¿æŠ¤</h2><h3 id="æ¦‚è¿°"><a href="#æ¦‚è¿°" class="headerlink" title="æ¦‚è¿°"></a>æ¦‚è¿°</h3><blockquote>
<ol>
<li><p>ä¿æŠ¤æ¨¡å¼ä¸»è¦ç”¨äºä¸€ç»„å®¢æˆ·ç«¯å’ŒEureka Serverä¹‹é—´å­˜åœ¨ç½‘ç»œåˆ†åŒºåœºæ™¯ä¸‹çš„ä¿æŠ¤ã€‚ä¸€æ—¦è¿›å…¥ä¿æŠ¤æ¨¡å¼ï¼Œ<br> Eureka Serverå°†ä¼šå°è¯•ä¿æŠ¤å…¶æœåŠ¡æ³¨å†Œè¡¨ä¸­çš„ä¿¡æ¯ï¼Œä¸å†åˆ é™¤æœåŠ¡æ³¨å†Œè¡¨ä¸­çš„æ•°æ®ï¼Œä¹Ÿå°±æ˜¯ä¸ä¼šæ³¨é”€ä»»ä½•å¾®æœåŠ¡ã€‚</p>
</li>
<li><p>å¦‚æœåœ¨Eureka Serverçš„é¦–é¡µçœ‹åˆ°ä»¥ä¸‹è¿™æ®µæç¤ºï¼Œåˆ™è¯´æ˜Eurekaè¿›å…¥äº†ä¿æŠ¤æ¨¡å¼ï¼š<br> EMERGENCY! EUREKA MAY BE INCORRECTLY CLAIMING INSTANCES ARE UP WHEN THEYâ€™RE NOT.<br> RENEWALS ARE LESSER THAN THRESHOLD AND HENCE THE INSTANCES ARE NOT BEING EXPIRED JUST TO BE SAFE</p>
</li>
</ol>
</blockquote>
<h3 id="å¯¼è‡´åŸå› "><a href="#å¯¼è‡´åŸå› " class="headerlink" title="å¯¼è‡´åŸå› "></a>å¯¼è‡´åŸå› </h3><blockquote>
<ol>
<li>ä¸ºäº†é˜²æ­¢EurekaClientå¯ä»¥æ­£å¸¸è¿è¡Œï¼Œä½†æ˜¯ä¸ EurekaServerç½‘ç»œä¸é€šæƒ…å†µä¸‹ï¼ŒEurekaServerä¸ä¼šç«‹åˆ»å°†EurekaClientæœåŠ¡å‰”é™¤</li>
<li>è‡ªæˆ‘ä¿æŠ¤æ¨¡å¼ï¼š<br> é»˜è®¤æƒ…å†µä¸‹ï¼Œå¦‚æœEurekaServeråœ¨ä¸€å®šæ—¶é—´å†…æ²¡æœ‰æ¥æ”¶åˆ°æŸä¸ªå¾®æœåŠ¡å®ä¾‹çš„å¿ƒè·³ï¼ŒEurekaServerå°†ä¼šæ³¨é”€è¯¥å®ä¾‹ï¼ˆé»˜è®¤90ç§’ï¼‰ã€‚ä½†æ˜¯å½“ç½‘ç»œåˆ†åŒºæ•…éšœå‘ç”Ÿï¼ˆå»¶æ—¶ã€å¡é¡¿ã€æ‹¥æŒ¤ï¼‰æ—¶ï¼Œå¾®æœåŠ¡ä¸EurekaServerä¹‹é—´æ— æ³•æ­£å¸¸é€šä¿¡ï¼Œä»¥ä¸Šè¡Œä¸ºå¯èƒ½å˜å¾—éå¸¸å±é™©äº†ï¼Œå› ä¸ºå¾®æœåŠ¡æœ¬èº«å…¶å®æ˜¯å¥åº·çš„ï¼Œæ­¤æ—¶æœ¬ä¸åº”è¯¥æ³¨é”€è¿™ä¸ªå¾®æœåŠ¡ã€‚</li>
<li>Eurekaé€šè¿‡â€œè‡ªæˆ‘ä¿æŠ¤æ¨¡å¼â€æ¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼šå½“EurekaServerèŠ‚ç‚¹åœ¨çŸ­æ—¶é—´å†…ä¸¢å¤±è¿‡å¤šå®¢æˆ·ç«¯æ—¶ï¼ˆå¯èƒ½å‘ç”Ÿäº†ç½‘ç»œåˆ†åŒºæ•…éšœï¼‰ï¼Œé‚£ä¹ˆè¿™ä¸ªèŠ‚ç‚¹å°±ä¼šè¿›å…¥è‡ªæˆ‘ä¿æŠ¤æ¨¡å¼ã€‚</li>
<li><strong>åœ¨è‡ªæˆ‘ä¿æŠ¤æ¨¡å¼ä¸­ï¼ŒEureka Serverä¼šä¿æŠ¤æœåŠ¡æ³¨å†Œè¡¨ä¸­çš„ä¿¡æ¯ï¼Œä¸å†æ³¨é”€ä»»ä½•æœåŠ¡å®ä¾‹ã€‚</strong></li>
<li>è‡ªæˆ‘ä¿æŠ¤æ¨¡å¼æ˜¯ä¸€ç§åº”å¯¹ç½‘ç»œå¼‚å¸¸çš„å®‰å…¨ä¿æŠ¤æªæ–½ã€‚å®ƒçš„æ¶æ„å“²å­¦æ˜¯å®å¯åŒæ—¶ä¿ç•™æ‰€æœ‰å¾®æœåŠ¡ï¼ˆå¥åº·çš„å¾®æœåŠ¡å’Œä¸å¥åº·çš„å¾®æœåŠ¡éƒ½ä¼šä¿ç•™ï¼‰ä¹Ÿä¸ç›²ç›®æ³¨é”€ä»»ä½•å¥åº·çš„å¾®æœåŠ¡ã€‚ä½¿ç”¨è‡ªæˆ‘ä¿æŠ¤æ¨¡å¼ï¼Œå¯ä»¥è®©Eurekaé›†ç¾¤æ›´åŠ çš„å¥å£®ã€ç¨³å®šã€‚</li>
<li>å±äºCAPé‡Œé¢çš„APåˆ†æ”¯ã€‚</li>
</ol>
</blockquote>
<h3 id="ç¦æ­¢è‡ªæˆ‘ä¿æŠ¤"><a href="#ç¦æ­¢è‡ªæˆ‘ä¿æŠ¤" class="headerlink" title="ç¦æ­¢è‡ªæˆ‘ä¿æŠ¤"></a>ç¦æ­¢è‡ªæˆ‘ä¿æŠ¤</h3><ol>
<li><p>EurekaServerç«¯å…³é—­è‡ªæˆ‘ä¿æŠ¤ï¼š<strong>eureka.server.enable-self-preservation&#x3D;true</strong></p>
 <figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="attr">eureka:</span></span><br><span class="line">  <span class="attr">instance:</span></span><br><span class="line">    <span class="comment">#hostname: localhost #eurekaæœåŠ¡ç«¯çš„å®ä¾‹åç§°</span></span><br><span class="line">    <span class="attr">hostname:</span> <span class="string">eureka7001.com</span> <span class="comment">#eurekaæœåŠ¡ç«¯çš„å®ä¾‹åç§°</span></span><br><span class="line">  <span class="attr">client:</span></span><br><span class="line">    <span class="comment">#falseè¡¨ç¤ºä¸å‘æ³¨å†Œä¸­å¿ƒæ³¨å†Œå½“å‰æœåŠ¡</span></span><br><span class="line">    <span class="attr">register-with-eureka:</span> <span class="literal">false</span></span><br><span class="line">    <span class="comment">#falseè¡¨ç¤ºå½“å‰æœåŠ¡å°±æ˜¯æ³¨å†Œä¸­å¿ƒï¼Œä¸»è¦èŒè´£å°±æ˜¯ç»´æŠ¤æœåŠ¡å®ä¾‹ï¼Œå¹¶ä¸éœ€è¦å»æ£€ç´¢æœåŠ¡</span></span><br><span class="line">    <span class="attr">fetch-registry:</span> <span class="literal">false</span></span><br><span class="line">    <span class="attr">service-url:</span></span><br><span class="line">      <span class="comment">#è®¾ç½®ä¸Eureka Serveräº¤äº’çš„åœ°å€æŸ¥è¯¢æœåŠ¡å’Œæ³¨å†ŒæœåŠ¡éƒ½éœ€è¦ä¾èµ–è¿™ä¸ªåœ°å€</span></span><br><span class="line">      <span class="comment">#defaultZone: http://$&#123;eureka.instance.hostname&#125;:$&#123;server.port&#125;/eureka/</span></span><br><span class="line">      <span class="attr">defaultZone:</span> <span class="string">http://eureka7002.com:7002/eureka/</span></span><br><span class="line">  <span class="attr">server:</span></span><br><span class="line">    <span class="comment">#å…³é—­è‡ªæˆ‘ä¿æŠ¤æœºåˆ¶ï¼Œä¿è¯ä¸å¯ç”¨æœåŠ¡è¢«åŠæ—¶è¸¢é™¤</span></span><br><span class="line">    <span class="attr">enable-self-preservation:</span> <span class="literal">false</span></span><br><span class="line">    <span class="attr">eviction-interval-timer-in-ms:</span> <span class="number">2000</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>æµ‹è¯•ï¼šç”Ÿäº§è€…ç«¯</p>
<p> è®¾ç½® lease-renewal-interval-in-seconds å’Œ lease-expiration-duration-in-seconds</p>
 <figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="attr">eureka:</span></span><br><span class="line">  <span class="attr">instance:</span></span><br><span class="line">    <span class="attr">instance-id:</span> <span class="string">payment8001</span></span><br><span class="line">    <span class="comment">#Eurekaå®¢æˆ·ç«¯å‘æœåŠ¡ç«¯å‘é€å¿ƒè·³çš„æ—¶é—´é—´éš”ï¼Œå•ä½ä¸ºç§’(é»˜è®¤æ˜¯30ç§’)</span></span><br><span class="line">    <span class="attr">lease-renewal-interval-in-seconds:</span> <span class="number">1</span></span><br><span class="line">    <span class="comment">#EurekaæœåŠ¡ç«¯åœ¨æ”¶åˆ°æœ€åä¸€æ¬¡å¿ƒè·³åç­‰å¾…æ—¶é—´ä¸Šé™ï¼Œå•ä½ä¸ºç§’(é»˜è®¤æ˜¯90ç§’)ï¼Œè¶…æ—¶å°†å‰”é™¤æœåŠ¡</span></span><br><span class="line">    <span class="attr">lease-expiration-duration-in-seconds:</span> <span class="number">2</span></span><br><span class="line">  <span class="attr">client:</span></span><br><span class="line">    <span class="attr">register-with-eureka:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">fetchRegistry:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">service-url:</span></span><br><span class="line">      <span class="attr">defaultZone:</span> <span class="string">http://eureka7001.com:7001/eureka,http://eureka7002.com:7002/eureka</span></span><br></pre></td></tr></table></figure>

<p> ç»“æœï¼šå½“å®ä¾‹ä¸å¯ç”¨æ—¶ï¼ŒEurekaä¼šç«‹å³å‰”é™¤è¯¥å®ä¾‹ã€‚</p>
</li>
</ol>
<h1 id="Ribbonè´Ÿè½½å‡è¡¡"><a href="#Ribbonè´Ÿè½½å‡è¡¡" class="headerlink" title="Ribbonè´Ÿè½½å‡è¡¡"></a>Ribbonè´Ÿè½½å‡è¡¡</h1><h2 id="æ¦‚è¿°-1"><a href="#æ¦‚è¿°-1" class="headerlink" title="æ¦‚è¿°"></a>æ¦‚è¿°</h2><p>æ–‡æ¡£ï¼š<a href="https://github.com/Netflix/ribbon/wiki/Getting-Started">https://github.com/Netflix/ribbon/wiki/Getting-Started</a></p>
<blockquote>
<ol>
<li><p>Spring Cloud Ribbonæ˜¯åŸºäºNetflix Ribbonå®ç°çš„ä¸€å¥—å®¢æˆ·ç«¯è´Ÿè½½å‡è¡¡çš„å·¥å…·ã€‚</p>
</li>
<li><p>Ribbonæ˜¯Netflixå‘å¸ƒçš„å¼€æºé¡¹ç›®ï¼Œä¸»è¦åŠŸèƒ½æ˜¯æä¾›å®¢æˆ·ç«¯çš„è½¯ä»¶è´Ÿè½½å‡è¡¡ç®—æ³•å’ŒæœåŠ¡è°ƒç”¨ã€‚Ribbonå®¢æˆ·ç«¯ç»„ä»¶æä¾›ä¸€ç³»åˆ—å®Œå–„çš„é…ç½®é¡¹å¦‚è¿æ¥è¶…æ—¶ï¼Œé‡è¯•ç­‰ã€‚</p>
</li>
<li><p>ç®€å•çš„è¯´ï¼Œå°±æ˜¯åœ¨é…ç½®æ–‡ä»¶ä¸­åˆ—å‡ºLoad Balancerï¼ˆç®€ç§°LBï¼‰åé¢æ‰€æœ‰çš„æœºå™¨ï¼ŒRibbonä¼šè‡ªåŠ¨çš„å¸®åŠ©ä½ åŸºäºæŸç§è§„åˆ™ï¼ˆå¦‚ç®€å•è½®è¯¢ï¼Œéšæœºè¿æ¥ç­‰ï¼‰å»è¿æ¥è¿™äº›æœºå™¨ã€‚å¾ˆå®¹æ˜“ä½¿ç”¨Ribbonå®ç°è‡ªå®šä¹‰çš„è´Ÿè½½å‡è¡¡ç®—æ³•ã€‚</p>
</li>
</ol>
</blockquote>
<h2 id="è´Ÿè½½å‡è¡¡-1"><a href="#è´Ÿè½½å‡è¡¡-1" class="headerlink" title="è´Ÿè½½å‡è¡¡"></a>è´Ÿè½½å‡è¡¡</h2><blockquote>
<p>LBè´Ÿè½½å‡è¡¡ï¼ˆLoad Balanceï¼‰æ˜¯ä»€ä¹ˆï¼Ÿ<br>ç®€å•çš„è¯´å°±æ˜¯å°†ç”¨æˆ·çš„è¯·æ±‚å¹³æ‘Šçš„åˆ†é…åˆ°å¤šä¸ªæœåŠ¡ä¸Šï¼Œä»è€Œè¾¾åˆ°ç³»ç»Ÿçš„HAï¼ˆé«˜å¯ç”¨ï¼‰ã€‚<br>å¸¸è§çš„è´Ÿè½½å‡è¡¡æœ‰è½¯ä»¶Nginxï¼ŒLVSï¼Œç¡¬ä»¶ F5ç­‰ã€‚</p>
<p>Ribbonæœ¬åœ°è´Ÿè½½å‡è¡¡å®¢æˆ·ç«¯ ä¸NginxæœåŠ¡ç«¯è´Ÿè½½å‡è¡¡åŒºåˆ«ï¼š</p>
<ol>
<li>Nginxæ˜¯æœåŠ¡å™¨è´Ÿè½½å‡è¡¡ï¼Œå®¢æˆ·ç«¯æ‰€æœ‰è¯·æ±‚éƒ½ä¼šäº¤ç»™nginxï¼Œç„¶åç”±nginxå®ç°è½¬å‘è¯·æ±‚ã€‚å³è´Ÿè½½å‡è¡¡æ˜¯ç”±æœåŠ¡ç«¯å®ç°çš„ã€‚</li>
<li>Ribbonæœ¬åœ°è´Ÿè½½å‡è¡¡ï¼Œåœ¨è°ƒç”¨å¾®æœåŠ¡æ¥å£æ—¶å€™ï¼Œä¼šåœ¨æ³¨å†Œä¸­å¿ƒä¸Šè·å–æ³¨å†Œä¿¡æ¯æœåŠ¡åˆ—è¡¨ä¹‹åç¼“å­˜åˆ°JVMæœ¬åœ°ï¼Œä»è€Œåœ¨æœ¬åœ°å®ç°RPCè¿œç¨‹æœåŠ¡è°ƒç”¨æŠ€æœ¯ã€‚</li>
</ol>
</blockquote>
<blockquote>
<p>é›†ä¸­å¼LBï¼š</p>
<p>â€‹		å³åœ¨æœåŠ¡çš„æ¶ˆè´¹æ–¹å’Œæä¾›æ–¹ä¹‹é—´ä½¿ç”¨ç‹¬ç«‹çš„LBè®¾æ–½(å¯ä»¥æ˜¯ç¡¬ä»¶ï¼Œå¦‚F5, ä¹Ÿå¯ä»¥æ˜¯è½¯ä»¶ï¼Œå¦‚nginx), ç”±è¯¥è®¾æ–½è´Ÿè´£æŠŠè®¿é—®è¯·æ±‚é€šè¿‡æŸç§ç­–ç•¥è½¬å‘è‡³æœåŠ¡çš„æä¾›æ–¹ï¼›</p>
<p>è¿›ç¨‹å†…LB</p>
<p>â€‹		å°†LBé€»è¾‘é›†æˆåˆ°æ¶ˆè´¹æ–¹ï¼Œæ¶ˆè´¹æ–¹ä»æœåŠ¡æ³¨å†Œä¸­å¿ƒè·çŸ¥æœ‰å“ªäº›åœ°å€å¯ç”¨ï¼Œç„¶åè‡ªå·±å†ä»è¿™äº›åœ°å€ä¸­é€‰æ‹©å‡ºä¸€ä¸ªåˆé€‚çš„æœåŠ¡å™¨ã€‚<strong>Ribbonå°±å±äºè¿›ç¨‹å†…LBï¼Œå®ƒåªæ˜¯ä¸€ä¸ªç±»åº“ï¼Œé›†æˆäºæ¶ˆè´¹æ–¹è¿›ç¨‹ï¼Œæ¶ˆè´¹æ–¹é€šè¿‡å®ƒæ¥è·å–åˆ°æœåŠ¡æä¾›æ–¹çš„åœ°å€ã€‚</strong></p>
</blockquote>
<h2 id="Ribbonå·¥ä½œæµç¨‹"><a href="#Ribbonå·¥ä½œæµç¨‹" class="headerlink" title="Ribbonå·¥ä½œæµç¨‹"></a>Ribbonå·¥ä½œæµç¨‹</h2><blockquote>
<p>ç¬¬ä¸€æ­¥ï¼šå…ˆé€‰æ‹© EurekaServer ,å®ƒä¼˜å…ˆé€‰æ‹©åœ¨åŒä¸€ä¸ªåŒºåŸŸå†…è´Ÿè½½è¾ƒå°‘çš„server.<br>ç¬¬äºŒæ­¥ï¼šå†æ ¹æ®ç”¨æˆ·æŒ‡å®šçš„ç­–ç•¥ï¼Œåœ¨ä»serverå–åˆ°çš„æœåŠ¡æ³¨å†Œåˆ—è¡¨ä¸­é€‰æ‹©ä¸€ä¸ªåœ°å€ã€‚<br>å…¶ä¸­Ribbonæä¾›äº†å¤šç§ç­–ç•¥ï¼šæ¯”å¦‚è½®è¯¢ã€éšæœºå’Œæ ¹æ®å“åº”æ—¶é—´åŠ æƒã€‚</p>
<img src="/2023/02/28/SpringCloud/Java\Document\SpringCloud\images\image-20221227195336909.png" alt="image-20221227195336909" style="zoom:80%;">
</blockquote>
<h2 id="Ribbonæ ¸å¿ƒç»„ä»¶IRule"><a href="#Ribbonæ ¸å¿ƒç»„ä»¶IRule" class="headerlink" title="Ribbonæ ¸å¿ƒç»„ä»¶IRule"></a>Ribbonæ ¸å¿ƒç»„ä»¶IRule</h2><p>IRuleï¼šæ ¹æ®ç‰¹å®šç®—æ³•ä¸­ä»æœåŠ¡åˆ—è¡¨ä¸­é€‰å–ä¸€ä¸ªè¦è®¿é—®çš„æœåŠ¡</p>
<blockquote>
<ol>
<li><p>com.netflix.loadbalancer.RoundRobinRule	è½®è¯¢</p>
</li>
<li><p>com.netflix.loadbalancer.RandomRule			éšæœº</p>
</li>
<li><p>com.netflix.loadbalancer.RetryRule</p>
<p> å…ˆæŒ‰ç…§RoundRobinRuleçš„ç­–ç•¥è·å–æœåŠ¡ï¼Œå¦‚æœè·å–æœåŠ¡å¤±è´¥åˆ™åœ¨æŒ‡å®šæ—¶é—´å†…ä¼šè¿›è¡Œé‡è¯•ï¼Œè·å–å¯ç”¨çš„æœåŠ¡</p>
</li>
<li><p>WeightedResponseTimeRule</p>
<p> å¯¹RoundRobinRuleçš„æ‰©å±•ï¼Œå“åº”é€Ÿåº¦è¶Šå¿«çš„å®ä¾‹é€‰æ‹©æƒé‡è¶Šå¤§ï¼Œè¶Šå®¹æ˜“è¢«é€‰æ‹©</p>
</li>
<li><p>BestAvailableRule</p>
<p> ä¼šå…ˆè¿‡æ»¤æ‰ç”±äºå¤šæ¬¡è®¿é—®æ•…éšœè€Œå¤„äºæ–­è·¯å™¨è·³é—¸çŠ¶æ€çš„æœåŠ¡ï¼Œç„¶åé€‰æ‹©ä¸€ä¸ªå¹¶å‘é‡æœ€å°çš„æœåŠ¡</p>
</li>
<li><p>AvailabilityFilteringRule         å…ˆè¿‡æ»¤æ‰æ•…éšœå®ä¾‹ï¼Œå†é€‰æ‹©å¹¶å‘è¾ƒå°çš„å®ä¾‹</p>
</li>
<li><p>ZoneAvoidanceRule          é»˜è®¤è§„åˆ™,å¤åˆåˆ¤æ–­serveræ‰€åœ¨åŒºåŸŸçš„æ€§èƒ½å’Œserverçš„å¯ç”¨æ€§é€‰æ‹©æœåŠ¡å™¨</p>
</li>
</ol>
<img src="/2023/02/28/SpringCloud/Java\Document\SpringCloud\images\image-20221227200708508.png" alt="image-20221227200708508" style="zoom:80%;">
</blockquote>
<h2 id="æ›¿æ¢é»˜è®¤è§„åˆ™"><a href="#æ›¿æ¢é»˜è®¤è§„åˆ™" class="headerlink" title="æ›¿æ¢é»˜è®¤è§„åˆ™"></a>æ›¿æ¢é»˜è®¤è§„åˆ™</h2><blockquote>
<p>ä¸»è¦æ­¥éª¤ï¼š</p>
<ol>
<li><p>è‡ªå®šä¹‰IRuleå®ç°ç±»ï¼Œä¸èƒ½æ”¾åœ¨@ComponentScanæ‰€æ‰«æçš„å½“å‰åŒ…ä¸‹ä»¥åŠå­åŒ…ä¸‹ã€‚</p>
 <figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.rule;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.netflix.loadbalancer.IRule;</span><br><span class="line"><span class="keyword">import</span> com.netflix.loadbalancer.RandomRule;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MySelfRule</span> &#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> IRule <span class="title function_">myRule</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">RandomRule</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>å¯åŠ¨ç±»æ·»åŠ æ³¨è§£ï¼š@RibbonClient</p>
 <figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@EnableEurekaClient</span></span><br><span class="line"><span class="meta">@RibbonClient(name = &quot;CLOUD-PAYMENT-SERVICE&quot;, configuration = MyRule.class)</span></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ConsumerApplication80</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        SpringApplication.run(ConsumerApplication80.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ol>
</blockquote>
<p>æ³¨æ„äº‹é¡¹ï¼š</p>
<blockquote>
<p>è‡ªå®šä¹‰é…ç½®ç±»ä¸èƒ½æ”¾åœ¨@ComponentScanæ‰€æ‰«æçš„å½“å‰åŒ…ä¸‹ä»¥åŠå­åŒ…ä¸‹ï¼Œå¦åˆ™è‡ªå®šä¹‰çš„è¿™ä¸ªé…ç½®ç±»å°±ä¼šè¢«æ‰€æœ‰çš„Ribbonå®¢æˆ·ç«¯æ‰€å…±äº«ï¼Œè¾¾ä¸åˆ°ç‰¹æ®ŠåŒ–å®šåˆ¶çš„ç›®çš„ã€‚</p>
<img src="/2023/02/28/SpringCloud/Java\Document\SpringCloud\images\image-20221227200919952.png" alt="image-20221227200919952" style="zoom:80%;">
</blockquote>
<h2 id="Ribbonè´Ÿè½½å‡è¡¡ç®—æ³•"><a href="#Ribbonè´Ÿè½½å‡è¡¡ç®—æ³•" class="headerlink" title="Ribbonè´Ÿè½½å‡è¡¡ç®—æ³•"></a>Ribbonè´Ÿè½½å‡è¡¡ç®—æ³•</h2><blockquote>
<p>è´Ÿè½½å‡è¡¡ç®—æ³•ï¼šrestæ¥å£ç¬¬å‡ æ¬¡è¯·æ±‚æ•° % æœåŠ¡å™¨é›†ç¾¤æ€»æ•°é‡ &#x3D; å®é™…è°ƒç”¨æœåŠ¡å™¨ä½ç½®ä¸‹æ ‡ ï¼Œæ¯æ¬¡æœåŠ¡é‡å¯åŠ¨årestæ¥å£è®¡æ•°ä»1å¼€å§‹ã€‚</p>
<p>List<ServiceInstance> instances &#x3D; discoveryClient.getInstances(â€œCLOUD-PAYMENT-SERVICEâ€);</ServiceInstance></p>
</blockquote>
<h3 id="RoundRobinRuleæºç "><a href="#RoundRobinRuleæºç " class="headerlink" title="RoundRobinRuleæºç "></a>RoundRobinRuleæºç </h3><p>IRuleæ¥å£ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">IRule</span>&#123;</span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">     * choose one alive server from lb.allServers or</span></span><br><span class="line"><span class="comment">     * lb.upServers according to key</span></span><br><span class="line"><span class="comment">     * </span></span><br><span class="line"><span class="comment">     * @return choosen Server object. NULL is returned if none</span></span><br><span class="line"><span class="comment">     *  server is available </span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> Server <span class="title function_">choose</span><span class="params">(Object key)</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setLoadBalancer</span><span class="params">(ILoadBalancer lb)</span>;</span><br><span class="line">    <span class="keyword">public</span> ILoadBalancer <span class="title function_">getLoadBalancer</span><span class="params">()</span>;    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>RoundRobinRuleï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RoundRobinRule</span> <span class="keyword">extends</span> <span class="title class_">AbstractLoadBalancerRule</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> AtomicInteger nextServerCyclicCounter;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">boolean</span> <span class="variable">AVAILABLE_ONLY_SERVERS</span> <span class="operator">=</span> <span class="literal">true</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">boolean</span> <span class="variable">ALL_SERVERS</span> <span class="operator">=</span> <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">Logger</span> <span class="variable">log</span> <span class="operator">=</span> LoggerFactory.getLogger(RoundRobinRule.class);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">RoundRobinRule</span><span class="params">()</span> &#123;</span><br><span class="line">        nextServerCyclicCounter = <span class="keyword">new</span> <span class="title class_">AtomicInteger</span>(<span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">RoundRobinRule</span><span class="params">(ILoadBalancer lb)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>();</span><br><span class="line">        setLoadBalancer(lb);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Server <span class="title function_">choose</span><span class="params">(ILoadBalancer lb, Object key)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (lb == <span class="literal">null</span>) &#123;</span><br><span class="line">            log.warn(<span class="string">&quot;no load balancer&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="type">Server</span> <span class="variable">server</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span> (server == <span class="literal">null</span> &amp;&amp; count++ &lt; <span class="number">10</span>) &#123;</span><br><span class="line">            List&lt;Server&gt; reachableServers = lb.getReachableServers();</span><br><span class="line">            List&lt;Server&gt; allServers = lb.getAllServers();</span><br><span class="line">            <span class="type">int</span> <span class="variable">upCount</span> <span class="operator">=</span> reachableServers.size();</span><br><span class="line">            <span class="type">int</span> <span class="variable">serverCount</span> <span class="operator">=</span> allServers.size();</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> ((upCount == <span class="number">0</span>) || (serverCount == <span class="number">0</span>)) &#123;</span><br><span class="line">                log.warn(<span class="string">&quot;No up servers available from load balancer: &quot;</span> + lb);</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="type">int</span> <span class="variable">nextServerIndex</span> <span class="operator">=</span> incrementAndGetModulo(serverCount);</span><br><span class="line">            server = allServers.get(nextServerIndex);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (server == <span class="literal">null</span>) &#123;</span><br><span class="line">                <span class="comment">/* Transient. */</span></span><br><span class="line">                Thread.<span class="keyword">yield</span>();</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (server.isAlive() &amp;&amp; (server.isReadyToServe())) &#123;</span><br><span class="line">                <span class="keyword">return</span> (server);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// Next.</span></span><br><span class="line">            server = <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (count &gt;= <span class="number">10</span>) &#123;</span><br><span class="line">            log.warn(<span class="string">&quot;No available alive servers after 10 tries from load balancer: &quot;</span>+ lb);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> server;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Inspired by the implementation of &#123;<span class="doctag">@link</span> AtomicInteger#incrementAndGet()&#125;.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> modulo The modulo to bound the value of the counter.</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> The next value.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> <span class="title function_">incrementAndGetModulo</span><span class="params">(<span class="type">int</span> modulo)</span> &#123;</span><br><span class="line">        <span class="comment">// è‡ªæ—‹é”</span></span><br><span class="line">        <span class="keyword">for</span> (;;) &#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">current</span> <span class="operator">=</span> nextServerCyclicCounter.get();</span><br><span class="line">            <span class="type">int</span> <span class="variable">next</span> <span class="operator">=</span> (current + <span class="number">1</span>) % modulo;</span><br><span class="line">            <span class="keyword">if</span> (nextServerCyclicCounter.compareAndSet(current, next))</span><br><span class="line">                <span class="keyword">return</span> next;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Server <span class="title function_">choose</span><span class="params">(Object key)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> choose(getLoadBalancer(), key);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">initWithNiwsConfig</span><span class="params">(IClientConfig clientConfig)</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="æ‰‹åŠ¨å®ç°"><a href="#æ‰‹åŠ¨å®ç°" class="headerlink" title="æ‰‹åŠ¨å®ç°"></a>æ‰‹åŠ¨å®ç°</h3><p>å‡†å¤‡å·¥ä½œï¼š</p>
<ol>
<li><p>ä¿®æ”¹PaymentæœåŠ¡çš„Controllerï¼š</p>
 <figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@GetMapping(value = &quot;/payment/lb&quot;)</span></span><br><span class="line">   <span class="keyword">public</span> String <span class="title function_">getPaymentLB</span><span class="params">()</span>&#123;</span><br><span class="line">       <span class="keyword">return</span> serverPort;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>ApplicationContextBeanå»æ‰æ³¨è§£@LoadBalancedï¼Œä¿è¯ç”Ÿæ•ˆçš„æ˜¯è‡ªå®šä¹‰çš„</p>
 <figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ApplicationContextBean</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="comment">// èµ‹äºˆRestTemplateè´Ÿè½½å‡è¡¡çš„èƒ½åŠ›</span></span><br><span class="line">    <span class="comment">// @LoadBalanced</span></span><br><span class="line">    <span class="keyword">public</span> RestTemplate <span class="title function_">restTemplate</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">RestTemplate</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>è‡ªå®šä¹‰LoadBalanceræ¥å£</p>
 <figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.springcloud.lb;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.cloud.client.ServiceInstance;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">LoadBalancer</span> &#123;</span><br><span class="line">    ServiceInstance <span class="title function_">instances</span><span class="params">(List&lt;ServiceInstance&gt; serviceInstances)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>å®ç°ç±»</p>
 <figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.springcloud.lb;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.cloud.client.ServiceInstance;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.atomic.AtomicInteger;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CustomLoadBalancer</span> <span class="keyword">implements</span> <span class="title class_">LoadBalancer</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">AtomicInteger</span> <span class="variable">atomicInteger</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AtomicInteger</span>(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> <span class="type">int</span> <span class="title function_">getAndIncrement</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">int</span> current;</span><br><span class="line">        <span class="type">int</span> next;</span><br><span class="line">        <span class="keyword">do</span> &#123;</span><br><span class="line">            current = <span class="built_in">this</span>.atomicInteger.get();</span><br><span class="line">            next = current &gt;= <span class="number">2147483647</span> ? <span class="number">0</span> : current + <span class="number">1</span>;</span><br><span class="line">        &#125; <span class="keyword">while</span> (!<span class="built_in">this</span>.atomicInteger.compareAndSet(current, next));</span><br><span class="line">        System.out.println(<span class="string">&quot;==========next: &quot;</span> + next);</span><br><span class="line">        <span class="keyword">return</span> next;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> ServiceInstance <span class="title function_">instances</span><span class="params">(List&lt;ServiceInstance&gt; serviceInstances)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">index</span> <span class="operator">=</span> getAndIncrement() % serviceInstances.size();</span><br><span class="line">        <span class="keyword">return</span> serviceInstances.get(index);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>OrderControllerä¿®æ”¹</p>
 <figure class="highlight java"><table><tr><td class="code"><pre><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> DiscoveryClient discoveryClient;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> LoadBalancer loadBalancer;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/consumer/payment/lb&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getPaymentLB</span><span class="params">()</span> &#123;</span><br><span class="line">        List&lt;ServiceInstance&gt; instanceList =</span><br><span class="line">                discoveryClient.getInstances(<span class="string">&quot;CLOUD-PAYMENT-SERVICE&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span> (instanceList == <span class="literal">null</span> || instanceList.size() &lt;= <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">ServiceInstance</span> <span class="variable">serviceInstance</span> <span class="operator">=</span> loadBalancer.instances(instanceList);</span><br><span class="line">        <span class="type">URI</span> <span class="variable">uri</span> <span class="operator">=</span> serviceInstance.getUri();</span><br><span class="line">        <span class="keyword">return</span> restTemplate.getForObject(uri + <span class="string">&quot;/payment/lb&quot;</span>, String.class);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>æµ‹è¯•ï¼š<a href="http://localhost/consumer/payment/lb">http://localhost/consumer/payment/lb</a></p>
</li>
</ol>
<h1 id="OpenFeignæœåŠ¡æ¥å£è°ƒç”¨"><a href="#OpenFeignæœåŠ¡æ¥å£è°ƒç”¨" class="headerlink" title="OpenFeignæœåŠ¡æ¥å£è°ƒç”¨"></a>OpenFeignæœåŠ¡æ¥å£è°ƒç”¨</h1><p>æ–‡æ¡£ï¼š<a href="https://cloud.spring.io/spring-cloud-static/Hoxton.SR1/reference/htmlsingle/#spring-cloud-openfeign">https://cloud.spring.io/spring-cloud-static/Hoxton.SR1/reference/htmlsingle/#spring-cloud-openfeign</a></p>
<p>GitHubï¼š<a href="https://github.com/spring-cloud/spring-cloud-openfeign">https://github.com/spring-cloud/spring-cloud-openfeign</a></p>
<h2 id="æ¦‚è¿°-2"><a href="#æ¦‚è¿°-2" class="headerlink" title="æ¦‚è¿°"></a>æ¦‚è¿°</h2><blockquote>
<ol>
<li>Feignæ˜¯ä¸€ä¸ªå£°æ˜å¼WebServiceå®¢æˆ·ç«¯ã€‚ä½¿ç”¨Feignèƒ½è®©ç¼–å†™Web Serviceå®¢æˆ·ç«¯æ›´åŠ ç®€å•ã€‚</li>
<li>å®ƒçš„ä½¿ç”¨æ–¹æ³•æ˜¯å®šä¹‰ä¸€ä¸ªæœåŠ¡æ¥å£ç„¶ååœ¨ä¸Šé¢æ·»åŠ æ³¨è§£ã€‚Feignä¹Ÿæ”¯æŒå¯æ‹”æ’å¼çš„ç¼–ç å™¨å’Œè§£ç å™¨</li>
<li>Spring Cloudå¯¹Feignè¿›è¡Œäº†å°è£…ï¼Œä½¿å…¶æ”¯æŒäº†Spring MVCæ ‡å‡†æ³¨è§£å’ŒHttpMessageConverters</li>
<li>Feignå¯ä»¥ä¸Eurekaå’ŒRibbonç»„åˆä½¿ç”¨ä»¥æ”¯æŒè´Ÿè½½å‡è¡¡ã€‚</li>
</ol>
</blockquote>
<h2 id="ä½œç”¨"><a href="#ä½œç”¨" class="headerlink" title="ä½œç”¨"></a>ä½œç”¨</h2><blockquote>
<ol>
<li><p>Feignæ—¨åœ¨ä½¿ç¼–å†™Java Httpå®¢æˆ·ç«¯å˜å¾—æ›´å®¹æ˜“ã€‚åœ¨ä½¿ç”¨Ribbon+RestTemplateæ—¶ï¼Œåˆ©ç”¨RestTemplateå¯¹httpè¯·æ±‚çš„å°è£…å¤„ç†ï¼Œå½¢æˆäº†ä¸€å¥—æ¨¡ç‰ˆåŒ–çš„è°ƒç”¨æ–¹æ³•ã€‚ä½†æ˜¯åœ¨å®é™…å¼€å‘ä¸­ï¼Œç”±äºå¯¹æœåŠ¡ä¾èµ–çš„è°ƒç”¨å¯èƒ½ä¸æ­¢ä¸€å¤„ï¼Œå¾€å¾€ä¸€ä¸ªæ¥å£ä¼šè¢«å¤šå¤„è°ƒç”¨ï¼Œæ‰€ä»¥é€šå¸¸éƒ½ä¼šé’ˆå¯¹æ¯ä¸ªå¾®æœåŠ¡è‡ªè¡Œå°è£…ä¸€äº›å®¢æˆ·ç«¯ç±»æ¥åŒ…è£…è¿™äº›ä¾èµ–æœåŠ¡çš„è°ƒç”¨ã€‚æ‰€ä»¥ï¼ŒFeignåœ¨æ­¤åŸºç¡€ä¸Šåšäº†è¿›ä¸€æ­¥å°è£…ï¼Œç”±å®ƒæ¥å¸®åŠ©æˆ‘ä»¬å®šä¹‰å’Œå®ç°ä¾èµ–æœåŠ¡æ¥å£çš„å®šä¹‰ã€‚</p>
</li>
<li><p>åœ¨Feignçš„å®ç°ä¸‹ï¼Œæˆ‘ä»¬åªéœ€åˆ›å»ºä¸€ä¸ªæ¥å£å¹¶ä½¿ç”¨æ³¨è§£çš„æ–¹å¼æ¥é…ç½®å®ƒï¼Œå³å¯å®Œæˆå¯¹æœåŠ¡æä¾›æ–¹çš„æ¥å£ç»‘å®šï¼Œç®€åŒ–äº†ä½¿ç”¨Spring cloud Ribbonæ—¶ï¼Œè‡ªåŠ¨å°è£…æœåŠ¡è°ƒç”¨å®¢æˆ·ç«¯çš„å¼€å‘é‡ã€‚</p>
</li>
<li><p>Feigné›†æˆäº†Ribbon<br> åˆ©ç”¨Ribbonç»´æŠ¤äº†Paymentçš„æœåŠ¡åˆ—è¡¨ä¿¡æ¯ï¼Œå¹¶ä¸”é€šè¿‡è½®è¯¢å®ç°äº†å®¢æˆ·ç«¯çš„è´Ÿè½½å‡è¡¡ã€‚è€Œä¸Ribbonä¸åŒçš„æ˜¯ï¼Œé€šè¿‡feignåªéœ€è¦å®šä¹‰æœåŠ¡ç»‘å®šæ¥å£ä¸”ä»¥å£°æ˜å¼çš„æ–¹æ³•ï¼Œä¼˜é›…è€Œç®€å•çš„å®ç°äº†æœåŠ¡è°ƒç”¨ã€‚</p>
</li>
</ol>
</blockquote>
<h2 id="Feignå’ŒOpenFeignçš„åŒºåˆ«"><a href="#Feignå’ŒOpenFeignçš„åŒºåˆ«" class="headerlink" title="Feignå’ŒOpenFeignçš„åŒºåˆ«"></a>Feignå’ŒOpenFeignçš„åŒºåˆ«</h2><p>Feignï¼š</p>
<blockquote>
<p>Feignæ˜¯Spring Cloudç»„ä»¶ä¸­çš„ä¸€ä¸ªè½»é‡çº§RESTfulçš„HTTPæœåŠ¡å®¢æˆ·ç«¯<br>Feignå†…ç½®äº†Ribbonï¼Œç”¨æ¥åšå®¢æˆ·ç«¯è´Ÿè½½å‡è¡¡ï¼Œå»è°ƒç”¨æœåŠ¡æ³¨å†Œä¸­å¿ƒçš„æœåŠ¡ã€‚Feignçš„ä½¿ç”¨æ–¹å¼æ˜¯ï¼šä½¿ç”¨Feignçš„æ³¨è§£å®šä¹‰æ¥å£ï¼Œè°ƒç”¨è¿™ä¸ªæ¥å£ï¼Œå°±å¯ä»¥è°ƒç”¨æœåŠ¡æ³¨å†Œä¸­å¿ƒçš„æœåŠ¡</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-feign<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
</blockquote>
<p>OpenFeignï¼š</p>
<blockquote>
<ol>
<li>OpenFeignæ˜¯Spring Cloud åœ¨Feignçš„åŸºç¡€ä¸Šæ”¯æŒäº†SpringMVCçš„æ³¨è§£ï¼Œå¦‚@RequesMappingç­‰ã€‚</li>
<li>OpenFeignçš„@FeignClientå¯ä»¥è§£æSpringMVCçš„@RequestMappingæ³¨è§£ä¸‹çš„æ¥å£ï¼Œå¹¶é€šè¿‡åŠ¨æ€ä»£ç†çš„æ–¹å¼äº§ç”Ÿå®ç°ç±»ï¼Œå®ç°ç±»ä¸­åšè´Ÿè½½å‡è¡¡å¹¶è°ƒç”¨å…¶ä»–æœåŠ¡ã€‚</li>
</ol>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-openfeign<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
</blockquote>
<h2 id="OpenFeignä½¿ç”¨æ­¥éª¤"><a href="#OpenFeignä½¿ç”¨æ­¥éª¤" class="headerlink" title="OpenFeignä½¿ç”¨æ­¥éª¤"></a>OpenFeignä½¿ç”¨æ­¥éª¤</h2><blockquote>
<p>ä¸»è¦æ­¥éª¤ï¼š</p>
<ol>
<li><p>å¼•å…¥ä¾èµ–</p>
 <figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-openfeign<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>ä¸»å¯åŠ¨ç±»æ·»åŠ æ³¨è§£@EnableFeignClients</p>
 <figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@EnableEurekaClient</span></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@EnableFeignClients</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ConsumerApplication80</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        SpringApplication.run(ConsumerApplication80.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>å®šä¹‰ä¸šåŠ¡é€»è¾‘æ¥å£å¹¶æ·»åŠ @FeignClientæ³¨è§£å’Œ@Componentæ³¨è§£</p>
 <figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@FeignClient(value = &quot;CLOUD-PAYMENT-SERVICE&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">PaymentFeignService</span> &#123;</span><br><span class="line">    <span class="meta">@GetMapping(&quot;/payment/get/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> CommonResult&lt;Payment&gt; <span class="title function_">getPaymentById</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> Long id)</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
</li>
<li><p>Controllerè°ƒç”¨</p>
 <figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OrderFeignController</span> &#123;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> PaymentFeignService paymentFeignService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/consumer/payment/get/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> CommonResult&lt;Payment&gt; <span class="title function_">getPaymentById</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> Long id)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> paymentFeignService.getPaymentById(id);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ol>
</blockquote>
<p>ä½¿ç”¨ç¤ºä¾‹ï¼š</p>
<ol>
<li><p>å¤åˆ¶cloud-consumer-order80 å·¥ç¨‹ä¸º cloud-consumer-feign-order80</p>
</li>
<li><p>pom.xml</p>
 <figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-openfeign<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-netflix-eureka-client<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-actuator<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.example<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>cloud-commons<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-devtools<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>runtime<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>ä¸»å¯åŠ¨ç±»æ·»åŠ æ³¨è§£@EnableFeignClients</p>
 <figure class="highlight xml"><table><tr><td class="code"><pre><span class="line">@EnableEurekaClient</span><br><span class="line">@SpringBootApplication</span><br><span class="line">@EnableFeignClients</span><br><span class="line">public class ConsumerApplication80 &#123;</span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line">        SpringApplication.run(ConsumerApplication80.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>å®šä¹‰ä¸šåŠ¡é€»è¾‘æ¥å£å¹¶æ·»åŠ @FeignClientæ³¨è§£å’Œ@Componentæ³¨è§£</p>
 <figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@FeignClient(value = &quot;CLOUD-PAYMENT-SERVICE&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">PaymentFeignService</span> &#123;</span><br><span class="line">    <span class="meta">@GetMapping(&quot;/payment/get/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> CommonResult&lt;Payment&gt; <span class="title function_">getPaymentById</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> Long id)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>Controllerè°ƒç”¨</p>
 <figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OrderFeignController</span> &#123;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> PaymentFeignService paymentFeignService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/consumer/payment/get/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> CommonResult&lt;Payment&gt; <span class="title function_">getPaymentById</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> Long id)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> paymentFeignService.getPaymentById(id);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ol>
<p>æ³¨æ„ï¼šFeignè‡ªå¸¦è´Ÿè½½å‡è¡¡é…ç½®é¡¹</p>
<h2 id="OpenFeignè¶…æ—¶æ§åˆ¶"><a href="#OpenFeignè¶…æ—¶æ§åˆ¶" class="headerlink" title="OpenFeignè¶…æ—¶æ§åˆ¶"></a>OpenFeignè¶…æ—¶æ§åˆ¶</h2><blockquote>
<p>é»˜è®¤Feignå®¢æˆ·ç«¯åªç­‰å¾…ä¸€ç§’é’Ÿï¼Œä½†æ˜¯æœåŠ¡ç«¯å¤„ç†éœ€è¦è¶…è¿‡1ç§’é’Ÿï¼Œå¯¼è‡´Feignå®¢æˆ·ç«¯ä¸æƒ³ç­‰å¾…äº†ï¼Œç›´æ¥è¿”å›æŠ¥é”™ã€‚ä¸ºäº†é¿å…è¿™æ ·çš„æƒ…å†µï¼Œéœ€è¦è®¾ç½®Feignå®¢æˆ·ç«¯çš„è¶…æ—¶æ§åˆ¶ã€‚</p>
<p>åœ¨ymlæ–‡ä»¶ä¸­å¼€å¯é…ç½®ï¼š</p>
<figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="comment">#è®¾ç½®feignå®¢æˆ·ç«¯è¶…æ—¶æ—¶é—´(OpenFeigné»˜è®¤æ”¯æŒribbon)</span></span><br><span class="line"><span class="attr">feign:</span></span><br><span class="line">  <span class="attr">client:</span></span><br><span class="line">    <span class="attr">config:</span></span><br><span class="line">      <span class="attr">default:</span></span><br><span class="line">        <span class="comment">#æŒ‡çš„æ˜¯å»ºç«‹è¿æ¥åä»æœåŠ¡å™¨è¯»å–åˆ°å¯ç”¨èµ„æºæ‰€ç”¨çš„æ—¶é—´</span></span><br><span class="line">        <span class="attr">connect-timeout:</span> <span class="number">5000</span></span><br><span class="line">        <span class="comment">#æŒ‡çš„æ˜¯å»ºç«‹è¿æ¥æ‰€ç”¨çš„æ—¶é—´ï¼Œé€‚ç”¨äºç½‘ç»œçŠ¶å†µæ­£å¸¸çš„æƒ…å†µä¸‹,ä¸¤ç«¯è¿æ¥æ‰€ç”¨çš„æ—¶é—´</span></span><br><span class="line">        <span class="attr">read-timeout:</span> <span class="number">5000</span></span><br></pre></td></tr></table></figure>
</blockquote>
<p>OpenFeignè¶…æ—¶æ§åˆ¶ç¤ºä¾‹ï¼š</p>
<ol>
<li><p>ä¿®æ”¹PaymentControllerï¼Œæ–°å¢è¶…æ—¶æ¥å£</p>
 <figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@GetMapping(value = &quot;/payment/feign/timeout&quot;)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">paymentFeignTimeOut</span><span class="params">()</span> &#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;PaymentFeignTimeOut From Port: &quot;</span> + serverPort);</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        TimeUnit.SECONDS.sleep(<span class="number">3</span>);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> serverPort;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>æœåŠ¡è°ƒç”¨æ–¹å¢åŠ OpenFeignæ¥å£</p>
 <figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@FeignClient(value = &quot;CLOUD-PAYMENT-SERVICE&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">PaymentFeignService</span> &#123;</span><br><span class="line">    <span class="meta">@GetMapping(&quot;/payment/get/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> CommonResult&lt;Payment&gt; <span class="title function_">getPaymentById</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> Long id)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(value = &quot;/payment/feign/timeout&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">paymentFeignTimeOut</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>OrderFeignControllerå¢åŠ è¶…æ—¶æµ‹è¯•æ¥å£</p>
 <figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/consumer/payment/feign/timeout&quot;)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">paymentFeignTimeOut</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> paymentFeignService.paymentFeignTimeOut();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>æµ‹è¯•ï¼š<a href="http://localhost/consumer/payment/feign/timeout">http://localhost/consumer/payment/feign/timeout</a></p>
 <figure class="highlight tex"><table><tr><td class="code"><pre><span class="line"><span class="params">#</span> æŠ¥é”™</span><br><span class="line">This application has no explicit mapping for /error, so you are seeing this as a fallback.</span><br><span class="line"></span><br><span class="line">Tue Dec 27 22:08:40 CST 2022</span><br><span class="line">There was an unexpected error (type=Internal Server Error, status=500).</span><br><span class="line">status 404 reading PaymentFeignService<span class="params">#</span>paymentFeignTimeOut()</span><br><span class="line">feign.FeignException<span class="built_in">$</span>NotFound: status 404 reading PaymentFeignService<span class="params">#</span>paymentFeignTimeOut()</span><br><span class="line">	at feign.FeignException.clientErrorStatus(FeignException.java:165)</span><br><span class="line">	at feign.FeignException.errorStatus(FeignException.java:141)</span><br><span class="line">	at feign.FeignException.errorStatus(FeignException.java:133)</span><br><span class="line">	at feign.codec.ErrorDecoder<span class="built_in">$</span>Default.decode(ErrorDecoder.java:92)</span><br></pre></td></tr></table></figure>
</li>
<li><p>è§£å†³æ–¹æ¡ˆï¼šä¿®æ”¹é…ç½®</p>
 <figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="comment">#è®¾ç½®feignå®¢æˆ·ç«¯è¶…æ—¶æ—¶é—´(OpenFeigné»˜è®¤æ”¯æŒribbon)</span></span><br><span class="line"><span class="attr">feign:</span></span><br><span class="line">  <span class="attr">client:</span></span><br><span class="line">    <span class="attr">config:</span></span><br><span class="line">      <span class="attr">default:</span></span><br><span class="line">        <span class="comment">#æŒ‡çš„æ˜¯å»ºç«‹è¿æ¥åä»æœåŠ¡å™¨è¯»å–åˆ°å¯ç”¨èµ„æºæ‰€ç”¨çš„æ—¶é—´</span></span><br><span class="line">        <span class="attr">connect-timeout:</span> <span class="number">5000</span></span><br><span class="line">        <span class="comment">#æŒ‡çš„æ˜¯å»ºç«‹è¿æ¥æ‰€ç”¨çš„æ—¶é—´ï¼Œé€‚ç”¨äºç½‘ç»œçŠ¶å†µæ­£å¸¸çš„æƒ…å†µä¸‹,ä¸¤ç«¯è¿æ¥æ‰€ç”¨çš„æ—¶é—´</span></span><br><span class="line">        <span class="attr">read-timeout:</span> <span class="number">5000</span></span><br></pre></td></tr></table></figure></li>
</ol>
<h2 id="OpenFeignæ—¥å¿—æ‰“å°åŠŸèƒ½"><a href="#OpenFeignæ—¥å¿—æ‰“å°åŠŸèƒ½" class="headerlink" title="OpenFeignæ—¥å¿—æ‰“å°åŠŸèƒ½"></a>OpenFeignæ—¥å¿—æ‰“å°åŠŸèƒ½</h2><blockquote>
<p>Feign æä¾›äº†æ—¥å¿—æ‰“å°åŠŸèƒ½ï¼Œå¯ä»¥é€šè¿‡é…ç½®æ¥è°ƒæ•´æ—¥å¿—çº§åˆ«ï¼Œä»è€Œäº†è§£ Feign ä¸­ Http è¯·æ±‚çš„ç»†èŠ‚ã€‚<br>å³å¯¹Feignæ¥å£çš„è°ƒç”¨æƒ…å†µè¿›è¡Œç›‘æ§å’Œè¾“å‡º</p>
</blockquote>
<h3 id="æ—¥å¿—çº§åˆ«"><a href="#æ—¥å¿—çº§åˆ«" class="headerlink" title="æ—¥å¿—çº§åˆ«"></a>æ—¥å¿—çº§åˆ«</h3><blockquote>
<p>NONEï¼šé»˜è®¤çš„ï¼Œä¸æ˜¾ç¤ºä»»ä½•æ—¥å¿—ï¼›</p>
<p>BASICï¼šä»…è®°å½•è¯·æ±‚æ–¹æ³•ã€URLã€å“åº”çŠ¶æ€ç åŠæ‰§è¡Œæ—¶é—´ï¼›</p>
<p>HEADERSï¼šé™¤äº† BASIC ä¸­å®šä¹‰çš„ä¿¡æ¯ä¹‹å¤–ï¼Œè¿˜æœ‰è¯·æ±‚å’Œå“åº”çš„å¤´ä¿¡æ¯ï¼›</p>
<p>FULLï¼šé™¤äº† HEADERS ä¸­å®šä¹‰çš„ä¿¡æ¯ä¹‹å¤–ï¼Œè¿˜æœ‰è¯·æ±‚å’Œå“åº”çš„æ­£æ–‡åŠå…ƒæ•°æ®ã€‚</p>
</blockquote>
<h3 id="é…ç½®Feignæ—¥å¿—çº§åˆ«"><a href="#é…ç½®Feignæ—¥å¿—çº§åˆ«" class="headerlink" title="é…ç½®Feignæ—¥å¿—çº§åˆ«"></a>é…ç½®Feignæ—¥å¿—çº§åˆ«</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.springcloud.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> feign.Logger;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">FeignConfig</span> &#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> Logger.Level <span class="title function_">feignLevel</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> Logger.Level.FULL;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ³¨æ„ï¼šåŒæ—¶å¼€å¯SpringBootå¯¹æ¥å£çš„æ—¥å¿—çº§åˆ«</p>
<figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="attr">logging:</span></span><br><span class="line">  <span class="attr">level:</span></span><br><span class="line">    <span class="comment"># feignæ—¥å¿—</span></span><br><span class="line">    <span class="attr">com.example.springcloud.openfeign.PaymentFeignService:</span> <span class="string">debug</span></span><br></pre></td></tr></table></figure>

<p>æµ‹è¯•ï¼šæ‰“å°æ—¥å¿—</p>
<figure class="highlight tex"><table><tr><td class="code"><pre><span class="line">...[PaymentFeignService<span class="params">#</span>paymentFeignTimeOut] ---&gt; GET http://CLOUD-PAYMENT-SERVICE/payment/feign/timeout HTTP/1.1</span><br><span class="line">...[PaymentFeignService<span class="params">#</span>paymentFeignTimeOut] ---&gt; END HTTP (0-byte body)</span><br><span class="line">...[PaymentFeignService<span class="params">#</span>paymentFeignTimeOut] &lt;--- HTTP/1.1 200 (3017ms)</span><br><span class="line">...[PaymentFeignService<span class="params">#</span>paymentFeignTimeOut] connection: keep-alive</span><br><span class="line">...[PaymentFeignService<span class="params">#</span>paymentFeignTimeOut] content-length: 4</span><br><span class="line">...[PaymentFeignService<span class="params">#</span>paymentFeignTimeOut] content-type: text/plain;charset=UTF-8</span><br><span class="line">...[PaymentFeignService<span class="params">#</span>paymentFeignTimeOut] date: Tue, 27 Dec 2022 14:27:27 GMT</span><br><span class="line">...[PaymentFeignService<span class="params">#</span>paymentFeignTimeOut] keep-alive: timeout=60</span><br><span class="line">...[PaymentFeignService<span class="params">#</span>paymentFeignTimeOut] </span><br><span class="line">...[PaymentFeignService<span class="params">#</span>paymentFeignTimeOut] 8001</span><br><span class="line">...[PaymentFeignService<span class="params">#</span>paymentFeignTimeOut] &lt;--- END HTTP (4-byte body)</span><br></pre></td></tr></table></figure>

<h1 id="Hystrixæ–­è·¯å™¨"><a href="#Hystrixæ–­è·¯å™¨" class="headerlink" title="Hystrixæ–­è·¯å™¨"></a>Hystrixæ–­è·¯å™¨</h1><p>æ–‡æ¡£ï¼š<a href="https://github.com/Netflix/Hystrix/wiki/How-To-Use">https://github.com/Netflix/Hystrix/wiki/How-To-Use</a></p>
<h2 id="æ¦‚è¿°-3"><a href="#æ¦‚è¿°-3" class="headerlink" title="æ¦‚è¿°"></a>æ¦‚è¿°</h2><h3 id="åˆ†å¸ƒå¼ç³»ç»Ÿé¢ä¸´çš„é—®é¢˜"><a href="#åˆ†å¸ƒå¼ç³»ç»Ÿé¢ä¸´çš„é—®é¢˜" class="headerlink" title="åˆ†å¸ƒå¼ç³»ç»Ÿé¢ä¸´çš„é—®é¢˜"></a>åˆ†å¸ƒå¼ç³»ç»Ÿé¢ä¸´çš„é—®é¢˜</h3><blockquote>
<p>å¤æ‚åˆ†å¸ƒå¼ä½“ç³»ç»“æ„ä¸­çš„åº”ç”¨ç¨‹åºæœ‰æ•°åä¸ªä¾èµ–å…³ç³»ï¼Œæ¯ä¸ªä¾èµ–å…³ç³»åœ¨æŸäº›æ—¶å€™å°†ä¸å¯é¿å…åœ°å¤±è´¥ã€‚</p>
<p><img src="/2023/02/28/SpringCloud/Java\Document\SpringCloud\images\image-20221227223212482.png" alt="image-20221227223212482"></p>
</blockquote>
<h3 id="æœåŠ¡é›ªå´©"><a href="#æœåŠ¡é›ªå´©" class="headerlink" title="æœåŠ¡é›ªå´©"></a>æœåŠ¡é›ªå´©</h3><p>â€‹		å¤šä¸ªå¾®æœåŠ¡ä¹‹é—´è°ƒç”¨çš„æ—¶å€™ï¼Œå‡è®¾å¾®æœåŠ¡Aè°ƒç”¨å¾®æœåŠ¡Bå’Œå¾®æœåŠ¡Cï¼Œå¾®æœåŠ¡Bå’Œå¾®æœåŠ¡Cåˆè°ƒç”¨å…¶å®ƒçš„å¾®æœåŠ¡ï¼Œè¿™å°±æ˜¯æ‰€è°“çš„â€œæ‰‡å‡ºâ€ã€‚å¦‚æœæ‰‡å‡ºçš„é“¾è·¯ä¸ŠæŸä¸ªå¾®æœåŠ¡çš„è°ƒç”¨å“åº”æ—¶é—´è¿‡é•¿æˆ–è€…ä¸å¯ç”¨ï¼Œå¯¹å¾®æœåŠ¡Açš„è°ƒç”¨å°±ä¼šå ç”¨è¶Šæ¥è¶Šå¤šçš„ç³»ç»Ÿèµ„æºï¼Œè¿›è€Œå¼•èµ·ç³»ç»Ÿå´©æºƒï¼Œæ‰€è°“çš„â€œé›ªå´©æ•ˆåº”â€ã€‚</p>
<p>â€‹		å¯¹äºé«˜æµé‡çš„åº”ç”¨æ¥è¯´ï¼Œå•ä¸€çš„åç«¯ä¾èµ–å¯èƒ½ä¼šå¯¼è‡´æ‰€æœ‰æœåŠ¡å™¨ä¸Šçš„æ‰€æœ‰èµ„æºéƒ½åœ¨å‡ ç§’é’Ÿå†…é¥±å’Œã€‚æ¯”å¤±è´¥æ›´ç³Ÿç³•çš„æ˜¯ï¼Œè¿™äº›åº”ç”¨ç¨‹åºè¿˜å¯èƒ½å¯¼è‡´æœåŠ¡ä¹‹é—´çš„å»¶è¿Ÿå¢åŠ ï¼Œå¤‡ä»½é˜Ÿåˆ—ï¼Œçº¿ç¨‹å’Œå…¶ä»–ç³»ç»Ÿèµ„æºç´§å¼ ï¼Œå¯¼è‡´æ•´ä¸ªç³»ç»Ÿå‘ç”Ÿæ›´å¤šçš„çº§è”æ•…éšœã€‚è¿™äº›éƒ½è¡¨ç¤ºéœ€è¦å¯¹æ•…éšœå’Œå»¶è¿Ÿè¿›è¡Œéš”ç¦»å’Œç®¡ç†ï¼Œä»¥ä¾¿å•ä¸ªä¾èµ–å…³ç³»çš„å¤±è´¥ï¼Œä¸èƒ½å–æ¶ˆæ•´ä¸ªåº”ç”¨ç¨‹åºæˆ–ç³»ç»Ÿã€‚</p>
<h3 id="å®šä¹‰"><a href="#å®šä¹‰" class="headerlink" title="å®šä¹‰"></a>å®šä¹‰</h3><p>â€‹		Hystrix æ˜¯ä¸€ä¸ªç”¨äºå¤„ç†åˆ†å¸ƒå¼ç³»ç»Ÿçš„å»¶è¿Ÿå’Œå®¹é”™çš„å¼€æºåº“ï¼Œåœ¨åˆ†å¸ƒå¼ç³»ç»Ÿé‡Œï¼Œè®¸å¤šä¾èµ–ä¸å¯é¿å…çš„ä¼šè°ƒç”¨å¤±è´¥ï¼Œæ¯”å¦‚è¶…æ—¶ã€å¼‚å¸¸ç­‰ï¼ŒHystrix èƒ½å¤Ÿä¿è¯åœ¨ä¸€ä¸ªä¾èµ–å‡ºé—®é¢˜çš„æƒ…å†µä¸‹ï¼Œä¸ä¼šå¯¼è‡´æ•´ä½“æœåŠ¡å¤±è´¥ï¼Œé¿å…çº§è”æ•…éšœï¼Œä»¥æé«˜åˆ†å¸ƒå¼ç³»ç»Ÿçš„å¼¹æ€§ã€‚</p>
<p>â€‹		â€œæ–­è·¯å™¨â€ èº«æ˜¯ä¸€ç§å¼€å…³è£…ç½®ï¼Œå½“æŸä¸ªæœåŠ¡å•å…ƒå‘ç”Ÿæ•…éšœä¹‹åï¼Œé€šè¿‡æ–­è·¯å™¨çš„æ•…éšœç›‘æ§ï¼ˆç±»ä¼¼ç†”æ–­ä¿é™©ä¸ï¼‰ï¼Œå‘è°ƒç”¨æ–¹è¿”å›ä¸€ä¸ªç¬¦åˆé¢„æœŸçš„ã€å¯å¤„ç†çš„å¤‡é€‰å“åº”ï¼ˆFallBackï¼‰ï¼Œè€Œä¸æ˜¯é•¿æ—¶é—´çš„ç­‰å¾…æˆ–è€…æŠ›å‡ºè°ƒç”¨æ–¹æ— æ³•å¤„ç†çš„å¼‚å¸¸ï¼Œè¿™æ ·å°±ä¿è¯äº†æœåŠ¡è°ƒç”¨æ–¹çš„çº¿ç¨‹ä¸ä¼šè¢«é•¿æ—¶é—´ã€ä¸å¿…è¦åœ°å ç”¨ï¼Œä»è€Œé¿å…äº†æ•…éšœåœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­çš„è”“å»¶ï¼Œä¹ƒè‡³é›ªå´©ã€‚</p>
<p>Hystrixå®˜å®£ï¼Œåœæ›´è¿›ç»´ï¼š<a href="https://github.com/Netflix/Hystrix">https://github.com/Netflix/Hystrix</a></p>
<h2 id="Hystrixé‡è¦æ¦‚å¿µ"><a href="#Hystrixé‡è¦æ¦‚å¿µ" class="headerlink" title="Hystrixé‡è¦æ¦‚å¿µ"></a>Hystrixé‡è¦æ¦‚å¿µ</h2><h3 id="æœåŠ¡ç†”æ–­"><a href="#æœåŠ¡ç†”æ–­" class="headerlink" title="æœåŠ¡ç†”æ–­"></a>æœåŠ¡ç†”æ–­</h3><blockquote>
<ol>
<li><strong>ç†”æ–­æœºåˆ¶æ˜¯åº”å¯¹é›ªå´©æ•ˆåº”çš„ä¸€ç§å¾®æœåŠ¡é“¾è·¯ä¿æŠ¤æœºåˆ¶ã€‚</strong></li>
<li>å½“æ‰‡å‡ºé“¾è·¯çš„æŸä¸ªå¾®æœåŠ¡ä¸å¯ç”¨æˆ–è€…å“åº”æ—¶é—´å¤ªé•¿æ—¶ï¼Œä¼šè¿›è¡ŒæœåŠ¡çš„é™çº§ï¼Œè¿›è€Œç†”æ–­è¯¥èŠ‚ç‚¹å¾®æœåŠ¡çš„è°ƒç”¨ï¼Œå¿«é€Ÿè¿”å› â€œé”™è¯¯â€ çš„å“åº”ä¿¡æ¯ã€‚å½“æ£€æµ‹åˆ°è¯¥èŠ‚ç‚¹å¾®æœåŠ¡è°ƒç”¨å“åº”æ­£å¸¸åæ¢å¤è°ƒç”¨é“¾è·¯ã€‚</li>
<li>åœ¨ SpringCloud æ¡†æ¶é‡Œç†”æ–­æœºåˆ¶é€šè¿‡ Hystrixå®ç°ã€‚Hystrix ä¼šç›‘æ§å¾®æœåŠ¡é—´è°ƒç”¨çš„çŠ¶å†µï¼Œå½“å¤±è´¥çš„è°ƒç”¨åˆ°ä¸€å®šé˜ˆå€¼ï¼Œ<strong>ç¼ºçœæ˜¯5ç§’å†…20æ¬¡è°ƒç”¨å¤±è´¥</strong> å°±ä¼šå¯åŠ¨ç†”æ–­æœºåˆ¶ã€‚</li>
<li>ç†”æ–­æœºåˆ¶çš„æ³¨è§£æ˜¯ @HystrixCommandã€‚</li>
</ol>
</blockquote>
<h3 id="æœåŠ¡é™çº§"><a href="#æœåŠ¡é™çº§" class="headerlink" title="æœåŠ¡é™çº§"></a>æœåŠ¡é™çº§</h3><blockquote>
<p>æ•´ä½“èµ„æºå¿«ä¸å¤Ÿäº†ï¼Œå¿ç—›å°†æŸäº›æœåŠ¡å…ˆå…³æ‰ï¼Œå¾…æ¸¡è¿‡éš¾å…³ï¼Œå†å¼€å¯å›æ¥ã€‚</p>
<p>æœåŠ¡å™¨å¿™ï¼Œè¯·ç¨åå†è¯•ï¼Œä¸è®©å®¢æˆ·ç«¯ç­‰å¾…å¹¶ç«‹åˆ»è¿”å›ä¸€ä¸ªå‹å¥½æç¤ºï¼Œfallbackå¤„ç†ã€‚</p>
<p>å¦‚ç³»ç»Ÿå¤„äºé«˜å³°æœŸï¼Œèµ„æºç´§å¼ ï¼Œå¯ä»¥è®©éæ ¸å¿ƒä¸šåŠ¡é™çº§è¿è¡Œï¼Œé™çº§ã€æŸäº›æœåŠ¡ä¸å¤„ç†ï¼Œæˆ–ç®€å•å¤„ç†ï¼Œå¦‚æŠ›å¼‚å¸¸ï¼Œè¿”å›NULLï¼Œè°ƒç”¨FallBackå¤„ç†ç­‰ã€‘</p>
<p>æœåŠ¡é™çº§å¤„ç†æ˜¯åœ¨å®¢æˆ·ç«¯å®ç°å®Œæˆçš„ï¼Œä¸æœåŠ¡ç«¯æ²¡æœ‰å…³ç³»ã€‚</p>
<p>é‚£äº›æƒ…å†µè§¦å‘æœåŠ¡é™çº§ï¼š</p>
<ol>
<li>ç¨‹åºå¼‚å¸¸</li>
<li>è¶…æ—¶</li>
<li>æœåŠ¡ç†”æ–­è§¦å‘é™çº§</li>
<li>çº¿ç¨‹æ± &#x2F;ä¿¡å·é‡æ‰“æ»¡ä¹Ÿä¼šå¯¼è‡´æœåŠ¡é™çº§</li>
</ol>
</blockquote>
<h3 id="æœåŠ¡é™æµ"><a href="#æœåŠ¡é™æµ" class="headerlink" title="æœåŠ¡é™æµ"></a>æœåŠ¡é™æµ</h3><blockquote>
<p>å¯¹äºç§’æ€é«˜å¹¶å‘ç­‰æ“ä½œï¼Œä¸¥ç¦ä¸€çªèœ‚çš„è¿‡æ¥æ‹¥æŒ¤ï¼Œå¤§å®¶æ’é˜Ÿï¼Œä¸€ç§’é’ŸNä¸ªï¼Œæœ‰åºè¿›è¡Œ</p>
</blockquote>
<h2 id="Hystrixç¤ºä¾‹"><a href="#Hystrixç¤ºä¾‹" class="headerlink" title="Hystrixç¤ºä¾‹"></a>Hystrixç¤ºä¾‹</h2><ol>
<li><p>æ–°å»ºå·¥ç¨‹ cloud-provider-hystrix-payment8001</p>
</li>
<li><p>pom.xml</p>
 <figure class="highlight xml"><table><tr><td class="code"><pre><span class="line">cloud-provider-payment8002</span><br></pre></td></tr></table></figure></li>
</ol>
<h1 id="Zuul"><a href="#Zuul" class="headerlink" title="Zuul"></a>Zuul</h1><h1 id="Gateway"><a href="#Gateway" class="headerlink" title="Gateway"></a>Gateway</h1><p>æ–‡æ¡£ï¼š<a href="https://cloud.spring.io/spring-cloud-static/spring-cloud-gateway/2.2.1.RELEASE/reference/html/">https://cloud.spring.io/spring-cloud-static/spring-cloud-gateway/2.2.1.RELEASE/reference/html/</a></p>
<h2 id="æ¦‚è¿°-4"><a href="#æ¦‚è¿°-4" class="headerlink" title="æ¦‚è¿°"></a>æ¦‚è¿°</h2><blockquote>
<p>SpringCloudå…¨å®¶æ¡¶ä¸­æœ‰ä¸ªå¾ˆé‡è¦çš„ç»„ä»¶å°±æ˜¯ç½‘å…³ï¼Œåœ¨1.xç‰ˆæœ¬ä¸­éƒ½æ˜¯é‡‡ç”¨çš„Zuulç½‘å…³ï¼›ä½†åœ¨2.xç‰ˆæœ¬ä¸­ï¼Œä½¿ç”¨Gatewayæ›¿ä»£åŸzuul1.xç‰ˆ</p>
<p>Gatewayæ˜¯åœ¨Springç”Ÿæ€ç³»ç»Ÿä¹‹ä¸Šæ„å»ºçš„APIç½‘å…³æœåŠ¡ï¼ŒåŸºäºSpring 5ï¼ŒSpring Boot 2å’Œ Project Reactorç­‰æŠ€æœ¯ã€‚<br>Gatewayæ—¨åœ¨æä¾›ä¸€ç§ç®€å•è€Œæœ‰æ•ˆçš„æ–¹å¼æ¥å¯¹APIè¿›è¡Œè·¯ç”±ï¼Œä»¥åŠæä¾›ä¸€äº›å¼ºå¤§çš„è¿‡æ»¤å™¨åŠŸèƒ½ï¼Œ ä¾‹å¦‚ï¼šç†”æ–­ã€é™æµã€é‡è¯•ç­‰ã€‚</p>
<p>SpringCloud Gateway æ˜¯ Spring Cloud çš„ä¸€ä¸ªå…¨æ–°é¡¹ç›®ï¼ŒåŸºäº Spring 5.0+Spring Boot 2.0 å’Œ Project Reactor ç­‰æŠ€æœ¯å¼€å‘çš„ç½‘å…³ï¼Œå®ƒæ—¨åœ¨ä¸ºå¾®æœåŠ¡æ¶æ„æä¾›ä¸€ç§ç®€å•æœ‰æ•ˆçš„ç»Ÿä¸€çš„ API è·¯ç”±ç®¡ç†æ–¹å¼ã€‚</p>
<p>SpringCloud Gateway ä½œä¸º Spring Cloud ç”Ÿæ€ç³»ç»Ÿä¸­çš„ç½‘å…³ï¼Œç›®æ ‡æ˜¯æ›¿ä»£ Zuulï¼Œåœ¨Spring Cloud 2.0ä»¥ä¸Šç‰ˆæœ¬ä¸­ï¼Œæ²¡æœ‰å¯¹æ–°ç‰ˆæœ¬çš„Zuul 2.0ä»¥ä¸Šæœ€æ–°é«˜æ€§èƒ½ç‰ˆæœ¬è¿›è¡Œé›†æˆï¼Œä»ç„¶è¿˜æ˜¯ä½¿ç”¨çš„Zuul 1.xéReactoræ¨¡å¼çš„è€ç‰ˆæœ¬ã€‚è€Œä¸ºäº†æå‡ç½‘å…³çš„æ€§èƒ½ï¼ŒSpringCloud Gatewayæ˜¯åŸºäºWebFluxæ¡†æ¶å®ç°çš„ï¼Œè€ŒWebFluxæ¡†æ¶åº•å±‚åˆ™ä½¿ç”¨äº†é«˜æ€§èƒ½çš„Reactoræ¨¡å¼é€šä¿¡æ¡†æ¶Nettyã€‚</p>
<p>ä½¿ç”¨çš„Webfluxä¸­çš„reactor-nettyå“åº”å¼ç¼–ç¨‹ç»„ä»¶ï¼Œåº•å±‚ä½¿ç”¨äº†Nettyé€šè®¯æ¡†æ¶ã€‚</p>
<p>Spring Cloud Gatewayçš„ç›®æ ‡æä¾›ç»Ÿä¸€çš„è·¯ç”±æ–¹å¼ä¸”åŸºäº Filter é“¾çš„æ–¹å¼æä¾›äº†ç½‘å…³åŸºæœ¬çš„åŠŸèƒ½ï¼Œä¾‹å¦‚ï¼šå®‰å…¨ï¼Œç›‘æ§&#x2F;æŒ‡æ ‡ï¼Œå’Œé™æµã€‚</p>
</blockquote>
<h2 id="ä½œç”¨-1"><a href="#ä½œç”¨-1" class="headerlink" title="ä½œç”¨"></a>ä½œç”¨</h2><blockquote>
<p>åå‘ä»£ç†</p>
<p>é‰´æƒ</p>
<p>æµé‡æ§åˆ¶</p>
<p>ç†”æ–­</p>
<p>æ—¥å¿—ç›‘æ§</p>
</blockquote>
<h2 id="Gatewayç›¸æ¯”äºZuulçš„ä¼˜ç‚¹"><a href="#Gatewayç›¸æ¯”äºZuulçš„ä¼˜ç‚¹" class="headerlink" title="Gatewayç›¸æ¯”äºZuulçš„ä¼˜ç‚¹"></a>Gatewayç›¸æ¯”äºZuulçš„ä¼˜ç‚¹</h2><blockquote>
<p>ä¸€æ–¹é¢å› ä¸ºZuul1.0å·²ç»è¿›å…¥äº†ç»´æŠ¤é˜¶æ®µï¼Œè€Œä¸”<strong>Gatewayæ˜¯SpringCloudå›¢é˜Ÿç ”å‘çš„</strong>ï¼Œè€Œä¸”å¾ˆå¤šåŠŸèƒ½Zuuléƒ½æ²¡æœ‰ç”¨èµ·æ¥ä¹Ÿéå¸¸çš„ç®€å•ä¾¿æ·ã€‚</p>
<p>Gatewayæ˜¯åŸºäºå¼‚æ­¥éé˜»å¡æ¨¡å‹ä¸Šè¿›è¡Œå¼€å‘çš„ï¼Œæ€§èƒ½æ–¹é¢ä¸éœ€è¦æ‹…å¿ƒã€‚è™½ç„¶Netflixæ—©å°±å‘å¸ƒäº†æœ€æ–°çš„ Zuul 2.xï¼Œä½† Spring Cloud è²Œä¼¼æ²¡æœ‰æ•´åˆè®¡åˆ’ã€‚</p>
</blockquote>
<blockquote>
<p><strong>Spring Cloud Gateway å…·æœ‰å¦‚ä¸‹ç‰¹æ€§ï¼š</strong></p>
<ol>
<li>åŸºäºSpring Framework 5, Project Reactor å’Œ Spring Boot 2.0 è¿›è¡Œæ„å»ºï¼›</li>
<li>åŠ¨æ€è·¯ç”±ï¼šèƒ½å¤ŸåŒ¹é…ä»»ä½•è¯·æ±‚å±æ€§ï¼›</li>
<li>å¯ä»¥å¯¹è·¯ç”±æŒ‡å®š Predicateï¼ˆæ–­è¨€ï¼‰å’Œ Filterï¼ˆè¿‡æ»¤å™¨ï¼‰ï¼›</li>
<li>é›†æˆHystrixçš„æ–­è·¯å™¨åŠŸèƒ½ï¼›</li>
<li>é›†æˆ Spring Cloud æœåŠ¡å‘ç°åŠŸèƒ½ï¼›</li>
<li>æ˜“äºç¼–å†™çš„ Predicateï¼ˆæ–­è¨€ï¼‰å’Œ Filterï¼ˆè¿‡æ»¤å™¨ï¼‰ï¼›</li>
<li>è¯·æ±‚é™æµåŠŸèƒ½ï¼›</li>
<li>æ”¯æŒè·¯å¾„é‡å†™ã€‚</li>
</ol>
</blockquote>
<blockquote>
<p><strong>Spring Cloud Gateway ä¸ Zuulçš„åŒºåˆ«</strong><br>åœ¨SpringCloud Finchley æ­£å¼ç‰ˆä¹‹å‰ï¼ŒSpring Cloud æ¨èçš„ç½‘å…³æ˜¯ Netflix æä¾›çš„Zuulï¼š</p>
<ol>
<li><p>Zuul 1.xï¼Œæ˜¯ä¸€ä¸ªåŸºäºé˜»å¡ I&#x2F; O çš„ API Gateway</p>
</li>
<li><p>Zuul 1.x åŸºäºServlet 2. 5ä½¿ç”¨é˜»å¡æ¶æ„å®ƒä¸æ”¯æŒä»»ä½•é•¿è¿æ¥(å¦‚ WebSocket) Zuul çš„è®¾è®¡æ¨¡å¼å’ŒNginxè¾ƒåƒï¼Œæ¯æ¬¡ I&#x2F; O æ“ä½œéƒ½æ˜¯ä»å·¥ä½œçº¿ç¨‹ä¸­é€‰æ‹©ä¸€ä¸ªæ‰§è¡Œï¼Œè¯·æ±‚çº¿ç¨‹è¢«é˜»å¡åˆ°å·¥ä½œçº¿ç¨‹å®Œæˆï¼Œä½†æ˜¯å·®åˆ«æ˜¯Nginx ç”¨C++ å®ç°ï¼ŒZuul ç”¨ Java å®ç°ï¼Œè€Œ JVM æœ¬èº«ä¼šæœ‰ç¬¬ä¸€æ¬¡åŠ è½½è¾ƒæ…¢çš„æƒ…å†µï¼Œä½¿å¾—Zuul çš„æ€§èƒ½ç›¸å¯¹è¾ƒå·®ã€‚</p>
</li>
<li><p>Zuul 2.xç†å¿µæ›´å…ˆè¿›ï¼Œæƒ³åŸºäºNettyéé˜»å¡å’Œæ”¯æŒé•¿è¿æ¥ï¼Œä½†SpringCloudç›®å‰è¿˜æ²¡æœ‰æ•´åˆã€‚ Zuul 2.xçš„æ€§èƒ½è¾ƒ Zuul 1.x æœ‰è¾ƒå¤§æå‡ã€‚åœ¨æ€§èƒ½æ–¹é¢ï¼Œæ ¹æ®å®˜æ–¹æä¾›çš„åŸºå‡†æµ‹è¯•ï¼Œ Spring Cloud Gateway çš„ RPSï¼ˆæ¯ç§’è¯·æ±‚æ•°ï¼‰æ˜¯Zuul çš„ 1. 6 å€ã€‚</p>
</li>
<li><p>Spring Cloud Gateway å»ºç«‹ åœ¨ Spring Framework 5ã€ Project Reactor å’Œ Spring Boot 2 ä¹‹ä¸Šï¼Œ ä½¿ç”¨éé˜»å¡ APIã€‚</p>
</li>
<li><p>Spring Cloud Gateway è¿˜æ”¯æŒ WebSocketï¼Œ å¹¶ä¸”ä¸Springç´§å¯†é›†æˆæ‹¥æœ‰æ›´å¥½çš„å¼€å‘ä½“éªŒ</p>
</li>
</ol>
</blockquote>
<h2 id="Zuul1-xæ¨¡å‹"><a href="#Zuul1-xæ¨¡å‹" class="headerlink" title="Zuul1.xæ¨¡å‹"></a>Zuul1.xæ¨¡å‹</h2><blockquote>
<p>Springcloudä¸­æ‰€é›†æˆçš„Zuulç‰ˆæœ¬ï¼Œé‡‡ç”¨çš„æ˜¯Tomcatå®¹å™¨ï¼Œä½¿ç”¨çš„æ˜¯ä¼ ç»Ÿçš„Servlet IOå¤„ç†æ¨¡å‹ã€‚</p>
<p>servletç”±servlet containerè¿›è¡Œç”Ÿå‘½å‘¨æœŸç®¡ç†ã€‚<br>containerå¯åŠ¨æ—¶æ„é€ servletå¯¹è±¡å¹¶è°ƒç”¨servlet init()è¿›è¡Œåˆå§‹åŒ–ï¼›<br>containerè¿è¡Œæ—¶æ¥å—è¯·æ±‚ï¼Œå¹¶ä¸ºæ¯ä¸ªè¯·æ±‚åˆ†é…ä¸€ä¸ªçº¿ç¨‹ï¼ˆä¸€èˆ¬ä»çº¿ç¨‹æ± ä¸­è·å–ç©ºé—²çº¿ç¨‹ï¼‰ç„¶åè°ƒç”¨service()ã€‚<br>containerå…³é—­æ—¶è°ƒç”¨servlet destory()é”€æ¯servletï¼›</p>
<p>ä¸Šè¿°æ¨¡å¼çš„ç¼ºç‚¹ï¼š<br>servletæ˜¯ä¸€ä¸ªç®€å•çš„ç½‘ç»œIOæ¨¡å‹ï¼Œå½“è¯·æ±‚è¿›å…¥servlet containeræ—¶ï¼Œservlet containerå°±ä¼šä¸ºå…¶ç»‘å®šä¸€ä¸ªçº¿ç¨‹ï¼Œåœ¨å¹¶å‘ä¸é«˜çš„åœºæ™¯ä¸‹è¿™ç§æ¨¡å‹æ˜¯é€‚ç”¨çš„ã€‚ä½†æ˜¯ä¸€æ—¦é«˜å¹¶å‘(æ¯”å¦‚æŠ½é£ç”¨jemeterå‹)ï¼Œçº¿ç¨‹æ•°é‡å°±ä¼šä¸Šæ¶¨ï¼Œè€Œçº¿ç¨‹èµ„æºä»£ä»·æ˜¯æ˜‚è´µçš„ï¼ˆä¸Šçº¿æ–‡åˆ‡æ¢ï¼Œå†…å­˜æ¶ˆè€—å¤§ï¼‰ä¸¥é‡å½±å“è¯·æ±‚çš„å¤„ç†æ—¶é—´ã€‚åœ¨ä¸€äº›ç®€å•ä¸šåŠ¡åœºæ™¯ä¸‹ï¼Œä¸å¸Œæœ›ä¸ºæ¯ä¸ªrequeståˆ†é…ä¸€ä¸ªçº¿ç¨‹ï¼Œåªéœ€è¦1ä¸ªæˆ–å‡ ä¸ªçº¿ç¨‹å°±èƒ½åº”å¯¹æå¤§å¹¶å‘çš„è¯·æ±‚ï¼Œè¿™ç§ä¸šåŠ¡åœºæ™¯ä¸‹servletæ¨¡å‹æ²¡æœ‰ä¼˜åŠ¿</p>
<p>æ‰€ä»¥Zuul 1.Xæ˜¯åŸºäºservletä¹‹ä¸Šçš„ä¸€ä¸ªé˜»å¡å¼å¤„ç†æ¨¡å‹ï¼Œå³springå®ç°äº†å¤„ç†æ‰€æœ‰requestè¯·æ±‚çš„ä¸€ä¸ªservletï¼ˆDispatcherServletï¼‰å¹¶ç”±è¯¥servleté˜»å¡å¼å¤„ç†å¤„ç†ã€‚æ‰€ä»¥Springcloud Zuulæ— æ³•æ‘†è„±servletæ¨¡å‹çš„å¼Šç«¯</p>
</blockquote>
<h2 id="GateWayæ¨¡å‹"><a href="#GateWayæ¨¡å‹" class="headerlink" title="GateWayæ¨¡å‹"></a>GateWayæ¨¡å‹</h2><blockquote>
<p>WebFluxï¼š<a href="https://docs.spring.io/spring/docs/current/spring-framework-reference/web-reactive.html#webflux-new-framework">https://docs.spring.io/spring/docs/current/spring-framework-reference/web-reactive.html#webflux-new-framework</a></p>
<p>ä¼ ç»Ÿçš„Webæ¡†æ¶ï¼Œæ¯”å¦‚è¯´ï¼šstruts2ï¼Œspringmvcç­‰éƒ½æ˜¯åŸºäºServlet APIä¸Servletå®¹å™¨åŸºç¡€ä¹‹ä¸Šè¿è¡Œçš„ã€‚<br>ä½†æ˜¯<br>åœ¨Servlet3.1ä¹‹åæœ‰äº†å¼‚æ­¥éé˜»å¡çš„æ”¯æŒã€‚è€ŒWebFluxæ˜¯ä¸€ä¸ªå…¸å‹éé˜»å¡å¼‚æ­¥çš„æ¡†æ¶ï¼Œå®ƒçš„æ ¸å¿ƒæ˜¯åŸºäºReactorçš„ç›¸å…³APIå®ç°çš„ã€‚ç›¸å¯¹äºä¼ ç»Ÿçš„webæ¡†æ¶æ¥è¯´ï¼Œå®ƒå¯ä»¥è¿è¡Œåœ¨è¯¸å¦‚Nettyï¼ŒUndertowåŠæ”¯æŒServlet3.1çš„å®¹å™¨ä¸Šã€‚éé˜»å¡å¼+å‡½æ•°å¼ç¼–ç¨‹ï¼ˆSpring5å¿…é¡»è®©ä½ ä½¿ç”¨java8ï¼‰</p>
<p>Spring WebFlux æ˜¯ Spring 5.0 å¼•å…¥çš„æ–°çš„å“åº”å¼æ¡†æ¶ï¼ŒåŒºåˆ«äº Spring MVCï¼Œå®ƒä¸éœ€è¦ä¾èµ–Servlet APIï¼Œå®ƒæ˜¯å®Œå…¨å¼‚æ­¥éé˜»å¡çš„ï¼Œå¹¶ä¸”åŸºäº Reactor æ¥å®ç°å“åº”å¼æµè§„èŒƒã€‚</p>
</blockquote>
<h2 id="ä¸‰å¤§æ ¸å¿ƒæ¦‚å¿µ"><a href="#ä¸‰å¤§æ ¸å¿ƒæ¦‚å¿µ" class="headerlink" title="ä¸‰å¤§æ ¸å¿ƒæ¦‚å¿µ"></a>ä¸‰å¤§æ ¸å¿ƒæ¦‚å¿µ</h2><h3 id="è·¯ç”±ï¼ˆrouteï¼‰"><a href="#è·¯ç”±ï¼ˆrouteï¼‰" class="headerlink" title="è·¯ç”±ï¼ˆrouteï¼‰"></a>è·¯ç”±ï¼ˆrouteï¼‰</h3><p><strong>è·¯ç”±æ˜¯æ„å»ºç½‘å…³çš„åŸºæœ¬æ¨¡å—ï¼Œå®ƒç”±IDï¼Œç›®æ ‡URIï¼Œä¸€ç³»åˆ—çš„æ–­è¨€å’Œè¿‡æ»¤å™¨ç»„æˆï¼Œå¦‚æœæ–­è¨€ä¸ºtrueåˆ™åŒ¹é…è¯¥è·¯ç”±</strong></p>
<h3 id="æ–­è¨€ï¼ˆPredicateï¼‰"><a href="#æ–­è¨€ï¼ˆPredicateï¼‰" class="headerlink" title="æ–­è¨€ï¼ˆPredicateï¼‰"></a>æ–­è¨€ï¼ˆPredicateï¼‰</h3><p>å¼€å‘äººå‘˜å¯ä»¥åŒ¹é…HTTPè¯·æ±‚ä¸­çš„æ‰€æœ‰å†…å®¹ï¼ˆä¾‹å¦‚è¯·æ±‚å¤´æˆ–è¯·æ±‚å‚æ•°ï¼‰ï¼Œå¦‚æœè¯·æ±‚ä¸æ–­è¨€ç›¸åŒ¹é…åˆ™è¿›è¡Œè·¯ç”±</p>
<h3 id="è¿‡æ»¤ï¼ˆFilterï¼‰"><a href="#è¿‡æ»¤ï¼ˆFilterï¼‰" class="headerlink" title="è¿‡æ»¤ï¼ˆFilterï¼‰"></a>è¿‡æ»¤ï¼ˆFilterï¼‰</h3><p>æŒ‡çš„æ˜¯Springæ¡†æ¶ä¸­GatewayFilterçš„å®ä¾‹ï¼Œä½¿ç”¨è¿‡æ»¤å™¨ï¼Œå¯ä»¥åœ¨è¯·æ±‚è¢«è·¯ç”±å‰æˆ–è€…ä¹‹åå¯¹è¯·æ±‚è¿›è¡Œä¿®æ”¹ã€‚</p>
<blockquote>
<p>æ€»ä½“æ¥è¯´ï¼š</p>
<p>webè¯·æ±‚ï¼Œé€šè¿‡ä¸€äº›åŒ¹é…æ¡ä»¶ï¼Œå®šä½åˆ°çœŸæ­£çš„æœåŠ¡èŠ‚ç‚¹ã€‚å¹¶åœ¨è¿™ä¸ªè½¬å‘è¿‡ç¨‹çš„å‰åï¼Œè¿›è¡Œä¸€äº›ç²¾ç»†åŒ–æ§åˆ¶ã€‚å…¶ä¸­predicateå°±æ˜¯æˆ‘ä»¬çš„åŒ¹é…æ¡ä»¶ï¼›è€Œfilterå¯ä»¥ç†è§£ä¸ºä¸€ä¸ªæ‹¦æˆªå™¨ã€‚</p>
<p>æ ¸å¿ƒé€»è¾‘ï¼šè·¯ç”±è½¬å‘ + æ‰§è¡Œè¿‡æ»¤å™¨é“¾</p>
<img src="/2023/02/28/SpringCloud/Java\Document\SpringCloud\images\image-20221228111941484.png" alt="image-20221228111941484" style="zoom:80%;">

<p>å®¢æˆ·ç«¯å‘ Spring Cloud Gateway å‘å‡ºè¯·æ±‚ã€‚ç„¶ååœ¨ Gateway Handler Mapping ä¸­æ‰¾åˆ°ä¸è¯·æ±‚ç›¸åŒ¹é…çš„è·¯ç”±ï¼Œå°†å…¶å‘é€åˆ° Gateway Web Handlerã€‚</p>
<p>Handler å†é€šè¿‡æŒ‡å®šçš„è¿‡æ»¤å™¨é“¾æ¥å°†è¯·æ±‚å‘é€åˆ°æˆ‘ä»¬å®é™…çš„æœåŠ¡æ‰§è¡Œä¸šåŠ¡é€»è¾‘ï¼Œç„¶åè¿”å›ã€‚<br>è¿‡æ»¤å™¨ä¹‹é—´ç”¨è™šçº¿åˆ†å¼€æ˜¯å› ä¸ºè¿‡æ»¤å™¨å¯èƒ½ä¼šåœ¨å‘é€ä»£ç†è¯·æ±‚ä¹‹å‰ï¼ˆâ€œpreâ€ï¼‰æˆ–ä¹‹åï¼ˆâ€œpostâ€ï¼‰æ‰§è¡Œä¸šåŠ¡é€»è¾‘ã€‚</p>
<p>Filteråœ¨â€œpreâ€ç±»å‹çš„è¿‡æ»¤å™¨å¯ä»¥åšå‚æ•°æ ¡éªŒã€æƒé™æ ¡éªŒã€æµé‡ç›‘æ§ã€æ—¥å¿—è¾“å‡ºã€åè®®è½¬æ¢ç­‰ï¼Œ<br>åœ¨â€œPOSTâ€ç±»å‹çš„è¿‡æ»¤å™¨ä¸­å¯ä»¥åšå“åº”å†…å®¹ã€å“åº”å¤´çš„ä¿®æ”¹ï¼Œæ—¥å¿—çš„è¾“å‡ºï¼Œæµé‡ç›‘æ§ç­‰æœ‰ç€éå¸¸é‡è¦çš„ä½œç”¨ã€‚</p>
</blockquote>
<h2 id="é…ç½®ç¤ºä¾‹"><a href="#é…ç½®ç¤ºä¾‹" class="headerlink" title="é…ç½®ç¤ºä¾‹"></a>é…ç½®ç¤ºä¾‹</h2><h3 id="æ–°å»ºå·¥ç¨‹"><a href="#æ–°å»ºå·¥ç¨‹" class="headerlink" title="æ–°å»ºå·¥ç¨‹"></a>æ–°å»ºå·¥ç¨‹</h3><blockquote>
<p>ä¸»è¦æ­¥éª¤ï¼š</p>
<ol>
<li><p>å¼•å…¥ä¾èµ–</p>
 <figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-gateway<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
</ol>
</blockquote>
<ol>
<li><p>æ–°å»ºæ¨¡å— cloud-gateway-gateway9527</p>
</li>
<li><p>å¼•å…¥ä¾èµ–</p>
 <figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-gateway<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-netflix-eureka-client<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.example<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>cloud-commons<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-devtools<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>runtime<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>é…ç½®æ–‡ä»¶yml</p>
 <figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">9527</span></span><br><span class="line"></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">cloud-gateway</span></span><br><span class="line"></span><br><span class="line"><span class="attr">eureka:</span></span><br><span class="line">  <span class="attr">instance:</span></span><br><span class="line">    <span class="attr">hostname:</span> <span class="string">cloud-gateway-service</span></span><br><span class="line">  <span class="attr">client:</span> <span class="comment">#æœåŠ¡æä¾›è€…provideræ³¨å†Œè¿›eurekaæœåŠ¡åˆ—è¡¨å†…</span></span><br><span class="line">    <span class="attr">service-url:</span></span><br><span class="line">      <span class="attr">register-with-eureka:</span> <span class="literal">true</span></span><br><span class="line">      <span class="attr">fetch-registry:</span> <span class="literal">true</span></span><br><span class="line">      <span class="attr">defaultZone:</span> <span class="string">http://eureka7001.com:7001/eureka</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>å¯åŠ¨ç±»</p>
 <figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@EnableEurekaClient</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">GateWayMain9527</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        SpringApplication.run(GateWayMain9527.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ol>
<h3 id="è·¯ç”±æ˜ å°„ç¤ºä¾‹"><a href="#è·¯ç”±æ˜ å°„ç¤ºä¾‹" class="headerlink" title="è·¯ç”±æ˜ å°„ç¤ºä¾‹"></a>è·¯ç”±æ˜ å°„ç¤ºä¾‹</h3><p><strong>ç½‘å…³é…ç½®</strong></p>
<blockquote>
<figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure>


</blockquote>
<p>æµ‹è¯•ï¼š</p>
<p>è®¿é—®åœ°å€ç”± <a href="http://localhost:8001/payment/get/1">http://localhost:8001/payment/get/1</a> æ”¹ä¸º <a href="http://localhost:9527/payment/get/1">http://localhost:9527/payment/get/1</a></p>
<h3 id="é…ç½®è¯´æ˜"><a href="#é…ç½®è¯´æ˜" class="headerlink" title="é…ç½®è¯´æ˜"></a>é…ç½®è¯´æ˜</h3><p>Gatewayç½‘å…³è·¯ç”±æœ‰ä¸¤ç§é…ç½®æ–¹å¼ï¼š</p>
<p>ç¬¬ä¸€ç§ï¼šymlé…ç½®</p>
<p>ç¤ºä¾‹ï¼šlocalhost:9527?url&#x3D;baiduè·³è½¬è‡³<a href="http://www.baidu.com,url=qqè·³è½¬è‡³http//www.qq.com">http://www.baidu.comï¼Œurl=qqè·³è½¬è‡³http://www.qq.com</a></p>
<figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">9527</span></span><br><span class="line"></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">cloud-gateway</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">gateway:</span></span><br><span class="line">      <span class="attr">routes:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">id:</span> <span class="string">baidu-route</span></span><br><span class="line">          <span class="attr">uri:</span> <span class="string">https://www.baidu.com</span></span><br><span class="line">          <span class="attr">predicates:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">Query=url,baidu</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">id:</span> <span class="string">qq-route</span></span><br><span class="line">          <span class="attr">uri:</span> <span class="string">https://www.qq.com</span></span><br><span class="line">          <span class="attr">predicates:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">Query=url,qq</span></span><br></pre></td></tr></table></figure>

<p>ç¬¬äºŒç§ï¼šä»£ç é…ç½®</p>
<p>ä»£ç ä¸­æ³¨å…¥RouteLocatorçš„Bean</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">GateWayConfig</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * é…ç½®äº†ä¸€ä¸ªidä¸ºroute-nameçš„è·¯ç”±è§„åˆ™ï¼Œ</span></span><br><span class="line"><span class="comment">     * å½“è®¿é—®åœ°å€ http://localhost:9527/guoneiæ—¶</span></span><br><span class="line"><span class="comment">     * ä¼šè‡ªåŠ¨è½¬å‘åˆ°åœ°å€ï¼šhttp://news.baidu.com/guonei</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> RouteLocator <span class="title function_">customRouteLocator</span><span class="params">(RouteLocatorBuilder builder)</span> &#123;</span><br><span class="line">        RouteLocatorBuilder.<span class="type">Builder</span> <span class="variable">routes</span> <span class="operator">=</span> builder.routes();</span><br><span class="line">        routes.route(<span class="string">&quot;path_route_example&quot;</span>, r -&gt; r.path(<span class="string">&quot;/guonei&quot;</span>).uri(<span class="string">&quot;http://news.baidu.com/guonei&quot;</span>)).build();</span><br><span class="line">        <span class="keyword">return</span> routes.build();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> RouteLocator <span class="title function_">customRouteLocator2</span><span class="params">(RouteLocatorBuilder builder)</span> &#123;</span><br><span class="line">        RouteLocatorBuilder.<span class="type">Builder</span> <span class="variable">routes</span> <span class="operator">=</span> builder.routes();</span><br><span class="line">        routes.route(<span class="string">&quot;path_route_example2&quot;</span>, r -&gt; r.path(<span class="string">&quot;/guoji&quot;</span>).uri(<span class="string">&quot;http://news.baidu.com/guoji&quot;</span>)).build();</span><br><span class="line">        <span class="keyword">return</span> routes.build();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="é€šè¿‡å¾®æœåŠ¡åå®ç°åŠ¨æ€è·¯ç”±"><a href="#é€šè¿‡å¾®æœåŠ¡åå®ç°åŠ¨æ€è·¯ç”±" class="headerlink" title="é€šè¿‡å¾®æœåŠ¡åå®ç°åŠ¨æ€è·¯ç”±"></a>é€šè¿‡å¾®æœåŠ¡åå®ç°åŠ¨æ€è·¯ç”±</h3><p>é»˜è®¤æƒ…å†µä¸‹Gatewayä¼šæ ¹æ®æ³¨å†Œä¸­å¿ƒæ³¨å†Œçš„æœåŠ¡åˆ—è¡¨ï¼Œä»¥æ³¨å†Œä¸­å¿ƒä¸Šå¾®æœåŠ¡åä¸ºè·¯å¾„åˆ›å»ºåŠ¨æ€è·¯ç”±è¿›è¡Œè½¬å‘ï¼Œä»è€Œå®ç°åŠ¨æ€è·¯ç”±çš„åŠŸèƒ½ã€‚</p>
<p>cloud-gateway-gateway9527æ³¨å†Œè¿›Eureka</p>
<ol>
<li>application.ymlé…ç½®ï¼š</li>
</ol>
<figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">9527</span></span><br><span class="line"></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">cloud-gateway</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">gateway:</span></span><br><span class="line">      <span class="attr">discovery:</span></span><br><span class="line">        <span class="attr">locator:</span></span><br><span class="line">          <span class="comment">#å¼€å¯ä»æ³¨å†Œä¸­å¿ƒåŠ¨æ€åˆ›å»ºè·¯ç”±çš„åŠŸèƒ½ï¼Œåˆ©ç”¨å¾®æœåŠ¡åè¿›è¡Œè·¯ç”±</span></span><br><span class="line">          <span class="attr">enabled:</span> <span class="literal">true</span></span><br><span class="line">      <span class="attr">routes:</span></span><br><span class="line">        <span class="comment">#è·¯ç”±çš„IDï¼Œæ²¡æœ‰å›ºå®šè§„åˆ™ä½†è¦æ±‚å”¯ä¸€ï¼Œå»ºè®®é…åˆæœåŠ¡å</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">id:</span> <span class="string">payment_routh</span></span><br><span class="line">          <span class="comment">#uriçš„åè®®ä¸ºlbï¼Œlb://serviceName,è¡¨ç¤ºå¯ç”¨Gatewayçš„è´Ÿè½½å‡è¡¡åŠŸèƒ½</span></span><br><span class="line">          <span class="attr">uri:</span> <span class="string">lb://cloud-payment-service</span></span><br><span class="line">          <span class="attr">predicates:</span></span><br><span class="line">            <span class="comment"># æ–­è¨€ï¼Œè·¯å¾„ç›¸åŒ¹é…çš„è¿›è¡Œè·¯ç”±</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">Path=/payment/get/**</span></span><br><span class="line"></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">id:</span> <span class="string">payment_routh2</span></span><br><span class="line">          <span class="attr">uri:</span> <span class="string">lb://cloud-payment-service</span></span><br><span class="line">          <span class="attr">predicates:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">Path=/payment/lb/**</span></span><br><span class="line"><span class="attr">eureka:</span></span><br><span class="line">  <span class="attr">instance:</span></span><br><span class="line">    <span class="attr">hostname:</span> <span class="string">cloud-gateway-service</span></span><br><span class="line">  <span class="attr">client:</span></span><br><span class="line">    <span class="attr">service-url:</span></span><br><span class="line">      <span class="attr">register-with-eureka:</span> <span class="literal">true</span></span><br><span class="line">      <span class="attr">fetch-registry:</span> <span class="literal">true</span></span><br><span class="line">      <span class="attr">defaultZone:</span> <span class="string">http://eureka7001.com:7001/eureka,http://eureka7002.com:7002/eureka</span></span><br></pre></td></tr></table></figure>

<ol start="2">
<li>æµ‹è¯•ï¼šå¯åŠ¨Eurekaå’Œä¸¤ä¸ªPaymentæä¾›è€…ï¼Œè®¿é—®<a href="http://localhost:9527/payment/lb">http://localhost:9527/payment/lb</a></li>
</ol>
<h3 id="Predicateçš„ä½¿ç”¨"><a href="#Predicateçš„ä½¿ç”¨" class="headerlink" title="Predicateçš„ä½¿ç”¨"></a>Predicateçš„ä½¿ç”¨</h3><p>Predicateæ˜¯å®ç°ä¸€ç»„åŒ¹é…è§„åˆ™ï¼ŒåŒ¹é…å¯¹åº”çš„Routeè¿›è¡Œå¤„ç†ã€‚</p>
<p>å¸¸ç”¨çš„Route Predicateï¼šã€RoutePredicateFactoryå­ç±»ã€‘</p>
<h4 id="After-Route-Predicate"><a href="#After-Route-Predicate" class="headerlink" title="After Route Predicate"></a>After Route Predicate</h4><blockquote>
<p>æŒ‡å®šæ—¶é—´åæ‰å¯ä»¥è®¿é—®</p>
<figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="attr">routes:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">id:</span> <span class="string">payment_routh_plus</span></span><br><span class="line">    <span class="attr">uri:</span> <span class="string">lb://cloud-payment-service</span></span><br><span class="line">    <span class="attr">predicates:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">Path=/payment/lb/**</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">After=2022-12-29T15:10:03.685+08:00[Asia/Shanghai]</span></span><br></pre></td></tr></table></figure>

<p>å¦åˆ™æŠ¥é”™ï¼š</p>
<figure class="highlight tex"><table><tr><td class="code"><pre><span class="line">[ebf279f3] There was an unexpected error (type=Not Found, status=404).</span><br><span class="line">org.springframework.web.server.ResponseStatusException: 404 NOT<span class="built_in">_</span>FOUND</span><br><span class="line">	at org.springframework.web.reactive.resource.ResourceWebHandler.lambda<span class="built_in">$</span>handle<span class="built_in">$</span>0(ResourceWebHandler.java:325)</span><br><span class="line">	Suppressed: reactor.core.publisher.FluxOnAssembly<span class="built_in">$</span>OnAssemblyException: </span><br><span class="line">Error has been observed at the following site(s):</span><br><span class="line">	|<span class="built_in">_</span> checkpoint â‡¢ org.springframework.cloud.gateway.filter.WeightCalculatorWebFilter [DefaultWebFilterChain]</span><br><span class="line">	|<span class="built_in">_</span> checkpoint â‡¢ HTTP GET &quot;/payment/lb&quot; [ExceptionHandlingWebHandler]</span><br></pre></td></tr></table></figure>


</blockquote>
<h4 id="Before-Route-Predicate"><a href="#Before-Route-Predicate" class="headerlink" title="Before Route Predicate"></a>Before Route Predicate</h4><blockquote>
<p>åœ¨æŒ‡å®šæ—¶é—´å‰æ‰å¯ä»¥è®¿é—®</p>
<figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="bullet">-</span> <span class="attr">id:</span> <span class="string">payment_routh_plus</span></span><br><span class="line">  <span class="attr">uri:</span> <span class="string">lb://cloud-payment-service</span></span><br><span class="line">  <span class="attr">predicates:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">Path=/payment/lb/**</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">After=2022-12-25T15:10:00.000+08:00[Asia/Shanghai]</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">Before=2023-12-25T15:10:00.000+08:00[Asia/Shanghai]</span></span><br></pre></td></tr></table></figure>
</blockquote>
<h4 id="Between-Route-Predicate"><a href="#Between-Route-Predicate" class="headerlink" title="Between Route Predicate"></a>Between Route Predicate</h4><blockquote>
<p>åœ¨æŒ‡å®šæ—¶é—´ä¹‹é—´æ‰å¯ä»¥è®¿é—®</p>
<figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="bullet">-</span> <span class="attr">id:</span> <span class="string">payment_routh_plus</span></span><br><span class="line">  <span class="attr">uri:</span> <span class="string">lb://cloud-payment-service</span></span><br><span class="line">  <span class="attr">predicates:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">Path=/payment/lb/**</span></span><br><span class="line">    <span class="comment">#åœ¨æŒ‡å®šæ—¶é—´ä¹‹åæ‰å¯ä»¥è®¿é—®</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">After=2022-12-25T15:10:00.000+08:00[Asia/Shanghai]</span></span><br><span class="line">    <span class="comment">#åœ¨æŒ‡å®šæ—¶é—´ä¹‹å‰æ‰å¯ä»¥è®¿é—®</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">Before=2023-12-25T15:10:00.000+08:00[Asia/Shanghai]</span></span><br><span class="line">    <span class="comment">#åœ¨æŒ‡å®šæ—¶é—´ä¹‹é—´æ‰å¯ä»¥è®¿é—®</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">Between=2020-02-02T17:45:06.206+08:00[Asia/Shanghai],2020-03-25T18:59:06.206+08:00[Asia/Shanghai]</span></span><br></pre></td></tr></table></figure>
</blockquote>
<h4 id="Cookie-Route-Predicate"><a href="#Cookie-Route-Predicate" class="headerlink" title="Cookie Route Predicate"></a>Cookie Route Predicate</h4><blockquote>
<p>Cookie Route Predicateéœ€è¦ä¸¤ä¸ªå‚æ•°ï¼Œä¸€ä¸ªæ˜¯ Cookie name ï¼Œä¸€ä¸ªæ˜¯æ­£åˆ™è¡¨è¾¾å¼ã€‚<br>è·¯ç”±è§„åˆ™ä¼šé€šè¿‡è·å–å¯¹åº”çš„ Cookie name çš„å€¼å’Œæ­£åˆ™è¡¨è¾¾å¼å»åŒ¹é…ï¼Œå¦‚æœåŒ¹é…ä¸Šå°±ä¼šæ‰§è¡Œè·¯ç”±ï¼Œå¦‚æœæ²¡æœ‰åŒ¹é…ä¸Šåˆ™ä¸æ‰§è¡Œ</p>
<figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="bullet">-</span> <span class="attr">id:</span> <span class="string">payment_routh_plus</span></span><br><span class="line">  <span class="attr">uri:</span> <span class="string">lb://cloud-payment-service</span></span><br><span class="line">  <span class="attr">predicates:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">Path=/payment/lb/**</span></span><br><span class="line">    <span class="comment">#åœ¨æŒ‡å®šæ—¶é—´ä¹‹åæ‰å¯ä»¥è®¿é—®</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">After=2022-12-25T15:10:00.000+08:00[Asia/Shanghai]</span></span><br><span class="line">    <span class="comment">#åœ¨æŒ‡å®šæ—¶é—´ä¹‹å‰æ‰å¯ä»¥è®¿é—®</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">Before=2023-12-25T15:10:00.000+08:00[Asia/Shanghai]</span></span><br><span class="line">    <span class="comment">#åœ¨æŒ‡å®šæ—¶é—´ä¹‹é—´æ‰å¯ä»¥è®¿é—®</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">Between=2020-02-02T17:45:06.206+08:00[Asia/Shanghai],2020-03-25T18:59:06.206+08:00[Asia/Shanghai]</span></span><br><span class="line">    <span class="comment">#æºå¸¦åŒ¹é…æ­£åˆ™è¡¨è¾¾å¼liufeiçš„cookieæ‰èƒ½è®¿é—®</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">Cookie=username,liufei</span></span><br></pre></td></tr></table></figure>

<p>æµ‹è¯•ï¼š</p>
<p>curl <a href="http://localhost:9527/payment/lb">http://localhost:9527/payment/lb</a> â€“cookie â€œusername&#x3D;liufeiâ€</p>
</blockquote>
<h4 id="Header-Route-Predicate"><a href="#Header-Route-Predicate" class="headerlink" title="Header Route Predicate"></a>Header Route Predicate</h4><p>ä¸¤ä¸ªå‚æ•°ï¼šä¸€ä¸ªæ˜¯å±æ€§åç§°å’Œä¸€ä¸ªæ­£åˆ™è¡¨è¾¾å¼ï¼Œè¿™ä¸ªå±æ€§å€¼å’Œæ­£åˆ™è¡¨è¾¾å¼åŒ¹é…åˆ™æ‰§è¡Œã€‚</p>
<blockquote>
<figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="bullet">-</span> <span class="attr">id:</span> <span class="string">payment_routh_plus</span></span><br><span class="line">  <span class="attr">uri:</span> <span class="string">lb://cloud-payment-service</span></span><br><span class="line">  <span class="attr">predicates:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">Path=/payment/lb/**</span></span><br><span class="line">    <span class="comment">#åœ¨æŒ‡å®šæ—¶é—´ä¹‹åæ‰å¯ä»¥è®¿é—®</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">After=2022-12-25T15:10:00.000+08:00[Asia/Shanghai]</span></span><br><span class="line">    <span class="comment">#åœ¨æŒ‡å®šæ—¶é—´ä¹‹å‰æ‰å¯ä»¥è®¿é—®</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">Before=2023-12-25T15:10:00.000+08:00[Asia/Shanghai]</span></span><br><span class="line">    <span class="comment">#åœ¨æŒ‡å®šæ—¶é—´ä¹‹é—´æ‰å¯ä»¥è®¿é—®</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">Between=2022-02-02T17:45:06.206+08:00[Asia/Shanghai],2024-03-25T18:59:06.206+08:00[Asia/Shanghai]</span></span><br><span class="line">    <span class="comment">#æºå¸¦åŒ¹é…æ­£åˆ™è¡¨è¾¾å¼liufeiçš„cookieæ‰èƒ½è®¿é—®</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">Cookie=username,liufei</span></span><br><span class="line">    <span class="comment">#è¯·æ±‚å¤´è¦æœ‰X-Request-Idå±æ€§å¹¶ä¸”å€¼ä¸ºæ•´æ•°çš„æ­£åˆ™è¡¨è¾¾å¼</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">Header=X-Request-Id,</span> <span class="string">\d+</span></span><br></pre></td></tr></table></figure>

<p>æµ‹è¯•ï¼šcurl <a href="http://localhost:9527/payment/lb">http://localhost:9527/payment/lb</a> -H â€œX-Request-Id:123â€</p>
</blockquote>
<h4 id="Host-Route-Predicate"><a href="#Host-Route-Predicate" class="headerlink" title="Host Route Predicate"></a>Host Route Predicate</h4><p>Host Route Predicate æ¥æ”¶ä¸€ç»„å‚æ•°ï¼Œä¸€ç»„åŒ¹é…çš„åŸŸååˆ—è¡¨ï¼Œè¿™ä¸ªæ¨¡æ¿æ˜¯ä¸€ä¸ª ant åˆ†éš”çš„æ¨¡æ¿ï¼Œç”¨ . å·ä½œä¸ºåˆ†éš”ç¬¦ã€‚å®ƒé€šè¿‡å‚æ•°ä¸­çš„ä¸»æœºåœ°å€ä½œä¸ºåŒ¹é…è§„åˆ™ã€‚</p>
<blockquote>
<figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="bullet">-</span> <span class="attr">id:</span> <span class="string">payment_routh_plus</span></span><br><span class="line">  <span class="attr">uri:</span> <span class="string">lb://cloud-payment-service</span></span><br><span class="line">  <span class="attr">predicates:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">Path=/payment/lb/**</span></span><br><span class="line">    <span class="comment">#åœ¨æŒ‡å®šæ—¶é—´ä¹‹åæ‰å¯ä»¥è®¿é—®</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">After=2022-12-25T15:10:00.000+08:00[Asia/Shanghai]</span></span><br><span class="line">    <span class="comment">#åœ¨æŒ‡å®šæ—¶é—´ä¹‹å‰æ‰å¯ä»¥è®¿é—®</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">Before=2023-12-25T15:10:00.000+08:00[Asia/Shanghai]</span></span><br><span class="line">    <span class="comment">#åœ¨æŒ‡å®šæ—¶é—´ä¹‹é—´æ‰å¯ä»¥è®¿é—®</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">Between=2022-02-02T17:45:06.206+08:00[Asia/Shanghai],2024-03-25T18:59:06.206+08:00[Asia/Shanghai]</span></span><br><span class="line">    <span class="comment">#æºå¸¦åŒ¹é…æ­£åˆ™è¡¨è¾¾å¼liufeiçš„cookieæ‰èƒ½è®¿é—®</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">Cookie=username,liufei</span></span><br><span class="line">    <span class="comment">#è¯·æ±‚å¤´è¦æœ‰X-Request-Idå±æ€§å¹¶ä¸”å€¼ä¸ºæ•´æ•°çš„æ­£åˆ™è¡¨è¾¾å¼</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">Header=X-Request-Id,</span> <span class="string">\d+</span></span><br><span class="line">    <span class="comment">#ä¸€ç»„åŒ¹é…çš„åŸŸååˆ—è¡¨</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">Host=**.example.com</span></span><br></pre></td></tr></table></figure>

<p>æµ‹è¯•ï¼š</p>
<p>æ­£ç¡®ï¼šcurl <a href="http://localhost:9527/payment/lb">http://localhost:9527/payment/lb</a> -H â€œHost: java.example.comâ€<br>é”™è¯¯ï¼šcurl <a href="http://localhost:9527/payment/lb">http://localhost:9527/payment/lb</a> -H â€œHost: java.example.netâ€</p>
</blockquote>
<h4 id="Method-Route-Predicate"><a href="#Method-Route-Predicate" class="headerlink" title="Method Route Predicate"></a>Method Route Predicate</h4><p>è¯·æ±‚æ–¹å¼æ–­è¨€</p>
<blockquote>
<figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="bullet">-</span> <span class="attr">id:</span> <span class="string">payment_routh_plus</span></span><br><span class="line">  <span class="attr">uri:</span> <span class="string">lb://cloud-payment-service</span></span><br><span class="line">  <span class="attr">predicates:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">Path=/payment/lb/**</span></span><br><span class="line">    <span class="comment">#åœ¨æŒ‡å®šæ—¶é—´ä¹‹åæ‰å¯ä»¥è®¿é—®</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">After=2022-12-25T15:10:00.000+08:00[Asia/Shanghai]</span></span><br><span class="line">    <span class="comment">#åœ¨æŒ‡å®šæ—¶é—´ä¹‹å‰æ‰å¯ä»¥è®¿é—®</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">Before=2023-12-25T15:10:00.000+08:00[Asia/Shanghai]</span></span><br><span class="line">    <span class="comment">#åœ¨æŒ‡å®šæ—¶é—´ä¹‹é—´æ‰å¯ä»¥è®¿é—®</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">Between=2022-02-02T17:45:06.206+08:00[Asia/Shanghai],2024-03-25T18:59:06.206+08:00[Asia/Shanghai]</span></span><br><span class="line">    <span class="comment">#æºå¸¦åŒ¹é…æ­£åˆ™è¡¨è¾¾å¼liufeiçš„cookieæ‰èƒ½è®¿é—®</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">Cookie=username,liufei</span></span><br><span class="line">    <span class="comment">#è¯·æ±‚å¤´è¦æœ‰X-Request-Idå±æ€§å¹¶ä¸”å€¼ä¸ºæ•´æ•°çš„æ­£åˆ™è¡¨è¾¾å¼</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">Header=X-Request-Id,</span> <span class="string">\d+</span></span><br><span class="line">    <span class="comment">#ä¸€ç»„åŒ¹é…çš„åŸŸååˆ—è¡¨</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">Host=**.example.com</span></span><br><span class="line">    <span class="comment">#è¯·æ±‚æ–¹å¼</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">Method=GET</span></span><br></pre></td></tr></table></figure>

<p>æµ‹è¯•ï¼šcurl -X -POST <a href="http://localhost:9527/payment/lb">http://localhost:9527/payment/lb</a> </p>
</blockquote>
<h4 id="Path-Route-Predicate"><a href="#Path-Route-Predicate" class="headerlink" title="Path Route Predicate"></a>Path Route Predicate</h4><p>æ ¹æ®è·¯å¾„åŒ¹é…çš„è§„åˆ™</p>
<blockquote>
<figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="bullet">-</span> <span class="attr">id:</span> <span class="string">payment_routh_plus</span></span><br><span class="line">  <span class="attr">uri:</span> <span class="string">lb://cloud-payment-service</span></span><br><span class="line">  <span class="attr">predicates:</span></span><br><span class="line">  	<span class="comment">#æ ¹æ®è·¯å¾„åŒ¹é…</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">Path=/payment/lb/**</span></span><br></pre></td></tr></table></figure>
</blockquote>
<h4 id="Query-Route-Predicate"><a href="#Query-Route-Predicate" class="headerlink" title="Query Route Predicate"></a>Query Route Predicate</h4><p>æ ¹æ®æŸ¥è¯¢å‚æ•°è¿›è¡ŒåŒ¹é…</p>
<blockquote>
<p>æ”¯æŒä¼ å…¥ä¸¤ä¸ªå‚æ•°ï¼Œä¸€ä¸ªæ˜¯å±æ€§åï¼Œä¸€ä¸ªä¸ºå±æ€§å€¼ï¼Œå±æ€§å€¼å¯ä»¥æ˜¯æ­£åˆ™è¡¨è¾¾å¼ã€‚</p>
<figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="bullet">-</span> <span class="attr">id:</span> <span class="string">payment_routh_plus</span></span><br><span class="line">  <span class="attr">uri:</span> <span class="string">lb://cloud-payment-service</span></span><br><span class="line">  <span class="attr">predicates:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">Path=/payment/lb/**</span></span><br><span class="line">    <span class="comment">#åœ¨æŒ‡å®šæ—¶é—´ä¹‹åæ‰å¯ä»¥è®¿é—®</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">After=2022-12-25T15:10:00.000+08:00[Asia/Shanghai]</span></span><br><span class="line">    <span class="comment">#åœ¨æŒ‡å®šæ—¶é—´ä¹‹å‰æ‰å¯ä»¥è®¿é—®</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">Before=2023-12-25T15:10:00.000+08:00[Asia/Shanghai]</span></span><br><span class="line">    <span class="comment">#åœ¨æŒ‡å®šæ—¶é—´ä¹‹é—´æ‰å¯ä»¥è®¿é—®</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">Between=2022-02-02T17:45:06.206+08:00[Asia/Shanghai],2024-03-25T18:59:06.206+08:00[Asia/Shanghai]</span></span><br><span class="line">    <span class="comment">#æºå¸¦åŒ¹é…æ­£åˆ™è¡¨è¾¾å¼liufeiçš„cookieæ‰èƒ½è®¿é—®</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">Cookie=username,liufei</span></span><br><span class="line">    <span class="comment">#è¯·æ±‚å¤´è¦æœ‰X-Request-Idå±æ€§å¹¶ä¸”å€¼ä¸ºæ•´æ•°çš„æ­£åˆ™è¡¨è¾¾å¼</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">Header=X-Request-Id,</span> <span class="string">\d+</span></span><br><span class="line">    <span class="comment">#ä¸€ç»„åŒ¹é…çš„åŸŸååˆ—è¡¨</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">Host=**.example.com</span></span><br><span class="line">    <span class="comment">#è¯·æ±‚æ–¹å¼</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">Method=GET</span></span><br><span class="line">    <span class="comment"># è¦æœ‰å‚æ•°åusernameå¹¶ä¸”å€¼è¿˜è¦æ˜¯æ•´æ•°æ‰èƒ½è·¯ç”±</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">Query=username,</span> <span class="string">\d+</span></span><br></pre></td></tr></table></figure>
</blockquote>
<h3 id="Filterçš„ä½¿ç”¨"><a href="#Filterçš„ä½¿ç”¨" class="headerlink" title="Filterçš„ä½¿ç”¨"></a>Filterçš„ä½¿ç”¨</h3><h4 id="æ¦‚è¿°-5"><a href="#æ¦‚è¿°-5" class="headerlink" title="æ¦‚è¿°"></a>æ¦‚è¿°</h4><blockquote>
<p>è·¯ç”±è¿‡æ»¤å™¨å¯ç”¨äºä¿®æ”¹è¿›å…¥çš„HTTPè¯·æ±‚å’Œè¿”å›çš„HTTPå“åº”ï¼Œè·¯ç”±è¿‡æ»¤å™¨åªèƒ½æŒ‡å®šè·¯ç”±è¿›è¡Œä½¿ç”¨ã€‚</p>
<p>Spring Cloud Gateway å†…ç½®äº†å¤šç§è·¯ç”±è¿‡æ»¤å™¨ï¼Œå®ƒä»¬éƒ½ç”±GatewayFilterçš„å·¥å‚ç±»æ¥äº§ç”Ÿã€‚</p>
<p>SpringCloudGatewayçš„Filterï¼šå‰ç½®åç½®</p>
<p>å¸¸ç”¨çš„GatewayFilterï¼š<a href="https://cloud.spring.io/spring-cloud-static/spring-cloud-gateway/2.2.1.RELEASE/reference/html/#the-addrequestparameter-gatewayfilter-factory">https://cloud.spring.io/spring-cloud-static/spring-cloud-gateway/2.2.1.RELEASE/reference/html/#the-addrequestparameter-gatewayfilter-factory</a></p>
</blockquote>
<h4 id="è‡ªå®šä¹‰è¿‡æ»¤å™¨"><a href="#è‡ªå®šä¹‰è¿‡æ»¤å™¨" class="headerlink" title="è‡ªå®šä¹‰è¿‡æ»¤å™¨"></a>è‡ªå®šä¹‰è¿‡æ»¤å™¨</h4><p>ä½œç”¨ï¼šå…¨å±€æ—¥å¿—è®°å½•ï¼Œç»Ÿä¸€ç½‘å…³é‰´æƒ</p>
<p>ä¸»è¦æ­¥éª¤ï¼š<strong>implements GlobalFilter,Ordered</strong></p>
<p>ç¤ºä¾‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.springcloud.filter;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.cloud.gateway.filter.GatewayFilterChain;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cloud.gateway.filter.GlobalFilter;</span><br><span class="line"><span class="keyword">import</span> org.springframework.core.Ordered;</span><br><span class="line"><span class="keyword">import</span> org.springframework.http.HttpStatus;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.server.ServerWebExchange;</span><br><span class="line"><span class="keyword">import</span> reactor.core.publisher.Mono;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyLogGateWayFilter</span> <span class="keyword">implements</span> <span class="title class_">GlobalFilter</span>, Ordered &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Mono&lt;Void&gt; <span class="title function_">filter</span><span class="params">(ServerWebExchange exchange, GatewayFilterChain chain)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Time: &quot;</span> + <span class="keyword">new</span> <span class="title class_">Date</span>() + <span class="string">&quot; æ‰§è¡Œäº†è‡ªå®šä¹‰çš„å…¨å±€è¿‡æ»¤å™¨: MyLogGateWayFilter&quot;</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">uname</span> <span class="operator">=</span> exchange.getRequest().getQueryParams().getFirst(<span class="string">&quot;uname&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span> (uname == <span class="literal">null</span>) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;ç”¨æˆ·åä¸ºnullï¼Œæ— æ³•ç™»å½•&quot;</span>);</span><br><span class="line">            exchange.getResponse().setStatusCode(HttpStatus.NOT_ACCEPTABLE);</span><br><span class="line">            <span class="keyword">return</span> exchange.getResponse().setComplete();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> chain.filter(exchange);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getOrder</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æµ‹è¯•ï¼šè®¿é—® <a href="http://localhost:9527/payment/lb?uname=tom%EF%BC%8C%E5%A6%82%E6%9E%9C%E4%B8%8D%E5%8A%A0uname%E5%88%99%E6%97%A0%E6%B3%95%E6%AD%A3%E5%B8%B8%E8%B7%AF%E7%94%B1">http://localhost:9527/payment/lb?uname=tomï¼Œå¦‚æœä¸åŠ unameåˆ™æ— æ³•æ­£å¸¸è·¯ç”±</a></p>
<h1 id="SpringCloud-Config-åˆ†å¸ƒå¼é…ç½®ä¸­å¿ƒ"><a href="#SpringCloud-Config-åˆ†å¸ƒå¼é…ç½®ä¸­å¿ƒ" class="headerlink" title="SpringCloud Config åˆ†å¸ƒå¼é…ç½®ä¸­å¿ƒ"></a>SpringCloud Config åˆ†å¸ƒå¼é…ç½®ä¸­å¿ƒ</h1><h2 id="æ¦‚è¿°-6"><a href="#æ¦‚è¿°-6" class="headerlink" title="æ¦‚è¿°"></a>æ¦‚è¿°</h2><blockquote>
<p><strong>åˆ†å¸ƒå¼ç³»ç»Ÿé¢ä¸´çš„é…ç½®é—®é¢˜ï¼š</strong></p>
<p>å¾®æœåŠ¡æ„å‘³ç€è¦å°†å•ä½“åº”ç”¨ä¸­çš„ä¸šåŠ¡æ‹†åˆ†æˆä¸€ä¸ªä¸ªå­æœåŠ¡ï¼Œæ¯ä¸ªæœåŠ¡çš„ç²’åº¦ç›¸å¯¹è¾ƒå°ï¼Œå› æ­¤ç³»ç»Ÿä¸­ä¼šå‡ºç°å¤§é‡çš„æœåŠ¡ã€‚ç”±äºæ¯ä¸ªæœåŠ¡éƒ½éœ€è¦å¿…è¦çš„é…ç½®ä¿¡æ¯æ‰èƒ½è¿è¡Œï¼Œæ‰€ä»¥ä¸€å¥—é›†ä¸­å¼çš„ã€åŠ¨æ€çš„é…ç½®ç®¡ç†è®¾æ–½æ˜¯å¿…ä¸å¯å°‘çš„ã€‚SpringCloudæä¾›äº†ConfigServeræ¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬æ¯ä¸€ä¸ªå¾®æœåŠ¡è‡ªå·±å¸¦ç€ä¸€ä¸ªapplication.ymlã€‚</p>
</blockquote>
<blockquote>
<p><strong>å®šä¹‰ï¼š</strong></p>
<p><img src="/2023/02/28/SpringCloud/Java\Document\SpringCloud\images\image-20221228134954874.png" alt="image-20221228134954874"></p>
<ol>
<li><p>SpringCloud Configä¸ºå¾®æœåŠ¡æ¶æ„ä¸­çš„å¾®æœåŠ¡æä¾›é›†ä¸­åŒ–çš„å¤–éƒ¨é…ç½®æ”¯æŒï¼Œé…ç½®æœåŠ¡å™¨ä¸ºå„ä¸ªä¸åŒå¾®æœåŠ¡åº”ç”¨çš„æ‰€æœ‰ç¯å¢ƒæä¾›äº†ä¸€ä¸ªä¸­å¿ƒåŒ–çš„å¤–éƒ¨é…ç½®ã€‚</p>
</li>
<li><p>SpringCloud Configåˆ†ä¸ºæœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯ä¸¤éƒ¨åˆ†ã€‚</p>
<p> ï¼ˆ1ï¼‰æœåŠ¡ç«¯ä¹Ÿç§°ä¸ºåˆ†å¸ƒå¼é…ç½®ä¸­å¿ƒï¼Œå®ƒæ˜¯ä¸€ä¸ªç‹¬ç«‹çš„å¾®æœåŠ¡åº”ç”¨ï¼Œç”¨æ¥è¿æ¥é…ç½®æœåŠ¡å™¨å¹¶ä¸ºå®¢æˆ·ç«¯æä¾›è·å–é…ç½®ä¿¡æ¯ï¼ŒåŠ å¯†&#x2F;è§£å¯†ä¿¡æ¯ç­‰è®¿é—®æ¥å£ã€‚</p>
<p> ï¼ˆ2ï¼‰å®¢æˆ·ç«¯åˆ™æ˜¯é€šè¿‡æŒ‡å®šçš„é…ç½®ä¸­å¿ƒæ¥ç®¡ç†åº”ç”¨èµ„æºï¼Œä»¥åŠä¸ä¸šåŠ¡ç›¸å…³çš„é…ç½®å†…å®¹ï¼Œå¹¶åœ¨å¯åŠ¨çš„æ—¶å€™ä»é…ç½®ä¸­å¿ƒè·å–å’ŒåŠ è½½é…ç½®ä¿¡æ¯é…ç½®æœåŠ¡å™¨é»˜è®¤é‡‡ç”¨ git æ¥å­˜å‚¨é…ç½®ä¿¡æ¯ï¼Œè¿™æ ·å°±æœ‰åŠ©äºå¯¹ç¯å¢ƒé…ç½®è¿›è¡Œç‰ˆæœ¬ç®¡ç†ï¼Œå¹¶ä¸”å¯ä»¥é€šè¿‡gitå®¢æˆ·ç«¯å·¥å…·æ¥æ–¹ä¾¿çš„ç®¡ç†å’Œè®¿é—®é…ç½®å†…å®¹ã€‚</p>
</li>
</ol>
</blockquote>
<h2 id="ä½œç”¨-2"><a href="#ä½œç”¨-2" class="headerlink" title="ä½œç”¨"></a>ä½œç”¨</h2><blockquote>
<ol>
<li>é›†ä¸­ç®¡ç†é…ç½®æ–‡ä»¶</li>
<li>ä¸åŒç¯å¢ƒä¸åŒé…ç½®ï¼ŒåŠ¨æ€åŒ–çš„é…ç½®æ›´æ–°ï¼Œåˆ†ç¯å¢ƒéƒ¨ç½²æ¯”å¦‚ dev&#x2F;test&#x2F;prod&#x2F;beta&#x2F;release</li>
<li>è¿è¡ŒæœŸé—´åŠ¨æ€è°ƒæ•´é…ç½®ï¼Œä¸å†éœ€è¦åœ¨æ¯ä¸ªæœåŠ¡éƒ¨ç½²çš„æœºå™¨ä¸Šç¼–å†™é…ç½®æ–‡ä»¶ï¼ŒæœåŠ¡ä¼šå‘é…ç½®ä¸­å¿ƒç»Ÿä¸€æ‹‰å–é…ç½®è‡ªå·±çš„ä¿¡æ¯</li>
<li>å½“é…ç½®å‘ç”Ÿå˜åŠ¨æ—¶ï¼ŒæœåŠ¡ä¸éœ€è¦é‡å¯å³å¯æ„ŸçŸ¥åˆ°é…ç½®çš„å˜åŒ–å¹¶åº”ç”¨æ–°çš„é…ç½®</li>
<li>å°†é…ç½®ä¿¡æ¯ä»¥RESTæ¥å£çš„å½¢å¼æš´éœ²</li>
</ol>
</blockquote>
<p><strong>è¯´æ˜ï¼šç”±äºSpringCloud Configé»˜è®¤ä½¿ç”¨Gitæ¥å­˜å‚¨é…ç½®æ–‡ä»¶(ä¹Ÿæœ‰å…¶å®ƒæ–¹å¼,æ¯”å¦‚æ”¯æŒSVNå’Œæœ¬åœ°æ–‡ä»¶)ï¼Œä½†æœ€æ¨èçš„è¿˜æ˜¯Gitï¼Œè€Œä¸”ä½¿ç”¨çš„æ˜¯http&#x2F;httpsè®¿é—®çš„å½¢å¼ã€‚</strong></p>
<p>æ–‡æ¡£ï¼š<a href="https://cloud.spring.io/spring-cloud-static/spring-cloud-config/2.2.1.RELEASE/reference/html/">https://cloud.spring.io/spring-cloud-static/spring-cloud-config/2.2.1.RELEASE/reference/html/</a></p>
<h2 id="ConfigæœåŠ¡ç«¯é…ç½®ä¸æµ‹è¯•"><a href="#ConfigæœåŠ¡ç«¯é…ç½®ä¸æµ‹è¯•" class="headerlink" title="ConfigæœåŠ¡ç«¯é…ç½®ä¸æµ‹è¯•"></a>ConfigæœåŠ¡ç«¯é…ç½®ä¸æµ‹è¯•</h2><blockquote>
<p>ä¸»è¦æ­¥éª¤ï¼š</p>
<ol>
<li><p>åœ¨githubæ–°å»ºä»“åº“ springcloud-configï¼Œä¿å­˜é…ç½®æ–‡ä»¶ ï¼Œæ¨¡æ‹Ÿå…¬å…±é…ç½®</p>
<p> config-dev.yml</p>
 <figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="attr">config:</span></span><br><span class="line">  <span class="attr">info:</span> <span class="string">master</span> <span class="string">branch,</span> <span class="string">springcloud-config/config-dev.yml,</span> <span class="string">version</span> <span class="string">=</span> <span class="number">1</span></span><br></pre></td></tr></table></figure>

<p> config-test.yml</p>
 <figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="attr">config:</span></span><br><span class="line">  <span class="attr">info:</span> <span class="string">master</span> <span class="string">branch,</span> <span class="string">springcloud-config/config-test.yml,</span> <span class="string">version</span> <span class="string">=</span> <span class="number">1</span></span><br></pre></td></tr></table></figure>

<p> config-prod.yml</p>
 <figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="attr">config:</span></span><br><span class="line">  <span class="attr">info:</span> <span class="string">master</span> <span class="string">branch,</span> <span class="string">springcloud-config/config-prod.yml,</span> <span class="string">version</span> <span class="string">=</span> <span class="number">1</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>æ–°å»ºæ¨¡å— cloud-config-center-3344 ä½œä¸ºSpringCloudçš„é…ç½®ä¸­å¿ƒæ¨¡å—</p>
<p> å¼•å…¥ä¾èµ–ï¼š</p>
 <figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-config-server<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-netflix-eureka-client<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-actuator<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-devtools<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>runtime<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p> ymlé…ç½®ï¼š</p>
 <figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">3344</span></span><br><span class="line"></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">cloud-config-center</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">config:</span></span><br><span class="line">      <span class="attr">server:</span></span><br><span class="line">        <span class="attr">git:</span></span><br><span class="line">          <span class="comment">#ä½¿ç”¨httpsä¸æŠ¥é”™</span></span><br><span class="line">          <span class="comment">#uri: git@gitee.com:mineting/springcloud-config.git</span></span><br><span class="line">          <span class="attr">uri:</span> <span class="string">https://gitee.com/mineting/springcloud-config.git</span></span><br><span class="line">          <span class="attr">username:</span> <span class="number">18220549581</span></span><br><span class="line">          <span class="attr">password:</span> <span class="string">169683liufei</span></span><br><span class="line">          <span class="comment">#æœç´¢ç›®å½•</span></span><br><span class="line">          <span class="attr">search-paths:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">springcloud-config</span></span><br><span class="line">      <span class="comment">#åˆ†æ”¯</span></span><br><span class="line">      <span class="attr">label:</span> <span class="string">master</span></span><br><span class="line"></span><br><span class="line"><span class="attr">eureka:</span></span><br><span class="line">  <span class="attr">client:</span></span><br><span class="line">    <span class="attr">service-url:</span></span><br><span class="line">      <span class="attr">defaultZone:</span> <span class="string">http://localhost:7001/eureka</span></span><br></pre></td></tr></table></figure>

<p> å¯åŠ¨ç±»ï¼š</p>
 <figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@EnableConfigServer</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ConfigCenterMain3344</span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        SpringApplication.run(ConfigCenterMain3344.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>æµ‹è¯•ï¼šé€šè¿‡Configå¾®æœåŠ¡æ˜¯å¦å¯ä»¥ä»GitHubä¸Šè·å–é…ç½®å†…å®¹</p>
<p> è®¿é—®ï¼š<a href="http://config-3344.com:3344/master/config-dev.yml">http://config-3344.com:3344/master/config-dev.yml</a></p>
<p> æ­¤æ—¶SpringCloud Configå·²ç»é€šè¿‡GitHubè·å–é…ç½®ä¿¡æ¯ã€‚</p>
</li>
</ol>
</blockquote>
<h2 id="é…ç½®è¯»å–è§„åˆ™"><a href="#é…ç½®è¯»å–è§„åˆ™" class="headerlink" title="é…ç½®è¯»å–è§„åˆ™"></a>é…ç½®è¯»å–è§„åˆ™</h2><ol>
<li><p>æ ¹æ®åˆ†æ”¯ï¼š**&#x2F;{label}&#x2F;{application}-{profile}.yml**</p>
<p> masteråˆ†æ”¯ï¼š<a href="http://config-3344.com:3344/master/config-dev.yml">http://config-3344.com:3344/master/config-dev.yml</a></p>
<p> devåˆ†æ”¯ï¼š<a href="http://config-3344.com:3344/dev/config-dev.yml">http://config-3344.com:3344/dev/config-dev.yml</a></p>
</li>
<li><p>ä¸å¸¦åˆ†æ”¯ï¼Œé»˜è®¤ä½¿ç”¨é…ç½®æ–‡ä»¶çš„labelï¼Œ**&#x2F;{application}-{profile}.yml**</p>
<p> <a href="http://config-3344.com:3344/config-dev.yml">http://config-3344.com:3344/config-dev.yml</a></p>
</li>
<li><p>é¡ºåºä¸åŒï¼Œ&#x2F;{application}&#x2F;{profile}[&#x2F;{label}]</p>
<p> <a href="http://config-3344.com:3344/config/dev/master">http://config-3344.com:3344/config/dev/master</a></p>
<p> <a href="http://config-3344.com:3344/config/test/dev">http://config-3344.com:3344/config/test/dev</a></p>
</li>
</ol>
<h2 id="Configå®¢æˆ·ç«¯é…ç½®ä¸æµ‹è¯•"><a href="#Configå®¢æˆ·ç«¯é…ç½®ä¸æµ‹è¯•" class="headerlink" title="Configå®¢æˆ·ç«¯é…ç½®ä¸æµ‹è¯•"></a>Configå®¢æˆ·ç«¯é…ç½®ä¸æµ‹è¯•</h2><ol>
<li><p>æ–°å»ºæ¨¡å— cloud-config-client-3355</p>
</li>
<li><p>pom.xml</p>
 <figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-config-server<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-netflix-eureka-client<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-actuator<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-devtools<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>runtime<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>é…ç½®æ–‡ä»¶</p>
<blockquote>
<p>æ³¨æ„ï¼šã€æ­¤å¤„ä½¿ç”¨bootstrrap.ymlã€‘</p>
<p>applicaiton.ymlæ˜¯ç”¨æˆ·çº§çš„èµ„æºé…ç½®é¡¹ï¼Œbootstrap.ymlæ˜¯ç³»ç»Ÿçº§çš„ï¼Œä¼˜å…ˆçº§æ›´åŠ é«˜ã€‚</p>
<p>Spring Cloudä¼šåˆ›å»ºä¸€ä¸ªâ€œBootstrap Contextâ€ï¼Œä½œä¸ºSpringåº”ç”¨çš„<code>Application Context</code>çš„çˆ¶ä¸Šä¸‹æ–‡ã€‚åˆå§‹åŒ–çš„æ—¶å€™ï¼Œ<code>Bootstrap Context</code>è´Ÿè´£ä»å¤–éƒ¨æºåŠ è½½é…ç½®å±æ€§å¹¶è§£æé…ç½®ã€‚è¿™ä¸¤ä¸ªä¸Šä¸‹æ–‡å…±äº«ä¸€ä¸ªä»å¤–éƒ¨è·å–çš„<code>Environment</code>ã€‚</p>
<p><code>Bootstrap</code>å±æ€§æœ‰é«˜ä¼˜å…ˆçº§ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œå®ƒä»¬ä¸ä¼šè¢«æœ¬åœ°é…ç½®è¦†ç›–ã€‚ <code>Bootstrap context</code>å’Œ<code>Application Context</code>æœ‰ç€ä¸åŒçš„çº¦å®šï¼Œæ‰€ä»¥æ–°å¢äº†ä¸€ä¸ª<code>bootstrap.yml</code>æ–‡ä»¶ï¼Œä¿è¯<code>Bootstrap Context</code>å’Œ<code>Application Context</code>é…ç½®çš„åˆ†ç¦»ã€‚</p>
<p>è¦å°†Clientæ¨¡å—ä¸‹çš„application.ymlæ–‡ä»¶æ”¹ä¸ºbootstrap.yml,è¿™æ˜¯å¾ˆå…³é”®çš„ï¼Œå› ä¸ºbootstrap.ymlæ˜¯æ¯”application.ymlå…ˆåŠ è½½çš„ã€‚bootstrap.ymlä¼˜å…ˆçº§é«˜äºapplication.ymlã€‚</p>
<p> bootstrap.ymlï¼š</p>
<figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">3355</span></span><br><span class="line"></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">config-client</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="comment">#Configå®¢æˆ·ç«¯é…ç½®ï¼šhttp://config-3344.com:3344/master/config-dev.yml</span></span><br><span class="line">    <span class="attr">config:</span></span><br><span class="line">      <span class="attr">label:</span> <span class="string">master</span></span><br><span class="line">      <span class="comment">#é…ç½®æ–‡ä»¶åç§°</span></span><br><span class="line">      <span class="attr">name:</span> <span class="string">config</span></span><br><span class="line">      <span class="comment">#&#123;profile&#125;åç§°</span></span><br><span class="line">      <span class="attr">profile:</span> <span class="string">dev</span></span><br><span class="line">      <span class="comment">#é…ç½®ä¸­å¿ƒåœ°å€</span></span><br><span class="line">      <span class="attr">uri:</span> <span class="string">http://config-3344.com:3344</span></span><br><span class="line"></span><br><span class="line"><span class="attr">eureka:</span></span><br><span class="line">  <span class="attr">client:</span></span><br><span class="line">    <span class="attr">service-url:</span></span><br><span class="line">      <span class="attr">defaultZone:</span> <span class="string">http://eureka7001.com:7001/eureka,http://eureka7002.com:7002/eureka</span></span><br></pre></td></tr></table></figure>
</blockquote>
</li>
<li><p>å¯åŠ¨ç±»</p>
 <figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@EnableEurekaClient</span></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ConfigClientMain3355</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        SpringApplication.run(ConfigClientMain3355.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>Controller</p>
 <figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ConfigClientController</span> &#123;</span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;config.info&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String configInfo;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/configInfo&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getConfigInfo</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> configInfo;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>æµ‹è¯•ï¼š<a href="http://localhost:3355/configInfo">http://localhost:3355/configInfo</a></p>
</li>
</ol>
<blockquote>
<p>æ³¨æ„ï¼šæ­¤æ—¶å­˜åœ¨çš„é—®é¢˜ï¼šåŠ¨æ€åˆ·æ–°é…ç½®</p>
<ol>
<li>Linuxè¿ç»´ä¿®æ”¹GitHubä¸Šçš„é…ç½®æ–‡ä»¶å†…å®¹åšè°ƒæ•´</li>
<li>åˆ·æ–°3344ï¼Œå‘ç°ConfigServeré…ç½®ä¸­å¿ƒç«‹åˆ»å“åº”</li>
<li>åˆ·æ–°3355ï¼Œå‘ç°ConfigClientå®¢æˆ·ç«¯æ²¡æœ‰ä»»ä½•å“åº”</li>
<li>3355æ²¡æœ‰å˜åŒ–é™¤éè‡ªå·±é‡å¯æˆ–è€…é‡æ–°åŠ è½½<strong>ã€é—®é¢˜ã€‘</strong></li>
</ol>
</blockquote>
<h2 id="Configå®¢æˆ·ç«¯ä¹‹åŠ¨æ€åˆ·æ–°"><a href="#Configå®¢æˆ·ç«¯ä¹‹åŠ¨æ€åˆ·æ–°" class="headerlink" title="Configå®¢æˆ·ç«¯ä¹‹åŠ¨æ€åˆ·æ–°"></a>Configå®¢æˆ·ç«¯ä¹‹åŠ¨æ€åˆ·æ–°</h2><p>ä¸»è¦è§£å†³ï¼šæ¯æ¬¡æ›´æ–°é…ç½®éƒ½è¦é‡å¯å®¢æˆ·ç«¯å¾®æœåŠ¡3355</p>
<p>ä¸»è¦ä¿®æ”¹ï¼š</p>
<blockquote>
<ol>
<li><p>å¼•å…¥ä¾èµ–</p>
 <figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-actuator<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>ä¿®æ”¹ymlé…ç½®ï¼Œæš´éœ²æ–­ç‚¹</p>
 <figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="comment"># æš´éœ²ç›‘æ§ç«¯ç‚¹</span></span><br><span class="line"><span class="attr">management:</span></span><br><span class="line">  <span class="attr">endpoints:</span></span><br><span class="line">    <span class="attr">web:</span></span><br><span class="line">      <span class="attr">exposure:</span></span><br><span class="line">        <span class="attr">include:</span> <span class="string">&quot;*&quot;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>ä¿®æ”¹Controllerï¼Œæ·»åŠ  @RefreshScope</p>
 <figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="comment">//åŠ¨æ€åˆ·æ–°é…ç½®</span></span><br><span class="line"><span class="meta">@RefreshScope</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ConfigClientController</span> &#123;</span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;config.info&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String configInfo;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/configInfo&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getConfigInfo</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> configInfo;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>åŒæ—¶éœ€è¦è¿ç»´äººå‘˜å‘é€Postè¯·æ±‚åˆ·æ–°3355</p>
<p> curl -X POST â€œ<a href="http://localhost:3355/actuator/refresh">http://localhost:3355/actuator/refresh</a>â€œ</p>
</li>
<li><p>æµ‹è¯•ï¼Œæ­¤æ—¶è®¿é—® <a href="http://localhost:3355/configInfo">http://localhost:3355/configInfo</a> å³å¯æ­£å¸¸åˆ·æ–°</p>
</li>
</ol>
</blockquote>
<p><strong>æ³¨æ„ï¼šæ­¤æ—¶è™½ç„¶é¿å…äº†é‡æ–°æœåŠ¡åˆ·æ–°é…ç½®ï¼Œä½†æ˜¯ä»ç„¶å­˜åœ¨é—®é¢˜ï¼š</strong></p>
<p><strong>æ¯”å¦‚ï¼Œå¦‚æœæœ‰å¤šä¸ªé…ç½®ï¼Œæ¯ä¸ªå¾®æœåŠ¡éƒ½è¦æ‰§è¡Œä¸€æ¬¡postè¯·æ±‚ï¼Œä¾ç„¶éœ€è¦æ‰‹åŠ¨åˆ·æ–°</strong></p>
<h1 id="SpringCloud-Bus-æ¶ˆæ¯æ€»çº¿"><a href="#SpringCloud-Bus-æ¶ˆæ¯æ€»çº¿" class="headerlink" title="SpringCloud Bus æ¶ˆæ¯æ€»çº¿"></a>SpringCloud Bus æ¶ˆæ¯æ€»çº¿</h1><h2 id="æ¦‚è¿°-7"><a href="#æ¦‚è¿°-7" class="headerlink" title="æ¦‚è¿°"></a>æ¦‚è¿°</h2><blockquote>
<p>Spring Cloud Bus é…åˆ Spring Cloud Config ä½¿ç”¨å¯ä»¥å®ç°é…ç½®çš„åŠ¨æ€åˆ·æ–°ã€‚</p>
<p><img src="/2023/02/28/SpringCloud/Java\Document\SpringCloud\images\image-20221230125359725.png" alt="image-20221230125359725"></p>
<p>Spring Cloud Busæ˜¯ç”¨æ¥å°†åˆ†å¸ƒå¼ç³»ç»Ÿçš„èŠ‚ç‚¹ä¸è½»é‡çº§æ¶ˆæ¯ç³»ç»Ÿé“¾æ¥èµ·æ¥çš„æ¡†æ¶ï¼Œå®ƒæ•´åˆäº†Javaçš„äº‹ä»¶å¤„ç†æœºåˆ¶å’Œæ¶ˆæ¯ä¸­é—´ä»¶çš„åŠŸèƒ½ã€‚Spring Clud Busç›®å‰æ”¯æŒRabbitMQå’ŒKafkaã€‚</p>
</blockquote>
<h2 id="ä½œç”¨-3"><a href="#ä½œç”¨-3" class="headerlink" title="ä½œç”¨"></a>ä½œç”¨</h2><blockquote>
<p>Spring Cloud Busèƒ½ç®¡ç†å’Œä¼ æ’­åˆ†å¸ƒå¼ç³»ç»Ÿé—´çš„æ¶ˆæ¯ï¼Œå°±åƒä¸€ä¸ªåˆ†å¸ƒå¼æ‰§è¡Œå™¨ï¼Œå¯ç”¨äºå¹¿æ’­çŠ¶æ€æ›´æ”¹ã€äº‹ä»¶æ¨é€ç­‰ï¼Œä¹Ÿå¯ä»¥å½“ä½œå¾®æœåŠ¡é—´çš„é€šä¿¡é€šé“ã€‚</p>
<img src="/2023/02/28/SpringCloud/Java\Document\SpringCloud\images\image-20221230125547174.png" alt="image-20221230125547174" style="zoom:80%;">
</blockquote>
<h2 id="æ€»çº¿"><a href="#æ€»çº¿" class="headerlink" title="æ€»çº¿"></a>æ€»çº¿</h2><blockquote>
<p>â€‹		åœ¨å¾®æœåŠ¡æ¶æ„çš„ç³»ç»Ÿä¸­ï¼Œé€šå¸¸ä¼šä½¿ç”¨è½»é‡çº§çš„æ¶ˆæ¯ä»£ç†æ¥æ„å»ºä¸€ä¸ªå…±ç”¨çš„æ¶ˆæ¯ä¸»é¢˜ï¼Œå¹¶è®©ç³»ç»Ÿä¸­æ‰€æœ‰å¾®æœåŠ¡å®ä¾‹éƒ½è¿æ¥ä¸Šæ¥ã€‚ç”±äºè¯¥ä¸»é¢˜ä¸­äº§ç”Ÿçš„æ¶ˆæ¯ä¼šè¢«æ‰€æœ‰å®ä¾‹ç›‘å¬å’Œæ¶ˆè´¹ï¼Œæ‰€ä»¥ç§°å®ƒä¸ºæ¶ˆæ¯æ€»çº¿ã€‚åœ¨æ€»çº¿ä¸Šçš„å„ä¸ªå®ä¾‹ï¼Œéƒ½å¯ä»¥æ–¹ä¾¿åœ°å¹¿æ’­ä¸€äº›éœ€è¦è®©å…¶ä»–è¿æ¥åœ¨è¯¥ä¸»é¢˜ä¸Šçš„å®ä¾‹éƒ½çŸ¥é“çš„æ¶ˆæ¯ã€‚</p>
<p>åŸºæœ¬åŸç†<br>ConfigClientå®ä¾‹éƒ½ç›‘å¬MQä¸­åŒä¸€ä¸ªtopicï¼ˆé»˜è®¤æ˜¯springCloudBusï¼‰ã€‚å½“ä¸€ä¸ªæœåŠ¡åˆ·æ–°æ•°æ®çš„æ—¶å€™ï¼Œå®ƒä¼šæŠŠè¿™ä¸ªä¿¡æ¯æ”¾å…¥åˆ°Topicä¸­ï¼Œè¿™æ ·å…¶å®ƒç›‘å¬åŒä¸€Topicçš„æœåŠ¡å°±èƒ½å¾—åˆ°é€šçŸ¥ï¼Œç„¶åå»æ›´æ–°è‡ªèº«çš„é…ç½®ã€‚</p>
</blockquote>
<h2 id="è®¾è®¡æ€æƒ³"><a href="#è®¾è®¡æ€æƒ³" class="headerlink" title="è®¾è®¡æ€æƒ³"></a>è®¾è®¡æ€æƒ³</h2><blockquote>
<p>æ–¹å¼ä¸€ï¼šåˆ©ç”¨æ¶ˆæ¯æ€»çº¿è§¦å‘ä¸€ä¸ªå®¢æˆ·ç«¯&#x2F;bus&#x2F;refresh,è€Œåˆ·æ–°æ‰€æœ‰å®¢æˆ·ç«¯çš„é…ç½®</p>
<img src="/2023/02/28/SpringCloud/Java\Document\SpringCloud\images\image-20221230131107872.png" alt="image-20221230131107872" style="zoom:80%;">

<p>æ–¹å¼äºŒï¼šåˆ©ç”¨æ¶ˆæ¯æ€»çº¿è§¦å‘ä¸€ä¸ªæœåŠ¡ç«¯ConfigServerçš„&#x2F;bus&#x2F;refreshç«¯ç‚¹ï¼Œè€Œåˆ·æ–°æ‰€æœ‰å®¢æˆ·ç«¯çš„é…ç½®</p>
<img src="/2023/02/28/SpringCloud/Java\Document\SpringCloud\images\image-20221230131141545.png" alt="image-20221230131141545" style="zoom:80%;">

<p>æ–¹å¼ä¸€çš„ç¼ºç‚¹ï¼š</p>
<ol>
<li>æ‰“ç ´äº†å¾®æœåŠ¡çš„èŒè´£å•ä¸€æ€§ï¼Œå› ä¸ºå¾®æœåŠ¡æœ¬èº«æ˜¯ä¸šåŠ¡æ¨¡å—ï¼Œå®ƒæœ¬ä¸åº”è¯¥æ‰¿æ‹…é…ç½®åˆ·æ–°çš„èŒè´£ã€‚</li>
<li>ç ´åäº†å¾®æœåŠ¡å„èŠ‚ç‚¹çš„å¯¹ç­‰æ€§ã€‚</li>
<li>æœ‰ä¸€å®šçš„å±€é™æ€§ã€‚ä¾‹å¦‚ï¼Œå¾®æœåŠ¡åœ¨è¿ç§»æ—¶ï¼Œå®ƒçš„ç½‘ç»œåœ°å€å¸¸å¸¸ä¼šå‘ç”Ÿå˜åŒ–ï¼Œæ­¤æ—¶å¦‚æœæƒ³è¦åšåˆ°è‡ªåŠ¨åˆ·æ–°ï¼Œé‚£å°±ä¼šå¢åŠ æ›´å¤šçš„ä¿®æ”¹ã€‚</li>
</ol>
</blockquote>
<h2 id="RabbitMQç¯å¢ƒé…ç½®"><a href="#RabbitMQç¯å¢ƒé…ç½®" class="headerlink" title="RabbitMQç¯å¢ƒé…ç½®"></a>RabbitMQç¯å¢ƒé…ç½®</h2><blockquote>
<ol>
<li><p>å®‰è£…Erlangï¼Œä¸‹è½½åœ°å€ï¼š<a href="http://erlang.org/download/otp_win64_21.3.exe">http://erlang.org/download/otp_win64_21.3.exe</a>	</p>
</li>
<li><p>å®‰è£…RabbitMQï¼Œä¸‹è½½åœ°å€ï¼š<a href="https://github.com/rabbitmq/rabbitmq-server/releases/tag/v3.11.5">https://github.com/rabbitmq/rabbitmq-server/releases/tag/v3.11.5</a></p>
</li>
<li><p>å¯ç”¨å¯è§†åŒ–æ’ä»¶ç®¡ç†åŠŸèƒ½</p>
<p> è¿›å…¥ rabbitmq_server-3.7.14\sbinç›®å½•ï¼Œæ‰§è¡Œ rabbitmq-plugins enable rabbitmq_management</p>
</li>
<li><p>å¯åŠ¨ ï¼Œè®¿é—® <a href="http://localhost:15672/%EF%BC%8C%E5%88%9D%E5%A7%8B%E7%94%A8%E6%88%B7%E5%AF%86%E7%A0%81%EF%BC%9Aguest/guest">http://localhost:15672/ï¼Œåˆå§‹ç”¨æˆ·å¯†ç ï¼šguest/guest</a></p>
</li>
</ol>
</blockquote>
<h2 id="SpringCloud-BusåŠ¨æ€åˆ·æ–°å…¨å±€å¹¿æ’­ç¤ºä¾‹"><a href="#SpringCloud-BusåŠ¨æ€åˆ·æ–°å…¨å±€å¹¿æ’­ç¤ºä¾‹" class="headerlink" title="SpringCloud BusåŠ¨æ€åˆ·æ–°å…¨å±€å¹¿æ’­ç¤ºä¾‹"></a>SpringCloud BusåŠ¨æ€åˆ·æ–°å…¨å±€å¹¿æ’­ç¤ºä¾‹</h2><p>ä¸ºæ¼”ç¤ºå¹¿æ’­æ•ˆæœï¼Œä»¥3355ä¸ºæ¨¡æ¿å†å¢åŠ ä¸€ä¸ª3366</p>
<ol>
<li>ä¿®æ”¹Controllerï¼š</li>
</ol>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RefreshScope</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ConfigClientController</span> &#123;</span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;server.port&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String serverPort;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;config.info&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String configInfo;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/configInfo&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getConfigInfo</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;configInfo: &quot;</span> + configInfo + <span class="string">&quot;, serverPort: &quot;</span> + serverPort;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="2">
<li><p><strong>ç»™cloud-config-center-3344 é…ç½®ä¸­å¿ƒæœåŠ¡ç«¯æ·»åŠ æ¶ˆæ¯æ€»çº¿æ”¯æŒ</strong></p>
<p> pom.xml</p>
 <figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!--æ·»åŠ æ¶ˆæ¯æ€»çº¿RabbitMQæ”¯æŒ--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-bus-amqp<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-actuator<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p> ymlï¼š</p>
 <figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">3344</span></span><br><span class="line"></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">cloud-config-center</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">config:</span></span><br><span class="line">      <span class="attr">server:</span></span><br><span class="line">        <span class="attr">git:</span></span><br><span class="line">          <span class="comment">#ä½¿ç”¨httpsä¸æŠ¥é”™</span></span><br><span class="line">          <span class="comment">#uri: git@gitee.com:mineting/springcloud-config.git</span></span><br><span class="line">          <span class="attr">uri:</span> <span class="string">https://gitee.com/mineting/springcloud-config.git</span></span><br><span class="line">          <span class="attr">username:</span> <span class="number">18220549581</span></span><br><span class="line">          <span class="attr">password:</span> <span class="string">169683liufei</span></span><br><span class="line">          <span class="comment">#æœç´¢ç›®å½•</span></span><br><span class="line">          <span class="attr">search-paths:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">springcloud-config</span></span><br><span class="line">      <span class="comment">#åˆ†æ”¯</span></span><br><span class="line">      <span class="attr">label:</span> <span class="string">master</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#rabbitmqç›¸å…³é…ç½®</span></span><br><span class="line">  <span class="attr">rabbitmq:</span></span><br><span class="line">    <span class="attr">host:</span> <span class="string">localhost</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">5672</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">guest</span></span><br><span class="line">    <span class="attr">password:</span> <span class="string">guest</span></span><br><span class="line"></span><br><span class="line"><span class="attr">eureka:</span></span><br><span class="line">  <span class="attr">client:</span></span><br><span class="line">    <span class="attr">service-url:</span></span><br><span class="line">      <span class="attr">defaultZone:</span> <span class="string">http://localhost:7001/eureka</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#rabbitmqç›¸å…³é…ç½®,æš´éœ²busåˆ·æ–°é…ç½®çš„ç«¯ç‚¹</span></span><br><span class="line"><span class="attr">management:</span></span><br><span class="line">  <span class="attr">endpoints:</span> <span class="comment">#æš´éœ²busåˆ·æ–°é…ç½®çš„ç«¯ç‚¹</span></span><br><span class="line">    <span class="attr">web:</span></span><br><span class="line">      <span class="attr">exposure:</span></span><br><span class="line">        <span class="attr">include:</span> <span class="string">&#x27;bus-refresh&#x27;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>ç»™cloud-config-client-3355å’Œ3366å®¢æˆ·ç«¯æ·»åŠ æ¶ˆæ¯æ€»çº¿æ”¯æŒ</strong></p>
<p> pom.xml</p>
 <figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!--æ·»åŠ æ¶ˆæ¯æ€»çº¿RabbitMQæ”¯æŒ--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-bus-amqp<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-actuator<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p> yml</p>
 <figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">3355</span></span><br><span class="line"></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">config-client</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="comment">#Configå®¢æˆ·ç«¯é…ç½®ï¼šhttp://config-3344.com:3344/master/config-dev.yml</span></span><br><span class="line">    <span class="attr">config:</span></span><br><span class="line">      <span class="attr">label:</span> <span class="string">master</span></span><br><span class="line">      <span class="comment">#é…ç½®æ–‡ä»¶åç§°</span></span><br><span class="line">      <span class="attr">name:</span> <span class="string">config</span></span><br><span class="line">      <span class="comment">#&#123;profile&#125;åç§°</span></span><br><span class="line">      <span class="attr">profile:</span> <span class="string">dev</span></span><br><span class="line">      <span class="comment">#é…ç½®ä¸­å¿ƒåœ°å€</span></span><br><span class="line">      <span class="attr">uri:</span> <span class="string">http://config-3344.com:3344</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">#rabbitmqç›¸å…³é…ç½® 15672æ˜¯Webç®¡ç†ç•Œé¢çš„ç«¯å£ï¼›5672æ˜¯MQè®¿é—®çš„ç«¯å£</span></span><br><span class="line">  <span class="attr">rabbitmq:</span></span><br><span class="line">    <span class="attr">host:</span> <span class="string">localhost</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">5672</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">guest</span></span><br><span class="line">    <span class="attr">password:</span> <span class="string">guest</span></span><br><span class="line"></span><br><span class="line"><span class="attr">eureka:</span></span><br><span class="line">  <span class="attr">client:</span></span><br><span class="line">    <span class="attr">service-url:</span></span><br><span class="line">      <span class="attr">defaultZone:</span> <span class="string">http://eureka7001.com:7001/eureka,http://eureka7002.com:7002/eureka</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æš´éœ²ç›‘æ§ç«¯ç‚¹</span></span><br><span class="line"><span class="attr">management:</span></span><br><span class="line">  <span class="attr">endpoints:</span></span><br><span class="line">    <span class="attr">web:</span></span><br><span class="line">      <span class="attr">exposure:</span></span><br><span class="line">        <span class="attr">include:</span> <span class="string">&quot;*&quot;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>æµ‹è¯•</p>
<p> ä¿®æ”¹githubé…ç½®ï¼Œå‘é€POSTè¯·æ±‚ï¼šcurl -X POST â€œ<a href="http://localhost:3344/actuator/bus-refresh">http://localhost:3344/actuator/bus-refresh</a>â€œ</p>
<p> ç»“æœï¼šé…ç½®ä¸­å¿ƒå’Œå®¢æˆ·ç«¯æ•°æ®éƒ½å‘ç”Ÿå˜åŒ–</p>
<p> <a href="http://config-3344.com:3344/config-dev.yml">http://config-3344.com:3344/config-dev.yml</a></p>
<p> <a href="http://localhost:3355/configInfo">http://localhost:3355/configInfo</a></p>
<p> <a href="http://localhost:3366/configInfo">http://localhost:3366/configInfo</a></p>
</li>
<li><p>å®šç‚¹é€šçŸ¥</p>
<p> ä¸æƒ³å…¨éƒ¨é€šçŸ¥ï¼Œåªæƒ³å®šç‚¹é€šçŸ¥ï¼›åªé€šçŸ¥3355ï¼Œä¸é€šçŸ¥3366</p>
<blockquote>
<p><a href="http://localhost:é…ç½®ä¸­å¿ƒçš„ç«¯å£å·/actuator/bus-refresh/{destination}">http://localhost:é…ç½®ä¸­å¿ƒçš„ç«¯å£å·/actuator/bus-refresh/{destination}</a></p>
<p>&#x2F;bus&#x2F;refreshè¯·æ±‚ä¸å†å‘é€åˆ°å…·ä½“çš„æœåŠ¡å®ä¾‹ä¸Šï¼Œè€Œæ˜¯å‘ç»™config serverå¹¶é€šè¿‡destinationå‚æ•°ç±»æŒ‡å®šéœ€è¦æ›´æ–°é…ç½®çš„æœåŠ¡æˆ–å®ä¾‹ã€‚</p>
<p>ç¤ºä¾‹ï¼šcurl -X POST â€œ<a href="http://localhost:3344/actuator/bus-refresh/config-client:3355">http://localhost:3344/actuator/bus-refresh/config-client:3355</a>â€œ</p>
</blockquote>
</li>
<li><p>æ€»ç»“</p>
 <img src="/2023/02/28/SpringCloud/Java\Document\SpringCloud\images\image-20221230132726592.png" alt="image-20221230132726592" style="zoom:80%;"></li>
</ol>
<h1 id="SpringCloud-Stream-æ¶ˆæ¯é©±åŠ¨"><a href="#SpringCloud-Stream-æ¶ˆæ¯é©±åŠ¨" class="headerlink" title="SpringCloud Stream æ¶ˆæ¯é©±åŠ¨"></a>SpringCloud Stream æ¶ˆæ¯é©±åŠ¨</h1><h2 id="æ¶ˆæ¯é©±åŠ¨æ¦‚è¿°"><a href="#æ¶ˆæ¯é©±åŠ¨æ¦‚è¿°" class="headerlink" title="æ¶ˆæ¯é©±åŠ¨æ¦‚è¿°"></a>æ¶ˆæ¯é©±åŠ¨æ¦‚è¿°</h2><blockquote>
<p>æ–‡æ¡£ï¼š</p>
<p><a href="https://spring.io/projects/spring-cloud-stream#overview">https://spring.io/projects/spring-cloud-stream#overview</a></p>
<p><a href="https://cloud.spring.io/spring-cloud-static/spring-cloud-stream/3.0.1.RELEASE/reference/html/">https://cloud.spring.io/spring-cloud-static/spring-cloud-stream/3.0.1.RELEASE/reference/html/</a></p>
<p><a href="https://m.wang1314.com/doc/webapp/topic/20971999.html">https://m.wang1314.com/doc/webapp/topic/20971999.html</a></p>
<p>ä»€ä¹ˆæ˜¯SpringCloudStream<br>å®˜æ–¹å®šä¹‰ Spring Cloud Stream æ˜¯ä¸€ä¸ªæ„å»ºæ¶ˆæ¯é©±åŠ¨å¾®æœåŠ¡çš„æ¡†æ¶ã€‚</p>
<p>åº”ç”¨ç¨‹åºé€šè¿‡ inputs æˆ–è€… outputs æ¥ä¸ Spring Cloud Streamä¸­binderå¯¹è±¡äº¤äº’ã€‚<br>é€šè¿‡æˆ‘ä»¬é…ç½®æ¥binding(ç»‘å®š) ï¼Œè€Œ Spring Cloud Stream çš„ binderå¯¹è±¡è´Ÿè´£ä¸æ¶ˆæ¯ä¸­é—´ä»¶äº¤äº’ã€‚<br>æ‰€ä»¥ï¼Œæˆ‘ä»¬åªéœ€è¦ææ¸…æ¥šå¦‚ä½•ä¸ Spring Cloud Stream äº¤äº’å°±å¯ä»¥æ–¹ä¾¿ä½¿ç”¨æ¶ˆæ¯é©±åŠ¨çš„æ–¹å¼ã€‚</p>
<p>é€šè¿‡ä½¿ç”¨Spring Integrationæ¥è¿æ¥æ¶ˆæ¯ä»£ç†ä¸­é—´ä»¶ä»¥å®ç°æ¶ˆæ¯äº‹ä»¶é©±åŠ¨ã€‚<br>Spring Cloud Stream ä¸ºä¸€äº›ä¾›åº”å•†çš„æ¶ˆæ¯ä¸­é—´ä»¶äº§å“æä¾›äº†ä¸ªæ€§åŒ–çš„è‡ªåŠ¨åŒ–é…ç½®å®ç°ï¼Œå¼•ç”¨äº†å‘å¸ƒ-è®¢é˜…ã€æ¶ˆè´¹ç»„ã€åˆ†åŒºçš„ä¸‰ä¸ªæ ¸å¿ƒæ¦‚å¿µã€‚</p>
<p>Spring Cloud Streamæ˜¯ç”¨äºæ„å»ºä¸å…±äº«æ¶ˆæ¯ä¼ é€’ç³»ç»Ÿè¿æ¥çš„é«˜åº¦å¯ä¼¸ç¼©çš„äº‹ä»¶é©±åŠ¨å¾®æœåŠ¡æ¡†æ¶ï¼Œè¯¥æ¡†æ¶æä¾›äº†ä¸€ä¸ªçµæ´»çš„ç¼–ç¨‹æ¨¡å‹ï¼Œå®ƒå»ºç«‹åœ¨å·²ç»å»ºç«‹å’Œç†Ÿæ‚‰çš„Springç†Ÿè¯­å’Œæœ€ä½³å®è·µä¸Šï¼ŒåŒ…æ‹¬æ”¯æŒæŒä¹…åŒ–çš„å‘å¸ƒ&#x2F;è®¢é˜…ã€æ¶ˆè´¹ç»„ä»¥åŠæ¶ˆæ¯åˆ†åŒºè¿™ä¸‰ä¸ªæ ¸å¿ƒæ¦‚å¿µ</p>
<p>ç›®å‰ä»…æ”¯æŒRabbitMQã€Kafkaã€‚</p>
<p><strong>ç®€å•æ€»ç»“ï¼šå±è”½åº•å±‚æ¶ˆæ¯ä¸­é—´ä»¶çš„å·®å¼‚,é™ä½åˆ‡æ¢æˆæœ¬ï¼Œç»Ÿä¸€æ¶ˆæ¯çš„ç¼–ç¨‹æ¨¡å‹</strong></p>
</blockquote>
<h1 id="SpringCloud-Sleuth-åˆ†å¸ƒå¼è¯·æ±‚é“¾è·¯è·Ÿè¸ª"><a href="#SpringCloud-Sleuth-åˆ†å¸ƒå¼è¯·æ±‚é“¾è·¯è·Ÿè¸ª" class="headerlink" title="SpringCloud Sleuth åˆ†å¸ƒå¼è¯·æ±‚é“¾è·¯è·Ÿè¸ª"></a>SpringCloud Sleuth åˆ†å¸ƒå¼è¯·æ±‚é“¾è·¯è·Ÿè¸ª</h1><h1 id="SpringCloud-Alibaba-å…¥é—¨ç®€ä»‹"><a href="#SpringCloud-Alibaba-å…¥é—¨ç®€ä»‹" class="headerlink" title="SpringCloud Alibaba å…¥é—¨ç®€ä»‹"></a>SpringCloud Alibaba å…¥é—¨ç®€ä»‹</h1><blockquote>
<p><strong>ä¸ºä»€ä¹ˆä¼šå‡ºç°SpringCloud alibaba</strong></p>
<p>Spring Cloud Netflixé¡¹ç›®è¿›å…¥ç»´æŠ¤æ¨¡å¼ï¼šSpring Cloud Netflix Projects Entering Maintenance Mode</p>
<ol>
<li><p>å°†æ¨¡å—ç½®äºç»´æŠ¤æ¨¡å¼ï¼Œæ„å‘³ç€ Spring Cloud å›¢é˜Ÿå°†ä¸ä¼šå†å‘æ¨¡å—æ·»åŠ æ–°åŠŸèƒ½ã€‚<br> æˆ‘ä»¬å°†ä¿®å¤ block çº§åˆ«çš„ bug ä»¥åŠå®‰å…¨é—®é¢˜ï¼Œæˆ‘ä»¬ä¹Ÿä¼šè€ƒè™‘å¹¶å®¡æŸ¥ç¤¾åŒºçš„å°å‹ pull requestã€‚</p>
</li>
<li><p>Spring Cloud Netflix å°†ä¸å†å¼€å‘æ–°çš„ç»„ä»¶<br> æˆ‘ä»¬éƒ½çŸ¥é“Spring Cloud ç‰ˆæœ¬è¿­ä»£ç®—æ˜¯æ¯”è¾ƒå¿«çš„ï¼Œå› è€Œå‡ºç°äº†å¾ˆå¤šé‡å¤§ISSUEéƒ½è¿˜æ¥ä¸åŠFixå°±åˆæ¨å¦ä¸€ä¸ªReleaseäº†ã€‚è¿›å…¥ç»´æŠ¤æ¨¡å¼æ„æ€å°±æ˜¯ç›®å‰ä¸€ç›´ä»¥åä¸€æ®µæ—¶é—´Spring Cloud Netflixæä¾›çš„æœåŠ¡å’ŒåŠŸèƒ½å°±è¿™ä¹ˆå¤šäº†ï¼Œä¸åœ¨å¼€å‘æ–°çš„ç»„ä»¶å’ŒåŠŸèƒ½äº†ã€‚ä»¥åå°†ä»¥ç»´æŠ¤å’ŒMergeåˆ†æ”¯Full Requestä¸ºä¸»ã€‚</p>
<p> æ–°ç»„ä»¶åŠŸèƒ½å°†ä»¥å…¶ä»–æ›¿ä»£å¹³ä»£æ›¿çš„æ–¹å¼å®ç°ã€‚</p>
</li>
</ol>
<p><strong>SpringCloudAlibabaè¯´æ˜</strong></p>
<p>è¯ç”Ÿï¼š2018.10.31ï¼ŒSpring Cloud Alibaba æ­£å¼å…¥é©»äº† Spring Cloud å®˜æ–¹å­µåŒ–å™¨ï¼Œå¹¶åœ¨ Maven ä¸­å¤®åº“å‘å¸ƒäº†ç¬¬ä¸€ä¸ªç‰ˆæœ¬ã€‚</p>
<p><strong>Spring Cloud Alibaba è‡´åŠ›äºæä¾›å¾®æœåŠ¡å¼€å‘çš„ä¸€ç«™å¼è§£å†³æ–¹æ¡ˆã€‚æ­¤é¡¹ç›®åŒ…å«å¼€å‘åˆ†å¸ƒå¼åº”ç”¨å¾®æœåŠ¡çš„å¿…éœ€ç»„ä»¶ï¼Œæ–¹ä¾¿å¼€å‘è€…é€šè¿‡ Spring Cloud ç¼–ç¨‹æ¨¡å‹è½»æ¾ä½¿ç”¨è¿™äº›ç»„ä»¶æ¥å¼€å‘åˆ†å¸ƒå¼åº”ç”¨æœåŠ¡ã€‚</strong></p>
<p><strong>ä¾æ‰˜ Spring Cloud Alibabaï¼Œæ‚¨åªéœ€è¦æ·»åŠ ä¸€äº›æ³¨è§£å’Œå°‘é‡é…ç½®ï¼Œå°±å¯ä»¥å°† Spring Cloud åº”ç”¨æ¥å…¥é˜¿é‡Œå¾®æœåŠ¡è§£å†³æ–¹æ¡ˆï¼Œé€šè¿‡é˜¿é‡Œä¸­é—´ä»¶æ¥è¿…é€Ÿæ­å»ºåˆ†å¸ƒå¼åº”ç”¨ç³»ç»Ÿã€‚</strong></p>
<p>æ–‡æ¡£ï¼š</p>
<p><a href="https://github.com/alibaba/spring-cloud-alibaba/blob/master/README-zh.md">https://github.com/alibaba/spring-cloud-alibaba/blob/master/README-zh.md</a></p>
<p><a href="https://spring.io/projects/spring-cloud-alibaba#overview">https://spring.io/projects/spring-cloud-alibaba#overview</a></p>
<p><a href="https://github.com/alibaba/spring-cloud-alibaba">https://github.com/alibaba/spring-cloud-alibaba</a></p>
<p><a href="https://spring-cloud-alibaba-group.github.io/github-pages/greenwich/spring-cloud-alibaba.html">https://spring-cloud-alibaba-group.github.io/github-pages/greenwich/spring-cloud-alibaba.html</a></p>
<p><a href="https://github.com/alibaba/spring-cloud-alibaba/blob/master/README-zh.md">https://github.com/alibaba/spring-cloud-alibaba/blob/master/README-zh.md</a></p>
<p>ä½œç”¨ï¼š</p>
<ol>
<li>æœåŠ¡é™æµé™çº§ï¼šé»˜è®¤æ”¯æŒ Servletã€Feignã€RestTemplateã€Dubbo å’Œ RocketMQ é™æµé™çº§åŠŸèƒ½çš„æ¥å…¥ï¼Œå¯ä»¥åœ¨è¿è¡Œæ—¶é€šè¿‡æ§åˆ¶å°å®æ—¶ä¿®æ”¹é™æµé™çº§è§„åˆ™ï¼Œè¿˜æ”¯æŒæŸ¥çœ‹é™æµé™çº§ Metrics ç›‘æ§ã€‚</li>
<li>æœåŠ¡æ³¨å†Œä¸å‘ç°ï¼šé€‚é… Spring Cloud æœåŠ¡æ³¨å†Œä¸å‘ç°æ ‡å‡†ï¼Œé»˜è®¤é›†æˆäº† Ribbon çš„æ”¯æŒã€‚</li>
<li>åˆ†å¸ƒå¼é…ç½®ç®¡ç†ï¼šæ”¯æŒåˆ†å¸ƒå¼ç³»ç»Ÿä¸­çš„å¤–éƒ¨åŒ–é…ç½®ï¼Œé…ç½®æ›´æ”¹æ—¶è‡ªåŠ¨åˆ·æ–°ã€‚</li>
<li>æ¶ˆæ¯é©±åŠ¨èƒ½åŠ›ï¼šåŸºäº Spring Cloud Stream ä¸ºå¾®æœåŠ¡åº”ç”¨æ„å»ºæ¶ˆæ¯é©±åŠ¨èƒ½åŠ›ã€‚</li>
<li>é˜¿é‡Œäº‘å¯¹è±¡å­˜å‚¨ï¼šé˜¿é‡Œäº‘æä¾›çš„æµ·é‡ã€å®‰å…¨ã€ä½æˆæœ¬ã€é«˜å¯é çš„äº‘å­˜å‚¨æœåŠ¡ã€‚æ”¯æŒåœ¨ä»»ä½•åº”ç”¨ã€ä»»ä½•æ—¶é—´ã€ä»»ä½•åœ°ç‚¹å­˜å‚¨å’Œè®¿é—®ä»»æ„ç±»å‹çš„æ•°æ®ã€‚</li>
<li>åˆ†å¸ƒå¼ä»»åŠ¡è°ƒåº¦ï¼šæä¾›ç§’çº§ã€ç²¾å‡†ã€é«˜å¯é ã€é«˜å¯ç”¨çš„å®šæ—¶ï¼ˆåŸºäº Cron è¡¨è¾¾å¼ï¼‰ä»»åŠ¡è°ƒåº¦æœåŠ¡ã€‚åŒæ—¶æä¾›åˆ†å¸ƒå¼çš„ä»»åŠ¡æ‰§è¡Œæ¨¡å‹ï¼Œå¦‚ç½‘æ ¼ä»»åŠ¡ã€‚ç½‘æ ¼ä»»åŠ¡æ”¯æŒæµ·é‡å­ä»»åŠ¡å‡åŒ€åˆ†é…åˆ°æ‰€æœ‰ Workerï¼ˆschedulerx-clientï¼‰ä¸Šæ‰§è¡Œã€‚</li>
</ol>
</blockquote>
<h1 id="SpringCloud-Alibaba-NacosæœåŠ¡æ³¨å†Œå’Œé…ç½®ä¸­å¿ƒ"><a href="#SpringCloud-Alibaba-NacosæœåŠ¡æ³¨å†Œå’Œé…ç½®ä¸­å¿ƒ" class="headerlink" title="SpringCloud Alibaba NacosæœåŠ¡æ³¨å†Œå’Œé…ç½®ä¸­å¿ƒ"></a>SpringCloud Alibaba NacosæœåŠ¡æ³¨å†Œå’Œé…ç½®ä¸­å¿ƒ</h1><h2 id="Nacosç®€ä»‹"><a href="#Nacosç®€ä»‹" class="headerlink" title="Nacosç®€ä»‹"></a>Nacosç®€ä»‹</h2><blockquote>
<p>å‰å››ä¸ªå­—æ¯åˆ†åˆ«ä¸ºNamingå’ŒConfigurationçš„å‰ä¸¤ä¸ªå­—æ¯ï¼Œæœ€åçš„sä¸ºServiceã€‚</p>
<p>Nacos: Dynamic Naming and Configuration Service</p>
<p>ä¸€ä¸ªæ›´æ˜“äºæ„å»ºäº‘åŸç”Ÿåº”ç”¨çš„åŠ¨æ€æœåŠ¡å‘ç°ã€é…ç½®ç®¡ç†å’ŒæœåŠ¡ç®¡ç†å¹³å°ã€‚</p>
<p>ç®€å•æ¥è¯´ï¼šNacoså°±æ˜¯æ³¨å†Œä¸­å¿ƒ + é…ç½®ä¸­å¿ƒçš„ç»„åˆã€Nacos &#x3D; Eureka+Config +Busã€‘</p>
<p>æ›¿ä»£EurekaåšæœåŠ¡æ³¨å†Œä¸­å¿ƒï¼Œæ›¿ä»£ConfigåšæœåŠ¡é…ç½®ä¸­å¿ƒ</p>
<p>æ–‡æ¡£ï¼š</p>
<p><a href="https://github.com/alibaba/Nacos">https://github.com/alibaba/Nacos</a></p>
<p><a href="https://nacos.io/zh-cn/index.html">https://nacos.io/zh-cn/index.html</a></p>
<p><a href="https://spring-cloud-alibaba-group.github.io/github-pages/greenwich/spring-cloud-alibaba.html#_spring_cloud_alibaba_nacos_discovery">https://spring-cloud-alibaba-group.github.io/github-pages/greenwich/spring-cloud-alibaba.html#_spring_cloud_alibaba_nacos_discovery</a></p>
<p><strong>å„ä¸ªæ³¨å†Œä¸­å¿ƒæ¯”è¾ƒ</strong></p>
<table>
<thead>
<tr>
<th>æœåŠ¡æ³¨å†Œä¸å‘ç°</th>
<th>CAPæ¨¡å‹</th>
<th>æ§åˆ¶å°ç®¡ç†</th>
<th>ç¤¾åŒºæ´»è·ƒåº¦</th>
</tr>
</thead>
<tbody><tr>
<td>Eureka</td>
<td>AP</td>
<td>æ”¯æŒ</td>
<td>ä½</td>
</tr>
<tr>
<td>Zookeeper</td>
<td>CP</td>
<td>ä¸æ”¯æŒ</td>
<td>ä¸­</td>
</tr>
<tr>
<td>Consul</td>
<td>CP</td>
<td>æ”¯æŒ</td>
<td>é«˜</td>
</tr>
<tr>
<td>Nacos</td>
<td>AP</td>
<td>æ”¯æŒ</td>
<td>é«˜</td>
</tr>
</tbody></table>
</blockquote>
<h2 id="å®‰è£…è¿è¡Œ"><a href="#å®‰è£…è¿è¡Œ" class="headerlink" title="å®‰è£…è¿è¡Œ"></a>å®‰è£…è¿è¡Œ</h2><ol>
<li>ä¸‹è½½åœ°å€ï¼š<a href="https://github.com/alibaba/nacos/releases">https://github.com/alibaba/nacos/releases</a></li>
<li>è¿è¡Œã€å•æœºç‰ˆã€‘ï¼šbin&#x2F;startup.cmd -m standalone</li>
<li>è®¿é—®ï¼š<a href="http://localhost:8848/nacos%EF%BC%8C%E9%BB%98%E8%AE%A4%E7%94%A8%E6%88%B7%E5%90%8D%E5%AF%86%E7%A0%81%EF%BC%9Anacos/nacos">http://localhost:8848/nacosï¼Œé»˜è®¤ç”¨æˆ·åå¯†ç ï¼šnacos/nacos</a></li>
</ol>
<h2 id="Nacosä½œä¸ºæœåŠ¡æ³¨å†Œä¸­å¿ƒæ¼”ç¤º"><a href="#Nacosä½œä¸ºæœåŠ¡æ³¨å†Œä¸­å¿ƒæ¼”ç¤º" class="headerlink" title="Nacosä½œä¸ºæœåŠ¡æ³¨å†Œä¸­å¿ƒæ¼”ç¤º"></a>Nacosä½œä¸ºæœåŠ¡æ³¨å†Œä¸­å¿ƒæ¼”ç¤º</h2><p>æ–‡æ¡£ï¼š<a href="https://spring-cloud-alibaba-group.github.io/github-pages/greenwich/spring-cloud-alibaba.html#_spring_cloud_alibaba_nacos_config">https://spring-cloud-alibaba-group.github.io/github-pages/greenwich/spring-cloud-alibaba.html#_spring_cloud_alibaba_nacos_config</a></p>
<h3 id="åŸºäºNacosçš„æœåŠ¡æä¾›è€…"><a href="#åŸºäºNacosçš„æœåŠ¡æä¾›è€…" class="headerlink" title="åŸºäºNacosçš„æœåŠ¡æä¾›è€…"></a>åŸºäºNacosçš„æœåŠ¡æä¾›è€…</h3><ol>
<li><p>æ–°å»ºæ¨¡å— cloudalibaba-provider-payment9001</p>
</li>
<li><p>pomæ–‡ä»¶</p>
<p> çˆ¶pomï¼š</p>
 <figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-alibaba-dependencies<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.1.0.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">type</span>&gt;</span>pom<span class="tag">&lt;/<span class="name">type</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">scope</span>&gt;</span>import<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p> å­pomï¼š</p>
 <figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-alibaba-nacos-discovery<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-actuator<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-devtools<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>runtime<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>yml</p>
 <figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">9001</span></span><br><span class="line"></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">nacos-payment-provider</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">nacos:</span></span><br><span class="line">      <span class="attr">discovery:</span></span><br><span class="line">        <span class="attr">server-addr:</span> <span class="string">localhost:8848</span></span><br><span class="line"></span><br><span class="line"><span class="attr">management:</span></span><br><span class="line">  <span class="attr">endpoints:</span></span><br><span class="line">    <span class="attr">web:</span></span><br><span class="line">      <span class="attr">exposure:</span></span><br><span class="line">        <span class="attr">include:</span> <span class="string">&#x27;*&#x27;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>å¯åŠ¨ç±»</p>
 <figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@EnableDiscoveryClient</span></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">NacosPayment9001</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        SpringApplication.run(NacosPayment9001.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>Controller</p>
 <figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PaymentController</span> &#123;</span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;server.port&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String serverPort;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(value = &quot;/payment/nacos/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getPayment</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> Integer id)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Nacos Registry, serverPort: &quot;</span> + serverPort + <span class="string">&quot;, id&quot;</span> + id;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>æµ‹è¯•ï¼šå¯åŠ¨æœåŠ¡ï¼ŒæŸ¥çœ‹NacosæœåŠ¡åˆ—è¡¨</p>
<p> <img src="/2023/02/28/SpringCloud/Java\Document\SpringCloud\images\image-20221230142133542.png" alt="image-20221230142133542"></p>
</li>
<li><p>ä¸ºæ¼”ç¤ºè´Ÿè½½å‡è¡¡ï¼Œå¤åˆ¶cloudalibaba-provider-payment9001 ä¸º cloudalibaba-provider-payment9002</p>
</li>
</ol>
<h3 id="åŸºäºNacosçš„æœåŠ¡æ¶ˆè´¹è€…"><a href="#åŸºäºNacosçš„æœåŠ¡æ¶ˆè´¹è€…" class="headerlink" title="åŸºäºNacosçš„æœåŠ¡æ¶ˆè´¹è€…"></a>åŸºäºNacosçš„æœåŠ¡æ¶ˆè´¹è€…</h3><ol>
<li><p>æ–°å»ºæ¨¡å— cloudalibaba-consumer-nacos-order83</p>
</li>
<li><p>pom.xml</p>
 <figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-alibaba-nacos-discovery<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.example<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>cloud-commons<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-actuator<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-devtools<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">scope</span>&gt;</span>runtime<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>yml</p>
</li>
</ol>
<figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">83</span></span><br><span class="line"></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">nacos-order-consumer</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">nacos:</span></span><br><span class="line">      <span class="attr">discovery:</span></span><br><span class="line">        <span class="attr">server-addr:</span> <span class="string">localhost:8848</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#è‡ªå®šä¹‰é…ç½®ï¼šæ¶ˆè´¹è€…å°†è¦å»è®¿é—®çš„å¾®æœåŠ¡åç§°(æ³¨å†ŒæˆåŠŸè¿›nacosçš„å¾®æœåŠ¡æä¾›è€…)</span></span><br><span class="line"><span class="attr">service-url:</span></span><br><span class="line">  <span class="attr">nacos-user-service:</span> <span class="string">http://nacos-payment-provider</span></span><br></pre></td></tr></table></figure>

<ol start="4">
<li><p>å¯åŠ¨ç±»</p>
 <figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@EnableDiscoveryClient</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OrderNacosMain83</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        SpringApplication.run(OrderNacosMain83.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p> é…ç½®ç±»</p>
 <figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.springcloud.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.cloud.client.loadbalancer.LoadBalanced;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.client.RestTemplate;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ApplicationContextConfig</span> &#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="meta">@LoadBalanced</span></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">        å¦‚æœä¸åŠ @LoadBalancedæŠ¥é”™ï¼š</span></span><br><span class="line"><span class="comment">        There was an unexpected error (type=Internal Server Error, status=500).</span></span><br><span class="line"><span class="comment">        I/O error on GET request for &quot;http://nacos-payment-provider/payment/nacos/13&quot;: nacos-payment-provider; nested exception is java.net.UnknownHostException: nacos-payment-provider</span></span><br><span class="line"><span class="comment">        org.springframework.web.client.ResourceAccessException: I/O error on GET request for &quot;http://nacos-payment-provider/payment/nacos/13&quot;: nacos-payment-provider; nested exception is java.net.UnknownHostException: nacos-payment-provider</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> RestTemplate <span class="title function_">restTemplate</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">RestTemplate</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>Controller</p>
 <figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">NacosOrderController</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> RestTemplate restTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;service-url.nacos-user-service&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String serviceUrl;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(value = &quot;/consumer/payment/nacos/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getPayment</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> Integer id)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> restTemplate.getForObject(serviceUrl + <span class="string">&quot;/payment/nacos/&quot;</span> + id, String.class);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>æµ‹è¯•è´Ÿè½½å‡è¡¡</p>
<p> <a href="http://localhost:83/consumer/payment/nacos/13">http://localhost:83/consumer/payment/nacos/13</a></p>
</li>
</ol>
<h3 id="æœåŠ¡æ³¨å†Œä¸­å¿ƒå¯¹æ¯”"><a href="#æœåŠ¡æ³¨å†Œä¸­å¿ƒå¯¹æ¯”" class="headerlink" title="æœåŠ¡æ³¨å†Œä¸­å¿ƒå¯¹æ¯”"></a>æœåŠ¡æ³¨å†Œä¸­å¿ƒå¯¹æ¯”</h3><blockquote>
<p>Nacosä¸å…¶ä»–æ³¨å†Œä¸­å¿ƒå¯¹æ¯”</p>
<table>
<thead>
<tr>
<th></th>
<th>Nacos</th>
<th>Eureka</th>
<th>Consul</th>
<th>CoreDns</th>
<th>Zookeeper</th>
</tr>
</thead>
<tbody><tr>
<td>ä¸€è‡´æ€§åè®®</td>
<td>CP+AP</td>
<td>AP</td>
<td>CP</td>
<td>&#x2F;</td>
<td>CP</td>
</tr>
<tr>
<td>å¥åº·æ£€æŸ¥</td>
<td>TCP&#x2F;HTTP&#x2F;MYSQL&#x2F;Client Beat</td>
<td>Client Beat</td>
<td>TCP&#x2F;HTTP&#x2F;gRPC&#x2F;Cmd</td>
<td>&#x2F;</td>
<td>Client Beat</td>
</tr>
<tr>
<td>è´Ÿè½½å‡è¡¡</td>
<td>æƒé‡&#x2F;DSL&#x2F;metadata&#x2F;cmdb</td>
<td>Ribbon</td>
<td>Fabio</td>
<td>RR</td>
<td>&#x2F;</td>
</tr>
<tr>
<td>é›ªå´©ä¿æŠ¤</td>
<td>æ”¯æŒ</td>
<td>æ”¯æŒ</td>
<td>ä¸æ”¯æŒ</td>
<td>ä¸æ”¯æŒ</td>
<td>ä¸æ”¯æŒ</td>
</tr>
<tr>
<td>è‡ªåŠ¨æ³¨é”€å®ä¾‹</td>
<td>æ”¯æŒ</td>
<td>æ”¯æŒ</td>
<td>ä¸æ”¯æŒ</td>
<td>ä¸æ”¯æŒ</td>
<td>æ”¯æŒ</td>
</tr>
<tr>
<td>è®¿é—®åè®®</td>
<td>HTTP&#x2F;DNS&#x2F;UDP</td>
<td>HTTP</td>
<td>HTTP&#x2F;DNS</td>
<td>DNS</td>
<td>TCP</td>
</tr>
<tr>
<td>ç›‘å¬æ”¯æŒ</td>
<td>æ”¯æŒ</td>
<td>æ”¯æŒ</td>
<td>æ”¯æŒ</td>
<td>ä¸æ”¯æŒ</td>
<td>æ”¯æŒ</td>
</tr>
<tr>
<td>å¤šæ•°æ®ä¸­å¿ƒ</td>
<td>æ”¯æŒ</td>
<td>æ”¯æŒ</td>
<td>æ”¯æŒ</td>
<td>ä¸æ”¯æŒ</td>
<td>ä¸æ”¯æŒ</td>
</tr>
<tr>
<td>è·¨æ³¨å†Œä¸­å¿ƒ</td>
<td>æ”¯æŒ</td>
<td>ä¸æ”¯æŒ</td>
<td>æ”¯æŒ</td>
<td>ä¸æ”¯æŒ</td>
<td>ä¸æ”¯æŒ</td>
</tr>
<tr>
<td>SpringCloudé›†æˆ</td>
<td>æ”¯æŒ</td>
<td>æ”¯æŒ</td>
<td>æ”¯æŒ</td>
<td>ä¸æ”¯æŒ</td>
<td>ä¸æ”¯æŒ</td>
</tr>
<tr>
<td>Dubboé›†æˆ</td>
<td>æ”¯æŒ</td>
<td>ä¸æ”¯æŒ</td>
<td>ä¸æ”¯æŒ</td>
<td>ä¸æ”¯æŒ</td>
<td>æ”¯æŒ</td>
</tr>
<tr>
<td>K8Sé›†æˆ</td>
<td>æ”¯æŒ</td>
<td>ä¸æ”¯æŒ</td>
<td>æ”¯æŒ</td>
<td>æ”¯æŒ</td>
<td>ä¸æ”¯æŒ</td>
</tr>
</tbody></table>
<img src="/2023/02/28/SpringCloud/Java\Document\SpringCloud\images\image-20221230162722001.png" alt="image-20221230162722001" style="zoom:80%;">
</blockquote>
<h3 id="Nacos-æ”¯æŒAPå’ŒCPæ¨¡å¼çš„åˆ‡æ¢"><a href="#Nacos-æ”¯æŒAPå’ŒCPæ¨¡å¼çš„åˆ‡æ¢" class="headerlink" title="Nacos æ”¯æŒAPå’ŒCPæ¨¡å¼çš„åˆ‡æ¢"></a>Nacos æ”¯æŒAPå’ŒCPæ¨¡å¼çš„åˆ‡æ¢</h3><blockquote>
<p>Cæ˜¯æ‰€æœ‰èŠ‚ç‚¹åœ¨åŒä¸€æ—¶é—´çœ‹åˆ°çš„æ•°æ®æ˜¯ä¸€è‡´çš„ï¼›è€Œ A çš„å®šä¹‰æ˜¯æ‰€æœ‰çš„è¯·æ±‚éƒ½ä¼šæ”¶åˆ°å“åº”ã€‚</p>
<p>ä½•æ—¶é€‰æ‹©ä½¿ç”¨ä½•ç§æ¨¡å¼ï¼Ÿ<br>ä¸€èˆ¬æ¥è¯´ï¼Œå¦‚æœä¸éœ€è¦å­˜å‚¨æœåŠ¡çº§åˆ«çš„ä¿¡æ¯ä¸”æœåŠ¡å®ä¾‹æ˜¯é€šè¿‡nacos-clientæ³¨å†Œï¼Œå¹¶èƒ½å¤Ÿä¿æŒå¿ƒè·³ä¸ŠæŠ¥ï¼Œé‚£ä¹ˆå°±å¯ä»¥é€‰æ‹©APæ¨¡å¼ã€‚å½“å‰ä¸»æµçš„æœåŠ¡å¦‚ Spring cloud å’Œ Dubbo æœåŠ¡ï¼Œéƒ½é€‚ç”¨äºAPæ¨¡å¼ï¼ŒAPæ¨¡å¼ä¸ºäº†æœåŠ¡çš„å¯èƒ½æ€§è€Œå‡å¼±äº†ä¸€è‡´æ€§ï¼Œå› æ­¤APæ¨¡å¼ä¸‹åªæ”¯æŒæ³¨å†Œä¸´æ—¶å®ä¾‹ã€‚</p>
<p>å¦‚æœéœ€è¦åœ¨æœåŠ¡çº§åˆ«ç¼–è¾‘æˆ–è€…å­˜å‚¨é…ç½®ä¿¡æ¯ï¼Œé‚£ä¹ˆ CP æ˜¯å¿…é¡»ï¼ŒK8SæœåŠ¡å’ŒDNSæœåŠ¡åˆ™é€‚ç”¨äºCPæ¨¡å¼ã€‚<br>CPæ¨¡å¼ä¸‹åˆ™æ”¯æŒæ³¨å†ŒæŒä¹…åŒ–å®ä¾‹ï¼Œæ­¤æ—¶åˆ™æ˜¯ä»¥ Raft åè®®ä¸ºé›†ç¾¤è¿è¡Œæ¨¡å¼ï¼Œè¯¥æ¨¡å¼ä¸‹æ³¨å†Œå®ä¾‹ä¹‹å‰å¿…é¡»å…ˆæ³¨å†ŒæœåŠ¡ï¼Œå¦‚æœæœåŠ¡ä¸å­˜åœ¨ï¼Œåˆ™ä¼šè¿”å›é”™è¯¯ã€‚</p>
<p>curl -X PUT â€˜$NACOS_SERVER:8848&#x2F;nacos&#x2F;v1&#x2F;ns&#x2F;operator&#x2F;switches?entry&#x3D;serverMode&amp;value&#x3D;CPâ€™</p>
</blockquote>
<h2 id="Nacosä½œä¸ºæœåŠ¡é…ç½®ä¸­å¿ƒæ¼”ç¤º"><a href="#Nacosä½œä¸ºæœåŠ¡é…ç½®ä¸­å¿ƒæ¼”ç¤º" class="headerlink" title="Nacosä½œä¸ºæœåŠ¡é…ç½®ä¸­å¿ƒæ¼”ç¤º"></a>Nacosä½œä¸ºæœåŠ¡é…ç½®ä¸­å¿ƒæ¼”ç¤º</h2><h3 id="åŸºç¡€é…ç½®ç¤ºä¾‹"><a href="#åŸºç¡€é…ç½®ç¤ºä¾‹" class="headerlink" title="åŸºç¡€é…ç½®ç¤ºä¾‹"></a>åŸºç¡€é…ç½®ç¤ºä¾‹</h3><ol>
<li><p>æ–°å»ºæ¨¡å— </p>
</li>
<li><p>ymlé…ç½®</p>
<p> NacosåŒspringcloud-configä¸€æ ·ï¼Œåœ¨é¡¹ç›®åˆå§‹åŒ–æ—¶ï¼Œè¦ä¿è¯å…ˆä»é…ç½®ä¸­å¿ƒè¿›è¡Œé…ç½®æ‹‰å–ï¼Œ<br> æ‹‰å–é…ç½®ä¹‹åï¼Œæ‰èƒ½ä¿è¯é¡¹ç›®çš„æ­£å¸¸å¯åŠ¨ã€‚springbootä¸­é…ç½®æ–‡ä»¶çš„åŠ è½½æ˜¯å­˜åœ¨ä¼˜å…ˆçº§é¡ºåºçš„ï¼Œbootstrapä¼˜å…ˆçº§é«˜äºapplicationã€‚</p>
<p> <strong>bootstrap.yml</strong></p>
 <figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">3377</span></span><br><span class="line"></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">nacos-config-client</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">nacos:</span></span><br><span class="line">      <span class="attr">discovery:</span></span><br><span class="line">        <span class="comment">#NacosæœåŠ¡æ³¨å†Œä¸­å¿ƒåœ°å€</span></span><br><span class="line">        <span class="attr">server-addr:</span> <span class="string">localhost:8848</span></span><br><span class="line">      <span class="attr">config:</span></span><br><span class="line">        <span class="comment">#Nacosä½œä¸ºé…ç½®ä¸­å¿ƒåœ°å€</span></span><br><span class="line">        <span class="attr">server-addr:</span> <span class="string">localhost:8848</span></span><br><span class="line">        <span class="comment">#æŒ‡å®šé…ç½®æ–‡ä»¶æ‰©å±•å</span></span><br><span class="line">        <span class="attr">file-extension:</span> <span class="string">yaml</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># $&#123;spring.application.name&#125;-$&#123;spring.profile.active&#125;.$&#123;spring.cloud.nacos.config.file-extension&#125;</span></span><br></pre></td></tr></table></figure>

<p> application.yml</p>
 <figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">profiles:</span></span><br><span class="line">    <span class="attr">active:</span> <span class="string">dev</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>å¯åŠ¨ç±»</p>
 <figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@EnableDiscoveryClient</span></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">NacosConfigClientMain3377</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        SpringApplication.run(NacosConfigClientMain3377.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>Controller</p>
<p> æ³¨æ„ï¼š<strong>ã€@RefreshScopeä¿è¯Nacosé…ç½®çš„åŠ¨æ€åˆ·æ–°åŠŸèƒ½ã€‘</strong></p>
 <figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="comment">//åœ¨æ§åˆ¶å™¨ç±»åŠ å…¥@RefreshScopeæ³¨è§£ä½¿å½“å‰ç±»ä¸‹çš„é…ç½®æ”¯æŒNacosçš„åŠ¨æ€åˆ·æ–°åŠŸèƒ½ã€‚</span></span><br><span class="line"><span class="meta">@RefreshScope</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ConfigClientController</span> &#123;</span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;config.info&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String configInfo;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/config/info&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getConfigInfo</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> configInfo;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>Nacosæ·»åŠ é…ç½®ä¿¡æ¯</p>
<blockquote>
<p>Nacosä¸­çš„dataidçš„ç»„æˆæ ¼å¼åŠä¸SpringBooté…ç½®æ–‡ä»¶ä¸­çš„åŒ¹é…è§„åˆ™ï¼š</p>
<p>æ–‡æ¡£ï¼š<a href="https://nacos.io/zh-cn/docs/quick-start-spring-cloud.html">https://nacos.io/zh-cn/docs/quick-start-spring-cloud.html</a></p>
<p>åœ¨ Nacos Spring Cloud ä¸­ï¼Œ<code>dataId</code> çš„å®Œæ•´æ ¼å¼å¦‚ä¸‹ï¼š</p>
<p>${prefix}-${spring.profiles.active}.${file-extension}</p>
<ul>
<li><code>prefix</code> é»˜è®¤ä¸º <code>spring.application.name</code> çš„å€¼ï¼Œä¹Ÿå¯ä»¥é€šè¿‡é…ç½®é¡¹ <code>spring.cloud.nacos.config.prefix</code>æ¥é…ç½®ã€‚</li>
<li><code>spring.profiles.active</code> å³ä¸ºå½“å‰ç¯å¢ƒå¯¹åº”çš„ profileï¼Œè¯¦æƒ…å¯ä»¥å‚è€ƒ <a href="https://docs.spring.io/spring-boot/docs/current/reference/html/boot-features-profiles.html#boot-features-profiles">Spring Bootæ–‡æ¡£</a>ã€‚ <strong>æ³¨æ„ï¼šå½“ <code>spring.profiles.active</code> ä¸ºç©ºæ—¶ï¼Œå¯¹åº”çš„è¿æ¥ç¬¦ <code>-</code> ä¹Ÿå°†ä¸å­˜åœ¨ï¼ŒdataId çš„æ‹¼æ¥æ ¼å¼å˜æˆ <code>$&#123;prefix&#125;.$&#123;file-extension&#125;</code></strong></li>
<li><code>file-exetension</code> ä¸ºé…ç½®å†…å®¹çš„æ•°æ®æ ¼å¼ï¼Œå¯ä»¥é€šè¿‡é…ç½®é¡¹ <code>spring.cloud.nacos.config.file-extension</code> æ¥é…ç½®ã€‚ç›®å‰åªæ”¯æŒ <code>properties</code> å’Œ <code>yaml</code> ç±»å‹ã€‚</li>
</ul>
<p>é€šè¿‡ Spring Cloud åŸç”Ÿæ³¨è§£ <code>@RefreshScope</code> å®ç°é…ç½®è‡ªåŠ¨æ›´æ–°</p>
</blockquote>
<p> é…ç½®ç¤ºä¾‹ï¼š</p>
 <img src="/2023/02/28/SpringCloud/Java\Document\SpringCloud\images\image-20221230170903498.png" alt="image-20221230170903498" style="zoom:80%;">

<p> å†å²é…ç½®ï¼š</p>
<p> Nacosä¼šè®°å½•é…ç½®æ–‡ä»¶çš„å†å²ç‰ˆæœ¬é»˜è®¤ä¿ç•™30å¤©ï¼Œæ­¤å¤–è¿˜æœ‰ä¸€é”®å›æ»šåŠŸèƒ½ï¼Œå›æ»šæ“ä½œå°†ä¼šè§¦å‘é…ç½®æ›´æ–°</p>
</li>
<li><p>æµ‹è¯•</p>
<p> è¿è¡Œcloud-config-nacos-client3377ï¼Œè®¿é—®ï¼š<a href="http://localhost:3377/config/info">http://localhost:3377/config/info</a></p>
<p> ä¿®æ”¹ä¸‹Nacosä¸­çš„yamlé…ç½®æ–‡ä»¶ï¼Œå†æ¬¡è°ƒç”¨æŸ¥çœ‹é…ç½®çš„æ¥å£ï¼Œå°±ä¼šå‘ç°é…ç½®å·²ç»åˆ·æ–°</p>
</li>
</ol>
<h3 id="åˆ†ç±»é…ç½®"><a href="#åˆ†ç±»é…ç½®" class="headerlink" title="åˆ†ç±»é…ç½®"></a>åˆ†ç±»é…ç½®</h3><p>ç›®å‰å•ä¸€é…ç½®å­˜åœ¨çš„é—®é¢˜ï¼š</p>
<blockquote>
<p>é—®é¢˜1ï¼š<br>å®é™…å¼€å‘ä¸­ï¼Œé€šå¸¸ä¸€ä¸ªç³»ç»Ÿä¼šå‡†å¤‡ devå¼€å‘ç¯å¢ƒï¼Œtestæµ‹è¯•ç¯å¢ƒï¼Œprodç”Ÿäº§ç¯å¢ƒã€‚<br>å¦‚ä½•ä¿è¯æŒ‡å®šç¯å¢ƒå¯åŠ¨æ—¶æœåŠ¡èƒ½æ­£ç¡®è¯»å–åˆ°Nacosä¸Šç›¸åº”ç¯å¢ƒçš„é…ç½®æ–‡ä»¶ï¼Ÿ</p>
<p>é—®é¢˜2ï¼š<br>ä¸€ä¸ªå¤§å‹åˆ†å¸ƒå¼å¾®æœåŠ¡ç³»ç»Ÿä¼šæœ‰å¾ˆå¤šå¾®æœåŠ¡å­é¡¹ç›®ï¼Œæ¯ä¸ªå¾®æœåŠ¡é¡¹ç›®åˆéƒ½ä¼šæœ‰ç›¸åº”çš„å¼€å‘ç¯å¢ƒã€æµ‹è¯•ç¯å¢ƒã€é¢„å‘ç¯å¢ƒã€æ­£å¼ç¯å¢ƒâ€¦â€¦é‚£æ€ä¹ˆå¯¹è¿™äº›å¾®æœåŠ¡é…ç½®è¿›è¡Œç®¡ç†å‘¢ï¼Ÿ</p>
</blockquote>
<p>Nacoså¼•å…¥äº† Namespace+Group+Data IDè¿›è¡Œé…ç½®ã€‚</p>
<blockquote>
<p>æœ€å¤–å±‚çš„namespaceæ˜¯å¯ä»¥ç”¨äºåŒºåˆ†éƒ¨ç½²ç¯å¢ƒçš„ï¼ŒGroupå’ŒDataIDé€»è¾‘ä¸ŠåŒºåˆ†ä¸¤ä¸ªç›®æ ‡å¯¹è±¡ã€‚</p>
<img src="/2023/02/28/SpringCloud/Java\Document\SpringCloud\images\image-20221230171530839.png" alt="image-20221230171530839" style="zoom:60%;">

<p>é»˜è®¤æƒ…å†µï¼š<br>Namespace&#x3D;publicï¼ŒGroup&#x3D;DEFAULT_GROUPï¼Œé»˜è®¤Clusteræ˜¯DEFAULT</p>
<ol>
<li><p>Nacosé»˜è®¤çš„å‘½åç©ºé—´æ˜¯publicï¼ŒNamespaceä¸»è¦ç”¨æ¥å®ç°éš”ç¦»ã€‚<br> æ¯”æ–¹è¯´æˆ‘ä»¬ç°åœ¨æœ‰ä¸‰ä¸ªç¯å¢ƒï¼šå¼€å‘ã€æµ‹è¯•ã€ç”Ÿäº§ç¯å¢ƒï¼Œæˆ‘ä»¬å°±å¯ä»¥åˆ›å»ºä¸‰ä¸ªNamespaceï¼Œä¸åŒçš„Namespaceä¹‹é—´æ˜¯éš”ç¦»çš„ã€‚</p>
</li>
<li><p>Groupé»˜è®¤æ˜¯DEFAULT_GROUPï¼ŒGroupå¯ä»¥æŠŠä¸åŒçš„å¾®æœåŠ¡åˆ’åˆ†åˆ°åŒä¸€ä¸ªåˆ†ç»„é‡Œé¢å»</p>
<p> Serviceå°±æ˜¯å¾®æœåŠ¡ï¼›ä¸€ä¸ªServiceå¯ä»¥åŒ…å«å¤šä¸ªClusterï¼ˆé›†ç¾¤ï¼‰ï¼ŒNacosé»˜è®¤Clusteræ˜¯DEFAULT</p>
</li>
<li><p>Clusteræ˜¯å¯¹æŒ‡å®šå¾®æœåŠ¡çš„ä¸€ä¸ªè™šæ‹Ÿåˆ’åˆ†ã€‚<br> æ¯”æ–¹è¯´ä¸ºäº†å®¹ç¾ï¼Œå°†Serviceå¾®æœåŠ¡åˆ†åˆ«éƒ¨ç½²åœ¨äº†æ­å·æœºæˆ¿å’Œå¹¿å·æœºæˆ¿ï¼Œè¿™æ—¶å°±å¯ä»¥ç»™æ­å·æœºæˆ¿çš„Serviceå¾®æœåŠ¡èµ·ä¸€ä¸ªé›†ç¾¤åç§°ï¼ˆHZï¼‰ï¼Œç»™å¹¿å·æœºæˆ¿çš„Serviceå¾®æœåŠ¡èµ·ä¸€ä¸ªé›†ç¾¤åç§°ï¼ˆGZï¼‰ï¼Œè¿˜å¯ä»¥å°½é‡è®©åŒä¸€ä¸ªæœºæˆ¿çš„å¾®æœåŠ¡äº’ç›¸è°ƒç”¨ï¼Œä»¥æå‡æ€§èƒ½ã€‚</p>
</li>
<li><p>æœ€åæ˜¯Instanceï¼Œå°±æ˜¯å¾®æœåŠ¡çš„å®ä¾‹ã€‚</p>
</li>
</ol>
</blockquote>
<h3 id="ä¸‰ç§æ–¹æ¡ˆåŠ è½½é…ç½®ç¤ºä¾‹"><a href="#ä¸‰ç§æ–¹æ¡ˆåŠ è½½é…ç½®ç¤ºä¾‹" class="headerlink" title="ä¸‰ç§æ–¹æ¡ˆåŠ è½½é…ç½®ç¤ºä¾‹"></a>ä¸‰ç§æ–¹æ¡ˆåŠ è½½é…ç½®ç¤ºä¾‹</h3><h4 id="DataIDæ–¹æ¡ˆ"><a href="#DataIDæ–¹æ¡ˆ" class="headerlink" title="DataIDæ–¹æ¡ˆ"></a>DataIDæ–¹æ¡ˆ</h4><blockquote>
<p>é»˜è®¤ç©ºé—´+é»˜è®¤åˆ†ç»„+æ–°å»ºdevå’Œtestä¸¤ä¸ªDataID</p>
<ol>
<li><p>Nacosæ–°å»ºé…ç½®æ–‡ä»¶ï¼šnacos-config-client-dev.yamlå’Œnacos-config-client-test.yaml</p>
<p> <img src="/2023/02/28/SpringCloud/Java\Document\SpringCloud\images\image-20221230172300692.png" alt="image-20221230172300692"></p>
</li>
<li><p>åœ¨é¡¹ç›®ä¸­é€šè¿‡spring.profile.activeå±æ€§å°±èƒ½è¿›è¡Œå¤šç¯å¢ƒä¸‹é…ç½®æ–‡ä»¶çš„è¯»å–</p>
 <figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">profiles:</span></span><br><span class="line"><span class="comment">#    active: dev</span></span><br><span class="line">    <span class="attr">active:</span> <span class="string">test</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>æµ‹è¯•ï¼š<a href="http://localhost:3377/config/info">http://localhost:3377/config/info</a></p>
</li>
</ol>
</blockquote>
<h4 id="Groupæ–¹æ¡ˆ"><a href="#Groupæ–¹æ¡ˆ" class="headerlink" title="Groupæ–¹æ¡ˆ"></a>Groupæ–¹æ¡ˆ</h4><blockquote>
<p>é€šè¿‡Groupå®ç°ç¯å¢ƒåŒºåˆ†</p>
<ol>
<li><p>Nacosæ–°å»ºé…ç½®nacos-config-client-info.yamlå’Œnacos-config-client-info.yaml</p>
</li>
<li><p>Nacosæ–°å»ºé…ç½®æ—¶æŒ‡å®šç»„åï¼šDEV_GROUP å’Œ TEST_GROUP</p>
<p> <img src="/2023/02/28/SpringCloud/Java\Document\SpringCloud\images\image-20221230172817528.png" alt="image-20221230172817528"></p>
</li>
<li><p>bootstrap.ymlé…ç½®ä¸­æ–°å¢ groupé…ç½®ï¼š</p>
<p> bootstrap.yml</p>
 <figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">3377</span></span><br><span class="line"></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">nacos-config-client</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">nacos:</span></span><br><span class="line">      <span class="attr">discovery:</span></span><br><span class="line">        <span class="comment">#NacosæœåŠ¡æ³¨å†Œä¸­å¿ƒåœ°å€</span></span><br><span class="line">        <span class="attr">server-addr:</span> <span class="string">localhost:8848</span></span><br><span class="line">      <span class="attr">config:</span></span><br><span class="line">        <span class="comment">#Nacosä½œä¸ºé…ç½®ä¸­å¿ƒåœ°å€</span></span><br><span class="line">        <span class="attr">server-addr:</span> <span class="string">localhost:8848</span></span><br><span class="line">        <span class="comment">#æŒ‡å®šé…ç½®æ–‡ä»¶æ‰©å±•å</span></span><br><span class="line">        <span class="attr">file-extension:</span> <span class="string">yaml</span></span><br><span class="line">        <span class="attr">group:</span> <span class="string">DEV_GROUP</span></span><br></pre></td></tr></table></figure>

<p> application.yml</p>
 <figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">profiles:</span></span><br><span class="line"><span class="comment">#    active: dev</span></span><br><span class="line"><span class="comment">#    active: test</span></span><br><span class="line">    <span class="attr">active:</span> <span class="string">info</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>æµ‹è¯•ï¼š<a href="http://localhost:3377/config/info">http://localhost:3377/config/info</a></p>
</li>
</ol>
</blockquote>
<h4 id="Namespaceæ–¹æ¡ˆ"><a href="#Namespaceæ–¹æ¡ˆ" class="headerlink" title="Namespaceæ–¹æ¡ˆ"></a>Namespaceæ–¹æ¡ˆ</h4><blockquote>
<ol>
<li><p>æ–°å»ºdev&#x2F;test çš„ Namespace</p>
<p> <img src="/2023/02/28/SpringCloud/Java\Document\SpringCloud\images\image-20221230173250497.png" alt="image-20221230173250497"></p>
</li>
<li><p>æ–°å»ºé…ç½®æ–‡ä»¶</p>
<p> <img src="/2023/02/28/SpringCloud/Java\Document\SpringCloud\images\image-20221230173635811.png" alt="image-20221230173635811"></p>
</li>
<li><p>bootstrap.ymlæ–°å¢NameSpaceé…ç½®</p>
<p> bootstrap.yml</p>
 <figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">3377</span></span><br><span class="line"></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">nacos-config-client</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">nacos:</span></span><br><span class="line">      <span class="attr">discovery:</span></span><br><span class="line">        <span class="comment">#NacosæœåŠ¡æ³¨å†Œä¸­å¿ƒåœ°å€</span></span><br><span class="line">        <span class="attr">server-addr:</span> <span class="string">localhost:8848</span></span><br><span class="line">      <span class="attr">config:</span></span><br><span class="line">        <span class="comment">#Nacosä½œä¸ºé…ç½®ä¸­å¿ƒåœ°å€</span></span><br><span class="line">        <span class="attr">server-addr:</span> <span class="string">localhost:8848</span></span><br><span class="line">        <span class="comment">#æŒ‡å®šé…ç½®æ–‡ä»¶æ‰©å±•å</span></span><br><span class="line">        <span class="attr">file-extension:</span> <span class="string">yaml</span></span><br><span class="line">        <span class="attr">group:</span> <span class="string">DEV_GROUP</span></span><br><span class="line">        <span class="attr">namespace:</span> <span class="string">2af700b7-c643-428f-9229-acfb40df35ad</span></span><br></pre></td></tr></table></figure>

<p> application.yml</p>
 <figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">profiles:</span></span><br><span class="line">    <span class="attr">active:</span> <span class="string">dev</span></span><br><span class="line"><span class="comment">#    active: test</span></span><br><span class="line"><span class="comment">#    active: info</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>æµ‹è¯•ï¼šè®¿é—® <a href="http://localhost:3377/config/info">http://localhost:3377/config/info</a></p>
</li>
</ol>
</blockquote>
<h2 id="Nacosé›†ç¾¤å’ŒæŒä¹…åŒ–é…ç½®"><a href="#Nacosé›†ç¾¤å’ŒæŒä¹…åŒ–é…ç½®" class="headerlink" title="Nacosé›†ç¾¤å’ŒæŒä¹…åŒ–é…ç½®"></a>Nacosé›†ç¾¤å’ŒæŒä¹…åŒ–é…ç½®</h2><h3 id="æ¦‚è¿°-8"><a href="#æ¦‚è¿°-8" class="headerlink" title="æ¦‚è¿°"></a>æ¦‚è¿°</h3><blockquote>
<p>æ–‡æ¡£ï¼š<a href="https://nacos.io/zh-cn/docs/cluster-mode-quick-start.html">https://nacos.io/zh-cn/docs/cluster-mode-quick-start.html</a></p>
<img src="/2023/02/28/SpringCloud/Java\Document\SpringCloud\images\image-20221230174024654.png" alt="image-20221230174024654" style="zoom:80%;">

<p>Nacosé»˜è®¤ä½¿ç”¨åµŒå…¥å¼æ•°æ®åº“å®ç°æ•°æ®çš„å­˜å‚¨ã€‚æ‰€ä»¥å¦‚æœå¯åŠ¨å¤šä¸ªé»˜è®¤é…ç½®ä¸‹çš„NacosèŠ‚ç‚¹ï¼Œæ•°æ®å­˜å‚¨æ˜¯å­˜åœ¨ä¸€è‡´æ€§é—®é¢˜çš„ã€‚<br>ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼ŒNacosé‡‡ç”¨äº†é›†ä¸­å¼å­˜å‚¨çš„æ–¹å¼æ¥æ”¯æŒé›†ç¾¤åŒ–éƒ¨ç½²ï¼Œç›®å‰åªæ”¯æŒMySQLçš„å­˜å‚¨ã€‚</p>
<p>æ–‡æ¡£ï¼š<a href="https://nacos.io/zh-cn/docs/deployment.html">https://nacos.io/zh-cn/docs/deployment.html</a></p>
<p><strong>å•æœºæ¨¡å¼æ”¯æŒmysql</strong></p>
<p>åœ¨0.7ç‰ˆæœ¬ä¹‹å‰ï¼Œåœ¨å•æœºæ¨¡å¼æ—¶nacosä½¿ç”¨åµŒå…¥å¼æ•°æ®åº“å®ç°æ•°æ®çš„å­˜å‚¨ï¼Œä¸æ–¹ä¾¿è§‚å¯Ÿæ•°æ®å­˜å‚¨çš„åŸºæœ¬æƒ…å†µã€‚0.7ç‰ˆæœ¬å¢åŠ äº†æ”¯æŒmysqlæ•°æ®æºèƒ½åŠ›ï¼Œå…·ä½“çš„æ“ä½œæ­¥éª¤ï¼š</p>
<ul>
<li><p>1.å®‰è£…æ•°æ®åº“ï¼Œç‰ˆæœ¬è¦æ±‚ï¼š5.6.5+</p>
</li>
<li><p>2.åˆå§‹åŒ–mysqlæ•°æ®åº“ï¼Œæ•°æ®åº“åˆå§‹åŒ–æ–‡ä»¶ï¼šmysql-schema.sql</p>
</li>
<li><p>3.ä¿®æ”¹conf&#x2F;application.propertiesæ–‡ä»¶ï¼Œå¢åŠ æ”¯æŒmysqlæ•°æ®æºé…ç½®ï¼ˆç›®å‰åªæ”¯æŒmysqlï¼‰ï¼Œæ·»åŠ mysqlæ•°æ®æºçš„urlã€ç”¨æˆ·åå’Œå¯†ç ã€‚</p>
  <figure class="highlight properties"><table><tr><td class="code"><pre><span class="line"><span class="attr">spring.datasource.platform</span>=<span class="string">mysql</span></span><br><span class="line"></span><br><span class="line"><span class="attr">db.num</span>=<span class="string">1</span></span><br><span class="line"><span class="attr">db.url.0</span>=<span class="string">jdbc:mysql://11.162.196.16:3306/nacos_devtest?characterEncoding=utf8&amp;connectTimeout=1000&amp;socketTimeout=3000&amp;autoReconnect=true</span></span><br><span class="line"><span class="attr">db.user</span>=<span class="string">nacos_devtest</span></span><br><span class="line"><span class="attr">db.password</span>=<span class="string">youdontknow</span></span><br></pre></td></tr></table></figure>

<p>  å†ä»¥å•æœºæ¨¡å¼å¯åŠ¨nacosï¼Œnacosæ‰€æœ‰å†™åµŒå…¥å¼æ•°æ®åº“çš„æ•°æ®éƒ½å†™åˆ°äº†mysql</p>
</li>
</ul>
</blockquote>
<h3 id="NacosæŒä¹…åŒ–é…ç½®"><a href="#NacosæŒä¹…åŒ–é…ç½®" class="headerlink" title="NacosæŒä¹…åŒ–é…ç½®"></a>NacosæŒä¹…åŒ–é…ç½®</h3><blockquote>
<p>Nacosé»˜è®¤è‡ªå¸¦çš„æ˜¯åµŒå…¥å¼æ•°æ®åº“derby</p>
<p>æ–‡æ¡£ï¼š<a href="https://github.com/alibaba/nacos/blob/develop/config/pom.xml">https://github.com/alibaba/nacos/blob/develop/config/pom.xml</a></p>
<p><strong>derbyåˆ°mysqlåˆ‡æ¢é…ç½®æ­¥éª¤ï¼š</strong></p>
<ol>
<li><p>æ‰§è¡Œnacos\confç›®å½•ä¸‹SQLè„šæœ¬ nacos-mysql.sql</p>
</li>
<li><p>ä¿®æ”¹é…ç½®nacos\conf\application.properties</p>
 <figure class="highlight properties"><table><tr><td class="code"><pre><span class="line"><span class="attr">db.num</span>=<span class="string">1</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># Connect URL of DB:</span></span><br><span class="line"><span class="attr">db.url.0</span>=<span class="string">jdbc:mysql://192.168.100.100:3306/nacos_config?characterEncoding=utf8&amp;connectTimeout=1000&amp;socketTimeout=3000&amp;autoReconnect=true&amp;useUnicode=true&amp;useSSL=false&amp;serverTimezone=UTC</span></span><br><span class="line"><span class="attr">db.user.0</span>=<span class="string">root</span></span><br><span class="line"><span class="attr">db.password.0</span>=<span class="string">root</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>é‡å¯Nacosï¼Œå¯ä»¥çœ‹åˆ°æ˜¯ä¸ªå…¨æ–°çš„ç©ºè®°å½•ç•Œé¢ï¼Œä»¥å‰æ˜¯è®°å½•è¿›derby</p>
</li>
</ol>
</blockquote>
<h3 id="Linuxç‰ˆNacos-MySQLç”Ÿäº§ç¯å¢ƒé…ç½®"><a href="#Linuxç‰ˆNacos-MySQLç”Ÿäº§ç¯å¢ƒé…ç½®" class="headerlink" title="Linuxç‰ˆNacos+MySQLç”Ÿäº§ç¯å¢ƒé…ç½®"></a>Linuxç‰ˆNacos+MySQLç”Ÿäº§ç¯å¢ƒé…ç½®</h3><p>é¢„è®¡éœ€è¦ï¼š1ä¸ªNginx + 3ä¸ªnacosæ³¨å†Œä¸­å¿ƒ + 1ä¸ªmysql</p>
<h4 id="ä¸‹è½½"><a href="#ä¸‹è½½" class="headerlink" title="ä¸‹è½½"></a>ä¸‹è½½</h4><p>åœ°å€ï¼š<a href="https://github.com/alibaba/nacos/releases/tag/">https://github.com/alibaba/nacos/releases/tag/</a></p>
<p>è§£å‹å¹¶å®‰è£…</p>
<p>å»ºè®®: ç”Ÿäº§ç¯å¢ƒ 3 ä¸ªèŠ‚ç‚¹ åŠå…¶ä»¥ä¸Š</p>
<h4 id="é›†ç¾¤é…ç½®æ­¥éª¤"><a href="#é›†ç¾¤é…ç½®æ­¥éª¤" class="headerlink" title="é›†ç¾¤é…ç½®æ­¥éª¤"></a>é›†ç¾¤é…ç½®æ­¥éª¤</h4><ol>
<li><p>æ‰§è¡Œnacos\confç›®å½•ä¸‹SQLè„šæœ¬ nacos-mysql.sql</p>
</li>
<li><p>ä¿®æ”¹é…ç½®nacos\conf\application.properties</p>
 <figure class="highlight properties"><table><tr><td class="code"><pre><span class="line"><span class="attr">db.num</span>=<span class="string">1</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># Connect URL of DB:</span></span><br><span class="line"><span class="attr">db.url.0</span>=<span class="string">jdbc:mysql://192.168.100.100:3306/nacos_config?characterEncoding=utf8&amp;connectTimeout=1000&amp;socketTimeout=3000&amp;autoReconnect=true&amp;useUnicode=true&amp;useSSL=false&amp;serverTimezone=UTC</span></span><br><span class="line"><span class="attr">db.user.0</span>=<span class="string">root</span></span><br><span class="line"><span class="attr">db.password.0</span>=<span class="string">root</span></span><br></pre></td></tr></table></figure></li>
</ol>
<h1 id="SpringCloud-Alibaba-Sentinelå®ç°ç†”æ–­ä¸é™æµ"><a href="#SpringCloud-Alibaba-Sentinelå®ç°ç†”æ–­ä¸é™æµ" class="headerlink" title="SpringCloud Alibaba Sentinelå®ç°ç†”æ–­ä¸é™æµ"></a>SpringCloud Alibaba Sentinelå®ç°ç†”æ–­ä¸é™æµ</h1><h2 id="Sentinelæ¦‚è¿°"><a href="#Sentinelæ¦‚è¿°" class="headerlink" title="Sentinelæ¦‚è¿°"></a>Sentinelæ¦‚è¿°</h2><h3 id="ä¸‹è½½-1"><a href="#ä¸‹è½½-1" class="headerlink" title="ä¸‹è½½"></a>ä¸‹è½½</h3><p>æ–‡æ¡£ï¼š</p>
<p><a href="https://github.com/alibaba/Sentinel">https://github.com/alibaba/Sentinel</a></p>
<p><a href="https://github.com/alibaba/Sentinel/wiki/%E4%BB%8B%E7%BB%8D">https://github.com/alibaba/Sentinel/wiki/%E4%BB%8B%E7%BB%8D</a></p>
<p>ä¸‹è½½åœ°å€ï¼š<a href="https://github.com/alibaba/Sentinel/releases">https://github.com/alibaba/Sentinel/releases</a></p>
<h3 id="ä½œç”¨-4"><a href="#ä½œç”¨-4" class="headerlink" title="ä½œç”¨"></a>ä½œç”¨</h3><blockquote>
<p><strong>æœåŠ¡é›ªå´©ã€æœåŠ¡ç†”æ–­ã€æœåŠ¡é™çº§ã€æœåŠ¡é™æµ</strong></p>
</blockquote>
<h3 id="ä½¿ç”¨"><a href="#ä½¿ç”¨" class="headerlink" title="ä½¿ç”¨"></a>ä½¿ç”¨</h3><p><a href="https://spring-cloud-alibaba-group.github.io/github-pages/greenwich/spring-cloud-alibaba.html#_spring_cloud_alibaba_sentinel">https://spring-cloud-alibaba-group.github.io/github-pages/greenwich/spring-cloud-alibaba.html#_spring_cloud_alibaba_sentinel</a></p>
<h2 id="å®‰è£…Sentinelæ§åˆ¶å°"><a href="#å®‰è£…Sentinelæ§åˆ¶å°" class="headerlink" title="å®‰è£…Sentinelæ§åˆ¶å°"></a>å®‰è£…Sentinelæ§åˆ¶å°</h2><p>ä¸‹è½½ï¼š<a href="https://github.com/alibaba/Sentinel/releases">https://github.com/alibaba/Sentinel/releases</a></p>
<p>è¿è¡Œï¼šjava -jar sentinel-dashboard-1.8.6.jar</p>
<p>è®¿é—®ç•Œé¢ï¼š<a href="http://localhost:8080/">http://localhost:8080</a> 	åˆå§‹ç”¨æˆ·å¯†ç ï¼šsentinel&#x2F;sentinel</p>
<h2 id="åˆå§‹åŒ–æ¼”ç¤ºå·¥ç¨‹"><a href="#åˆå§‹åŒ–æ¼”ç¤ºå·¥ç¨‹" class="headerlink" title="åˆå§‹åŒ–æ¼”ç¤ºå·¥ç¨‹"></a>åˆå§‹åŒ–æ¼”ç¤ºå·¥ç¨‹</h2><ol>
<li><p>æ–°å»ºæ¨¡å— cloudalibaba-sentinel-service8401</p>
</li>
<li><p>pom.xml</p>
 <figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-alibaba-nacos-discovery<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--SpringCloud ailibaba sentinel-datasource-nacos åšæŒä¹…åŒ–ä½¿ç”¨--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.csp<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>sentinel-datasource-nacos<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--SpringCloud ailibaba sentinel --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-alibaba-sentinel<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--openfeign--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-openfeign<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-actuator<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-devtools<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>runtime<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>cn.hutool<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>hutool-all<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.6.3<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>yml</p>
</li>
</ol>
]]></content>
  </entry>
  <entry>
    <title>Zookeeper</title>
    <url>/2023/02/28/Zookeeper/</url>
    <content><![CDATA[<h1 id="Zookeeper"><a href="#Zookeeper" class="headerlink" title="Zookeeper"></a>Zookeeper</h1><h1 id="Zookeeper-æ¦‚è¿°"><a href="#Zookeeper-æ¦‚è¿°" class="headerlink" title="Zookeeper æ¦‚è¿°"></a>Zookeeper æ¦‚è¿°</h1><h2 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h2><p>Zookeeper æ˜¯ä¸€ä¸ªå¼€æºçš„åˆ†å¸ƒå¼çš„ï¼Œä¸ºåˆ†å¸ƒå¼æ¡†æ¶æä¾›åè°ƒæœåŠ¡çš„ Apache é¡¹ç›®ã€‚</p>
<p>å®˜ç½‘ï¼š<a href="https://zookeeper.apache.org/">https://zookeeper.apache.org/</a></p>
<h2 id="Zookeeper-å·¥ä½œæœºåˆ¶"><a href="#Zookeeper-å·¥ä½œæœºåˆ¶" class="headerlink" title="Zookeeper å·¥ä½œæœºåˆ¶"></a>Zookeeper å·¥ä½œæœºåˆ¶</h2><p>â€‹		æ˜¯ä¸€ä¸ªåŸºäºè§‚å¯Ÿè€…æ¨¡å¼è®¾è®¡çš„åˆ†å¸ƒå¼æœåŠ¡ç®¡ç†æ¡†æ¶ï¼Œå®ƒè´Ÿè´£å­˜å‚¨å’Œç®¡ç†å¤§å®¶éƒ½å…³å¿ƒçš„æ•°æ®ï¼Œç„¶åæ¥å—è§‚å¯Ÿè€…çš„æ³¨å†Œï¼Œä¸€æ—¦è¿™äº›æ•°æ®çš„çŠ¶æ€å‘ç”Ÿå˜åŒ–ï¼ŒZookeeper å°±å°†è´Ÿè´£é€šçŸ¥å·²ç»åœ¨ Zookeeper ä¸Šæ³¨å†Œçš„é‚£äº›è§‚å¯Ÿè€…åšå‡ºç›¸åº”çš„ååº”ã€‚</p>
<p>Zookeeper &#x3D; æ–‡ä»¶ç³»ç»Ÿ + é€šçŸ¥æœºåˆ¶</p>
<h2 id="Zookeeper-ç‰¹ç‚¹"><a href="#Zookeeper-ç‰¹ç‚¹" class="headerlink" title="Zookeeper ç‰¹ç‚¹"></a>Zookeeper ç‰¹ç‚¹</h2><p><img src="/2023/02/28/Zookeeper/Java\Document\Zookeeper\Zookeeper.assets\image-20220927215643357.png" alt="image-20220927215643357"></p>
<ol>
<li>Zookeeperï¼šä¸€ä¸ªé¢†å¯¼è€…ï¼ˆLeaderï¼‰ï¼Œå¤šä¸ªè·Ÿéšè€…ï¼ˆFollowerï¼‰ç»„æˆçš„é›†ç¾¤ã€‚</li>
<li>é›†ç¾¤ä¸­åªè¦æœ‰åŠæ•°ä»¥ä¸ŠèŠ‚ç‚¹å­˜æ´»ï¼ŒZookeeper é›†ç¾¤å°±èƒ½æ­£å¸¸æœåŠ¡ã€‚æ‰€ä»¥ Zookeeper é€‚åˆå®‰è£…å¥‡æ•°å°æœåŠ¡å™¨ã€‚</li>
<li>å…¨å±€æ•°æ®ä¸€è‡´ï¼šæ¯ä¸ª Server ä¿å­˜ä¸€ä»½ç›¸åŒçš„æ•°æ®å‰¯æœ¬ï¼ŒClientæ— è®ºè¿æ¥åˆ°å“ªä¸ª Serverï¼Œæ•°æ®éƒ½æ˜¯ä¸€è‡´çš„ã€‚</li>
<li>æ›´æ–°è¯·æ±‚é¡ºåºæ‰§è¡Œï¼Œæ¥è‡ªåŒä¸€ä¸ª Client çš„æ›´æ–°è¯·æ±‚æŒ‰å…¶å‘é€é¡ºåºä¾æ¬¡æ‰§è¡Œã€‚</li>
<li>æ•°æ®æ›´æ–°åŸå­æ€§ï¼Œä¸€æ¬¡æ•°æ®æ›´æ–°è¦ä¹ˆæˆåŠŸï¼Œè¦ä¹ˆå¤±è´¥ã€‚</li>
<li>å®æ—¶æ€§ï¼Œåœ¨ä¸€å®šæ—¶é—´èŒƒå›´å†…ï¼ŒClient èƒ½è¯»åˆ°æœ€æ–°æ•°æ®ã€‚</li>
</ol>
<h2 id="æ•°æ®ç»“æ„"><a href="#æ•°æ®ç»“æ„" class="headerlink" title="æ•°æ®ç»“æ„"></a>æ•°æ®ç»“æ„</h2><p>â€‹		ZooKeeper æ•°æ®æ¨¡å‹çš„ç»“æ„ä¸ Unix æ–‡ä»¶ç³»ç»Ÿå¾ˆç±»ä¼¼ï¼Œæ•´ä½“ä¸Šå¯ä»¥çœ‹ä½œæ˜¯ä¸€æ£µæ ‘ï¼Œæ¯ä¸ª èŠ‚ç‚¹ç§°åšä¸€ä¸ª ZNodeã€‚æ¯ä¸€ä¸ª ZNode é»˜è®¤èƒ½å¤Ÿå­˜å‚¨ 1MB çš„æ•°æ®ï¼Œæ¯ä¸ª ZNode éƒ½å¯ä»¥é€šè¿‡å…¶è·¯å¾„å”¯ä¸€æ ‡è¯†ã€‚</p>
<p><img src="/2023/02/28/Zookeeper/Java\Document\Zookeeper\Zookeeper.assets\image-20220927173947210.png" alt="image-20220927173947210"></p>
<h2 id="åº”ç”¨åœºæ™¯"><a href="#åº”ç”¨åœºæ™¯" class="headerlink" title="åº”ç”¨åœºæ™¯"></a>åº”ç”¨åœºæ™¯</h2><p>æä¾›çš„æœåŠ¡åŒ…æ‹¬ï¼šç»Ÿä¸€å‘½åæœåŠ¡ã€ç»Ÿä¸€é…ç½®ç®¡ç†ã€ç»Ÿä¸€é›†ç¾¤ç®¡ç†ã€æœåŠ¡å™¨èŠ‚ç‚¹åŠ¨æ€ä¸Šä¸‹çº¿ã€è½¯è´Ÿè½½å‡è¡¡ç­‰ã€‚</p>
<h3 id="ç»Ÿä¸€å‘½åæœåŠ¡"><a href="#ç»Ÿä¸€å‘½åæœåŠ¡" class="headerlink" title="ç»Ÿä¸€å‘½åæœåŠ¡"></a>ç»Ÿä¸€å‘½åæœåŠ¡</h3><p>â€‹		åœ¨åˆ†å¸ƒå¼ç¯å¢ƒä¸‹ï¼Œç»å¸¸éœ€è¦å¯¹åº”ç”¨ &#x2F; æœåŠ¡è¿›è¡Œç»Ÿä¸€å‘½åï¼Œä¾¿äºè¯†åˆ«ã€‚</p>
<h3 id="ç»Ÿä¸€é…ç½®ç®¡ç†"><a href="#ç»Ÿä¸€é…ç½®ç®¡ç†" class="headerlink" title="ç»Ÿä¸€é…ç½®ç®¡ç†"></a>ç»Ÿä¸€é…ç½®ç®¡ç†</h3><p>åˆ†å¸ƒå¼ç¯å¢ƒä¸­ï¼Œä¸€èˆ¬è¦æ±‚ä¸€ä¸ªé›†ç¾¤ä¸­ï¼Œæ‰€æœ‰èŠ‚ç‚¹çš„é…ç½®ä¿¡æ¯æ˜¯ä¸€è‡´çš„ï¼Œæ¯”å¦‚ Kafka é›†ç¾¤ï¼Œå¯¹é…ç½®æ–‡ä»¶ä¿®æ”¹åï¼Œå¸Œæœ›èƒ½å¤Ÿå¿«é€ŸåŒæ­¥åˆ°å„ä¸ªèŠ‚ç‚¹ä¸Šã€‚</p>
<p>Zookeeper å¯å®ç°è¯¥åŠŸèƒ½ï¼Œå¯ä»¥å°†é…ç½®ä¿¡æ¯å†™å…¥ Zookeeper çš„ä¸€ä¸ª Znodeï¼Œå„ä¸ªå®¢æˆ·ç«¯æœåŠ¡å™¨ç›‘å¬è¿™ä¸ª Znodeï¼Œä¸€ æ—¦Znodeä¸­çš„æ•°æ®è¢«ä¿®æ”¹ï¼ŒZooKeeperå°†é€šçŸ¥å„ä¸ªå®¢æˆ·ç«¯æœåŠ¡å™¨ã€‚</p>
<p><img src="/2023/02/28/Zookeeper/Java\Document\Zookeeper\Zookeeper.assets\image-20220927175059036.png" alt="image-20220927175059036"></p>
<h3 id="ç»Ÿä¸€é›†ç¾¤ç®¡ç†"><a href="#ç»Ÿä¸€é›†ç¾¤ç®¡ç†" class="headerlink" title="ç»Ÿä¸€é›†ç¾¤ç®¡ç†"></a>ç»Ÿä¸€é›†ç¾¤ç®¡ç†</h3><p>åˆ†å¸ƒå¼ç¯å¢ƒä¸­ï¼Œå®æ—¶æŒæ¡æ¯ä¸ªèŠ‚ç‚¹çš„çŠ¶æ€æ˜¯å¿…è¦çš„ï¼Œå¯æ ¹æ®èŠ‚ç‚¹å®æ—¶çŠ¶æ€åšå‡ºä¸€äº›è°ƒæ•´ã€‚</p>
<p>ZooKeeperå¯ä»¥å®ç°å®æ—¶ç›‘æ§èŠ‚ç‚¹çŠ¶æ€å˜åŒ–ï¼š</p>
<p>â€‹	1. å¯å°†èŠ‚ç‚¹ä¿¡æ¯å†™å…¥ZooKeeperä¸Šçš„ä¸€ä¸ªZNode</p>
<p>â€‹	2. ç›‘å¬è¿™ä¸ªZNodeå¯è·å–å®ƒçš„å®æ—¶çŠ¶æ€å˜åŒ–</p>
<h3 id="æœåŠ¡å™¨åŠ¨æ€ä¸Šä¸‹çº¿"><a href="#æœåŠ¡å™¨åŠ¨æ€ä¸Šä¸‹çº¿" class="headerlink" title="æœåŠ¡å™¨åŠ¨æ€ä¸Šä¸‹çº¿"></a>æœåŠ¡å™¨åŠ¨æ€ä¸Šä¸‹çº¿</h3><p>â€‹		å®¢æˆ·ç«¯èƒ½å®æ—¶æ´å¯Ÿåˆ°æœåŠ¡ å™¨ä¸Šä¸‹çº¿çš„å˜åŒ–</p>
<p><img src="/2023/02/28/Zookeeper/Java\Document\Zookeeper\Zookeeper.assets\image-20220927175315238.png" alt="image-20220927175315238"></p>
<h3 id="è½¯è´Ÿè½½å‡è¡¡"><a href="#è½¯è´Ÿè½½å‡è¡¡" class="headerlink" title="è½¯è´Ÿè½½å‡è¡¡"></a>è½¯è´Ÿè½½å‡è¡¡</h3><p>åœ¨ Zookeeper ä¸­è®°å½•æ¯å°æœåŠ¡å™¨çš„è®¿é—®æ•°ï¼Œè®©è®¿é—®æ•°æœ€å°‘çš„æœåŠ¡å™¨å»å¤„ç†æœ€æ–°çš„å®¢æˆ·ç«¯è¯·æ±‚</p>
<h1 id="Zookeeper-æœ¬åœ°å®‰è£…"><a href="#Zookeeper-æœ¬åœ°å®‰è£…" class="headerlink" title="Zookeeper æœ¬åœ°å®‰è£…"></a>Zookeeper æœ¬åœ°å®‰è£…</h1><h2 id="å®‰è£…è¯´æ˜"><a href="#å®‰è£…è¯´æ˜" class="headerlink" title="å®‰è£…è¯´æ˜"></a>å®‰è£…è¯´æ˜</h2><p>åœ°å€ï¼š<a href="https://zookeeper.apache.org/releases.html">https://zookeeper.apache.org/releases.html</a></p>
<p>ä¸‹è½½å®‰è£…åŒ…ï¼šapache-zookeeper-3.5.7-bin.tar.gz</p>
<p>å®‰è£…å‡†å¤‡ï¼šå®‰è£…JDKï¼Œè§£å‹è‡³ &#x2F;opt&#x2F;zookeeper&#x2F;ï¼Œé‡å‘½åæ–‡ä»¶å¤¹åç§°</p>
<p>é…ç½® Java ç¯å¢ƒå˜é‡ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">java</span></span><br><span class="line">export JAVA_HOME=JAVA_HOME=/opt/java/jdk1.8.0_131</span><br><span class="line">export JRE_HOME=/opt/java/jdk1.8.0_131/jre</span><br><span class="line">export CLASSPATH=.:%JAVA_HOME%/lib/dt.jar:%JAVA_HOME%/lib/tools.jar</span><br><span class="line">export PATH=$JAVA_HOME/bin:$JRE_HOME/bin:$PATH</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">zookeeper</span></span><br><span class="line">export ZOOKEEPER_HOME=/opt/zookeeper/zookeeper-3.5.7</span><br><span class="line">export PATH=$ZOOKEEPER_HOME/bin:$PATH</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">source /etc/profile</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æˆ–è€…ä¿®æ”¹ ~/.bash_profileï¼Œ <span class="built_in">source</span> ~/.bash_profile</span></span><br></pre></td></tr></table></figure>

<p>è§£å‹ Zookeeperï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@root zookeeper]# ll zookeeper-3.5.7/</span><br><span class="line">æ€»ç”¨é‡ 32</span><br><span class="line">drwxr-xr-x. 2  502 games   232 2æœˆ  10 2020 bin</span><br><span class="line">drwxr-xr-x. 2  502 games    77 2æœˆ   7 2020 conf</span><br><span class="line">drwxr-xr-x. 5  502 games  4096 2æœˆ  10 2020 docs</span><br><span class="line">drwxr-xr-x. 2 root root   4096 9æœˆ  27 18:40 lib</span><br><span class="line">-rw-r--r--. 1  502 games 11358 9æœˆ  13 2018 LICENSE.txt</span><br><span class="line">-rw-r--r--. 1  502 games   432 2æœˆ  10 2020 NOTICE.txt</span><br><span class="line">-rw-r--r--. 1  502 games  1560 2æœˆ   7 2020 README.md</span><br><span class="line">-rw-r--r--. 1  502 games  1347 2æœˆ   7 2020 README_packaging.txt</span><br></pre></td></tr></table></figure>

<p>ä¿®æ”¹é…ç½®ï¼šå°† conf è·¯å¾„ä¸‹ zoo_sample.cfg ä¿®æ”¹ä¸º zoo.cfgï¼Œå¹¶ä¿®æ”¹æ–‡ä»¶ä¸­ dataDir çš„è·¯å¾„ï¼Œä¸€èˆ¬è®¾ç½®ä¸ºå®‰è£…ç›®å½•ä¸‹çš„ 					zkDataï¼ˆmkdir  zkDataï¼‰</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@root conf]# mv zoo_sample.cfg zoo.cfg</span><br><span class="line">[root@root conf]# vim zoo.cfg</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">The number of milliseconds of each tick</span></span><br><span class="line">tickTime=2000</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">The number of ticks that the initial</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">synchronization phase can take</span></span><br><span class="line">initLimit=10</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">The number of ticks that can pass between</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">sending a request and getting an acknowledgement</span></span><br><span class="line">syncLimit=5</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">the directory <span class="built_in">where</span> the snapshot is stored.</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="keyword">do</span> not use /tmp <span class="keyword">for</span> storage, /tmp here is just</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">example sakes.</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">dataDir=/tmp/zookeeper</span></span><br><span class="line">dataDir=/opt/zookeeper/zookeeper-3.5.7/zkData</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">the port at <span class="built_in">which</span> the clients will connect</span></span><br><span class="line">clientPort=2181</span><br></pre></td></tr></table></figure>

<p>æ“ä½œ Zookeeperï¼š</p>
<p>â€‹		å¯åŠ¨Zookeeperï¼šzkServer.sh  start</p>
<p>â€‹		æŸ¥çœ‹è¿›ç¨‹æ˜¯å¦å¯åŠ¨ï¼šjps </p>
<p>â€‹		æŸ¥çœ‹çŠ¶æ€ï¼šzkServer.sh  status</p>
<p>â€‹		å¯åŠ¨å®¢æˆ·ç«¯ï¼šzkCli.sh</p>
<p>â€‹		é€€å‡ºå®¢æˆ·ç«¯ï¼šquit</p>
<p>â€‹		åœæ­¢ Zookeeperï¼šzkServer.sh  stop</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@root zookeeper-3.5.7]# cd bin</span><br><span class="line">[root@root bin]# zkServer.sh start</span><br><span class="line">ZooKeeper JMX enabled by default</span><br><span class="line">Using config: /opt/zookeeper/zookeeper-3.5.7/bin/../conf/zoo.cfg</span><br><span class="line">Starting zookeeper ... STARTED</span><br><span class="line">[root@root bin]# jps</span><br><span class="line">5191 Jps</span><br><span class="line">5160 QuorumPeerMain</span><br><span class="line">[root@root bin]# zkServer.sh status</span><br><span class="line">ZooKeeper JMX enabled by default</span><br><span class="line">Using config: /opt/zookeeper/zookeeper-3.5.7/bin/../conf/zoo.cfg</span><br><span class="line">Client port found: 2181. Client address: localhost.</span><br><span class="line">Mode: standalone</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">é€€å‡º</span></span><br><span class="line">[root@root bin]# zkServer.sh stop</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@root bin]# zkCli.sh</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">.....</span></span><br><span class="line">2022-09-27 19:09:18,427 [myid:localhost:2181] - INFO  [main-SendThread(localhost:2181):ClientCnxn$SendThread@1394] - Session establishment complete on server localhost/127.0.0.1:2181, sessionid = 0x10000be49f20002, negotiated timeout = 30000</span><br><span class="line"></span><br><span class="line">WATCHER::</span><br><span class="line"></span><br><span class="line">WatchedEvent state:SyncConnected type:None path:null</span><br><span class="line">[zk: localhost:2181(CONNECTED) 0] ls /</span><br><span class="line">[zookeeper]</span><br></pre></td></tr></table></figure>



<h2 id="é…ç½®å‚æ•°è§£è¯»"><a href="#é…ç½®å‚æ•°è§£è¯»" class="headerlink" title="é…ç½®å‚æ•°è§£è¯»"></a>é…ç½®å‚æ•°è§£è¯»</h2><p>é…ç½®æ–‡ä»¶ zoo.cfg ä¸­å‚æ•°å«ä¹‰ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">The number of milliseconds of each tick</span></span><br><span class="line">tickTime=2000</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">The number of ticks that the initial</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">synchronization phase can take</span></span><br><span class="line">initLimit=10</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">The number of ticks that can pass between</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">sending a request and getting an acknowledgement</span></span><br><span class="line">syncLimit=5</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">the directory <span class="built_in">where</span> the snapshot is stored.</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="keyword">do</span> not use /tmp <span class="keyword">for</span> storage, /tmp here is just</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">example sakes.</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">dataDir=/tmp/zookeeper</span></span><br><span class="line">dataDir=/opt/zookeeper/zookeeper-3.5.7/zkData</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">the port at <span class="built_in">which</span> the clients will connect</span></span><br><span class="line">clientPort=2181</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">the maximum number of client connections.</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">increase this <span class="keyword">if</span> you need to handle more clients</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">maxClientCnxns=60</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment"># Be sure to read the maintenance section of the</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">administrator guide before turning on autopurge.</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment"># http://zookeeper.apache.org/doc/current/zookeeperAdmin.html#sc_maintenance</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment"># The number of snapshots to retain in dataDir</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">autopurge.snapRetainCount=3</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Purge task interval <span class="keyword">in</span> hours</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Set to <span class="string">&quot;0&quot;</span> to <span class="built_in">disable</span> auto purge feature</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">autopurge.purgeInterval=1</span></span><br></pre></td></tr></table></figure>

<p>tickTime &#x3D; 2000ï¼šé€šä¿¡å¿ƒè·³æ—¶é—´ï¼ŒZookeeperæœåŠ¡å™¨ä¸å®¢æˆ·ç«¯å¿ƒè·³æ—¶é—´ï¼Œå•ä½æ¯«ç§’</p>
<p>initLimit &#x3D; 10ï¼šLF åˆå§‹é€šä¿¡æ—¶é™ï¼ŒLeaderå’ŒFolloweråˆå§‹è¿æ¥æ—¶èƒ½å®¹å¿çš„æœ€å¤šå¿ƒè·³æ•°<strong>ï¼ˆtickTimeçš„æ•°é‡ï¼‰</strong></p>
<p>syncLimit &#x3D; 5ï¼šLF åŒæ­¥é€šä¿¡æ—¶é™ï¼ŒLeaderå’ŒFollowerä¹‹é—´é€šä¿¡æ—¶é—´å¦‚æœè¶…è¿‡syncLimit * tickTimeï¼ŒLeaderè®¤ä¸ºFollweræ­» 						æ‰ï¼Œä»æœåŠ¡å™¨åˆ—è¡¨ä¸­åˆ é™¤Follwerã€‚</p>
<p>dataDirï¼šä¿å­˜Zookeeperä¸­çš„æ•°æ®ï¼Œé»˜è®¤çš„tmpç›®å½•ï¼Œå®¹æ˜“è¢«Linuxç³»ç»Ÿå®šæœŸåˆ é™¤ï¼Œæ‰€ä»¥ä¸€èˆ¬ä¸ç”¨é»˜è®¤çš„tmpç›®å½•ã€‚</p>
<p>clientPort &#x3D; 2181ï¼šå®¢æˆ·ç«¯è¿æ¥ç«¯å£ï¼Œé€šå¸¸ä¸åšä¿®æ”¹ã€‚</p>
<p>maxClientCnxns&#x3D;60ï¼šå®¢æˆ·ç«¯æœ€å¤§è¿æ¥æ•°é‡</p>
<p>å‚æ•°è¯´æ˜ï¼š<a href="https://zookeeper.apache.org/doc/current/zookeeperAdmin.html#sc_maintenance">https://zookeeper.apache.org/doc/current/zookeeperAdmin.html#sc_maintenance</a></p>
<h1 id="Zookeeper-é›†ç¾¤æ“ä½œ"><a href="#Zookeeper-é›†ç¾¤æ“ä½œ" class="headerlink" title="Zookeeper é›†ç¾¤æ“ä½œ"></a>Zookeeper é›†ç¾¤æ“ä½œ</h1><h2 id="é›†ç¾¤å®‰è£…"><a href="#é›†ç¾¤å®‰è£…" class="headerlink" title="é›†ç¾¤å®‰è£…"></a>é›†ç¾¤å®‰è£…</h2><ol>
<li><p>åœ¨ä¸‰å°æœºå™¨ä¸Šå®‰è£… Zookeeper</p>
</li>
<li><p>é…ç½®æœåŠ¡å™¨ç¼–å·ï¼š<strong>åœ¨å®‰è£…ç›®å½•é…ç½® zkDataï¼Œåœ¨ zkData ä¸‹åˆ›å»º myid æ–‡ä»¶ï¼Œåœ¨æ–‡ä»¶ä¸­æ·»åŠ ä¸ server å¯¹åº”çš„ç¼–å·</strong></p>
</li>
<li><p>åˆ†å‘ zookeeper è‡³å…¶ä»–æœºå™¨</p>
</li>
<li><p>é…ç½® zoo.cfgæ–‡ä»¶ï¼Œå¢åŠ å¦‚ä¸‹é…ç½®ï¼š</p>
<p> server.1&#x3D;192.168.100.100:2888:3888</p>
<p> server.2&#x3D;192.168.100.110:2888:3888</p>
<p> server.3&#x3D;192.168.100.120:2888:3888</p>
<p> é…ç½®å‚æ•°è¯´æ˜ï¼š</p>
<p> server.A&#x3D;B:C:D</p>
<p> A è¡¨ç¤ºé›†ç¾¤æ¨¡å¼ä¸‹ï¼Œé…ç½®ä¸€ä¸ªæ–‡ä»¶ myid ä¸­çš„æœºå™¨ç¼–å·ï¼ŒZookeeper å¯åŠ¨æ—¶è¯»å–æ­¤æ–‡ä»¶ï¼Œæ‹¿åˆ°é‡Œé¢çš„æ•°æ®ä¸ zoo.cfg é‡Œ	é¢çš„é…ç½®ä¿¡æ¯æ¯”è¾ƒä»è€Œåˆ¤æ–­åˆ°åº•æ˜¯å“ªä¸ª serverã€‚</p>
<p> B æ˜¯æœåŠ¡å™¨çš„åœ°å€</p>
<p> C æ˜¯è¿™ä¸ªæœåŠ¡å™¨ Follower ä¸é›†ç¾¤ä¸­çš„ Leader æœåŠ¡å™¨äº¤æ¢ä¿¡æ¯çš„ç«¯å£</p>
<p> D æ˜¯ç”¨æ¥æ‰§è¡Œé€‰ä¸¾æ—¶æœåŠ¡å™¨ç›¸äº’é€šä¿¡çš„ç«¯å£ã€‚</p>
</li>
<li><p>åŒæ­¥é…ç½®æ–‡ä»¶</p>
<blockquote>
<p>æ‰¹é‡è¿›è¡Œè·¨æœºå™¨é—´çš„æ–‡ä»¶ï¼ˆå«æ–‡ä»¶å¤¹ï¼‰ä¼ è¾“</p>
<ul>
<li>åˆ›å»ºè„šæœ¬ xsync.shï¼Œä¼ å…¥è¦ä¼ è¾“çš„ç›®å½•å</li>
<li>shellè„šæœ¬è¦æ±‚å…·æœ‰æ‰§è¡Œæƒé™ï¼šchmod +x xsync.sh</li>
<li>shellè„šæœ¬ä¿å­˜åœ¨ &#x2F;usr&#x2F;bin è¿™æ ·çš„ç›®å½•ä¸‹ï¼Œä»¥ä½¿å‘½ä»¤å…¨å±€æœ‰æ•ˆ</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/bin/bash</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">åˆ¤æ–­å‚æ•°ä¸ªæ•°</span></span><br><span class="line">if [ $# -lt 1 ]</span><br><span class="line">then</span><br><span class="line">	echo &quot;Not  Enough Arguments&quot;</span><br><span class="line">	exit</span><br><span class="line">fi</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">éå†æ‰€æœ‰ä¸»æœº</span></span><br><span class="line">for host in 192.168.100.100 192.168.100.110 192.168.100.120</span><br><span class="line">do</span><br><span class="line">	echo ========$host========</span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash">éå†æ‰€æœ‰ç›®å½•</span></span><br><span class="line">	for file in $@</span><br><span class="line">	do</span><br><span class="line">		if [ -e $file ]</span><br><span class="line">		then</span><br><span class="line"><span class="meta prompt_">			# </span><span class="language-bash">å¦‚æœæ–‡ä»¶å­˜åœ¨ï¼Œè·å–çˆ¶ç›®å½•ï¼Œ</span></span><br><span class="line"><span class="meta prompt_">			# </span><span class="language-bash"><span class="built_in">pwd</span> -Pï¼šå¦‚æœç›®å½•æ˜¯é“¾æ¥æ—¶ï¼Œæ˜¾ç¤ºå‡ºå®é™…è·¯å¾„ï¼Œè€Œéä½¿ç”¨è¿æ¥ï¼ˆ<span class="built_in">link</span>ï¼‰è·¯å¾„ã€‚<span class="built_in">pwd</span>é˜²æ­¢ä¼ å…¥ç›¸å¯¹è·¯å¾„</span></span><br><span class="line"><span class="meta prompt_">			# </span><span class="language-bash"><span class="built_in">cd</span> -P:å¦‚æœç›®å½•æ˜¯é“¾æ¥æ—¶ï¼Œåˆ‡æ¢åˆ°å®é™…è·¯å¾„çš„ç›®å½•ã€‚</span></span><br><span class="line">			pdir=$(cd -P $(dirname $file);pwd)</span><br><span class="line"><span class="meta prompt_">			# </span><span class="language-bash">è·å–æ–‡ä»¶åç§°</span></span><br><span class="line">			filename=$(basename $file)</span><br><span class="line">			ssh $host &quot;mkdir -p $pdir&quot;</span><br><span class="line">			rsync -av $pdir/$filename $host:$pdir</span><br><span class="line">		else</span><br><span class="line">			echo $file not exist!</span><br><span class="line">		fi</span><br><span class="line">	done</span><br><span class="line">done</span><br></pre></td></tr></table></figure>
</blockquote>
<p> <strong>åŒæ­¥å®Œæˆåï¼Œä¿®æ”¹é…ç½®æ–‡ä»¶å†…å®¹ã€‚</strong></p>
</li>
<li><p>å¯åŠ¨ Zookeeper å¹¶æŸ¥çœ‹çŠ¶æ€</p>
<blockquote>
<p>å¯åŠ¨ Zookeeper é›†ç¾¤ï¼Œè„šæœ¬ä½ç½®ï¼š&#x2F;home&#x2F;xxxx&#x2F;bin</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/bin/bash</span></span><br><span class="line">case $1 in</span><br><span class="line">&quot;start&quot;)&#123;</span><br><span class="line">	for host in 192.168.100.100 192.168.100.110 192.168.100.120</span><br><span class="line">	do</span><br><span class="line">		echo &quot;========zookeeper $host start========&quot;</span><br><span class="line">		ssh $host &quot;/opt/zookeeper/zookeeper-3.5.7/bin/zkServer.sh start&quot;</span><br><span class="line">	done</span><br><span class="line">&#125;</span><br><span class="line">;;</span><br><span class="line">&quot;status&quot;)&#123;</span><br><span class="line">	for host in 192.168.100.100 192.168.100.110 192.168.100.120</span><br><span class="line">	do</span><br><span class="line">		echo &quot;========zookeeper $host status========&quot;</span><br><span class="line">		ssh $host &quot;/opt/zookeeper/zookeeper-3.5.7/bin/zkServer.sh status&quot;</span><br><span class="line">	done</span><br><span class="line">&#125;</span><br><span class="line">;;</span><br><span class="line">&quot;stop&quot;)&#123;</span><br><span class="line">	for host in 192.168.100.100 192.168.100.110 192.168.100.120</span><br><span class="line">	do</span><br><span class="line">		echo &quot;========zookeeper $host stop========&quot;</span><br><span class="line">		ssh $host &quot;/opt/zookeeper/zookeeper-3.5.7/bin/zkServer.sh stop&quot;</span><br><span class="line">	done</span><br><span class="line">&#125;</span><br><span class="line">;;</span><br><span class="line">esac</span><br></pre></td></tr></table></figure>

<p>è®¾ç½®å…å¯†ç™»é™†ï¼š</p>
</blockquote>
</li>
</ol>
<blockquote>
</blockquote>
<pre><code>&gt; å®‰è£… sshpass å·¥å…·ï¼š yum -y install sshpass
</code></pre>
<blockquote>
</blockquote>
<pre><code>&gt; ä¿®æ”¹ï¼š
&gt;
&gt; <figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/bin/bash</span></span><br><span class="line">case $1 in</span><br><span class="line">&quot;start&quot;)&#123;</span><br><span class="line">	for host in 192.168.100.100 192.168.100.110 192.168.100.120</span><br><span class="line">	do</span><br><span class="line">		echo &quot;========zookeeper $host start========&quot;</span><br><span class="line">		sshpass -p root ssh -o StrictHostKeyChecking=no $host &quot;/opt/zookeeper/zookeeper-3.5.7/bin/zkServer.sh start&quot;</span><br><span class="line">	done</span><br><span class="line">&#125;</span><br><span class="line">;;</span><br><span class="line">&quot;status&quot;)&#123;</span><br><span class="line">	for host in 192.168.100.100 192.168.100.110 192.168.100.120</span><br><span class="line">	do</span><br><span class="line">		echo &quot;========zookeeper $host status========&quot;</span><br><span class="line">		sshpass -p root ssh -o StrictHostKeyChecking=no $host &quot;/opt/zookeeper/zookeeper-3.5.7/bin/zkServer.sh status&quot;</span><br><span class="line">	done</span><br><span class="line">&#125;</span><br><span class="line">;;</span><br><span class="line">&quot;stop&quot;)&#123;</span><br><span class="line">	for host in 192.168.100.100 192.168.100.110 192.168.100.120</span><br><span class="line">	do</span><br><span class="line">		echo &quot;========zookeeper $host stop========&quot;</span><br><span class="line">		sshpass -p root ssh -o StrictHostKeyChecking=no $host &quot;/opt/zookeeper/zookeeper-3.5.7/bin/zkServer.sh stop&quot;</span><br><span class="line">	done</span><br><span class="line">&#125;</span><br><span class="line">;;</span><br><span class="line">esac</span><br></pre></td></tr></table></figure>
</code></pre>
<blockquote>
</blockquote>
<pre><code>&gt; linux è®¾ç½®å…å¯†ç™»é™†ï¼šç•¥

æ³¨æ„æŠ¥é”™ï¼š

<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">å¦‚æœæŠ¥é”™ï¼šError: JAVA_HOME is not <span class="built_in">set</span> and java could not be found <span class="keyword">in</span> PATH.</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">å•æœºå¯åŠ¨æ²¡æœ‰é—®é¢˜ï¼Œä½†é›†ç¾¤å¯åŠ¨æŠ¥é”™</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">è§£å†³ï¼šåœ¨ zookeeper/bin/zkEnv.sh å¤´éƒ¨æ‰‹åŠ¨æ·»åŠ  JAVA_HOME=JAVA_HOME=/opt/java/jdk1.8.0_131</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">ä¿®æ”¹å®Œæˆåï¼Œé‡æ–°åˆ†å‘</span></span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">    [root@root zookeeper-3.5.7]# zkServer.sh status</span><br><span class="line">    ZooKeeper JMX enabled by default</span><br><span class="line">Using config: /opt/zookeeper/zookeeper-3.5.7/bin/../conf/zoo.cfg</span><br><span class="line">    Client port found: 2181. Client address: localhost.</span><br><span class="line">Error contacting service. It is probably not running.</span><br></pre></td></tr></table></figure>

åŸå› ï¼š

  1. Leader å’Œ Follower æœªé€‰å‡ºï¼Œæˆ–æ— æ³•è¿æ¥

  2. åªå¯åŠ¨ä¸åˆ°ä¸€åŠæ•°é‡çš„é›†ç¾¤ï¼Œæˆ–è€…é˜²ç«å¢™æœªå…³é—­

     é˜²ç«å¢™ï¼š

     CentOS7ï¼š

     <figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">systemctl status firewalld.service</span><br><span class="line">systemctl stop firewalld.service	#å…³é—­</span><br><span class="line">systemctl disabled firewalld.service	# ç¦ç”¨</span><br></pre></td></tr></table></figure>

     CentOS6ï¼š

     <figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">service iptables status</span><br><span class="line">service iptables stop</span><br><span class="line">chkconfig iptables off</span><br></pre></td></tr></table></figure>

å¯åŠ¨ç»“æœï¼š
</code></pre>
<blockquote>
<p>æŸ¥çœ‹ jps è¿›ç¨‹ï¼Œè„šæœ¬ jpsall.sh</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/bin/bash</span></span><br><span class="line">for host in 192.168.100.100 192.168.100.110 192.168.100.120</span><br><span class="line">do</span><br><span class="line">    echo ========$host========</span><br><span class="line">    ssh $host  &quot;source /etc/profile &amp;&amp; jps | grep -v jps &quot;</span><br><span class="line">done</span><br></pre></td></tr></table></figure>

</blockquote>
<pre><code>æŸ¥çœ‹çŠ¶æ€ï¼š

<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@root zookeeper-3.5.7]# zk.sh status</span><br><span class="line">========zookeeper 192.168.100.100 status========</span><br><span class="line">Warning: Permanently added &#x27;192.168.100.100&#x27; (ECDSA) to the list of known hosts.</span><br><span class="line">root@192.168.100.100&#x27;s password:</span><br><span class="line">/usr/bin/java</span><br><span class="line">ZooKeeper JMX enabled by default</span><br><span class="line">Using config: /opt/zookeeper/zookeeper-3.5.7/bin/../conf/zoo.cfg</span><br><span class="line">Client port found: 2181. Client address: localhost.</span><br><span class="line">Mode: follower</span><br><span class="line">========zookeeper 192.168.100.110 status========</span><br><span class="line">Warning: Permanently added &#x27;192.168.100.110&#x27; (ECDSA) to the list of known hosts.</span><br><span class="line">root@192.168.100.110&#x27;s password:</span><br><span class="line">/usr/bin/java</span><br><span class="line">ZooKeeper JMX enabled by default</span><br><span class="line">Using config: /opt/zookeeper/zookeeper-3.5.7/bin/../conf/zoo.cfg</span><br><span class="line">Client port found: 2181. Client address: localhost.</span><br><span class="line">Mode: leader</span><br><span class="line">========zookeeper 192.168.100.120 status========</span><br><span class="line">Warning: Permanently added &#x27;192.168.100.120&#x27; (ECDSA) to the list of known hosts.</span><br><span class="line">root@192.168.100.120&#x27;s password:</span><br><span class="line">/usr/bin/java</span><br><span class="line">ZooKeeper JMX enabled by default</span><br><span class="line">Using config: /opt/zookeeper/zookeeper-3.5.7/bin/../conf/zoo.cfg</span><br><span class="line">Client port found: 2181. Client address: localhost.</span><br><span class="line">Mode: follower</span><br><span class="line">[root@root zookeeper-3.5.7]#</span><br></pre></td></tr></table></figure>

è¯´æ˜ï¼šæ­¤æ—¶å·²ç»é€‰ä¸¾å‡º leader å’Œ follower
</code></pre>
<h2 id="é€‰ä¸¾æœºåˆ¶"><a href="#é€‰ä¸¾æœºåˆ¶" class="headerlink" title="é€‰ä¸¾æœºåˆ¶"></a>é€‰ä¸¾æœºåˆ¶</h2><h3 id="ç¬¬ä¸€æ¬¡å¯åŠ¨"><a href="#ç¬¬ä¸€æ¬¡å¯åŠ¨" class="headerlink" title="ç¬¬ä¸€æ¬¡å¯åŠ¨"></a>ç¬¬ä¸€æ¬¡å¯åŠ¨</h3><p><img src="/2023/02/28/Zookeeper/Java\Document\Zookeeper\Zookeeper.assets\image-20220927215757995.png" alt="image-20220927215757995"></p>
<ol>
<li><p>æœåŠ¡å™¨1å¯ åŠ¨ï¼Œå‘èµ·ä¸€æ¬¡é€‰ä¸¾ã€‚æœåŠ¡å™¨1æŠ•è‡ªå·±ä¸€ç¥¨ã€‚æ­¤æ—¶æœåŠ¡å™¨1ç¥¨æ•°ä¸€ç¥¨ï¼Œä¸å¤ŸåŠæ•°ä»¥ä¸Šï¼ˆ3ç¥¨ï¼‰ï¼Œé€‰ä¸¾æ— æ³•å®Œæˆï¼ŒæœåŠ¡å™¨1çŠ¶æ€ä¿æŒä¸º LOOKINGã€‚</p>
</li>
<li><p>æœåŠ¡å™¨2å¯åŠ¨ï¼Œå†å‘èµ·ä¸€æ¬¡é€‰ä¸¾ã€‚æœåŠ¡å™¨1å’Œ2åˆ†åˆ«æŠ•è‡ªå·±ä¸€ç¥¨å¹¶äº¤æ¢é€‰ç¥¨ä¿¡æ¯ï¼šæ­¤æ—¶æœåŠ¡å™¨ 1 å‘ç°æœåŠ¡å™¨ 2 çš„myid æ¯”è‡ªå·±ç›®å‰æŠ•ç¥¨æ¨ä¸¾çš„ï¼ˆæœåŠ¡å™¨1ï¼‰ å¤§ï¼Œæ›´æ”¹é€‰ç¥¨ä¸ºæ¨ä¸¾æœåŠ¡å™¨2ã€‚æ­¤æ—¶æœåŠ¡å™¨1ç¥¨æ•°0ç¥¨ï¼ŒæœåŠ¡å™¨2ç¥¨æ•°2ç¥¨ï¼Œæ²¡æœ‰åŠæ•°ä»¥ä¸Šç»“æœï¼Œé€‰ä¸¾æ— æ³•å®Œæˆï¼ŒæœåŠ¡å™¨1ï¼Œ2çŠ¶æ€ä¿æŒLOOKINGã€‚</p>
</li>
<li><p>æœåŠ¡å™¨3å¯åŠ¨ï¼Œå‘èµ·ä¸€æ¬¡é€‰ä¸¾ã€‚æ­¤æ—¶æœåŠ¡å™¨1å’Œ2éƒ½ä¼šæ›´æ”¹é€‰ç¥¨ä¸ºæœåŠ¡å™¨3ã€‚æ­¤æ¬¡æŠ•ç¥¨ç»“æœï¼šæœåŠ¡å™¨1ä¸º0ç¥¨ï¼ŒæœåŠ¡å™¨2ä¸º 0 ç¥¨ï¼ŒæœåŠ¡å™¨3ä¸º3ç¥¨ã€‚æ­¤æ—¶æœåŠ¡å™¨3çš„ç¥¨æ•°å·²ç»è¶…è¿‡åŠæ•°ï¼ŒæœåŠ¡å™¨3å½“é€‰Leaderã€‚æœåŠ¡å™¨1ï¼Œ2 æ›´æ”¹çŠ¶æ€ä¸ºFOLLOWINGï¼ŒæœåŠ¡å™¨3æ›´æ”¹çŠ¶æ€ä¸º LEADING</p>
</li>
<li><p>æœåŠ¡å™¨4å¯åŠ¨ï¼Œå‘èµ·ä¸€æ¬¡é€‰ä¸¾ã€‚æ­¤æ—¶æœåŠ¡å™¨1ï¼Œ2ï¼Œ3å·²ç»ä¸æ˜¯LOOKINGçŠ¶æ€ï¼Œä¸ä¼šæ›´æ”¹é€‰ç¥¨ä¿¡æ¯ã€‚äº¤æ¢é€‰ç¥¨ä¿¡æ¯ç»“æœï¼šæœåŠ¡å™¨3ä¸º3ç¥¨ï¼ŒæœåŠ¡å™¨4ä¸º 1ç¥¨ã€‚æ­¤æ—¶æœåŠ¡å™¨4æœä»å¤šæ•°ï¼Œæ›´æ”¹é€‰ç¥¨ä¿¡æ¯ä¸ºæœåŠ¡å™¨3ï¼Œå¹¶æ›´æ”¹çŠ¶æ€ä¸º FOLLOWINGï¼›</p>
</li>
<li><p>æœåŠ¡å™¨5å¯åŠ¨ï¼ŒåŒæœåŠ¡å™¨4ä¸€æ ·ä½œä¸ºfollwerã€‚</p>
</li>
</ol>
<p><strong>æ³¨æ„ï¼šå®¢æˆ·ç«¯çš„æ¯æ¬¡å†™æ“ä½œéƒ½æœ‰ äº‹åŠ¡idï¼ˆzxidï¼‰</strong></p>
<p>SIDï¼šæœåŠ¡å™¨IDã€‚ç”¨æ¥å”¯ä¸€æ ‡è¯†ä¸€å° ZooKeeper é›†ç¾¤ä¸­çš„æœºå™¨ï¼Œæ¯å°æœºå™¨ä¸èƒ½é‡å¤ï¼Œå’Œmyidä¸€è‡´ã€‚</p>
<p>ZXIDï¼šäº‹åŠ¡IDã€‚ZXIDæ˜¯ä¸€ä¸ªäº‹åŠ¡IDï¼Œç”¨æ¥æ ‡è¯†ä¸€æ¬¡æœåŠ¡å™¨çŠ¶æ€çš„å˜æ›´ã€‚åœ¨æŸä¸€æ—¶åˆ»ï¼Œ é›†ç¾¤ä¸­çš„æ¯å°æœºå™¨çš„ ZXID å€¼ä¸ä¸€		å®šå®Œå…¨ä¸€ è‡´ï¼Œè¿™å’Œ ZooKeeper æœåŠ¡å™¨å¯¹äºå®¢æˆ·ç«¯ â€œæ›´æ–°è¯·æ±‚â€ çš„å¤„ç†é€»è¾‘æœ‰å…³ã€‚</p>
<p>Epochï¼šæ¯ä¸ªLeaderä»»æœŸçš„ä»£å·ã€‚æ²¡æœ‰ Leaderæ—¶åŒä¸€è½®æŠ•ç¥¨è¿‡ç¨‹ä¸­çš„é€»è¾‘æ—¶é’Ÿå€¼æ˜¯ç›¸åŒçš„ã€‚æ¯æŠ•å®Œä¸€æ¬¡ç¥¨è¿™ä¸ªæ•°æ®å°±ä¼š		å¢åŠ ã€‚</p>
<h3 id="éç¬¬ä¸€æ¬¡å¯åŠ¨"><a href="#éç¬¬ä¸€æ¬¡å¯åŠ¨" class="headerlink" title="éç¬¬ä¸€æ¬¡å¯åŠ¨"></a>éç¬¬ä¸€æ¬¡å¯åŠ¨</h3><p><img src="/2023/02/28/Zookeeper/Java\Document\Zookeeper\Zookeeper.assets\image-20220927220711206.png" alt="image-20220927220711206"></p>
<p>å½“ ZooKeeper é›†ç¾¤ä¸­çš„ä¸€å°æœåŠ¡å™¨å‡ºç°ä»¥ä¸‹ä¸¤ç§æƒ…å†µä¹‹ä¸€æ—¶ï¼Œå°±ä¼šå¼€å§‹è¿›å…¥ Leader é€‰ä¸¾ï¼š</p>
<ul>
<li><p>æœåŠ¡å™¨åˆå§‹åŒ–å¯åŠ¨</p>
</li>
<li><p>æœåŠ¡å™¨è¿è¡ŒæœŸé—´æ— æ³•å’ŒLeaderä¿æŒè¿æ¥ï¼Œæ­¤æ—¶éœ€è¦è¿›è¡Œé€‰ä¸¾ã€‚</p>
</li>
</ul>
<p>è€Œå½“ä¸€å°æœºå™¨è¿›å…¥Leaderé€‰ä¸¾æµç¨‹æ—¶ï¼Œå½“å‰é›†ç¾¤ä¹Ÿå¯èƒ½ä¼šå¤„äºä»¥ä¸‹ä¸¤ç§çŠ¶æ€ï¼š</p>
<ol>
<li><p>é›†ç¾¤ä¸­æœ¬æ¥å°±å·²ç»å­˜åœ¨ä¸€ä¸ªLeaderã€‚ å¯¹äºç¬¬ä¸€ç§å·²ç»å­˜åœ¨Leaderçš„æƒ…å†µï¼Œæœºå™¨è¯•å›¾å»é€‰ä¸¾Leaderæ—¶ï¼Œä¼šè¢«å‘ŠçŸ¥å½“å‰æœåŠ¡å™¨çš„Leaderä¿¡æ¯ï¼Œå¯¹äºè¯¥æœºå™¨æ¥è¯´ï¼Œä»…ä»…éœ€è¦å’ŒLeaderæœºå™¨å»ºç«‹è¿ æ¥ï¼Œå¹¶è¿›è¡ŒçŠ¶æ€åŒæ­¥å³å¯ã€‚</p>
</li>
<li><p>é›†ç¾¤ä¸­ç¡®å®ä¸å­˜åœ¨Leaderï¼ˆå®•æœºï¼‰ã€‚</p>
<p> å‡è®¾ZooKeeperç”±5å°æœåŠ¡å™¨ç»„æˆï¼ŒSIDåˆ†åˆ«ä¸º1ã€2ã€3ã€4ã€5ï¼ŒZXIDåˆ†åˆ«ä¸º8ã€8ã€8ã€7ã€7ï¼Œå¹¶ä¸”æ­¤æ—¶SIDä¸º3çš„æœåŠ¡å™¨æ˜¯Leaderã€‚æŸä¸€æ—¶åˆ»ï¼Œ 3å’Œ5æœåŠ¡å™¨å‡ºç°æ•…éšœï¼Œå› æ­¤å¼€å§‹è¿›è¡ŒLeaderé€‰ä¸¾ã€‚</p>
</li>
</ol>
<p>â€‹												ï¼ˆEPOCHï¼ŒZXIDï¼ŒSID ï¼‰	 ï¼ˆEPOCHï¼ŒZXIDï¼ŒSID ï¼‰	ï¼ˆEPOCHï¼ŒZXIDï¼ŒSID ï¼‰</p>
<p>SIDä¸º1ã€2ã€4çš„æœºå™¨æŠ•ç¥¨æƒ…å†µï¼š		(1, 8, 1)								ï¼ˆ1ï¼Œ8ï¼Œ2ï¼‰ 							ï¼ˆ1ï¼Œ7ï¼Œ4ï¼‰</p>
<p>é€‰ä¸¾Leaderè§„åˆ™ï¼š â‘  EPOCHå¤§çš„ç›´æ¥èƒœå‡º		â‘¡ EPOCHç›¸åŒï¼Œäº‹åŠ¡idå¤§çš„èƒœå‡º		â‘¢  äº‹åŠ¡idç›¸åŒï¼ŒæœåŠ¡å™¨idå¤§çš„èƒœå‡º</p>
<h2 id="å®¢æˆ·ç«¯å‘½ä»¤è¡Œæ“ä½œ"><a href="#å®¢æˆ·ç«¯å‘½ä»¤è¡Œæ“ä½œ" class="headerlink" title="å®¢æˆ·ç«¯å‘½ä»¤è¡Œæ“ä½œ"></a>å®¢æˆ·ç«¯å‘½ä»¤è¡Œæ“ä½œ</h2><h3 id="åŸºæœ¬è¯­æ³•"><a href="#åŸºæœ¬è¯­æ³•" class="headerlink" title="åŸºæœ¬è¯­æ³•"></a>åŸºæœ¬è¯­æ³•</h3><table>
<thead>
<tr>
<th>å‘½ä»¤</th>
<th>æè¿°ä¿¡æ¯</th>
</tr>
</thead>
<tbody><tr>
<td>ls [-s] [-w] [-R] path</td>
<td>æŸ¥çœ‹å½“å‰èŠ‚ç‚¹çš„ znode èŠ‚ç‚¹ï¼Œ-w ï¼šç›‘å¬å­èŠ‚ç‚¹å˜åŒ–ï¼Œ-sï¼šé™„åŠ å±‚çº§ä¿¡æ¯</td>
</tr>
<tr>
<td>create [-s] [-e] [-c] [-t ttl] path [data] [acl]</td>
<td>åˆ›å»ºèŠ‚ç‚¹ï¼Œ-sï¼šå«æœ‰åºåˆ—ï¼Œ-eï¼šä¸´æ—¶èŠ‚ç‚¹ï¼ˆé‡å¯æˆ–è¶…æ—¶æ¶ˆå¤±ï¼‰</td>
</tr>
<tr>
<td>get [-s] [-w] path</td>
<td>è·å¾—èŠ‚ç‚¹çš„å€¼ [å¯ç›‘å¬] -w ç›‘å¬èŠ‚ç‚¹å†…å®¹å˜åŒ– -s é™„åŠ æ¬¡çº§ä¿¡æ¯</td>
</tr>
<tr>
<td>set [-s] [-v version] path data</td>
<td>è®¾ç½®èŠ‚ç‚¹çš„å…·ä½“å€¼</td>
</tr>
<tr>
<td>stat [-w] path</td>
<td>æŸ¥çœ‹èŠ‚ç‚¹çŠ¶æ€</td>
</tr>
<tr>
<td>delete [-v version] path</td>
<td>åˆ é™¤èŠ‚ç‚¹</td>
</tr>
<tr>
<td>deleteall path</td>
<td>é€’å½’åˆ é™¤èŠ‚ç‚¹</td>
</tr>
</tbody></table>
<h3 id="znode-èŠ‚ç‚¹æ•°æ®ä¿¡æ¯"><a href="#znode-èŠ‚ç‚¹æ•°æ®ä¿¡æ¯" class="headerlink" title="znode èŠ‚ç‚¹æ•°æ®ä¿¡æ¯"></a>znode èŠ‚ç‚¹æ•°æ®ä¿¡æ¯</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[zk: localhost:2181(CONNECTED) 17] ls /</span><br><span class="line">[zookeeper]</span><br><span class="line">[zk: localhost:2181(CONNECTED) 18] ls -s /</span><br><span class="line">[zookeeper]cZxid = 0x0</span><br><span class="line">ctime = Thu Jan 01 08:00:00 CST 1970</span><br><span class="line">mZxid = 0x0</span><br><span class="line">mtime = Thu Jan 01 08:00:00 CST 1970</span><br><span class="line">pZxid = 0x0</span><br><span class="line">cversion = -1</span><br><span class="line">dataVersion = 0</span><br><span class="line">aclVersion = 0</span><br><span class="line">ephemeralOwner = 0x0</span><br><span class="line">dataLength = 0</span><br><span class="line">numChildren = 1</span><br><span class="line">[zk: localhost:2181(CONNECTED) 19]</span><br></pre></td></tr></table></figure>

<ul>
<li>czxidï¼šåˆ›å»ºèŠ‚ç‚¹çš„äº‹åŠ¡ zxid</li>
</ul>
<p>â€‹		æ¯æ¬¡ä¿®æ”¹ ZooKeeper çŠ¶æ€éƒ½ä¼šäº§ç”Ÿä¸€ä¸ª ZooKeeper äº‹åŠ¡ IDã€‚äº‹åŠ¡ ID æ˜¯ ZooKeeper ä¸­æ‰€æœ‰ä¿®æ”¹æ€»çš„æ¬¡åºã€‚æ¯æ¬¡ä¿®		æ”¹éƒ½æœ‰å”¯ä¸€çš„ zxidï¼Œå¦‚æœ zxid1 å°äº zxid2ï¼Œé‚£ä¹ˆ zxid1 åœ¨ zxid2 ä¹‹å‰å‘ç”Ÿã€‚</p>
<ul>
<li><p>ctimeï¼šznode è¢«åˆ›å»ºçš„æ¯«ç§’æ•°ï¼ˆä» 1970 å¹´å¼€å§‹ï¼‰</p>
</li>
<li><p>mzxidï¼šznode æœ€åæ›´æ–°çš„äº‹åŠ¡ zxid</p>
</li>
<li><p>mtimeï¼šznode æœ€åä¿®æ”¹çš„æ¯«ç§’æ•°ï¼ˆä» 1970 å¹´å¼€å§‹ï¼‰</p>
</li>
<li><p>pZxidï¼šznode æœ€åæ›´æ–°çš„å­èŠ‚ç‚¹ zxid</p>
</li>
<li><p>cversionï¼šznode å­èŠ‚ç‚¹å˜åŒ–å·ï¼Œznode å­èŠ‚ç‚¹ä¿®æ”¹æ¬¡æ•°</p>
</li>
<li><p>dataversionï¼šznode æ•°æ®å˜åŒ–å·</p>
</li>
<li><p>aclVersionï¼šznode è®¿é—®æ§åˆ¶åˆ—è¡¨çš„å˜åŒ–å·</p>
</li>
<li><p>ephemeralOwnerï¼šå¦‚æœæ˜¯ä¸´æ—¶èŠ‚ç‚¹ï¼Œè¿™ä¸ªæ˜¯ znode æ‹¥æœ‰è€…çš„ session idã€‚å¦‚æœä¸æ˜¯ ä¸´æ—¶èŠ‚ç‚¹åˆ™æ˜¯ 0ã€‚</p>
</li>
<li><p>dataLengthï¼šznode çš„æ•°æ®é•¿åº¦</p>
</li>
<li><p>numChildrenï¼šznode å­èŠ‚ç‚¹æ•°é‡</p>
</li>
</ul>
<h3 id="èŠ‚ç‚¹ç±»å‹ï¼ˆæŒä¹…-x2F-çŸ­æš‚-x2F-æœ‰åºå·-x2F-æ— åºå·ï¼‰"><a href="#èŠ‚ç‚¹ç±»å‹ï¼ˆæŒä¹…-x2F-çŸ­æš‚-x2F-æœ‰åºå·-x2F-æ— åºå·ï¼‰" class="headerlink" title="èŠ‚ç‚¹ç±»å‹ï¼ˆæŒä¹…&#x2F;çŸ­æš‚&#x2F;æœ‰åºå·&#x2F;æ— åºå·ï¼‰"></a>èŠ‚ç‚¹ç±»å‹ï¼ˆæŒä¹…&#x2F;çŸ­æš‚&#x2F;æœ‰åºå·&#x2F;æ— åºå·ï¼‰</h3><p>æŒä¹…ï¼ˆPersistentï¼‰ï¼šå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ç«¯æ–­å¼€è¿æ¥åï¼Œåˆ›å»ºçš„èŠ‚ç‚¹ä¸åˆ é™¤</p>
<p>çŸ­æš‚ï¼ˆEphemeralï¼‰ï¼šå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ç«¯æ–­å¼€è¿æ¥åï¼Œåˆ›å»ºçš„èŠ‚ç‚¹è‡ªå·±åˆ é™¤</p>
<p>é¡ºåºï¼šåˆ›å»º znode æ—¶è®¾ç½®é¡ºåºæ ‡è¯†ï¼Œznode åç§°åä¼šé™„åŠ ä¸€ä¸ªå€¼ï¼Œé¡ºåºå·æ˜¯ä¸€ä¸ªå•è°ƒé€’å¢çš„è®¡æ•°å™¨ï¼Œç”±çˆ¶èŠ‚ç‚¹ç»´æŠ¤</p>
<p>â€‹			åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œé¡ºåºå·å¯ä»¥è¢«ç”¨äºä¸ºæ‰€æœ‰çš„äº‹ä»¶è¿›è¡Œå…¨å±€æ’åºï¼Œè¿™æ ·å®¢æˆ·ç«¯å¯ä»¥é€šè¿‡é¡ºåºå·æ¨æ–­äº‹ä»¶çš„é¡ºåº</p>
<ol>
<li><p>åˆ†åˆ«åˆ›å»º2ä¸ªæ™®é€šèŠ‚ç‚¹ï¼ˆæ°¸ä¹…èŠ‚ç‚¹ + ä¸å¸¦åºå·ï¼‰</p>
<blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[zk: localhost:2181(CONNECTED) 14] create /node01 &quot;server01&quot;</span><br><span class="line">Created /node01</span><br><span class="line">[zk: localhost:2181(CONNECTED) 15] create /node02/node03 &quot;server03&quot;</span><br><span class="line">Node does not exist: /node02/node03</span><br><span class="line">[zk: localhost:2181(CONNECTED) 16] create /node02 &quot;server02&quot;</span><br><span class="line">Created /node02</span><br><span class="line">[zk: localhost:2181(CONNECTED) 17] create /node02/node03 &quot;server03&quot;</span><br><span class="line">Created /node02/node03</span><br><span class="line">[zk: localhost:2181(CONNECTED) 18] create /node04</span><br><span class="line">Created /node04</span><br></pre></td></tr></table></figure>

<p>æ³¨æ„ï¼šåˆ›å»ºèŠ‚ç‚¹æ—¶è¦èµ‹å€¼ï¼ˆå¦åˆ™ä¸ºnullï¼‰ï¼Œ<strong>ä¸”ä¸èƒ½åˆ›å»ºå¤šçº§èŠ‚ç‚¹</strong></p>
</blockquote>
</li>
<li><p>è·å–èŠ‚ç‚¹çš„å€¼</p>
<blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[zk: localhost:2181(CONNECTED) 19] get -s /node01</span><br><span class="line">server01</span><br><span class="line">cZxid = 0x200000016</span><br><span class="line">ctime = Tue Sep 27 23:18:29 CST 2022</span><br><span class="line">mZxid = 0x200000016</span><br><span class="line">mtime = Tue Sep 27 23:18:29 CST 2022</span><br><span class="line">pZxid = 0x200000016</span><br><span class="line">cversion = 0</span><br><span class="line">dataVersion = 0</span><br><span class="line">aclVersion = 0</span><br><span class="line">ephemeralOwner = 0x0</span><br><span class="line">dataLength = 8</span><br><span class="line">numChildren = 0</span><br><span class="line">[zk: localhost:2181(CONNECTED) 20] get -s /node02</span><br><span class="line">server02</span><br><span class="line">cZxid = 0x200000018</span><br><span class="line">ctime = Tue Sep 27 23:18:56 CST 2022</span><br><span class="line">mZxid = 0x200000018</span><br><span class="line">mtime = Tue Sep 27 23:18:56 CST 2022</span><br><span class="line">pZxid = 0x200000019</span><br><span class="line">cversion = 1</span><br><span class="line">dataVersion = 0</span><br><span class="line">aclVersion = 0</span><br><span class="line">ephemeralOwner = 0x0</span><br><span class="line">dataLength = 8</span><br><span class="line">numChildren = 1</span><br><span class="line">[zk: localhost:2181(CONNECTED) 21] get -s /node04</span><br><span class="line">null</span><br><span class="line">cZxid = 0x20000001a</span><br><span class="line">ctime = Tue Sep 27 23:19:23 CST 2022</span><br><span class="line">mZxid = 0x20000001a</span><br><span class="line">mtime = Tue Sep 27 23:19:23 CST 2022</span><br><span class="line">pZxid = 0x20000001a</span><br><span class="line">cversion = 0</span><br><span class="line">dataVersion = 0</span><br><span class="line">aclVersion = 0</span><br><span class="line">ephemeralOwner = 0x0</span><br><span class="line">dataLength = 0</span><br><span class="line">numChildren = 0</span><br><span class="line">[zk: localhost:2181(CONNECTED) 22]</span><br></pre></td></tr></table></figure>


</blockquote>
</li>
<li><p>åˆ›å»ºå¸¦åºå·çš„èŠ‚ç‚¹ï¼ˆæ°¸ä¹…èŠ‚ç‚¹ + å¸¦åºå·ï¼‰</p>
<p> â€‹	<strong>å¦‚æœåŸæ¥æ²¡æœ‰èŠ‚ç‚¹ï¼Œåºå·ä» 0 å¼€å§‹ä¾æ¬¡é€’å¢ã€‚å¦‚æœåŸèŠ‚ç‚¹ä¸‹å·²æœ‰ 2 ä¸ªèŠ‚ç‚¹ï¼Œåˆ™å†æ’åºæ—¶ä» 2 å¼€å§‹ï¼Œä»¥æ­¤ç±»æ¨ã€‚</strong></p>
<blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[zk: localhost:2181(CONNECTED) 10] create /nodeA &quot;serverA&quot;</span><br><span class="line">Created /nodeA</span><br><span class="line">[zk: localhost:2181(CONNECTED) 11] create /nodeA/nodeB &quot;serverB&quot;</span><br><span class="line">Created /nodeA/nodeB</span><br><span class="line">[zk: localhost:2181(CONNECTED) 12] create -s /nodeA/nodeC &quot;serverC&quot;</span><br><span class="line">Created /nodeA/nodeC0000000001</span><br><span class="line">[zk: localhost:2181(CONNECTED) 13] create -s /nodeA/nodeD &quot;serverD&quot;</span><br><span class="line">Created /nodeA/nodeD0000000002</span><br><span class="line">[zk: localhost:2181(CONNECTED) 14] create -s /nodeA/nodeC &quot;serverCC&quot;</span><br><span class="line">Created /nodeA/nodeC0000000003</span><br><span class="line">[zk: localhost:2181(CONNECTED) 15] get -s /nodeA/nodeC</span><br><span class="line">org.apache.zookeeper.KeeperException$NoNodeException: KeeperErrorCode = NoNode for /nodeA/nodeC</span><br><span class="line">[zk: localhost:2181(CONNECTED) 19] ls /nodeA</span><br><span class="line">[nodeB, nodeC0000000001, nodeC0000000003, nodeD0000000002]</span><br><span class="line">[zk: localhost:2181(CONNECTED) 21] create -s /nodeA/nodeB/nodeE &quot;serverE&quot;</span><br><span class="line">Created /nodeA/nodeB/nodeE0000000000</span><br><span class="line">[zk: localhost:2181(CONNECTED) 20] create -s /nodeE &quot;serverE&quot;</span><br><span class="line">Created /nodeE0000000010</span><br></pre></td></tr></table></figure>
</blockquote>
</li>
<li><p>åˆ›å»ºçŸ­æš‚èŠ‚ç‚¹ï¼ˆçŸ­æš‚èŠ‚ç‚¹ + ä¸å¸¦åºå· &#x2F; å¸¦åºå·ï¼‰</p>
<blockquote>
<p>é€€å‡ºå½“å‰å®¢æˆ·ç«¯ç„¶åå†é‡å¯å®¢æˆ·ç«¯ï¼ŒçŸ­æš‚èŠ‚ç‚¹å·²ç»åˆ é™¤</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[zk: localhost:2181(CONNECTED) 6] create -s /tempNode &quot;tempServer&quot;</span><br><span class="line">Created /tempNode0000000012</span><br><span class="line">[zk: localhost:2181(CONNECTED) 7] create -s -e /tempNode &quot;tempServer&quot;</span><br><span class="line">Created /tempNode0000000013</span><br><span class="line">[zk: localhost:2181(CONNECTED) 1] quit</span><br><span class="line"></span><br><span class="line">WATCHER::</span><br><span class="line"></span><br><span class="line">WatchedEvent state:Closed type:None path:null</span><br><span class="line">2022-09-27 23:45:59,221 [myid:] - INFO  [main:ZooKeeper@1422] - Session: 0x1000132016c0008 closed</span><br><span class="line">2022-09-27 23:45:59,228 [myid:] - INFO  [main-EventThread:ClientCnxn$EventThread@524] - EventThread shut down for session: 0x1000132016c0008</span><br><span class="line">[root@root ~]# zkCli.sh</span><br><span class="line">[zk: localhost:2181(CONNECTED) 1] get -s /tempNode0000000013</span><br><span class="line">org.apache.zookeeper.KeeperException$NoNodeException: KeeperErrorCode = NoNode for /tempNode0000000013</span><br></pre></td></tr></table></figure>
</blockquote>
</li>
<li><p>ä¿®æ”¹èŠ‚ç‚¹æ•°æ®å€¼</p>
<blockquote>
<p>dataVersion ä¼šæ”¹å˜</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[zk: localhost:2181(CONNECTED) 1] get -s /nodeA</span><br><span class="line">serverA</span><br><span class="line">cZxid = 0x200000025</span><br><span class="line">ctime = Tue Sep 27 23:27:02 CST 2022</span><br><span class="line">mZxid = 0x200000025</span><br><span class="line">mtime = Tue Sep 27 23:27:02 CST 2022</span><br><span class="line">pZxid = 0x200000029</span><br><span class="line">cversion = 4</span><br><span class="line">dataVersion = 0</span><br><span class="line">aclVersion = 0</span><br><span class="line">ephemeralOwner = 0x0</span><br><span class="line">dataLength = 7</span><br><span class="line">numChildren = 4</span><br><span class="line">[zk: localhost:2181(CONNECTED) 2] set /nodeA &quot;mserverA&quot;</span><br><span class="line">[zk: localhost:2181(CONNECTED) 3] get -s /nodeA</span><br><span class="line">mserverA</span><br><span class="line">cZxid = 0x200000025</span><br><span class="line">ctime = Tue Sep 27 23:27:02 CST 2022</span><br><span class="line">mZxid = 0x200000035</span><br><span class="line">mtime = Tue Sep 27 23:44:19 CST 2022</span><br><span class="line">pZxid = 0x200000029</span><br><span class="line">cversion = 4</span><br><span class="line">dataVersion = 1</span><br><span class="line">aclVersion = 0</span><br><span class="line">ephemeralOwner = 0x0</span><br><span class="line">dataLength = 8</span><br><span class="line">numChildren = 4</span><br><span class="line">[zk: localhost:2181(CONNECTED) 4]</span><br></pre></td></tr></table></figure></blockquote>
</li>
</ol>
<h3 id="ç›‘å¬å™¨åŸç†"><a href="#ç›‘å¬å™¨åŸç†" class="headerlink" title="ç›‘å¬å™¨åŸç†"></a>ç›‘å¬å™¨åŸç†</h3><p>â€‹		å®¢æˆ·ç«¯æ³¨å†Œç›‘å¬å®ƒå…³å¿ƒçš„ç›®å½•èŠ‚ç‚¹ï¼Œå½“ç›®å½•èŠ‚ç‚¹å‘ç”Ÿå˜åŒ–ï¼ˆæ•°æ®æ”¹å˜ã€èŠ‚ç‚¹åˆ é™¤ã€å­ç›® å½•èŠ‚ç‚¹å¢åŠ åˆ é™¤ï¼‰æ—¶ï¼ŒZooKeeper ä¼šé€šçŸ¥å®¢æˆ·ç«¯ã€‚ç›‘å¬æœºåˆ¶ä¿è¯ ZooKeeper ä¿å­˜çš„ä»»ä½•çš„æ•° æ®çš„ä»»ä½•æ”¹å˜éƒ½èƒ½å¿«é€Ÿçš„å“åº”åˆ°ç›‘å¬äº†è¯¥èŠ‚ç‚¹çš„åº”ç”¨ç¨‹åºã€‚</p>
<p>åŸç†è¯¦è§£ï¼š</p>
<ol>
<li><p>åœ¨mainçº¿ç¨‹ä¸­åˆ›å»ºZookeeperå®¢æˆ·ç«¯ï¼Œè¿™æ—¶å°±ä¼šåˆ›å»ºä¸¤ä¸ªçº¿ç¨‹ï¼Œä¸€ä¸ªè´Ÿè´£ç½‘ç»œè¿æ¥é€šä¿¡ï¼ˆconnetï¼‰ï¼Œä¸€ä¸ªè´Ÿè´£ç›‘å¬ï¼ˆlistenerï¼‰ã€‚</p>
</li>
<li><p>é€šè¿‡ connect çº¿ç¨‹å°†æ³¨å†Œçš„ç›‘å¬äº‹ä»¶å‘é€ç»™ Zookeeperã€‚</p>
</li>
<li><p>åœ¨ Zookeeper çš„æ³¨å†Œç›‘å¬å™¨åˆ—è¡¨ä¸­å°†æ³¨å†Œçš„ç›‘å¬äº‹ä»¶æ·»åŠ åˆ°åˆ—è¡¨ä¸­ã€‚</p>
</li>
<li><p>Zookeeper ç›‘å¬åˆ°æœ‰æ•°æ®æˆ–è·¯å¾„å˜åŒ–ï¼Œå°±ä¼šå°†è¿™ä¸ªæ¶ˆæ¯å‘é€ç»™ listener çº¿ç¨‹ã€‚</p>
</li>
<li><p>listener çº¿ç¨‹å†…éƒ¨è°ƒç”¨äº† process() æ–¹æ³•ã€‚</p>
<blockquote>
<p><img src="/2023/02/28/Zookeeper/Java\Document\Zookeeper\Zookeeper.assets\image-20220927234552567.png" alt="image-20220927234552567"></p>
</blockquote>
</li>
</ol>
<p>å¸¸è§çš„ç›‘å¬ï¼š</p>
<p>ç›‘å¬èŠ‚ç‚¹æ•°æ®çš„å˜åŒ–ï¼šget path [watch]</p>
<p>ç›‘å¬å­èŠ‚ç‚¹å¢å‡çš„å˜åŒ–ï¼šls path [watch]</p>
<p>ï¼ˆ1ï¼‰èŠ‚ç‚¹çš„å€¼å˜åŒ–ç›‘å¬ï¼š</p>
<blockquote>
<p>åœ¨ 192.168.100.100 ä¸Šç›‘å¬èŠ‚ç‚¹çš„å€¼ï¼Œåœ¨192.168.100.110 ä¸Šä¿®æ”¹èŠ‚ç‚¹çš„å€¼</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[zk: localhost:2181(CONNECTED) 10] create /node01 &quot;server01&quot;</span><br><span class="line">Created /node01</span><br><span class="line">[zk: localhost:2181(CONNECTED) 11] get -w /node01</span><br><span class="line">server01</span><br><span class="line">[zk: localhost:2181(CONNECTED) 12]</span><br><span class="line">WATCHER::</span><br><span class="line"></span><br><span class="line">WatchedEvent state:SyncConnected type:NodeDataChanged path:/node01</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[zk: localhost:2181(CONNECTED) 0] ls /</span><br><span class="line">[node01, zookeeper]</span><br><span class="line">[zk: localhost:2181(CONNECTED) 1] set /node01 &quot;node02&quot;</span><br><span class="line">[zk: localhost:2181(CONNECTED) 2] set /node01 &quot;node03&quot;</span><br></pre></td></tr></table></figure>

<p>æ³¨æ„ï¼šæ³¨å†Œä¸€æ¬¡ï¼Œåªèƒ½ç›‘å¬ä¸€æ¬¡ã€‚</p>
</blockquote>
<p>ï¼ˆ2ï¼‰èŠ‚ç‚¹çš„å­èŠ‚ç‚¹å˜åŒ–ç›‘å¬ï¼ˆè·¯å¾„å˜åŒ–ï¼‰</p>
<blockquote>
<p>åœ¨ 192.168.100.100 ä¸Šç›‘å¬èŠ‚ç‚¹çš„å€¼ï¼Œåœ¨192.168.100.110 ä¸Šä¿®æ”¹èŠ‚ç‚¹çš„å€¼</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[zk: localhost:2181(CONNECTED) 0] ls /</span><br><span class="line">[node01, zookeeper]</span><br><span class="line">[zk: localhost:2181(CONNECTED) 1] ls -w /node01</span><br><span class="line">[]</span><br><span class="line">[zk: localhost:2181(CONNECTED) 2]</span><br><span class="line">WATCHER::</span><br><span class="line"></span><br><span class="line">WatchedEvent state:SyncConnected type:NodeChildrenChanged path:/node01</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[zk: localhost:2181(CONNECTED) 0] create /node01/node02</span><br><span class="line">Created /node01/node02</span><br><span class="line">[zk: localhost:2181(CONNECTED) 1] create /node01/node03</span><br><span class="line">Created /node01/node03</span><br><span class="line"></span><br></pre></td></tr></table></figure>
</blockquote>
<h3 id="èŠ‚ç‚¹åˆ é™¤ä¸æŸ¥çœ‹"><a href="#èŠ‚ç‚¹åˆ é™¤ä¸æŸ¥çœ‹" class="headerlink" title="èŠ‚ç‚¹åˆ é™¤ä¸æŸ¥çœ‹"></a>èŠ‚ç‚¹åˆ é™¤ä¸æŸ¥çœ‹</h3><blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[zk: localhost:2181(CONNECTED) 1] ls /node01</span><br><span class="line">[node02, node03]</span><br><span class="line">[zk: localhost:2181(CONNECTED) 2] deleteall /node01</span><br><span class="line">[zk: localhost:2181(CONNECTED) 3] ls /</span><br><span class="line">[zookeeper]</span><br><span class="line">[zk: localhost:2181(CONNECTED) 4] stat /zookeeper</span><br><span class="line">cZxid = 0x0</span><br><span class="line">ctime = Thu Jan 01 08:00:00 CST 1970</span><br><span class="line">mZxid = 0x0</span><br><span class="line">mtime = Thu Jan 01 08:00:00 CST 1970</span><br><span class="line">pZxid = 0x0</span><br><span class="line">cversion = -2</span><br><span class="line">dataVersion = 0</span><br><span class="line">aclVersion = 0</span><br><span class="line">ephemeralOwner = 0x0</span><br><span class="line">dataLength = 0</span><br><span class="line">numChildren = 2</span><br></pre></td></tr></table></figure>
</blockquote>
<h2 id="å®¢æˆ·ç«¯-API-æ“ä½œ"><a href="#å®¢æˆ·ç«¯-API-æ“ä½œ" class="headerlink" title="å®¢æˆ·ç«¯ API æ“ä½œ"></a>å®¢æˆ·ç«¯ API æ“ä½œ</h2><h3 id="åˆ›å»ºå·¥ç¨‹"><a href="#åˆ›å»ºå·¥ç¨‹" class="headerlink" title="åˆ›å»ºå·¥ç¨‹"></a>åˆ›å»ºå·¥ç¨‹</h3><blockquote>
<p>pom.xml</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">&lt;dependencies&gt;</span><br><span class="line">    &lt;dependency&gt;</span><br><span class="line">        &lt;groupId&gt;junit&lt;/groupId&gt;</span><br><span class="line">        &lt;artifactId&gt;junit&lt;/artifactId&gt;</span><br><span class="line">        &lt;version&gt;RELEASE&lt;/version&gt;</span><br><span class="line">    &lt;/dependency&gt;</span><br><span class="line">    &lt;dependency&gt;</span><br><span class="line">        &lt;groupId&gt;org.apache.logging.log4j&lt;/groupId&gt;</span><br><span class="line">        &lt;artifactId&gt;log4j-core&lt;/artifactId&gt;</span><br><span class="line">        &lt;version&gt;2.8.2&lt;/version&gt;</span><br><span class="line">    &lt;/dependency&gt;</span><br><span class="line">    &lt;dependency&gt;</span><br><span class="line">        &lt;groupId&gt;org.apache.zookeeper&lt;/groupId&gt;</span><br><span class="line">        &lt;artifactId&gt;zookeeper&lt;/artifactId&gt;</span><br><span class="line">        &lt;version&gt;3.5.7&lt;/version&gt;</span><br><span class="line">    &lt;/dependency&gt;</span><br><span class="line">&lt;/dependencies&gt;</span><br></pre></td></tr></table></figure>

<p>log4j.properties</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">log4j.rootLogger=INFO, stdout</span><br><span class="line">log4j.appender.stdout=org.apache.log4j.ConsoleAppender</span><br><span class="line">log4j.appender.stdout.layout=org.apache.log4j.PatternLayout</span><br><span class="line">log4j.appender.stdout.layout.ConversionPattern=%d %p [%c] - %m%n</span><br><span class="line">log4j.appender.logfile=org.apache.log4j.FileAppender</span><br><span class="line">log4j.appender.logfile.File=target/spring.log</span><br><span class="line">log4j.appender.logfile.layout=org.apache.log4j.PatternLayout</span><br><span class="line">log4j.appender.logfile.layout.ConversionPattern=%d %p [%c] - %m%n</span><br></pre></td></tr></table></figure>
</blockquote>
<h3 id="åˆ›å»º-ZooKeeper-å®¢æˆ·ç«¯"><a href="#åˆ›å»º-ZooKeeper-å®¢æˆ·ç«¯" class="headerlink" title="åˆ›å»º ZooKeeper å®¢æˆ·ç«¯"></a>åˆ›å»º ZooKeeper å®¢æˆ·ç«¯</h3><p><strong>ä½¿ç”¨å®¢æˆ·ç«¯ API è¿æ¥æ—¶ï¼ŒsessionTimeout åº”è¯¥è®¾ç½®å¤§äº›ï¼Œå¦åˆ™æŠ¥é”™ï¼š</strong></p>
<p>org.apache.zookeeper.KeeperException$ConnectionLossException: KeeperErrorCode &#x3D; ConnectionLoss for &#x2F;node01</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ZkClient</span> &#123;</span><br><span class="line">	<span class="keyword">private</span> <span class="type">ZooKeeper</span> <span class="variable">zooKeeper</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">String</span> <span class="variable">connectString</span> <span class="operator">=</span> <span class="string">&quot;192.168.100.100:2181,192.168.100.110:2181,192.168.100.120:2181&quot;</span>;</span><br><span class="line">    <span class="comment">// æ³¨æ„ï¼Œè¯¥å€¼åœ¨ç¡®ä¿ç½‘ç»œï¼Œé˜²ç«å¢™å…³é—­çš„æƒ…å†µä¸‹ï¼Œå€¼åº”è¯¥è®¾ç½®å¤§ä¸€ç‚¹</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">int</span> <span class="variable">sessionTimeout</span> <span class="operator">=</span> <span class="number">100000</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * åˆ›å»º ZooKeeper å®¢æˆ·ç«¯</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> IOException</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Before</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">init</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            zooKeeper = <span class="keyword">new</span> <span class="title class_">ZooKeeper</span>(connectString, sessionTimeout, <span class="keyword">new</span> <span class="title class_">Watcher</span>() &#123;</span><br><span class="line">                <span class="comment">// ç›‘å¬èŠ‚ç‚¹å˜åŒ–ï¼ˆå€¼/è·¯å¾„ï¼‰ï¼Œæ”¶åˆ°äº‹ä»¶åçš„å›è°ƒå‡½æ•°</span></span><br><span class="line">                <span class="meta">@Override</span></span><br><span class="line">                <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">process</span><span class="params">(WatchedEvent watchedEvent)</span> &#123;</span><br><span class="line">                    System.out.println(watchedEvent.getType() + <span class="string">&quot; :: &quot;</span> + watchedEvent.getPath());</span><br><span class="line">                    <span class="comment">// å†æ¬¡ç›‘å¬</span></span><br><span class="line">                    <span class="keyword">try</span> &#123;</span><br><span class="line">                        <span class="keyword">for</span> (String child : zooKeeper.getChildren(<span class="string">&quot;/&quot;</span>, <span class="literal">true</span>)) &#123;</span><br><span class="line">                            System.out.println(<span class="string">&quot;child: &quot;</span> + child);</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125; <span class="keyword">catch</span> (KeeperException e) &#123;</span><br><span class="line">                        e.printStackTrace();</span><br><span class="line">                    &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                        e.printStackTrace();</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="åˆ›å»ºèŠ‚ç‚¹"><a href="#åˆ›å»ºèŠ‚ç‚¹" class="headerlink" title="åˆ›å»ºèŠ‚ç‚¹"></a>åˆ›å»ºèŠ‚ç‚¹</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * åˆ›å»ºèŠ‚ç‚¹</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@throws</span> Exception</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testCreate</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    <span class="comment">// å‚æ•° 1ï¼šè¦åˆ›å»ºçš„èŠ‚ç‚¹çš„è·¯å¾„ï¼›å‚æ•° 2ï¼šèŠ‚ç‚¹æ•°æ® ï¼›å‚æ•° 3ï¼šèŠ‚ç‚¹æƒé™ ï¼›å‚æ•° 4ï¼šèŠ‚ç‚¹çš„ç±»å‹</span></span><br><span class="line">    zooKeeper.create(<span class="string">&quot;/node01&quot;</span>,</span><br><span class="line">            <span class="string">&quot;server01&quot;</span>.getBytes(StandardCharsets.UTF_8),</span><br><span class="line">            ZooDefs.Ids.OPEN_ACL_UNSAFE,</span><br><span class="line">            CreateMode.PERSISTENT);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="ç›‘å¬å­èŠ‚ç‚¹å˜åŒ–"><a href="#ç›‘å¬å­èŠ‚ç‚¹å˜åŒ–" class="headerlink" title="ç›‘å¬å­èŠ‚ç‚¹å˜åŒ–"></a>ç›‘å¬å­èŠ‚ç‚¹å˜åŒ–</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * è·å–å­èŠ‚ç‚¹å¹¶ç›‘å¬èŠ‚ç‚¹å˜åŒ–</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@throws</span> Exception</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testGetChildren</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    List&lt;String&gt; children = zooKeeper.getChildren(<span class="string">&quot;/&quot;</span>, <span class="literal">true</span>);</span><br><span class="line">    <span class="keyword">for</span> (String child : children) &#123;</span><br><span class="line">        System.out.println(child);</span><br><span class="line">    &#125;</span><br><span class="line">    System.in.read();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="åˆ¤æ–­èŠ‚ç‚¹æ˜¯å¦å­˜åœ¨"><a href="#åˆ¤æ–­èŠ‚ç‚¹æ˜¯å¦å­˜åœ¨" class="headerlink" title="åˆ¤æ–­èŠ‚ç‚¹æ˜¯å¦å­˜åœ¨"></a>åˆ¤æ–­èŠ‚ç‚¹æ˜¯å¦å­˜åœ¨</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * åˆ¤æ–­èŠ‚ç‚¹æ˜¯å¦å­˜åœ¨</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@throws</span> Exception</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testExists</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    <span class="type">Stat</span> <span class="variable">stat</span> <span class="operator">=</span> zooKeeper.exists(<span class="string">&quot;/node01&quot;</span>, <span class="literal">false</span>);</span><br><span class="line">    System.out.println(stat == <span class="literal">null</span> ? <span class="string">&quot;not exist&quot;</span> : <span class="string">&quot;exist&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="å®¢æˆ·ç«¯å‘æœåŠ¡ç«¯å†™æ•°æ®æµç¨‹"><a href="#å®¢æˆ·ç«¯å‘æœåŠ¡ç«¯å†™æ•°æ®æµç¨‹" class="headerlink" title="å®¢æˆ·ç«¯å‘æœåŠ¡ç«¯å†™æ•°æ®æµç¨‹"></a>å®¢æˆ·ç«¯å‘æœåŠ¡ç«¯å†™æ•°æ®æµç¨‹</h2><h3 id="å†™å…¥è¯·æ±‚ç›´æ¥å‘é€ç»™LeaderèŠ‚ç‚¹"><a href="#å†™å…¥è¯·æ±‚ç›´æ¥å‘é€ç»™LeaderèŠ‚ç‚¹" class="headerlink" title="å†™å…¥è¯·æ±‚ç›´æ¥å‘é€ç»™LeaderèŠ‚ç‚¹"></a>å†™å…¥è¯·æ±‚ç›´æ¥å‘é€ç»™LeaderèŠ‚ç‚¹</h3><p>å®¢æˆ·ç«¯è¯·æ±‚ leaderï¼Œleader è‡ªå·±å†™æ•°æ®å¹¶å‘é€æ•°æ®ç»™ followerï¼Œfollower å†™æ•°æ®å®Œæˆï¼Œå‘é€ ack ç»™leaderï¼Œæ­¤æ—¶å†™å…¥æ•°æ®çš„æœºå™¨å·²ç»è¶…è¿‡åŠæ•°ï¼Œleader å‘é€ ack ç»™ Clientï¼Œä¹‹å leader å†å†™æ•°æ®ç»™å…¶ä»– followerã€‚</p>
<p><img src="/2023/02/28/Zookeeper/Java\Document\Zookeeper\Zookeeper.assets\image-20220928110608916.png" alt="image-20220928110608916"></p>
<h3 id="å†™å…¥è¯·æ±‚å‘é€ç»™followerèŠ‚ç‚¹"><a href="#å†™å…¥è¯·æ±‚å‘é€ç»™followerèŠ‚ç‚¹" class="headerlink" title="å†™å…¥è¯·æ±‚å‘é€ç»™followerèŠ‚ç‚¹"></a>å†™å…¥è¯·æ±‚å‘é€ç»™followerèŠ‚ç‚¹</h3><p>å®¢æˆ·ç«¯è¯·æ±‚ followerï¼Œfollower æ²¡æœ‰å†™çš„æƒé™ï¼Œå°†è¯·æ±‚å‘é€ç»™ leaderï¼Œleader è‡ªå·±å†™æ•°æ®å®Œæˆï¼Œå¹¶å†™æ•°æ®ç»™ followerï¼Œfollower å†™æ•°æ®å®Œæˆï¼Œå‘é€ ack ç»™ leaderï¼Œæ­¤æ—¶ leader åˆ¤æ–­å†™å…¥æ•°æ®çš„æœºå™¨å·²ç»è¶…è¿‡åŠæ•°ï¼Œleader å‘é€ ack ç»™ followerï¼ˆfollower å’Œ Client å»ºç«‹è¿æ¥ï¼‰ï¼Œä¹‹å leader å†å†™æ•°æ®ç»™å…¶ä»– followerã€‚</p>
<p><img src="/2023/02/28/Zookeeper/Java\Document\Zookeeper\Zookeeper.assets\image-20220928110637290.png" alt="image-20220928110637290"></p>
<h2 id="æœåŠ¡å™¨åŠ¨æ€ä¸Šä¸‹çº¿ç›‘å¬æ¡ˆä¾‹"><a href="#æœåŠ¡å™¨åŠ¨æ€ä¸Šä¸‹çº¿ç›‘å¬æ¡ˆä¾‹" class="headerlink" title="æœåŠ¡å™¨åŠ¨æ€ä¸Šä¸‹çº¿ç›‘å¬æ¡ˆä¾‹"></a>æœåŠ¡å™¨åŠ¨æ€ä¸Šä¸‹çº¿ç›‘å¬æ¡ˆä¾‹</h2><p>è¦æ±‚ï¼šæŸåˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œä¸»èŠ‚ç‚¹å¯ä»¥æœ‰å¤šå°ï¼Œå¯ä»¥åŠ¨æ€ä¸Šä¸‹çº¿ï¼Œä»»æ„ä¸€å°å®¢æˆ·ç«¯éƒ½èƒ½å®æ—¶æ„ŸçŸ¥åˆ°ä¸»èŠ‚ç‚¹æœåŠ¡å™¨çš„ä¸Šä¸‹çº¿ã€‚</p>
<p><img src="/2023/02/28/Zookeeper/Java\Document\Zookeeper\Zookeeper.assets\image-20220928111752756.png" alt="image-20220928111752756"></p>
<h3 id="æœåŠ¡ç«¯æ³¨å†Œ"><a href="#æœåŠ¡ç«¯æ³¨å†Œ" class="headerlink" title="æœåŠ¡ç«¯æ³¨å†Œ"></a>æœåŠ¡ç«¯æ³¨å†Œ</h3><p>åœ¨é›†ç¾¤ä¸Šåˆ›å»º &#x2F;servers èŠ‚ç‚¹</p>
<p><strong>æ³¨æ„åˆ é™¤æ—¶ï¼Œè¦å†™å…¨è·¯å¾„ã€‚</strong></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[zk: localhost:2181(CONNECTED) 8] create /servers &quot;servers&quot;</span><br><span class="line">Created /servers</span><br><span class="line">[zk: localhost:2181(CONNECTED) 9] ls /</span><br><span class="line">[servers, zookeeper]</span><br></pre></td></tr></table></figure>

<p>ä»£ç å®ç°ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.zookeeper.watchdemo;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.zookeeper.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.nio.charset.StandardCharsets;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WatchOnOffLineServer</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">ZooKeeper</span> <span class="variable">zooKeeper</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">String</span> <span class="variable">connectString</span> <span class="operator">=</span> <span class="string">&quot;192.168.100.100:2181,192.168.100.110:2181,192.168.100.120:2181&quot;</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">int</span> <span class="variable">sessionTimeout</span> <span class="operator">=</span> <span class="number">100000</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">String</span> <span class="variable">parentNode</span> <span class="operator">=</span> <span class="string">&quot;/servers&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        String[] hostnameArray = args.length &gt; <span class="number">0</span> ? args : <span class="keyword">new</span> <span class="title class_">String</span>[]&#123;<span class="string">&quot;192.168.100.100&quot;</span>, <span class="string">&quot;192.168.100.110&quot;</span>&#125;;</span><br><span class="line">        <span class="type">WatchOnOffLineServer</span> <span class="variable">server</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">WatchOnOffLineServer</span>();</span><br><span class="line">        server.getConnection();</span><br><span class="line">        <span class="keyword">for</span> (String hostname : hostnameArray) &#123;</span><br><span class="line">            server.registServer(hostname);</span><br><span class="line">            server.business(hostname);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">business</span><span class="params">(String hostname)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        System.out.println(hostname + <span class="string">&quot; is working ...&quot;</span>);</span><br><span class="line">        System.in.read();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å‘Zookeeperæ³¨å†ŒæœåŠ¡å™¨ä¿¡æ¯ï¼Œæ•°æ®ä¸º$&#123;hostname&#125;</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> hostname</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> InterruptedException</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> KeeperException</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">registServer</span><span class="params">(String hostname)</span> <span class="keyword">throws</span> InterruptedException, KeeperException &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">created</span> <span class="operator">=</span> zooKeeper.create(</span><br><span class="line">                parentNode + <span class="string">&quot;/server&quot;</span>,</span><br><span class="line">                hostname.getBytes(StandardCharsets.UTF_8),</span><br><span class="line">                ZooDefs.Ids.OPEN_ACL_UNSAFE, CreateMode.PERSISTENT_SEQUENTIAL);</span><br><span class="line">        System.out.println(hostname + <span class="string">&quot; online ...&quot;</span> + created);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">getConnection</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        zooKeeper = <span class="keyword">new</span> <span class="title class_">ZooKeeper</span>(connectString, sessionTimeout, <span class="keyword">new</span> <span class="title class_">Watcher</span>() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">process</span><span class="params">(WatchedEvent watchedEvent)</span> &#123;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="å®¢æˆ·ç«¯ç›‘å¬"><a href="#å®¢æˆ·ç«¯ç›‘å¬" class="headerlink" title="å®¢æˆ·ç«¯ç›‘å¬"></a>å®¢æˆ·ç«¯ç›‘å¬</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">package com.example.zookeeper.watchdemo;</span><br><span class="line"></span><br><span class="line">import org.apache.zookeeper.*;</span><br><span class="line"></span><br><span class="line">import java.io.IOException;</span><br><span class="line">import java.nio.charset.StandardCharsets;</span><br><span class="line">import java.util.ArrayList;</span><br><span class="line">import java.util.List;</span><br><span class="line">import java.util.stream.Collectors;</span><br><span class="line"></span><br><span class="line">public class WatchOnOffLineClient &#123;</span><br><span class="line">    private ZooKeeper zooKeeper = null;</span><br><span class="line">    private String connectString = &quot;192.168.100.100:2181,192.168.100.110:2181,192.168.100.120:2181&quot;;</span><br><span class="line">    private static int sessionTimeout = 100000;</span><br><span class="line">    private String parentNode = &quot;/servers&quot;;</span><br><span class="line"></span><br><span class="line">    public static void main(String[] args) throws Exception &#123;</span><br><span class="line">        WatchOnOffLineClient client = new WatchOnOffLineClient();</span><br><span class="line">        client.getConnection();</span><br><span class="line">        client.getServerList();</span><br><span class="line">        client.business();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private void getConnection() throws IOException &#123;</span><br><span class="line">        zooKeeper = new ZooKeeper(connectString, sessionTimeout, new Watcher() &#123;</span><br><span class="line">            @Override</span><br><span class="line">            public void process(WatchedEvent watchedEvent) &#123;</span><br><span class="line">                try &#123;</span><br><span class="line">                    getServerList();</span><br><span class="line">                &#125; catch (Exception e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private void getServerList() throws InterruptedException, KeeperException &#123;</span><br><span class="line">        List&lt;String&gt; children = zooKeeper.getChildren(parentNode, true);</span><br><span class="line">        // å­˜å‚¨æœåŠ¡å™¨ä¿¡æ¯åˆ—è¡¨</span><br><span class="line">        List&lt;String&gt; servers = new ArrayList&lt;&gt;();</span><br><span class="line">        // éå†æ‰€æœ‰èŠ‚ç‚¹ï¼Œè·å–èŠ‚ç‚¹ä¸­çš„ä¸»æœºåç§°ä¿¡æ¯</span><br><span class="line">        for (String child : children) &#123;</span><br><span class="line">            byte[] data = zooKeeper.getData(parentNode + &quot;/&quot; + child, false, null);</span><br><span class="line">            servers.add(new String(data, StandardCharsets.UTF_8));</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(&quot;servers: &quot; + servers);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private void business() throws IOException &#123;</span><br><span class="line">        System.out.println(&quot;client is working ...&quot;);</span><br><span class="line">        System.in.read();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="ZooKeeper-åˆ†å¸ƒå¼é”å®ç°"><a href="#ZooKeeper-åˆ†å¸ƒå¼é”å®ç°" class="headerlink" title="ZooKeeper åˆ†å¸ƒå¼é”å®ç°"></a>ZooKeeper åˆ†å¸ƒå¼é”å®ç°</h1><h2 id="å®ç°è¿‡ç¨‹"><a href="#å®ç°è¿‡ç¨‹" class="headerlink" title="å®ç°è¿‡ç¨‹"></a>å®ç°è¿‡ç¨‹</h2><p>åˆ†å¸ƒå¼é”ï¼šåˆ†å¸ƒå¼ç³»ç»Ÿä¸­å¤šä¸ªè¿›ç¨‹èƒ½å¤Ÿæœ‰åºè®¿é—®ä¸´ç•Œèµ„æºçš„é”å³ä¸ºåˆ†å¸ƒå¼é”ã€‚</p>
<p><img src="/2023/02/28/Zookeeper/Java\Document\Zookeeper\Zookeeper.assets\image-20221009235930879.png" alt="image-20221009235930879"></p>
<p>é€šè¿‡åˆ›å»ºæœ‰åºçš„ä¸´æ—¶èŠ‚ç‚¹å®ç°åˆ†å¸ƒå¼é”ï¼Œè¯¥èŠ‚ç‚¹ä½œä¸ºåˆ†å¸ƒå¼é”ã€‚</p>
<p>å®¢æˆ·ç«¯åˆ¤æ–­è·å–åˆ°çš„èŠ‚ç‚¹æ˜¯å¦ä¸ºæœ€å°èŠ‚ç‚¹ï¼Œå¦‚æœæ˜¯åˆ™è¯¥èŠ‚ç‚¹ä½œä¸ºé”ï¼Œï¼Œå¦‚æœä¸æ˜¯ï¼Œåˆ™ç›‘å¬ä¸Šä¸€ä¸ªèŠ‚ç‚¹ï¼Œå¯¹äºæ¯ä¸€ä¸ªèŠ‚ç‚¹ï¼Œå¤„ç†å®Œä¸šåŠ¡åï¼Œéœ€è¦é‡Šæ”¾é”ï¼Œå…¶ä»–çš„èŠ‚ç‚¹å¾—åˆ°é”ã€‚</p>
<h2 id="åŸç”ŸZookeeperå®ç°åˆ†å¸ƒå¼é”"><a href="#åŸç”ŸZookeeperå®ç°åˆ†å¸ƒå¼é”" class="headerlink" title="åŸç”ŸZookeeperå®ç°åˆ†å¸ƒå¼é”"></a>åŸç”ŸZookeeperå®ç°åˆ†å¸ƒå¼é”</h2><p>åˆ†å¸ƒå¼é”ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.zookeeper.lock;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.zookeeper.*;</span><br><span class="line"><span class="keyword">import</span> org.apache.zookeeper.data.Stat;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.nio.charset.StandardCharsets;</span><br><span class="line"><span class="keyword">import</span> java.util.Collections;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.CountDownLatch;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DistributedLock</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">String</span> <span class="variable">connectString</span> <span class="operator">=</span> <span class="string">&quot;192.168.100.100:2181,192.168.100.110:2181,192.168.100.120:2181&quot;</span>;</span><br><span class="line">    <span class="comment">// æ³¨æ„ï¼Œè¯¥å€¼åœ¨ç¡®ä¿ç½‘ç»œï¼Œé˜²ç«å¢™å…³é—­çš„æƒ…å†µä¸‹ï¼Œå€¼åº”è¯¥è®¾ç½®å¤§ä¸€ç‚¹</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">int</span> <span class="variable">sessionTimeout</span> <span class="operator">=</span> <span class="number">100000</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">ZooKeeper</span> <span class="variable">zooKeeper</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">String</span> <span class="variable">rootNode</span> <span class="operator">=</span> <span class="string">&quot;/locks&quot;</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">String</span> <span class="variable">subNodePrefix</span> <span class="operator">=</span> <span class="string">&quot;/seq-&quot;</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">CountDownLatch</span> <span class="variable">connectLatch</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CountDownLatch</span>(<span class="number">1</span>);</span><br><span class="line">    <span class="keyword">private</span> <span class="type">CountDownLatch</span> <span class="variable">waitLatch</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CountDownLatch</span>(<span class="number">1</span>);</span><br><span class="line">    <span class="keyword">private</span> <span class="type">String</span> <span class="variable">currentNode</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">String</span> <span class="variable">waitNode</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * åˆ›å»ºèŠ‚ç‚¹</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">DistributedLock</span><span class="params">()</span> <span class="keyword">throws</span> IOException, InterruptedException, KeeperException &#123;</span><br><span class="line">        zooKeeper = <span class="keyword">new</span> <span class="title class_">ZooKeeper</span>(connectString, sessionTimeout, <span class="keyword">new</span> <span class="title class_">Watcher</span>() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">process</span><span class="params">(WatchedEvent watchedEvent)</span> &#123;</span><br><span class="line">                <span class="comment">// ç›‘å¬è¿æ¥äº‹ä»¶</span></span><br><span class="line">                <span class="keyword">if</span> (watchedEvent.getState() == Event.KeeperState.SyncConnected) &#123;</span><br><span class="line">                    connectLatch.countDown();</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">// ç›‘å¬ä¸Šä¸€ä¸ªèŠ‚ç‚¹</span></span><br><span class="line">                <span class="keyword">if</span> (watchedEvent.getType() == Event.EventType.NodeDeleted &amp;&amp; watchedEvent.getPath().equals(waitNode)) &#123;</span><br><span class="line">                    waitLatch.countDown();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="comment">// ç­‰å¾…è¿æ¥å®Œæˆï¼Œåˆ›å»ºèŠ‚ç‚¹</span></span><br><span class="line">        connectLatch.await();</span><br><span class="line">        <span class="comment">// åˆ¤æ–­èŠ‚ç‚¹æ˜¯å¦å­˜åœ¨</span></span><br><span class="line">        <span class="type">Stat</span> <span class="variable">exists</span> <span class="operator">=</span> zooKeeper.exists(rootNode, <span class="literal">false</span>);</span><br><span class="line">        <span class="keyword">if</span> (exists == <span class="literal">null</span>) &#123;</span><br><span class="line">            zooKeeper.create(rootNode, rootNode.getBytes(StandardCharsets.UTF_8), ZooDefs.Ids.OPEN_ACL_UNSAFE, CreateMode.PERSISTENT);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * åŠ é”ï¼šå³åˆ›å»ºä¸´æ—¶æœ‰åºçš„å­èŠ‚ç‚¹ï¼Œå¦‚æœæœ‰å¤šä¸ªï¼Œåˆ™æ’åºç­‰å¾…å‰ä¸€ä¸ªé‡Šæ”¾é”</span></span><br><span class="line"><span class="comment">     * é‡Šæ”¾é”ï¼šåˆ é™¤è¯¥å­èŠ‚ç‚¹</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">zkLock</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException, KeeperException &#123;</span><br><span class="line">        currentNode = zooKeeper.create(rootNode + subNodePrefix, <span class="literal">null</span>,</span><br><span class="line">                ZooDefs.Ids.OPEN_ACL_UNSAFE, CreateMode.EPHEMERAL_SEQUENTIAL);</span><br><span class="line">        <span class="comment">// æ–¹ä¾¿æµ‹è¯•</span></span><br><span class="line">        Thread.sleep(<span class="number">10</span>);</span><br><span class="line">        List&lt;String&gt; children = zooKeeper.getChildren(rootNode, <span class="literal">false</span>);</span><br><span class="line">        <span class="keyword">if</span> (children.size() == <span class="number">1</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            Collections.sort(children);</span><br><span class="line">            <span class="type">String</span> <span class="variable">thisNode</span> <span class="operator">=</span> currentNode.substring(rootNode.length() + <span class="number">1</span>);</span><br><span class="line">            System.out.println(<span class="string">&quot;thisNode: &quot;</span> + thisNode);</span><br><span class="line">            <span class="type">int</span> <span class="variable">index</span> <span class="operator">=</span> children.indexOf(thisNode);</span><br><span class="line">            <span class="keyword">if</span> (index == -<span class="number">1</span>) &#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;æ•°æ®å¼‚å¸¸&quot;</span>);</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (index == <span class="number">0</span>) &#123;</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                waitNode = rootNode + <span class="string">&quot;/&quot;</span> + children.get(index - <span class="number">1</span>);</span><br><span class="line">                System.out.println(<span class="string">&quot;waitNode: &quot;</span> + waitNode);</span><br><span class="line">                zooKeeper.getData(waitNode, <span class="literal">true</span>, <span class="keyword">new</span> <span class="title class_">Stat</span>());</span><br><span class="line">                waitLatch.await();</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è§£é”</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">zkUnlock</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// åˆ é™¤èŠ‚ç‚¹ï¼Œè®¾ç½®ç‰ˆæœ¬</span></span><br><span class="line">            zooKeeper.delete(<span class="built_in">this</span>.currentNode, -<span class="number">1</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException | KeeperException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æµ‹è¯•åˆ†å¸ƒå¼é”ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.zookeeper.lock;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.zookeeper.KeeperException;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DistributedLockTest</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException, InterruptedException, KeeperException &#123;</span><br><span class="line">        <span class="type">DistributedLock</span> <span class="variable">distributedLock01</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DistributedLock</span>();</span><br><span class="line">        <span class="type">DistributedLock</span> <span class="variable">distributedLock02</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DistributedLock</span>();</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(<span class="keyword">new</span> <span class="title class_">Runnable</span>() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    distributedLock01.zkLock();</span><br><span class="line">                    System.out.println(<span class="string">&quot;Thread01 ä¸Šé”...&quot;</span>);</span><br><span class="line">                    Thread.sleep(<span class="number">1000</span>);</span><br><span class="line">                    distributedLock01.zkUnlock();</span><br><span class="line">                    System.out.println(<span class="string">&quot;Thread01 è§£é”...&quot;</span>);</span><br><span class="line">                &#125; <span class="keyword">catch</span> (InterruptedException | KeeperException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;, <span class="string">&quot;Thread01&quot;</span>).start();</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(<span class="keyword">new</span> <span class="title class_">Runnable</span>() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    distributedLock02.zkLock();</span><br><span class="line">                    System.out.println(<span class="string">&quot;Thread02 ä¸Šé”...&quot;</span>);</span><br><span class="line">                    Thread.sleep(<span class="number">1000</span>);</span><br><span class="line">                    distributedLock02.zkUnlock();</span><br><span class="line">                    System.out.println(<span class="string">&quot;Thread02 è§£é”...&quot;</span>);</span><br><span class="line">                &#125; <span class="keyword">catch</span> (InterruptedException | KeeperException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;, <span class="string">&quot;Thread02&quot;</span>).start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æµ‹è¯•ç»“æœï¼š</p>
<p>Thread02 ä¸Šé”â€¦</p>
<p>Thread02 è§£é”â€¦</p>
<p>Thread01 ä¸Šé”â€¦</p>
<p>Thread01 è§£é”â€¦</p>
<h2 id="Curator-æ¡†æ¶å®ç°åˆ†å¸ƒå¼é”"><a href="#Curator-æ¡†æ¶å®ç°åˆ†å¸ƒå¼é”" class="headerlink" title="Curator æ¡†æ¶å®ç°åˆ†å¸ƒå¼é”"></a>Curator æ¡†æ¶å®ç°åˆ†å¸ƒå¼é”</h2><h3 id="åŸç”Ÿçš„-Java-API-å¼€å‘å­˜åœ¨çš„é—®é¢˜"><a href="#åŸç”Ÿçš„-Java-API-å¼€å‘å­˜åœ¨çš„é—®é¢˜" class="headerlink" title="åŸç”Ÿçš„ Java API å¼€å‘å­˜åœ¨çš„é—®é¢˜"></a>åŸç”Ÿçš„ Java API å¼€å‘å­˜åœ¨çš„é—®é¢˜</h3><p>ï¼ˆ1ï¼‰ä¼šè¯è¿æ¥æ˜¯å¼‚æ­¥çš„ï¼Œéœ€è¦è‡ªå·±å»å¤„ç†ã€‚æ¯”å¦‚ä½¿ç”¨ CountDownLatch</p>
<p> ï¼ˆ2ï¼‰Watch éœ€è¦é‡å¤æ³¨å†Œï¼Œä¸ç„¶å°±ä¸èƒ½ç”Ÿæ•ˆ </p>
<p>ï¼ˆ3ï¼‰å¼€å‘çš„å¤æ‚æ€§è¿˜æ˜¯æ¯”è¾ƒé«˜çš„ </p>
<p>ï¼ˆ4ï¼‰ä¸æ”¯æŒå¤šèŠ‚ç‚¹åˆ é™¤å’Œåˆ›å»ºã€‚éœ€è¦è‡ªå·±å»é€’å½’</p>
<blockquote>
<p>Curator æ˜¯ä¸€ä¸ªä¸“é—¨è§£å†³åˆ†å¸ƒå¼é”çš„æ¡†æ¶ï¼Œè§£å†³äº†åŸç”Ÿ JavaAPI å¼€å‘åˆ†å¸ƒå¼é‡åˆ°çš„é—®é¢˜ã€‚ </p>
<p>è¯¦æƒ…è¯·æŸ¥çœ‹å®˜æ–¹æ–‡æ¡£ï¼š<a href="https://curator.apache.org/index.html">https://curator.apache.org/index.html</a></p>
</blockquote>
<h3 id="Curator-ç¤ºä¾‹"><a href="#Curator-ç¤ºä¾‹" class="headerlink" title="Curator ç¤ºä¾‹"></a>Curator ç¤ºä¾‹</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.zookeeper.lock;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.curator.framework.CuratorFramework;</span><br><span class="line"><span class="keyword">import</span> org.apache.curator.framework.CuratorFrameworkFactory;</span><br><span class="line"><span class="keyword">import</span> org.apache.curator.framework.recipes.locks.InterProcessMutex;</span><br><span class="line"><span class="keyword">import</span> org.apache.curator.retry.ExponentialBackoffRetry;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CuratorLockTest</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">// åˆ›å»ºåˆ†å¸ƒå¼é”1</span></span><br><span class="line">        <span class="type">InterProcessMutex</span> <span class="variable">lock1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">InterProcessMutex</span>(getCuratorFramework(), <span class="string">&quot;/locks&quot;</span>);</span><br><span class="line">        <span class="comment">// åˆ›å»ºåˆ†å¸ƒå¼é”2</span></span><br><span class="line">        <span class="type">InterProcessMutex</span> <span class="variable">lock2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">InterProcessMutex</span>(getCuratorFramework(), <span class="string">&quot;/locks&quot;</span>);</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(<span class="keyword">new</span> <span class="title class_">Runnable</span>() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    lock1.acquire();</span><br><span class="line">                    System.out.println(<span class="string">&quot;çº¿ç¨‹1 è·å–åˆ°é”&quot;</span>);</span><br><span class="line">                    lock1.acquire();</span><br><span class="line">                    System.out.println(<span class="string">&quot;çº¿ç¨‹1 å†æ¬¡è·å–åˆ°é”(å¯é‡å…¥é”)&quot;</span>);</span><br><span class="line">                    Thread.sleep(<span class="number">2</span> * <span class="number">1000</span>);</span><br><span class="line">                    lock1.release();</span><br><span class="line">                    System.out.println(<span class="string">&quot;çº¿ç¨‹1 é‡Šæ”¾é”&quot;</span>);</span><br><span class="line">                    lock1.release();</span><br><span class="line">                    System.out.println(<span class="string">&quot;çº¿ç¨‹1 å†æ¬¡é‡Šæ”¾é”&quot;</span>);</span><br><span class="line">                &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;).start();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(<span class="keyword">new</span> <span class="title class_">Runnable</span>() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    lock2.acquire();</span><br><span class="line">                    System.out.println(<span class="string">&quot;çº¿ç¨‹2 è·å–åˆ°é”&quot;</span>);</span><br><span class="line">                    lock2.acquire();</span><br><span class="line">                    System.out.println(<span class="string">&quot;çº¿ç¨‹2 å†æ¬¡è·å–åˆ°é”&quot;</span>);</span><br><span class="line">                    Thread.sleep(<span class="number">2</span> * <span class="number">1000</span>);</span><br><span class="line">                    lock2.release();</span><br><span class="line">                    System.out.println(<span class="string">&quot;çº¿ç¨‹2 é‡Šæ”¾é”&quot;</span>);</span><br><span class="line">                    lock2.release();</span><br><span class="line">                    System.out.println(<span class="string">&quot;çº¿ç¨‹2  å†æ¬¡é‡Šæ”¾é”&quot;</span>);</span><br><span class="line">                &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;).start();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> CuratorFramework <span class="title function_">getCuratorFramework</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// 3ç§’è¿æ¥ä¸ä¸Šé‡è¯•</span></span><br><span class="line">        <span class="type">ExponentialBackoffRetry</span> <span class="variable">policy</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ExponentialBackoffRetry</span>(<span class="number">3000</span>, <span class="number">3</span>);</span><br><span class="line">        <span class="type">CuratorFramework</span> <span class="variable">client</span> <span class="operator">=</span> CuratorFrameworkFactory</span><br><span class="line">                .builder()</span><br><span class="line">                .connectString(<span class="string">&quot;192.168.100.100:2181,192.168.100.110:2181,192.168.100.120:2181&quot;</span>)</span><br><span class="line">                .connectionTimeoutMs(<span class="number">2000</span>)</span><br><span class="line">                .sessionTimeoutMs(<span class="number">2000</span>)</span><br><span class="line">                .retryPolicy(policy).build();</span><br><span class="line">        <span class="comment">// å¯åŠ¨å®¢æˆ·ç«¯</span></span><br><span class="line">        client.start();</span><br><span class="line">        System.out.println(<span class="string">&quot;zookeeper å¯åŠ¨æˆåŠŸ&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> client;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æµ‹è¯•ç»“æœï¼š</p>
<p>çº¿ç¨‹2 è·å–åˆ°é”<br>çº¿ç¨‹2 å†æ¬¡è·å–åˆ°é”<br>çº¿ç¨‹2 é‡Šæ”¾é”<br>çº¿ç¨‹2  å†æ¬¡é‡Šæ”¾é”<br>çº¿ç¨‹1 è·å–åˆ°é”<br>çº¿ç¨‹1 å†æ¬¡è·å–åˆ°é”(å¯é‡å…¥é”)<br>çº¿ç¨‹1 é‡Šæ”¾é”<br>çº¿ç¨‹1 å†æ¬¡é‡Šæ”¾é”</p>
<h1 id="ä¸¤ä¸ªé—®é¢˜"><a href="#ä¸¤ä¸ªé—®é¢˜" class="headerlink" title="ä¸¤ä¸ªé—®é¢˜"></a>ä¸¤ä¸ªé—®é¢˜</h1><h2 id="é€‰ä¸¾æœºåˆ¶-1"><a href="#é€‰ä¸¾æœºåˆ¶-1" class="headerlink" title="é€‰ä¸¾æœºåˆ¶"></a>é€‰ä¸¾æœºåˆ¶</h2><p>åŠæ•°æœºåˆ¶ï¼Œè¶…è¿‡åŠæ•°çš„æŠ•ç¥¨é€šè¿‡ï¼Œå³é€šè¿‡ã€‚ </p>
<p>ï¼ˆ1ï¼‰ç¬¬ä¸€æ¬¡å¯åŠ¨é€‰ä¸¾è§„åˆ™ï¼š æŠ•ç¥¨è¿‡åŠæ•°æ—¶ï¼ŒæœåŠ¡å™¨ id å¤§çš„èƒœå‡º </p>
<p>ï¼ˆ2ï¼‰ç¬¬äºŒæ¬¡å¯åŠ¨é€‰ä¸¾è§„åˆ™ï¼š </p>
<ul>
<li>â€‹	EPOCH å¤§çš„ç›´æ¥èƒœå‡º </li>
<li>â€‹	EPOCH ç›¸åŒï¼Œäº‹åŠ¡ id å¤§çš„èƒœå‡º </li>
<li>â€‹	äº‹åŠ¡ id ç›¸åŒï¼ŒæœåŠ¡å™¨ id å¤§çš„èƒœå‡º</li>
</ul>
<h2 id="ç”Ÿäº§é›†ç¾¤å®‰è£…å¤šå°‘-zk-åˆé€‚ï¼Ÿ"><a href="#ç”Ÿäº§é›†ç¾¤å®‰è£…å¤šå°‘-zk-åˆé€‚ï¼Ÿ" class="headerlink" title="ç”Ÿäº§é›†ç¾¤å®‰è£…å¤šå°‘ zk åˆé€‚ï¼Ÿ"></a>ç”Ÿäº§é›†ç¾¤å®‰è£…å¤šå°‘ zk åˆé€‚ï¼Ÿ</h2><p>å®‰è£…å¥‡æ•°å°ã€‚ </p>
<p>ç”Ÿäº§ç»éªŒï¼š </p>
<p>10 å°æœåŠ¡å™¨ï¼š3 å° zkï¼› </p>
<p>20 å°æœåŠ¡å™¨ï¼š5 å° zkï¼› </p>
<p>100 å°æœåŠ¡å™¨ï¼š11 å° zkï¼› </p>
<p>200 å°æœåŠ¡å™¨ï¼š11 å° zk ï¼›</p>
<p><strong>æœåŠ¡å™¨å°æ•°å¤šï¼šå¥½å¤„ï¼Œæé«˜å¯é æ€§ï¼›åå¤„ï¼šæé«˜é€šä¿¡å»¶æ—¶</strong></p>
<h1 id="æºç åˆ†æ"><a href="#æºç åˆ†æ" class="headerlink" title="æºç åˆ†æ"></a>æºç åˆ†æ</h1><h2 id="Zookeeper-æ˜¯å¦‚ä½•ä¿è¯æ•°æ®ä¸€è‡´æ€§çš„ï¼Ÿ"><a href="#Zookeeper-æ˜¯å¦‚ä½•ä¿è¯æ•°æ®ä¸€è‡´æ€§çš„ï¼Ÿ" class="headerlink" title="Zookeeper æ˜¯å¦‚ä½•ä¿è¯æ•°æ®ä¸€è‡´æ€§çš„ï¼Ÿ"></a>Zookeeper æ˜¯å¦‚ä½•ä¿è¯æ•°æ®ä¸€è‡´æ€§çš„ï¼Ÿ</h2>]]></content>
  </entry>
  <entry>
    <title>SpringBoot</title>
    <url>/2023/02/28/SpringBoot2/</url>
    <content><![CDATA[<h1 id><a href="#" class="headerlink" title></a></h1><h1 id="SpringBoot2"><a href="#SpringBoot2" class="headerlink" title="SpringBoot2"></a>SpringBoot2</h1><p>æ–‡æ¡£ï¼š<a href="https://docs.spring.io/spring-boot/docs/current/reference/html/index.html">https://docs.spring.io/spring-boot/docs/current/reference/html/index.html</a></p>
<p>æ–‡æ¡£ä¸‹è½½åœ°å€</p>
<p><img src="/2023/02/28/SpringBoot2/Java\SpringBoot\SpringBoot2.assets\image-20220507090740301.png" alt="image-20220507090740301"></p>
<h1 id="æ¦‚è¿°"><a href="#æ¦‚è¿°" class="headerlink" title="æ¦‚è¿°"></a>æ¦‚è¿°</h1><h2 id="System-Requirements"><a href="#System-Requirements" class="headerlink" title="System Requirements"></a>System Requirements</h2><p>Spring Boot 2.6.7 requires <a href="https://www.java.com/">Java 8</a> and is compatible up to and including Java 17. <a href="https://docs.spring.io/spring-framework/docs/5.3.19/reference/html/">Spring Framework 5.3.19</a> or above is also required.</p>
<p>Explicit build support is provided for the following build tools:</p>
<table>
<thead>
<tr>
<th align="left">Build Tool</th>
<th align="left">Version</th>
</tr>
</thead>
<tbody><tr>
<td align="left">Maven</td>
<td align="left">3.5+</td>
</tr>
<tr>
<td align="left">Gradle</td>
<td align="left">6.8.x, 6.9.x, and 7.x</td>
</tr>
</tbody></table>
<h2 id="Servlet-Containers"><a href="#Servlet-Containers" class="headerlink" title="Servlet Containers"></a>Servlet Containers</h2><p>Spring Boot supports the following embedded servlet containers:</p>
<table>
<thead>
<tr>
<th align="left">Name</th>
<th align="left">Servlet Version</th>
</tr>
</thead>
<tbody><tr>
<td align="left">Tomcat 9.0</td>
<td align="left">4.0</td>
</tr>
<tr>
<td align="left">Jetty 9.4</td>
<td align="left">3.1</td>
</tr>
<tr>
<td align="left">Jetty 10.0</td>
<td align="left">4.0</td>
</tr>
<tr>
<td align="left">Undertow 2.0</td>
<td align="left">4.0</td>
</tr>
</tbody></table>
<p>You can also deploy Spring Boot applications to any servlet 3.1+ compatible container.</p>
<h2 id="What-Spring-can-do"><a href="#What-Spring-can-do" class="headerlink" title="What Spring can do"></a>What Spring can do</h2><p><img src="/2023/02/28/SpringBoot2/Java\SpringBoot\SpringBoot2.assets\image-20220507084619581.png" alt="image-20220507084619581"></p>
<h2 id="1-3ã€Spring5é‡å¤§å‡çº§"><a href="#1-3ã€Spring5é‡å¤§å‡çº§" class="headerlink" title="1.3ã€Spring5é‡å¤§å‡çº§"></a>1.3ã€Spring5é‡å¤§å‡çº§</h2><h3 id="1-3-1ã€å“åº”å¼ç¼–ç¨‹"><a href="#1-3-1ã€å“åº”å¼ç¼–ç¨‹" class="headerlink" title="1.3.1ã€å“åº”å¼ç¼–ç¨‹"></a>1.3.1ã€å“åº”å¼ç¼–ç¨‹</h3><p><img src="/2023/02/28/SpringBoot2/Users\s\Desktop\spring5.png" alt="spring5"></p>
<h2 id="2-1ã€SpringBootä¼˜ç‚¹"><a href="#2-1ã€SpringBootä¼˜ç‚¹" class="headerlink" title="2.1ã€SpringBootä¼˜ç‚¹"></a>2.1ã€SpringBootä¼˜ç‚¹</h2><ul>
<li><p>Create stand-alone Spring applications</p>
</li>
<li><ul>
<li>åˆ›å»ºç‹¬ç«‹Springåº”ç”¨</li>
</ul>
</li>
<li><p>Embed Tomcat, Jetty or Undertow directly (no need to deploy WAR files)</p>
</li>
<li><ul>
<li>å†…åµŒwebæœåŠ¡å™¨</li>
</ul>
</li>
<li><p>Provide opinionated â€˜starterâ€™ dependencies to simplify your build configuration</p>
</li>
<li><ul>
<li>è‡ªåŠ¨starterä¾èµ–ï¼Œç®€åŒ–æ„å»ºé…ç½®</li>
</ul>
</li>
<li><p>Automatically configure Spring and 3rd party libraries whenever possible</p>
</li>
<li><ul>
<li>è‡ªåŠ¨é…ç½®Springä»¥åŠç¬¬ä¸‰æ–¹åŠŸèƒ½</li>
</ul>
</li>
<li><p>Provide production-ready features such as metrics, health checks, and externalized configuration</p>
</li>
<li><ul>
<li>æä¾›ç”Ÿäº§çº§åˆ«çš„ç›‘æ§ã€å¥åº·æ£€æŸ¥åŠå¤–éƒ¨åŒ–é…ç½®</li>
</ul>
</li>
<li><p>Absolutely no code generation and no requirement for XML configuration</p>
</li>
<li><ul>
<li>æ— ä»£ç ç”Ÿæˆã€æ— éœ€ç¼–å†™XML</li>
</ul>
</li>
</ul>
<p>SpringBootæ˜¯æ•´åˆSpringæŠ€æœ¯æ ˆçš„ä¸€ç«™å¼æ¡†æ¶</p>
<p>SpringBootæ˜¯ç®€åŒ–SpringæŠ€æœ¯æ ˆçš„å¿«é€Ÿå¼€å‘è„šæ‰‹æ¶</p>
<h2 id="2-2ã€SpringBootç¼ºç‚¹"><a href="#2-2ã€SpringBootç¼ºç‚¹" class="headerlink" title="2.2ã€SpringBootç¼ºç‚¹"></a>2.2ã€SpringBootç¼ºç‚¹</h2><ul>
<li>äººç§°ç‰ˆæœ¬å¸ï¼Œè¿­ä»£å¿«ï¼Œéœ€è¦æ—¶åˆ»å…³æ³¨å˜åŒ–</li>
<li>å°è£…å¤ªæ·±ï¼Œå†…éƒ¨åŸç†å¤æ‚ï¼Œä¸å®¹æ˜“ç²¾é€š</li>
</ul>
<h1 id="3ã€æ—¶ä»£èƒŒæ™¯"><a href="#3ã€æ—¶ä»£èƒŒæ™¯" class="headerlink" title="3ã€æ—¶ä»£èƒŒæ™¯"></a>3ã€æ—¶ä»£èƒŒæ™¯</h1><h2 id="3-1ã€å¾®æœåŠ¡"><a href="#3-1ã€å¾®æœåŠ¡" class="headerlink" title="3.1ã€å¾®æœåŠ¡"></a>3.1ã€å¾®æœåŠ¡</h2><p><a href="https://martinfowler.com/articles/microservices.html">James Lewis and Martin Fowler (2014)</a>  æå‡ºå¾®æœåŠ¡å®Œæ•´æ¦‚å¿µã€‚<a href="https://martinfowler.com/microservices/">https://martinfowler.com/microservices/</a></p>
<p>In short, the <strong>microservice architectural style</strong> is an approach to developing a single application as a <strong>suite of small services</strong>, each <strong>running in its own process</strong> and communicating with <strong>lightweight</strong> mechanisms, often an <strong>HTTP</strong> resource API. These services are <strong>built around business capabilities</strong> and <strong>independently deployable</strong> by fully <strong>automated deployment</strong> machinery. There is a <strong>bare minimum of centralized management</strong> of these services, which may be <strong>written in different programming languages</strong> and use different data storage technologies.â€“ <a href="https://martinfowler.com/articles/microservices.html">James Lewis and Martin Fowler (2014)</a></p>
<ul>
<li>å¾®æœåŠ¡æ˜¯ä¸€ç§æ¶æ„é£æ ¼</li>
<li>ä¸€ä¸ªåº”ç”¨æ‹†åˆ†ä¸ºä¸€ç»„å°å‹æœåŠ¡</li>
<li>æ¯ä¸ªæœåŠ¡è¿è¡Œåœ¨è‡ªå·±çš„è¿›ç¨‹å†…ï¼Œä¹Ÿå°±æ˜¯å¯ç‹¬ç«‹éƒ¨ç½²å’Œå‡çº§</li>
<li>æœåŠ¡ä¹‹é—´ä½¿ç”¨è½»é‡çº§HTTPäº¤äº’</li>
<li>æœåŠ¡å›´ç»•ä¸šåŠ¡åŠŸèƒ½æ‹†åˆ†</li>
<li>å¯ä»¥ç”±å…¨è‡ªåŠ¨éƒ¨ç½²æœºåˆ¶ç‹¬ç«‹éƒ¨ç½²</li>
<li>å»ä¸­å¿ƒåŒ–ï¼ŒæœåŠ¡è‡ªæ²»ã€‚æœåŠ¡å¯ä»¥ä½¿ç”¨ä¸åŒçš„è¯­è¨€ã€ä¸åŒçš„å­˜å‚¨æŠ€æœ¯</li>
</ul>
<h2 id="3-2ã€åˆ†å¸ƒå¼"><a href="#3-2ã€åˆ†å¸ƒå¼" class="headerlink" title="3.2ã€åˆ†å¸ƒå¼"></a>3.2ã€åˆ†å¸ƒå¼</h2><p><img src="/2023/02/28/SpringBoot2/Users\s\Desktop\microservice.png" alt="microservice"></p>
<h3 id="åˆ†å¸ƒå¼çš„å›°éš¾"><a href="#åˆ†å¸ƒå¼çš„å›°éš¾" class="headerlink" title="åˆ†å¸ƒå¼çš„å›°éš¾"></a>åˆ†å¸ƒå¼çš„å›°éš¾</h3><ul>
<li>è¿œç¨‹è°ƒç”¨</li>
<li>æœåŠ¡å‘ç°</li>
<li>è´Ÿè½½å‡è¡¡</li>
<li>æœåŠ¡å®¹é”™</li>
<li>é…ç½®ç®¡ç†</li>
<li>æœåŠ¡ç›‘æ§</li>
<li>é“¾è·¯è¿½è¸ª</li>
<li>æ—¥å¿—ç®¡ç†</li>
<li>ä»»åŠ¡è°ƒåº¦</li>
</ul>
<h3 id="åˆ†å¸ƒå¼çš„è§£å†³"><a href="#åˆ†å¸ƒå¼çš„è§£å†³" class="headerlink" title="åˆ†å¸ƒå¼çš„è§£å†³"></a>åˆ†å¸ƒå¼çš„è§£å†³</h3><ul>
<li>SpringBoot + SpringCloud</li>
</ul>
<p><img src="/2023/02/28/SpringBoot2/Users\s\Desktop\åˆ†å¸ƒå¼è§£å†³.png" alt="åˆ†å¸ƒå¼è§£å†³"></p>
<h2 id="3-3ã€äº‘åŸç”Ÿ"><a href="#3-3ã€äº‘åŸç”Ÿ" class="headerlink" title="3.3ã€äº‘åŸç”Ÿ"></a>3.3ã€äº‘åŸç”Ÿ</h2><p>åŸç”Ÿåº”ç”¨å¦‚ä½•ä¸Šäº‘ã€‚ Cloud Native</p>
<h3 id="ä¸Šäº‘çš„å›°éš¾"><a href="#ä¸Šäº‘çš„å›°éš¾" class="headerlink" title="ä¸Šäº‘çš„å›°éš¾"></a>ä¸Šäº‘çš„å›°éš¾</h3><ul>
<li>æœåŠ¡è‡ªæ„ˆ</li>
<li>å¼¹æ€§ä¼¸ç¼©</li>
<li>æœåŠ¡éš”ç¦»</li>
<li>è‡ªåŠ¨åŒ–éƒ¨ç½²</li>
<li>ç°åº¦å‘å¸ƒ</li>
<li>æµé‡æ²»ç†</li>
</ul>
<h1 id="02ã€SpringBoot2å…¥é—¨"><a href="#02ã€SpringBoot2å…¥é—¨" class="headerlink" title="02ã€SpringBoot2å…¥é—¨"></a><strong>02ã€SpringBoot2å…¥é—¨</strong></h1><p><a href="https://docs.spring.io/spring-boot/docs/current/reference/html/getting-started.html#getting-started.first-application">https://docs.spring.io/spring-boot/docs/current/reference/html/getting-started.html#getting-started.first-application</a></p>
<p><a href="https://docs.spring.io/spring-boot/docs/current/reference/html/getting-started.html#getting-started">https://docs.spring.io/spring-boot/docs/current/reference/html/getting-started.html#getting-started</a></p>
<h2 id="1ã€ç³»ç»Ÿè¦æ±‚"><a href="#1ã€ç³»ç»Ÿè¦æ±‚" class="headerlink" title="1ã€ç³»ç»Ÿè¦æ±‚"></a>1ã€ç³»ç»Ÿè¦æ±‚</h2><ul>
<li><a href="https://www.java.com/">Java 8</a> &amp; å…¼å®¹java14 .</li>
<li>Maven 3.3+</li>
<li>idea 2021.1.2</li>
</ul>
<h3 id="1-1ã€mavenè®¾ç½®"><a href="#1-1ã€mavenè®¾ç½®" class="headerlink" title="1.1ã€mavenè®¾ç½®"></a>1.1ã€mavenè®¾ç½®</h3><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mirrors</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">mirror</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">id</span>&gt;</span>nexus-aliyun<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">mirrorOf</span>&gt;</span>central<span class="tag">&lt;/<span class="name">mirrorOf</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>Nexus aliyun<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">url</span>&gt;</span>http://maven.aliyun.com/nexus/content/groups/public<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">mirror</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">mirrors</span>&gt;</span></span><br><span class="line"> </span><br><span class="line">  <span class="tag">&lt;<span class="name">profiles</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">profile</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">id</span>&gt;</span>jdk-1.8<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">activation</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">activeByDefault</span>&gt;</span>true<span class="tag">&lt;/<span class="name">activeByDefault</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">jdk</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">jdk</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;/<span class="name">activation</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">maven.compiler.source</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">maven.compiler.source</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">maven.compiler.target</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">maven.compiler.target</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">maven.compiler.compilerVersion</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">maven.compiler.compilerVersion</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;/<span class="name">profile</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">profiles</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="2ã€HelloWorld"><a href="#2ã€HelloWorld" class="headerlink" title="2ã€HelloWorld"></a>2ã€HelloWorld</h2><p>éœ€æ±‚ï¼šè®¿é—® localhost:8080&#x2F;helloï¼Œå“åº” Helloï¼ŒSpring Boot 2 </p>
<h3 id="2-1ã€åˆ›å»ºmavenå·¥ç¨‹"><a href="#2-1ã€åˆ›å»ºmavenå·¥ç¨‹" class="headerlink" title="2.1ã€åˆ›å»ºmavenå·¥ç¨‹"></a>2.1ã€åˆ›å»ºmavenå·¥ç¨‹</h3><h3 id="2-2ã€å¼•å…¥ä¾èµ–"><a href="#2-2ã€å¼•å…¥ä¾èµ–" class="headerlink" title="2.2ã€å¼•å…¥ä¾èµ–"></a>2.2ã€å¼•å…¥ä¾èµ–</h3><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-parent<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.3.4.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="2-3ã€åˆ›å»ºä¸»ç¨‹åº"><a href="#2-3ã€åˆ›å»ºä¸»ç¨‹åº" class="headerlink" title="2.3ã€åˆ›å»ºä¸»ç¨‹åº"></a>2.3ã€åˆ›å»ºä¸»ç¨‹åº</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ä¸»ç¨‹åºç±»</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@SpringBootApplication</span>ï¼šè¿™æ˜¯ä¸€ä¸ªSpringBootåº”ç”¨</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MainApplication</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        SpringApplication.run(MainApplication.class,args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="2-4ã€ç¼–å†™ä¸šåŠ¡"><a href="#2-4ã€ç¼–å†™ä¸šåŠ¡" class="headerlink" title="2.4ã€ç¼–å†™ä¸šåŠ¡"></a>2.4ã€ç¼–å†™ä¸šåŠ¡</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HelloController</span> &#123;</span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/&quot;)</span></span><br><span class="line">    String <span class="title function_">home</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Hello World!&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/hello&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">hello</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Hello SpringBoot2!&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="2-5ã€æµ‹è¯•"><a href="#2-5ã€æµ‹è¯•" class="headerlink" title="2.5ã€æµ‹è¯•"></a>2.5ã€æµ‹è¯•</h3><p>ç›´æ¥è¿è¡Œmainæ–¹æ³•</p>
<h3 id="2-6ã€ç®€åŒ–é…ç½®"><a href="#2-6ã€ç®€åŒ–é…ç½®" class="headerlink" title="2.6ã€ç®€åŒ–é…ç½®"></a>2.6ã€ç®€åŒ–é…ç½®</h3><p>application.properties</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">server.port=<span class="number">8888</span></span><br></pre></td></tr></table></figure>

<h3 id="2-7ã€ç®€åŒ–éƒ¨ç½²"><a href="#2-7ã€ç®€åŒ–éƒ¨ç½²" class="headerlink" title="2.7ã€ç®€åŒ–éƒ¨ç½²"></a>2.7ã€ç®€åŒ–éƒ¨ç½²</h3><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>æŠŠé¡¹ç›®æ‰“æˆjaråŒ…ï¼Œç›´æ¥åœ¨ç›®æ ‡æœåŠ¡å™¨æ‰§è¡Œå³å¯ã€‚</p>
<p>java -jar SpringBoot2-HelloWorld-1.0-SNAPSHOT.jar</p>
<h1 id="è‡ªåŠ¨é…ç½®åŸç†"><a href="#è‡ªåŠ¨é…ç½®åŸç†" class="headerlink" title="è‡ªåŠ¨é…ç½®åŸç†"></a>è‡ªåŠ¨é…ç½®åŸç†</h1><h1 id="SpringBootç‰¹ç‚¹"><a href="#SpringBootç‰¹ç‚¹" class="headerlink" title="SpringBootç‰¹ç‚¹"></a>SpringBootç‰¹ç‚¹</h1><h2 id="ä¾èµ–ç®¡ç†"><a href="#ä¾èµ–ç®¡ç†" class="headerlink" title="ä¾èµ–ç®¡ç†"></a>ä¾èµ–ç®¡ç†</h2><ul>
<li><p>çˆ¶é¡¹ç›®åšä¾èµ–ç®¡ç†</p>
<blockquote>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-parent<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.7.4<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>å®ƒçš„çˆ¶é¡¹ç›®ï¼š</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-dependencies<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.7.4<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>ç‚¹å‡»å®ƒçš„çˆ¶é¡¹ç›®æŸ¥çœ‹ï¼š</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">activemq.version</span>&gt;</span>5.16.5<span class="tag">&lt;/<span class="name">activemq.version</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">antlr2.version</span>&gt;</span>2.7.7<span class="tag">&lt;/<span class="name">antlr2.version</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">appengine-sdk.version</span>&gt;</span>1.9.98<span class="tag">&lt;/<span class="name">appengine-sdk.version</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artemis.version</span>&gt;</span>2.19.1<span class="tag">&lt;/<span class="name">artemis.version</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">aspectj.version</span>&gt;</span>1.9.7<span class="tag">&lt;/<span class="name">aspectj.version</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">assertj.version</span>&gt;</span>3.22.0<span class="tag">&lt;/<span class="name">assertj.version</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">atomikos.version</span>&gt;</span>4.0.6<span class="tag">&lt;/<span class="name">atomikos.version</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>è¯¥é¡¹ç›®å‡ ä¹å£°æ˜äº†æ‰€æœ‰å¼€å‘ä¸­å¸¸ç”¨çš„ä¾èµ–çš„ç‰ˆæœ¬å·ï¼Œè‡ªåŠ¨ç‰ˆæœ¬ä»²è£æœºåˆ¶</p>
<p>åœ¨ä½¿ç”¨æ—¶ç›´æ¥å¼•å…¥ä¾èµ–å³å¯ï¼š</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>è‡ªå®šä¹‰ä¾èµ–ç‰ˆæœ¬ï¼šï¼ˆä¿®æ”¹é»˜è®¤ç‰ˆæœ¬å·ï¼‰</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mysql.version</span>&gt;</span>5.1.40<span class="tag">&lt;/<span class="name">mysql.version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br></pre></td></tr></table></figure>
</blockquote>
</li>
<li><p>å¼€å‘å¯¼å…¥starteråœºæ™¯å¯åŠ¨å™¨</p>
<blockquote>
<ol>
<li><p>spring-boot-starter-* ï¼š *å°±æŸç§åœºæ™¯</p>
</li>
<li><p>åªè¦å¼•å…¥starterï¼Œè¿™ä¸ªåœºæ™¯çš„æ‰€æœ‰å¸¸è§„ä¾èµ–éƒ½ä¼šè‡ªåŠ¨å¼•å…¥</p>
</li>
<li><p>SpringBootæ‰€æœ‰æ”¯æŒçš„åœºæ™¯</p>
<p> <a href="https://docs.spring.io/spring-boot/docs/current/reference/html/using-spring-boot.html#using-boot-starter">https://docs.spring.io/spring-boot/docs/current/reference/html/using-spring-boot.html#using-boot-starter</a></p>
</li>
<li><p>ç¬¬ä¸‰æ–¹åœºæ™¯å¯åŠ¨å™¨ï¼š*-spring-boot-starter</p>
</li>
<li><p>æ‰€æœ‰åœºæ™¯å¯åŠ¨å™¨æœ€åº•å±‚çš„ä¾èµ–</p>
 <figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.7.4<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">scope</span>&gt;</span>compile<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
</ol>
</blockquote>
</li>
</ul>
<h2 id="è‡ªåŠ¨é…ç½®"><a href="#è‡ªåŠ¨é…ç½®" class="headerlink" title="è‡ªåŠ¨é…ç½®"></a>è‡ªåŠ¨é…ç½®</h2><p>SpringBootä¼šæ ¹æ®å¼•å…¥çš„åœºæ™¯ï¼Œè‡ªåŠ¨é…ç½®å¥½ç›¸åº”çš„ç»„ä»¶ã€‚</p>
<blockquote>
<ul>
<li><p>è‡ªåŠ¨é…ç½®å¥½ Tomcat</p>
  <figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-tomcat<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.7.4<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>è‡ªåŠ¨é…ç½®å¥½ SpringMVC ä»¥åŠå¸¸ç”¨ç»„ä»¶</p>
</li>
<li><p>é»˜è®¤çš„åŒ…ç»“æ„ï¼š</p>
<ol>
<li>ä¸»ç¨‹åºæ‰€åœ¨åŒ…åŠå…¶ä¸‹é¢çš„æ‰€æœ‰å­åŒ…é‡Œé¢çš„ç»„ä»¶éƒ½ä¼šè¢«é»˜è®¤æ‰«æè¿›æ¥ï¼Œæ— éœ€é…ç½®Springçš„åŒ…æ‰«æ</li>
<li>å¯ä»¥é€šè¿‡æ³¨è§£å±æ€§æ”¹å˜æ‰«æè·¯å¾„ï¼š@SpringBootApplication(scanBasePackages&#x3D;â€com.exampleâ€)</li>
<li>æˆ–è€…é€šè¿‡ @ComponentScan æŒ‡å®šæ‰«æè·¯å¾„ã€@ComponentScan æ˜¯ä¸é‡å¤æ³¨è§£ã€‘</li>
</ol>
  <figure class="highlight java"><table><tr><td class="code"><pre><span class="line">com</span><br><span class="line"> +- example</span><br><span class="line">     +- myapplication</span><br><span class="line">         +- MyApplication.java</span><br><span class="line">         |</span><br><span class="line">         +- customer</span><br><span class="line">         |   +- Customer.java</span><br><span class="line">         |   +- CustomerController.java</span><br><span class="line">         |   +- CustomerService.java</span><br><span class="line">         |   +- CustomerRepository.java</span><br><span class="line">         |</span><br><span class="line">         +- order</span><br><span class="line">             +- Order.java</span><br><span class="line">             +- OrderController.java</span><br><span class="line">             +- OrderService.java</span><br><span class="line">             +- OrderRepository.java</span><br></pre></td></tr></table></figure>
</li>
<li><p>å„ç§é…ç½®æ‹¥æœ‰é»˜è®¤å€¼</p>
</li>
<li><p>æŒ‰éœ€åŠ è½½æ‰€æœ‰è‡ªåŠ¨é…ç½®é¡¹</p>
<p>  é¡¹ç›®å¼•å…¥äº†é‚£ç§åœºæ™¯å¯åŠ¨å™¨ï¼Œæ”¹å¯åŠ¨å™¨çš„è‡ªåŠ¨é…ç½®å°±ä¼šå¼€å¯ã€‚</p>
<p>  SpringBootæ‰€æœ‰çš„è‡ªåŠ¨é…ç½®åŠŸèƒ½éƒ½åœ¨ spring-boot-autoconfigure åŒ…é‡Œé¢</p>
</li>
</ul>
</blockquote>
<h1 id="å®¹å™¨åŠŸèƒ½"><a href="#å®¹å™¨åŠŸèƒ½" class="headerlink" title="å®¹å™¨åŠŸèƒ½"></a>å®¹å™¨åŠŸèƒ½</h1><h2 id="ç»„ä»¶æ·»åŠ "><a href="#ç»„ä»¶æ·»åŠ " class="headerlink" title="ç»„ä»¶æ·»åŠ "></a>ç»„ä»¶æ·»åŠ </h2><h3 id="Configuration"><a href="#Configuration" class="headerlink" title="@Configuration"></a>@Configuration</h3><blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Target(&#123;ElementType.TYPE&#125;)</span></span><br><span class="line"><span class="meta">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class="line"><span class="meta">@Documented</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> Configuration &#123;</span><br><span class="line">    <span class="meta">@AliasFor(</span></span><br><span class="line"><span class="meta">        annotation = Component.class</span></span><br><span class="line"><span class="meta">    )</span></span><br><span class="line">    String <span class="title function_">value</span><span class="params">()</span> <span class="keyword">default</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="type">boolean</span> <span class="title function_">proxyBeanMethods</span><span class="params">()</span> <span class="keyword">default</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>Fullæ¨¡å¼ä¸Liteæ¨¡å¼</strong></p>
<ol>
<li>Full(proxyBeanMethods &#x3D; true)ï¼š<ul>
<li>ä¿è¯æ¯ä¸ª@Beanæ–¹æ³•è¢«è°ƒç”¨å¤šå°‘æ¬¡(ç”±å®¹å™¨è·å–æˆ–è€…é…ç½®ç±»è°ƒç”¨)è¿”å›çš„ç»„ä»¶éƒ½æ˜¯å•å®ä¾‹</li>
<li>æ­¤æ—¶ä»å®¹å™¨ä¸­è·å–çš„MyConfigæ˜¯ä»£ç†ç±»ï¼Œ@Beanæ–¹æ³•æ˜¯æœ‰é…ç½®ç±»è°ƒç”¨è¿˜æœ‰ä»å®¹å™¨ä¸­è·å–ï¼Œéƒ½æ˜¯åŒä¸€ä¸ªå¯¹è±¡</li>
<li>ç”±ä»£ç†å¯¹è±¡è°ƒç”¨æ–¹æ³•ï¼ŒSpringBootæ€»ä¼šæ£€æŸ¥è¿™ä¸ªç»„ä»¶æ˜¯å¦åœ¨å®¹å™¨ä¸­ï¼Œå¦‚æœæœ‰åˆ™ç›´æ¥è·å–</li>
</ul>
</li>
<li>Lite(proxyBeanMethods &#x3D; false)ï¼š<ul>
<li>æ¯ä¸ª@Beanæ–¹æ³•è¢«è°ƒç”¨å¤šå°‘æ¬¡è¿”å›çš„ç»„ä»¶éƒ½æ˜¯æ–°åˆ›å»ºçš„</li>
</ul>
</li>
</ol>
<p><strong>åº”ç”¨ç¤ºä¾‹</strong></p>
<p>beanï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.springboot.bean;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> age;</span><br><span class="line">    <span class="keyword">private</span> Pet pet;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">User</span><span class="params">()</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">User</span><span class="params">(String name, <span class="type">int</span> age)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">        <span class="built_in">this</span>.age = age;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getName</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setName</span><span class="params">(String name)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getAge</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> age;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setAge</span><span class="params">(<span class="type">int</span> age)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.age = age;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Pet <span class="title function_">getPet</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> pet;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setPet</span><span class="params">(Pet pet)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.pet = pet;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;User&#123;&quot;</span> +</span><br><span class="line">                <span class="string">&quot;name=&#x27;&quot;</span> + name + <span class="string">&#x27;\&#x27;&#x27;</span> +</span><br><span class="line">                <span class="string">&quot;, age=&quot;</span> + age +</span><br><span class="line">                <span class="string">&quot;, pet=&quot;</span> + pet +</span><br><span class="line">                <span class="string">&#x27;&#125;&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.springboot.bean;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Pet</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Pet</span><span class="params">()</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Pet</span><span class="params">(String name)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getName</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setName</span><span class="params">(String name)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Pet&#123;&quot;</span> +</span><br><span class="line">                <span class="string">&quot;name=&#x27;&quot;</span> + name + <span class="string">&#x27;\&#x27;&#x27;</span> +</span><br><span class="line">                <span class="string">&#x27;&#125;&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>é…ç½®ç±»ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.springboot.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.example.springboot.bean.Pet;</span><br><span class="line"><span class="keyword">import</span> com.example.springboot.bean.User;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * é…ç½®ç±»ä¹Ÿæ˜¯ç»„ä»¶</span></span><br><span class="line"><span class="comment"> * proxyBeanMethods: ä»£ç†beançš„æ–¹æ³•</span></span><br><span class="line"><span class="comment"> *      Full(proxyBeanMethods = true)ï¼š</span></span><br><span class="line"><span class="comment"> *          ä¿è¯æ¯ä¸ª<span class="doctag">@Bean</span>æ–¹æ³•è¢«è°ƒç”¨å¤šå°‘æ¬¡è¿”å›çš„ç»„ä»¶éƒ½æ˜¯å•å®ä¾‹</span></span><br><span class="line"><span class="comment"> *          æ­¤æ—¶ä»å®¹å™¨ä¸­è·å–çš„MyConfigæ˜¯ä»£ç†ç±»ï¼Œ<span class="doctag">@Bean</span>æ–¹æ³•æ˜¯æœ‰é…ç½®ç±»è°ƒç”¨è¿˜æœ‰ä»å®¹å™¨ä¸­è·å–ï¼Œéƒ½æ˜¯åŒä¸€ä¸ªå¯¹è±¡</span></span><br><span class="line"><span class="comment"> *          ç”±ä»£ç†å¯¹è±¡è°ƒç”¨æ–¹æ³•ï¼ŒSpringBootæ€»ä¼šæ£€æŸ¥è¿™ä¸ªç»„ä»¶æ˜¯å¦åœ¨å®¹å™¨ä¸­ï¼Œå¦‚æœæœ‰åˆ™ç›´æ¥è·å–</span></span><br><span class="line"><span class="comment"> *      Lite(proxyBeanMethods = false)ï¼šæ¯ä¸ª<span class="doctag">@Bean</span>æ–¹æ³•è¢«è°ƒç”¨å¤šå°‘æ¬¡è¿”å›çš„ç»„ä»¶éƒ½æ˜¯æ–°åˆ›å»ºçš„</span></span><br><span class="line"><span class="comment"> *      ä½¿ç”¨åœºæ™¯ï¼šå¦‚æœç¡®å®šè¯¥ç»„ä»¶ä¸è¢«å…¶ä»–ç»„ä»¶ä¾èµ–ï¼Œåˆ™ä½¿ç”¨falseï¼Œå¯ä»¥æé«˜åº”ç”¨å¯åŠ¨æ•ˆç‡</span></span><br><span class="line"><span class="comment"> *      ã€ç»„ä»¶ä¾èµ–å¿…é¡»ä½¿ç”¨Fullæ¨¡å¼é»˜è®¤ã€‚å…¶ä»–é»˜è®¤æ˜¯å¦Liteæ¨¡å¼ã€‘</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Configuration(proxyBeanMethods = true)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ç»™å®¹å™¨ä¸­æ·»åŠ ç»„ä»¶ï¼Œæ–¹æ³•åä½œä¸ºç»„ä»¶çš„idï¼Œè¿”å›ç±»å‹ä½œä¸ºç»„ä»¶ç±»å‹ï¼Œå¯ä»¥ä¼ å…¥è‡ªå®šä¹‰çš„ç»„ä»¶å</span></span><br><span class="line"><span class="comment">     * ä½¿ç”¨ <span class="doctag">@Bean</span> æ ‡æ³¨åœ¨æ–¹æ³•ä¸Šç»™å®¹å™¨æ³¨å†Œç»„ä»¶ï¼Œé»˜è®¤æ˜¯å•å®ä¾‹</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> User <span class="title function_">user</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>(<span class="string">&quot;Jack&quot;</span>, <span class="number">12</span>);</span><br><span class="line">        <span class="comment">// ç»„ä»¶ä¾èµ–</span></span><br><span class="line">        user.setPet(tomcat());</span><br><span class="line">        <span class="keyword">return</span> user;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> Pet <span class="title function_">tomcat</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Pet</span>(<span class="string">&quot;tomcat&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¯åŠ¨ç±»ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.springboot;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.example.springboot.bean.Pet;</span><br><span class="line"><span class="keyword">import</span> com.example.springboot.bean.User;</span><br><span class="line"><span class="keyword">import</span> com.example.springboot.config.MyConfig;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.SpringApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.ApplicationContext;</span><br><span class="line"></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MainApplication</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">ApplicationContext</span> <span class="variable">context</span> <span class="operator">=</span> SpringApplication.run(MainApplication.class, args);</span><br><span class="line">        <span class="type">Pet</span> <span class="variable">tomcat</span> <span class="operator">=</span> context.getBean(<span class="string">&quot;tomcat&quot;</span>, Pet.class);</span><br><span class="line">        <span class="type">Pet</span> <span class="variable">tomcat01</span> <span class="operator">=</span> context.getBean(<span class="string">&quot;tomcat&quot;</span>, Pet.class);</span><br><span class="line">        System.out.println(<span class="string">&quot;tomcat == tomcat01: &quot;</span> + (tomcat == tomcat01));</span><br><span class="line">        <span class="comment">// é…ç½®ç±»æœ¬èº«ä¹Ÿæ˜¯ç»„ä»¶</span></span><br><span class="line">        <span class="type">MyConfig</span> <span class="variable">myConfig</span> <span class="operator">=</span> context.getBean(MyConfig.class);</span><br><span class="line">        System.out.println(<span class="string">&quot;MyConfig: &quot;</span> + myConfig);</span><br><span class="line">        <span class="comment">// MyConfig: 	 com.example.springboot.config.MyConfig$$EnhancerBySpringCGLIB$$c71c463c@3fbfa96</span></span><br><span class="line">        <span class="comment">// MyConfig: com.example.springboot.config.MyConfig@726a6b94</span></span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> myConfig.user();</span><br><span class="line">        <span class="type">User</span> <span class="variable">user01</span> <span class="operator">=</span> context.getBean(<span class="string">&quot;user&quot;</span>, User.class);</span><br><span class="line">        System.out.println(<span class="string">&quot;user == user01: &quot;</span> + (user == user01));</span><br><span class="line">        System.out.println(user01.getPet()==tomcat);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>ä½¿ç”¨åœºæ™¯</strong></p>
<ul>
<li>é…ç½®ç±»ç»„ä»¶ä¹‹é—´æ— ä¾èµ–å…³ç³»ç”¨Liteæ¨¡å¼åŠ é€Ÿå®¹å™¨å¯åŠ¨è¿‡ç¨‹ï¼Œå‡å°‘åˆ¤æ–­</li>
<li>é…ç½®ç±»ç»„ä»¶ä¹‹é—´æœ‰ä¾èµ–å…³ç³»ï¼Œæ–¹æ³•ä¼šè¢«è°ƒç”¨å¾—åˆ°ä¹‹å‰å•å®ä¾‹ç»„ä»¶ï¼Œç”¨Fullæ¨¡å¼</li>
</ul>
</blockquote>
<h3 id="Beanã€-Componentã€-Controllerã€-Serviceã€-Repositoryã€-ComponentScan"><a href="#Beanã€-Componentã€-Controllerã€-Serviceã€-Repositoryã€-ComponentScan" class="headerlink" title="@Beanã€@Componentã€@Controllerã€@Serviceã€@Repositoryã€@ComponentScan"></a>@Beanã€@Componentã€@Controllerã€@Serviceã€@Repositoryã€@ComponentScan</h3><h3 id="Import"><a href="#Import" class="headerlink" title="@Import"></a>@Import</h3><blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Target(&#123;ElementType.TYPE&#125;)</span></span><br><span class="line"><span class="meta">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class="line"><span class="meta">@Documented</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> Import &#123;</span><br><span class="line">    Class&lt;?&gt;[] value();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç»™å®¹å™¨ä¸­è‡ªåŠ¨åˆ›å»ºå‡ºç›¸åº”ç±»å‹çš„ç»„ä»¶ã€ç»„ä»¶çš„é»˜è®¤åå°±æ˜¯å…¨ç±»å</p>
<p>ç¤ºä¾‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Import</span>(&#123;User.class, Pet.class&#125;)</span></span><br><span class="line"><span class="comment"> * ç»™å®¹å™¨ä¸­è‡ªåŠ¨åˆ›å»ºå‡ºç›¸åº”ç±»å‹çš„ç»„ä»¶ã€ç»„ä»¶çš„é»˜è®¤åå°±æ˜¯å…¨ç±»åï¼šcom.example.springboot.bean.user</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Import(&#123;User.class, Pet.class&#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyConfig</span> &#123;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>æµ‹è¯•ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">      String[] beanNamesForType = context.getBeanNamesForType(User.class);</span><br><span class="line">      Arrays.stream(beanNamesForType).forEach(System.out::println);</span><br><span class="line"><span class="comment">// com.example.springboot.bean.User user</span></span><br></pre></td></tr></table></figure>
</blockquote>
<h3 id="Conditional"><a href="#Conditional" class="headerlink" title="@Conditional"></a>@Conditional</h3><blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Target(&#123;ElementType.TYPE, ElementType.METHOD&#125;)</span></span><br><span class="line"><span class="meta">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class="line"><span class="meta">@Documented</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> Conditional &#123;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * All &#123;<span class="doctag">@link</span> Condition&#125; classes that must &#123;<span class="doctag">@linkplain</span> Condition#matches match&#125;</span></span><br><span class="line"><span class="comment">	 * in order for the component to be registered.</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	Class&lt;? <span class="keyword">extends</span> <span class="title class_">Condition</span>&gt;[] value();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<img src="/2023/02/28/SpringBoot2/Java\SpringBoot\SpringBoot2.assets\image-20221010203806230.png" alt="image-20221010203806230" style="zoom:80%;">

<p>æ¡ä»¶è£…é…ï¼šæ»¡è¶³ Conditional æŒ‡å®šçš„æ¡ä»¶ï¼Œåˆ™è¿›è¡Œç»„ä»¶æ³¨å…¥</p>
<p>å¯ä»¥æ ‡æ³¨åœ¨æ–¹æ³•ä¸Šï¼Œå¦‚æœæ ‡æ³¨åœ¨ç±»ä¸Šï¼Œåˆ™å¯¹è¯¥ç±»ä¸‹æ‰€æœ‰@Beançš„æ–¹æ³•éƒ½ç”Ÿæ•ˆ</p>
<p>ç¤ºä¾‹ï¼š</p>
<p>æ ‡æ³¨åœ¨æ–¹æ³•ä¸Šï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="meta">@ConditionalOnMissingBean(name = &quot;tom&quot;)</span></span><br><span class="line"><span class="keyword">public</span> User <span class="title function_">user</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>(<span class="string">&quot;Jack&quot;</span>, <span class="number">12</span>);</span><br><span class="line">    <span class="comment">// ç»„ä»¶ä¾èµ–</span></span><br><span class="line">    user.setPet(tomcat());</span><br><span class="line">    <span class="keyword">return</span> user;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// @Bean(&quot;tom&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Pet <span class="title function_">tomcat</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Pet</span>(<span class="string">&quot;tomcat&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ ‡æ³¨åœ¨ç±»ä¸Šï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Configuration(proxyBeanMethods = true)</span></span><br><span class="line"><span class="meta">@Import(&#123;User.class, Pet.class&#125;)</span></span><br><span class="line"><span class="meta">@ConditionalOnMissingBean(name = &quot;tom&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyConfig</span> &#123;</span><br><span class="line">    </span><br></pre></td></tr></table></figure>

<p>æµ‹è¯•ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">boolean</span> <span class="variable">containsTom</span> <span class="operator">=</span> context.containsBean(<span class="string">&quot;tom&quot;</span>);</span><br><span class="line">System.out.println(<span class="string">&quot;containsTom: &quot;</span> + containsTom);  <span class="comment">//false</span></span><br><span class="line"><span class="type">boolean</span> <span class="variable">containsUser</span> <span class="operator">=</span> context.containsBean(<span class="string">&quot;user&quot;</span>);</span><br><span class="line">System.out.println(<span class="string">&quot;containsUser: &quot;</span> + containsUser); <span class="comment">//true</span></span><br></pre></td></tr></table></figure>
</blockquote>
<h3 id="ImportResource"><a href="#ImportResource" class="headerlink" title="@ImportResource"></a>@ImportResource</h3><blockquote>
<p>å¯¼å…¥åŸç”Ÿçš„ *.xml é…ç½®æ–‡ä»¶ï¼Œå¦‚æœ‰çš„ç¬¬ä¸‰æ–¹ Jar ä½¿ç”¨äº†xmlã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class="line"><span class="meta">@Target(ElementType.TYPE)</span></span><br><span class="line"><span class="meta">@Documented</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> ImportResource &#123;</span><br><span class="line">	<span class="meta">@AliasFor(&quot;locations&quot;)</span></span><br><span class="line">	String[] value() <span class="keyword">default</span> &#123;&#125;;</span><br><span class="line">	<span class="meta">@AliasFor(&quot;value&quot;)</span></span><br><span class="line">	String[] locations() <span class="keyword">default</span> &#123;&#125;;</span><br><span class="line">	Class&lt;? <span class="keyword">extends</span> <span class="title class_">BeanDefinitionReader</span>&gt; reader() <span class="keyword">default</span> BeanDefinitionReader.class;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>bean.xmlï¼š</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="string"><span class="tag">       http://www.springframework.org/schema/beans/spring-beans.xsd&quot;</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;ua&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.example.springboot.bean.User&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;name&quot;</span> <span class="attr">value</span>=<span class="string">&quot;ua&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;age&quot;</span> <span class="attr">value</span>=<span class="string">&quot;18&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;pa&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.example.springboot.bean.Pet&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;name&quot;</span> <span class="attr">value</span>=<span class="string">&quot;tomcat&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>ä½¿ç”¨ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@ImportResource(&quot;classpath:bean.xml&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyConfig</span> &#123;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
</blockquote>
<h3 id="é…ç½®ç»‘å®š-ConfigurationPropertiesã€-EnableConfigurationProperties"><a href="#é…ç½®ç»‘å®š-ConfigurationPropertiesã€-EnableConfigurationProperties" class="headerlink" title="é…ç½®ç»‘å®š@ConfigurationPropertiesã€@EnableConfigurationProperties"></a>é…ç½®ç»‘å®š@ConfigurationPropertiesã€@EnableConfigurationProperties</h3><blockquote>
<ol>
<li><p>æ–¹å¼ä¸€ï¼š@ConfigurationProperties + @Component</p>
<p> åœ¨Beanä¸Šæ·»åŠ è¿™ä¸¤ä¸ªæ³¨è§£ï¼Œå®Œæˆé…ç½®æ–‡ä»¶ä¸Beançš„å±æ€§ç»‘å®š</p>
 <figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@ConfigurationProperties(prefix = &quot;mycar&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Car</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String brand;</span><br><span class="line">    <span class="keyword">private</span> Integer price;</span><br><span class="line">    </span><br></pre></td></tr></table></figure>

<p> application.propertiesï¼š</p>
 <figure class="highlight properties"><table><tr><td class="code"><pre><span class="line"><span class="comment"># é…ç½®è‡ªåŠ¨ç»‘å®š</span></span><br><span class="line"><span class="attr">mycar.brand</span>=<span class="string">BYD</span></span><br><span class="line"><span class="attr">mycar.price</span>=<span class="string">10000</span></span><br></pre></td></tr></table></figure>

<p> æµ‹è¯•ï¼š</p>
 <figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line">Car car;</span><br><span class="line">    </span><br><span class="line"><span class="meta">@GetMapping(&quot;/car&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Car <span class="title function_">car</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> car;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>æ–¹å¼äºŒï¼š@EnableConfigurationProperties + @ConfigurationProperties</p>
<p> @EnableConfigurationProperties({Car.class})çš„ä¸¤ä¸ªä½œç”¨ï¼š<strong>ç»‘å®šé…ç½®ï¼Œå¹¶å°†Beanæ”¾å…¥å®¹å™¨ä¸­ã€‚</strong></p>
<ul>
<li>åœ¨é…ç½®ç±»ä¸Šæ·»åŠ @EnableConfigurationProperties({Car.class})</li>
<li>åœ¨Beanä¸Šæ·»åŠ @ConfigurationProperties(prefix&#x3D;â€mycarâ€)</li>
<li>ä½¿ç”¨åœºæ™¯ï¼šä½¿ç”¨ä¸ç¬¬ä¸‰æ–¹Beanï¼Œæ²¡æœ‰ä½¿ç”¨@Componentæ—¶ï¼Œå¯ä»¥ä½¿ç”¨è¯¥æ–¹å¼</li>
</ul>
<p> Beanï¼š</p>
 <figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@ConfigurationProperties(prefix = &quot;mycar&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Car</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String brand;</span><br><span class="line">    <span class="keyword">private</span> Integer price;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p> é…ç½®ç±»ï¼š</p>
 <figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@EnableConfigurationProperties(&#123;Car.class&#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyConfig</span> &#123;</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ol>
</blockquote>
<h1 id="è‡ªåŠ¨é…ç½®åŸç†-1"><a href="#è‡ªåŠ¨é…ç½®åŸç†-1" class="headerlink" title="è‡ªåŠ¨é…ç½®åŸç†"></a>è‡ªåŠ¨é…ç½®åŸç†</h1><h2 id="å¼•å¯¼åŠ è½½è‡ªåŠ¨é…ç½®ç±»"><a href="#å¼•å¯¼åŠ è½½è‡ªåŠ¨é…ç½®ç±»" class="headerlink" title="å¼•å¯¼åŠ è½½è‡ªåŠ¨é…ç½®ç±»"></a>å¼•å¯¼åŠ è½½è‡ªåŠ¨é…ç½®ç±»</h2><h2 id="SpringBootApplication"><a href="#SpringBootApplication" class="headerlink" title="@SpringBootApplication"></a>@SpringBootApplication</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@SpringBootConfiguration</span></span><br><span class="line"><span class="meta">@EnableAutoConfiguration</span></span><br><span class="line"><span class="meta">@ComponentScan(excludeFilters = &#123; @Filter(type = FilterType.CUSTOM, classes = TypeExcludeFilter.class),</span></span><br><span class="line"><span class="meta">		@Filter(type = FilterType.CUSTOM, classes = AutoConfigurationExcludeFilter.class) &#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> SpringBootApplication &#123;</span><br><span class="line">    </span><br></pre></td></tr></table></figure>

<h3 id="SpringBootConfiguration"><a href="#SpringBootConfiguration" class="headerlink" title="@SpringBootConfiguration"></a>@SpringBootConfiguration</h3><p>è¯¥æ³¨è§£ä½¿ç”¨ @Configuration ï¼Œä»…ä½œä¸ºä¸€ä¸ªé…ç½®ç±»ä½¿ç”¨ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Target(ElementType.TYPE)</span></span><br><span class="line"><span class="meta">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class="line"><span class="meta">@Documented</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@Indexed</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> SpringBootConfiguration &#123;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="ComponentScan"><a href="#ComponentScan" class="headerlink" title="@ComponentScan"></a>@ComponentScan</h3><p>â€‹	åªåšåŒ…æ‰«æä½¿ç”¨ã€‚</p>
<h3 id="EnableAutoConfiguration"><a href="#EnableAutoConfiguration" class="headerlink" title="@EnableAutoConfiguration"></a>@EnableAutoConfiguration</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@AutoConfigurationPackage</span></span><br><span class="line"><span class="meta">@Import(AutoConfigurationImportSelector.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> EnableAutoConfiguration &#123;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="AutoConfigurationPackage"><a href="#AutoConfigurationPackage" class="headerlink" title="@AutoConfigurationPackage"></a>@AutoConfigurationPackage</h4><p>â€‹	<strong>æŒ‡å®šäº†é»˜è®¤çš„åŒ…æ‰«æè§„åˆ™</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Import(AutoConfigurationPackages.Registrar.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> AutoConfigurationPackage &#123;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>AutoConfigurationPackages.Registrarï¼š</p>
<p>new PackageImports(metadata).getPackageNames()å¾—åˆ°çš„æ˜¯ä¸»å¯åŠ¨ç±»æ‰€åœ¨çš„åŒ…å</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * &#123;<span class="doctag">@link</span> ImportBeanDefinitionRegistrar&#125; to store the base package from the importing</span></span><br><span class="line"><span class="comment"> * configuration.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">Registrar</span> <span class="keyword">implements</span> <span class="title class_">ImportBeanDefinitionRegistrar</span>, DeterminableImports &#123;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">registerBeanDefinitions</span><span class="params">(AnnotationMetadata metadata, BeanDefinitionRegistry registry)</span> &#123;</span><br><span class="line">           <span class="comment">// new PackageImports(metadata).getPackageNames()å¾—åˆ°çš„æ˜¯ä¸»å¯åŠ¨ç±»æ‰€åœ¨çš„åŒ…å</span></span><br><span class="line">		register(registry, <span class="keyword">new</span> <span class="title class_">PackageImports</span>(metadata).getPackageNames().toArray(<span class="keyword">new</span> <span class="title class_">String</span>[<span class="number">0</span>]));</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="keyword">public</span> Set&lt;Object&gt; <span class="title function_">determineImports</span><span class="params">(AnnotationMetadata metadata)</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> Collections.singleton(<span class="keyword">new</span> <span class="title class_">PackageImports</span>(metadata));</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="Import-AutoConfigurationImportSelector-class"><a href="#Import-AutoConfigurationImportSelector-class" class="headerlink" title="@Import(AutoConfigurationImportSelector.class)"></a>@Import(AutoConfigurationImportSelector.class)</h4><h5 id="æ ¸å¿ƒåŠŸèƒ½"><a href="#æ ¸å¿ƒåŠŸèƒ½" class="headerlink" title="æ ¸å¿ƒåŠŸèƒ½"></a><strong>æ ¸å¿ƒåŠŸèƒ½</strong></h5><blockquote>
<ol>
<li>åˆ©ç”¨ getAutoConfigurationEntry(annotationMetadata); ç»™å®¹å™¨ä¸­æ‰¹é‡å¯¼å…¥ä¸€äº›ç»„ä»¶ã€‚</li>
<li>è°ƒç”¨ List<String> configurations &#x3D; getCandidateConfigurations(annotationMetadata, attributes) è·å–åˆ°æ‰€æœ‰éœ€è¦å¯¼å…¥åˆ°å®¹å™¨ä¸­çš„é…ç½®ç±»ã€‚</String></li>
<li>åˆ©ç”¨å·¥å‚åŠ è½½ Map&lt;String, List<String>&gt; loadSpringFactories(@Nullable ClassLoader classLoader)ï¼›å¾—åˆ°æ‰€æœ‰çš„ç»„ä»¶ã€‚</String></li>
<li>ä» <strong>META-INF&#x2F;spring.factories</strong> ä½ç½®æ¥åŠ è½½ä¸€ä¸ªæ–‡ä»¶ã€‚<br> é»˜è®¤æ‰«ææˆ‘ä»¬å½“å‰ç³»ç»Ÿé‡Œé¢æ‰€æœ‰ <strong>META-INF&#x2F;spring.factories</strong> ä½ç½®çš„æ–‡ä»¶<br> spring-boot-autoconfigure-2.3.4.RELEASE.jar åŒ…é‡Œé¢ä¹Ÿæœ‰ META-INF&#x2F;spring.factories</li>
</ol>
</blockquote>
<h5 id="æºç ç¤ºä¾‹"><a href="#æºç ç¤ºä¾‹" class="headerlink" title="æºç ç¤ºä¾‹"></a>æºç ç¤ºä¾‹</h5><blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AutoConfigurationImportSelector</span> <span class="keyword">implements</span> <span class="title class_">DeferredImportSelector</span>, BeanClassLoaderAware,</span><br><span class="line">		ResourceLoaderAware, BeanFactoryAware, EnvironmentAware, Ordered &#123;</span><br><span class="line">	<span class="comment">// ...</span></span><br><span class="line">            </span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="keyword">public</span> String[] selectImports(AnnotationMetadata annotationMetadata) &#123;</span><br><span class="line">		<span class="keyword">if</span> (!isEnabled(annotationMetadata)) &#123;</span><br><span class="line">			<span class="keyword">return</span> NO_IMPORTS;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="type">AutoConfigurationEntry</span> <span class="variable">autoConfigurationEntry</span> <span class="operator">=</span> </span><br><span class="line">            						getAutoConfigurationEntry(annotationMetadata);</span><br><span class="line">		<span class="keyword">return</span> StringUtils.toStringArray(autoConfigurationEntry.getConfigurations());</span><br><span class="line">	&#125;</span><br><span class="line">    <span class="comment">//  ç»™å®¹å™¨ä¸­æ‰¹é‡å¯¼å…¥ä¸€äº›ç»„ä»¶</span></span><br><span class="line">    <span class="keyword">protected</span> AutoConfigurationEntry <span class="title function_">getAutoConfigurationEntry</span><span class="params">(AnnotationMetadata annotationMetadata)</span> &#123;</span><br><span class="line">		<span class="keyword">if</span> (!isEnabled(annotationMetadata)) &#123;</span><br><span class="line">			<span class="keyword">return</span> EMPTY_ENTRY;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="type">AnnotationAttributes</span> <span class="variable">attributes</span> <span class="operator">=</span> getAttributes(annotationMetadata);</span><br><span class="line">        <span class="comment">// è·å–åˆ°æ‰€æœ‰éœ€è¦å¯¼å…¥åˆ°å®¹å™¨ä¸­çš„é…ç½®ç±»</span></span><br><span class="line">		List&lt;String&gt; configurations = getCandidateConfigurations(annotationMetadata, attributes);</span><br><span class="line">		configurations = removeDuplicates(configurations);</span><br><span class="line">		Set&lt;String&gt; exclusions = getExclusions(annotationMetadata, attributes);</span><br><span class="line">		checkExcludedClasses(configurations, exclusions);</span><br><span class="line">		configurations.removeAll(exclusions);</span><br><span class="line">		configurations = getConfigurationClassFilter().filter(configurations);</span><br><span class="line">		fireAutoConfigurationImportEvents(configurations, exclusions);</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">AutoConfigurationEntry</span>(configurations, exclusions);</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>

<p>æ ¹æ®æ³¨è§£å¾—åˆ°éœ€è¦åŠ è½½çš„é…ç½®ç±»ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">protected</span> List&lt;String&gt; <span class="title function_">getCandidateConfigurations</span><span class="params">(AnnotationMetadata metadata, AnnotationAttributes attributes)</span> &#123;</span><br><span class="line">		List&lt;String&gt; configurations = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;(</span><br><span class="line">				SpringFactoriesLoader.loadFactoryNames(getSpringFactoriesLoaderFactoryClass(), getBeanClassLoader()));</span><br><span class="line">		ImportCandidates.load(AutoConfiguration.class, getBeanClassLoader()).forEach(configurations::add);</span><br><span class="line">		Assert.notEmpty(configurations,</span><br><span class="line">				<span class="string">&quot;No auto configuration classes found in META-INF/spring.factories nor in META-INF/spring/org.springframework.boot.autoconfigure.AutoConfiguration.imports. If you &quot;</span></span><br><span class="line">						+ <span class="string">&quot;are using a custom packaging, make sure that file is correct.&quot;</span>);</span><br><span class="line">		<span class="keyword">return</span> configurations;</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>

<p>SpringFactoriesLoader.loadFactoryNamesï¼š</p>
<p>|â€”-SpringFactoriesLoader</p>
<p>å…¶ä¸­ï¼šEnumeration<URL> urls &#x3D; classLoader.getResources(FACTORIES_RESOURCE_LOCATION);</URL></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">public static final String FACTORIES_RESOURCE_LOCATION = &quot;META-INF/spring.factories&quot;;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> Map&lt;String, List&lt;String&gt;&gt; <span class="title function_">loadSpringFactories</span><span class="params">(ClassLoader classLoader)</span> &#123;</span><br><span class="line">	Map&lt;String, List&lt;String&gt;&gt; result = cache.get(classLoader);</span><br><span class="line">	<span class="keyword">if</span> (result != <span class="literal">null</span>) &#123;</span><br><span class="line">		<span class="keyword">return</span> result;</span><br><span class="line">	&#125;</span><br><span class="line">	result = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">	<span class="keyword">try</span> &#123;</span><br><span class="line">		Enumeration&lt;URL&gt; urls = </span><br><span class="line">               			classLoader.getResources(FACTORIES_RESOURCE_LOCATION);</span><br><span class="line">		<span class="keyword">while</span> (urls.hasMoreElements()) &#123;</span><br><span class="line">			<span class="type">URL</span> <span class="variable">url</span> <span class="operator">=</span> urls.nextElement();</span><br><span class="line">			<span class="type">UrlResource</span> <span class="variable">resource</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">UrlResource</span>(url);</span><br><span class="line">			<span class="type">Properties</span> <span class="variable">properties</span> <span class="operator">=</span> PropertiesLoaderUtils.loadProperties(resource);</span><br><span class="line">			<span class="keyword">for</span> (Map.Entry&lt;?, ?&gt; entry : properties.entrySet()) &#123;</span><br><span class="line">				<span class="type">String</span> <span class="variable">factoryTypeName</span> <span class="operator">=</span> ((String) entry.getKey()).trim();</span><br><span class="line">				String[] factoryImplementationNames =</span><br><span class="line">						StringUtils.commaDelimitedListToStringArray((String) entry.getValue());</span><br><span class="line">				<span class="keyword">for</span> (String factoryImplementationName : factoryImplementationNames) &#123;</span><br><span class="line">					result.computeIfAbsent(factoryTypeName, key -&gt; <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;())</span><br><span class="line">							.add(factoryImplementationName.trim());</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="comment">// Replace all lists with unmodifiable lists containing unique elements</span></span><br><span class="line">		result.replaceAll((factoryType, implementations) -&gt; </span><br><span class="line">                             				implementations.stream().distinct()</span><br><span class="line">				.collect(Collectors.collectingAndThen(Collectors.toList(), Collections::unmodifiableList)));</span><br><span class="line">		cache.put(classLoader, result);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">catch</span> (IOException ex) &#123;</span><br><span class="line">		<span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalArgumentException</span>(<span class="string">&quot;Unable to load factories from location [&quot;</span> +</span><br><span class="line">				FACTORIES_RESOURCE_LOCATION + <span class="string">&quot;]&quot;</span>, ex);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


</blockquote>
<h5 id="META-INF-x2F-spring-factories"><a href="#META-INF-x2F-spring-factories" class="headerlink" title="META-INF&#x2F;spring.factories"></a>META-INF&#x2F;spring.factories</h5><blockquote>
<p>æ³¨æ„ï¼šé«˜ç‰ˆæœ¬çš„ XXXXAutoConfiguration åœ¨</p>
<p> META-INF&#x2F;spring&#x2F;org.springframework.boot.autoconfigure.AutoConfiguration.imports</p>
<figure class="highlight properties"><table><tr><td class="code"><pre><span class="line"><span class="attr">org.springframework.boot.autoconfigure.admin.SpringApplicationAdminJmxAutoConfiguration</span></span><br><span class="line"><span class="attr">org.springframework.boot.autoconfigure.aop.AopAutoConfiguration</span></span><br><span class="line"><span class="attr">org.springframework.boot.autoconfigure.amqp.RabbitAutoConfiguration</span></span><br><span class="line"><span class="attr">org.springframework.boot.autoconfigure.batch.BatchAutoConfiguration</span></span><br><span class="line"><span class="attr">org.springframework.boot.autoconfigure.cache.CacheAutoConfiguration</span></span><br><span class="line"><span class="attr">org.springframework.boot.autoconfigure.cassandra.CassandraAutoConfiguration</span></span><br><span class="line"><span class="attr">org.springframework.boot.autoconfigure.context.ConfigurationPropertiesAutoConfiguration</span></span><br><span class="line"><span class="attr">org.springframework.boot.autoconfigure.context.LifecycleAutoConfiguration</span></span><br><span class="line"><span class="attr">org.springframework.boot.autoconfigure.context.MessageSourceAutoConfiguration</span></span><br><span class="line"><span class="attr">org.springframework.boot.autoconfigure.context.PropertyPlaceholderAutoConfiguration</span></span><br><span class="line"><span class="attr">org.springframework.boot.autoconfigure.couchbase.CouchbaseAutoConfiguration</span></span><br><span class="line"><span class="attr">org.springframework.boot.autoconfigure.dao.PersistenceExceptionTranslationAutoConfiguration</span></span><br><span class="line"><span class="attr">org.springframework.boot.autoconfigure.data.cassandra.CassandraDataAutoConfiguration</span></span><br><span class="line"><span class="attr">org.springframework.boot.autoconfigure.data.cassandra.CassandraReactiveDataAutoConfiguration</span></span><br><span class="line"><span class="attr">org.springframework.boot.autoconfigure.data.cassandra.CassandraReactiveRepositoriesAutoConfiguration</span></span><br><span class="line"><span class="attr">org.springframework.boot.autoconfigure.data.cassandra.CassandraRepositoriesAutoConfiguration</span></span><br><span class="line"><span class="attr">org.springframework.boot.autoconfigure.data.couchbase.CouchbaseDataAutoConfiguration</span></span><br><span class="line"><span class="attr">org.springframework.boot.autoconfigure.data.couchbase.CouchbaseReactiveDataAutoConfiguration</span></span><br><span class="line"><span class="attr">org.springframework.boot.autoconfigure.data.couchbase.CouchbaseReactiveRepositoriesAutoConfiguration</span></span><br><span class="line"><span class="attr">org.springframework.boot.autoconfigure.data.couchbase.CouchbaseRepositoriesAutoConfiguration</span></span><br><span class="line"><span class="attr">org.springframework.boot.autoconfigure.data.elasticsearch.ElasticsearchDataAutoConfiguration</span></span><br><span class="line"><span class="attr">org.springframework.boot.autoconfigure.data.elasticsearch.ElasticsearchRepositoriesAutoConfiguration</span></span><br><span class="line"><span class="attr">org.springframework.boot.autoconfigure.data.elasticsearch.ReactiveElasticsearchRepositoriesAutoConfiguration</span></span><br><span class="line"><span class="attr">org.springframework.boot.autoconfigure.data.elasticsearch.ReactiveElasticsearchRestClientAutoConfiguration</span></span><br><span class="line"><span class="attr">org.springframework.boot.autoconfigure.data.jdbc.JdbcRepositoriesAutoConfiguration</span></span><br><span class="line"><span class="attr">org.springframework.boot.autoconfigure.data.jpa.JpaRepositoriesAutoConfiguration</span></span><br><span class="line"><span class="attr">org.springframework.boot.autoconfigure.data.ldap.LdapRepositoriesAutoConfiguration</span></span><br><span class="line"><span class="attr">org.springframework.boot.autoconfigure.data.mongo.MongoDataAutoConfiguration</span></span><br><span class="line"><span class="attr">org.springframework.boot.autoconfigure.data.mongo.MongoReactiveDataAutoConfiguration</span></span><br><span class="line"><span class="attr">org.springframework.boot.autoconfigure.data.mongo.MongoReactiveRepositoriesAutoConfiguration</span></span><br><span class="line"><span class="attr">org.springframework.boot.autoconfigure.data.mongo.MongoRepositoriesAutoConfiguration</span></span><br><span class="line"><span class="attr">org.springframework.boot.autoconfigure.data.neo4j.Neo4jDataAutoConfiguration</span></span><br><span class="line"><span class="attr">org.springframework.boot.autoconfigure.data.neo4j.Neo4jReactiveDataAutoConfiguration</span></span><br><span class="line"><span class="attr">org.springframework.boot.autoconfigure.data.neo4j.Neo4jReactiveRepositoriesAutoConfiguration</span></span><br><span class="line"><span class="attr">org.springframework.boot.autoconfigure.data.neo4j.Neo4jRepositoriesAutoConfiguration</span></span><br><span class="line"><span class="attr">org.springframework.boot.autoconfigure.data.r2dbc.R2dbcDataAutoConfiguration</span></span><br><span class="line"><span class="attr">org.springframework.boot.autoconfigure.data.r2dbc.R2dbcRepositoriesAutoConfiguration</span></span><br><span class="line"><span class="attr">org.springframework.boot.autoconfigure.data.redis.RedisAutoConfiguration</span></span><br><span class="line"><span class="attr">org.springframework.boot.autoconfigure.data.redis.RedisReactiveAutoConfiguration</span></span><br><span class="line"><span class="attr">org.springframework.boot.autoconfigure.data.redis.RedisRepositoriesAutoConfiguration</span></span><br><span class="line"><span class="attr">org.springframework.boot.autoconfigure.data.rest.RepositoryRestMvcAutoConfiguration</span></span><br><span class="line"><span class="attr">org.springframework.boot.autoconfigure.data.web.SpringDataWebAutoConfiguration</span></span><br><span class="line"><span class="attr">org.springframework.boot.autoconfigure.elasticsearch.ElasticsearchRestClientAutoConfiguration</span></span><br><span class="line"><span class="attr">org.springframework.boot.autoconfigure.flyway.FlywayAutoConfiguration</span></span><br><span class="line"><span class="attr">org.springframework.boot.autoconfigure.freemarker.FreeMarkerAutoConfiguration</span></span><br><span class="line"><span class="attr">org.springframework.boot.autoconfigure.graphql.GraphQlAutoConfiguration</span></span><br><span class="line"><span class="attr">org.springframework.boot.autoconfigure.graphql.data.GraphQlReactiveQueryByExampleAutoConfiguration</span></span><br><span class="line"><span class="attr">org.springframework.boot.autoconfigure.graphql.data.GraphQlReactiveQuerydslAutoConfiguration</span></span><br><span class="line"><span class="attr">org.springframework.boot.autoconfigure.graphql.data.GraphQlQueryByExampleAutoConfiguration</span></span><br><span class="line"><span class="attr">org.springframework.boot.autoconfigure.graphql.data.GraphQlQuerydslAutoConfiguration</span></span><br><span class="line"><span class="attr">org.springframework.boot.autoconfigure.graphql.reactive.GraphQlWebFluxAutoConfiguration</span></span><br><span class="line"><span class="attr">org.springframework.boot.autoconfigure.graphql.rsocket.GraphQlRSocketAutoConfiguration</span></span><br><span class="line"><span class="attr">org.springframework.boot.autoconfigure.graphql.rsocket.RSocketGraphQlClientAutoConfiguration</span></span><br><span class="line"><span class="attr">org.springframework.boot.autoconfigure.graphql.security.GraphQlWebFluxSecurityAutoConfiguration</span></span><br><span class="line"><span class="attr">org.springframework.boot.autoconfigure.graphql.security.GraphQlWebMvcSecurityAutoConfiguration</span></span><br><span class="line"><span class="attr">org.springframework.boot.autoconfigure.graphql.servlet.GraphQlWebMvcAutoConfiguration</span></span><br><span class="line"><span class="attr">org.springframework.boot.autoconfigure.groovy.template.GroovyTemplateAutoConfiguration</span></span><br><span class="line"><span class="attr">org.springframework.boot.autoconfigure.gson.GsonAutoConfiguration</span></span><br><span class="line"><span class="attr">org.springframework.boot.autoconfigure.h2.H2ConsoleAutoConfiguration</span></span><br><span class="line"><span class="attr">org.springframework.boot.autoconfigure.hateoas.HypermediaAutoConfiguration</span></span><br><span class="line"><span class="attr">org.springframework.boot.autoconfigure.hazelcast.HazelcastAutoConfiguration</span></span><br><span class="line"><span class="attr">org.springframework.boot.autoconfigure.hazelcast.HazelcastJpaDependencyAutoConfiguration</span></span><br><span class="line"><span class="attr">org.springframework.boot.autoconfigure.http.HttpMessageConvertersAutoConfiguration</span></span><br><span class="line"><span class="attr">org.springframework.boot.autoconfigure.http.codec.CodecsAutoConfiguration</span></span><br><span class="line"><span class="attr">org.springframework.boot.autoconfigure.influx.InfluxDbAutoConfiguration</span></span><br><span class="line"><span class="attr">org.springframework.boot.autoconfigure.info.ProjectInfoAutoConfiguration</span></span><br><span class="line"><span class="attr">org.springframework.boot.autoconfigure.integration.IntegrationAutoConfiguration</span></span><br><span class="line"><span class="attr">org.springframework.boot.autoconfigure.jackson.JacksonAutoConfiguration</span></span><br><span class="line"><span class="attr">org.springframework.boot.autoconfigure.jdbc.DataSourceAutoConfiguration</span></span><br><span class="line"><span class="attr">org.springframework.boot.autoconfigure.jdbc.JdbcTemplateAutoConfiguration</span></span><br><span class="line"><span class="attr">org.springframework.boot.autoconfigure.jdbc.JndiDataSourceAutoConfiguration</span></span><br><span class="line"><span class="attr">org.springframework.boot.autoconfigure.jdbc.XADataSourceAutoConfiguration</span></span><br><span class="line"><span class="attr">org.springframework.boot.autoconfigure.jdbc.DataSourceTransactionManagerAutoConfiguration</span></span><br><span class="line"><span class="attr">org.springframework.boot.autoconfigure.jms.JmsAutoConfiguration</span></span><br><span class="line"><span class="attr">org.springframework.boot.autoconfigure.jmx.JmxAutoConfiguration</span></span><br><span class="line"><span class="attr">org.springframework.boot.autoconfigure.jms.JndiConnectionFactoryAutoConfiguration</span></span><br><span class="line"><span class="attr">org.springframework.boot.autoconfigure.jms.activemq.ActiveMQAutoConfiguration</span></span><br><span class="line"><span class="attr">org.springframework.boot.autoconfigure.jms.artemis.ArtemisAutoConfiguration</span></span><br><span class="line"><span class="attr">org.springframework.boot.autoconfigure.jersey.JerseyAutoConfiguration</span></span><br><span class="line"><span class="attr">org.springframework.boot.autoconfigure.jooq.JooqAutoConfiguration</span></span><br><span class="line"><span class="attr">org.springframework.boot.autoconfigure.jsonb.JsonbAutoConfiguration</span></span><br><span class="line"><span class="attr">org.springframework.boot.autoconfigure.kafka.KafkaAutoConfiguration</span></span><br><span class="line"><span class="attr">org.springframework.boot.autoconfigure.availability.ApplicationAvailabilityAutoConfiguration</span></span><br><span class="line"><span class="attr">org.springframework.boot.autoconfigure.ldap.embedded.EmbeddedLdapAutoConfiguration</span></span><br><span class="line"><span class="attr">org.springframework.boot.autoconfigure.ldap.LdapAutoConfiguration</span></span><br><span class="line"><span class="attr">org.springframework.boot.autoconfigure.liquibase.LiquibaseAutoConfiguration</span></span><br><span class="line"><span class="attr">org.springframework.boot.autoconfigure.mail.MailSenderAutoConfiguration</span></span><br><span class="line"><span class="attr">org.springframework.boot.autoconfigure.mail.MailSenderValidatorAutoConfiguration</span></span><br><span class="line"><span class="attr">org.springframework.boot.autoconfigure.mongo.embedded.EmbeddedMongoAutoConfiguration</span></span><br><span class="line"><span class="attr">org.springframework.boot.autoconfigure.mongo.MongoAutoConfiguration</span></span><br><span class="line"><span class="attr">org.springframework.boot.autoconfigure.mongo.MongoReactiveAutoConfiguration</span></span><br><span class="line"><span class="attr">org.springframework.boot.autoconfigure.mustache.MustacheAutoConfiguration</span></span><br><span class="line"><span class="attr">org.springframework.boot.autoconfigure.neo4j.Neo4jAutoConfiguration</span></span><br><span class="line"><span class="attr">org.springframework.boot.autoconfigure.netty.NettyAutoConfiguration</span></span><br><span class="line"><span class="attr">org.springframework.boot.autoconfigure.orm.jpa.HibernateJpaAutoConfiguration</span></span><br><span class="line"><span class="attr">org.springframework.boot.autoconfigure.quartz.QuartzAutoConfiguration</span></span><br><span class="line"><span class="attr">org.springframework.boot.autoconfigure.r2dbc.R2dbcAutoConfiguration</span></span><br><span class="line"><span class="attr">org.springframework.boot.autoconfigure.r2dbc.R2dbcTransactionManagerAutoConfiguration</span></span><br><span class="line"><span class="attr">org.springframework.boot.autoconfigure.rsocket.RSocketMessagingAutoConfiguration</span></span><br><span class="line"><span class="attr">org.springframework.boot.autoconfigure.rsocket.RSocketRequesterAutoConfiguration</span></span><br><span class="line"><span class="attr">org.springframework.boot.autoconfigure.rsocket.RSocketServerAutoConfiguration</span></span><br><span class="line"><span class="attr">org.springframework.boot.autoconfigure.rsocket.RSocketStrategiesAutoConfiguration</span></span><br><span class="line"><span class="attr">org.springframework.boot.autoconfigure.security.servlet.SecurityAutoConfiguration</span></span><br><span class="line"><span class="attr">org.springframework.boot.autoconfigure.security.servlet.UserDetailsServiceAutoConfiguration</span></span><br><span class="line"><span class="attr">org.springframework.boot.autoconfigure.security.servlet.SecurityFilterAutoConfiguration</span></span><br><span class="line"><span class="attr">org.springframework.boot.autoconfigure.security.reactive.ReactiveSecurityAutoConfiguration</span></span><br><span class="line"><span class="attr">org.springframework.boot.autoconfigure.security.reactive.ReactiveUserDetailsServiceAutoConfiguration</span></span><br><span class="line"><span class="attr">org.springframework.boot.autoconfigure.security.rsocket.RSocketSecurityAutoConfiguration</span></span><br><span class="line"><span class="attr">org.springframework.boot.autoconfigure.security.saml2.Saml2RelyingPartyAutoConfiguration</span></span><br><span class="line"><span class="attr">org.springframework.boot.autoconfigure.sendgrid.SendGridAutoConfiguration</span></span><br><span class="line"><span class="attr">org.springframework.boot.autoconfigure.session.SessionAutoConfiguration</span></span><br><span class="line"><span class="attr">org.springframework.boot.autoconfigure.security.oauth2.client.servlet.OAuth2ClientAutoConfiguration</span></span><br><span class="line"><span class="attr">org.springframework.boot.autoconfigure.security.oauth2.client.reactive.ReactiveOAuth2ClientAutoConfiguration</span></span><br><span class="line"><span class="attr">org.springframework.boot.autoconfigure.security.oauth2.resource.servlet.OAuth2ResourceServerAutoConfiguration</span></span><br><span class="line"><span class="attr">org.springframework.boot.autoconfigure.security.oauth2.resource.reactive.ReactiveOAuth2ResourceServerAutoConfiguration</span></span><br><span class="line"><span class="attr">org.springframework.boot.autoconfigure.solr.SolrAutoConfiguration</span></span><br><span class="line"><span class="attr">org.springframework.boot.autoconfigure.sql.init.SqlInitializationAutoConfiguration</span></span><br><span class="line"><span class="attr">org.springframework.boot.autoconfigure.task.TaskExecutionAutoConfiguration</span></span><br><span class="line"><span class="attr">org.springframework.boot.autoconfigure.task.TaskSchedulingAutoConfiguration</span></span><br><span class="line"><span class="attr">org.springframework.boot.autoconfigure.thymeleaf.ThymeleafAutoConfiguration</span></span><br><span class="line"><span class="attr">org.springframework.boot.autoconfigure.transaction.TransactionAutoConfiguration</span></span><br><span class="line"><span class="attr">org.springframework.boot.autoconfigure.transaction.jta.JtaAutoConfiguration</span></span><br><span class="line"><span class="attr">org.springframework.boot.autoconfigure.validation.ValidationAutoConfiguration</span></span><br><span class="line"><span class="attr">org.springframework.boot.autoconfigure.web.client.RestTemplateAutoConfiguration</span></span><br><span class="line"><span class="attr">org.springframework.boot.autoconfigure.web.embedded.EmbeddedWebServerFactoryCustomizerAutoConfiguration</span></span><br><span class="line"><span class="attr">org.springframework.boot.autoconfigure.web.reactive.HttpHandlerAutoConfiguration</span></span><br><span class="line"><span class="attr">org.springframework.boot.autoconfigure.web.reactive.ReactiveMultipartAutoConfiguration</span></span><br><span class="line"><span class="attr">org.springframework.boot.autoconfigure.web.reactive.ReactiveWebServerFactoryAutoConfiguration</span></span><br><span class="line"><span class="attr">org.springframework.boot.autoconfigure.web.reactive.WebFluxAutoConfiguration</span></span><br><span class="line"><span class="attr">org.springframework.boot.autoconfigure.web.reactive.WebSessionIdResolverAutoConfiguration</span></span><br><span class="line"><span class="attr">org.springframework.boot.autoconfigure.web.reactive.error.ErrorWebFluxAutoConfiguration</span></span><br><span class="line"><span class="attr">org.springframework.boot.autoconfigure.web.reactive.function.client.ClientHttpConnectorAutoConfiguration</span></span><br><span class="line"><span class="attr">org.springframework.boot.autoconfigure.web.reactive.function.client.WebClientAutoConfiguration</span></span><br><span class="line"><span class="attr">org.springframework.boot.autoconfigure.web.servlet.DispatcherServletAutoConfiguration</span></span><br><span class="line"><span class="attr">org.springframework.boot.autoconfigure.web.servlet.ServletWebServerFactoryAutoConfiguration</span></span><br><span class="line"><span class="attr">org.springframework.boot.autoconfigure.web.servlet.error.ErrorMvcAutoConfiguration</span></span><br><span class="line"><span class="attr">org.springframework.boot.autoconfigure.web.servlet.HttpEncodingAutoConfiguration</span></span><br><span class="line"><span class="attr">org.springframework.boot.autoconfigure.web.servlet.MultipartAutoConfiguration</span></span><br><span class="line"><span class="attr">org.springframework.boot.autoconfigure.web.servlet.WebMvcAutoConfiguration</span></span><br><span class="line"><span class="attr">org.springframework.boot.autoconfigure.websocket.reactive.WebSocketReactiveAutoConfiguration</span></span><br><span class="line"><span class="attr">org.springframework.boot.autoconfigure.websocket.servlet.WebSocketServletAutoConfiguration</span></span><br><span class="line"><span class="attr">org.springframework.boot.autoconfigure.websocket.servlet.WebSocketMessagingAutoConfiguration</span></span><br><span class="line"><span class="attr">org.springframework.boot.autoconfigure.webservices.WebServicesAutoConfiguration</span></span><br><span class="line"><span class="attr">org.springframework.boot.autoconfigure.webservices.client.WebServiceTemplateAutoConfiguration</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
</blockquote>
<h2 id="æŒ‰éœ€å¼€å¯è‡ªåŠ¨é…ç½®é¡¹"><a href="#æŒ‰éœ€å¼€å¯è‡ªåŠ¨é…ç½®é¡¹" class="headerlink" title="æŒ‰éœ€å¼€å¯è‡ªåŠ¨é…ç½®é¡¹"></a>æŒ‰éœ€å¼€å¯è‡ªåŠ¨é…ç½®é¡¹</h2><blockquote>
<p>è™½ç„¶æ‰€æœ‰è‡ªåŠ¨é…ç½®å¯åŠ¨çš„æ—¶å€™é»˜è®¤å…¨éƒ¨åŠ è½½ã€‚ä½†æ˜¯ XXXXAutoConfiguration åªä¼šæŒ‰ç…§æ¡ä»¶è£…é…è§„åˆ™ï¼ˆ@Conditionalï¼‰ï¼Œæœ€ç»ˆä¼šæŒ‰éœ€é…ç½®ã€‚</p>
</blockquote>
<h3 id="ç¤ºä¾‹ä¸€ï¼šAopAutoConfiguration"><a href="#ç¤ºä¾‹ä¸€ï¼šAopAutoConfiguration" class="headerlink" title="ç¤ºä¾‹ä¸€ï¼šAopAutoConfiguration"></a>ç¤ºä¾‹ä¸€ï¼šAopAutoConfiguration</h3><blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@AutoConfiguration</span></span><br><span class="line"><span class="comment">// ==========è¯¥æ¡ä»¶ç”Ÿæ•ˆï¼Œé»˜è®¤é…ç½®matchIfMissing = true==========</span></span><br><span class="line"><span class="meta">@ConditionalOnProperty(prefix = &quot;spring.aop&quot;, name = &quot;auto&quot;, havingValue = &quot;true&quot;, matchIfMissing = true)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AopAutoConfiguration</span> &#123;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Configuration(proxyBeanMethods = false)</span></span><br><span class="line">    <span class="comment">// ==========æ²¡æœ‰å¼•å…¥ Adviceï¼Œè¯¥ç±»ä¸ä¼šé…ç½®==========</span></span><br><span class="line">	<span class="meta">@ConditionalOnClass(Advice.class)</span></span><br><span class="line">	<span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">AspectJAutoProxyingConfiguration</span> &#123;</span><br><span class="line">		<span class="meta">@Configuration(proxyBeanMethods = false)</span></span><br><span class="line">		<span class="meta">@EnableAspectJAutoProxy(proxyTargetClass = false)</span></span><br><span class="line">		<span class="meta">@ConditionalOnProperty(prefix = &quot;spring.aop&quot;, name = &quot;proxy-target-class&quot;, havingValue = &quot;false&quot;)</span></span><br><span class="line">		<span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">JdkDynamicAutoProxyConfiguration</span> &#123;</span><br><span class="line"></span><br><span class="line">		&#125;</span><br><span class="line">		<span class="meta">@Configuration(proxyBeanMethods = false)</span></span><br><span class="line">		<span class="meta">@EnableAspectJAutoProxy(proxyTargetClass = true)</span></span><br><span class="line">		<span class="meta">@ConditionalOnProperty(prefix = &quot;spring.aop&quot;, name = &quot;proxy-target-class&quot;, havingValue = &quot;true&quot;,</span></span><br><span class="line"><span class="meta">				matchIfMissing = true)</span></span><br><span class="line">		<span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">CglibAutoProxyConfiguration</span> &#123;</span><br><span class="line"></span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Configuration(proxyBeanMethods = false)</span></span><br><span class="line">    <span class="comment">// ==========ç”Ÿæ•ˆï¼Œä½†é…ç½®çš„åªæ˜¯ä¸€ä¸ªç®€å•ç‰ˆçš„AOP==========</span></span><br><span class="line">	<span class="meta">@ConditionalOnMissingClass(&quot;org.aspectj.weaver.Advice&quot;)</span></span><br><span class="line">	<span class="meta">@ConditionalOnProperty(prefix = &quot;spring.aop&quot;, name = &quot;proxy-target-class&quot;, havingValue = &quot;true&quot;,</span></span><br><span class="line"><span class="meta">			matchIfMissing = true)</span></span><br><span class="line">	<span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">ClassProxyingConfiguration</span> &#123;</span><br><span class="line">		<span class="meta">@Bean</span></span><br><span class="line">		<span class="keyword">static</span> BeanFactoryPostProcessor <span class="title function_">forceAutoProxyCreatorToUseClassProxying</span><span class="params">()</span> &#123;</span><br><span class="line">			<span class="keyword">return</span> (beanFactory) -&gt; &#123;</span><br><span class="line">				<span class="keyword">if</span> (beanFactory <span class="keyword">instanceof</span> BeanDefinitionRegistry) &#123;</span><br><span class="line">					<span class="type">BeanDefinitionRegistry</span> <span class="variable">registry</span> <span class="operator">=</span> (BeanDefinitionRegistry) beanFactory;</span><br><span class="line">					AopConfigUtils.registerAutoProxyCreatorIfNecessary(registry);</span><br><span class="line">					AopConfigUtils.forceAutoProxyCreatorToUseClassProxying(registry);</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
</blockquote>
<h3 id="ç¤ºä¾‹äºŒï¼šDispatcherServletAutoConfiguration"><a href="#ç¤ºä¾‹äºŒï¼šDispatcherServletAutoConfiguration" class="headerlink" title="ç¤ºä¾‹äºŒï¼šDispatcherServletAutoConfiguration"></a>ç¤ºä¾‹äºŒï¼šDispatcherServletAutoConfiguration</h3><blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@AutoConfigureOrder(Ordered.HIGHEST_PRECEDENCE)</span></span><br><span class="line"><span class="meta">@AutoConfiguration(after = ServletWebServerFactoryAutoConfiguration.class)</span></span><br><span class="line"><span class="comment">// ==========æ˜¯å¦ä¸ºservletç¯å¢ƒ==========</span></span><br><span class="line"><span class="meta">@ConditionalOnWebApplication(type = Type.SERVLET)</span></span><br><span class="line"><span class="meta">@ConditionalOnClass(DispatcherServlet.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DispatcherServletAutoConfiguration</span> &#123;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">DEFAULT_DISPATCHER_SERVLET_BEAN_NAME</span> <span class="operator">=</span> <span class="string">&quot;dispatcherServlet&quot;</span>;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">DEFAULT_DISPATCHER_SERVLET_REGISTRATION_BEAN_NAME</span> <span class="operator">=</span> <span class="string">&quot;dispatcherServletRegistration&quot;</span>;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Configuration(proxyBeanMethods = false)</span></span><br><span class="line">	<span class="meta">@Conditional(DefaultDispatcherServletCondition.class)</span></span><br><span class="line">	<span class="meta">@ConditionalOnClass(ServletRegistration.class)</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ==========ä½¿ç”¨@EnableConfigurationPropertiesä¸ºWebMvcPropertiesç»‘å®šé…ç½®==========</span></span><br><span class="line">    <span class="comment">// ==========@EnableConfigurationPropertiesï¼šç»‘å®šé…ç½®ã€æ”¾å…¥å®¹å™¨==========</span></span><br><span class="line">	<span class="meta">@EnableConfigurationProperties(WebMvcProperties.class)</span></span><br><span class="line">	<span class="keyword">protected</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">DispatcherServletConfiguration</span> &#123;</span><br><span class="line"></span><br><span class="line">		<span class="meta">@Bean(name = DEFAULT_DISPATCHER_SERVLET_BEAN_NAME)</span></span><br><span class="line">        <span class="comment">// ==========@Beanæ–¹æ³•ä¸­çš„å‚æ•°ä¼šä»å®¹å™¨ä¸­æ‹¿å€¼==========</span></span><br><span class="line">		<span class="keyword">public</span> DispatcherServlet <span class="title function_">dispatcherServlet</span><span class="params">(WebMvcProperties webMvcProperties)</span> &#123;</span><br><span class="line">			<span class="type">DispatcherServlet</span> <span class="variable">dispatcherServlet</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DispatcherServlet</span>();</span><br><span class="line">			dispatcherServlet.setDispatchOptionsRequest(webMvcProperties.isDispatchOptionsRequest());</span><br><span class="line">dispatcherServlet.setDispatchTraceRequest(webMvcProperties.isDispatchTraceRequest());</span><br><span class="line">dispatcherServlet.setThrowExceptionIfNoHandlerFound(webMvcProperties.isThrowExceptionIfNoHandlerFound());</span><br><span class="line">dispatcherServlet.setPublishEvents(webMvcProperties.isPublishRequestHandledEvents());</span><br><span class="line">dispatcherServlet.setEnableLoggingRequestDetails(webMvcProperties.isLogRequestDetails());</span><br><span class="line">			<span class="keyword">return</span> dispatcherServlet;</span><br><span class="line">		&#125;</span><br><span class="line">        </span><br><span class="line">		<span class="comment">// ==========è¯¥@Beanç›¸å½“äºè§„èŒƒäº†Beançš„åç§°ï¼šå¦‚æœæœ‰ç»„ä»¶MultipartResolverä½†åå­—ä¸æ˜¯multipartResolverçš„Beanï¼Œä¼šé‡æ–°è§„èŒƒå‘½å==========</span></span><br><span class="line">		<span class="meta">@Bean</span></span><br><span class="line">		<span class="meta">@ConditionalOnBean(MultipartResolver.class)</span></span><br><span class="line">		<span class="meta">@ConditionalOnMissingBean(name = DispatcherServlet.MULTIPART_RESOLVER_BEAN_NAME)</span></span><br><span class="line">		<span class="keyword">public</span> MultipartResolver <span class="title function_">multipartResolver</span><span class="params">(MultipartResolver resolver)</span> &#123;</span><br><span class="line">			<span class="keyword">return</span> resolver;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
</blockquote>
<h3 id="ç¤ºä¾‹ä¸‰ï¼šHttpEncodingAutoConfiguration"><a href="#ç¤ºä¾‹ä¸‰ï¼šHttpEncodingAutoConfiguration" class="headerlink" title="ç¤ºä¾‹ä¸‰ï¼šHttpEncodingAutoConfiguration"></a>ç¤ºä¾‹ä¸‰ï¼šHttpEncodingAutoConfiguration</h3><blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@AutoConfiguration</span></span><br><span class="line"><span class="comment">// ==========ä¸ºServerPropertiesç»‘å®šäº†é…ç½®==========</span></span><br><span class="line"><span class="meta">@EnableConfigurationProperties(ServerProperties.class)</span></span><br><span class="line"><span class="meta">@ConditionalOnWebApplication(type = ConditionalOnWebApplication.Type.SERVLET)</span></span><br><span class="line"><span class="meta">@ConditionalOnClass(CharacterEncodingFilter.class)</span></span><br><span class="line"><span class="meta">@ConditionalOnProperty(prefix = &quot;server.servlet.encoding&quot;, value = &quot;enabled&quot;, matchIfMissing = true)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HttpEncodingAutoConfiguration</span> &#123;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">private</span> <span class="keyword">final</span> Encoding properties;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">public</span> <span class="title function_">HttpEncodingAutoConfiguration</span><span class="params">(ServerProperties properties)</span> &#123;</span><br><span class="line">      <span class="built_in">this</span>.properties = properties.getServlet().getEncoding();</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="meta">@Bean</span></span><br><span class="line">   <span class="meta">@ConditionalOnMissingBean</span></span><br><span class="line">   <span class="keyword">public</span> CharacterEncodingFilter <span class="title function_">characterEncodingFilter</span><span class="params">()</span> &#123;</span><br><span class="line">      <span class="type">CharacterEncodingFilter</span> <span class="variable">filter</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">OrderedCharacterEncodingFilter</span>();</span><br><span class="line">       </span><br><span class="line">       <span class="comment">// ==========é€šè¿‡æœ‰å‚æ„é€ è·å–é…ç½®æ–‡ä»¶ä¸­çš„å€¼==========</span></span><br><span class="line">      filter.setEncoding(<span class="built_in">this</span>.properties.getCharset().name());</span><br><span class="line">      filter.setForceRequestEncoding(<span class="built_in">this</span>.properties.shouldForce(Encoding.Type.REQUEST));</span><br><span class="line">      filter.setForceResponseEncoding(<span class="built_in">this</span>.properties.shouldForce(Encoding.Type.RESPONSE));</span><br><span class="line">      <span class="keyword">return</span> filter;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<p>ServerPropertiesï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@ConfigurationProperties(prefix = &quot;server&quot;, ignoreUnknownFields = true)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ServerProperties</span> &#123;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * Server HTTP port.</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">private</span> Integer port;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * Network address to which the server should bind.</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">private</span> InetAddress address;</span><br><span class="line">    </span><br><span class="line">   	<span class="keyword">private</span> <span class="keyword">final</span> <span class="type">Servlet</span> <span class="variable">servlet</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Servlet</span>();</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">Servlet</span> &#123;</span><br><span class="line"></span><br><span class="line">		<span class="comment">/**</span></span><br><span class="line"><span class="comment">		 * Servlet context init parameters.</span></span><br><span class="line"><span class="comment">		 */</span></span><br><span class="line">		<span class="keyword">private</span> <span class="keyword">final</span> Map&lt;String, String&gt; contextParameters = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">		<span class="comment">/**</span></span><br><span class="line"><span class="comment">		 * Context path of the application.</span></span><br><span class="line"><span class="comment">		 */</span></span><br><span class="line">		<span class="keyword">private</span> String contextPath;</span><br><span class="line"></span><br><span class="line">		<span class="comment">/**</span></span><br><span class="line"><span class="comment">		 * Display name of the application.</span></span><br><span class="line"><span class="comment">		 */</span></span><br><span class="line">		<span class="keyword">private</span> <span class="type">String</span> <span class="variable">applicationDisplayName</span> <span class="operator">=</span> <span class="string">&quot;application&quot;</span>;</span><br><span class="line"></span><br><span class="line">		<span class="comment">/**</span></span><br><span class="line"><span class="comment">		 * Whether to register the default Servlet with the container.</span></span><br><span class="line"><span class="comment">		 */</span></span><br><span class="line">		<span class="keyword">private</span> <span class="type">boolean</span> <span class="variable">registerDefaultServlet</span> <span class="operator">=</span> <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">		<span class="meta">@NestedConfigurationProperty</span></span><br><span class="line">		<span class="keyword">private</span> <span class="keyword">final</span> <span class="type">Encoding</span> <span class="variable">encoding</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Encoding</span>();</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Encoding</span> &#123;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * Default HTTP encoding for Servlet applications.</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Charset</span> <span class="variable">DEFAULT_CHARSET</span> <span class="operator">=</span> StandardCharsets.UTF_8;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * Charset of HTTP requests and responses. Added to the &quot;Content-Type&quot; header if not</span></span><br><span class="line"><span class="comment">	 * set explicitly.</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">private</span> <span class="type">Charset</span> <span class="variable">charset</span> <span class="operator">=</span> DEFAULT_CHARSET;</span><br></pre></td></tr></table></figure>

<p>application.propertiesï¼š</p>
<figure class="highlight properties"><table><tr><td class="code"><pre><span class="line"><span class="attr">server.servlet.encoding.charset</span>=<span class="string">utf-8</span></span><br></pre></td></tr></table></figure>
</blockquote>
<h1 id="æœ€ä½³å®è·µï¼šæ€»ç»“"><a href="#æœ€ä½³å®è·µï¼šæ€»ç»“" class="headerlink" title="æœ€ä½³å®è·µï¼šæ€»ç»“"></a>æœ€ä½³å®è·µï¼šæ€»ç»“</h1><ul>
<li><p>å¼•å…¥åœºæ™¯ä¾èµ–</p>
</li>
<li><ul>
<li><a href="https://docs.spring.io/spring-boot/docs/current/reference/html/using-spring-boot.html#using-boot-starter">https://docs.spring.io/spring-boot/docs/current/reference/html/using-spring-boot.html#using-boot-starter</a></li>
</ul>
</li>
<li><p>æŸ¥çœ‹è‡ªåŠ¨é…ç½®äº†å“ªäº›å±æ€§</p>
</li>
<li><ul>
<li>è‡ªå·±åˆ†æï¼Œå¼•å…¥åœºæ™¯å¯¹åº”çš„è‡ªåŠ¨é…ç½®ä¸€èˆ¬éƒ½ç”Ÿæ•ˆ<ul>
<li>é…ç½®æ–‡ä»¶ä¸­ <strong>debug&#x3D;true</strong> å¼€å¯è‡ªåŠ¨é…ç½®æŠ¥å‘Šã€‚Negativeï¼ˆä¸ç”Ÿæ•ˆï¼‰\Positiveï¼ˆç”Ÿæ•ˆï¼‰</li>
</ul>
</li>
</ul>
</li>
<li><p>æ˜¯å¦éœ€è¦ä¿®æ”¹</p>
</li>
<li><ul>
<li>å‚ç…§æ–‡æ¡£ä¿®æ”¹é…ç½®é¡¹</li>
</ul>
</li>
<li><ul>
<li><ul>
<li><a href="https://docs.spring.io/spring-boot/docs/current/reference/html/appendix-application-properties.html#common-application-properties">https://docs.spring.io/spring-boot/docs/current/reference/html/appendix-application-properties.html#common-application-properties</a><ul>
<li>è‡ªå·±åˆ†æï¼ŒxxxxPropertiesç»‘å®šäº†é…ç½®æ–‡ä»¶çš„å“ªäº›å±æ€§ã€‚</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><ul>
<li>è‡ªå®šä¹‰åŠ å…¥æˆ–è€…æ›¿æ¢ç»„ä»¶</li>
</ul>
</li>
<li><ul>
<li><ul>
<li>@Beanã€@Component</li>
</ul>
</li>
</ul>
</li>
<li><ul>
<li>è‡ªå®šä¹‰å™¨  <strong>XXXXXCustomizer</strong>ï¼›<ul>
<li><p>ç¤ºä¾‹ï¼šä¿®æ”¹SpringBootå¯åŠ¨çš„banner</p>
</li>
<li><p>&#96;&#96;&#96;properties<br>  spring.banner.image.location&#x3D;classpath:bug.jpg</p>
  <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"># å‡ ä¸ªå¼€å‘ä¸­çš„æ’ä»¶</span><br><span class="line"></span><br><span class="line">## lombok</span><br><span class="line"></span><br><span class="line">ç®€åŒ– get/set ç­‰å…¶ä»–æ–¹æ³•çš„æ‰‹åŠ¨ç¼–å†™ã€‚</span><br><span class="line"></span><br><span class="line">```xml</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.projectlombok&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;lombok&lt;/artifactId&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
</ul>
</li>
</ul>
<p>ç¤ºä¾‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="meta">@ToString</span></span><br><span class="line"><span class="meta">@Accessors(chain = true)</span></span><br><span class="line"><span class="meta">@EqualsAndHashCode</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Car</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String brand;</span><br><span class="line">    <span class="keyword">private</span> Integer price;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="dev-tools"><a href="#dev-tools" class="headerlink" title="dev-tools"></a>dev-tools</h2><p><a href="https://docs.spring.io/spring-boot/docs/current/reference/html/using.html#using.devtools">https://docs.spring.io/spring-boot/docs/current/reference/html/using.html#using.devtools</a></p>
<p>å¼•å…¥ä¾èµ–ï¼š</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-devtools<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>ä¿®æ”¹é¡µé¢ï¼Œä½¿ç”¨ CTRL +F9 é‡æ–°ç¼–è¯‘ï¼ˆç±»ä¼¼é‡å¯ï¼‰</p>
<h2 id="SpringInitializer"><a href="#SpringInitializer" class="headerlink" title="SpringInitializer"></a>SpringInitializer</h2><p>â€‹		è‡ªåŠ¨å¼•å…¥ä¾èµ–ã€åˆ›å»ºç›®å½•ç»“æ„ã€ç¼–å†™ä¸»é…ç½®ç±»</p>
<h1 id="é…ç½®æ–‡ä»¶ï¼šyaml"><a href="#é…ç½®æ–‡ä»¶ï¼šyaml" class="headerlink" title="é…ç½®æ–‡ä»¶ï¼šyaml"></a>é…ç½®æ–‡ä»¶ï¼šyaml</h1><h2 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h2><p>â€‹		YAML æ˜¯ â€œYAML Ainâ€™t Markup Languageâ€ï¼ˆYAML ä¸æ˜¯ä¸€ç§æ ‡è®°è¯­è¨€ï¼‰çš„é€’å½’ç¼©å†™ã€‚åœ¨å¼€å‘çš„è¿™ç§è¯­è¨€æ—¶ï¼ŒYAML çš„æ„æ€å…¶å®æ˜¯ï¼šâ€Yet Another Markup Languageâ€ï¼ˆä»æ˜¯ä¸€ç§æ ‡è®°è¯­è¨€ï¼‰ã€‚ é€‚åˆç”¨æ¥åšä»¥æ•°æ®ä¸ºä¸­å¿ƒçš„é…ç½®æ–‡ä»¶ã€‚</p>
<h2 id="åŸºæœ¬è¯­æ³•"><a href="#åŸºæœ¬è¯­æ³•" class="headerlink" title="åŸºæœ¬è¯­æ³•"></a>åŸºæœ¬è¯­æ³•</h2><ul>
<li>key: valueï¼›kvä¹‹é—´æœ‰ç©ºæ ¼</li>
<li>å¤§å°å†™æ•æ„Ÿ</li>
<li>ä½¿ç”¨ç¼©è¿›è¡¨ç¤ºå±‚çº§å…³ç³»</li>
<li>ç¼©è¿›ä¸å…è®¸ä½¿ç”¨tabï¼Œåªå…è®¸ç©ºæ ¼</li>
<li>ç¼©è¿›çš„ç©ºæ ¼æ•°ä¸é‡è¦ï¼Œåªè¦ç›¸åŒå±‚çº§çš„å…ƒç´ å·¦å¯¹é½å³å¯</li>
<li>â€˜#â€™ è¡¨ç¤ºæ³¨é‡Š</li>
<li>å­—ç¬¦ä¸²æ— éœ€åŠ å¼•å·ï¼Œå¦‚æœè¦åŠ ï¼Œâ€™ â€˜ ä¸ â€œ â€œ è¡¨ç¤ºå­—ç¬¦ä¸²å†…å®¹ä¼šè¢« <strong>è½¬ä¹‰&#x2F;ä¸è½¬ä¹‰</strong></li>
</ul>
<h2 id="æ•°æ®ç±»å‹"><a href="#æ•°æ®ç±»å‹" class="headerlink" title="æ•°æ®ç±»å‹"></a>æ•°æ®ç±»å‹</h2><ul>
<li><p>å­—é¢é‡</p>
<p>  å•ä¸ªçš„ã€ä¸å¯å†åˆ†çš„å€¼ã€‚dateã€booleanã€stringã€numberã€null</p>
  <figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">K:</span> <span class="string">v</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>å¯¹è±¡ï¼šé”®å€¼å¯¹çš„é›†åˆã€‚mapã€hashã€setã€object </p>
  <figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="string">è¡Œå†…å†™æ³•ï¼š</span>  <span class="attr">k:</span> &#123;<span class="string">k1:v1</span>,<span class="string">k2:v2</span>,<span class="string">k3:v3</span>&#125;</span><br><span class="line"><span class="comment">#æˆ–</span></span><br><span class="line"><span class="attr">k:</span> </span><br><span class="line">  <span class="attr">k1:</span> <span class="string">v1</span></span><br><span class="line">  <span class="attr">k2:</span> <span class="string">v2</span></span><br><span class="line">  <span class="attr">k3:</span> <span class="string">v3</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>æ•°ç»„ï¼šä¸€ç»„æŒ‰æ¬¡åºæ’åˆ—çš„å€¼ã€‚arrayã€listã€queue</p>
  <figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="string">è¡Œå†…å†™æ³•ï¼š</span>  <span class="attr">k:</span> [<span class="string">v1</span>,<span class="string">v2</span>,<span class="string">v3</span>]</span><br><span class="line"><span class="comment">#æˆ–è€…</span></span><br><span class="line"><span class="attr">k:</span></span><br><span class="line"> <span class="bullet">-</span> <span class="string">v1</span></span><br><span class="line"> <span class="bullet">-</span> <span class="string">v2</span></span><br><span class="line"> <span class="bullet">-</span> <span class="string">v3</span></span><br></pre></td></tr></table></figure>

<p>  ç¤ºä¾‹ï¼š</p>
  <figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@ConfigurationProperties(prefix = &quot;person&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Person</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String userName;</span><br><span class="line">    <span class="keyword">private</span> Boolean boss;</span><br><span class="line">    <span class="keyword">private</span> Date birth;</span><br><span class="line">    <span class="keyword">private</span> Integer age;</span><br><span class="line">    <span class="keyword">private</span> Pet pet;</span><br><span class="line">    <span class="keyword">private</span> String[] interests;</span><br><span class="line">    <span class="keyword">private</span> List&lt;String&gt; animal;</span><br><span class="line">    <span class="keyword">private</span> Map&lt;String, Object&gt; score;</span><br><span class="line">    <span class="keyword">private</span> Set&lt;Double&gt; salary;</span><br><span class="line">    <span class="keyword">private</span> Map&lt;String, List&lt;Pet&gt;&gt; allPets;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

  <figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@ConfigurationProperties(prefix = &quot;pet&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Pet</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> Double weight;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

  <figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">person:</span></span><br><span class="line">  <span class="attr">userName:</span> <span class="string">&quot;mineting \n minefei&quot;</span></span><br><span class="line">  <span class="comment"># æ³¨æ„ï¼šåŒå¼•å·ä¸­çš„\nä¼šæ¢è¡Œï¼Œå’Œæ™®é€šå­—ç¬¦ä¸²ä¸€æ ·ï¼Œå•å¼•å·åˆ™ä¼šåŸæ ·è¾“å‡º</span></span><br><span class="line">  <span class="comment"># userNameå¯ä»¥å†™ä½œuser-name</span></span><br><span class="line">  <span class="attr">boss:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">birth:</span> <span class="number">1997</span><span class="string">/01/20</span> <span class="number">08</span><span class="string">:00:00</span></span><br><span class="line">  <span class="attr">age:</span> <span class="number">24</span></span><br><span class="line">  <span class="comment">#pet: &#123; name:tomcat,weight:24.0 &#125;</span></span><br><span class="line">  <span class="attr">pet:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">tomcat</span></span><br><span class="line">    <span class="attr">weight:</span> <span class="number">24.0</span></span><br><span class="line">  <span class="attr">interests:</span> [ <span class="string">Java</span>,<span class="string">Go</span>,<span class="string">Python</span> ]</span><br><span class="line">  <span class="attr">animal:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">tom</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">jerry</span></span><br><span class="line">  <span class="attr">score:</span></span><br><span class="line">    <span class="attr">english:</span></span><br><span class="line">      <span class="attr">first:</span> <span class="number">100</span></span><br><span class="line">      <span class="attr">second:</span> <span class="number">90</span></span><br><span class="line">      <span class="attr">third:</span> <span class="number">80</span></span><br><span class="line">    <span class="attr">math:</span> [ <span class="number">100</span>,<span class="number">99</span>,<span class="number">98</span> ]</span><br><span class="line">  <span class="attr">salary:</span> [ <span class="number">10.0</span>,<span class="number">10.1</span>,<span class="number">10.2</span> ]</span><br><span class="line">  <span class="attr">allPets:</span></span><br><span class="line">    <span class="attr">sick:</span></span><br><span class="line">      <span class="bullet">-</span> &#123; <span class="attr">name:</span> <span class="string">tom</span> &#125;</span><br><span class="line">      <span class="bullet">-</span> &#123; <span class="attr">name:</span> <span class="string">jerry</span>,<span class="string">weight:12.0</span> &#125;</span><br><span class="line">    <span class="attr">health:</span> [ &#123; <span class="attr">name:</span> <span class="string">jerry</span>,<span class="attr">weight:</span> <span class="number">2.0</span> &#125; ]</span><br></pre></td></tr></table></figure>

  <figure class="highlight properties"><table><tr><td class="code"><pre><span class="line"><span class="comment">#å¦‚æœyamlå’Œpropertieséƒ½é…ç½®ï¼Œä»¥propertiesä¸ºå‡†</span></span><br><span class="line"><span class="attr">person.userName</span>=<span class="string">minefei</span></span><br></pre></td></tr></table></figure>

<p>  æµ‹è¯•ï¼š</p>
  <figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HelloController</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    Person person;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/yaml&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Person <span class="title function_">person</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(person.getUserName());</span><br><span class="line">        <span class="keyword">return</span> person;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="é…ç½®ç»‘å®šæç¤º"><a href="#é…ç½®ç»‘å®šæç¤º" class="headerlink" title="é…ç½®ç»‘å®šæç¤º"></a>é…ç½®ç»‘å®šæç¤º</h2><p><a href="https://docs.spring.io/spring-boot/docs/current/reference/html/configuration-metadata.html#appendix.configuration-metadata.format.propert">https://docs.spring.io/spring-boot/docs/current/reference/html/configuration-metadata.html#appendix.configuration-metadata.format.propert</a></p>
<p>è‡ªå®šä¹‰Beanå±æ€§ç»‘å®šæç¤ºï¼š<br>å¼•å…¥ä¾èµ–ï¼š</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-configuration-processor<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>æ‰“åŒ…æ—¶ç•¥è¿‡ï¼š</p>
<blockquote>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.maven.plugins<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-compiler-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">proc</span>&gt;</span>none<span class="tag">&lt;/<span class="name">proc</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>æˆ–è€…</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">excludes</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">exclude</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-configuration-processor<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">exclude</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">excludes</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br></pre></td></tr></table></figure>


</blockquote>
<h1 id="Webå¼€å‘"><a href="#Webå¼€å‘" class="headerlink" title="Webå¼€å‘"></a>Webå¼€å‘</h1><h2 id="SpringMVCè‡ªåŠ¨é…ç½®æ¦‚è§ˆ"><a href="#SpringMVCè‡ªåŠ¨é…ç½®æ¦‚è§ˆ" class="headerlink" title="SpringMVCè‡ªåŠ¨é…ç½®æ¦‚è§ˆ"></a>SpringMVCè‡ªåŠ¨é…ç½®æ¦‚è§ˆ</h2><p><a href="https://docs.spring.io/spring-boot/docs/current/reference/html/web.html#web.servlet.spring-mvc.auto-configuration">https://docs.spring.io/spring-boot/docs/current/reference/html/web.html#web.servlet.spring-mvc.auto-configuration</a></p>
<blockquote>
<h4 id="Spring-MVC-Auto-configuration"><a href="#Spring-MVC-Auto-configuration" class="headerlink" title="Spring MVC Auto-configuration"></a>Spring MVC Auto-configuration</h4><p>Spring Boot provides auto-configuration for Spring MVC that works well with most applications.</p>
<p>The auto-configuration adds the following features on top of Springâ€™s defaults:</p>
<ul>
<li><p>Inclusion of <code>ContentNegotiatingViewResolver</code> and <code>BeanNameViewResolver</code> beans.</p>
</li>
<li><p>å†…å®¹åå•†è§†å›¾è§£æå™¨å’ŒBeanNameè§†å›¾è§£æå™¨</p>
</li>
<li><p>Support for serving static resources, including support for WebJars (covered <a href="https://docs.spring.io/spring-boot/docs/current/reference/html/features.html#web.servlet.spring-mvc.static-content">later in this document</a>).</p>
</li>
<li><p>é™æ€èµ„æºï¼ˆåŒ…æ‹¬webjarsï¼‰</p>
</li>
<li><p>Automatic registration of <code>Converter</code>, <code>GenericConverter</code>, and <code>Formatter</code> beans.</p>
<p>  è‡ªåŠ¨æ³¨å†Œ <code>Converterï¼ŒGenericConverterï¼ŒFormatter</code></p>
</li>
<li><p>Support for <code>HttpMessageConverters</code> (covered <a href="https://docs.spring.io/spring-boot/docs/current/reference/html/features.html#web.servlet.spring-mvc.message-converters">later in this document</a>).</p>
</li>
<li><p>æ”¯æŒ <code>HttpMessageConverters</code> ï¼ˆåæ¥æˆ‘ä»¬é…åˆå†…å®¹åå•†ç†è§£åŸç†ï¼‰</p>
</li>
<li><p>Automatic registration of <code>MessageCodesResolver</code> (covered <a href="https://docs.spring.io/spring-boot/docs/current/reference/html/features.html#web.servlet.spring-mvc.message-codes">later in this document</a>).</p>
</li>
<li><p>è‡ªåŠ¨æ³¨å†Œ <code>MessageCodesResolver</code> ï¼ˆå›½é™…åŒ–ç”¨ï¼‰</p>
</li>
<li><p>Static <code>index.html</code> support.</p>
</li>
<li><p>é™æ€index.html é¡µæ”¯æŒ</p>
</li>
<li><p>Automatic use of a <code>ConfigurableWebBindingInitializer</code> bean (covered <a href="https://docs.spring.io/spring-boot/docs/current/reference/html/features.html#web.servlet.spring-mvc.binding-initializer">later in this document</a>).</p>
</li>
<li><p>è‡ªåŠ¨ä½¿ç”¨ <code>ConfigurableWebBindingInitializer</code> ï¼Œï¼ˆDataBinderè´Ÿè´£å°†è¯·æ±‚æ•°æ®ç»‘å®šåˆ°JavaBeanä¸Šï¼‰</p>
</li>
</ul>
<p>If you want to keep those Spring Boot MVC customizations and make more <a href="https://docs.spring.io/spring-framework/docs/5.3.23/reference/html/web.html#mvc">MVC customizations</a> (interceptors, formatters, view controllers, and other features), you can add your own <code>@Configuration</code> class of type <code>WebMvcConfigurer</code> but <strong>without</strong> <code>@EnableWebMvc</code>.</p>
<p><strong>ä¸ç”¨@EnableWebMvcæ³¨è§£ã€‚ä½¿ç”¨</strong> <code>@Configuration</code> <strong>+</strong> <code>WebMvcConfigurer</code> <strong>è‡ªå®šä¹‰è§„åˆ™</strong></p>
<p>If you want to provide custom instances of <code>RequestMappingHandlerMapping</code>, <code>RequestMappingHandlerAdapter</code>, or <code>ExceptionHandlerExceptionResolver</code>, and still keep the Spring Boot MVC customizations, you can declare a bean of type <code>WebMvcRegistrations</code> and use it to provide custom instances of those components.</p>
<p><strong>å£°æ˜</strong> <code>WebMvcRegistrations</code> <strong>æ”¹å˜é»˜è®¤åº•å±‚ç»„ä»¶</strong></p>
<p>If you want to take complete control of Spring MVC, you can add your own <code>@Configuration</code> annotated with <code>@EnableWebMvc</code>, or alternatively add your own <code>@Configuration</code>-annotated <code>DelegatingWebMvcConfiguration</code> as described in the Javadoc of <code>@EnableWebMvc</code>.</p>
<p><strong>ä½¿ç”¨</strong> <code>@EnableWebMvc+@Configuration+DelegatingWebMvcConfiguration å…¨é¢æ¥ç®¡SpringMVC</code></p>
</blockquote>
<h2 id="é™æ€èµ„æºè§„åˆ™ä¸å®šåˆ¶"><a href="#é™æ€èµ„æºè§„åˆ™ä¸å®šåˆ¶" class="headerlink" title="é™æ€èµ„æºè§„åˆ™ä¸å®šåˆ¶"></a>é™æ€èµ„æºè§„åˆ™ä¸å®šåˆ¶</h2><h3 id="é™æ€èµ„æºè®¿é—®"><a href="#é™æ€èµ„æºè®¿é—®" class="headerlink" title="é™æ€èµ„æºè®¿é—®"></a>é™æ€èµ„æºè®¿é—®</h3><h4 id="é™æ€èµ„æºç›®å½•"><a href="#é™æ€èµ„æºç›®å½•" class="headerlink" title="é™æ€èµ„æºç›®å½•"></a>é™æ€èµ„æºç›®å½•</h4><blockquote>
<p>By default, Spring Boot serves static content from a directory called <code>/static</code> (or <code>/public</code> or <code>/resources</code> or <code>/META-INF/resources</code>) in the classpath or from the root of the <code>ServletContext</code></p>
<p>é»˜è®¤åœ¨ç±»è·¯å¾„ä¸‹ï¼š&#x2F;static	&#x2F;public	&#x2F;resources	&#x2F;META-INF&#x2F;resources çš„é™æ€èµ„æºéƒ½èƒ½è®¿é—®ã€‚</p>
<p>è®¿é—®è·¯å¾„ï¼šlocalhost:8080&#x2F;1.jpg</p>
<p>é…ç½®é»˜è®¤é™æ€èµ„æºè·¯å¾„ï¼š</p>
<p>You can also customize the static resource locations by using the <code>spring.web.resources.static-locations</code> property (replacing the default values with a list of directory locations). The root servlet context path, <code>&quot;/&quot;</code>, is automatically added as a location as well.</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">web:</span></span><br><span class="line">    <span class="attr">resources:</span></span><br><span class="line">      <span class="attr">static-locations:</span> [<span class="string">classpath:/test/</span>]</span><br></pre></td></tr></table></figure>

<p>æ­¤æ—¶è®¿é—®è·¯å¾„ï¼šlocalhost:8080&#x2F;1.jpg</p>
<p>æ­¤æ—¶é™æ€èµ„æºæ”¾åœ¨ç±»è·¯å¾„ &#x2F;test ç›®å½•ä¸‹ã€‚</p>
</blockquote>
<h4 id="é™æ€èµ„æºè®¿é—®å‰ç¼€"><a href="#é™æ€èµ„æºè®¿é—®å‰ç¼€" class="headerlink" title="é™æ€èµ„æºè®¿é—®å‰ç¼€"></a>é™æ€èµ„æºè®¿é—®å‰ç¼€</h4><blockquote>
<p>By default, resources are mapped on <code>/**</code>, but you can tune that with the <code>spring.mvc.static-path-pattern</code> property. For instance, relocating all resources to <code>/resources/**</code> can be achieved as follows:</p>
<figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">mvc:</span></span><br><span class="line">    <span class="attr">static-path-pattern:</span> <span class="string">/resources/**</span></span><br></pre></td></tr></table></figure>

<p>æ­¤æ—¶è®¿é—®è·¯å¾„ï¼šlocalhost:8080&#x2F;resources&#x2F;1.jpg</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HelloController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * é™æ€èµ„æºæ˜ å°„çš„æ˜¯ /**</span></span><br><span class="line"><span class="comment">     * è¯·æ±‚å…ˆå»æ‰¾Controllerçœ‹èƒ½ä¸èƒ½å¤„ç†ï¼Œå¦‚æœä¸èƒ½ï¼Œå†äº¤ç»™é™æ€èµ„æºå¤„ç†å™¨</span></span><br><span class="line"><span class="comment">     * å¦‚æœé™æ€èµ„æºHandlerä¸èƒ½å¤„ç†ï¼Œåˆ™æŠ¥404</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;1.jpg&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">hello</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Hello StaticContent!&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


</blockquote>
<h4 id="webjar"><a href="#webjar" class="headerlink" title="webjar"></a>webjar</h4><blockquote>
<p><strong>webjars æ”¾åœ¨ META-INF&#x2F;resources ç›®å½•ä¸‹ã€‚</strong></p>
<p>å°†é™æ€èµ„æºä»¥ maven çš„å½¢å¼å¼•å…¥ä¾èµ–</p>
<p><a href="https://www.webjars.org/">https://www.webjars.org/</a></p>
<p>To use version agnostic URLs for Webjars, add the <code>webjars-locator-core</code> dependency. Then declare your Webjar. Using jQuery as an example, adding <code>&quot;/webjars/jquery/jquery.min.js&quot;</code> results in <code>&quot;/webjars/jquery/x.y.z/jquery.min.js&quot;</code> where <code>x.y.z</code> is the Webjar version.</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.webjars.npm<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jquery<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.6.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>è®¿é—®è·¯å¾„ï¼š<a href="http://localhost:8080/webjars/jquery/3.6.0/dist/jquery.js">http://localhost:8080/webjars/jquery/3.6.0/dist/jquery.js</a></p>
</blockquote>
<h3 id="æ¬¢è¿é¡µæ”¯æŒ"><a href="#æ¬¢è¿é¡µæ”¯æŒ" class="headerlink" title="æ¬¢è¿é¡µæ”¯æŒ"></a>æ¬¢è¿é¡µæ”¯æŒ</h3><blockquote>
<p>Spring Boot supports both static and templated welcome pages. It first looks for an <code>index.html</code> file in the configured static content locations. If one is not found, it then looks for an <code>index</code> template. If either is found, it is automatically used as the welcome page of the application.</p>
</blockquote>
<p>é™æ€èµ„æºè·¯å¾„ä¸‹æ·»åŠ  index.html</p>
<p>æ³¨æ„ï¼š</p>
<ul>
<li>å¯ä»¥é…ç½®é™æ€èµ„æºè·¯å¾„</li>
<li>ä½†æ˜¯ä¸å¯ä»¥é…ç½®é™æ€èµ„æºçš„è®¿é—®å‰ç¼€ï¼Œå¦åˆ™å¯¼è‡´ index.htmlä¸èƒ½è¢«é»˜è®¤è®¿é—®</li>
</ul>
<h3 id="è‡ªå®šä¹‰-Favicon"><a href="#è‡ªå®šä¹‰-Favicon" class="headerlink" title="è‡ªå®šä¹‰ Favicon"></a>è‡ªå®šä¹‰ <code>Favicon</code></h3><blockquote>
<p>As with other static resources, Spring Boot checks for a <code>favicon.ico</code> in the configured static content locations. If such a file is present, it is automatically used as the favicon of the application.</p>
</blockquote>
<p>favicon.ico æ”¾åœ¨é™æ€èµ„æºç›®å½•ä¸‹ã€‚</p>
<p>æ³¨æ„ï¼š</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">mvc:</span></span><br><span class="line">    <span class="comment"># é™æ€èµ„æºè®¿é—®å‰ç¼€</span></span><br><span class="line">    <span class="comment"># è¿™ä¸ªä¼šå¯¼è‡´welcome pageå’Œfavicon.icoå¤±æ•ˆ</span></span><br><span class="line">    <span class="attr">static-path-pattern:</span> <span class="string">/resources/**</span></span><br></pre></td></tr></table></figure>

<h3 id="é™æ€èµ„æºé…ç½®åŸç†"><a href="#é™æ€èµ„æºé…ç½®åŸç†" class="headerlink" title="é™æ€èµ„æºé…ç½®åŸç†"></a>é™æ€èµ„æºé…ç½®åŸç†</h3><ul>
<li>SpringBoot å¯åŠ¨é»˜è®¤åŠ è½½ XXXXAutoConfiguration è‡ªåŠ¨é…ç½®ç±»</li>
<li>SpringMVC åŠŸèƒ½çš„è‡ªåŠ¨é…ç½®ç±» WebMvcAutoConfigurationç”Ÿæ•ˆ</li>
</ul>
<blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@AutoConfiguration(after = &#123; DispatcherServletAutoConfiguration.class, TaskExecutionAutoConfiguration.class,</span></span><br><span class="line"><span class="meta">		ValidationAutoConfiguration.class &#125;)</span></span><br><span class="line"><span class="meta">@ConditionalOnWebApplication(type = Type.SERVLET)</span></span><br><span class="line"><span class="meta">@ConditionalOnClass(&#123; Servlet.class, DispatcherServlet.class, WebMvcConfigurer.class &#125;)</span></span><br><span class="line"><span class="meta">@ConditionalOnMissingBean(WebMvcConfigurationSupport.class)</span></span><br><span class="line"><span class="meta">@AutoConfigureOrder(Ordered.HIGHEST_PRECEDENCE + 10)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WebMvcAutoConfiguration</span> &#123;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Configuration(proxyBeanMethods = false)</span></span><br><span class="line">	<span class="meta">@Import(EnableWebMvcConfiguration.class)</span></span><br><span class="line">    <span class="comment">// ==========ç»‘å®šäº†ä¸¤ä¸ªå±æ€§é…ç½®ç±»==========</span></span><br><span class="line">	<span class="meta">@EnableConfigurationProperties(&#123; WebMvcProperties.class, WebProperties.class &#125;)</span></span><br><span class="line">	<span class="meta">@Order(0)</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">WebMvcAutoConfigurationAdapter</span> <span class="keyword">implements</span> <span class="title class_">WebMvcConfigurer</span>, </span><br><span class="line">    ServletContextAware &#123;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong>WebMvcPropertiesï¼šspring.mvcï¼ŒWebPropertiesï¼šspring.web</strong></p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">mvc:</span></span><br><span class="line">    <span class="comment"># é™æ€èµ„æºè®¿é—®å‰ç¼€</span></span><br><span class="line">    <span class="comment"># è¿™ä¸ªä¼šå¯¼è‡´welcome pageå’Œfavicon.icoå¤±æ•ˆ</span></span><br><span class="line">    <span class="attr">static-path-pattern:</span> <span class="string">/resources/**</span></span><br><span class="line">  <span class="attr">web:</span></span><br><span class="line">    <span class="attr">resources:</span></span><br><span class="line">      <span class="comment"># é™æ€èµ„æºè®¿é—®è·¯å¾„</span></span><br><span class="line">      <span class="attr">static-locations:</span> [<span class="string">classpath:/test</span>]</span><br></pre></td></tr></table></figure>
</blockquote>
<h4 id="é…ç½®ç±»åªæœ‰ä¸€ä¸ªæœ‰å‚æ„é€ å™¨"><a href="#é…ç½®ç±»åªæœ‰ä¸€ä¸ªæœ‰å‚æ„é€ å™¨" class="headerlink" title="é…ç½®ç±»åªæœ‰ä¸€ä¸ªæœ‰å‚æ„é€ å™¨"></a>é…ç½®ç±»åªæœ‰ä¸€ä¸ªæœ‰å‚æ„é€ å™¨</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// æœ‰å‚æ„é€ å™¨æ‰€æœ‰å‚æ•°çš„å€¼éƒ½ä¼šä»å®¹å™¨ä¸­ç¡®å®š</span></span><br><span class="line"><span class="comment">// WebProperties webPropertiesï¼šè·å–å’Œspring.webç»‘å®šçš„æ‰€æœ‰çš„å€¼çš„å¯¹è±¡</span></span><br><span class="line"><span class="comment">// WebMvcProperties mvcPropertiesï¼šè·å–å’Œspring.mvcç»‘å®šçš„æ‰€æœ‰çš„å€¼çš„å¯¹è±¡</span></span><br><span class="line"><span class="comment">// ListableBeanFactory beanFactoryï¼šSpringçš„beanFactory</span></span><br><span class="line"><span class="comment">// HttpMessageConvertersï¼šHttpMessageConverters</span></span><br><span class="line"><span class="comment">// ResourceHandlerRegistrationCustomizerï¼šèµ„æºå¤„ç†å™¨çš„è‡ªå®šä¹‰å™¨ã€‚</span></span><br><span class="line"><span class="comment">// DispatcherServletPathï¼šservletè·¯å¾„</span></span><br><span class="line"><span class="comment">// ServletRegistrationBeanï¼šç»™åº”ç”¨æ³¨å†ŒServletã€Filter....</span></span><br><span class="line">		<span class="keyword">public</span> <span class="title function_">WebMvcAutoConfigurationAdapter</span><span class="params">(</span></span><br><span class="line"><span class="params">            WebProperties webProperties, WebMvcProperties mvcProperties,</span></span><br><span class="line"><span class="params">			ListableBeanFactory beanFactory, </span></span><br><span class="line"><span class="params">            ObjectProvider&lt;HttpMessageConverters&gt; messageConvertersProvider,</span></span><br><span class="line"><span class="params">			ObjectProvider&lt;ResourceHandlerRegistrationCustomizer&gt; 	resourceHandlerRegistrationCustomizerProvider,</span></span><br><span class="line"><span class="params">            ObjectProvider&lt;DispatcherServletPath&gt; dispatcherServletPath,</span></span><br><span class="line"><span class="params">            ObjectProvider&lt;ServletRegistrationBean&lt;?&gt;&gt; servletRegistrations)</span> &#123;</span><br><span class="line">			<span class="built_in">this</span>.resourceProperties = webProperties.getResources();</span><br><span class="line">			<span class="built_in">this</span>.mvcProperties = mvcProperties;</span><br><span class="line">			<span class="built_in">this</span>.beanFactory = beanFactory;</span><br><span class="line">			<span class="built_in">this</span>.messageConvertersProvider = messageConvertersProvider;</span><br><span class="line">			<span class="built_in">this</span>.resourceHandlerRegistrationCustomizer = resourceHandlerRegistrationCustomizerProvider.getIfAvailable();</span><br><span class="line">			<span class="built_in">this</span>.dispatcherServletPath = dispatcherServletPath;</span><br><span class="line">			<span class="built_in">this</span>.servletRegistrations = servletRegistrations;</span><br><span class="line">			<span class="built_in">this</span>.mvcProperties.checkConfiguration();</span><br><span class="line">		&#125;</span><br></pre></td></tr></table></figure>

<h4 id="èµ„æºå¤„ç†çš„é»˜è®¤è§„åˆ™"><a href="#èµ„æºå¤„ç†çš„é»˜è®¤è§„åˆ™" class="headerlink" title="èµ„æºå¤„ç†çš„é»˜è®¤è§„åˆ™"></a>èµ„æºå¤„ç†çš„é»˜è®¤è§„åˆ™</h4><blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addResourceHandlers</span><span class="params">(ResourceHandlerRegistry registry)</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ==========æ˜¯å¦ç¦ç”¨é™æ€èµ„æºæ˜ å°„è§„åˆ™ï¼šspring.web.resources.add-mappings: false==========</span></span><br><span class="line">    <span class="keyword">if</span> (!<span class="built_in">this</span>.resourceProperties.isAddMappings()) &#123;</span><br><span class="line">        logger.debug(<span class="string">&quot;Default resource handling disabled&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// ==========webjarsçš„å¤„ç†è§„åˆ™==========</span></span><br><span class="line">    addResourceHandler(registry, <span class="string">&quot;/webjars/**&quot;</span>, <span class="string">&quot;classpath:/META-INF/resources/webjars/&quot;</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ==========é™æ€èµ„æº/**çš„å¤„ç†è§„åˆ™==========</span></span><br><span class="line">    addResourceHandler(registry, <span class="built_in">this</span>.mvcProperties.getStaticPathPattern(), (registration) -&gt; &#123;</span><br><span class="line">        <span class="comment">// ==========é™æ€èµ„æºé»˜è®¤è·¯å¾„ï¼šstatic-locations: [classpath:/test]==========</span></span><br><span class="line">        registration.addResourceLocations(<span class="built_in">this</span>.resourceProperties.getStaticLocations());</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">this</span>.servletContext != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="type">ServletContextResource</span> <span class="variable">resource</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ServletContextResource</span>(<span class="built_in">this</span>.servletContext, SERVLET_LOCATION);</span><br><span class="line">            registration.addResourceLocations(resource);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">addResourceHandler</span><span class="params">(ResourceHandlerRegistry registry, String pattern, String... locations)</span> &#123;</span><br><span class="line">    addResourceHandler(registry, pattern, (registration) -&gt; registration.addResourceLocations(locations));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">addResourceHandler</span><span class="params">(ResourceHandlerRegistry registry, String pattern,</span></span><br><span class="line"><span class="params">                                Consumer&lt;ResourceHandlerRegistration&gt; customizer)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (registry.hasMappingForPattern(pattern)) &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">ResourceHandlerRegistration</span> <span class="variable">registration</span> <span class="operator">=</span> registry.addResourceHandler(pattern);</span><br><span class="line">    customizer.accept(registration);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ==========è®¾ç½®é™æ€èµ„æºç¼“å­˜æ—¶é—´ï¼šspring.web.resources.cache.period=1000==========</span></span><br><span class="line">    registration.setCachePeriod(getSeconds(<span class="built_in">this</span>.resourceProperties.getCache().getPeriod()));</span><br><span class="line">    registration.setCacheControl(<span class="built_in">this</span>.resourceProperties.getCache().getCachecontrol().toHttpCacheControl());</span><br><span class="line">    registration.setUseLastModified(<span class="built_in">this</span>.resourceProperties.getCache().isUseLastModified());</span><br><span class="line">    customizeResourceHandlerRegistration(registration);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>é™æ€èµ„æºé»˜è®¤è·¯å¾„ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String[] CLASSPATH_RESOURCE_LOCATIONS = &#123; <span class="string">&quot;classpath:/META-INF/resources/&quot;</span>,</span><br><span class="line">		<span class="string">&quot;classpath:/resources/&quot;</span>, <span class="string">&quot;classpath:/static/&quot;</span>, <span class="string">&quot;classpath:/public/&quot;</span> &#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Locations of static resources. Defaults to classpath:[/META-INF/resources/,</span></span><br><span class="line"><span class="comment"> * /resources/, /static/, /public/].</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">private</span> String[] staticLocations = CLASSPATH_RESOURCE_LOCATIONS;</span><br></pre></td></tr></table></figure>

<p>æ¬¢è¿é¡µå¤„ç†ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">	HandlerMappingï¼šå¤„ç†å™¨æ˜ å°„ã€‚ä¿å­˜äº†æ¯ä¸€ä¸ªHandlerèƒ½å¤„ç†å“ªäº›è¯·æ±‚ã€‚	</span><br><span class="line"></span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> WelcomePageHandlerMapping <span class="title function_">welcomePageHandlerMapping</span><span class="params">(ApplicationContext applicationContext,</span></span><br><span class="line"><span class="params">				FormattingConversionService mvcConversionService, ResourceUrlProvider mvcResourceUrlProvider)</span> &#123;</span><br><span class="line">			<span class="type">WelcomePageHandlerMapping</span> <span class="variable">welcomePageHandlerMapping</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">WelcomePageHandlerMapping</span>(</span><br><span class="line">					<span class="keyword">new</span> <span class="title class_">TemplateAvailabilityProviders</span>(applicationContext), applicationContext, getWelcomePage(),</span><br><span class="line">					<span class="built_in">this</span>.mvcProperties.getStaticPathPattern());</span><br><span class="line">welcomePageHandlerMapping.setInterceptors(getInterceptors(mvcConversionService, mvcResourceUrlProvider));</span><br><span class="line">			welcomePageHandlerMapping.setCorsConfigurations(getCorsConfigurations());</span><br><span class="line">			<span class="keyword">return</span> welcomePageHandlerMapping;</span><br><span class="line">		&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">WelcomePageHandlerMapping(TemplateAvailabilityProviders templateAvailabilityProviders,</span><br><span class="line">			ApplicationContext applicationContext, Resource welcomePage, String staticPathPattern) &#123;</span><br><span class="line">    <span class="comment">// ==========æ¬¢è¿é¡µåŠŸèƒ½ï¼Œå¿…é¡»æ˜¯/**==========</span></span><br><span class="line">		<span class="keyword">if</span> (welcomePage != <span class="literal">null</span> &amp;&amp; <span class="string">&quot;/**&quot;</span>.equals(staticPathPattern)) &#123;</span><br><span class="line">			logger.info(<span class="string">&quot;Adding welcome page: &quot;</span> + welcomePage);</span><br><span class="line">			setRootViewName(<span class="string">&quot;forward:index.html&quot;</span>);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">else</span> <span class="keyword">if</span> (welcomeTemplateExists(templateAvailabilityProviders, applicationContext)) &#123;</span><br><span class="line">			logger.info(<span class="string">&quot;Adding welcome page template: index&quot;</span>);</span><br><span class="line">			setRootViewName(<span class="string">&quot;index&quot;</span>);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>
</blockquote>
<h2 id="è¯·æ±‚å‚æ•°å¤„ç†"><a href="#è¯·æ±‚å‚æ•°å¤„ç†" class="headerlink" title="è¯·æ±‚å‚æ•°å¤„ç†"></a>è¯·æ±‚å‚æ•°å¤„ç†</h2><h3 id="restè¯·æ±‚ä¸åŸç†"><a href="#restè¯·æ±‚ä¸åŸç†" class="headerlink" title="restè¯·æ±‚ä¸åŸç†"></a>restè¯·æ±‚ä¸åŸç†</h3><h4 id="ä½¿ç”¨ç¤ºä¾‹"><a href="#ä½¿ç”¨ç¤ºä¾‹" class="headerlink" title="ä½¿ç”¨ç¤ºä¾‹"></a>ä½¿ç”¨ç¤ºä¾‹</h4><blockquote>
<p>Resté£æ ¼æ”¯æŒï¼šä½¿ç”¨ <strong>HTTP</strong>è¯·æ±‚æ–¹å¼åŠ¨è¯æ¥è¡¨ç¤ºå¯¹èµ„æºçš„æ“ä½œ</p>
<p>GETï¼ˆè·å–ï¼‰	POSTï¼ˆæäº¤ï¼‰	DELETEï¼ˆåˆ é™¤ï¼‰	PUTï¼ˆä¿®æ”¹ï¼‰</p>
<p>é¡µé¢è¡¨å•åªæ”¯æŒGETè¯·æ±‚ï¼ˆé»˜è®¤ï¼‰å’ŒPOSTè¯·æ±‚ï¼Œå¦‚æœè¦æ”¯æŒå…¶ä»–è¯·æ±‚æ–¹å¼ï¼Œåˆ™åº”è¯¥å¼€å¯HiddenHttpMethodFilter</p>
<p>æ ¸å¿ƒFilterï¼šHiddenHttpMethodFilter</p>
<p>restä½¿ç”¨ï¼š</p>
<ol>
<li>å¼€å¯é…ç½®</li>
<li>è¡¨å•æäº¤æ–¹å¼ï¼špostï¼ŒåŒæ—¶æäº¤éšè—åŸŸå‚æ•°ï¼š_method ï¼ˆæŒ‡å®šè¯·æ±‚æ–¹æ³•åï¼‰</li>
<li>é»˜è®¤ä¸å¼€å¯ï¼šå¦‚å¾®æœåŠ¡ï¼Œpostmanç­‰å¯ä»¥ç›´æ¥å‘é€putã€deleteè¯·æ±‚ï¼Œè€Œwebè¡¨å•åªèƒ½å‘é€getã€postè¯·æ±‚</li>
<li>å¦‚æœä¸å¼€å¯ï¼šput&#x2F;delete è¯·æ±‚ä¼šèµ° post è·¯çº¿æˆ–è€… get è·¯çº¿ï¼ˆç‰ˆæœ¬å·®å¼‚ï¼‰</li>
</ol>
<p>ç¤ºä¾‹ï¼š</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">mvc:</span></span><br><span class="line">    <span class="comment"># restæ”¯æŒ</span></span><br><span class="line">    <span class="comment"># é»˜è®¤ä¸å¼€å¯ï¼šå¦‚å¾®æœåŠ¡ï¼Œpostmanç­‰å¯ä»¥ç›´æ¥å‘é€putã€deleteè¯·æ±‚ï¼Œè€Œwebè¡¨å•åªèƒ½å‘é€getã€postè¯·æ±‚</span></span><br><span class="line">    <span class="attr">hiddenmethod:</span></span><br><span class="line">      <span class="attr">filter:</span></span><br><span class="line">        <span class="attr">enabled:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure>

<p>index.htmlï¼š</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">h2</span>&gt;</span>æµ‹è¯•RESTé£æ ¼<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&quot;/user&quot;</span> <span class="attr">method</span>=<span class="string">&quot;get&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">value</span>=<span class="string">&quot;REST-GET æäº¤&quot;</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&quot;/user&quot;</span> <span class="attr">method</span>=<span class="string">&quot;post&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">value</span>=<span class="string">&quot;REST-POST æäº¤&quot;</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&quot;/user&quot;</span> <span class="attr">method</span>=<span class="string">&quot;post&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">name</span>=<span class="string">&quot;_method&quot;</span> <span class="attr">type</span>=<span class="string">&quot;hidden&quot;</span> <span class="attr">value</span>=<span class="string">&quot;delete&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">name</span>=<span class="string">&quot;_m&quot;</span> <span class="attr">type</span>=<span class="string">&quot;hidden&quot;</span> <span class="attr">value</span>=<span class="string">&quot;delete&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">value</span>=<span class="string">&quot;REST-DELETE æäº¤&quot;</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&quot;/user&quot;</span> <span class="attr">method</span>=<span class="string">&quot;post&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">name</span>=<span class="string">&quot;_method&quot;</span> <span class="attr">type</span>=<span class="string">&quot;hidden&quot;</span> <span class="attr">value</span>=<span class="string">&quot;PUT&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">value</span>=<span class="string">&quot;REST-PUT æäº¤&quot;</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>controllerï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// @RequestMapping(value = &quot;/user&quot;, method = RequestMethod.GET)</span></span><br><span class="line"><span class="meta">@GetMapping(&quot;/user&quot;)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">getUser</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;GET-USER&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RequestMapping(value = &quot;/user&quot;, method = RequestMethod.POST)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">postUser</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;POST-USER&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RequestMapping(value = &quot;/user&quot;, method = RequestMethod.PUT)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">putUser</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;PUT-USER&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RequestMapping(value = &quot;/user&quot;, method = RequestMethod.DELETE)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">deleteUser</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;DELETE-USER&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


</blockquote>
<h4 id="ReståŸç†"><a href="#ReståŸç†" class="headerlink" title="ReståŸç†"></a>ReståŸç†</h4><blockquote>
<p>WebMvcAutoConfigurationï¼š</p>
<ul>
<li><strong>è¯·æ±‚è¿‡æ¥è¢«</strong> HiddenHttpMethodFilteræ‹¦æˆª</li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="meta">@ConditionalOnMissingBean(HiddenHttpMethodFilter.class)</span></span><br><span class="line"><span class="meta">@ConditionalOnProperty(prefix = &quot;spring.mvc.hiddenmethod.filter&quot;, name = &quot;enabled&quot;)</span></span><br><span class="line"><span class="keyword">public</span> OrderedHiddenHttpMethodFilter <span class="title function_">hiddenHttpMethodFilter</span><span class="params">()</span> &#123;</span><br><span class="line">	<span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">OrderedHiddenHttpMethodFilter</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OrderedHiddenHttpMethodFilter</span> <span class="keyword">extends</span> <span class="title class_">HiddenHttpMethodFilter</span> <span class="keyword">implements</span> <span class="title class_">OrderedFilter</span> &#123;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>HiddenHttpMethodFilteræºç ï¼š</p>
<ul>
<li>æ”¯æŒçš„è¯·æ±‚æ–¹å¼ï¼šHttpMethod.PUT.name(),HttpMethod.DELETE.name(), HttpMethod.PATCH.name()</li>
<li>è¡¨å•æºå¸¦çš„éšè—å‚æ•°ï¼š_method</li>
<li>å¯¹äºåŸç”Ÿ requestï¼Œä½¿ç”¨ HttpMethodRequestWrapper è¿›è¡ŒåŒ…è£…ï¼Œé‡å†™äº† getMethod() æ–¹æ³•ï¼Œæ‹¦æˆªå™¨æ”¾è¡Œçš„ä¹Ÿæ˜¯HttpMethodRequestWrapperå¯¹è±¡ã€‚</li>
<li>å¦‚æœéœ€è¦æ”¹å˜ _method åç§°ï¼Œåˆ™ä½¿ç”¨@Beanç»™å®¹å™¨ä¸­æ”¾å…¥ä¸€ä¸ªHiddenHttpMethodFilter</li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HiddenHttpMethodFilter</span> <span class="keyword">extends</span> <span class="title class_">OncePerRequestFilter</span> &#123;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> List&lt;String&gt; ALLOWED_METHODS =</span><br><span class="line">			Collections.unmodifiableList(Arrays.asList(HttpMethod.PUT.name(),</span><br><span class="line">					HttpMethod.DELETE.name(), HttpMethod.PATCH.name()));</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** Default method parameter: &#123;<span class="doctag">@code</span> _method&#125;. */</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">DEFAULT_METHOD_PARAM</span> <span class="operator">=</span> <span class="string">&quot;_method&quot;</span>;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> <span class="type">String</span> <span class="variable">methodParam</span> <span class="operator">=</span> DEFAULT_METHOD_PARAM;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * Set the parameter name to look for HTTP methods.</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@see</span> #DEFAULT_METHOD_PARAM</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setMethodParam</span><span class="params">(String methodParam)</span> &#123;</span><br><span class="line">		Assert.hasText(methodParam, <span class="string">&quot;&#x27;methodParam&#x27; must not be empty&quot;</span>);</span><br><span class="line">		<span class="built_in">this</span>.methodParam = methodParam;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doFilterInternal</span><span class="params">(HttpServletRequest request, HttpServletResponse response, FilterChain filterChain)</span></span><br><span class="line">			<span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line"></span><br><span class="line">		<span class="type">HttpServletRequest</span> <span class="variable">requestToUse</span> <span class="operator">=</span> request;</span><br><span class="line">		<span class="comment">// ===========è¯·æ±‚å¿…é¡»æ˜¯POSTè¯·æ±‚ï¼Œå¹¶ä¸”å‚æ•°ä¸º_method==========</span></span><br><span class="line">		<span class="keyword">if</span> (<span class="string">&quot;POST&quot;</span>.equals(request.getMethod()) &amp;&amp; request.getAttribute(WebUtils.ERROR_EXCEPTION_ATTRIBUTE) == <span class="literal">null</span>) &#123;</span><br><span class="line">			<span class="type">String</span> <span class="variable">paramValue</span> <span class="operator">=</span> request.getParameter(<span class="built_in">this</span>.methodParam);</span><br><span class="line">			<span class="keyword">if</span> (StringUtils.hasLength(paramValue)) &#123;</span><br><span class="line">				<span class="type">String</span> <span class="variable">method</span> <span class="operator">=</span> paramValue.toUpperCase(Locale.ENGLISH);</span><br><span class="line">				<span class="keyword">if</span> (ALLOWED_METHODS.contains(method)) &#123;</span><br><span class="line">					requestToUse = <span class="keyword">new</span> <span class="title class_">HttpMethodRequestWrapper</span>(request, method);</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="comment">// ==========æ‹¦æˆªå™¨æ”¾è¡Œçš„æ˜¯HttpMethodRequestWrapper==========</span></span><br><span class="line">		filterChain.doFilter(requestToUse, response);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * é‡å†™äº†getMethod()æ–¹æ³•ï¼Œè¿”å›çš„æ˜¯ä¼ å…¥çš„method</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">HttpMethodRequestWrapper</span> <span class="keyword">extends</span> <span class="title class_">HttpServletRequestWrapper</span> &#123;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">private</span> <span class="keyword">final</span> String method;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">public</span> <span class="title function_">HttpMethodRequestWrapper</span><span class="params">(HttpServletRequest request, String method)</span> &#123;</span><br><span class="line">			<span class="built_in">super</span>(request);</span><br><span class="line">			<span class="built_in">this</span>.method = method;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="meta">@Override</span></span><br><span class="line">		<span class="keyword">public</span> String <span class="title function_">getMethod</span><span class="params">()</span> &#123;</span><br><span class="line">			<span class="keyword">return</span> <span class="built_in">this</span>.method;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ”¹å˜ _method åç§°ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.springboot.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.filter.HiddenHttpMethodFilter;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WebConfig</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Rest æ”¹å˜é»˜è®¤çš„_methodåç§°</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> HiddenHttpMethodFilter <span class="title function_">hiddenHttpMethodFilter</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">HiddenHttpMethodFilter</span> <span class="variable">filter</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HiddenHttpMethodFilter</span>();</span><br><span class="line">        filter.setMethodParam(<span class="string">&quot;_m&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> filter;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æºç ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="comment">// ==========@ConditionalOnMissingBean==========</span></span><br><span class="line"><span class="meta">@ConditionalOnMissingBean(HiddenHttpMethodFilter.class)</span></span><br><span class="line"><span class="meta">@ConditionalOnProperty(prefix = &quot;spring.mvc.hiddenmethod.filter&quot;, name = &quot;enabled&quot;)</span></span><br><span class="line"><span class="keyword">public</span> OrderedHiddenHttpMethodFilter <span class="title function_">hiddenHttpMethodFilter</span><span class="params">()</span> &#123;</span><br><span class="line">	<span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">OrderedHiddenHttpMethodFilter</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</blockquote>
<h3 id="è¯·æ±‚æ˜ å°„åŸç†"><a href="#è¯·æ±‚æ˜ å°„åŸç†" class="headerlink" title="è¯·æ±‚æ˜ å°„åŸç†"></a>è¯·æ±‚æ˜ å°„åŸç†</h3><p>è¯¥éƒ¨åˆ†ä¸»è¦åˆ†æå…·ä½“çš„è¯·æ±‚è¢«å“ªä¸€ä¸ªcontrollerçš„æ–¹æ³•å¤„ç†ã€‚</p>
<p>SpringMVC åŠŸèƒ½åˆ†æä»ï¼š org.springframework.web.servlet.DispatcherServlet â€“&gt; doDispatch() æ–¹æ³•å¼€å§‹ã€‚</p>
<p><strong>RequestMappingHandlerMapping</strong>ï¼šä¿å­˜äº†æ‰€æœ‰@RequestMapping å’Œhandlerçš„æ˜ å°„è§„åˆ™ã€‚</p>
<p><img src="/2023/02/28/SpringBoot2/Java\SpringBoot\SpringBoot2.assets\image-20221011141959986.png" alt="image-20221011141959986"></p>
<p>æ‰€æœ‰çš„è¯·æ±‚æ˜ å°„éƒ½åœ¨ HandlerMapping ä¸­ã€‚</p>
<ul>
<li><p>SpringBootè‡ªåŠ¨é…ç½®æ¬¢è¿é¡µçš„ WelcomePageHandlerMapping ã€‚è®¿é—®  &#x2F;  èƒ½è®¿é—®åˆ° index.htmlï¼›</p>
</li>
<li><p>SpringBootè‡ªåŠ¨é…ç½®äº†é»˜è®¤çš„ <strong>RequestMappingHandlerMapping</strong></p>
</li>
<li><p>è¯·æ±‚è¿›æ¥ä¼šéå†æ‰€æœ‰çš„ HandlerMapping æŸ¥çœ‹æ˜¯å¦æœ‰è¯·æ±‚ä¿¡æ¯ã€‚</p>
</li>
<li><ul>
<li>å¦‚æœæœ‰å°±æ‰¾åˆ°è¿™ä¸ªè¯·æ±‚å¯¹åº”çš„ handler<ul>
<li>å¦‚æœæ²¡æœ‰å°±æ˜¯ä¸‹ä¸€ä¸ª HandlerMapping</li>
</ul>
</li>
</ul>
</li>
<li><p>å¦‚æœéœ€è¦ä¸€äº›è‡ªå®šä¹‰çš„æ˜ å°„å¤„ç†ï¼Œå¯ä»¥ç»™å®¹å™¨ä¸­æ”¾è‡ªå®šä¹‰çš„<strong>HandlerMapping</strong>ã€‚</p>
</li>
</ul>
<blockquote>
<p>DispatcherServletï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DispatcherServlet</span> <span class="keyword">extends</span> <span class="title class_">FrameworkServlet</span> &#123;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">FrameworkServlet</span> <span class="keyword">extends</span> <span class="title class_">HttpServletBean</span> <span class="keyword">implements</span> <span class="title class_">ApplicationContextAware</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">	<span class="keyword">protected</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title function_">doGet</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span></span><br><span class="line">			<span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line"></span><br><span class="line">		processRequest(request, response);</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="keyword">protected</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title function_">doPost</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span></span><br><span class="line">			<span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">		processRequest(request, response);</span><br><span class="line">	&#125;</span><br><span class="line">    	<span class="keyword">protected</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title function_">processRequest</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span></span><br><span class="line">			<span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">		<span class="comment">// ...</span></span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			doService(request, response);</span><br><span class="line">		&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">HttpServletBean</span> <span class="keyword">extends</span> <span class="title class_">HttpServlet</span> <span class="keyword">implements</span> <span class="title class_">EnvironmentCapable</span>, EnvironmentAware &#123;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doService</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">	<span class="comment">// ...</span></span><br><span class="line">       <span class="keyword">try</span> &#123;</span><br><span class="line">		doDispatch(request, response);</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>

<p>doDispatch(request, response);æ–¹æ³•ç”¨äºå¤„ç†è¯·æ±‚å’Œå“åº”ã€‚</p>
</blockquote>
<p>doDispatchæ–¹æ³•ï¼š</p>
<blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doDispatch</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">		<span class="type">HttpServletRequest</span> <span class="variable">processedRequest</span> <span class="operator">=</span> request;</span><br><span class="line">		<span class="type">HandlerExecutionChain</span> <span class="variable">mappedHandler</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">		<span class="type">boolean</span> <span class="variable">multipartRequestParsed</span> <span class="operator">=</span> <span class="literal">false</span>;</span><br><span class="line">		<span class="type">WebAsyncManager</span> <span class="variable">asyncManager</span> <span class="operator">=</span> WebAsyncUtils.getAsyncManager(request);</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			<span class="type">ModelAndView</span> <span class="variable">mv</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">			<span class="type">Exception</span> <span class="variable">dispatchException</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">			<span class="keyword">try</span> &#123;</span><br><span class="line">				processedRequest = checkMultipart(request);</span><br><span class="line">				multipartRequestParsed = (processedRequest != request);</span><br><span class="line"></span><br><span class="line">				<span class="comment">// Determine handler for the current request.</span></span><br><span class="line">                <span class="comment">// ==========è§£æè¯·æ±‚å¯¹åº”çš„æ–¹æ³•========</span></span><br><span class="line">				mappedHandler = getHandler(processedRequest);</span><br><span class="line">				<span class="keyword">if</span> (mappedHandler == <span class="literal">null</span>) &#123;</span><br><span class="line">					noHandlerFound(processedRequest, response);</span><br><span class="line">					<span class="keyword">return</span>;</span><br><span class="line">				&#125;</span><br></pre></td></tr></table></figure>

<p>getHandleræ–¹æ³•ï¼š</p>
<p>è¯¥æ–¹æ³•ä¼šä»æ‰€æœ‰çš„ HandlerMapping ä¸­æŸ¥æ‰¾HandlerMappingï¼Œæ‰§è¡ŒgetHandleræ–¹æ³•ï¼Œè¿”å›æ‰§è¡Œå™¨é“¾</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Nullable</span></span><br><span class="line"><span class="keyword">protected</span> HandlerExecutionChain <span class="title function_">getHandler</span><span class="params">(HttpServletRequest request)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">this</span>.handlerMappings != <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">for</span> (HandlerMapping mapping : <span class="built_in">this</span>.handlerMappings) &#123;</span><br><span class="line">            <span class="type">HandlerExecutionChain</span> <span class="variable">handler</span> <span class="operator">=</span> mapping.getHandler(request);</span><br><span class="line">            <span class="keyword">if</span> (handler != <span class="literal">null</span>) &#123;</span><br><span class="line">                <span class="keyword">return</span> handler;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>AbstractHandlerMappingï¼š</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="meta">@Nullable</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> HandlerExecutionChain <span class="title function_">getHandler</span><span class="params">(HttpServletRequest request)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    <span class="comment">// ==========com.example.springboot.controller.RestfulTestController#getUser()=======</span></span><br><span class="line">    <span class="type">Object</span> <span class="variable">handler</span> <span class="operator">=</span> getHandlerInternal(request);</span><br><span class="line">    <span class="keyword">if</span> (handler == <span class="literal">null</span>) &#123;</span><br><span class="line">        handler = getDefaultHandler();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (handler == <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p><strong>getHandlerInternalï¼š</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="meta">@Nullable</span></span><br><span class="line"><span class="keyword">protected</span> HandlerMethod <span class="title function_">getHandlerInternal</span><span class="params">(HttpServletRequest request)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    <span class="comment">// ==========ä»è¯·æ±‚ä¸­è·å–è·¯å¾„ï¼Œè¿”å›ï¼š/user==========</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">lookupPath</span> <span class="operator">=</span> initLookupPath(request);</span><br><span class="line">    <span class="built_in">this</span>.mappingRegistry.acquireReadLock();</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="comment">// ========æ ¹æ®è·¯å¾„è·å–æ‰€æœ‰çš„æ–¹æ³•========</span></span><br><span class="line">        <span class="type">HandlerMethod</span> <span class="variable">handlerMethod</span> <span class="operator">=</span> lookupHandlerMethod(lookupPath, request);</span><br><span class="line">        <span class="keyword">return</span> (handlerMethod != <span class="literal">null</span> ? handlerMethod.createWithResolvedBean() : <span class="literal">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">finally</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.mappingRegistry.releaseReadLock();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>initLookupPathï¼š</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">protected</span> String <span class="title function_">initLookupPath</span><span class="params">(HttpServletRequest request)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (usesPathPatterns()) &#123;</span><br><span class="line">        request.removeAttribute(UrlPathHelper.PATH_ATTRIBUTE);</span><br><span class="line">        <span class="type">RequestPath</span> <span class="variable">requestPath</span> <span class="operator">=</span> ServletRequestPathUtils.getParsedRequestPath(request);</span><br><span class="line">        <span class="type">String</span> <span class="variable">lookupPath</span> <span class="operator">=</span> requestPath.pathWithinApplication().value();</span><br><span class="line">        <span class="keyword">return</span> UrlPathHelper.defaultInstance.removeSemicolonContent(lookupPath);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> getUrlPathHelper().resolveAndCacheLookupPath(request);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>lookupHandlerMethodï¼š</strong>9</p>
<p>è¿”å›å€¼ï¼šcom.example.springboot.controller.RestfulTestController#getUser()</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Nullable</span></span><br><span class="line"><span class="keyword">protected</span> HandlerMethod <span class="title function_">lookupHandlerMethod</span><span class="params">(String lookupPath, HttpServletRequest request)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">	List&lt;Match&gt; matches = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">	List&lt;T&gt; directPathMatches = <span class="built_in">this</span>.mappingRegistry.getMappingsByDirectPath(lookupPath);</span><br><span class="line">	<span class="keyword">if</span> (directPathMatches != <span class="literal">null</span>) &#123;</span><br><span class="line">		addMatchingMappings(directPathMatches, matches, request);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span> (matches.isEmpty()) &#123;</span><br><span class="line">		addMatchingMappings(<span class="built_in">this</span>.mappingRegistry.getRegistrations().keySet(), matches, request);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span> (!matches.isEmpty()) &#123;</span><br><span class="line">           </span><br><span class="line">          <span class="comment">// ======å¦‚æœæœ‰å¤šä¸ªæ–¹æ³•ï¼Œé¦–å…ˆè·å–ç¬¬ä¸€ä¸ªï¼Œç„¶åæ ¹æ®requestè¯·æ±‚æ–¹æ³•ï¼ˆget/post...ï¼‰äºŒæ¬¡åŒ¹é…</span></span><br><span class="line">		<span class="type">Match</span> <span class="variable">bestMatch</span> <span class="operator">=</span> matches.get(<span class="number">0</span>);</span><br><span class="line">		<span class="keyword">if</span> (matches.size() &gt; <span class="number">1</span>) &#123;</span><br><span class="line">			Comparator&lt;Match&gt; comparator = <span class="keyword">new</span> <span class="title class_">MatchComparator</span>(getMappingComparator(request));</span><br><span class="line">			matches.sort(comparator);</span><br><span class="line">			bestMatch = matches.get(<span class="number">0</span>);</span><br><span class="line">			<span class="keyword">if</span> (logger.isTraceEnabled()) &#123;</span><br><span class="line">				logger.trace(matches.size() + <span class="string">&quot; matching mappings: &quot;</span> + matches);</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">if</span> (CorsUtils.isPreFlightRequest(request)) &#123;</span><br><span class="line">				<span class="keyword">for</span> (Match match : matches) &#123;</span><br><span class="line">					<span class="keyword">if</span> (match.hasCorsConfig()) &#123;</span><br><span class="line">						<span class="keyword">return</span> PREFLIGHT_AMBIGUOUS_MATCH;</span><br><span class="line">					&#125;</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">else</span> &#123;</span><br><span class="line">				<span class="type">Match</span> <span class="variable">secondBestMatch</span> <span class="operator">=</span> matches.get(<span class="number">1</span>);</span><br><span class="line">				<span class="keyword">if</span> (comparator.compare(bestMatch, secondBestMatch) == <span class="number">0</span>) &#123;</span><br><span class="line">					<span class="type">Method</span> <span class="variable">m1</span> <span class="operator">=</span> bestMatch.getHandlerMethod().getMethod();</span><br><span class="line">					<span class="type">Method</span> <span class="variable">m2</span> <span class="operator">=</span> secondBestMatch.getHandlerMethod().getMethod();</span><br><span class="line">					<span class="type">String</span> <span class="variable">uri</span> <span class="operator">=</span> request.getRequestURI();</span><br><span class="line">					<span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalStateException</span>(</span><br><span class="line">							<span class="string">&quot;Ambiguous handler methods mapped for &#x27;&quot;</span> + uri + <span class="string">&quot;&#x27;: &#123;&quot;</span> + m1 + <span class="string">&quot;, &quot;</span> + m2 + <span class="string">&quot;&#125;&quot;</span>);</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br></pre></td></tr></table></figure>
</blockquote>
<h3 id="æ™®é€šå‚æ•°æ³¨è§£ä½¿ç”¨"><a href="#æ™®é€šå‚æ•°æ³¨è§£ä½¿ç”¨" class="headerlink" title="æ™®é€šå‚æ•°æ³¨è§£ä½¿ç”¨"></a>æ™®é€šå‚æ•°æ³¨è§£ä½¿ç”¨</h3><h4 id="åŸºæœ¬æ³¨è§£ä½¿ç”¨"><a href="#åŸºæœ¬æ³¨è§£ä½¿ç”¨" class="headerlink" title="åŸºæœ¬æ³¨è§£ä½¿ç”¨"></a>åŸºæœ¬æ³¨è§£ä½¿ç”¨</h4><p><strong>@PathVariableã€@RequestHeaderã€@ModelAttributeã€@RequestParamã€@MatrixVariableã€@CookieValueã€@RequestBody</strong></p>
<blockquote>
<p>æµ‹è¯•ï¼š</p>
<p>index.html</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">h2</span>&gt;</span>æµ‹è¯•åŸºæœ¬æ³¨è§£<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;car/3/owner/lisi?age=18&amp;inters=basketball&amp;inters=game&quot;</span>&gt;</span>car/&#123;id&#125;/owner/&#123;username&#125;?...<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span>&gt;</span>@PathVariableï¼ˆè·¯å¾„å˜é‡ï¼‰<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span>&gt;</span>@RequestHeaderï¼ˆè·å–è¯·æ±‚å¤´ï¼‰<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span>&gt;</span>@RequestParamï¼ˆè·å–è¯·æ±‚å‚æ•°ï¼‰<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span>&gt;</span>@CookieValueï¼ˆè·å–cookieå€¼ï¼‰<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span>&gt;</span>@RequestBodyï¼ˆè·å–è¯·æ±‚ä½“[POST]ï¼‰<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span>&gt;</span>@RequestAttributeï¼ˆè·å–requeståŸŸå±æ€§ï¼‰<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span>&gt;</span>@MatrixVariableï¼ˆçŸ©é˜µå˜é‡ï¼‰<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line"></span><br><span class="line">/cars/&#123;path&#125;?xxx=xxx&amp;aaa=ccc queryString æŸ¥è¯¢å­—ç¬¦ä¸²ã€‚@RequestParamï¼›<span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line">/cars/sell;low=34;brand=byd,audi,yd  ï¼›çŸ©é˜µå˜é‡ <span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line">é¡µé¢å¼€å‘ï¼Œcookieç¦ç”¨äº†ï¼Œsessioné‡Œé¢çš„å†…å®¹æ€ä¹ˆä½¿ç”¨ï¼›</span><br><span class="line">session.set(a,b)---&gt; jsessionid ---&gt; cookie ----&gt; æ¯æ¬¡å‘è¯·æ±‚æºå¸¦</span><br><span class="line">urlé‡å†™ï¼š/abc;jsesssionid=xxxx æŠŠcookieçš„å€¼ä½¿ç”¨çŸ©é˜µå˜é‡çš„æ–¹å¼è¿›è¡Œä¼ é€’</span><br><span class="line"></span><br><span class="line">/boss/1/2</span><br><span class="line">/boss/1;age=20/2;age=20</span><br><span class="line"><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;/cars/sell;low=34;brand=byd,audi,yd&quot;</span>&gt;</span>@MatrixVariableï¼ˆçŸ©é˜µå˜é‡ï¼‰<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;/cars/sell;low=34;brand=byd;brand=audi;brand=yd&quot;</span>&gt;</span>@MatrixVariableï¼ˆçŸ©é˜µå˜é‡ï¼‰<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;/boss/1;age=20/2;age=10&quot;</span>&gt;</span>@MatrixVariableï¼ˆçŸ©é˜µå˜é‡ï¼‰/boss/&#123;bossId&#125;/&#123;empId&#125;<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&quot;/save&quot;</span> <span class="attr">method</span>=<span class="string">&quot;post&quot;</span>&gt;</span></span><br><span class="line">    æµ‹è¯•@RequestBodyè·å–æ•°æ® <span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line">    ç”¨æˆ·åï¼š<span class="tag">&lt;<span class="name">input</span> <span class="attr">name</span>=<span class="string">&quot;userName&quot;</span>/&gt;</span> <span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">    é‚®ç®±ï¼š<span class="tag">&lt;<span class="name">input</span> <span class="attr">name</span>=<span class="string">&quot;email&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">value</span>=<span class="string">&quot;æäº¤&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">ol</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span>&gt;</span>çŸ©é˜µå˜é‡éœ€è¦åœ¨SpringBootä¸­æ‰‹åŠ¨å¼€å¯<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span>&gt;</span>æ ¹æ®RFC3986çš„è§„èŒƒï¼ŒçŸ©é˜µå˜é‡åº”å½“ç»‘å®šåœ¨è·¯å¾„å˜é‡ä¸­ï¼<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span>&gt;</span>è‹¥æ˜¯æœ‰å¤šä¸ªçŸ©é˜µå˜é‡ï¼Œåº”å½“ä½¿ç”¨è‹±æ–‡ç¬¦å·;è¿›è¡Œåˆ†éš”ã€‚<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span>&gt;</span>è‹¥æ˜¯ä¸€ä¸ªçŸ©é˜µå˜é‡æœ‰å¤šä¸ªå€¼ï¼Œåº”å½“ä½¿ç”¨è‹±æ–‡ç¬¦å·,è¿›è¡Œåˆ†éš”ï¼Œæˆ–ä¹‹å‘½åå¤šä¸ªé‡å¤çš„keyå³å¯ã€‚<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span>&gt;</span>å¦‚ï¼š/cars/sell;low=34;brand=byd,audi,yd<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">ol</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>controllerï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ParameterTestController</span> &#123;</span><br><span class="line">    <span class="comment">// car/3/owner/lisi?age=18&amp;inters=basketball&amp;inters=game</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;car/&#123;id&#125;/owner/&#123;username&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Map&lt;String, Object&gt; <span class="title function_">getCar</span><span class="params">(</span></span><br><span class="line"><span class="params">            <span class="meta">@PathVariable(&quot;id&quot;)</span> String id,</span></span><br><span class="line"><span class="params">            <span class="meta">@PathVariable(&quot;username&quot;)</span> String name,</span></span><br><span class="line"><span class="params">            <span class="meta">@PathVariable</span> Map&lt;String, String&gt; map,</span></span><br><span class="line"><span class="params">            <span class="meta">@RequestHeader(&quot;User-Agent&quot;)</span> String userAgent,</span></span><br><span class="line"><span class="params">            <span class="meta">@RequestHeader</span> Map&lt;String, String&gt; header,</span></span><br><span class="line"><span class="params">            <span class="meta">@RequestParam(&quot;age&quot;)</span> Integer age,</span></span><br><span class="line"><span class="params">            <span class="meta">@RequestParam(&quot;inters&quot;)</span> List&lt;String&gt; inters,</span></span><br><span class="line"><span class="params">            <span class="meta">@RequestParam</span> Map&lt;String, String&gt; params</span></span><br><span class="line"><span class="params">            // <span class="meta">@CookieValue(&quot;_ga&quot;)</span> String _ga,</span></span><br><span class="line"><span class="params">            // <span class="meta">@CookieValue(&quot;_ga&quot;)</span> Cookie cookie</span></span><br><span class="line"><span class="params">    )</span> &#123;</span><br><span class="line">        HashMap&lt;String, Object&gt; resultMap = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        resultMap.put(<span class="string">&quot;id&quot;</span>, id);</span><br><span class="line">        resultMap.put(<span class="string">&quot;name&quot;</span>, name);</span><br><span class="line">        resultMap.put(<span class="string">&quot;pv&quot;</span>, map);</span><br><span class="line">        resultMap.put(<span class="string">&quot;userAgent&quot;</span>, userAgent);</span><br><span class="line">        resultMap.put(<span class="string">&quot;headers&quot;</span>, header);</span><br><span class="line">        resultMap.put(<span class="string">&quot;age&quot;</span>, age);</span><br><span class="line">        resultMap.put(<span class="string">&quot;inters&quot;</span>, inters);</span><br><span class="line">        resultMap.put(<span class="string">&quot;params&quot;</span>, params);</span><br><span class="line">        <span class="comment">// resultMap.put(&quot;_ga&quot;, _ga);</span></span><br><span class="line">        <span class="comment">// System.out.println(cookie.getName() + &quot;====&quot; + cookie.getValue());</span></span><br><span class="line">        <span class="keyword">return</span> resultMap;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@PostMapping(&quot;save&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Map&lt;String, Object&gt; <span class="title function_">postMethod</span><span class="params">(<span class="meta">@RequestBody</span> String content)</span> &#123;</span><br><span class="line">        Map&lt;String, Object&gt; map = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        System.out.println(content);</span><br><span class="line">        map.put(<span class="string">&quot;content&quot;</span>, content);</span><br><span class="line">        <span class="keyword">return</span> map;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * çŸ©é˜µå˜é‡ï¼š</span></span><br><span class="line"><span class="comment">     * 1. è¯­æ³•ï¼šè¯·æ±‚è·¯å¾„ï¼š/cars/sell;low=34;brand=byd,audi,yd</span></span><br><span class="line"><span class="comment">     * 2. SpringBooté»˜è®¤æ˜¯ç¦ç”¨äº†çŸ©é˜µå˜é‡çš„åŠŸèƒ½</span></span><br><span class="line"><span class="comment">     *      æ‰‹åŠ¨å¼€å¯ï¼šåŸç†ï¼šå¯¹äºè·¯å¾„çš„å¤„ç†ï¼Œç”±UrlPathHelperè¿›è¡Œè§£æ</span></span><br><span class="line"><span class="comment">     *          removeSemicolonContentï¼ˆç§»é™¤åˆ†å·å†…å®¹ï¼‰æ”¯æŒçŸ©é˜µå˜é‡çš„</span></span><br><span class="line"><span class="comment">     * 3. çŸ©é˜µå˜é‡å¿…é¡»æœ‰urlè·¯å¾„å˜é‡æ‰èƒ½è¢«è§£æ</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/cars/&#123;path&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Map <span class="title function_">carsSell</span><span class="params">(<span class="meta">@MatrixVariable(&quot;low&quot;)</span> Integer low,</span></span><br><span class="line"><span class="params">                        <span class="meta">@MatrixVariable(&quot;brand&quot;)</span> List&lt;String&gt; brand</span></span><br><span class="line"><span class="params">                        //<span class="meta">@PathVariable(&quot;path&quot;)</span> String path</span></span><br><span class="line"><span class="params">    )</span> &#123;</span><br><span class="line">        Map&lt;String, Object&gt; map = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        map.put(<span class="string">&quot;low&quot;</span>, low);</span><br><span class="line">        map.put(<span class="string">&quot;brand&quot;</span>, brand);</span><br><span class="line">        <span class="comment">// map.put(&quot;path&quot;, path);</span></span><br><span class="line">        <span class="comment">// &#123;&quot;path&quot;:&quot;sell&quot;,&quot;low&quot;:34,&quot;brand&quot;:[&quot;byd&quot;,&quot;audi&quot;,&quot;yd&quot;]&#125;</span></span><br><span class="line">        <span class="keyword">return</span> map;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// /boss/1;age=20/2;age=10</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/boss/&#123;bossId&#125;/&#123;empId&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Map <span class="title function_">boss</span><span class="params">(<span class="meta">@MatrixVariable(value = &quot;age&quot;, pathVar = &quot;bossId&quot;)</span> Integer bossAge,</span></span><br><span class="line"><span class="params">                    <span class="meta">@MatrixVariable(value = &quot;age&quot;, pathVar = &quot;empId&quot;)</span> Integer empAge)</span> &#123;</span><br><span class="line">        Map&lt;String, Object&gt; map = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        map.put(<span class="string">&quot;bossAge&quot;</span>, bossAge);</span><br><span class="line">        map.put(<span class="string">&quot;empAge&quot;</span>, empAge);</span><br><span class="line">        <span class="keyword">return</span> map;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>çŸ©é˜µå˜é‡ï¼š</strong></p>
<ul>
<li><p>é€šè¿‡åˆ†å·åœ¨ URL åœ°å€æ è¿›è¡Œä¼ å€¼ã€‚</p>
<p>  é¡µé¢å¼€å‘ï¼Œcookieç¦ç”¨äº†ï¼Œsessioné‡Œé¢çš„å†…å®¹æ€ä¹ˆä½¿ç”¨ï¼Ÿ<br>  session.set(a, b)	â€”&gt;	jsessionid	â€”&gt;	cookie	â€”-&gt;	æ¯æ¬¡å‘è¯·æ±‚æºå¸¦<br>  URL é‡å†™ï¼š&#x2F;abc;jsesssionid&#x3D;xxxx æŠŠ cookie çš„å€¼ä½¿ç”¨çŸ©é˜µå˜é‡çš„æ–¹å¼è¿›è¡Œä¼ é€’</p>
</li>
<li><p>SpringBooté»˜è®¤æ˜¯ç¦ç”¨äº†çŸ©é˜µå˜é‡çš„åŠŸèƒ½</p>
<p>  æ‰‹åŠ¨å¼€å¯ï¼šåŸç†ï¼šå¯¹äºè·¯å¾„çš„å¤„ç†ï¼Œç”±UrlPathHelperè¿›è¡Œè§£æ</p>
<p>  removeSemicolonContentï¼ˆç§»é™¤åˆ†å·å†…å®¹ï¼‰æ”¯æŒçŸ©é˜µå˜é‡çš„</p>
<p>  çŸ©é˜µå˜é‡å¿…é¡»æœ‰urlè·¯å¾„å˜é‡æ‰èƒ½è¢«è§£æ</p>
</li>
</ul>
<p>å¼€å¯çŸ©é˜µå˜é‡ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.springboot.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.filter.HiddenHttpMethodFilter;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.config.annotation.PathMatchConfigurer;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.config.annotation.WebMvcConfigurer;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.util.UrlPathHelper;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WebConfig</span> &#123;</span><br><span class="line"><span class="comment">//public class WebConfig implements WebMvcConfigurer &#123;</span></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Rest æ”¹å˜é»˜è®¤çš„ _method åç§°</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> HiddenHttpMethodFilter <span class="title function_">hiddenHttpMethodFilter</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">HiddenHttpMethodFilter</span> <span class="variable">filter</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HiddenHttpMethodFilter</span>();</span><br><span class="line">        filter.setMethodParam(<span class="string">&quot;_m&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> filter;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å¼€å¯çŸ©é˜µå˜é‡ï¼š</span></span><br><span class="line"><span class="comment">     * æ–¹å¼ä¸€ï¼šå®ç°WebMvcConfigureræ¥å£</span></span><br><span class="line"><span class="comment">     * æ–¹å¼äºŒï¼šä½¿ç”¨<span class="doctag">@Bean</span>æ³¨å…¥</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="comment">/*@Override</span></span><br><span class="line"><span class="comment">    public void configurePathMatch(PathMatchConfigurer configurer) &#123;</span></span><br><span class="line"><span class="comment">        UrlPathHelper urlPathHelper = new UrlPathHelper();</span></span><br><span class="line"><span class="comment">        urlPathHelper.setRemoveSemicolonContent(false);</span></span><br><span class="line"><span class="comment">        configurer.setUrlPathHelper(urlPathHelper);</span></span><br><span class="line"><span class="comment">    &#125;*/</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> WebMvcConfigurer <span class="title function_">webMvcConfigurer</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">WebMvcConfigurer</span>() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">configurePathMatch</span><span class="params">(PathMatchConfigurer configurer)</span> &#123;</span><br><span class="line">                <span class="type">UrlPathHelper</span> <span class="variable">urlPathHelper</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">UrlPathHelper</span>();</span><br><span class="line">                urlPathHelper.setRemoveSemicolonContent(<span class="literal">false</span>);</span><br><span class="line">                configurer.setUrlPathHelper(urlPathHelper);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</blockquote>
<h4 id="ServletAPI"><a href="#ServletAPI" class="headerlink" title="ServletAPI"></a>ServletAPI</h4><p>WebRequestã€ServletRequestã€MultipartRequestã€ HttpSessionã€javax.servlet.http.PushBuilderã€Principalã€InputStreamã€Readerã€HttpMethodã€Localeã€TimeZoneã€ZoneId</p>
<p>å¯¹äºåŸç”Ÿçš„ ServletAPI ä½¿ç”¨ï¼š<strong>ServletRequestMethodArgumentResolver</strong>è¿›è¡Œå‚æ•°è§£æ</p>
<blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">supportsParameter</span><span class="params">(MethodParameter parameter)</span> &#123;</span><br><span class="line">    Class&lt;?&gt; paramType = parameter.getParameterType();</span><br><span class="line">    <span class="keyword">return</span> (WebRequest.class.isAssignableFrom(paramType) ||</span><br><span class="line">            ServletRequest.class.isAssignableFrom(paramType) ||</span><br><span class="line">            MultipartRequest.class.isAssignableFrom(paramType) ||</span><br><span class="line">            HttpSession.class.isAssignableFrom(paramType) ||</span><br><span class="line">            (pushBuilder != <span class="literal">null</span> &amp;&amp; pushBuilder.isAssignableFrom(paramType)) ||</span><br><span class="line">            Principal.class.isAssignableFrom(paramType) ||</span><br><span class="line">            InputStream.class.isAssignableFrom(paramType) ||</span><br><span class="line">            Reader.class.isAssignableFrom(paramType) ||</span><br><span class="line">            HttpMethod.class == paramType ||</span><br><span class="line">            Locale.class == paramType ||</span><br><span class="line">            TimeZone.class == paramType ||</span><br><span class="line">            ZoneId.class == paramType);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</blockquote>
<h4 id="å¤æ‚å‚æ•°"><a href="#å¤æ‚å‚æ•°" class="headerlink" title="å¤æ‚å‚æ•°"></a>å¤æ‚å‚æ•°</h4><p><strong>Map</strong>ã€<strong>Modelï¼ˆmapã€modelé‡Œé¢çš„æ•°æ®ä¼šè¢«æ”¾åœ¨requestçš„è¯·æ±‚åŸŸä¸­ï¼šrequest.setAttributeï¼‰ã€</strong>Errors&#x2F;BindingResultã€<strong>RedirectAttributesï¼ˆ é‡å®šå‘æºå¸¦æ•°æ®ï¼‰</strong>ã€<strong>ServletResponseï¼ˆresponseï¼‰</strong>ã€SessionStatusã€UriComponentsBuilderã€ServletUriComponentsBuilder</p>
<h4 id="POJO-å‚æ•°"><a href="#POJO-å‚æ•°" class="headerlink" title="POJO å‚æ•°"></a>POJO å‚æ•°</h4><h3 id="POJO-å°è£…è¿‡ç¨‹"><a href="#POJO-å°è£…è¿‡ç¨‹" class="headerlink" title="POJO å°è£…è¿‡ç¨‹"></a>POJO å°è£…è¿‡ç¨‹</h3><h3 id="å‚æ•°å¤„ç†åŸç†"><a href="#å‚æ•°å¤„ç†åŸç†" class="headerlink" title="å‚æ•°å¤„ç†åŸç†"></a>å‚æ•°å¤„ç†åŸç†</h3><h3 id="å„ç§ç±»å‹å‚æ•°è§£æåŸç†"><a href="#å„ç§ç±»å‹å‚æ•°è§£æåŸç†" class="headerlink" title="å„ç§ç±»å‹å‚æ•°è§£æåŸç†"></a>å„ç§ç±»å‹å‚æ•°è§£æåŸç†</h3><blockquote>
<p>doDispatchæ–¹æ³•ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// Determine handler adapter for the current request.</span></span><br><span class="line"><span class="type">HandlerAdapter</span> <span class="variable">ha</span> <span class="operator">=</span> getHandlerAdapter(mappedHandler.getHandler());</span><br><span class="line"><span class="comment">// Process last-modified header, if supported by the handler.</span></span><br><span class="line"><span class="type">String</span> <span class="variable">method</span> <span class="operator">=</span> request.getMethod();</span><br><span class="line"><span class="type">boolean</span> <span class="variable">isGet</span> <span class="operator">=</span> HttpMethod.GET.matches(method);</span><br><span class="line"><span class="keyword">if</span> (isGet || HttpMethod.HEAD.matches(method)) &#123;</span><br><span class="line">    <span class="type">long</span> <span class="variable">lastModified</span> <span class="operator">=</span> ha.getLastModified(request, mappedHandler.getHandler());</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">new</span> <span class="title class_">ServletWebRequest</span>(request, response).checkNotModified(lastModified) &amp;&amp; isGet) 		&#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">      &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (!mappedHandler.applyPreHandle(processedRequest, response)) &#123;</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Actually invoke the handler.</span></span><br><span class="line">mv = ha.handle(processedRequest, response, mappedHandler.getHandler());</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>HandlerAdapter ha &#x3D; getHandlerAdapter(mappedHandler.getHandler());	</p>
<p><strong>å…ˆç¡®å®šä½¿ç”¨é‚£ç§ HandlerAdapter</strong></p>
<p>é»˜è®¤çš„å‡ ç§ HandlerAdapterï¼š</p>
<p><img src="/2023/02/28/SpringBoot2/Java\SpringBoot\SpringBoot2.assets\image-20221012112307958.png" alt="image-20221012112307958"></p>
<p>RequestMappingHandlerAdapterï¼šå¤„ç†@RequestMapping</p>
<p>HandlerFunctionAdapterï¼šå¤„ç†å‡½æ•°å¼å“åº”</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">HandlerAdapter</span> &#123;</span><br><span class="line"></span><br><span class="line">	<span class="type">boolean</span> <span class="title function_">supports</span><span class="params">(Object handler)</span>;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Nullable</span></span><br><span class="line">	ModelAndView <span class="title function_">handle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler)</span> <span class="keyword">throws</span> Exception;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Deprecated</span></span><br><span class="line">	<span class="type">long</span> <span class="title function_">getLastModified</span><span class="params">(HttpServletRequest request, Object handler)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ‰§è¡Œ Handler</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// Actually invoke the handler.HandlerAdapter ha;</span></span><br><span class="line">mv = ha.handle(processedRequest, response, mappedHandler.getHandler());</span><br></pre></td></tr></table></figure>

<p>AbstractHandlerMethodAdapterï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Nullable</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> ModelAndView <span class="title function_">handle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler)</span></span><br><span class="line">    <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    <span class="keyword">return</span> handleInternal(request, response, (HandlerMethod) handler);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">@Nullable</span></span><br><span class="line"><span class="keyword">protected</span> <span class="keyword">abstract</span> ModelAndView <span class="title function_">handleInternal</span><span class="params">(HttpServletRequest request,</span></span><br><span class="line"><span class="params">                                               HttpServletResponse response, HandlerMethod handlerMethod)</span> <span class="keyword">throws</span> Exception;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>RequestMappingHandlerAdapterï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">protected</span> ModelAndView <span class="title function_">handleInternal</span><span class="params">(HttpServletRequest request,</span></span><br><span class="line"><span class="params">                                      HttpServletResponse response, HandlerMethod handlerMethod)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    ModelAndView mav;</span><br><span class="line">    checkRequest(request);</span><br><span class="line">    <span class="comment">// Execute invokeHandlerMethod in synchronized block if required.</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">this</span>.synchronizeOnSession) &#123;</span><br><span class="line">        <span class="type">HttpSession</span> <span class="variable">session</span> <span class="operator">=</span> request.getSession(<span class="literal">false</span>);</span><br><span class="line">        <span class="keyword">if</span> (session != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="type">Object</span> <span class="variable">mutex</span> <span class="operator">=</span> WebUtils.getSessionMutex(session);</span><br><span class="line">            <span class="keyword">synchronized</span> (mutex) &#123;</span><br><span class="line">                mav = invokeHandlerMethod(request, response, handlerMethod);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// No HttpSession available -&gt; no mutex necessary</span></span><br><span class="line">            mav = invokeHandlerMethod(request, response, handlerMethod);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// No synchronization on session demanded at all...</span></span><br><span class="line">        mav = invokeHandlerMethod(request, response, handlerMethod);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// .....</span></span><br><span class="line">    <span class="keyword">return</span> mav;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ModelAndView mav &#x3D; invokeHandlerMethod(request, response, handlerMethod);</p>
<p>å…¶ä¸­ ServletInvocableHandlerMethod invocableMethod &#x3D; createInvocableHandlerMethod(handlerMethod);</p>
<p>å¯¹æ‰¾åˆ°çš„è¯·æ±‚æ–¹æ³•è¿›è¡ŒåŒ…è£…ï¼Œå¹¶è®¾ç½®å®ƒçš„å‚æ•°è§£æå™¨å’Œè¿”å›å€¼å¤„ç†å™¨</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Nullable</span></span><br><span class="line"><span class="keyword">protected</span> ModelAndView <span class="title function_">invokeHandlerMethod</span><span class="params">(HttpServletRequest request,</span></span><br><span class="line"><span class="params">                                           HttpServletResponse response, HandlerMethod handlerMethod)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    <span class="type">ServletWebRequest</span> <span class="variable">webRequest</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ServletWebRequest</span>(request, response);</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="type">WebDataBinderFactory</span> <span class="variable">binderFactory</span> <span class="operator">=</span> getDataBinderFactory(handlerMethod);</span><br><span class="line">        <span class="type">ModelFactory</span> <span class="variable">modelFactory</span> <span class="operator">=</span> getModelFactory(handlerMethod, binderFactory);</span><br><span class="line">        <span class="type">ServletInvocableHandlerMethod</span> <span class="variable">invocableMethod</span> <span class="operator">=</span> createInvocableHandlerMethod(handlerMethod);</span><br><span class="line">        <span class="comment">// ========å‚æ•°è§£æå™¨=========</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">this</span>.argumentResolvers != <span class="literal">null</span>) &#123;</span><br><span class="line">            invocableMethod.setHandlerMethodArgumentResolvers(<span class="built_in">this</span>.argumentResolvers);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// // ========è¿”å›å€¼å¤„ç†å™¨=========</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">this</span>.returnValueHandlers != <span class="literal">null</span>) &#123;</span><br><span class="line">           invocableMethod.setHandlerMethodReturnValueHandlers(<span class="built_in">this</span>.returnValueHandlers);</span><br><span class="line">        &#125;</span><br><span class="line">        invocableMethod.setDataBinderFactory(binderFactory);</span><br><span class="line">        invocableMethod.setParameterNameDiscoverer(<span class="built_in">this</span>.parameterNameDiscoverer);</span><br><span class="line"></span><br><span class="line">        <span class="type">ModelAndViewContainer</span> <span class="variable">mavContainer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ModelAndViewContainer</span>();</span><br><span class="line">        mavContainer.addAllAttributes(RequestContextUtils.getInputFlashMap(request));</span><br><span class="line">        modelFactory.initModel(webRequest, mavContainer, invocableMethod);</span><br><span class="line">        mavContainer.setIgnoreDefaultModelOnRedirect(<span class="built_in">this</span>.ignoreDefaultModelOnRedirect);</span><br><span class="line"></span><br><span class="line">        <span class="type">AsyncWebRequest</span> <span class="variable">asyncWebRequest</span> <span class="operator">=</span> WebAsyncUtils.createAsyncWebRequest(request, response);</span><br><span class="line">        asyncWebRequest.setTimeout(<span class="built_in">this</span>.asyncRequestTimeout);</span><br><span class="line"></span><br><span class="line">        <span class="type">WebAsyncManager</span> <span class="variable">asyncManager</span> <span class="operator">=</span> WebAsyncUtils.getAsyncManager(request);</span><br><span class="line">        asyncManager.setTaskExecutor(<span class="built_in">this</span>.taskExecutor);</span><br><span class="line">        asyncManager.setAsyncWebRequest(asyncWebRequest);</span><br><span class="line">        asyncManager.registerCallableInterceptors(<span class="built_in">this</span>.callableInterceptors);</span><br><span class="line">        asyncManager.registerDeferredResultInterceptors(<span class="built_in">this</span>.deferredResultInterceptors);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (asyncManager.hasConcurrentResult()) &#123;</span><br><span class="line">            <span class="type">Object</span> <span class="variable">result</span> <span class="operator">=</span> asyncManager.getConcurrentResult();</span><br><span class="line">            mavContainer = (ModelAndViewContainer) asyncManager.getConcurrentResultContext()[<span class="number">0</span>];</span><br><span class="line">            asyncManager.clearConcurrentResult();</span><br><span class="line">            LogFormatUtils.traceDebug(logger, traceOn -&gt; &#123;</span><br><span class="line">                <span class="type">String</span> <span class="variable">formatted</span> <span class="operator">=</span> LogFormatUtils.formatValue(result, !traceOn);</span><br><span class="line">                <span class="keyword">return</span> <span class="string">&quot;Resume with async result [&quot;</span> + formatted + <span class="string">&quot;]&quot;</span>;</span><br><span class="line">            &#125;);</span><br><span class="line">            invocableMethod = invocableMethod.wrapConcurrentResult(result);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// =========æ‰§è¡Œç›®æ ‡æ–¹æ³•=========</span></span><br><span class="line">        invocableMethod.invokeAndHandle(webRequest, mavContainer);</span><br><span class="line">        <span class="keyword">if</span> (asyncManager.isConcurrentHandlingStarted()) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> getModelAndView(mavContainer, modelFactory, webRequest);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">finally</span> &#123;</span><br><span class="line">        webRequest.requestCompleted();</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>å‚æ•°è§£æå™¨ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">HandlerMethodArgumentResolver</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="type">boolean</span> <span class="title function_">supportsParameter</span><span class="params">(MethodParameter parameter)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Nullable</span></span><br><span class="line">    Object <span class="title function_">resolveArgument</span><span class="params">(</span></span><br><span class="line"><span class="params">        MethodParameter parameter, </span></span><br><span class="line"><span class="params">        <span class="meta">@Nullable</span> ModelAndViewContainer mavContainer, </span></span><br><span class="line"><span class="params">        NativeWebRequest webRequest,</span></span><br><span class="line"><span class="params">        <span class="meta">@Nullable</span> WebDataBinderFactory binderFactory)</span> <span class="keyword">throws</span> Exception;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="/2023/02/28/SpringBoot2/Java\SpringBoot\SpringBoot2.assets\image-20221012113559259.png" alt="image-20221012113559259"></p>
<p>è¿”å›å€¼å¤„ç†å™¨ï¼š</p>
<p><img src="/2023/02/28/SpringBoot2/Java\SpringBoot\SpringBoot2.assets\image-20221012113627987.png" alt="image-20221012113627987"></p>
<p>å‚æ•°è§£æå™¨å’Œè¿”å›å€¼å¤„ç†å™¨éƒ½ä¼šå°è£…åˆ° <strong>invocableMethod</strong> ä¸­ã€‚</p>
<p>invocableMethod.invokeAndHandle(webRequest, mavContainer);</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">invokeAndHandle</span><span class="params">(ServletWebRequest webRequest, ModelAndViewContainer mavContainer,Object... providedArgs)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">	<span class="comment">// ===========invokeForRequestï¼šè§£æå‚æ•°,ç»™ä»£ç†handleræ–¹æ³•èµ‹å€¼ï¼Œæ‰§è¡Œhandleræ–¹æ³•============</span></span><br><span class="line">    <span class="type">Object</span> <span class="variable">returnValue</span> <span class="operator">=</span> invokeForRequest(webRequest, mavContainer, providedArgs);</span><br><span class="line">    setResponseStatus(webRequest);</span><br><span class="line">	</span><br><span class="line">    <span class="keyword">if</span> (returnValue == <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (isRequestNotModified(webRequest) || getResponseStatus() != <span class="literal">null</span> || mavContainer.isRequestHandled()) &#123;</span><br><span class="line">            disableContentCachingIfNecessary(webRequest);</span><br><span class="line">            mavContainer.setRequestHandled(<span class="literal">true</span>);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (StringUtils.hasText(getResponseStatusReason())) &#123;</span><br><span class="line">        mavContainer.setRequestHandled(<span class="literal">true</span>);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    mavContainer.setRequestHandled(<span class="literal">false</span>);</span><br><span class="line">    Assert.state(<span class="built_in">this</span>.returnValueHandlers != <span class="literal">null</span>, <span class="string">&quot;No return value handlers&quot;</span>);</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.returnValueHandlers.handleReturnValue(</span><br><span class="line">            returnValue, getReturnValueType(returnValue), mavContainer, webRequest);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">catch</span> (Exception ex) &#123;</span><br><span class="line">        <span class="keyword">if</span> (logger.isTraceEnabled()) &#123;</span><br><span class="line">            logger.trace(formatErrorForReturnValue(returnValue), ex);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">throw</span> ex;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Object returnValue &#x3D; invokeForRequest(webRequest, mavContainer, providedArgs);</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Nullable</span></span><br><span class="line"><span class="keyword">public</span> Object <span class="title function_">invokeForRequest</span><span class="params">(NativeWebRequest request, <span class="meta">@Nullable</span> ModelAndViewContainer mavContainer,Object... providedArgs)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">	<span class="comment">// ===========è¿”å›å‚æ•°å€¼çš„æ•°ç»„ï¼šå·²ç»è§£æå®Œæˆ==========</span></span><br><span class="line">    Object[] args = getMethodArgumentValues(request, mavContainer, providedArgs);</span><br><span class="line">    <span class="keyword">if</span> (logger.isTraceEnabled()) &#123;</span><br><span class="line">        logger.trace(<span class="string">&quot;Arguments: &quot;</span> + Arrays.toString(args));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> doInvoke(args);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Object[] args &#x3D; getMethodArgumentValues(request, mavContainer, providedArgs);</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">protected</span> Object[] getMethodArgumentValues(NativeWebRequest request, <span class="meta">@Nullable</span> ModelAndViewContainer mavContainer,Object... providedArgs) <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    MethodParameter[] parameters = getMethodParameters();</span><br><span class="line">    <span class="keyword">if</span> (ObjectUtils.isEmpty(parameters)) &#123;</span><br><span class="line">        <span class="keyword">return</span> EMPTY_ARGS;</span><br><span class="line">    &#125;</span><br><span class="line">    Object[] args = <span class="keyword">new</span> <span class="title class_">Object</span>[parameters.length];</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; parameters.length; i++) &#123;</span><br><span class="line">        <span class="type">MethodParameter</span> <span class="variable">parameter</span> <span class="operator">=</span> parameters[i];</span><br><span class="line">        parameter.initParameterNameDiscovery(<span class="built_in">this</span>.parameterNameDiscoverer);</span><br><span class="line">        args[i] = findProvidedArgument(parameter, providedArgs);</span><br><span class="line">        <span class="keyword">if</span> (args[i] != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (!<span class="built_in">this</span>.resolvers.supportsParameter(parameter)) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalStateException</span>(formatArgumentError(parameter, <span class="string">&quot;No suitable resolver&quot;</span>));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// =============ç”±å‚æ•°è§£æå™¨è¿›è¡Œè§£æå°è£…==============</span></span><br><span class="line">            args[i] = <span class="built_in">this</span>.resolvers.resolveArgument(parameter, mavContainer, request, <span class="built_in">this</span>.dataBinderFactory);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">catch</span> (Exception ex) &#123;</span><br><span class="line">            <span class="comment">// Leave stack trace for later, exception may actually be resolved and handled...</span></span><br><span class="line">            <span class="keyword">if</span> (logger.isDebugEnabled()) &#123;</span><br><span class="line">                <span class="type">String</span> <span class="variable">exMsg</span> <span class="operator">=</span> ex.getMessage();</span><br><span class="line">                <span class="keyword">if</span> (exMsg != <span class="literal">null</span> &amp;&amp; !exMsg.contains(parameter.getExecutable().toGenericString())) &#123;</span><br><span class="line">                    logger.debug(formatArgumentError(parameter, exMsg));</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">throw</span> ex;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> args;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>args[i] &#x3D; this.resolvers.resolveArgument(parameter, mavContainer, request, this.dataBinderFactory);</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Nullable</span></span><br><span class="line"><span class="keyword">public</span> Object <span class="title function_">resolveArgument</span><span class="params">(MethodParameter parameter, <span class="meta">@Nullable</span> ModelAndViewContainer mavContainer,NativeWebRequest webRequest, <span class="meta">@Nullable</span> WebDataBinderFactory binderFactory)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">	<span class="comment">// åœ¨æ‰€æœ‰çš„å‚æ•°è§£æå™¨ä¸­æ‰¾åˆ°æ¯ä¸€ä¸ªå‚æ•°è¯¦ç»†ä¿¡æ¯ï¼ˆæ³¨è§£ï¼Œç±»å‹ï¼Œä½ç½®ç­‰ï¼‰å¯¹åº”çš„resolver</span></span><br><span class="line">    <span class="type">HandlerMethodArgumentResolver</span> <span class="variable">resolver</span> <span class="operator">=</span> getArgumentResolver(parameter);</span><br><span class="line">    <span class="keyword">if</span> (resolver == <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalArgumentException</span>(<span class="string">&quot;Unsupported parameter type [&quot;</span> +</span><br><span class="line">                                           parameter.getParameterType().getName() + <span class="string">&quot;]. supportsParameter should be called first.&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// ===========æ‹¿åˆ°ç›¸åº”çš„å‚æ•°è§£æå™¨åï¼Œè§£æå‚æ•°===========</span></span><br><span class="line">    <span class="keyword">return</span> resolver.resolveArgument(parameter, mavContainer, webRequest, binderFactory);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>HandlerMethodArgumentResolver resolver &#x3D; getArgumentResolver(parameter);</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Nullable</span></span><br><span class="line"><span class="keyword">private</span> HandlerMethodArgumentResolver <span class="title function_">getArgumentResolver</span><span class="params">(MethodParameter parameter)</span> &#123;</span><br><span class="line">    <span class="comment">// ===========å…ˆä»ç¼“å­˜ä¸­æŸ¥æ‰¾===========</span></span><br><span class="line">    <span class="type">HandlerMethodArgumentResolver</span> <span class="variable">result</span> <span class="operator">=</span> <span class="built_in">this</span>.argumentResolverCache.get(parameter);</span><br><span class="line">    <span class="keyword">if</span> (result == <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">for</span> (HandlerMethodArgumentResolver resolver : <span class="built_in">this</span>.argumentResolvers) &#123;</span><br><span class="line">            <span class="comment">// =========åˆ¤æ–­æ˜¯å¦æ”¯æŒæŸç§è§£æå™¨ï¼šæ˜¯å¦æœ‰ç›¸åº”æ³¨è§£ç­‰===========</span></span><br><span class="line">            <span class="keyword">if</span> (resolver.supportsParameter(parameter)) &#123;</span><br><span class="line">                result = resolver;</span><br><span class="line">                <span class="comment">// =============æ‰¾åˆ°åæ”¾å…¥ç¼“å­˜==============</span></span><br><span class="line">                <span class="built_in">this</span>.argumentResolverCache.put(parameter, result);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¦‚@PathVariableæ³¨è§£ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PathVariableMapMethodArgumentResolver</span> <span class="keyword">implements</span> <span class="title class_">HandlerMethodArgumentResolver</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">supportsParameter</span><span class="params">(MethodParameter parameter)</span> &#123;</span><br><span class="line">        <span class="comment">// =========åˆ¤æ–­æ˜¯å¦æœ‰@PathVariable========</span></span><br><span class="line">        <span class="type">PathVariable</span> <span class="variable">ann</span> <span class="operator">=</span> parameter.getParameterAnnotation(PathVariable.class);</span><br><span class="line">        <span class="keyword">return</span> (ann != <span class="literal">null</span> &amp;&amp; Map.class.isAssignableFrom(parameter.getParameterType()) &amp;&amp;</span><br><span class="line">                !StringUtils.hasText(ann.value()));</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>å‚æ•°è§£æå™¨è§£æå‚æ•°ï¼š</p>
<p>resolver.resolveArgument(parameter, mavContainer, webRequest, binderFactory);</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="meta">@Nullable</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> Object <span class="title function_">resolveArgument</span><span class="params">(MethodParameter parameter, <span class="meta">@Nullable</span> ModelAndViewContainer mavContainer, NativeWebRequest webRequest, <span class="meta">@Nullable</span> WebDataBinderFactory binderFactory)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    <span class="type">NamedValueInfo</span> <span class="variable">namedValueInfo</span> <span class="operator">=</span> getNamedValueInfo(parameter);</span><br><span class="line">    <span class="type">MethodParameter</span> <span class="variable">nestedParameter</span> <span class="operator">=</span> parameter.nestedIfOptional();</span><br><span class="line">    </span><br><span class="line">    <span class="type">Object</span> <span class="variable">resolvedName</span> <span class="operator">=</span> resolveEmbeddedValuesAndExpressions(namedValueInfo.name);</span><br><span class="line">    <span class="keyword">if</span> (resolvedName == <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalArgumentException</span>(</span><br><span class="line">            <span class="string">&quot;Specified name must not resolve to null: [&quot;</span> + namedValueInfo.name + <span class="string">&quot;]&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">	<span class="comment">// =========å¾—åˆ°å‚æ•°ï¼šå¦‚@PathVariableè§£æè·¯å¾„çš„å€¼==========</span></span><br><span class="line">    <span class="type">Object</span> <span class="variable">arg</span> <span class="operator">=</span> resolveName(resolvedName.toString(), nestedParameter, webRequest);</span><br><span class="line">    <span class="keyword">if</span> (arg == <span class="literal">null</span>) &#123;</span><br></pre></td></tr></table></figure>

<p>æœ€ç»ˆå¾—åˆ°æ‰€æœ‰çš„å‚æ•°å€¼ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Nullable</span></span><br><span class="line"><span class="keyword">public</span> Object <span class="title function_">invokeForRequest</span><span class="params">(NativeWebRequest request, <span class="meta">@Nullable</span> ModelAndViewContainer mavContainer,Object... providedArgs)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">	<span class="comment">// ===========è¿”å›å‚æ•°å€¼çš„æ•°ç»„ï¼šå·²ç»è§£æå®Œæˆ==========</span></span><br><span class="line">    Object[] args = getMethodArgumentValues(request, mavContainer, providedArgs);</span><br><span class="line">    <span class="keyword">if</span> (logger.isTraceEnabled()) &#123;</span><br><span class="line">        logger.trace(<span class="string">&quot;Arguments: &quot;</span> + Arrays.toString(args));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// ==========é€šè¿‡åå°„ç»™ä»£ç†çš„æ–¹æ³•å‚æ•°èµ‹å€¼============</span></span><br><span class="line">    <span class="keyword">return</span> doInvoke(args);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>doInvoke(args);</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// ==========é€šè¿‡åå°„ç»™ä»£ç†çš„æ–¹æ³•å‚æ•°èµ‹å€¼============</span></span><br><span class="line"><span class="meta">@Nullable</span></span><br><span class="line"><span class="keyword">protected</span> Object <span class="title function_">doInvoke</span><span class="params">(Object... args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    <span class="type">Method</span> <span class="variable">method</span> <span class="operator">=</span> getBridgedMethod();</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (KotlinDetector.isSuspendingFunction(method)) &#123;</span><br><span class="line">            <span class="keyword">return</span> CoroutinesUtils.invokeSuspendingFunction(method, getBean(), args);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> method.invoke(getBean(), args);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>


</blockquote>
<h2 id="æ•°æ®å“åº”ä¸å†…å®¹åå•†"><a href="#æ•°æ®å“åº”ä¸å†…å®¹åå•†" class="headerlink" title="æ•°æ®å“åº”ä¸å†…å®¹åå•†"></a>æ•°æ®å“åº”ä¸å†…å®¹åå•†</h2><h2 id="è§†å›¾è§£æä¸æ¨¡æ¿å¼•æ“"><a href="#è§†å›¾è§£æä¸æ¨¡æ¿å¼•æ“" class="headerlink" title="è§†å›¾è§£æä¸æ¨¡æ¿å¼•æ“"></a>è§†å›¾è§£æä¸æ¨¡æ¿å¼•æ“</h2><h2 id="æ‹¦æˆªå™¨"><a href="#æ‹¦æˆªå™¨" class="headerlink" title="æ‹¦æˆªå™¨"></a>æ‹¦æˆªå™¨</h2><h2 id="å¼‚å¸¸å¤„ç†"><a href="#å¼‚å¸¸å¤„ç†" class="headerlink" title="å¼‚å¸¸å¤„ç†"></a>å¼‚å¸¸å¤„ç†</h2><h2 id="åŸç”ŸServletç»„ä»¶"><a href="#åŸç”ŸServletç»„ä»¶" class="headerlink" title="åŸç”ŸServletç»„ä»¶"></a>åŸç”ŸServletç»„ä»¶</h2><h2 id="Web-è¯·æ±‚å¤„ç†æµç¨‹"><a href="#Web-è¯·æ±‚å¤„ç†æµç¨‹" class="headerlink" title="Web è¯·æ±‚å¤„ç†æµç¨‹"></a>Web è¯·æ±‚å¤„ç†æµç¨‹</h2><blockquote>
<ol>
<li>è¯·æ±‚æ˜ å°„ï¼Œå®¢æˆ·ç«¯çš„è¯·æ±‚è¢«å“ªä¸€ä¸ªcontrollerçš„æ–¹æ³•å¤„ç†</li>
<li></li>
</ol>
</blockquote>
<p><strong>SpringMVC åŠŸèƒ½åˆ†æä»ï¼š org.springframework.web.servlet.DispatcherServlet â€“&gt; doDispatch() æ–¹æ³•å¼€å§‹ã€‚</strong></p>
<p><strong>DispatcherServletï¼š</strong></p>
<p>è¯¥ç±»ç»§æ‰¿äº†HttpServlet</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DispatcherServlet</span> <span class="keyword">extends</span> <span class="title class_">FrameworkServlet</span> &#123;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">FrameworkServlet</span> <span class="keyword">extends</span> <span class="title class_">HttpServletBean</span> <span class="keyword">implements</span> <span class="title class_">ApplicationContextAware</span> &#123;</span><br><span class="line"> <span class="meta">@Override</span></span><br><span class="line">	<span class="keyword">protected</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title function_">doGet</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span></span><br><span class="line">			<span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">		processRequest(request, response);</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="keyword">protected</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title function_">doPost</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span></span><br><span class="line">			<span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">		processRequest(request, response);</span><br><span class="line">	&#125;</span><br><span class="line">    </span><br><span class="line"> 	<span class="keyword">protected</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title function_">processRequest</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span></span><br><span class="line">			<span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">		<span class="comment">// ...</span></span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			doService(request, response);</span><br><span class="line">		&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">HttpServletBean</span> <span class="keyword">extends</span> <span class="title class_">HttpServlet</span> <span class="keyword">implements</span> <span class="title class_">EnvironmentCapable</span>, EnvironmentAware &#123;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doService</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">	<span class="comment">// ...</span></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">		doDispatch(request, response);</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>

<p>æ ¸å¿ƒæ–¹æ³•ï¼šdoDispatch(request, response);æ–¹æ³•ç”¨äºå¤„ç†è¯·æ±‚å’Œå“åº”ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * Process the actual dispatching to the handler.</span></span><br><span class="line"><span class="comment">	 * &lt;p&gt;The handler will be obtained by applying the servlet&#x27;s HandlerMappings in order.</span></span><br><span class="line"><span class="comment">	 * The HandlerAdapter will be obtained by querying the servlet&#x27;s installed HandlerAdapters</span></span><br><span class="line"><span class="comment">	 * to find the first that supports the handler class.</span></span><br><span class="line"><span class="comment">	 * &lt;p&gt;All HTTP methods are handled by this method. It&#x27;s up to HandlerAdapters or handlers</span></span><br><span class="line"><span class="comment">	 * themselves to decide which methods are acceptable.</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> request current HTTP request</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> response current HTTP response</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@throws</span> Exception in case of any kind of processing failure</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line"><span class="meta">@SuppressWarnings(&quot;deprecation&quot;)</span></span><br><span class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doDispatch</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    <span class="type">HttpServletRequest</span> <span class="variable">processedRequest</span> <span class="operator">=</span> request;</span><br><span class="line">    <span class="type">HandlerExecutionChain</span> <span class="variable">mappedHandler</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">    <span class="type">boolean</span> <span class="variable">multipartRequestParsed</span> <span class="operator">=</span> <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">    <span class="type">WebAsyncManager</span> <span class="variable">asyncManager</span> <span class="operator">=</span> WebAsyncUtils.getAsyncManager(request);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="type">ModelAndView</span> <span class="variable">mv</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="type">Exception</span> <span class="variable">dispatchException</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// ==========æ£€æŸ¥æ˜¯å¦ä¸ºæ–‡ä»¶ä¸Šä¼ è¯·æ±‚==========</span></span><br><span class="line">            processedRequest = checkMultipart(request);</span><br><span class="line">            multipartRequestParsed = (processedRequest != request);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// Determine handler for the current request.</span></span><br><span class="line">            <span class="comment">// ==========å†³å®šå“ªä¸€ä¸ªhandleræ–¹æ³•è¿›è¡Œè¯·æ±‚çš„å¤„ç†==========</span></span><br><span class="line">            mappedHandler = getHandler(processedRequest);</span><br><span class="line">            <span class="keyword">if</span> (mappedHandler == <span class="literal">null</span>) &#123;</span><br><span class="line">                noHandlerFound(processedRequest, response);</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// Determine handler adapter for the current request.</span></span><br><span class="line">            <span class="comment">// ===========è¿”å›è¯¥è¯·æ±‚å¯¹åº”çš„adapterï¼šRequestMappingHandlerAdapter==========</span></span><br><span class="line">            <span class="type">HandlerAdapter</span> <span class="variable">ha</span> <span class="operator">=</span> getHandlerAdapter(mappedHandler.getHandler());</span><br><span class="line"></span><br><span class="line">            <span class="comment">// Process last-modified header, if supported by the handler.</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">method</span> <span class="operator">=</span> request.getMethod();</span><br><span class="line">            <span class="type">boolean</span> <span class="variable">isGet</span> <span class="operator">=</span> HttpMethod.GET.matches(method);</span><br><span class="line">            <span class="keyword">if</span> (isGet || HttpMethod.HEAD.matches(method)) &#123;</span><br><span class="line">                <span class="type">long</span> <span class="variable">lastModified</span> <span class="operator">=</span> ha.getLastModified(request, mappedHandler.getHandler());</span><br><span class="line">                <span class="keyword">if</span> (<span class="keyword">new</span> <span class="title class_">ServletWebRequest</span>(request, response).checkNotModified(lastModified) &amp;&amp; isGet) &#123;</span><br><span class="line">                    <span class="keyword">return</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">			<span class="comment">// =========çœŸæ­£çš„handleræ–¹æ³•æ‰§è¡Œä¹‹å‰æ‰§è¡Œçš„æ‹¦æˆªå™¨æ–¹æ³•==========</span></span><br><span class="line">            <span class="keyword">if</span> (!mappedHandler.applyPreHandle(processedRequest, response)) &#123;</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// Actually invoke the handler.</span></span><br><span class="line">            mv = ha.handle(processedRequest, response, mappedHandler.getHandler());</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (asyncManager.isConcurrentHandlingStarted()) &#123;</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            applyDefaultViewName(processedRequest, mv);</span><br><span class="line">            <span class="comment">// ==============æ‹¦æˆªå™¨åç½®æ–¹æ³•æ‰§è¡Œ===============</span></span><br><span class="line">            mappedHandler.applyPostHandle(processedRequest, response, mv);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">catch</span> (Exception ex) &#123;</span><br><span class="line">            <span class="comment">// =============ä»¥ä¸Šè¿‡ç¨‹å‘ç”Ÿçš„ä»»ä½•å¼‚å¸¸éƒ½ä¼šè¢«dispatchExceptionè®°å½•===========</span></span><br><span class="line">            dispatchException = ex;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">catch</span> (Throwable err) &#123;</span><br><span class="line">            <span class="comment">// As of 4.3, we&#x27;re processing Errors thrown from handler methods as well,</span></span><br><span class="line">            <span class="comment">// making them available for @ExceptionHandler methods and other scenarios.</span></span><br><span class="line">            dispatchException = <span class="keyword">new</span> <span class="title class_">NestedServletException</span>(<span class="string">&quot;Handler dispatch failed&quot;</span>, err);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// ==========å¤„ç†æ´¾å‘ç»“æœï¼Œè¯•å›¾æ¸²æŸ“ç­‰==========</span></span><br><span class="line">        processDispatchResult(processedRequest, response, mappedHandler, mv, dispatchException);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">catch</span> (Exception ex) &#123;</span><br><span class="line">        triggerAfterCompletion(processedRequest, response, mappedHandler, ex);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">catch</span> (Throwable err) &#123;</span><br><span class="line">        triggerAfterCompletion(processedRequest, response, mappedHandler,</span><br><span class="line">                               <span class="keyword">new</span> <span class="title class_">NestedServletException</span>(<span class="string">&quot;Handler processing failed&quot;</span>, err));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">finally</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (asyncManager.isConcurrentHandlingStarted()) &#123;</span><br><span class="line">            <span class="comment">// Instead of postHandle and afterCompletion</span></span><br><span class="line">            <span class="keyword">if</span> (mappedHandler != <span class="literal">null</span>) &#123;</span><br><span class="line">                mappedHandler.applyAfterConcurrentHandlingStarted(processedRequest, response);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// Clean up any resources used by a multipart request.</span></span><br><span class="line">            <span class="keyword">if</span> (multipartRequestParsed) &#123;</span><br><span class="line">                cleanupMultipart(processedRequest);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ–¹æ³•ï¼šHandlerExecutionChain mappedHandler &#x3D; getHandler(processedRequest);</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * Return the HandlerExecutionChain for this request.</span></span><br><span class="line"><span class="comment">	 * &lt;p&gt;Tries all handler mappings in order.</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> request current HTTP request</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@return</span> the HandlerExecutionChain, or &#123;<span class="doctag">@code</span> null&#125; if no handler could be found</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line"><span class="meta">@Nullable</span></span><br><span class="line"><span class="keyword">protected</span> HandlerExecutionChain <span class="title function_">getHandler</span><span class="params">(HttpServletRequest request)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">this</span>.handlerMappings != <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">for</span> (HandlerMapping mapping : <span class="built_in">this</span>.handlerMappings) &#123;</span><br><span class="line">            <span class="type">HandlerExecutionChain</span> <span class="variable">handler</span> <span class="operator">=</span> mapping.getHandler(request);</span><br><span class="line">            <span class="keyword">if</span> (handler != <span class="literal">null</span>) &#123;</span><br><span class="line">                <span class="keyword">return</span> handler;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>this.handlerMappingsï¼š</p>
<img src="/2023/02/28/SpringBoot2/Java\SpringBoot\SpringBoot2.assets\image-20221020211213700.png" alt="image-20221020211213700" style="zoom:80%;">

<p><strong>RequestMappingHandlerMapping</strong> â€“&gt; getHandler()ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Look up a handler for the given request, falling back to the default</span></span><br><span class="line"><span class="comment"> * handler if no specific one is found.</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> request current HTTP request</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> the corresponding handler instance, or the default handler</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@see</span> #getHandlerInternal</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="meta">@Nullable</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> HandlerExecutionChain <span class="title function_">getHandler</span><span class="params">(HttpServletRequest request)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">       <span class="comment">// ===========è¿”å›å¤„ç†è¯¥è¯·æ±‚çš„handlerï¼ˆä»£ç†ï¼‰å¯¹è±¡===========</span></span><br><span class="line">	<span class="type">Object</span> <span class="variable">handler</span> <span class="operator">=</span> getHandlerInternal(request);</span><br><span class="line">	<span class="keyword">if</span> (handler == <span class="literal">null</span>) &#123;</span><br><span class="line">		handler = getDefaultHandler();</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span> (handler == <span class="literal">null</span>) &#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">// Bean name or resolved handler?</span></span><br><span class="line">	<span class="keyword">if</span> (handler <span class="keyword">instanceof</span> String) &#123;</span><br><span class="line">		<span class="type">String</span> <span class="variable">handlerName</span> <span class="operator">=</span> (String) handler;</span><br><span class="line">		handler = obtainApplicationContext().getBean(handlerName);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// Ensure presence of cached lookupPath for interceptors and others</span></span><br><span class="line">	<span class="keyword">if</span> (!ServletRequestPathUtils.hasCachedPath(request)) &#123;</span><br><span class="line">		initLookupPath(request);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">// ==========æ–¹æ³•çš„æ‹¦æˆªå™¨</span></span><br><span class="line">	<span class="type">HandlerExecutionChain</span> <span class="variable">executionChain</span> <span class="operator">=</span> getHandlerExecutionChain(handler, request);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (logger.isTraceEnabled()) &#123;</span><br><span class="line">		logger.trace(<span class="string">&quot;Mapped to &quot;</span> + handler);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">else</span> <span class="keyword">if</span> (logger.isDebugEnabled() &amp;&amp; !DispatcherType.ASYNC.equals(request.getDispatcherType())) &#123;</span><br><span class="line">		logger.debug(<span class="string">&quot;Mapped to &quot;</span> + executionChain.getHandler());</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (hasCorsConfigurationSource(handler) || CorsUtils.isPreFlightRequest(request)) &#123;</span><br><span class="line">		<span class="type">CorsConfiguration</span> <span class="variable">config</span> <span class="operator">=</span> getCorsConfiguration(handler, request);</span><br><span class="line">		<span class="keyword">if</span> (getCorsConfigurationSource() != <span class="literal">null</span>) &#123;</span><br><span class="line">			<span class="type">CorsConfiguration</span> <span class="variable">globalConfig</span> <span class="operator">=</span> getCorsConfigurationSource().getCorsConfiguration(request);</span><br><span class="line">			config = (globalConfig != <span class="literal">null</span> ? globalConfig.combine(config) : config);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span> (config != <span class="literal">null</span>) &#123;</span><br><span class="line">			config.validateAllowCredentials();</span><br><span class="line">		&#125;</span><br><span class="line">		executionChain = getCorsHandlerExecutionChain(request, executionChain, config);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> executionChain;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>getHandlerInternal(request)ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Look up a handler method for the given request.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="meta">@Nullable</span></span><br><span class="line"><span class="keyword">protected</span> HandlerMethod <span class="title function_">getHandlerInternal</span><span class="params">(HttpServletRequest request)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">	<span class="comment">// ===========å¾—åˆ°è¯·æ±‚çš„è·¯å¾„ï¼š/user ===============</span></span><br><span class="line">       <span class="type">String</span> <span class="variable">lookupPath</span> <span class="operator">=</span> initLookupPath(request);</span><br><span class="line">       <span class="comment">// ===========åŠ é”==============</span></span><br><span class="line">	<span class="built_in">this</span>.mappingRegistry.acquireReadLock();</span><br><span class="line">	<span class="keyword">try</span> &#123;</span><br><span class="line">           <span class="comment">// ===========æ ¹æ®lookupPath,åœ¨mappingRegistryä¸­æŸ¥æ‰¾ï¼Œè¿”å›å¤„ç†è¯¥è¯·æ±‚çš„handlerå¯¹è±¡=====</span></span><br><span class="line">		<span class="type">HandlerMethod</span> <span class="variable">handlerMethod</span> <span class="operator">=</span> lookupHandlerMethod(lookupPath, request);</span><br><span class="line">		<span class="keyword">return</span> (handlerMethod != <span class="literal">null</span> ? handlerMethod.createWithResolvedBean() : <span class="literal">null</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">finally</span> &#123;</span><br><span class="line">		<span class="built_in">this</span>.mappingRegistry.releaseReadLock();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>lookupHandlerMethod(lookupPath, request)ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Look up the best-matching handler method for the current request.</span></span><br><span class="line"><span class="comment"> * If multiple matches are found, the best match is selected.</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> lookupPath mapping lookup path within the current servlet mapping</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> request the current request</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> the best-matching handler method, or &#123;<span class="doctag">@code</span> null&#125; if no match</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@see</span> #handleMatch(Object, String, HttpServletRequest)</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@see</span> #handleNoMatch(Set, String, HttpServletRequest)</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Nullable</span></span><br><span class="line"><span class="keyword">protected</span> HandlerMethod <span class="title function_">lookupHandlerMethod</span><span class="params">(String lookupPath, HttpServletRequest request)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">	List&lt;Match&gt; matches = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">       <span class="comment">// ==========this.mappingRegistryï¼šæ‰€æœ‰çš„è¯·æ±‚è·¯å¾„å¯¹åº”çš„æ–¹æ³•=============</span></span><br><span class="line">	List&lt;T&gt; directPathMatches = <span class="built_in">this</span>.mappingRegistry.getMappingsByDirectPath(lookupPath);</span><br><span class="line">	<span class="keyword">if</span> (directPathMatches != <span class="literal">null</span>) &#123;</span><br><span class="line">		addMatchingMappings(directPathMatches, matches, request);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span> (matches.isEmpty()) &#123;</span><br><span class="line">		addMatchingMappings(<span class="built_in">this</span>.mappingRegistry.getRegistrations().keySet(), matches, request);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span> (!matches.isEmpty()) &#123;</span><br><span class="line">           <span class="comment">// ============é»˜è®¤å¾—åˆ°ç¬¬ä¸€ä¸ªhandlerä½œä¸ºæœ€ä½³åŒ¹é…=============</span></span><br><span class="line">		<span class="type">Match</span> <span class="variable">bestMatch</span> <span class="operator">=</span> matches.get(<span class="number">0</span>);</span><br><span class="line">           <span class="comment">// ============å¦‚æœæœ‰å¤šä¸ªåŒ¹é…ï¼Œä½†è¯·æ±‚æ–¹å¼ä¸åŒï¼Œæˆ–å…¶ä»–åŸå› ï¼Œåˆ™å†æ ¹æ®è¯·æ±‚æ–¹å¼ç­›é€‰==========</span></span><br><span class="line">		<span class="keyword">if</span> (matches.size() &gt; <span class="number">1</span>) &#123;</span><br><span class="line">			Comparator&lt;Match&gt; comparator = <span class="keyword">new</span> <span class="title class_">MatchComparator</span>(getMappingComparator(request));</span><br><span class="line">			matches.sort(comparator);</span><br><span class="line">			bestMatch = matches.get(<span class="number">0</span>);</span><br><span class="line">			<span class="keyword">if</span> (logger.isTraceEnabled()) &#123;</span><br><span class="line">				logger.trace(matches.size() + <span class="string">&quot; matching mappings: &quot;</span> + matches);</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">if</span> (CorsUtils.isPreFlightRequest(request)) &#123;</span><br><span class="line">				<span class="keyword">for</span> (Match match : matches) &#123;</span><br><span class="line">					<span class="keyword">if</span> (match.hasCorsConfig()) &#123;</span><br><span class="line">						<span class="keyword">return</span> PREFLIGHT_AMBIGUOUS_MATCH;</span><br><span class="line">					&#125;</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">else</span> &#123;</span><br><span class="line">				<span class="type">Match</span> <span class="variable">secondBestMatch</span> <span class="operator">=</span> matches.get(<span class="number">1</span>);</span><br><span class="line">				<span class="keyword">if</span> (comparator.compare(bestMatch, secondBestMatch) == <span class="number">0</span>) &#123;</span><br><span class="line">					<span class="type">Method</span> <span class="variable">m1</span> <span class="operator">=</span> bestMatch.getHandlerMethod().getMethod();</span><br><span class="line">					<span class="type">Method</span> <span class="variable">m2</span> <span class="operator">=</span> secondBestMatch.getHandlerMethod().getMethod();</span><br><span class="line">					<span class="type">String</span> <span class="variable">uri</span> <span class="operator">=</span> request.getRequestURI();</span><br><span class="line">					<span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalStateException</span>(</span><br><span class="line">							<span class="string">&quot;Ambiguous handler methods mapped for &#x27;&quot;</span> + uri + <span class="string">&quot;&#x27;: &#123;&quot;</span> + m1 + <span class="string">&quot;, &quot;</span> + m2 + <span class="string">&quot;&#125;&quot;</span>);</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		request.setAttribute(BEST_MATCHING_HANDLER_ATTRIBUTE, </span><br><span class="line">                                bestMatch.getHandlerMethod());</span><br><span class="line">		handleMatch(bestMatch.mapping, lookupPath, request);</span><br><span class="line">           <span class="comment">// ===========è¿”å›æœ€ä½³åŒ¹é…å¯¹åº”çš„handleræ–¹æ³•=============</span></span><br><span class="line">		<span class="keyword">return</span> bestMatch.getHandlerMethod();</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">else</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> handleNoMatch(<span class="built_in">this</span>.mappingRegistry.getRegistrations().keySet(), lookupPath, request);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>this.mappingRegistryï¼š</p>
<p><img src="/2023/02/28/SpringBoot2/Java\SpringBoot\SpringBoot2.assets\image-20221020212346713.png" alt="image-20221020212346713"></p>
<p><img src="/2023/02/28/SpringBoot2/Java\SpringBoot\SpringBoot2.assets\image-20221020212415533.png" alt="image-20221020212415533"></p>
<p>HandlerExecutionChain executionChain &#x3D; getHandlerExecutionChain(handler, request);</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Build a &#123;<span class="doctag">@link</span> HandlerExecutionChain&#125; for the given handler, including</span></span><br><span class="line"><span class="comment"> * applicable interceptors.</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;The default implementation builds a standard &#123;<span class="doctag">@link</span> HandlerExecutionChain&#125;</span></span><br><span class="line"><span class="comment"> * with the given handler, the common interceptors of the handler mapping, and any</span></span><br><span class="line"><span class="comment"> * &#123;<span class="doctag">@link</span> MappedInterceptor MappedInterceptors&#125; matching to the current request URL. Interceptors</span></span><br><span class="line"><span class="comment"> * are added in the order they were registered. Subclasses may override this</span></span><br><span class="line"><span class="comment"> * in order to extend/rearrange the list of interceptors.</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;&lt;b&gt;<span class="doctag">NOTE:</span>&lt;/b&gt; The passed-in handler object may be a raw handler or a</span></span><br><span class="line"><span class="comment"> * pre-built &#123;<span class="doctag">@link</span> HandlerExecutionChain&#125;. This method should handle those</span></span><br><span class="line"><span class="comment"> * two cases explicitly, either building a new &#123;<span class="doctag">@link</span> HandlerExecutionChain&#125;</span></span><br><span class="line"><span class="comment"> * or extending the existing chain.</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;For simply adding an interceptor in a custom subclass, consider calling</span></span><br><span class="line"><span class="comment"> * &#123;<span class="doctag">@code</span> super.getHandlerExecutionChain(handler, request)&#125; and invoking</span></span><br><span class="line"><span class="comment"> * &#123;<span class="doctag">@link</span> HandlerExecutionChain#addInterceptor&#125; on the returned chain object.</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> handler the resolved handler instance (never &#123;<span class="doctag">@code</span> null&#125;)</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> request current HTTP request</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> the HandlerExecutionChain (never &#123;<span class="doctag">@code</span> null&#125;)</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@see</span> #getAdaptedInterceptors()</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">protected</span> HandlerExecutionChain <span class="title function_">getHandlerExecutionChain</span><span class="params">(Object handler, HttpServletRequest request)</span> &#123;</span><br><span class="line">       <span class="comment">// ==========åˆ›å»ºæˆ–è·å–æ‹¦æˆªå™¨é“¾==========</span></span><br><span class="line">	<span class="type">HandlerExecutionChain</span> <span class="variable">chain</span> <span class="operator">=</span> (handler <span class="keyword">instanceof</span> HandlerExecutionChain ?</span><br><span class="line">			(HandlerExecutionChain) handler : <span class="keyword">new</span> <span class="title class_">HandlerExecutionChain</span>(handler));</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">for</span> (HandlerInterceptor interceptor : <span class="built_in">this</span>.adaptedInterceptors) &#123;</span><br><span class="line">		<span class="keyword">if</span> (interceptor <span class="keyword">instanceof</span> MappedInterceptor) &#123;</span><br><span class="line">			<span class="type">MappedInterceptor</span> <span class="variable">mappedInterceptor</span> <span class="operator">=</span> (MappedInterceptor) interceptor;</span><br><span class="line">			<span class="keyword">if</span> (mappedInterceptor.matches(request)) &#123;</span><br><span class="line">				chain.addInterceptor(mappedInterceptor.getInterceptor());</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">else</span> &#123;</span><br><span class="line">			chain.addInterceptor(interceptor);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> chain;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>this.adaptedInterceptorsï¼š</p>
<p><img src="/2023/02/28/SpringBoot2/Java\SpringBoot\SpringBoot2.assets\image-20221020213634619.png" alt="image-20221020213634619"></p>
<p>HandlerExecutionChainï¼šåŒ…æ‹¬äº†è¯·æ±‚çš„handleræ–¹æ³•å’Œæ‹¦æˆªå™¨ List<HandlerInterceptor> handlerInterceptorList</HandlerInterceptor></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">HandlerInterceptor</span> &#123;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * Interception point before the execution of a handler. Called after</span></span><br><span class="line"><span class="comment">	 * HandlerMapping determined an appropriate handler object, but before</span></span><br><span class="line"><span class="comment">	 * HandlerAdapter invokes the handler.</span></span><br><span class="line"><span class="comment">	 * &lt;p&gt;DispatcherServlet processes a handler in an execution chain, consisting</span></span><br><span class="line"><span class="comment">	 * of any number of interceptors, with the handler itself at the end.</span></span><br><span class="line"><span class="comment">	 * With this method, each interceptor can decide to abort the execution chain,</span></span><br><span class="line"><span class="comment">	 * typically sending an HTTP error or writing a custom response.</span></span><br><span class="line"><span class="comment">	 * &lt;p&gt;&lt;strong&gt;Note:&lt;/strong&gt; special considerations apply for asynchronous</span></span><br><span class="line"><span class="comment">	 * request processing. For more details see</span></span><br><span class="line"><span class="comment">	 * &#123;<span class="doctag">@link</span> org.springframework.web.servlet.AsyncHandlerInterceptor&#125;.</span></span><br><span class="line"><span class="comment">	 * &lt;p&gt;The default implementation returns &#123;<span class="doctag">@code</span> true&#125;.</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> request current HTTP request</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> response current HTTP response</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> handler chosen handler to execute, for type and/or instance evaluation</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@return</span> &#123;<span class="doctag">@code</span> true&#125; if the execution chain should proceed with the</span></span><br><span class="line"><span class="comment">	 * next interceptor or the handler itself. Else, DispatcherServlet assumes</span></span><br><span class="line"><span class="comment">	 * that this interceptor has already dealt with the response itself.</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@throws</span> Exception in case of errors</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">    <span class="comment">// ===========handleræ–¹æ³•æ‰§è¡Œä¹‹å‰æ‰§è¡Œè¯¥æ–¹æ³•================</span></span><br><span class="line">	<span class="keyword">default</span> <span class="type">boolean</span> <span class="title function_">preHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler)</span></span><br><span class="line">			<span class="keyword">throws</span> Exception &#123;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * Interception point after successful execution of a handler.</span></span><br><span class="line"><span class="comment">	 * Called after HandlerAdapter actually invoked the handler, but before the</span></span><br><span class="line"><span class="comment">	 * DispatcherServlet renders the view. Can expose additional model objects</span></span><br><span class="line"><span class="comment">	 * to the view via the given ModelAndView.</span></span><br><span class="line"><span class="comment">	 * &lt;p&gt;DispatcherServlet processes a handler in an execution chain, consisting</span></span><br><span class="line"><span class="comment">	 * of any number of interceptors, with the handler itself at the end.</span></span><br><span class="line"><span class="comment">	 * With this method, each interceptor can post-process an execution,</span></span><br><span class="line"><span class="comment">	 * getting applied in inverse order of the execution chain.</span></span><br><span class="line"><span class="comment">	 * &lt;p&gt;&lt;strong&gt;Note:&lt;/strong&gt; special considerations apply for asynchronous</span></span><br><span class="line"><span class="comment">	 * request processing. For more details see</span></span><br><span class="line"><span class="comment">	 * &#123;<span class="doctag">@link</span> org.springframework.web.servlet.AsyncHandlerInterceptor&#125;.</span></span><br><span class="line"><span class="comment">	 * &lt;p&gt;The default implementation is empty.</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> request current HTTP request</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> response current HTTP response</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> handler the handler (or &#123;<span class="doctag">@link</span> HandlerMethod&#125;) that started asynchronous</span></span><br><span class="line"><span class="comment">	 * execution, for type and/or instance examination</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> modelAndView the &#123;<span class="doctag">@code</span> ModelAndView&#125; that the handler returned</span></span><br><span class="line"><span class="comment">	 * (can also be &#123;<span class="doctag">@code</span> null&#125;)</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@throws</span> Exception in case of errors</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">    <span class="comment">// ===========handleræ–¹æ³•æ‰§è¡Œä¹‹åæ‰§è¡Œè¯¥æ–¹æ³•================</span></span><br><span class="line">	<span class="keyword">default</span> <span class="keyword">void</span> <span class="title function_">postHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler,</span></span><br><span class="line"><span class="params">			<span class="meta">@Nullable</span> ModelAndView modelAndView)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * Callback after completion of request processing, that is, after rendering</span></span><br><span class="line"><span class="comment">	 * the view. Will be called on any outcome of handler execution, thus allows</span></span><br><span class="line"><span class="comment">	 * for proper resource cleanup.</span></span><br><span class="line"><span class="comment">	 * &lt;p&gt;Note: Will only be called if this interceptor&#x27;s &#123;<span class="doctag">@code</span> preHandle&#125;</span></span><br><span class="line"><span class="comment">	 * method has successfully completed and returned &#123;<span class="doctag">@code</span> true&#125;!</span></span><br><span class="line"><span class="comment">	 * &lt;p&gt;As with the &#123;<span class="doctag">@code</span> postHandle&#125; method, the method will be invoked on each</span></span><br><span class="line"><span class="comment">	 * interceptor in the chain in reverse order, so the first interceptor will be</span></span><br><span class="line"><span class="comment">	 * the last to be invoked.</span></span><br><span class="line"><span class="comment">	 * &lt;p&gt;&lt;strong&gt;Note:&lt;/strong&gt; special considerations apply for asynchronous</span></span><br><span class="line"><span class="comment">	 * request processing. For more details see</span></span><br><span class="line"><span class="comment">	 * &#123;<span class="doctag">@link</span> org.springframework.web.servlet.AsyncHandlerInterceptor&#125;.</span></span><br><span class="line"><span class="comment">	 * &lt;p&gt;The default implementation is empty.</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> request current HTTP request</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> response current HTTP response</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> handler the handler (or &#123;<span class="doctag">@link</span> HandlerMethod&#125;) that started asynchronous</span></span><br><span class="line"><span class="comment">	 * execution, for type and/or instance examination</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> ex any exception thrown on handler execution, if any; this does not</span></span><br><span class="line"><span class="comment">	 * include exceptions that have been handled through an exception resolver</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@throws</span> Exception in case of errors</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">    <span class="comment">// ===========æ¸²æŸ“å®Œæˆè§†å›¾ï¼Œè¯·æ±‚å¤„ç†å®Œæˆåæ‰§è¡Œçš„å›è°ƒå‡½æ•°================</span></span><br><span class="line">	<span class="keyword">default</span> <span class="keyword">void</span> <span class="title function_">afterCompletion</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler,</span></span><br><span class="line"><span class="params">			<span class="meta">@Nullable</span> Exception ex)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>HandlerAdapter ha &#x3D; getHandlerAdapter(mappedHandler.getHandler());</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * Return the HandlerAdapter for this handler object.</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> handler the handler object to find an adapter for</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@throws</span> ServletException if no HandlerAdapter can be found for the handler. This is a fatal error.</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line"><span class="keyword">protected</span> HandlerAdapter <span class="title function_">getHandlerAdapter</span><span class="params">(Object handler)</span> <span class="keyword">throws</span> ServletException &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">this</span>.handlerAdapters != <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">for</span> (HandlerAdapter adapter : <span class="built_in">this</span>.handlerAdapters) &#123;</span><br><span class="line">            <span class="keyword">if</span> (adapter.supports(handler)) &#123;</span><br><span class="line">                <span class="keyword">return</span> adapter;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">ServletException</span>(<span class="string">&quot;No adapter for handler [&quot;</span> + handler +</span><br><span class="line">                               <span class="string">&quot;]: The DispatcherServlet configuration needs to include a HandlerAdapter that supports this handler&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>this.handlerAdaptersï¼š</p>
<p><img src="/2023/02/28/SpringBoot2/Java\SpringBoot\SpringBoot2.assets\image-20221020220013111.png" alt="image-20221020220013111"></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">HandlerAdapter</span> &#123;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * Given a handler instance, return whether this &#123;<span class="doctag">@code</span> HandlerAdapter&#125;</span></span><br><span class="line"><span class="comment">	 * can support it. Typical HandlerAdapters will base the decision on the handler</span></span><br><span class="line"><span class="comment">	 * type. HandlerAdapters will usually only support one handler type each.</span></span><br><span class="line"><span class="comment">	 * &lt;p&gt;A typical implementation:</span></span><br><span class="line"><span class="comment">	 * &lt;p&gt;&#123;<span class="doctag">@code</span></span></span><br><span class="line"><span class="comment">	 * return (handler instanceof MyHandler);</span></span><br><span class="line"><span class="comment">	 * &#125;</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> handler the handler object to check</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@return</span> whether this object can use the given handler</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="type">boolean</span> <span class="title function_">supports</span><span class="params">(Object handler)</span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * Use the given handler to handle this request.</span></span><br><span class="line"><span class="comment">	 * The workflow that is required may vary widely.</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> request current HTTP request</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> response current HTTP response</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> handler the handler to use. This object must have previously been passed</span></span><br><span class="line"><span class="comment">	 * to the &#123;<span class="doctag">@code</span> supports&#125; method of this interface, which must have</span></span><br><span class="line"><span class="comment">	 * returned &#123;<span class="doctag">@code</span> true&#125;.</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@return</span> a ModelAndView object with the name of the view and the required</span></span><br><span class="line"><span class="comment">	 * model data, or &#123;<span class="doctag">@code</span> null&#125; if the request has been handled directly</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@throws</span> Exception in case of errors</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="meta">@Nullable</span></span><br><span class="line">	ModelAndView <span class="title function_">handle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler)</span> <span class="keyword">throws</span> Exception;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * Same contract as for HttpServlet&#x27;s &#123;<span class="doctag">@code</span> getLastModified&#125; method.</span></span><br><span class="line"><span class="comment">	 * Can simply return -1 if there&#x27;s no support in the handler class.</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> request current HTTP request</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> handler the handler to use</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@return</span> the lastModified value for the given handler</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@deprecated</span> as of 5.3.9 along with</span></span><br><span class="line"><span class="comment">	 * &#123;<span class="doctag">@link</span> org.springframework.web.servlet.mvc.LastModified&#125;.</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="meta">@Deprecated</span></span><br><span class="line">	<span class="type">long</span> <span class="title function_">getLastModified</span><span class="params">(HttpServletRequest request, Object handler)</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>å¯¹äº RequestMappingHandlerAdapterï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="type">boolean</span> <span class="title function_">supports</span><span class="params">(Object handler)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> (handler <span class="keyword">instanceof</span> HandlerMethod &amp;&amp; supportsInternal((HandlerMethod) handler));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>!mappedHandler.applyPreHandle(processedRequest, response)ï¼šhandleræ‰§è¡Œä¹‹å‰æ‰§è¡Œçš„æ‹¦æˆªå™¨æ–¹æ³•ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * Apply preHandle methods of registered interceptors.</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@return</span> &#123;<span class="doctag">@code</span> true&#125; if the execution chain should proceed with the</span></span><br><span class="line"><span class="comment">	 * next interceptor or the handler itself. Else, DispatcherServlet assumes</span></span><br><span class="line"><span class="comment">	 * that this interceptor has already dealt with the response itself.</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line"><span class="type">boolean</span> <span class="title function_">applyPreHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="built_in">this</span>.interceptorList.size(); i++) &#123;</span><br><span class="line">        <span class="type">HandlerInterceptor</span> <span class="variable">interceptor</span> <span class="operator">=</span> <span class="built_in">this</span>.interceptorList.get(i);</span><br><span class="line">        <span class="keyword">if</span> (!interceptor.preHandle(request, response, <span class="built_in">this</span>.handler)) &#123;</span><br><span class="line">            triggerAfterCompletion(request, response, <span class="literal">null</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">this</span>.interceptorIndex = i;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>mv &#x3D; ha.handle(processedRequest, response, mappedHandler.getHandler());çœŸæ­£æ‰§è¡Œhandleræ–¹æ³•</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * This implementation expects the handler to be an &#123;<span class="doctag">@link</span> HandlerMethod&#125;.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="meta">@Nullable</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> ModelAndView <span class="title function_">handle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler)</span></span><br><span class="line">    <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    <span class="keyword">return</span> handleInternal(request, response, (HandlerMethod) handler);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">protected</span> ModelAndView <span class="title function_">handleInternal</span><span class="params">(HttpServletRequest request,</span></span><br><span class="line"><span class="params">                                      HttpServletResponse response, HandlerMethod handlerMethod)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">	<span class="comment">// ==========æ¨¡å‹è§†å›¾å¯¹è±¡===========</span></span><br><span class="line">    ModelAndView mav;</span><br><span class="line">    checkRequest(request);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Execute invokeHandlerMethod in synchronized block if required.</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">this</span>.synchronizeOnSession) &#123;</span><br><span class="line">        <span class="type">HttpSession</span> <span class="variable">session</span> <span class="operator">=</span> request.getSession(<span class="literal">false</span>);</span><br><span class="line">        <span class="keyword">if</span> (session != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="type">Object</span> <span class="variable">mutex</span> <span class="operator">=</span> WebUtils.getSessionMutex(session);</span><br><span class="line">            <span class="keyword">synchronized</span> (mutex) &#123;</span><br><span class="line">                mav = invokeHandlerMethod(request, response, handlerMethod);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// No HttpSession available -&gt; no mutex necessary</span></span><br><span class="line">            mav = invokeHandlerMethod(request, response, handlerMethod);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// No synchronization on session demanded at all...</span></span><br><span class="line">        mav = invokeHandlerMethod(request, response, handlerMethod);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!response.containsHeader(HEADER_CACHE_CONTROL)) &#123;</span><br><span class="line">        <span class="keyword">if</span> (getSessionAttributesHandler(handlerMethod).hasSessionAttributes()) &#123;</span><br><span class="line">            applyCacheSeconds(response, <span class="built_in">this</span>.cacheSecondsForSessionAttributeHandlers);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            prepareResponse(response);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> mav;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ModelAndView mav &#x3D; invokeHandlerMethod(request, response, handlerMethod); </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * Invoke the &#123;<span class="doctag">@link</span> RequestMapping&#125; handler method preparing a &#123;<span class="doctag">@link</span> ModelAndView&#125;</span></span><br><span class="line"><span class="comment">	 * if view resolution is required.</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@since</span> 4.2</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@see</span> #createInvocableHandlerMethod(HandlerMethod)</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line"><span class="meta">@Nullable</span></span><br><span class="line"><span class="keyword">protected</span> ModelAndView <span class="title function_">invokeHandlerMethod</span><span class="params">(HttpServletRequest request,</span></span><br><span class="line"><span class="params">                                           HttpServletResponse response, HandlerMethod handlerMethod)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line"></span><br><span class="line">    <span class="type">ServletWebRequest</span> <span class="variable">webRequest</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ServletWebRequest</span>(request, response);</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="type">WebDataBinderFactory</span> <span class="variable">binderFactory</span> <span class="operator">=</span> getDataBinderFactory(handlerMethod);</span><br><span class="line">        <span class="type">ModelFactory</span> <span class="variable">modelFactory</span> <span class="operator">=</span> getModelFactory(handlerMethod, binderFactory);</span><br><span class="line">		<span class="comment">// =======ServletInvocableHandlerMethod ... implements HandlerMethod</span></span><br><span class="line">        <span class="type">ServletInvocableHandlerMethod</span> <span class="variable">invocableMethod</span> <span class="operator">=</span> </span><br><span class="line">            createInvocableHandlerMethod(handlerMethod);</span><br><span class="line">        <span class="comment">// ===========è®¾ç½®å‚æ•°è§£æå™¨===========</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">this</span>.argumentResolvers != <span class="literal">null</span>) &#123;</span><br><span class="line">            invocableMethod.setHandlerMethodArgumentResolvers(<span class="built_in">this</span>.argumentResolvers);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// ===========è®¾ç½®è¿”å›å€¼å¤„ç†å™¨===========</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">this</span>.returnValueHandlers != <span class="literal">null</span>) &#123;</span><br><span class="line">            invocableMethod.setHandlerMethodReturnValueHandlers(<span class="built_in">this</span>.returnValueHandlers);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// ===========è®¾ç½®æ•°æ®ç»‘å®šå™¨ï¼Œå¦‚è‡ªå®šä¹‰å¯¹è±¡å°è£…å‚æ•°============</span></span><br><span class="line">        invocableMethod.setDataBinderFactory(binderFactory);</span><br><span class="line">        <span class="comment">// ===========è®¾ç½®å‚æ•°åçš„å¤„ç†============</span></span><br><span class="line">        invocableMethod.setParameterNameDiscoverer(<span class="built_in">this</span>.parameterNameDiscoverer);</span><br><span class="line">		<span class="comment">// ===========æ¨¡å‹è§†å›¾æ•°æ®å®¹å™¨============</span></span><br><span class="line">        <span class="type">ModelAndViewContainer</span> <span class="variable">mavContainer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ModelAndViewContainer</span>();</span><br><span class="line">        mavContainer.addAllAttributes(RequestContextUtils.getInputFlashMap(request));</span><br><span class="line">        <span class="comment">// ===========åˆå§‹åŒ–å·¥å‚============</span></span><br><span class="line">        modelFactory.initModel(webRequest, mavContainer, invocableMethod);</span><br><span class="line">        mavContainer.setIgnoreDefaultModelOnRedirect(<span class="built_in">this</span>.ignoreDefaultModelOnRedirect);</span><br><span class="line">		<span class="comment">// ===========å¼‚æ­¥è¯·æ±‚å¤„ç†============</span></span><br><span class="line">        <span class="type">AsyncWebRequest</span> <span class="variable">asyncWebRequest</span> <span class="operator">=</span> WebAsyncUtils.createAsyncWebRequest(request, response);</span><br><span class="line">        asyncWebRequest.setTimeout(<span class="built_in">this</span>.asyncRequestTimeout);</span><br><span class="line"></span><br><span class="line">        <span class="type">WebAsyncManager</span> <span class="variable">asyncManager</span> <span class="operator">=</span> WebAsyncUtils.getAsyncManager(request);</span><br><span class="line">        asyncManager.setTaskExecutor(<span class="built_in">this</span>.taskExecutor);</span><br><span class="line">        asyncManager.setAsyncWebRequest(asyncWebRequest);</span><br><span class="line">        asyncManager.registerCallableInterceptors(<span class="built_in">this</span>.callableInterceptors);</span><br><span class="line">        asyncManager.registerDeferredResultInterceptors(<span class="built_in">this</span>.deferredResultInterceptors);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (asyncManager.hasConcurrentResult()) &#123;</span><br><span class="line">            <span class="type">Object</span> <span class="variable">result</span> <span class="operator">=</span> asyncManager.getConcurrentResult();</span><br><span class="line">            mavContainer = (ModelAndViewContainer) asyncManager.getConcurrentResultContext()[<span class="number">0</span>];</span><br><span class="line">            asyncManager.clearConcurrentResult();</span><br><span class="line">            LogFormatUtils.traceDebug(logger, traceOn -&gt; &#123;</span><br><span class="line">                <span class="type">String</span> <span class="variable">formatted</span> <span class="operator">=</span> LogFormatUtils.formatValue(result, !traceOn);</span><br><span class="line">                <span class="keyword">return</span> <span class="string">&quot;Resume with async result [&quot;</span> + formatted + <span class="string">&quot;]&quot;</span>;</span><br><span class="line">            &#125;);</span><br><span class="line">            invocableMethod = invocableMethod.wrapConcurrentResult(result);</span><br><span class="line">        &#125;</span><br><span class="line">		<span class="comment">// ============æ‰§è¡Œè¯·æ±‚æ–¹æ³•==========</span></span><br><span class="line">        invocableMethod.invokeAndHandle(webRequest, mavContainer);</span><br><span class="line">        <span class="keyword">if</span> (asyncManager.isConcurrentHandlingStarted()) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">		<span class="comment">// ====================</span></span><br><span class="line">        <span class="keyword">return</span> getModelAndView(mavContainer, modelFactory, webRequest);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">finally</span> &#123;</span><br><span class="line">        webRequest.requestCompleted();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ServletInvocableHandlerMethod invocableMethodï¼š</p>
<p><img src="/2023/02/28/SpringBoot2/Java\SpringBoot\SpringBoot2.assets\image-20221020222317218.png" alt="image-20221020222317218"></p>
<p>this.argumentResolversï¼š</p>
<p><img src="/2023/02/28/SpringBoot2/Java\SpringBoot\SpringBoot2.assets\image-20221020222412605.png" alt="image-20221020222412605"></p>
<p>this.returnValueHandlersï¼š</p>
<p><img src="/2023/02/28/SpringBoot2/Java\SpringBoot\SpringBoot2.assets\image-20221020222451296.png" alt="image-20221020222451296"></p>
<p>ModelAndViewContainer mavContainer &#x3D; new ModelAndViewContainer();</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ModelAndViewContainer</span> &#123;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> <span class="type">boolean</span> <span class="variable">ignoreDefaultModelOnRedirect</span> <span class="operator">=</span> <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Nullable</span></span><br><span class="line">	<span class="keyword">private</span> Object view;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">final</span> <span class="type">ModelMap</span> <span class="variable">defaultModel</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BindingAwareModelMap</span>();</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Nullable</span></span><br><span class="line">	<span class="keyword">private</span> ModelMap redirectModel;</span><br><span class="line">	<span class="comment">// ================ModelMapæ—¢æ˜¯Modelä¹Ÿæ˜¯Map================</span></span><br><span class="line">    <span class="comment">// public class BindingAwareModelMap extends ExtendedModelMap &#123;</span></span><br><span class="line">	<span class="comment">// public class ExtendedModelMap extends ModelMap implements Model &#123;</span></span><br><span class="line">	<span class="comment">// public class ModelMap extends LinkedHashMap&lt;String, Object&gt; &#123;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>invocableMethod.invokeAndHandle(webRequest, mavContainer);</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * Invoke the method and handle the return value through one of the</span></span><br><span class="line"><span class="comment">	 * configured &#123;<span class="doctag">@link</span> HandlerMethodReturnValueHandler HandlerMethodReturnValueHandlers&#125;.</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> webRequest the current request</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> mavContainer the ModelAndViewContainer for this request</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> providedArgs &quot;given&quot; arguments matched by type (not resolved)</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">invokeAndHandle</span><span class="params">(ServletWebRequest webRequest, ModelAndViewContainer mavContainer,</span></span><br><span class="line"><span class="params">                            Object... providedArgs)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">	<span class="comment">// =============æ‰§è¡Œhandleræ–¹æ³•ï¼Œå¹¶è¿”å›å€¼==============</span></span><br><span class="line">    <span class="type">Object</span> <span class="variable">returnValue</span> <span class="operator">=</span> invokeForRequest(webRequest, mavContainer, providedArgs);</span><br><span class="line">    setResponseStatus(webRequest);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (returnValue == <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (isRequestNotModified(webRequest) || getResponseStatus() != <span class="literal">null</span> || mavContainer.isRequestHandled()) &#123;</span><br><span class="line">            disableContentCachingIfNecessary(webRequest);</span><br><span class="line">            mavContainer.setRequestHandled(<span class="literal">true</span>);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (StringUtils.hasText(getResponseStatusReason())) &#123;</span><br><span class="line">        mavContainer.setRequestHandled(<span class="literal">true</span>);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    mavContainer.setRequestHandled(<span class="literal">false</span>);</span><br><span class="line">    Assert.state(<span class="built_in">this</span>.returnValueHandlers != <span class="literal">null</span>, <span class="string">&quot;No return value handlers&quot;</span>);</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="comment">// ==============è¿”å›å€¼å¤„ç†å™¨å¯¹è¿”å›å€¼è¿›è¡Œå¤„ç†===============</span></span><br><span class="line">        <span class="built_in">this</span>.returnValueHandlers.handleReturnValue(</span><br><span class="line">            returnValue, getReturnValueType(returnValue), mavContainer, webRequest);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">catch</span> (Exception ex) &#123;</span><br><span class="line">        <span class="keyword">if</span> (logger.isTraceEnabled()) &#123;</span><br><span class="line">            logger.trace(formatErrorForReturnValue(returnValue), ex);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">throw</span> ex;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>invokeForRequest(webRequest, mavContainer, providedArgs);</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Nullable</span></span><br><span class="line"><span class="keyword">public</span> Object <span class="title function_">invokeForRequest</span><span class="params">(NativeWebRequest request, <span class="meta">@Nullable</span> ModelAndViewContainer mavContainer,</span></span><br><span class="line"><span class="params">                               Object... providedArgs)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">	<span class="comment">// =============è·å–æ–¹æ³•å‚æ•°çš„è¯¦ç»†ä¿¡æ¯ï¼Œæ³¨è§£ç­‰=============</span></span><br><span class="line">    Object[] args = getMethodArgumentValues(request, mavContainer, providedArgs);</span><br><span class="line">    <span class="keyword">if</span> (logger.isTraceEnabled()) &#123;</span><br><span class="line">        logger.trace(<span class="string">&quot;Arguments: &quot;</span> + Arrays.toString(args));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> doInvoke(args);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>getMethodArgumentValues(request, mavContainer, providedArgs);</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * Get the method argument values for the current request, checking the provided</span></span><br><span class="line"><span class="comment">	 * argument values and falling back to the configured argument resolvers.</span></span><br><span class="line"><span class="comment">	 * &lt;p&gt;The resulting array will be passed into &#123;<span class="doctag">@link</span> #doInvoke&#125;.</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@since</span> 5.1.2</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line"><span class="keyword">protected</span> Object[] getMethodArgumentValues(NativeWebRequest request, <span class="meta">@Nullable</span> ModelAndViewContainer mavContainer,Object... providedArgs) <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">	<span class="comment">// ===========è·å–å‚æ•°è¯¦ç»†ä¿¡æ¯============</span></span><br><span class="line">    MethodParameter[] parameters = getMethodParameters();</span><br><span class="line">    <span class="keyword">if</span> (ObjectUtils.isEmpty(parameters)) &#123;</span><br><span class="line">        <span class="keyword">return</span> EMPTY_ARGS;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    Object[] args = <span class="keyword">new</span> <span class="title class_">Object</span>[parameters.length];</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; parameters.length; i++) &#123;</span><br><span class="line">        <span class="type">MethodParameter</span> <span class="variable">parameter</span> <span class="operator">=</span> parameters[i];</span><br><span class="line">        parameter.initParameterNameDiscovery(<span class="built_in">this</span>.parameterNameDiscoverer);</span><br><span class="line">        args[i] = findProvidedArgument(parameter, providedArgs);</span><br><span class="line">        <span class="keyword">if</span> (args[i] != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (!<span class="built_in">this</span>.resolvers.supportsParameter(parameter)) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalStateException</span>(formatArgumentError(parameter, <span class="string">&quot;No suitable resolver&quot;</span>));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// ================ç”±å‚æ•°è§£æå¤„ç†å‚æ•°==================</span></span><br><span class="line">            args[i] = <span class="built_in">this</span>.resolvers.resolveArgument(parameter, mavContainer, request, <span class="built_in">this</span>.dataBinderFactory);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">catch</span> (Exception ex) &#123;</span><br><span class="line">            <span class="comment">// Leave stack trace for later, exception may actually be resolved and handled...</span></span><br><span class="line">            <span class="keyword">if</span> (logger.isDebugEnabled()) &#123;</span><br><span class="line">                <span class="type">String</span> <span class="variable">exMsg</span> <span class="operator">=</span> ex.getMessage();</span><br><span class="line">                <span class="keyword">if</span> (exMsg != <span class="literal">null</span> &amp;&amp; !exMsg.contains(parameter.getExecutable().toGenericString())) &#123;</span><br><span class="line">                    logger.debug(formatArgumentError(parameter, exMsg));</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">throw</span> ex;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> args;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>this.resolvers.resolveArgument(parameter, mavContainer, request, this.dataBinderFactory);</p>
<p>return doInvoke(args);åå°„æ‰§è¡Œæ–¹æ³•</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Invoke the handler method with the given argument values.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Nullable</span></span><br><span class="line"><span class="keyword">protected</span> Object <span class="title function_">doInvoke</span><span class="params">(Object... args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    <span class="type">Method</span> <span class="variable">method</span> <span class="operator">=</span> getBridgedMethod();</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (KotlinDetector.isSuspendingFunction(method)) &#123;</span><br><span class="line">            <span class="keyword">return</span> CoroutinesUtils.invokeSuspendingFunction(method, getBean(), args);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// =============æ‰§è¡Œæ–¹æ³•ï¼Œè¿”å›æ–¹æ³•å€¼==============</span></span><br><span class="line">        <span class="keyword">return</span> method.invoke(getBean(), args);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">catch</span> (IllegalArgumentException ex) &#123;</span><br><span class="line">        assertTargetBean(method, getBean(), args);</span><br><span class="line">        <span class="type">String</span> <span class="variable">text</span> <span class="operator">=</span> (ex.getMessage() != <span class="literal">null</span> ? ex.getMessage() : <span class="string">&quot;Illegal argument&quot;</span>);</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalStateException</span>(formatInvokeError(text, args), ex);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>this.returnValueHandlers.handleReturnValue(returnValue, getReturnValueType(returnValue), mavContainer, webRequest);</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * Iterate over registered &#123;<span class="doctag">@link</span> HandlerMethodReturnValueHandler HandlerMethodReturnValueHandlers&#125; and invoke the one that supports it.</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@throws</span> IllegalStateException if no suitable &#123;<span class="doctag">@link</span> HandlerMethodReturnValueHandler&#125; is found.</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">handleReturnValue</span><span class="params">(<span class="meta">@Nullable</span> Object returnValue, MethodParameter returnType,</span></span><br><span class="line"><span class="params">                              ModelAndViewContainer mavContainer, NativeWebRequest webRequest)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">	<span class="comment">// =============è¿­ä»£æ‰€æœ‰çš„è¿”å›å€¼å¤„ç†å™¨===============</span></span><br><span class="line">    <span class="type">HandlerMethodReturnValueHandler</span> <span class="variable">handler</span> <span class="operator">=</span> selectHandler(returnValue, returnType);</span><br><span class="line">    <span class="keyword">if</span> (handler == <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalArgumentException</span>(<span class="string">&quot;Unknown return value type: &quot;</span> + returnType.getParameterType().getName());</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// =============å¤„ç†è¿”å›å€¼============</span></span><br><span class="line">    handler.handleReturnValue(returnValue, returnType, mavContainer, webRequest);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>HandlerMethodReturnValueHandler handler &#x3D; selectHandler(returnValue, returnType);</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Nullable</span></span><br><span class="line"><span class="keyword">private</span> HandlerMethodReturnValueHandler <span class="title function_">selectHandler</span><span class="params">(<span class="meta">@Nullable</span> Object value, MethodParameter returnType)</span> &#123;</span><br><span class="line">    <span class="type">boolean</span> <span class="variable">isAsyncValue</span> <span class="operator">=</span> isAsyncReturnValue(value, returnType);</span><br><span class="line">    <span class="keyword">for</span> (HandlerMethodReturnValueHandler handler : <span class="built_in">this</span>.returnValueHandlers) &#123;</span><br><span class="line">        <span class="keyword">if</span> (isAsyncValue &amp;&amp; !(handler <span class="keyword">instanceof</span> AsyncHandlerMethodReturnValueHandler)) &#123;</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (handler.supportsReturnType(returnType)) &#123;</span><br><span class="line">            <span class="keyword">return</span> handler;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¯¹äºhandlerï¼šRequestResponseBodyMethodProcessorï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">handleReturnValue</span><span class="params">(<span class="meta">@Nullable</span> Object returnValue, MethodParameter returnType,</span></span><br><span class="line"><span class="params">                              ModelAndViewContainer mavContainer, NativeWebRequest webRequest)</span></span><br><span class="line">    <span class="keyword">throws</span> IOException, HttpMediaTypeNotAcceptableException, HttpMessageNotWritableException &#123;</span><br><span class="line"></span><br><span class="line">    mavContainer.setRequestHandled(<span class="literal">true</span>);</span><br><span class="line">    <span class="type">ServletServerHttpRequest</span> <span class="variable">inputMessage</span> <span class="operator">=</span> createInputMessage(webRequest);</span><br><span class="line">    <span class="type">ServletServerHttpResponse</span> <span class="variable">outputMessage</span> <span class="operator">=</span> createOutputMessage(webRequest);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Try even with null return value. ResponseBodyAdvice could get involved.</span></span><br><span class="line">    writeWithMessageConverters(returnValue, returnType, inputMessage, outputMessage);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>a</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * Writes the given return type to the given output message.</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> value the value to write to the output message</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> returnType the type of the value</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> inputMessage the input messages. Used to inspect the &#123;<span class="doctag">@code</span> Accept&#125; header.</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> outputMessage the output message to write to</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@throws</span> IOException thrown in case of I/O errors</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@throws</span> HttpMediaTypeNotAcceptableException thrown when the conditions indicated</span></span><br><span class="line"><span class="comment">	 * by the &#123;<span class="doctag">@code</span> Accept&#125; header on the request cannot be met by the message converters</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@throws</span> HttpMessageNotWritableException thrown if a given message cannot</span></span><br><span class="line"><span class="comment">	 * be written by a converter, or if the content-type chosen by the server</span></span><br><span class="line"><span class="comment">	 * has no compatible converter.</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line"><span class="meta">@SuppressWarnings(&#123;&quot;rawtypes&quot;, &quot;unchecked&quot;&#125;)</span></span><br><span class="line"><span class="keyword">protected</span> &lt;T&gt; <span class="keyword">void</span> <span class="title function_">writeWithMessageConverters</span><span class="params">(<span class="meta">@Nullable</span> T value, MethodParameter returnType, ServletServerHttpRequest inputMessage, ServletServerHttpResponse outputMessage)</span></span><br><span class="line">    <span class="keyword">throws</span> IOException, HttpMediaTypeNotAcceptableException, HttpMessageNotWritableException &#123;</span><br><span class="line"></span><br><span class="line">    Object body;</span><br><span class="line">    Class&lt;?&gt; valueType;</span><br><span class="line">    Type targetType;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (value <span class="keyword">instanceof</span> CharSequence) &#123;</span><br><span class="line">        body = value.toString();</span><br><span class="line">        valueType = String.class;</span><br><span class="line">        targetType = String.class;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        body = value;</span><br><span class="line">        valueType = getReturnValueType(body, returnType);</span><br><span class="line">        targetType = GenericTypeResolver.resolveType(getGenericType(returnType), </span><br><span class="line">                                                     returnType.getContainingClass());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (isResourceType(value, returnType)) &#123;</span><br><span class="line">        outputMessage.getHeaders().set(HttpHeaders.ACCEPT_RANGES, <span class="string">&quot;bytes&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span> (value != <span class="literal">null</span> &amp;&amp; inputMessage.getHeaders().getFirst(HttpHeaders.RANGE) != <span class="literal">null</span> &amp;&amp; outputMessage.getServletResponse().getStatus() == <span class="number">200</span>) &#123;</span><br><span class="line">            <span class="type">Resource</span> <span class="variable">resource</span> <span class="operator">=</span> (Resource) value;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                List&lt;HttpRange&gt; httpRanges = inputMessage.getHeaders().getRange();</span><br><span class="line">                outputMessage.getServletResponse().setStatus(HttpStatus.PARTIAL_CONTENT.value());</span><br><span class="line">                body = HttpRange.toResourceRegions(httpRanges, resource);</span><br><span class="line">                valueType = body.getClass();</span><br><span class="line">                targetType = RESOURCE_REGION_LIST_TYPE;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">catch</span> (IllegalArgumentException ex) &#123;</span><br><span class="line">                outputMessage.getHeaders().set(HttpHeaders.CONTENT_RANGE, <span class="string">&quot;bytes */&quot;</span> + resource.contentLength());</span><br><span class="line">                outputMessage.getServletResponse().setStatus(HttpStatus.REQUESTED_RANGE_NOT_SATISFIABLE.value());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">	<span class="comment">// =================åª’ä½“åå•†================</span></span><br><span class="line">    <span class="type">MediaType</span> <span class="variable">selectedMediaType</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">    <span class="type">MediaType</span> <span class="variable">contentType</span> <span class="operator">=</span> outputMessage.getHeaders().getContentType();</span><br><span class="line">    <span class="type">boolean</span> <span class="variable">isContentTypePreset</span> <span class="operator">=</span> contentType != <span class="literal">null</span> &amp;&amp; contentType.isConcrete();</span><br><span class="line">    <span class="keyword">if</span> (isContentTypePreset) &#123;</span><br><span class="line">        <span class="keyword">if</span> (logger.isDebugEnabled()) &#123;</span><br><span class="line">            logger.debug(<span class="string">&quot;Found &#x27;Content-Type:&quot;</span> + contentType + <span class="string">&quot;&#x27; in response&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        selectedMediaType = contentType;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="type">HttpServletRequest</span> <span class="variable">request</span> <span class="operator">=</span> inputMessage.getServletRequest();</span><br><span class="line">        List&lt;MediaType&gt; acceptableTypes;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// =============å®¢æˆ·ç«¯æµè§ˆå™¨æ¥å—çš„åª’ä½“ç±»å‹=============</span></span><br><span class="line">            acceptableTypes = getAcceptableMediaTypes(request);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">catch</span> (HttpMediaTypeNotAcceptableException ex) &#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">series</span> <span class="operator">=</span> outputMessage.getServletResponse().getStatus() / <span class="number">100</span>;</span><br><span class="line">            <span class="keyword">if</span> (body == <span class="literal">null</span> || series == <span class="number">4</span> || series == <span class="number">5</span>) &#123;</span><br><span class="line">                <span class="keyword">if</span> (logger.isDebugEnabled()) &#123;</span><br><span class="line">                    logger.debug(<span class="string">&quot;Ignoring error response content (if any). &quot;</span> + ex);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">throw</span> ex;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// ===============æœåŠ¡å™¨ç«¯èƒ½äº§ç”Ÿçš„åª’ä½“ç±»å‹===============</span></span><br><span class="line">        List&lt;MediaType&gt; producibleTypes = getProducibleMediaTypes(request, valueType, targetType);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (body != <span class="literal">null</span> &amp;&amp; producibleTypes.isEmpty()) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">HttpMessageNotWritableException</span>(</span><br><span class="line">                <span class="string">&quot;No converter found for return value of type: &quot;</span> + valueType);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// ==============å…¼å®¹å®¢æˆ·ç«¯çš„åª’ä½“ç±»å‹=============</span></span><br><span class="line">        List&lt;MediaType&gt; mediaTypesToUse = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        <span class="keyword">for</span> (MediaType requestedType : acceptableTypes) &#123;</span><br><span class="line">            <span class="keyword">for</span> (MediaType producibleType : producibleTypes) &#123;</span><br><span class="line">                <span class="keyword">if</span> (requestedType.isCompatibleWith(producibleType)) &#123;</span><br><span class="line">                    mediaTypesToUse.add(getMostSpecificMediaType(requestedType, producibleType));</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (mediaTypesToUse.isEmpty()) &#123;</span><br><span class="line">            <span class="keyword">if</span> (logger.isDebugEnabled()) &#123;</span><br><span class="line">                logger.debug(<span class="string">&quot;No match for &quot;</span> + acceptableTypes + <span class="string">&quot;, supported: &quot;</span> + producibleTypes);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (body != <span class="literal">null</span>) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">HttpMediaTypeNotAcceptableException</span>(producibleTypes);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">		<span class="comment">// ==========åª’ä½“ç±»å‹æŒ‰ç…§æƒé‡æ’åº=============</span></span><br><span class="line">        MediaType.sortBySpecificityAndQuality(mediaTypesToUse);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (MediaType mediaType : mediaTypesToUse) &#123;</span><br><span class="line">            <span class="keyword">if</span> (mediaType.isConcrete()) &#123;</span><br><span class="line">                selectedMediaType = mediaType;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (mediaType.isPresentIn(ALL_APPLICATION_MEDIA_TYPES)) &#123;</span><br><span class="line">                selectedMediaType = MediaType.APPLICATION_OCTET_STREAM;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (logger.isDebugEnabled()) &#123;</span><br><span class="line">            logger.debug(<span class="string">&quot;Using &#x27;&quot;</span> + selectedMediaType + <span class="string">&quot;&#x27;, given &quot;</span> +</span><br><span class="line">                         acceptableTypes + <span class="string">&quot; and supported &quot;</span> + producibleTypes);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (selectedMediaType != <span class="literal">null</span>) &#123;</span><br><span class="line">        selectedMediaType = selectedMediaType.removeQualityValue();</span><br><span class="line">        <span class="comment">// ==============éå†è½¬æ¢å™¨ï¼Œå°†ç»“æœè½¬æ¢ä¸ºæ¥æ”¶ç±»å‹==============</span></span><br><span class="line">        <span class="keyword">for</span> (HttpMessageConverter&lt;?&gt; converter : <span class="built_in">this</span>.messageConverters) &#123;</span><br><span class="line">            <span class="type">GenericHttpMessageConverter</span> <span class="variable">genericConverter</span> <span class="operator">=</span> (converter <span class="keyword">instanceof</span> GenericHttpMessageConverter ?</span><br><span class="line">                                                            (GenericHttpMessageConverter&lt;?&gt;) converter : <span class="literal">null</span>);</span><br><span class="line">            <span class="keyword">if</span> (genericConverter != <span class="literal">null</span> ?</span><br><span class="line">                ((GenericHttpMessageConverter) converter).canWrite(targetType, valueType, selectedMediaType) :</span><br><span class="line">                converter.canWrite(valueType, selectedMediaType)) &#123;</span><br><span class="line">                body = getAdvice().beforeBodyWrite(body, returnType, selectedMediaType,</span><br><span class="line">(Class&lt;? <span class="keyword">extends</span> <span class="title class_">HttpMessageConverter</span>&lt;?&gt;&gt;) converter.getClass(),inputMessage, outputMessage);</span><br><span class="line">                <span class="keyword">if</span> (body != <span class="literal">null</span>) &#123;</span><br><span class="line">                    <span class="type">Object</span> <span class="variable">theBody</span> <span class="operator">=</span> body;</span><br><span class="line">                    LogFormatUtils.traceDebug(logger, traceOn -&gt;</span><br><span class="line">                                              <span class="string">&quot;Writing [&quot;</span> + LogFormatUtils.formatValue(theBody, !traceOn) + <span class="string">&quot;]&quot;</span>);</span><br><span class="line">                    addContentDispositionHeader(inputMessage, outputMessage);</span><br><span class="line">                    <span class="keyword">if</span> (genericConverter != <span class="literal">null</span>) &#123;</span><br><span class="line">                        genericConverter.write(body, targetType, selectedMediaType, </span><br><span class="line">                                               outputMessage);</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">else</span> &#123;</span><br><span class="line">                        ((HttpMessageConverter) converter).write(body, selectedMediaType,</span><br><span class="line">                                                                 outputMessage);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="keyword">if</span> (logger.isDebugEnabled()) &#123;</span><br><span class="line">                        logger.debug(<span class="string">&quot;Nothing to write: null body&quot;</span>);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (body != <span class="literal">null</span>) &#123;</span><br><span class="line">        Set&lt;MediaType&gt; producibleMediaTypes =</span><br><span class="line">            (Set&lt;MediaType&gt;) inputMessage.getServletRequest()</span><br><span class="line">            .getAttribute(HandlerMapping.PRODUCIBLE_MEDIA_TYPES_ATTRIBUTE);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (isContentTypePreset || !CollectionUtils.isEmpty(producibleMediaTypes)) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">HttpMessageNotWritableException</span>(</span><br><span class="line">                <span class="string">&quot;No converter for [&quot;</span> + valueType + <span class="string">&quot;] with preset Content-Type &#x27;&quot;</span> + contentType + <span class="string">&quot;&#x27;&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">HttpMediaTypeNotAcceptableException</span>(getSupportedMediaTypes(body.getClass()));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>List<MediaType> acceptableTypes;	producibleTypesï¼›</MediaType></p>
<p><img src="/2023/02/28/SpringBoot2/Java\SpringBoot\SpringBoot2.assets\image-20221021120403924.png" alt="image-20221021120403924"></p>
<p> <strong>this.messageConvertersï¼š</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Strategy interface for converting from and to HTTP requests and responses.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Arjen Poutsma</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Juergen Hoeller</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Rossen Stoyanchev</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> 3.0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &lt;T&gt; the converted object type</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">HttpMessageConverter</span>&lt;T&gt; &#123;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * Indicates whether the given class can be read by this converter.</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> clazz the class to test for readability</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> mediaType the media type to read (can be &#123;<span class="doctag">@code</span> null&#125; if not specified);</span></span><br><span class="line"><span class="comment">	 * typically the value of a &#123;<span class="doctag">@code</span> Content-Type&#125; header.</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@return</span> &#123;<span class="doctag">@code</span> true&#125; if readable; &#123;<span class="doctag">@code</span> false&#125; otherwise</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="type">boolean</span> <span class="title function_">canRead</span><span class="params">(Class&lt;?&gt; clazz, <span class="meta">@Nullable</span> MediaType mediaType)</span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * Indicates whether the given class can be written by this converter.</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> clazz the class to test for writability</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> mediaType the media type to write (can be &#123;<span class="doctag">@code</span> null&#125; if not specified);</span></span><br><span class="line"><span class="comment">	 * typically the value of an &#123;<span class="doctag">@code</span> Accept&#125; header.</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@return</span> &#123;<span class="doctag">@code</span> true&#125; if writable; &#123;<span class="doctag">@code</span> false&#125; otherwise</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="type">boolean</span> <span class="title function_">canWrite</span><span class="params">(Class&lt;?&gt; clazz, <span class="meta">@Nullable</span> MediaType mediaType)</span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * Return the list of media types supported by this converter. The list may</span></span><br><span class="line"><span class="comment">	 * not apply to every possible target element type and calls to this method</span></span><br><span class="line"><span class="comment">	 * should typically be guarded via &#123;<span class="doctag">@link</span> #canWrite(Class, MediaType)</span></span><br><span class="line"><span class="comment">	 * canWrite(clazz, null&#125;. The list may also exclude MIME types supported</span></span><br><span class="line"><span class="comment">	 * only for a specific class. Alternatively, use</span></span><br><span class="line"><span class="comment">	 * &#123;<span class="doctag">@link</span> #getSupportedMediaTypes(Class)&#125; for a more precise list.</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@return</span> the list of supported media types</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	List&lt;MediaType&gt; <span class="title function_">getSupportedMediaTypes</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * Return the list of media types supported by this converter for the given</span></span><br><span class="line"><span class="comment">	 * class. The list may differ from &#123;<span class="doctag">@link</span> #getSupportedMediaTypes()&#125; if the</span></span><br><span class="line"><span class="comment">	 * converter does not support the given Class or if it supports it only for</span></span><br><span class="line"><span class="comment">	 * a subset of media types.</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> clazz the type of class to check</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@return</span> the list of media types supported for the given class</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@since</span> 5.3.4</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">default</span> List&lt;MediaType&gt; <span class="title function_">getSupportedMediaTypes</span><span class="params">(Class&lt;?&gt; clazz)</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> (canRead(clazz, <span class="literal">null</span>) || canWrite(clazz, <span class="literal">null</span>) ?</span><br><span class="line">				getSupportedMediaTypes() : Collections.emptyList());</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * Read an object of the given type from the given input message, and returns it.</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> clazz the type of object to return. This type must have previously been passed to the</span></span><br><span class="line"><span class="comment">	 * &#123;<span class="doctag">@link</span> #canRead canRead&#125; method of this interface, which must have returned &#123;<span class="doctag">@code</span> true&#125;.</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> inputMessage the HTTP input message to read from</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@return</span> the converted object</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@throws</span> IOException in case of I/O errors</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@throws</span> HttpMessageNotReadableException in case of conversion errors</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	T <span class="title function_">read</span><span class="params">(Class&lt;? extends T&gt; clazz, HttpInputMessage inputMessage)</span></span><br><span class="line">			<span class="keyword">throws</span> IOException, HttpMessageNotReadableException;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * Write a given object to the given output message.</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> t the object to write to the output message. The type of this object must have previously been</span></span><br><span class="line"><span class="comment">	 * passed to the &#123;<span class="doctag">@link</span> #canWrite canWrite&#125; method of this interface, which must have returned &#123;<span class="doctag">@code</span> true&#125;.</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> contentType the content type to use when writing. May be &#123;<span class="doctag">@code</span> null&#125; to indicate that the</span></span><br><span class="line"><span class="comment">	 * default content type of the converter must be used. If not &#123;<span class="doctag">@code</span> null&#125;, this media type must have</span></span><br><span class="line"><span class="comment">	 * previously been passed to the &#123;<span class="doctag">@link</span> #canWrite canWrite&#125; method of this interface, which must have</span></span><br><span class="line"><span class="comment">	 * returned &#123;<span class="doctag">@code</span> true&#125;.</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> outputMessage the message to write to</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@throws</span> IOException in case of I/O errors</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@throws</span> HttpMessageNotWritableException in case of conversion errors</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">void</span> <span class="title function_">write</span><span class="params">(T t, <span class="meta">@Nullable</span> MediaType contentType, HttpOutputMessage outputMessage)</span></span><br><span class="line">			<span class="keyword">throws</span> IOException, HttpMessageNotWritableException;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>writeæ–¹æ³•ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * This implementation sets the default headers by calling &#123;<span class="doctag">@link</span> #addDefaultHeaders&#125;,</span></span><br><span class="line"><span class="comment">	 * and then calls &#123;<span class="doctag">@link</span> #writeInternal&#125;.</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title function_">write</span><span class="params">(<span class="keyword">final</span> T t, <span class="meta">@Nullable</span> MediaType contentType, HttpOutputMessage outputMessage)</span></span><br><span class="line">    <span class="keyword">throws</span> IOException, HttpMessageNotWritableException &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">final</span> <span class="type">HttpHeaders</span> <span class="variable">headers</span> <span class="operator">=</span> outputMessage.getHeaders();</span><br><span class="line">    addDefaultHeaders(headers, t, contentType);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (outputMessage <span class="keyword">instanceof</span> StreamingHttpOutputMessage) &#123;</span><br><span class="line">        <span class="type">StreamingHttpOutputMessage</span> <span class="variable">streamingOutputMessage</span> <span class="operator">=</span> (StreamingHttpOutputMessage) outputMessage;</span><br><span class="line">        streamingOutputMessage.setBody(outputStream -&gt; writeInternal(t, <span class="keyword">new</span> <span class="title class_">HttpOutputMessage</span>() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> OutputStream <span class="title function_">getBody</span><span class="params">()</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> outputStream;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> HttpHeaders <span class="title function_">getHeaders</span><span class="params">()</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> headers;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        writeInternal(t, outputMessage);</span><br><span class="line">        outputMessage.getBody().flush();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>return getModelAndView(mavContainer, modelFactory, webRequest);</p>
<p>handleræ–¹æ³•æ‰§è¡Œå®Œæˆï¼Œè¿”å›æ•°æ®è§†å›¾ ModelAndViewã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Nullable</span></span><br><span class="line"><span class="keyword">private</span> ModelAndView <span class="title function_">getModelAndView</span><span class="params">(ModelAndViewContainer mavContainer,</span></span><br><span class="line"><span class="params">                                     ModelFactory modelFactory, NativeWebRequest webRequest)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line"></span><br><span class="line">    modelFactory.updateModel(webRequest, mavContainer);</span><br><span class="line">    <span class="keyword">if</span> (mavContainer.isRequestHandled()) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">ModelMap</span> <span class="variable">model</span> <span class="operator">=</span> mavContainer.getModel();</span><br><span class="line">    <span class="type">ModelAndView</span> <span class="variable">mav</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ModelAndView</span>(mavContainer.getViewName(), model, </span><br><span class="line">                                        mavContainer.getStatus());</span><br><span class="line">    <span class="keyword">if</span> (!mavContainer.isViewReference()) &#123;</span><br><span class="line">        mav.setView((View) mavContainer.getView());</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (model <span class="keyword">instanceof</span> RedirectAttributes) &#123;</span><br><span class="line">        Map&lt;String, ?&gt; flashAttributes = ((RedirectAttributes) model).getFlashAttributes();</span><br><span class="line">        <span class="type">HttpServletRequest</span> <span class="variable">request</span> <span class="operator">=</span> webRequest.getNativeRequest(HttpServletRequest.class);</span><br><span class="line">        <span class="keyword">if</span> (request != <span class="literal">null</span>) &#123;</span><br><span class="line">            RequestContextUtils.getOutputFlashMap(request).putAll(flashAttributes);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> mav;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>modelFactory.updateModel(webRequest, mavContainer);</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * Promote model attributes listed as &#123;<span class="doctag">@code</span> <span class="doctag">@SessionAttributes</span>&#125; to the session.</span></span><br><span class="line"><span class="comment">	 * Add &#123;<span class="doctag">@link</span> BindingResult&#125; attributes where necessary.</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> request the current request</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> container contains the model to update</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@throws</span> Exception if creating BindingResult attributes fails</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">updateModel</span><span class="params">(NativeWebRequest request, ModelAndViewContainer container)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    <span class="type">ModelMap</span> <span class="variable">defaultModel</span> <span class="operator">=</span> container.getDefaultModel();</span><br><span class="line">    <span class="keyword">if</span> (container.getSessionStatus().isComplete())&#123;</span><br><span class="line">        <span class="built_in">this</span>.sessionAttributesHandler.cleanupAttributes(request);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.sessionAttributesHandler.storeAttributes(request, defaultModel);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (!container.isRequestHandled() &amp;&amp; container.getModel() == defaultModel) &#123;</span><br><span class="line">        updateBindingResult(request, defaultModel);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ­¤æ—¶ mv &#x3D; ha.handle(processedRequest, response, mappedHandler.getHandler());æ‰§è¡Œå®Œæˆã€‚</p>
<p>mappedHandler.applyPostHandle(processedRequest, response, mv); æ‹¦æˆªå™¨åç½®æ–¹æ³•æ‰§è¡Œã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">void</span> <span class="title function_">applyPostHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, <span class="meta">@Nullable</span> ModelAndView mv)</span></span><br><span class="line">    <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="built_in">this</span>.interceptorList.size() - <span class="number">1</span>; i &gt;= <span class="number">0</span>; i--) &#123;</span><br><span class="line">        <span class="type">HandlerInterceptor</span> <span class="variable">interceptor</span> <span class="operator">=</span> <span class="built_in">this</span>.interceptorList.get(i);</span><br><span class="line">        interceptor.postHandle(request, response, <span class="built_in">this</span>.handler, mv);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>processDispatchResult(processedRequest, response, mappedHandler, mv, dispatchException);å¤„ç†è¯·æ±‚æ´¾å‘ç»“æœã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * Handle the result of handler selection and handler invocation, which is</span></span><br><span class="line"><span class="comment">	 * either a ModelAndView or an Exception to be resolved to a ModelAndView.</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">processDispatchResult</span><span class="params">(HttpServletRequest request, HttpServletResponse response,</span></span><br><span class="line"><span class="params">                                   <span class="meta">@Nullable</span> HandlerExecutionChain mappedHandler, </span></span><br><span class="line"><span class="params">                                   <span class="meta">@Nullable</span> ModelAndView mv,</span></span><br><span class="line"><span class="params">                                   <span class="meta">@Nullable</span> Exception exception)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line"></span><br><span class="line">    <span class="type">boolean</span> <span class="variable">errorView</span> <span class="operator">=</span> <span class="literal">false</span>;</span><br><span class="line">	<span class="comment">// ========å¤„ç†å¼‚å¸¸========</span></span><br><span class="line">    <span class="keyword">if</span> (exception != <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (exception <span class="keyword">instanceof</span> ModelAndViewDefiningException) &#123;</span><br><span class="line">            logger.debug(<span class="string">&quot;ModelAndViewDefiningException encountered&quot;</span>, exception);</span><br><span class="line">            mv = ((ModelAndViewDefiningException) exception).getModelAndView();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="type">Object</span> <span class="variable">handler</span> <span class="operator">=</span> (mappedHandler != <span class="literal">null</span> ? mappedHandler.getHandler() : <span class="literal">null</span>);</span><br><span class="line">            mv = processHandlerException(request, response, handler, exception);</span><br><span class="line">            errorView = (mv != <span class="literal">null</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Did the handler return a view to render?</span></span><br><span class="line">    <span class="keyword">if</span> (mv != <span class="literal">null</span> &amp;&amp; !mv.wasCleared()) &#123;</span><br><span class="line">        <span class="comment">// ===========æ¸²æŸ“è§†å›¾============</span></span><br><span class="line">        render(mv, request, response);</span><br><span class="line">        <span class="keyword">if</span> (errorView) &#123;</span><br><span class="line">            WebUtils.clearErrorRequestAttributes(request);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (logger.isTraceEnabled()) &#123;</span><br><span class="line">            logger.trace(<span class="string">&quot;No view rendering, null ModelAndView returned.&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (WebAsyncUtils.getAsyncManager(request).isConcurrentHandlingStarted()) &#123;</span><br><span class="line">        <span class="comment">// Concurrent handling started during a forward</span></span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (mappedHandler != <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="comment">// Exception (if any) is already handled..</span></span><br><span class="line">        <span class="comment">// è§†å›¾æ¸²æŸ“å®Œæˆæ‰§è¡Œhandleråç½®æ–¹æ³•</span></span><br><span class="line">        mappedHandler.triggerAfterCompletion(request, response, <span class="literal">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è§†å›¾æ¸²æŸ“ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * Render the given ModelAndView.</span></span><br><span class="line"><span class="comment">	 * &lt;p&gt;This is the last stage in handling a request. It may involve resolving the view by name.</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> mv the ModelAndView to render</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> request current HTTP servlet request</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> response current HTTP servlet response</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@throws</span> ServletException if view is missing or cannot be resolved</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@throws</span> Exception if there&#x27;s a problem rendering the view</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">render</span><span class="params">(ModelAndView mv, HttpServletRequest request, </span></span><br><span class="line"><span class="params">                      HttpServletResponse response)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    <span class="comment">// Determine locale for request and apply it to the response.</span></span><br><span class="line">    <span class="type">Locale</span> <span class="variable">locale</span> <span class="operator">=</span></span><br><span class="line">        (<span class="built_in">this</span>.localeResolver != <span class="literal">null</span> ? <span class="built_in">this</span>.localeResolver.resolveLocale(request) : request.getLocale());</span><br><span class="line">    response.setLocale(locale);</span><br><span class="line"></span><br><span class="line">    View view;</span><br><span class="line">    <span class="type">String</span> <span class="variable">viewName</span> <span class="operator">=</span> mv.getViewName();</span><br><span class="line">    <span class="keyword">if</span> (viewName != <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="comment">// We need to resolve the view name.</span></span><br><span class="line">        <span class="comment">// ==============å¤„ç†è§†å›¾åç§°ï¼šå¾—åˆ°è§†å›¾è§£æå™¨=============</span></span><br><span class="line">        view = resolveViewName(viewName, mv.getModelInternal(), locale, request);</span><br><span class="line">        <span class="keyword">if</span> (view == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">ServletException</span>(<span class="string">&quot;Could not resolve view with name &#x27;&quot;</span> + mv.getViewName() + <span class="string">&quot;&#x27; in servlet with name &#x27;&quot;</span> + getServletName() + <span class="string">&quot;&#x27;&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// No need to lookup: the ModelAndView object contains the actual View object.</span></span><br><span class="line">        view = mv.getView();</span><br><span class="line">        <span class="keyword">if</span> (view == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">ServletException</span>(<span class="string">&quot;ModelAndView [&quot;</span> + mv + <span class="string">&quot;] neither contains a view name nor a &quot;</span> +</span><br><span class="line">                                       <span class="string">&quot;View object in servlet with name &#x27;&quot;</span> + getServletName() + <span class="string">&quot;&#x27;&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Delegate to the View object for rendering.</span></span><br><span class="line">    <span class="keyword">if</span> (logger.isTraceEnabled()) &#123;</span><br><span class="line">        logger.trace(<span class="string">&quot;Rendering view [&quot;</span> + view + <span class="string">&quot;] &quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (mv.getStatus() != <span class="literal">null</span>) &#123;</span><br><span class="line">            request.setAttribute(View.RESPONSE_STATUS_ATTRIBUTE, mv.getStatus());</span><br><span class="line">            response.setStatus(mv.getStatus().value());</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// =========è§†å›¾è§£æå™¨æ¸²æŸ“è§†å›¾==========</span></span><br><span class="line">        view.render(mv.getModelInternal(), request, response);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">catch</span> (Exception ex) &#123;</span><br><span class="line">        <span class="keyword">if</span> (logger.isDebugEnabled()) &#123;</span><br><span class="line">            logger.debug(<span class="string">&quot;Error rendering view [&quot;</span> + view + <span class="string">&quot;]&quot;</span>, ex);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">throw</span> ex;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>































































<h1 id="æ•°æ®è®¿é—®"><a href="#æ•°æ®è®¿é—®" class="headerlink" title="æ•°æ®è®¿é—®"></a>æ•°æ®è®¿é—®</h1><h2 id="SQL"><a href="#SQL" class="headerlink" title="SQL"></a>SQL</h2><h3 id="æ•°æ®æºè‡ªåŠ¨é…ç½®"><a href="#æ•°æ®æºè‡ªåŠ¨é…ç½®" class="headerlink" title="æ•°æ®æºè‡ªåŠ¨é…ç½®"></a>æ•°æ®æºè‡ªåŠ¨é…ç½®</h3><h4 id="å¼•å…¥åœºæ™¯-starter"><a href="#å¼•å…¥åœºæ™¯-starter" class="headerlink" title="å¼•å…¥åœºæ™¯ starter"></a>å¼•å…¥åœºæ™¯ starter</h4><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-data-jdbc<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="æ•°æ®åº“é©±åŠ¨"><a href="#æ•°æ®åº“é©±åŠ¨" class="headerlink" title="æ•°æ®åº“é©±åŠ¨"></a>æ•°æ®åº“é©±åŠ¨</h4><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line">é»˜è®¤ç‰ˆæœ¬ï¼š<span class="tag">&lt;<span class="name">mysql.version</span>&gt;</span>8.0.22<span class="tag">&lt;/<span class="name">mysql.version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--&lt;version&gt;5.1.49&lt;/version&gt;--&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">ä¿®æ”¹é»˜è®¤ç‰ˆæœ¬ï¼š</span><br><span class="line">1. ç›´æ¥ä¾èµ–å¼•å…¥å…·ä½“ç‰ˆæœ¬ï¼ˆmavençš„å°±è¿‘ä¾èµ–åŸåˆ™ï¼‰</span><br><span class="line">2. é‡æ–°å£°æ˜ç‰ˆæœ¬ï¼ˆmavençš„å±æ€§çš„å°±è¿‘ä¼˜å…ˆåŸåˆ™ï¼‰</span><br><span class="line"><span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">java.version</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">java.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mysql.version</span>&gt;</span>5.1.49<span class="tag">&lt;/<span class="name">mysql.version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="åˆ†æè‡ªåŠ¨é…ç½®"><a href="#åˆ†æè‡ªåŠ¨é…ç½®" class="headerlink" title="åˆ†æè‡ªåŠ¨é…ç½®"></a>åˆ†æè‡ªåŠ¨é…ç½®</h4><p>æŸ¥çœ‹spring-boot-autoconfigurationï¼š</p>
<blockquote>
<ol>
<li><p>DataSourceAutoConfiguration ï¼šæ•°æ®æºçš„è‡ªåŠ¨é…ç½®</p>
<ul>
<li>ç»‘å®šäº† spring.datasource</li>
</ul>
 <figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@ConfigurationProperties(prefix = &quot;spring.datasource&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DataSourceProperties</span> <span class="keyword">implements</span> <span class="title class_">BeanClassLoaderAware</span>, InitializingBean &#123;</span><br></pre></td></tr></table></figure>

<ul>
<li>åº•å±‚é»˜è®¤ä½¿ç”¨äº†<strong>HikariDataSource</strong></li>
</ul>
 <figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.zaxxer<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>HikariCP<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.0.3<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">scope</span>&gt;</span>compile<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

 <figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Hikari DataSource configuration.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Configuration(proxyBeanMethods = false)</span></span><br><span class="line"><span class="meta">@ConditionalOnClass(HikariDataSource.class)</span></span><br><span class="line"><span class="meta">@ConditionalOnMissingBean(DataSource.class)</span></span><br><span class="line"><span class="comment">// ========å¯ä»¥æŒ‡å®šæ•°æ®åº“è¿æ¥æ± çš„ç±»å‹=========</span></span><br><span class="line"><span class="meta">@ConditionalOnProperty(name = &quot;spring.datasource.type&quot;, havingValue = &quot;com.zaxxer.hikari.HikariDataSource&quot;,</span></span><br><span class="line"><span class="meta">      matchIfMissing = true)</span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">Hikari</span> &#123;</span><br></pre></td></tr></table></figure>

<p> DataSourceAutoConfigurationï¼š</p>
 <figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@AutoConfiguration(before = SqlInitializationAutoConfiguration.class)</span></span><br><span class="line"><span class="meta">@ConditionalOnClass(&#123; DataSource.class, EmbeddedDatabaseType.class &#125;)</span></span><br><span class="line"><span class="meta">@ConditionalOnMissingBean(type = &quot;io.r2dbc.spi.ConnectionFactory&quot;)</span></span><br><span class="line"><span class="meta">@EnableConfigurationProperties(DataSourceProperties.class)</span></span><br><span class="line"><span class="meta">@Import(DataSourcePoolMetadataProvidersConfiguration.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DataSourceAutoConfiguration</span> &#123;</span><br><span class="line"><span class="meta">@Configuration(proxyBeanMethods = false)</span></span><br><span class="line"><span class="meta">@Conditional(PooledDataSourceCondition.class)</span></span><br><span class="line"><span class="comment">// ====å®¹å™¨ä¸­æ²¡æœ‰DataSourceç±»æ‰ä¼šå¯¼å…¥é…ç½®å¥½è¿æ¥æ± ï¼šHikari====</span></span><br><span class="line"><span class="meta">@ConditionalOnMissingBean(&#123; DataSource.class, XADataSource.class &#125;)</span></span><br><span class="line"><span class="meta">@Import(&#123; DataSourceConfiguration.Hikari.class, DataSourceConfiguration.Tomcat.class,</span></span><br><span class="line"><span class="meta">		DataSourceConfiguration.Dbcp2.class, DataSourceConfiguration.OracleUcp.class,</span></span><br><span class="line"><span class="meta">		DataSourceConfiguration.Generic.class, DataSourceJmxConfiguration.class &#125;)</span></span><br><span class="line"><span class="keyword">protected</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">PooledDataSourceConfiguration</span> &#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>DataSourceTransactionManagerAutoConfigurationï¼š äº‹åŠ¡ç®¡ç†å™¨çš„è‡ªåŠ¨é…ç½®</p>
</li>
<li><p>JdbcTemplateAutoConfigurationï¼š <strong>JdbcTemplateçš„è‡ªåŠ¨é…ç½®</strong></p>
<p> æ•°æ®åº“è¿æ¥é…ç½®ï¼šspring.jdbc</p>
 <figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@AutoConfiguration(after = DataSourceAutoConfiguration.class)</span></span><br><span class="line"><span class="meta">@ConditionalOnClass(&#123; DataSource.class, JdbcTemplate.class &#125;)</span></span><br><span class="line"><span class="meta">@ConditionalOnSingleCandidate(DataSource.class)</span></span><br><span class="line"><span class="meta">@EnableConfigurationProperties(JdbcProperties.class)</span></span><br><span class="line"><span class="meta">@Import(&#123; DatabaseInitializationDependencyConfigurer.class, JdbcTemplateConfiguration.class,</span></span><br><span class="line"><span class="meta">      NamedParameterJdbcTemplateConfiguration.class &#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JdbcTemplateAutoConfiguration</span> &#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

 <figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@ConfigurationProperties(prefix = &quot;spring.jdbc&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JdbcProperties</span> &#123;</span><br></pre></td></tr></table></figure>
</li>
<li><p>JndiDataSourceAutoConfigurationï¼š jndi çš„è‡ªåŠ¨é…ç½®</p>
</li>
<li><p>XADataSourceAutoConfigurationï¼š åˆ†å¸ƒå¼äº‹åŠ¡ç›¸å…³</p>
</li>
</ol>
</blockquote>
<h4 id="é…ç½®ä¿®æ”¹"><a href="#é…ç½®ä¿®æ”¹" class="headerlink" title="é…ç½®ä¿®æ”¹"></a>é…ç½®ä¿®æ”¹</h4><figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">datasource:</span></span><br><span class="line">    <span class="attr">url:</span> <span class="string">jdbc:mysql://192.168.100.100:3306/springboot</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">    <span class="attr">password:</span> <span class="string">root</span></span><br><span class="line">    <span class="attr">driver-class-name:</span> <span class="string">com.mysql.jdbc.Driver</span></span><br></pre></td></tr></table></figure>

<p>æ³¨æ„æŠ¥é”™ï¼šå¦‚æœå¼•å…¥æ•°æ®åº“ç›¸å…³starterï¼Œå¦‚ä¸é…ç½®åˆ™ä¼šæŠ¥é”™ã€‚</p>
<p>å¯ä»¥åŠ æ³¨è§£ï¼š@SpringBootApplication(exclude &#x3D; {DataSourceAutoConfiguration.class})</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">***************************</span><br><span class="line">APPLICATION FAILED TO START</span><br><span class="line">***************************</span><br><span class="line">Description:</span><br><span class="line">Failed to configure a DataSource: <span class="string">&#x27;url&#x27;</span> attribute is not specified and no embedded datasource could be configured.</span><br><span class="line">Reason: Failed to determine a suitable driver <span class="keyword">class</span></span><br><span class="line"><span class="title class_">Action</span>:</span><br><span class="line">Consider the following:</span><br><span class="line">	If you want an embedded <span class="title function_">database</span> <span class="params">(H2, HSQL or Derby)</span>, please put it on the classpath.</span><br><span class="line">	If you have database settings to be loaded from a particular profile you may need to activate <span class="title function_">it</span> <span class="params">(no profiles are currently active)</span>.</span><br></pre></td></tr></table></figure>

<h4 id="æµ‹è¯•è¿æ¥"><a href="#æµ‹è¯•è¿æ¥" class="headerlink" title="æµ‹è¯•è¿æ¥"></a>æµ‹è¯•è¿æ¥</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">SpringBoot2Web01ApplicationTests</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> JdbcTemplate jdbcTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">contextLoads</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">Long</span> <span class="variable">count</span> <span class="operator">=</span> jdbcTemplate.queryForObject(<span class="string">&quot;select count(*) from tbl_account&quot;</span>,</span><br><span class="line">                                                 Long.class);</span><br><span class="line">        log.info(<span class="string">&quot;è®°å½•æ€»æ•°ï¼š&#123;&#125;&quot;</span>, count);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="åˆ‡æ¢-Druid-æ•°æ®æº"><a href="#åˆ‡æ¢-Druid-æ•°æ®æº" class="headerlink" title="åˆ‡æ¢ Druid æ•°æ®æº"></a>åˆ‡æ¢ Druid æ•°æ®æº</h3><p>åœ°å€ï¼š<a href="https://github.com/alibaba/druid">https://github.com/alibaba/druid</a></p>
<p>å¯¹äºç¬¬ä¸‰æ–¹æŠ€æœ¯çš„æ•´åˆï¼šè‡ªå®šä¹‰æ–¹å¼æ•´åˆã€starteræ•´åˆ</p>
<h4 id="è‡ªå®šä¹‰æ–¹å¼æ•´åˆDruid"><a href="#è‡ªå®šä¹‰æ–¹å¼æ•´åˆDruid" class="headerlink" title="è‡ªå®šä¹‰æ–¹å¼æ•´åˆDruid"></a>è‡ªå®šä¹‰æ–¹å¼æ•´åˆDruid</h4><blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Configuration(proxyBeanMethods = false)</span></span><br><span class="line"><span class="meta">@Conditional(PooledDataSourceCondition.class)</span></span><br><span class="line"><span class="comment">// ========å®¹å™¨ä¸­æ²¡æœ‰DataSourceæ—¶ä¼šå¯¼å…¥HikariDataSource===========</span></span><br><span class="line"><span class="meta">@ConditionalOnMissingBean(&#123; DataSource.class, XADataSource.class &#125;)</span></span><br><span class="line"><span class="meta">@Import(&#123; DataSourceConfiguration.Hikari.class, DataSourceConfiguration.Tomcat.class,</span></span><br><span class="line"><span class="meta">         DataSourceConfiguration.Dbcp2.class, DataSourceConfiguration.OracleUcp.class,</span></span><br><span class="line"><span class="meta">         DataSourceConfiguration.Generic.class, DataSourceJmxConfiguration.class &#125;)</span></span><br><span class="line"><span class="keyword">protected</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">PooledDataSourceConfiguration</span> &#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å®¹å™¨ä¸­æ²¡æœ‰DataSourceæ—¶ä¼šå¯¼å…¥HikariDataSourceã€‚</p>
</blockquote>
<p>å¼•å…¥ä¾èµ–ï¼š</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>druid<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.1.17<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>xmlé…ç½®ï¼šï¼ˆé…ç½®æ–‡ä»¶å½¢å¼ï¼‰</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;dataSource&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.alibaba.druid.pool.DruidDataSource&quot;</span></span></span><br><span class="line"><span class="tag">		<span class="attr">destroy-method</span>=<span class="string">&quot;close&quot;</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;url&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.url&#125;&quot;</span> /&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.username&#125;&quot;</span> /&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.password&#125;&quot;</span> /&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;maxActive&quot;</span> <span class="attr">value</span>=<span class="string">&quot;20&quot;</span> /&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;initialSize&quot;</span> <span class="attr">value</span>=<span class="string">&quot;1&quot;</span> /&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;maxWait&quot;</span> <span class="attr">value</span>=<span class="string">&quot;60000&quot;</span> /&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;minIdle&quot;</span> <span class="attr">value</span>=<span class="string">&quot;1&quot;</span> /&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;timeBetweenEvictionRunsMillis&quot;</span> <span class="attr">value</span>=<span class="string">&quot;60000&quot;</span> /&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;minEvictableIdleTimeMillis&quot;</span> <span class="attr">value</span>=<span class="string">&quot;300000&quot;</span> /&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;testWhileIdle&quot;</span> <span class="attr">value</span>=<span class="string">&quot;true&quot;</span> /&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;testOnBorrow&quot;</span> <span class="attr">value</span>=<span class="string">&quot;false&quot;</span> /&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;testOnReturn&quot;</span> <span class="attr">value</span>=<span class="string">&quot;false&quot;</span> /&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;poolPreparedStatements&quot;</span> <span class="attr">value</span>=<span class="string">&quot;true&quot;</span> /&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;maxOpenPreparedStatements&quot;</span> <span class="attr">value</span>=<span class="string">&quot;20&quot;</span> /&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>æ–°å»ºSpringBooté…ç½®ç±»ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyDataSourceConfig</span> &#123;</span><br><span class="line">    <span class="comment">// åŒapplication.yamlæ–‡ä»¶é…ç½®ç»‘å®š</span></span><br><span class="line">    <span class="meta">@ConfigurationProperties(prefix = &quot;spring.datasource&quot;)</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> DataSource <span class="title function_">dataSource</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">DruidDataSource</span> <span class="variable">druidDataSource</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DruidDataSource</span>();</span><br><span class="line">        <span class="comment">// druidDataSource.setUrl();</span></span><br><span class="line">        <span class="comment">// druidDataSource.setXXX();</span></span><br><span class="line">        <span class="keyword">return</span> druidDataSource;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æµ‹è¯•ï¼šè¾“å‡ºDataSourceï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">SpringBoot2Web01ApplicationTests</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> JdbcTemplate jdbcTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> DataSource dataSource;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">contextLoads</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">Long</span> <span class="variable">count</span> <span class="operator">=</span> jdbcTemplate.queryForObject(<span class="string">&quot;select count(*) from tbl_account&quot;</span>, Long.class);</span><br><span class="line">        log.info(<span class="string">&quot;è®°å½•æ€»æ•°ï¼š&#123;&#125;&quot;</span>, count);</span><br><span class="line">        log.info(<span class="string">&quot;DataSource: &#123;&#125;&quot;</span>, dataSource);</span><br><span class="line">        <span class="comment">// class com.alibaba.druid.pool.DruidDataSource</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="Druid-æ•°æ®ç›‘æ§"><a href="#Druid-æ•°æ®ç›‘æ§" class="headerlink" title="Druid æ•°æ®ç›‘æ§"></a>Druid æ•°æ®ç›‘æ§</h4><p><a href="https://github.com/alibaba/druid">https://github.com/alibaba/druid</a></p>
<p><a href="https://github.com/alibaba/druid/wiki/%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98">https://github.com/alibaba/druid/wiki/%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98</a></p>
<h5 id="é…ç½®-StatViewServleté…ç½®"><a href="#é…ç½®-StatViewServleté…ç½®" class="headerlink" title="é…ç½®_StatViewServleté…ç½®"></a>é…ç½®_StatViewServleté…ç½®</h5><p><a href="https://github.com/alibaba/druid/wiki/%E9%85%8D%E7%BD%AE_StatViewServlet%E9%85%8D%E7%BD%AE">https://github.com/alibaba/druid/wiki/%E9%85%8D%E7%BD%AE_StatViewServlet%E9%85%8D%E7%BD%AE</a></p>
<p>Druidå†…ç½®æä¾›äº†ä¸€ä¸ªStatViewServletç”¨äºå±•ç¤ºDruidçš„ç»Ÿè®¡ä¿¡æ¯ã€‚</p>
<p>è¿™ä¸ªStatViewServletçš„ç”¨é€”åŒ…æ‹¬ï¼š</p>
<ul>
<li>æä¾›ç›‘æ§ä¿¡æ¯å±•ç¤ºçš„htmlé¡µé¢</li>
<li>æä¾›ç›‘æ§ä¿¡æ¯çš„JSON API</li>
</ul>
<p>æ³¨æ„ï¼šä½¿ç”¨StatViewServletï¼Œå»ºè®®ä½¿ç”¨druid 0.2.6ä»¥ä¸Šç‰ˆæœ¬ã€‚</p>
<p>SpringBooté…ç½®Servletï¼šï¼ˆé…ç½®ç±»ï¼‰</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * é…ç½®Druidçš„ç›‘æ§å‘˜åŠŸèƒ½</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> ServletRegistrationBean <span class="title function_">statViewServlet</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">StatViewServlet</span> <span class="variable">statViewServlet</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StatViewServlet</span>();</span><br><span class="line">    ServletRegistrationBean&lt;StatViewServlet&gt; registrationBean =</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">ServletRegistrationBean</span>&lt;&gt;(statViewServlet, <span class="string">&quot;/druid/*&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> registrationBean;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æµ‹è¯•ï¼š<a href="http://localhost:8080/druid/index.html">http://localhost:8080/druid/index.html</a></p>
<p><img src="/2023/02/28/SpringBoot2/Java\SpringBoot\SpringBoot2.assets\image-20221021204241297.png" alt="image-20221021204241297"></p>
<p>é…ç½® StatViewServletçš„ç™»å½•åŠŸèƒ½ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> ServletRegistrationBean <span class="title function_">statViewServlet</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">StatViewServlet</span> <span class="variable">statViewServlet</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StatViewServlet</span>();</span><br><span class="line">    ServletRegistrationBean&lt;StatViewServlet&gt; registrationBean =</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">ServletRegistrationBean</span>&lt;&gt;(statViewServlet, <span class="string">&quot;/druid/*&quot;</span>);</span><br><span class="line">    <span class="comment">// è®¾ç½®Druidé¡µé¢çš„ç™»å½•è´¦æˆ·</span></span><br><span class="line">    registrationBean.addInitParameter(<span class="string">&quot;loginUsername&quot;</span>, <span class="string">&quot;druid&quot;</span>);</span><br><span class="line">    registrationBean.addInitParameter(<span class="string">&quot;loginPassword&quot;</span>, <span class="string">&quot;druid&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> registrationBean;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç™»å½•ç•Œé¢ï¼š</p>
<img src="/2023/02/28/SpringBoot2/Java\SpringBoot\SpringBoot2.assets\image-20221021211332942.png" alt="image-20221021211332942" style="zoom:50%;">

<h5 id="é…ç½®-StatFilter"><a href="#é…ç½®-StatFilter" class="headerlink" title="é…ç½®_StatFilter"></a>é…ç½®_StatFilter</h5><p>Druidå†…ç½®æä¾›ä¸€ä¸ªStatFilterï¼Œç”¨äºç»Ÿè®¡ç›‘æ§ä¿¡æ¯ã€‚</p>
<p>SpringBooté…ç½®ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyDataSourceConfig</span> &#123;</span><br><span class="line">    <span class="comment">// åŒapplication.yamlæ–‡ä»¶é…ç½®ç»‘å®š</span></span><br><span class="line">    <span class="meta">@ConfigurationProperties(prefix = &quot;spring.datasource&quot;)</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> DataSource <span class="title function_">dataSource</span><span class="params">()</span> <span class="keyword">throws</span> SQLException &#123;</span><br><span class="line">        <span class="type">DruidDataSource</span> <span class="variable">druidDataSource</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DruidDataSource</span>();</span><br><span class="line">        <span class="comment">// å¼€å¯SQLç›‘æ§åŠŸèƒ½</span></span><br><span class="line">        druidDataSource.setFilters(<span class="string">&quot;stat&quot;</span>);</span><br><span class="line">        <span class="comment">// setXXå¯ä»¥å†™åœ¨é…ç½®æ–‡ä»¶ä¸­</span></span><br><span class="line">        <span class="keyword">return</span> druidDataSource;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>ä½¿ç”¨yamlä»£æ›¿é…ç½®ç±»setXXX( );</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">spring:</span> </span><br><span class="line">  <span class="attr">datasource:</span></span><br><span class="line">    <span class="attr">url:</span> <span class="string">jdbc:mysql://192.168.100.100:3306/springboot</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">    <span class="attr">password:</span> <span class="string">root</span></span><br><span class="line">    <span class="attr">driver-class-name:</span> <span class="string">com.mysql.jdbc.Driver</span></span><br><span class="line">    </span><br><span class="line">    <span class="attr">filters:</span> <span class="string">stat,wall</span></span><br></pre></td></tr></table></figure>

<p>æµ‹è¯•ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RestfulTestController</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> JdbcTemplate jdbcTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/sql&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">sql</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">Long</span> <span class="variable">count</span> <span class="operator">=</span> jdbcTemplate.queryForObject(<span class="string">&quot;select count(*) from tbl_account&quot;</span>, Long.class);</span><br><span class="line">        <span class="keyword">return</span> count.toString();</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>å¤šæ¬¡è®¿é—®ï¼š<a href="http://localhost:8080/sql">http://localhost:8080/sql</a></p>
<p><img src="/2023/02/28/SpringBoot2/Java\SpringBoot\SpringBoot2.assets\image-20221021205302884.png" alt="image-20221021205302884"></p>
<p>å…¶ä¸­æ‰§è¡Œæ—¶é—´åˆ†å¸ƒï¼š</p>
<blockquote>
<p>SQLç›‘æ§é¡¹ä¸Šï¼Œæ‰§è¡Œæ—¶é—´ã€è¯»å–è¡Œæ•°ã€æ›´æ–°è¡Œæ•°éƒ½æœ‰åŒºé—´åˆ†å¸ƒï¼Œå°†è€—æ—¶åˆ†å¸ƒæˆ8ä¸ªåŒºé—´ï¼š</p>
<ul>
<li>0 - 1 è€—æ—¶0åˆ°1æ¯«ç§’çš„æ¬¡æ•°</li>
<li>1 - 10 è€—æ—¶1åˆ°10æ¯«ç§’çš„æ¬¡æ•°</li>
<li>10 - 100 è€—æ—¶10åˆ°100æ¯«ç§’çš„æ¬¡æ•°</li>
<li>100 - 1,000 è€—æ—¶100åˆ°1000æ¯«ç§’çš„æ¬¡æ•°</li>
<li>1,000 - 10,000 è€—æ—¶1åˆ°10ç§’çš„æ¬¡æ•°</li>
<li>10,000 - 100,000 è€—æ—¶10åˆ°100ç§’çš„æ¬¡æ•°</li>
<li>100,000 - 1,000,000 è€—æ—¶100åˆ°1000ç§’çš„æ¬¡æ•°</li>
<li>1,000,000 - è€—æ—¶1000ç§’ä»¥ä¸Šçš„æ¬¡æ•°</li>
</ul>
<p>è®°å½•è€—æ—¶åŒºé—´çš„å‘ç”Ÿæ¬¡æ•°ï¼Œé€šè¿‡åŒºåˆ†åˆ†å¸ƒï¼Œå¯ä»¥å¾ˆæ–¹ä¾¿çœ‹å‡ºSQLè¿è¡Œçš„æå¥½ã€æ™®é€šå’Œæå·®çš„åˆ†å¸ƒã€‚ è€—æ—¶åŒºåˆ†åˆ†å¸ƒæä¾›äº†â€œæ‰§è¡Œ+RSæ—¶åˆ†å¸ƒâ€ï¼Œæ˜¯å°†æ‰§è¡Œæ—¶é—´+ResultSetæŒæœ‰æ—¶é—´åˆå¹¶ç›‘æ§ï¼Œè¿™ä¸ªèƒ½æ–¹ä¾¿è¯Šæ–­è¿”å›è¡Œæ•°è¿‡å¤šçš„æŸ¥è¯¢ã€‚</p>
</blockquote>
<h5 id="Webå…³è”Springç›‘æ§"><a href="#Webå…³è”Springç›‘æ§" class="headerlink" title="Webå…³è”Springç›‘æ§"></a>Webå…³è”Springç›‘æ§</h5><p>WebStatFilterç”¨äºé‡‡é›†web-jdbcå…³è”ç›‘æ§çš„æ•°æ®ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">  * é…ç½® WebStatFilter</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> FilterRegistrationBean <span class="title function_">webStatFilter</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">WebStatFilter</span> <span class="variable">webStatFilter</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">WebStatFilter</span>();</span><br><span class="line">    FilterRegistrationBean&lt;WebStatFilter&gt; filterRegistrationBean =</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">FilterRegistrationBean</span>&lt;&gt;(webStatFilter);</span><br><span class="line">    filterRegistrationBean.setUrlPatterns(Arrays.asList(<span class="string">&quot;/*&quot;</span>));</span><br><span class="line">    filterRegistrationBean.addInitParameter(<span class="string">&quot;exclusions&quot;</span>, </span><br><span class="line">                                            <span class="string">&quot;*.js,*.gif,*.jpg,*.png,*.css,*.ico,/druid/*&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> filterRegistrationBean;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æµ‹è¯•ï¼š</p>
<p><img src="/2023/02/28/SpringBoot2/Java\SpringBoot\SpringBoot2.assets\image-20221021210500885.png" alt="image-20221021210500885"></p>
<h5 id="é…ç½®-wallfilterï¼ˆé˜²ç«å¢™ï¼‰"><a href="#é…ç½®-wallfilterï¼ˆé˜²ç«å¢™ï¼‰" class="headerlink" title="é…ç½® wallfilterï¼ˆé˜²ç«å¢™ï¼‰"></a>é…ç½® wallfilterï¼ˆé˜²ç«å¢™ï¼‰</h5><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@ConfigurationProperties(prefix = &quot;spring.datasource&quot;)</span></span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> DataSource <span class="title function_">dataSource</span><span class="params">()</span> <span class="keyword">throws</span> SQLException &#123;</span><br><span class="line">    <span class="type">DruidDataSource</span> <span class="variable">druidDataSource</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DruidDataSource</span>();</span><br><span class="line">    <span class="comment">// å¼€å¯SQLç›‘æ§ï¼Œé˜²ç«å¢™åŠŸèƒ½</span></span><br><span class="line">    druidDataSource.setFilters(<span class="string">&quot;stat,wall&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> druidDataSource;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="/2023/02/28/SpringBoot2/Java\SpringBoot\SpringBoot2.assets\image-20221021210646250.png" alt="image-20221021210646250"></p>
<h4 id="Starter-æ–¹å¼æ•´åˆDruid"><a href="#Starter-æ–¹å¼æ•´åˆDruid" class="headerlink" title="Starter æ–¹å¼æ•´åˆDruid"></a>Starter æ–¹å¼æ•´åˆDruid</h4><p><a href="https://github.com/alibaba/druid/tree/master/druid-spring-boot-starter">https://github.com/alibaba/druid/tree/master/druid-spring-boot-starter</a></p>
<h5 id="å¼•å…¥ä¾èµ–"><a href="#å¼•å…¥ä¾èµ–" class="headerlink" title="å¼•å…¥ä¾èµ–"></a>å¼•å…¥ä¾èµ–</h5><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>druid-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.1.17<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h5 id="è‡ªåŠ¨é…ç½®-1"><a href="#è‡ªåŠ¨é…ç½®-1" class="headerlink" title="è‡ªåŠ¨é…ç½®"></a>è‡ªåŠ¨é…ç½®</h5><p>å…ˆçœ‹starterä¸‹çš„META-INFä¸‹spring.factoryä¸­å£°æ˜äº†é‚£ä¸ªè‡ªåŠ¨é…ç½®ç±»ã€‚</p>
<figure class="highlight properties"><table><tr><td class="code"><pre><span class="line"><span class="attr">org.springframework.boot.autoconfigure.EnableAutoConfiguration</span>=<span class="string">\</span></span><br><span class="line"><span class="string">com.alibaba.druid.spring.boot.autoconfigure.DruidDataSourceAutoConfigure</span></span><br></pre></td></tr></table></figure>

<blockquote>
<ul>
<li>DruidStatProperties å’Œ spring.datasource.druidç»‘å®š</li>
<li>DataSourceProperties å’Œ spring.datasourceç»‘å®š</li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@ConditionalOnClass(&#123;DruidDataSource.class&#125;)</span></span><br><span class="line"><span class="meta">@AutoConfigureBefore(&#123;DataSourceAutoConfiguration.class&#125;)</span></span><br><span class="line"><span class="meta">@EnableConfigurationProperties(&#123;DruidStatProperties.class, DataSourceProperties.class&#125;)</span></span><br><span class="line"><span class="meta">@Import(&#123;DruidSpringAopConfiguration.class, DruidStatViewServletConfiguration.class, DruidWebStatFilterConfiguration.class, DruidFilterConfiguration.class&#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DruidDataSourceAutoConfigure</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">DruidDataSourceAutoConfigure</span><span class="params">()</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean(</span></span><br><span class="line"><span class="meta">        initMethod = &quot;init&quot;</span></span><br><span class="line"><span class="meta">    )</span></span><br><span class="line">    <span class="meta">@ConditionalOnMissingBean</span></span><br><span class="line">    <span class="keyword">public</span> DataSource <span class="title function_">dataSource</span><span class="params">()</span> &#123;</span><br><span class="line">        LOGGER.info(<span class="string">&quot;Init DruidDataSource&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">DruidDataSourceWrapper</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>DruidSpringAopConfiguration.<strong>class</strong>,   ç›‘æ§SpringBeançš„ï¼›é…ç½®é¡¹ï¼š<strong>spring.datasource.druid.aop-patterns</strong></li>
<li>DruidStatViewServletConfiguration.<strong>class</strong>, ç›‘æ§é¡µçš„é…ç½®ï¼š<strong>spring.datasource.druid.stat-view-servletï¼›é»˜è®¤å¼€å¯</strong></li>
<li>DruidWebStatFilterConfiguration.<strong>class</strong>, webç›‘æ§é…ç½®ï¼›<strong>spring.datasource.druid.web-stat-filterï¼›é»˜è®¤å¼€å¯</strong></li>
<li>DruidFilterConfiguration.<strong>class</strong>}) æ‰€æœ‰Druidè‡ªå·±filterçš„é…ç½®</li>
</ul>
</blockquote>
<h5 id="é…ç½®ç¤ºä¾‹"><a href="#é…ç½®ç¤ºä¾‹" class="headerlink" title="é…ç½®ç¤ºä¾‹"></a>é…ç½®ç¤ºä¾‹</h5><figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">datasource:</span></span><br><span class="line">    <span class="attr">url:</span> <span class="string">jdbc:mysql://localhost:3306/db_account</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">    <span class="attr">password:</span> <span class="number">123456</span></span><br><span class="line">    <span class="attr">driver-class-name:</span> <span class="string">com.mysql.jdbc.Driver</span></span><br><span class="line"></span><br><span class="line">    <span class="attr">druid:</span></span><br><span class="line">      <span class="attr">aop-patterns:</span> <span class="string">com.example.admin.*</span>  <span class="comment">#ç›‘æ§SpringBean</span></span><br><span class="line">      <span class="attr">filters:</span> <span class="string">stat,wall</span>     <span class="comment"># åº•å±‚å¼€å¯åŠŸèƒ½ï¼Œstatï¼ˆsqlç›‘æ§ï¼‰ï¼Œwallï¼ˆé˜²ç«å¢™ï¼‰</span></span><br><span class="line"></span><br><span class="line">      <span class="attr">stat-view-servlet:</span>   <span class="comment"># é…ç½®ç›‘æ§é¡µåŠŸèƒ½</span></span><br><span class="line">        <span class="attr">enabled:</span> <span class="literal">true</span></span><br><span class="line">        <span class="attr">login-username:</span> <span class="string">admin</span></span><br><span class="line">        <span class="attr">login-password:</span> <span class="string">admin</span></span><br><span class="line">        <span class="attr">resetEnable:</span> <span class="literal">false</span></span><br><span class="line"></span><br><span class="line">      <span class="attr">web-stat-filter:</span>  <span class="comment"># ç›‘æ§web</span></span><br><span class="line">        <span class="attr">enabled:</span> <span class="literal">true</span></span><br><span class="line">        <span class="attr">urlPattern:</span> <span class="string">/*</span></span><br><span class="line">        <span class="attr">exclusions:</span> <span class="string">&#x27;*.js,*.gif,*.jpg,*.png,*.css,*.ico,/druid/*&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">      <span class="attr">filter:</span></span><br><span class="line">        <span class="attr">stat:</span>    <span class="comment"># å¯¹ä¸Šé¢filtersé‡Œé¢çš„statçš„è¯¦ç»†é…ç½®</span></span><br><span class="line">          <span class="attr">slow-sql-millis:</span> <span class="number">1000</span></span><br><span class="line">          <span class="attr">logSlowSql:</span> <span class="literal">true</span></span><br><span class="line">          <span class="attr">enabled:</span> <span class="literal">true</span></span><br><span class="line">        <span class="attr">wall:</span></span><br><span class="line">          <span class="attr">enabled:</span> <span class="literal">true</span></span><br><span class="line">          <span class="attr">config:</span></span><br><span class="line">            <span class="attr">drop-table-allow:</span> <span class="literal">false</span></span><br></pre></td></tr></table></figure>















<h3 id="æ•´åˆ-Mybatis"><a href="#æ•´åˆ-Mybatis" class="headerlink" title="æ•´åˆ Mybatis"></a>æ•´åˆ Mybatis</h3><p><a href="https://github.com/mybatis">https://github.com/mybatis</a></p>
<p><a href="https://mybatis.org/mybatis-3/">https://mybatis.org/mybatis-3/</a></p>
<p><a href="https://github.com/mybatis/spring-boot-starter">https://github.com/mybatis/spring-boot-starter</a></p>
<h5 id="å¼•å…¥ä¾èµ–-1"><a href="#å¼•å…¥ä¾èµ–-1" class="headerlink" title="å¼•å…¥ä¾èµ–"></a>å¼•å…¥ä¾èµ–</h5><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis.spring.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.1.4<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h5 id="åˆ†æè‡ªåŠ¨é…ç½®-1"><a href="#åˆ†æè‡ªåŠ¨é…ç½®-1" class="headerlink" title="åˆ†æè‡ªåŠ¨é…ç½®"></a>åˆ†æè‡ªåŠ¨é…ç½®</h5><blockquote>
<p>spring.factory</p>
<figure class="highlight properties"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Auto Configure</span></span><br><span class="line"><span class="attr">org.springframework.boot.autoconfigure.EnableAutoConfiguration</span>=<span class="string">\</span></span><br><span class="line"><span class="string">org.mybatis.spring.boot.autoconfigure.MybatisLanguageDriverAutoConfiguration,\</span></span><br><span class="line"><span class="string">org.mybatis.spring.boot.autoconfigure.MybatisAutoConfiguration</span></span><br></pre></td></tr></table></figure>

<p>MybatisAutoConfiguration</p>
<ul>
<li>MybatisPropertiesç»‘å®šäº† mybatis</li>
<li>è‡ªåŠ¨é…ç½®äº†SqlSessionFactory</li>
<li>è‡ªåŠ¨é…ç½®äº†SqlSessionTemplateï¼ŒåŒ…å«äº†SqlSession</li>
<li>å¼•å…¥äº†AutoConfiguredMapperScannerRegistrarï¼Œ@Mapperæ‰«æ</li>
<li>å¯ä»¥åœ¨é…ç½®ç±»ä¸Šä½¿ç”¨ @MapperScanæŒ‡å®šæ‰«æçš„åŒ…ä¸‹æ‰€æœ‰çš„Mapperï¼Œä¸éœ€è¦å•ç‹¬æ·»åŠ @Mapper</li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@ConditionalOnClass(&#123;SqlSessionFactory.class, SqlSessionFactoryBean.class&#125;)</span></span><br><span class="line"><span class="comment">// ========å•ä¸ªå®ä¾‹ç”Ÿæ•ˆ=========</span></span><br><span class="line"><span class="meta">@ConditionalOnSingleCandidate(DataSource.class)</span></span><br><span class="line"><span class="meta">@EnableConfigurationProperties(&#123;MybatisProperties.class&#125;)</span></span><br><span class="line"><span class="meta">@AutoConfigureAfter(&#123;DataSourceAutoConfiguration.class, MybatisLanguageDriverAutoConfiguration.class&#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MybatisAutoConfiguration</span> <span class="keyword">implements</span> <span class="title class_">InitializingBean</span> &#123;</span><br><span class="line">    <span class="comment">// ....</span></span><br><span class="line">	<span class="meta">@Bean</span></span><br><span class="line">    <span class="meta">@ConditionalOnMissingBean</span></span><br><span class="line">    <span class="keyword">public</span> SqlSessionFactory <span class="title function_">sqlSessionFactory</span><span class="params">(DataSource dataSource)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">SqlSessionFactoryBean</span> <span class="variable">factory</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SqlSessionFactoryBean</span>();</span><br><span class="line">        factory.setDataSource(dataSource);</span><br><span class="line">        <span class="comment">// ....</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// ====-è‡ªåŠ¨é…ç½®äº†SQLSessionTemplateï¼šç»„åˆäº†SQlSession========</span></span><br><span class="line">	<span class="meta">@Bean</span></span><br><span class="line">    <span class="meta">@ConditionalOnMissingBean</span></span><br><span class="line">    <span class="keyword">public</span> SqlSessionTemplate <span class="title function_">sqlSessionTemplate</span><span class="params">(SqlSessionFactory sqlSessionFactory)</span> &#123;</span><br><span class="line">        <span class="type">ExecutorType</span> <span class="variable">executorType</span> <span class="operator">=</span> <span class="built_in">this</span>.properties.getExecutorType();</span><br><span class="line">        <span class="keyword">return</span> executorType != <span class="literal">null</span> ? <span class="keyword">new</span> <span class="title class_">SqlSessionTemplate</span>(sqlSessionFactory, executorType) : <span class="keyword">new</span> <span class="title class_">SqlSessionTemplate</span>(sqlSessionFactory);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// ========MapperScanï¼Œæ ‡æ³¨äº†@Mapperçš„ç±»ä¼šè¢«è‡ªåŠ¨æ‰«æ=========</span></span><br><span class="line">    <span class="meta">@Configuration</span></span><br><span class="line">    <span class="meta">@Import(&#123;MybatisAutoConfiguration.AutoConfiguredMapperScannerRegistrar.class&#125;)</span></span><br><span class="line">    <span class="meta">@ConditionalOnMissingBean(&#123;MapperFactoryBean.class, MapperScannerConfigurer.class&#125;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">MapperScannerRegistrarNotFoundConfiguration</span> <span class="keyword">implements</span> <span class="title class_">InitializingBean</span> &#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="title function_">MapperScannerRegistrarNotFoundConfiguration</span><span class="params">()</span> &#123;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">afterPropertiesSet</span><span class="params">()</span> &#123;</span><br><span class="line">            MybatisAutoConfiguration.logger.debug(<span class="string">&quot;Not found configuration for registering mapper bean using @MapperScan, MapperFactoryBean and MapperScannerConfigurer.&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// ....</span></span><br></pre></td></tr></table></figure>

<p>MybatisProperties</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@ConfigurationProperties(prefix = &quot;mybatis&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MybatisProperties</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">MYBATIS_PREFIX</span> <span class="operator">=</span> <span class="string">&quot;mybatis&quot;</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">ResourcePatternResolver</span> <span class="variable">resourceResolver</span> <span class="operator">=</span> </span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">PathMatchingResourcePatternResolver</span>();</span><br><span class="line">    <span class="keyword">private</span> String configLocation;</span><br><span class="line">    <span class="keyword">private</span> String[] mapperLocations;</span><br><span class="line">    <span class="keyword">private</span> String typeAliasesPackage;</span><br><span class="line">    <span class="keyword">private</span> Class&lt;?&gt; typeAliasesSuperType;</span><br><span class="line">    <span class="keyword">private</span> String typeHandlersPackage;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">boolean</span> <span class="variable">checkConfigLocation</span> <span class="operator">=</span> <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">private</span> ExecutorType executorType;</span><br><span class="line">    <span class="keyword">private</span> Class&lt;? <span class="keyword">extends</span> <span class="title class_">LanguageDriver</span>&gt; defaultScriptingLanguageDriver;</span><br><span class="line">    <span class="keyword">private</span> Properties configurationProperties;</span><br><span class="line">    <span class="comment">// =============å…¨å±€é…ç½®å¯¹è±¡============</span></span><br><span class="line">    <span class="meta">@NestedConfigurationProperty</span></span><br><span class="line">    <span class="keyword">private</span> Configuration configuration;</span><br></pre></td></tr></table></figure>
</blockquote>
<h5 id="é…ç½®ç¤ºä¾‹-1"><a href="#é…ç½®ç¤ºä¾‹-1" class="headerlink" title="é…ç½®ç¤ºä¾‹"></a>é…ç½®ç¤ºä¾‹</h5><figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">mybatis:</span></span><br><span class="line">  <span class="comment">#config-location: classpath:mybatis/mybatis-config.xml</span></span><br><span class="line">  <span class="attr">mapper-locations:</span> <span class="string">classpath:mybatis/mapper/*.xml</span></span><br><span class="line">  <span class="comment"># æ³¨æ„é…ç½®æ–‡ä»¶å’Œconfigurationé…ç½®ä¸èƒ½ä¸€èµ·ä½¿ç”¨ï¼Œä¼šå‘ç”Ÿå†²çª</span></span><br><span class="line">  <span class="comment"># Property &#x27;configuration&#x27; and &#x27;configLocation&#x27; can not specified with together</span></span><br><span class="line">  <span class="attr">configuration:</span></span><br><span class="line">    <span class="attr">map-underscore-to-camel-case:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">typeAliasesPackage:</span> <span class="string">com.example.springboot.bean</span></span><br></pre></td></tr></table></figure>

<p>æµ‹è¯•ï¼š</p>
<p>mybatis-config.xml</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span> ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">configuration</span></span></span><br><span class="line"><span class="meta">  <span class="keyword">PUBLIC</span> <span class="string">&quot;-//mybatis.org//DTD Config 3.0//EN&quot;</span></span></span><br><span class="line"><span class="meta">  <span class="string">&quot;https://mybatis.org/dtd/mybatis-3-config.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>AccountMapper.xml</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span> ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">mapper</span></span></span><br><span class="line"><span class="meta">        <span class="keyword">PUBLIC</span> <span class="string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span></span></span><br><span class="line"><span class="meta">        <span class="string">&quot;https://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.example.springboot.mapper.AccountMapper&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--resultTypeé»˜è®¤å†™å…¨åï¼Œåˆ«åéœ€è¦é…ç½®--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectAccountById&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;com.example.springboot.bean.Account&quot;</span>&gt;</span></span><br><span class="line">        select * from tbl_account where id = #&#123;id&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>AccoutMapper</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.springboot.mapper;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.example.springboot.bean.Account;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.annotations.Mapper;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Mapper</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">AccountMapper</span> &#123;</span><br><span class="line">    Account <span class="title function_">selectAccountById</span><span class="params">(Long id)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>AccountService</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.springboot.service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.example.springboot.bean.Account;</span><br><span class="line"><span class="keyword">import</span> com.example.springboot.mapper.AccountMapper;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AccountService</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> AccountMapper accountMapper;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Account <span class="title function_">getAAccountById</span><span class="params">(Long id)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> accountMapper.selectAccountById(id);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>DaoController</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DaoController</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> AccountService accountService;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å¦‚æœä¸åŠ <span class="doctag">@ResponseBody</span>æŠ¥é”™ï¼š</span></span><br><span class="line"><span class="comment">     * Error resolving template [account], template might not exist or might not be accessible by any of the configured Template Resolvers</span></span><br><span class="line"><span class="comment">     * org.thymeleaf.exceptions.TemplateInputException: Error resolving template [account], template might not exist or</span></span><br><span class="line"><span class="comment">     * might not be accessible by any of the configured Template Resolvers</span></span><br><span class="line"><span class="comment">     * å¦‚æœä¸å¸¦å‚æ•°æŠ¥400é”™è¯¯</span></span><br><span class="line"><span class="comment">     * å¦‚æœbeanæ²¡æœ‰getã€setæ–¹æ³•ï¼ŒæŠ¥é”™ï¼š</span></span><br><span class="line"><span class="comment">     * Resolved [org.springframework.web.HttpMediaTypeNotAcceptableException: Could not find acceptable representation]</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/account&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Account <span class="title function_">account</span><span class="params">(<span class="meta">@RequestParam(&quot;id&quot;)</span> Long id)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> accountService.getAAccountById(id);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="æ³¨è§£æ¨¡å¼"><a href="#æ³¨è§£æ¨¡å¼" class="headerlink" title="æ³¨è§£æ¨¡å¼"></a>æ³¨è§£æ¨¡å¼</h5><p>cityè¡¨</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> city</span><br><span class="line">(</span><br><span class="line">  id      <span class="type">INT</span>(<span class="number">11</span>) <span class="keyword">PRIMARY</span> KEY auto_increment,</span><br><span class="line">  name    <span class="type">VARCHAR</span>(<span class="number">30</span>),</span><br><span class="line">  state   <span class="type">VARCHAR</span>(<span class="number">30</span>),</span><br><span class="line">  country <span class="type">VARCHAR</span>(<span class="number">30</span>)</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p>beanï¼šcity</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">City</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> String state;</span><br><span class="line">    <span class="keyword">private</span> String country;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>CityMapper</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Mapper</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">CityMapper</span> &#123;</span><br><span class="line">    <span class="meta">@Select(&quot;select * from city&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;City&gt; <span class="title function_">selectAllCity</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Insert(&quot;insert into city(name,state,country) values(#&#123;name&#125;,#&#123;state&#125;,#&#123;country&#125;)&quot;)</span></span><br><span class="line">    <span class="comment">// è‡ªå¢æ•°æ®åº“è¿”å›æ–°æ’å…¥æ•°æ®çš„ä¸»é”®</span></span><br><span class="line">    <span class="meta">@Options(useGeneratedKeys = true, keyProperty = &quot;id&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Long <span class="title function_">insertOneCity</span><span class="params">(City city)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>CityServiceImpl</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CityServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">CityService</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> CityMapper cityMapper;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;City&gt; <span class="title function_">getAllCity</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> cityMapper.selectAllCity();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Long <span class="title function_">addCity</span><span class="params">(City city)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> cityMapper.insertOneCity(city);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Controller</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DaoController</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> AccountService accountService;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> CityService cityService;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å¦‚æœä¸åŠ <span class="doctag">@ResponseBody</span>æŠ¥é”™ï¼š</span></span><br><span class="line"><span class="comment">     * Error resolving template [account], template might not exist or might not be accessible by any of the configured Template Resolvers</span></span><br><span class="line"><span class="comment">     * org.thymeleaf.exceptions.TemplateInputException: Error resolving template [account], template might not exist or</span></span><br><span class="line"><span class="comment">     * might not be accessible by any of the configured Template Resolvers</span></span><br><span class="line"><span class="comment">     * å¦‚æœä¸å¸¦å‚æ•°æŠ¥400é”™è¯¯</span></span><br><span class="line"><span class="comment">     * å¦‚æœbeanæ²¡æœ‰getã€setæ–¹æ³•ï¼ŒæŠ¥é”™ï¼š</span></span><br><span class="line"><span class="comment">     * Resolved [org.springframework.web.HttpMediaTypeNotAcceptableException: Could not find acceptable representation]</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/account&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Account <span class="title function_">account</span><span class="params">(<span class="meta">@RequestParam(&quot;id&quot;)</span> Long id)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> accountService.getAAccountById(id);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/getAllCity&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;City&gt; <span class="title function_">getAllCity</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> cityService.getAllCity();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ä½¿ç”¨postmanæµ‹è¯•</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@PostMapping(&quot;/postCity&quot;)</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="keyword">public</span> Long <span class="title function_">postCity</span><span class="params">(City city)</span> &#123;</span><br><span class="line">        <span class="type">City</span> <span class="variable">c</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">City</span>(<span class="literal">null</span>, <span class="string">&quot;xian&quot;</span>, <span class="string">&quot;shanxi&quot;</span>, <span class="string">&quot;china&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> cityService.addCity(c);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="æ•´åˆ-MybatisPlus"><a href="#æ•´åˆ-MybatisPlus" class="headerlink" title="æ•´åˆ MybatisPlus"></a>æ•´åˆ MybatisPlus</h3><blockquote>
<p><a href="https://github.com/baomidou/mybatis-plus">MyBatis-Plus (opens new window)</a>ï¼ˆç®€ç§° MPï¼‰æ˜¯ä¸€ä¸ª <a href="https://www.mybatis.org/mybatis-3/">MyBatis (opens new window)</a>çš„å¢å¼ºå·¥å…·ï¼Œåœ¨ MyBatis çš„åŸºç¡€ä¸Šåªåšå¢å¼ºä¸åšæ”¹å˜ï¼Œä¸ºç®€åŒ–å¼€å‘ã€æé«˜æ•ˆç‡è€Œç”Ÿã€‚</p>
</blockquote>
<h5 id="å¼•å…¥ä¾èµ–-2"><a href="#å¼•å…¥ä¾èµ–-2" class="headerlink" title="å¼•å…¥ä¾èµ–"></a>å¼•å…¥ä¾èµ–</h5><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.baomidou<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-plus-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.4.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h5 id="åˆ†æè‡ªåŠ¨é…ç½®-2"><a href="#åˆ†æè‡ªåŠ¨é…ç½®-2" class="headerlink" title="åˆ†æè‡ªåŠ¨é…ç½®"></a>åˆ†æè‡ªåŠ¨é…ç½®</h5><blockquote>
<p>spring.factories</p>
<figure class="highlight properties"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Auto Configure</span></span><br><span class="line"><span class="attr">org.springframework.boot.env.EnvironmentPostProcessor</span>=<span class="string">\</span></span><br><span class="line"><span class="string">  com.baomidou.mybatisplus.autoconfigure.SafetyEncryptProcessor</span></span><br><span class="line"><span class="attr">org.springframework.boot.autoconfigure.EnableAutoConfiguration</span>=<span class="string">\</span></span><br><span class="line"><span class="string">  com.baomidou.mybatisplus.autoconfigure.MybatisPlusLanguageDriverAutoConfiguration,\</span></span><br><span class="line"><span class="string">  com.baomidou.mybatisplus.autoconfigure.MybatisPlusAutoConfiguration</span></span><br></pre></td></tr></table></figure>

<p>MybatisPlusAutoConfiguration</p>
<ul>
<li><p>MybatisPlusProperties ç»‘å®šäº† mybatis-plus</p>
</li>
<li><p>é»˜è®¤çš„ mapperLocations &#x3D; new String[]{â€œclasspath*:&#x2F;mapper&#x2F;**&#x2F;*.xmlâ€};</p>
</li>
<li><p><strong>ä»»æ„åŒ…çš„ç±»è·¯å¾„ä¸‹çš„æ‰€æœ‰mapperæ–‡ä»¶å¤¹ä¸‹ä»»æ„è·¯å¾„ä¸‹çš„æ‰€æœ‰xmléƒ½æ˜¯sqlæ˜ å°„æ–‡ä»¶</strong></p>
</li>
<li><p>è‡ªåŠ¨é…ç½®å¥½äº† SqlSessionFactory ä»¥åŠSqlSessionTemplate</p>
</li>
<li><p>åœ¨ Spring Boot å¯åŠ¨ç±»ä¸­æ·»åŠ  <code>@MapperScan</code> æ³¨è§£ï¼Œæ‰«æ Mapper æ–‡ä»¶å¤¹</p>
<blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@MapperScan(&quot;com.example.springboot.mapper&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SpringBootWebApplication</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        SpringApplication.run(SpringBootWebApplication.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></blockquote>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@ConditionalOnClass(&#123;SqlSessionFactory.class, SqlSessionFactoryBean.class&#125;)</span></span><br><span class="line"><span class="meta">@ConditionalOnSingleCandidate(DataSource.class)</span></span><br><span class="line"><span class="meta">@EnableConfigurationProperties(&#123;MybatisPlusProperties.class&#125;)</span></span><br><span class="line"><span class="meta">@AutoConfigureAfter(&#123;DataSourceAutoConfiguration.class, MybatisPlusLanguageDriverAutoConfiguration.class&#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MybatisPlusAutoConfiguration</span> <span class="keyword">implements</span> <span class="title class_">InitializingBean</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> MybatisPlusProperties properties;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Interceptor[] interceptors;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> TypeHandler[] typeHandlers;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> LanguageDriver[] languageDrivers;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> ResourceLoader resourceLoader;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> DatabaseIdProvider databaseIdProvider;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> List&lt;ConfigurationCustomizer&gt; configurationCustomizers;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> List&lt;MybatisPlusPropertiesCustomizer&gt; mybatisPlusPropertiesCustomizers;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> ApplicationContext applicationContext;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>æ³¨æ„ï¼š</p>
<ul>
<li>å®ä½“ç±»çš„beanMapper åªéœ€è¦ç»§æ‰¿ <strong>BaseMapper</strong> å°±å¯ä»¥æ‹¥æœ‰crudèƒ½åŠ›</li>
<li></li>
</ul>
</blockquote>
<h5 id="é…ç½®ç¤ºä¾‹-2"><a href="#é…ç½®ç¤ºä¾‹-2" class="headerlink" title="é…ç½®ç¤ºä¾‹"></a>é…ç½®ç¤ºä¾‹</h5><p><strong>åªéœ€è¦é…åˆå¥½æ•°æ®æºå³å¯ã€‚</strong></p>
<p>mapperLocations å·²ç»é»˜è®¤é…ç½®å¥½ï¼Œéœ€è¦åœ¨ç±»è·¯å¾„ä¸‹åˆ›å»º mapper æ–‡ä»¶å¤¹</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">datasource:</span></span><br><span class="line">    <span class="attr">driver-class-name:</span> <span class="string">org.h2.Driver</span></span><br><span class="line">    <span class="attr">schema:</span> <span class="string">classpath:db/schema-h2.sql</span></span><br><span class="line">    <span class="attr">data:</span> <span class="string">classpath:db/data-h2.sql</span></span><br><span class="line">    <span class="attr">url:</span> <span class="string">jdbc:h2:mem:test</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">    <span class="attr">password:</span> <span class="string">test</span></span><br></pre></td></tr></table></figure>

<p>è¡¨</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="keyword">user</span></span><br><span class="line">(</span><br><span class="line">    id <span class="type">BIGINT</span>(<span class="number">20</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;ä¸»é”®ID&#x27;</span>,</span><br><span class="line">    name <span class="type">VARCHAR</span>(<span class="number">30</span>) <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;å§“å&#x27;</span>,</span><br><span class="line">    age <span class="type">INT</span>(<span class="number">11</span>) <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;å¹´é¾„&#x27;</span>,</span><br><span class="line">    email <span class="type">VARCHAR</span>(<span class="number">50</span>) <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;é‚®ç®±&#x27;</span>,</span><br><span class="line">    <span class="keyword">PRIMARY</span> KEY (id)</span><br><span class="line">);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> <span class="keyword">user</span> (id, name, age, email) <span class="keyword">VALUES</span></span><br><span class="line">(<span class="number">1</span>, <span class="string">&#x27;Jone&#x27;</span>, <span class="number">18</span>, <span class="string">&#x27;test1@baomidou.com&#x27;</span>),</span><br><span class="line">(<span class="number">2</span>, <span class="string">&#x27;Jack&#x27;</span>, <span class="number">20</span>, <span class="string">&#x27;test2@baomidou.com&#x27;</span>),</span><br><span class="line">(<span class="number">3</span>, <span class="string">&#x27;Tom&#x27;</span>, <span class="number">28</span>, <span class="string">&#x27;test3@baomidou.com&#x27;</span>),</span><br><span class="line">(<span class="number">4</span>, <span class="string">&#x27;Sandy&#x27;</span>, <span class="number">21</span>, <span class="string">&#x27;test4@baomidou.com&#x27;</span>),</span><br><span class="line">(<span class="number">5</span>, <span class="string">&#x27;Billie&#x27;</span>, <span class="number">24</span>, <span class="string">&#x27;test5@baomidou.com&#x27;</span>);</span><br></pre></td></tr></table></figure>

<p>å®ä½“ç±»</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> Integer age;</span><br><span class="line">    <span class="keyword">private</span> String email;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>UserMapper</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserMapper</span> <span class="keyword">extends</span> <span class="title class_">BaseMapper</span>&lt;User&gt; &#123;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>BaseMapperåŒ…å«äº†åŸºæœ¬çš„CRUD</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">BaseMapper</span>&lt;T&gt; <span class="keyword">extends</span> <span class="title class_">Mapper</span>&lt;T&gt; &#123;</span><br><span class="line">    <span class="type">int</span> <span class="title function_">insert</span><span class="params">(T entity)</span>;</span><br><span class="line">    <span class="type">int</span> <span class="title function_">deleteById</span><span class="params">(Serializable id)</span>;</span><br><span class="line">    <span class="type">int</span> <span class="title function_">deleteByMap</span><span class="params">(<span class="meta">@Param(&quot;cm&quot;)</span> Map&lt;String, Object&gt; columnMap)</span>;</span><br><span class="line">    <span class="type">int</span> <span class="title function_">delete</span><span class="params">(<span class="meta">@Param(&quot;ew&quot;)</span> Wrapper&lt;T&gt; queryWrapper)</span>;</span><br><span class="line">    <span class="type">int</span> <span class="title function_">deleteBatchIds</span><span class="params">(<span class="meta">@Param(&quot;coll&quot;)</span> Collection&lt;? extends Serializable&gt; idList)</span>;</span><br><span class="line">    <span class="type">int</span> <span class="title function_">updateById</span><span class="params">(<span class="meta">@Param(&quot;et&quot;)</span> T entity)</span>;</span><br><span class="line">    <span class="type">int</span> <span class="title function_">update</span><span class="params">(<span class="meta">@Param(&quot;et&quot;)</span> T entity, <span class="meta">@Param(&quot;ew&quot;)</span> Wrapper&lt;T&gt; updateWrapper)</span>;</span><br><span class="line">    T <span class="title function_">selectById</span><span class="params">(Serializable id)</span>;</span><br><span class="line">    List&lt;T&gt; <span class="title function_">selectBatchIds</span><span class="params">(<span class="meta">@Param(&quot;coll&quot;)</span> Collection&lt;? extends Serializable&gt; idList)</span>;</span><br><span class="line">    List&lt;T&gt; <span class="title function_">selectByMap</span><span class="params">(<span class="meta">@Param(&quot;cm&quot;)</span> Map&lt;String, Object&gt; columnMap)</span>;</span><br><span class="line">    T <span class="title function_">selectOne</span><span class="params">(<span class="meta">@Param(&quot;ew&quot;)</span> Wrapper&lt;T&gt; queryWrapper)</span>;</span><br><span class="line">    Integer <span class="title function_">selectCount</span><span class="params">(<span class="meta">@Param(&quot;ew&quot;)</span> Wrapper&lt;T&gt; queryWrapper)</span>;</span><br><span class="line">    List&lt;T&gt; <span class="title function_">selectList</span><span class="params">(<span class="meta">@Param(&quot;ew&quot;)</span> Wrapper&lt;T&gt; queryWrapper)</span>;</span><br><span class="line">    List&lt;Map&lt;String, Object&gt;&gt; <span class="title function_">selectMaps</span><span class="params">(<span class="meta">@Param(&quot;ew&quot;)</span> Wrapper&lt;T&gt; queryWrapper)</span>;</span><br><span class="line">    List&lt;Object&gt; <span class="title function_">selectObjs</span><span class="params">(<span class="meta">@Param(&quot;ew&quot;)</span> Wrapper&lt;T&gt; queryWrapper)</span>;</span><br><span class="line">    &lt;E <span class="keyword">extends</span> <span class="title class_">IPage</span>&lt;T&gt;&gt; E <span class="title function_">selectPage</span><span class="params">(E page, <span class="meta">@Param(&quot;ew&quot;)</span> Wrapper&lt;T&gt; queryWrapper)</span>;</span><br><span class="line">    &lt;E <span class="keyword">extends</span> <span class="title class_">IPage</span>&lt;Map&lt;String, Object&gt;&gt;&gt; E <span class="title function_">selectMapsPage</span><span class="params">(E page, <span class="meta">@Param(&quot;ew&quot;)</span> Wrapper&lt;T&gt; queryWrapper)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æµ‹è¯•</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">testUserMapper</span><span class="params">()</span> &#123;</span><br><span class="line">    List&lt;User&gt; userList = userMapper.selectList(<span class="literal">null</span>);</span><br><span class="line">    userList.forEach(System.out::println);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="æ³¨æ„äº‹é¡¹"><a href="#æ³¨æ„äº‹é¡¹" class="headerlink" title="æ³¨æ„äº‹é¡¹"></a>æ³¨æ„äº‹é¡¹</h5><blockquote>
<p>é»˜è®¤å®ä½“ç±»åå’Œè¡¨åç›¸åŒï¼Œå¹¶ä¸”å®ä½“ç±»çš„å­—æ®µåœ¨è¡¨ä¸­éƒ½å­˜åœ¨ï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹æ³¨è§£è¿›è¡Œä¿®æ”¹</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="comment">// æŒ‡å®šè¡¨å</span></span><br><span class="line"><span class="meta">@TableName(&quot;tbl_user&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> Integer age;</span><br><span class="line">    <span class="keyword">private</span> String email;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ’é™¤å…¶ä»–å±æ€§</span></span><br><span class="line">    <span class="meta">@TableField(exist = false)</span></span><br><span class="line">    <span class="keyword">private</span> String otherField;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</blockquote>
<p>UserService</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserService</span> <span class="keyword">extends</span> <span class="title class_">IService</span>&lt;User&gt; &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>UserServiceImpl</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="comment">/*public class UserService implements IService&lt;User&gt; &#123;</span></span><br><span class="line"><span class="comment">	// éœ€è¦æ‰‹åŠ¨å®ç°æ–¹æ³• </span></span><br><span class="line"><span class="comment">&#125;*/</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserServiceImpl</span> <span class="keyword">extends</span> <span class="title class_">ServiceImpl</span>&lt;UserMapper, User&gt; <span class="keyword">implements</span> <span class="title class_">UserService</span> &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="åˆ†é¡µæ’ä»¶é…ç½®"><a href="#åˆ†é¡µæ’ä»¶é…ç½®" class="headerlink" title="åˆ†é¡µæ’ä»¶é…ç½®"></a>åˆ†é¡µæ’ä»¶é…ç½®</h5><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MybatisPlusConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ–°çš„åˆ†é¡µæ’ä»¶,ä¸€ç¼“å’ŒäºŒç¼“éµå¾ªmybatisçš„è§„åˆ™,</span></span><br><span class="line"><span class="comment">     * éœ€è¦è®¾ç½® MybatisConfiguration#useDeprecatedExecutor = false</span></span><br><span class="line"><span class="comment">     * é¿å…ç¼“å­˜å‡ºç°é—®é¢˜(è¯¥å±æ€§ä¼šåœ¨æ—§æ’ä»¶ç§»é™¤åä¸€åŒç§»é™¤)</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> MybatisPlusInterceptor <span class="title function_">mybatisPlusInterceptor</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">MybatisPlusInterceptor</span> <span class="variable">interceptor</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MybatisPlusInterceptor</span>();</span><br><span class="line">        <span class="type">PaginationInnerInterceptor</span> <span class="variable">paginationInnerInterceptor</span> <span class="operator">=</span></span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">PaginationInnerInterceptor</span>(DbType.MYSQL);</span><br><span class="line">        <span class="comment">// overflowï¼šå½“è¯·æ±‚çš„é¡µé¢å¤§äºæœ€å¤§é¡µåï¼Œtrueå›åˆ°é¦–é¡µï¼Œfalseï¼ˆé»˜è®¤ï¼‰ç»§ç»­è¯·æ±‚</span></span><br><span class="line">        paginationInnerInterceptor.setOverflow(<span class="literal">true</span>);</span><br><span class="line">        <span class="comment">// maxLimitï¼šæœ€å¤§å•é¡µé™åˆ¶æ•°é‡ï¼š-1è¡¨ç¤ºä¸å—é™åˆ¶</span></span><br><span class="line">        paginationInnerInterceptor.setMaxLimit(<span class="number">500L</span>);</span><br><span class="line">        interceptor.addInnerInterceptor(paginationInnerInterceptor);</span><br><span class="line">        <span class="keyword">return</span> interceptor;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="controller"><a href="#controller" class="headerlink" title="controller"></a>controller</h5><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">   <span class="meta">@Autowired</span></span><br><span class="line">   <span class="keyword">private</span> UserService userService;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">    * é‡å®šå‘åˆ°å½“å‰é¡µ</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="meta">@GetMapping(&quot;/user/delete/&#123;id&#125;&quot;)</span></span><br><span class="line">   <span class="keyword">public</span> String <span class="title function_">deleteUser</span><span class="params">(<span class="meta">@PathVariable</span> Long id,</span></span><br><span class="line"><span class="params">                            <span class="meta">@RequestParam(value = &quot;pn&quot;, defaultValue = &quot;1&quot;)</span> Integer pn,</span></span><br><span class="line"><span class="params">                            RedirectAttributes ra)</span> &#123;</span><br><span class="line">       userService.removeById(id);</span><br><span class="line">       ra.addAttribute(<span class="string">&quot;pn&quot;</span>, pn);</span><br><span class="line">       <span class="keyword">return</span> <span class="string">&quot;redirect:/dynamic_table&quot;</span>;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="meta">@GetMapping(&quot;/dynamic_table&quot;)</span></span><br><span class="line">   <span class="keyword">public</span> String <span class="title function_">dynamicTable</span><span class="params">(<span class="meta">@RequestParam(value = &quot;pn&quot;, defaultValue = &quot;1&quot;)</span> Integer pn,</span></span><br><span class="line"><span class="params">                              Model model)</span> &#123;</span><br><span class="line">       <span class="comment">/*List&lt;User&gt; users = Arrays.asList(new User(&quot;AA&quot;, &quot;AA-password&quot;),</span></span><br><span class="line"><span class="comment">               new User(&quot;BB&quot;, &quot;BB-password&quot;),</span></span><br><span class="line"><span class="comment">               new User(&quot;CC&quot;, &quot;CC-password&quot;));*/</span></span><br><span class="line">       Page&lt;User&gt; userPage = <span class="keyword">new</span> <span class="title class_">Page</span>&lt;&gt;(pn, <span class="number">2</span>);</span><br><span class="line">       Page&lt;User&gt; page = userService.page(userPage);</span><br><span class="line">       model.addAttribute(<span class="string">&quot;page&quot;</span>, page);</span><br><span class="line">       <span class="keyword">return</span> <span class="string">&quot;table/dynamic_table&quot;</span>;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<h2 id="NoSQL"><a href="#NoSQL" class="headerlink" title="NoSQL"></a>NoSQL</h2><blockquote>
<p>â€‹		Redis æ˜¯ä¸€ä¸ªå¼€æºï¼ˆBSDè®¸å¯ï¼‰çš„ï¼Œå†…å­˜ä¸­çš„æ•°æ®ç»“æ„å­˜å‚¨ç³»ç»Ÿï¼Œå®ƒå¯ä»¥ç”¨ä½œæ•°æ®åº“ã€<strong>ç¼“å­˜</strong>å’Œæ¶ˆæ¯ä¸­é—´ä»¶ã€‚ å®ƒæ”¯æŒå¤šç§ç±»å‹çš„æ•°æ®ç»“æ„ï¼Œå¦‚ <a href="http://www.redis.cn/topics/data-types-intro.html#strings">å­—ç¬¦ä¸²ï¼ˆstringsï¼‰</a>ï¼Œ <a href="http://www.redis.cn/topics/data-types-intro.html#hashes">æ•£åˆ—ï¼ˆhashesï¼‰</a>ï¼Œ <a href="http://www.redis.cn/topics/data-types-intro.html#lists">åˆ—è¡¨ï¼ˆlistsï¼‰</a>ï¼Œ <a href="http://www.redis.cn/topics/data-types-intro.html#sets">é›†åˆï¼ˆsetsï¼‰</a>ï¼Œ <a href="http://www.redis.cn/topics/data-types-intro.html#sorted-sets">æœ‰åºé›†åˆï¼ˆsorted setsï¼‰</a> ä¸èŒƒå›´æŸ¥è¯¢ï¼Œ <a href="http://www.redis.cn/topics/data-types-intro.html#bitmaps">bitmaps</a>ï¼Œ <a href="http://www.redis.cn/topics/data-types-intro.html#hyperloglogs">hyperloglogs</a> å’Œ <a href="http://www.redis.cn/commands/geoadd.html">åœ°ç†ç©ºé—´ï¼ˆgeospatialï¼‰</a> ç´¢å¼•åŠå¾„æŸ¥è¯¢ã€‚ Redis å†…ç½®äº† <a href="http://www.redis.cn/topics/replication.html">å¤åˆ¶ï¼ˆreplicationï¼‰</a>ï¼Œ<a href="http://www.redis.cn/commands/eval.html">LUAè„šæœ¬ï¼ˆLua scriptingï¼‰</a>ï¼Œ <a href="http://www.redis.cn/topics/lru-cache.html">LRUé©±åŠ¨äº‹ä»¶ï¼ˆLRU evictionï¼‰</a>ï¼Œ<a href="http://www.redis.cn/topics/transactions.html">äº‹åŠ¡ï¼ˆtransactionsï¼‰</a> å’Œä¸åŒçº§åˆ«çš„ <a href="http://www.redis.cn/topics/persistence.html">ç£ç›˜æŒä¹…åŒ–ï¼ˆpersistenceï¼‰</a>ï¼Œ å¹¶é€šè¿‡ <a href="http://www.redis.cn/topics/sentinel.html">Rediså“¨å…µï¼ˆSentinelï¼‰</a>å’Œè‡ªåŠ¨ <a href="http://www.redis.cn/topics/cluster-tutorial.html">åˆ†åŒºï¼ˆClusterï¼‰</a>æä¾›é«˜å¯ç”¨æ€§ï¼ˆhigh availabilityï¼‰ã€‚</p>
</blockquote>
<h3 id="Redisè‡ªåŠ¨é…ç½®"><a href="#Redisè‡ªåŠ¨é…ç½®" class="headerlink" title="Redisè‡ªåŠ¨é…ç½®"></a>Redisè‡ªåŠ¨é…ç½®</h3><h4 id="å¼•å…¥ä¾èµ–-3"><a href="#å¼•å…¥ä¾èµ–-3" class="headerlink" title="å¼•å…¥ä¾èµ–"></a>å¼•å…¥ä¾èµ–</h4><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-data-redis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="åˆ†æè‡ªåŠ¨é…ç½®-3"><a href="#åˆ†æè‡ªåŠ¨é…ç½®-3" class="headerlink" title="åˆ†æè‡ªåŠ¨é…ç½®"></a>åˆ†æè‡ªåŠ¨é…ç½®</h4><blockquote>
<p>RedisAutoConfiguration </p>
<p>RedisProperties å’Œ spring.redisç»‘å®š</p>
<p>å¼•å…¥äº†ä¸¤ä¸ªè¿æ¥å·¥å‚ï¼šLettuceConnectionConfigurationï¼ˆé»˜è®¤ï¼‰ï¼ŒJedisConnectionConfiguration</p>
<p><strong>è‡ªåŠ¨æ³¨å…¥äº†RedisTemplate</strong>&lt;**Object**, **Object**&gt; </p>
<p><strong>è‡ªåŠ¨æ³¨å…¥äº†StringRedisTemplateï¼›kï¼šv éƒ½æ˜¯String</strong></p>
<p><strong>åº•å±‚åªè¦æˆ‘ä»¬ä½¿ç”¨</strong> <strong>StringRedisTemplateã€</strong>RedisTemplateå°±å¯ä»¥æ“ä½œredis</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@AutoConfiguration</span></span><br><span class="line"><span class="meta">@ConditionalOnClass(RedisOperations.class)</span></span><br><span class="line"><span class="meta">@EnableConfigurationProperties(RedisProperties.class)</span></span><br><span class="line"><span class="meta">@Import(&#123; LettuceConnectionConfiguration.class, JedisConnectionConfiguration.class &#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RedisAutoConfiguration</span> &#123;</span><br><span class="line">	<span class="meta">@Bean</span></span><br><span class="line">	<span class="meta">@ConditionalOnMissingBean(name = &quot;redisTemplate&quot;)</span></span><br><span class="line">	<span class="meta">@ConditionalOnSingleCandidate(RedisConnectionFactory.class)</span></span><br><span class="line">	<span class="keyword">public</span> RedisTemplate&lt;Object, Object&gt; <span class="title function_">redisTemplate</span><span class="params">(RedisConnectionFactory redisConnectionFactory)</span> &#123;</span><br><span class="line">		RedisTemplate&lt;Object, Object&gt; template = <span class="keyword">new</span> <span class="title class_">RedisTemplate</span>&lt;&gt;();</span><br><span class="line">		template.setConnectionFactory(redisConnectionFactory);</span><br><span class="line">		<span class="keyword">return</span> template;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="meta">@Bean</span></span><br><span class="line">	<span class="meta">@ConditionalOnMissingBean</span></span><br><span class="line">	<span class="meta">@ConditionalOnSingleCandidate(RedisConnectionFactory.class)</span></span><br><span class="line">	<span class="keyword">public</span> StringRedisTemplate <span class="title function_">stringRedisTemplate</span><span class="params">(RedisConnectionFactory redisConnectionFactory)</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">StringRedisTemplate</span>(redisConnectionFactory);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</blockquote>
<h4 id="åˆ‡æ¢-Jedis"><a href="#åˆ‡æ¢-Jedis" class="headerlink" title="åˆ‡æ¢ Jedis"></a>åˆ‡æ¢ Jedis</h4><blockquote>
<ol>
<li>å¼•å…¥ä¾èµ–ï¼š</li>
</ol>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>redis.clients<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jedis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>2. ä¿®æ”¹é…ç½® spring.redis.client-type&#x3D;jedis</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Configuration(proxyBeanMethods = false)</span></span><br><span class="line"><span class="meta">@ConditionalOnClass(RedisClient.class)</span></span><br><span class="line"><span class="meta">@ConditionalOnProperty(name = &quot;spring.redis.client-type&quot;, havingValue = &quot;lettuce&quot;, matchIfMissing = true)</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">LettuceConnectionConfiguration</span> <span class="keyword">extends</span> <span class="title class_">RedisConnectionConfiguration</span> &#123;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">redis:</span></span><br><span class="line">      <span class="attr">host:</span> <span class="number">192.168</span><span class="number">.100</span><span class="number">.100</span></span><br><span class="line">      <span class="attr">port:</span> <span class="number">6379</span></span><br><span class="line">      <span class="attr">client-type:</span> <span class="string">jedis</span></span><br><span class="line">      <span class="attr">jedis:</span></span><br><span class="line">        <span class="attr">pool:</span></span><br><span class="line">          <span class="attr">max-active:</span> <span class="number">10</span></span><br></pre></td></tr></table></figure>
</blockquote>
<h4 id="æµ‹è¯•è¿æ¥-1"><a href="#æµ‹è¯•è¿æ¥-1" class="headerlink" title="æµ‹è¯•è¿æ¥"></a>æµ‹è¯•è¿æ¥</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> RedisTemplate redisTemplate;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">testRedisConnection</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">ValueOperations</span> <span class="variable">ops</span> <span class="operator">=</span> redisTemplate.opsForValue();</span><br><span class="line">    ops.set(<span class="string">&quot;k1&quot;</span>, <span class="string">&quot;v1&quot;</span>);</span><br><span class="line">    <span class="type">Object</span> <span class="variable">v1</span> <span class="operator">=</span> ops.get(<span class="string">&quot;k2&quot;</span>);</span><br><span class="line">    System.out.println(<span class="string">&quot;k1 = &quot;</span> + v1);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="URI-ç»Ÿè®¡"><a href="#URI-ç»Ÿè®¡" class="headerlink" title="URI ç»Ÿè®¡"></a>URI ç»Ÿè®¡</h4><p>æ‹¦æˆªå™¨</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RedisUrlCountInterceptor</span> <span class="keyword">implements</span> <span class="title class_">HandlerInterceptor</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> RedisTemplate redisTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">preHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">uri</span> <span class="operator">=</span> request.getRequestURI();</span><br><span class="line">        <span class="keyword">if</span> (<span class="string">&quot;/main.html&quot;</span>.equals(uri) || <span class="string">&quot;/sql&quot;</span>.equals(uri)) &#123;</span><br><span class="line">            redisTemplate.opsForValue().increment(uri);</span><br><span class="line">            System.out.println(<span class="string">&quot;uri: &quot;</span> + uri);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>é…ç½®æ‹¦æˆªå™¨</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WebConfig</span> <span class="keyword">implements</span> <span class="title class_">WebMvcConfigurer</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> RedisUrlCountInterceptor redisUrlCountInterceptor;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addInterceptors</span><span class="params">(InterceptorRegistry registry)</span> &#123;</span><br><span class="line">        registry.addInterceptor(redisUrlCountInterceptor)</span><br><span class="line">                .addPathPatterns(<span class="string">&quot;/**&quot;</span>)</span><br><span class="line">                .excludePathPatterns(<span class="string">&quot;/&quot;</span>, <span class="string">&quot;login&quot;</span>, <span class="string">&quot;/css/**&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>controller</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/main.html&quot;)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">mainPage</span><span class="params">(HttpSession session, Model model)</span> &#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">main</span> <span class="operator">=</span> stringRedisTemplate.opsForValue().get(<span class="string">&quot;/main.html&quot;</span>);</span><br><span class="line">    <span class="type">String</span> <span class="variable">sql</span> <span class="operator">=</span> stringRedisTemplate.opsForValue().get(<span class="string">&quot;/sql&quot;</span>);</span><br><span class="line">    System.out.println(<span class="string">&quot;main:&quot;</span> + main + <span class="string">&quot;,sql: &quot;</span> + sql);</span><br><span class="line">    model.addAttribute(<span class="string">&quot;mainCount&quot;</span>, main);</span><br><span class="line">    model.addAttribute(<span class="string">&quot;sqlCount&quot;</span>, sql);</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;main&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h1 id="å•å…ƒæµ‹è¯•"><a href="#å•å…ƒæµ‹è¯•" class="headerlink" title="å•å…ƒæµ‹è¯•"></a>å•å…ƒæµ‹è¯•</h1><h2 id="JUnit5-çš„å˜åŒ–"><a href="#JUnit5-çš„å˜åŒ–" class="headerlink" title="JUnit5 çš„å˜åŒ–"></a>JUnit5 çš„å˜åŒ–</h2><p>Junitç±»å…·æœ‰Springçš„åŠŸèƒ½ï¼Œ@Autowiredã€æ¯”å¦‚ @Transactional æ ‡æ³¨æµ‹è¯•æ–¹æ³•ï¼Œæµ‹è¯•å®Œæˆåè‡ªåŠ¨å›æ»š</p>
<blockquote>
<p><strong>Spring Boot 2.2.0 ç‰ˆæœ¬å¼€å§‹å¼•å…¥ JUnit 5 ä½œä¸ºå•å…ƒæµ‹è¯•é»˜è®¤åº“</strong></p>
<p>ä½œä¸ºæœ€æ–°ç‰ˆæœ¬çš„JUnitæ¡†æ¶ï¼ŒJUnit5ä¸ä¹‹å‰ç‰ˆæœ¬çš„Junitæ¡†æ¶æœ‰å¾ˆå¤§çš„ä¸åŒã€‚ç”±ä¸‰ä¸ªä¸åŒå­é¡¹ç›®çš„å‡ ä¸ªä¸åŒæ¨¡å—ç»„æˆã€‚</p>
<p><strong>JUnit 5 &#x3D; JUnit Platform + JUnit Jupiter + JUnit Vintage</strong></p>
<p><strong>JUnit Platform</strong>: Junit Platformæ˜¯åœ¨JVMä¸Šå¯åŠ¨æµ‹è¯•æ¡†æ¶çš„åŸºç¡€ï¼Œä¸ä»…æ”¯æŒJunitè‡ªåˆ¶çš„æµ‹è¯•å¼•æ“ï¼Œå…¶ä»–æµ‹è¯•å¼•æ“ä¹Ÿéƒ½å¯ä»¥æ¥å…¥ã€‚</p>
<p><strong>JUnit Jupiter</strong>: JUnit Jupiteræä¾›äº†JUnit5çš„æ–°çš„ç¼–ç¨‹æ¨¡å‹ï¼Œæ˜¯JUnit5æ–°ç‰¹æ€§çš„æ ¸å¿ƒã€‚å†…éƒ¨ åŒ…å«äº†ä¸€ä¸ª<strong>æµ‹è¯•å¼•æ“</strong>ï¼Œç”¨äºåœ¨Junit Platformä¸Šè¿è¡Œã€‚</p>
<p><strong>JUnit Vintage</strong>: ç”±äºJUint å·²ç»å‘å±•å¤šå¹´ï¼Œä¸ºäº†ç…§é¡¾è€çš„é¡¹ç›®ï¼ŒJUnit Vintageæä¾›äº†å…¼å®¹JUnit4.x,Junit3.xçš„æµ‹è¯•å¼•æ“ã€‚</p>
</blockquote>
<blockquote>
<p>æ³¨æ„ï¼š</p>
<p><strong>SpringBoot 2.4 ä»¥ä¸Šç‰ˆæœ¬ç§»é™¤äº†é»˜è®¤å¯¹</strong> <strong>Vintage çš„ä¾èµ–ã€‚å¦‚æœéœ€è¦å…¼å®¹junit4éœ€è¦è‡ªè¡Œå¼•å…¥ï¼ˆä¸èƒ½ä½¿ç”¨junit4çš„åŠŸèƒ½ @Test</strong>ï¼‰</p>
<p><strong>JUnit 5â€™s Vintage Engine Removed from</strong> spring-boot-starter-testï¼Œå¦‚æœéœ€è¦ç»§ç»­å…¼å®¹ junit4éœ€è¦è‡ªè¡Œå¼•å…¥vintage</p>
<ol>
<li>å¼•å…¥ Junit4 ä¾èµ–</li>
<li>æ’é™¤ hamcrest-core</li>
</ol>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.junit.vintage<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit-vintage-engine<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">exclusions</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.hamcrest<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>hamcrest-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">exclusions</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
</blockquote>
<p><strong>å¼•å…¥ä¾èµ–</strong></p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="JUnit5å¸¸ç”¨æ³¨è§£"><a href="#JUnit5å¸¸ç”¨æ³¨è§£" class="headerlink" title="JUnit5å¸¸ç”¨æ³¨è§£"></a>JUnit5å¸¸ç”¨æ³¨è§£</h2><p>JUnit5çš„æ³¨è§£ä¸JUnit4çš„æ³¨è§£æœ‰æ‰€å˜åŒ–</p>
<p><a href="https://junit.org/junit5/docs/current/user-guide/#writing-tests-annotations">https://junit.org/junit5/docs/current/user-guide/#writing-tests-annotations</a></p>
<blockquote>
<ul>
<li>**@Test :**è¡¨ç¤ºæ–¹æ³•æ˜¯æµ‹è¯•æ–¹æ³•ã€‚ä½†æ˜¯ä¸JUnit4çš„@Testä¸åŒï¼Œä»–çš„èŒè´£éå¸¸å•ä¸€ä¸èƒ½å£°æ˜ä»»ä½•å±æ€§ï¼Œæ‹“å±•çš„æµ‹è¯•å°†ä¼šç”±Jupiteræä¾›é¢å¤–æµ‹è¯•</li>
<li>**@ParameterizedTest :**è¡¨ç¤ºæ–¹æ³•æ˜¯å‚æ•°åŒ–æµ‹è¯•ï¼Œä¸‹æ–¹ä¼šæœ‰è¯¦ç»†ä»‹ç»</li>
<li>**@RepeatedTest :**è¡¨ç¤ºæ–¹æ³•å¯é‡å¤æ‰§è¡Œï¼Œä¸‹æ–¹ä¼šæœ‰è¯¦ç»†ä»‹ç»</li>
<li>**@DisplayName :**ä¸ºæµ‹è¯•ç±»æˆ–è€…æµ‹è¯•æ–¹æ³•è®¾ç½®å±•ç¤ºåç§°</li>
<li>**@BeforeEach :**è¡¨ç¤ºåœ¨æ¯ä¸ªå•å…ƒæµ‹è¯•ä¹‹å‰æ‰§è¡Œ</li>
<li>**@AfterEach :**è¡¨ç¤ºåœ¨æ¯ä¸ªå•å…ƒæµ‹è¯•ä¹‹åæ‰§è¡Œ</li>
<li>**@BeforeAll :**è¡¨ç¤ºåœ¨æ‰€æœ‰å•å…ƒæµ‹è¯•ä¹‹å‰æ‰§è¡Œ</li>
<li>**@AfterAll :**è¡¨ç¤ºåœ¨æ‰€æœ‰å•å…ƒæµ‹è¯•ä¹‹åæ‰§è¡Œ</li>
<li>**@Tag :**è¡¨ç¤ºå•å…ƒæµ‹è¯•ç±»åˆ«ï¼Œç±»ä¼¼äºJUnit4ä¸­çš„@Categories</li>
<li>**@Disabled :**è¡¨ç¤ºæµ‹è¯•ç±»æˆ–æµ‹è¯•æ–¹æ³•ä¸æ‰§è¡Œï¼Œç±»ä¼¼äºJUnit4ä¸­çš„@Ignore</li>
<li>**@Timeout :**è¡¨ç¤ºæµ‹è¯•æ–¹æ³•è¿è¡Œå¦‚æœè¶…è¿‡äº†æŒ‡å®šæ—¶é—´å°†ä¼šè¿”å›é”™è¯¯</li>
<li>**@ExtendWith :**ä¸ºæµ‹è¯•ç±»æˆ–æµ‹è¯•æ–¹æ³•æä¾›æ‰©å±•ç±»å¼•ç”¨</li>
<li>RepeatTestï¼šæµ‹è¯•æ–¹æ³•é‡å¤æ‰§è¡Œå¤šå°‘æ¬¡</li>
</ul>
</blockquote>
<p>ç¤ºä¾‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.WebManageApplication;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.junit.jupiter.api.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.TimeUnit;</span><br><span class="line"></span><br><span class="line"><span class="meta">@DisplayName(&quot;Junit5åŠŸèƒ½æµ‹è¯•&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Junit5Test</span> &#123;</span><br><span class="line">    <span class="meta">@DisplayName(&quot;æµ‹è¯•DisplayName&quot;)</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">testDisplayName</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;æµ‹è¯•DisplayName&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ¯ä¸ªæ–¹æ³•ä¹‹å‰æ‰§è¡Œ</span></span><br><span class="line">    <span class="meta">@BeforeEach</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testBeforeEach</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;BeforeEach...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@BeforeEach</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">testAfterEach</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;AfterEach...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ³¨æ„ï¼š</span></span><br><span class="line"><span class="comment">     * org.junit.platform.commons.JUnitException: <span class="doctag">@BeforeAll</span> method</span></span><br><span class="line"><span class="comment">     * &#x27;void com.example.WebManageApplication.Junit5Test.testBeforeAll()&#x27;</span></span><br><span class="line"><span class="comment">     * must be static unless the test class is annotated with <span class="doctag">@TestInstance</span>(Lifecycle.PER_CLASS).</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="comment">// æ‰€æœ‰æ–¹æ³•ä¹‹å‰æ‰§è¡Œï¼Œåªæ‰§è¡Œä¸€æ¬¡</span></span><br><span class="line">    <span class="meta">@BeforeAll</span></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">testBeforeAll</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;BeforeAll....&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@AfterAll</span></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">testAfterAll</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;AfterAll....&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ä¸æ‰§è¡Œè¯¥æµ‹è¯•æ–¹æ³•</span></span><br><span class="line">    <span class="meta">@Disabled</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">testDisabled</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Disabled...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// è¶…æ—¶</span></span><br><span class="line">    <span class="meta">@Timeout(value = 5, unit = TimeUnit.SECONDS)</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">testTimeout</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Thread.sleep(<span class="number">6000</span>);</span><br><span class="line">            System.out.println(<span class="string">&quot;Timeout...&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// é‡å¤æ‰§è¡Œ4æ¬¡</span></span><br><span class="line">    <span class="meta">@RepeatedTest(4)</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">testRepeatTest</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;RepeatTest...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>æµ‹è¯•ç»“æœï¼š</p>
<p><img src="/2023/02/28/SpringBoot2/Java\SpringBoot\SpringBoot2.assets\image-20221022194150440.png" alt="image-20221022194150440"></p>
<h2 id="æ–­è¨€ï¼ˆassertionsï¼‰"><a href="#æ–­è¨€ï¼ˆassertionsï¼‰" class="headerlink" title="æ–­è¨€ï¼ˆassertionsï¼‰"></a>æ–­è¨€ï¼ˆassertionsï¼‰</h2><blockquote>
<p>æ–­è¨€ï¼ˆassertionsï¼‰æ˜¯æµ‹è¯•æ–¹æ³•ä¸­çš„æ ¸å¿ƒéƒ¨åˆ†ï¼Œç”¨æ¥å¯¹æµ‹è¯•éœ€è¦æ»¡è¶³çš„æ¡ä»¶è¿›è¡ŒéªŒè¯ã€‚<strong>è¿™äº›æ–­è¨€æ–¹æ³•éƒ½æ˜¯ org.junit.jupiter.api.Assertions çš„é™æ€æ–¹æ³•</strong>ã€‚JUnit 5 å†…ç½®çš„æ–­è¨€å¯ä»¥åˆ†æˆå¦‚ä¸‹å‡ ä¸ªç±»åˆ«ï¼š</p>
<p><strong>æ£€æŸ¥ä¸šåŠ¡é€»è¾‘è¿”å›çš„æ•°æ®æ˜¯å¦åˆç†ã€‚</strong></p>
<p><strong>æ‰€æœ‰çš„æµ‹è¯•è¿è¡Œç»“æŸä»¥åï¼Œä¼šæœ‰ä¸€ä¸ªè¯¦ç»†çš„æµ‹è¯•æŠ¥å‘Šï¼›</strong></p>
</blockquote>
<h3 id="ç®€å•æ–­è¨€"><a href="#ç®€å•æ–­è¨€" class="headerlink" title="ç®€å•æ–­è¨€"></a>ç®€å•æ–­è¨€</h3><p>ç”¨æ¥å¯¹å•ä¸ªå€¼è¿›è¡Œç®€å•çš„éªŒè¯ã€‚å¦‚ï¼š</p>
<table>
<thead>
<tr>
<th>æ–¹æ³•</th>
<th>è¯´æ˜</th>
</tr>
</thead>
<tbody><tr>
<td>assertEquals</td>
<td>åˆ¤æ–­ä¸¤ä¸ªå¯¹è±¡æˆ–ä¸¤ä¸ªåŸå§‹ç±»å‹æ˜¯å¦ç›¸ç­‰</td>
</tr>
<tr>
<td>assertNotEquals</td>
<td>åˆ¤æ–­ä¸¤ä¸ªå¯¹è±¡æˆ–ä¸¤ä¸ªåŸå§‹ç±»å‹æ˜¯å¦ä¸ç›¸ç­‰</td>
</tr>
<tr>
<td>assertSame</td>
<td>åˆ¤æ–­ä¸¤ä¸ªå¯¹è±¡å¼•ç”¨æ˜¯å¦æŒ‡å‘åŒä¸€ä¸ªå¯¹è±¡</td>
</tr>
<tr>
<td>assertNotSame</td>
<td>åˆ¤æ–­ä¸¤ä¸ªå¯¹è±¡å¼•ç”¨æ˜¯å¦æŒ‡å‘ä¸åŒçš„å¯¹è±¡</td>
</tr>
<tr>
<td>assertTrue</td>
<td>åˆ¤æ–­ç»™å®šçš„å¸ƒå°”å€¼æ˜¯å¦ä¸º true</td>
</tr>
<tr>
<td>assertFalse</td>
<td>åˆ¤æ–­ç»™å®šçš„å¸ƒå°”å€¼æ˜¯å¦ä¸º false</td>
</tr>
<tr>
<td>assertNull</td>
<td>åˆ¤æ–­ç»™å®šçš„å¯¹è±¡å¼•ç”¨æ˜¯å¦ä¸º null</td>
</tr>
<tr>
<td>assertNotNull</td>
<td>åˆ¤æ–­ç»™å®šçš„å¯¹è±¡å¼•ç”¨æ˜¯å¦ä¸ä¸º null</td>
</tr>
</tbody></table>
<p>ç¤ºä¾‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å‰é¢æ–­è¨€å¤±è´¥ï¼Œåˆ™åé¢çš„æ–­è¨€ä¸ä¼šæ‰§è¡Œ</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line"><span class="meta">@DisplayName(&quot;æµ‹è¯•ç®€å•æ–­è¨€&quot;)</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testSimpleAssert</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">int</span> <span class="variable">ret</span> <span class="operator">=</span> cal(<span class="number">2</span>, <span class="number">3</span>);</span><br><span class="line">    <span class="comment">//        assertEquals(1, ret, &quot;æœŸæœ›å€¼å’Œè®¡ç®—å€¼ä¸ç›¸ç­‰&quot;);</span></span><br><span class="line">    <span class="type">Object</span> <span class="variable">obj1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Object</span>();</span><br><span class="line">    <span class="type">Object</span> <span class="variable">obj2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Object</span>();</span><br><span class="line">    assertSame(obj1, obj2, <span class="string">&quot;å¯¹è±¡å¼•ç”¨ä¸åŒ&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">cal</span><span class="params">(<span class="type">int</span> a, <span class="type">int</span> b)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> a + b;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="æ•°ç»„æ–­è¨€"><a href="#æ•°ç»„æ–­è¨€" class="headerlink" title="æ•°ç»„æ–­è¨€"></a>æ•°ç»„æ–­è¨€</h3><blockquote>
<p>é€šè¿‡ assertArrayEquals æ–¹æ³•æ¥åˆ¤æ–­ä¸¤ä¸ªå¯¹è±¡æˆ–åŸå§‹ç±»å‹çš„æ•°ç»„æ˜¯å¦ç›¸ç­‰ã€‚</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@DisplayName(&quot;æµ‹è¯•æ•°ç»„æ–­è¨€&quot;)</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">testArrayAssert</span><span class="params">()</span> &#123;</span><br><span class="line">    assertArrayEquals(<span class="keyword">new</span> <span class="title class_">int</span>[]&#123;<span class="number">1</span>, <span class="number">2</span>&#125;, <span class="keyword">new</span> <span class="title class_">int</span>[]&#123;<span class="number">2</span>, <span class="number">1</span>&#125;, <span class="string">&quot;æ•°ç»„æ–­è¨€å¤±è´¥&quot;</span>);</span><br><span class="line">    <span class="comment">// org.opentest4j.AssertionFailedError:</span></span><br><span class="line">    <span class="comment">// æ•°ç»„æ–­è¨€å¤±è´¥ ==&gt; array contents differ at index [0], expected: &lt;1&gt; but was: &lt;2&gt;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="ç»„åˆæ–­è¨€"><a href="#ç»„åˆæ–­è¨€" class="headerlink" title="ç»„åˆæ–­è¨€"></a>ç»„åˆæ–­è¨€</h3><blockquote>
<p>assertAll æ–¹æ³•æ¥å—å¤šä¸ª org.junit.jupiter.api.Executable å‡½æ•°å¼æ¥å£çš„å®ä¾‹ä½œä¸ºè¦éªŒè¯çš„æ–­è¨€ï¼Œå¯ä»¥é€šè¿‡ lambda è¡¨è¾¾å¼å¾ˆå®¹æ˜“çš„æä¾›è¿™äº›æ–­è¨€</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@DisplayName(&quot;æµ‹è¯•ç»„åˆæ–­è¨€&quot;)</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">testAssertAll</span><span class="params">()</span> &#123;</span><br><span class="line">    assertAll(<span class="string">&quot;Math&quot;</span>,</span><br><span class="line">            () -&gt; assertEquals(<span class="number">3</span>, <span class="number">1</span> + <span class="number">2</span>, <span class="string">&quot;è®¡ç®—å€¼ä¸ç­‰äº3&quot;</span>),</span><br><span class="line">            () -&gt; assertTrue(<span class="number">2</span> &lt; <span class="number">1</span>, <span class="string">&quot;æ•°å­—å¤§å°åˆ¤æ–­é”™è¯¯&quot;</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="å¼‚å¸¸æ–­è¨€"><a href="#å¼‚å¸¸æ–­è¨€" class="headerlink" title="å¼‚å¸¸æ–­è¨€"></a>å¼‚å¸¸æ–­è¨€</h3><blockquote>
<p>åœ¨JUnit4æ—¶æœŸï¼Œæƒ³è¦æµ‹è¯•æ–¹æ³•çš„å¼‚å¸¸æƒ…å†µæ—¶ï¼Œéœ€è¦ç”¨**@Rule<strong>æ³¨è§£çš„ExpectedExceptionå˜é‡è¿˜æ˜¯æ¯”è¾ƒéº»çƒ¦çš„ã€‚è€ŒJUnit5æä¾›äº†ä¸€ç§æ–°çš„æ–­è¨€æ–¹å¼</strong>Assertions.assertThrows()** ,é…åˆå‡½æ•°å¼ç¼–ç¨‹å°±å¯ä»¥è¿›è¡Œä½¿ç”¨ã€‚</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@DisplayName(&quot;å¼‚å¸¸æ–­è¨€&quot;)</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">testExceptionAssert</span><span class="params">()</span> &#123;</span><br><span class="line">    assertThrows(ArithmeticException.class, () -&gt; &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">a</span> <span class="operator">=</span> <span class="number">10</span> / <span class="number">1</span>;</span><br><span class="line">    &#125;, <span class="string">&quot;ä¸šåŠ¡é€»è¾‘æ²¡æœ‰å‡ºç°å¼‚å¸¸&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="è¶…æ—¶æ–­è¨€"><a href="#è¶…æ—¶æ–­è¨€" class="headerlink" title="è¶…æ—¶æ–­è¨€"></a>è¶…æ—¶æ–­è¨€</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// è¶…æ—¶</span></span><br><span class="line"><span class="comment">// @Timeout(value = 5, unit = TimeUnit.SECONDS)</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">testTimeout</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        Thread.sleep(<span class="number">6000</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;Timeout...&quot;</span>);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="å¿«é€Ÿå¤±è´¥"><a href="#å¿«é€Ÿå¤±è´¥" class="headerlink" title="å¿«é€Ÿå¤±è´¥"></a>å¿«é€Ÿå¤±è´¥</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@DisplayName(&quot;å¿«é€Ÿå¤±è´¥&quot;)</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">testFail</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="number">2</span> == <span class="number">2</span>) &#123;</span><br><span class="line">        fail(<span class="string">&quot;æµ‹è¯•å¤±è´¥&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="å‰ç½®æ¡ä»¶"><a href="#å‰ç½®æ¡ä»¶" class="headerlink" title="å‰ç½®æ¡ä»¶"></a>å‰ç½®æ¡ä»¶</h2><blockquote>
<p>JUnit 5 ä¸­çš„å‰ç½®æ¡ä»¶ï¼ˆ<strong>assumptionsã€å‡è®¾ã€‘</strong>ï¼‰ç±»ä¼¼äºæ–­è¨€ï¼Œä¸åŒä¹‹å¤„åœ¨äº<strong>ä¸æ»¡è¶³çš„æ–­è¨€ä¼šä½¿å¾—æµ‹è¯•æ–¹æ³•å¤±è´¥</strong>ï¼Œè€Œä¸æ»¡è¶³çš„<strong>å‰ç½®æ¡ä»¶åªä¼šä½¿å¾—æµ‹è¯•æ–¹æ³•çš„æ‰§è¡Œç»ˆæ­¢</strong>ã€‚å‰ç½®æ¡ä»¶å¯ä»¥çœ‹æˆæ˜¯æµ‹è¯•æ–¹æ³•æ‰§è¡Œçš„å‰æï¼Œå½“è¯¥å‰æä¸æ»¡è¶³æ—¶ï¼Œå°±æ²¡æœ‰ç»§ç»­æ‰§è¡Œçš„å¿…è¦ã€‚</p>
<p>assumeTrue å’Œ assumFalse ç¡®ä¿ç»™å®šçš„æ¡ä»¶ä¸º true æˆ– falseï¼Œä¸æ»¡è¶³æ¡ä»¶ä¼šä½¿å¾—æµ‹è¯•æ‰§è¡Œç»ˆæ­¢ã€‚assumingThat çš„å‚æ•°æ˜¯è¡¨ç¤ºæ¡ä»¶çš„å¸ƒå°”å€¼å’Œå¯¹åº”çš„ Executable æ¥å£çš„å®ç°å¯¹è±¡ã€‚åªæœ‰æ¡ä»¶æ»¡è¶³æ—¶ï¼ŒExecutable å¯¹è±¡æ‰ä¼šè¢«æ‰§è¡Œï¼›å½“æ¡ä»¶ä¸æ»¡è¶³æ—¶ï¼Œæµ‹è¯•æ‰§è¡Œå¹¶ä¸ä¼šç»ˆæ­¢ã€‚</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@DisplayName(&quot;å‰ç½®æ¡ä»¶&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AssumptionsTest</span> &#123;</span><br><span class="line"> <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">environment</span> <span class="operator">=</span> <span class="string">&quot;DEV&quot;</span>;</span><br><span class="line"> </span><br><span class="line"> <span class="meta">@Test</span></span><br><span class="line"> <span class="meta">@DisplayName(&quot;simple&quot;)</span></span><br><span class="line"> <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">simpleAssume</span><span class="params">()</span> &#123;</span><br><span class="line">    assumeTrue(Objects.equals(<span class="built_in">this</span>.environment, <span class="string">&quot;DEV&quot;</span>));</span><br><span class="line">    assumeFalse(() -&gt; Objects.equals(<span class="built_in">this</span>.environment, <span class="string">&quot;PROD&quot;</span>));</span><br><span class="line"> &#125;</span><br><span class="line"> </span><br><span class="line"> <span class="meta">@Test</span></span><br><span class="line"> <span class="meta">@DisplayName(&quot;assume then do&quot;)</span></span><br><span class="line"> <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">assumeThenDo</span><span class="params">()</span> &#123;</span><br><span class="line">    assumingThat(</span><br><span class="line">       Objects.equals(<span class="built_in">this</span>.environment, <span class="string">&quot;DEV&quot;</span>),</span><br><span class="line">       () -&gt; System.out.println(<span class="string">&quot;In DEV&quot;</span>)</span><br><span class="line">    );</span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="åµŒå¥—æµ‹è¯•"><a href="#åµŒå¥—æµ‹è¯•" class="headerlink" title="åµŒå¥—æµ‹è¯•"></a>åµŒå¥—æµ‹è¯•</h2><blockquote>
<p>JUnit 5 å¯ä»¥é€šè¿‡ Java ä¸­çš„å†…éƒ¨ç±»å’Œ@Nested æ³¨è§£å®ç°åµŒå¥—æµ‹è¯•ï¼Œä»è€Œå¯ä»¥æ›´å¥½çš„æŠŠç›¸å…³çš„æµ‹è¯•æ–¹æ³•ç»„ç»‡åœ¨ä¸€èµ·ã€‚åœ¨å†…éƒ¨ç±»ä¸­å¯ä»¥ä½¿ç”¨@BeforeEach å’Œ@AfterEach æ³¨è§£ï¼Œè€Œä¸”åµŒå¥—çš„å±‚æ¬¡æ²¡æœ‰é™åˆ¶ã€‚</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> org.junit.jupiter.api.*;</span><br><span class="line"><span class="keyword">import</span> java.util.EmptyStackException;</span><br><span class="line"><span class="keyword">import</span> java.util.Stack;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> org.junit.jupiter.api.Assertions.*;</span><br><span class="line"><span class="meta">@DisplayName(&quot;A stack&quot;)</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">TestingAStackDemo</span> &#123;</span><br><span class="line"></span><br><span class="line">    Stack&lt;Object&gt; stack;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="meta">@DisplayName(&quot;is instantiated with new Stack()&quot;)</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">isInstantiatedWithNew</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Stack</span>&lt;&gt;();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Nested</span></span><br><span class="line">    <span class="meta">@DisplayName(&quot;when new&quot;)</span></span><br><span class="line">    <span class="keyword">class</span> <span class="title class_">WhenNew</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@BeforeEach</span></span><br><span class="line">        <span class="keyword">void</span> <span class="title function_">createNewStack</span><span class="params">()</span> &#123;</span><br><span class="line">            stack = <span class="keyword">new</span> <span class="title class_">Stack</span>&lt;&gt;();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Test</span></span><br><span class="line">        <span class="meta">@DisplayName(&quot;is empty&quot;)</span></span><br><span class="line">        <span class="keyword">void</span> <span class="title function_">isEmpty</span><span class="params">()</span> &#123;</span><br><span class="line">            assertTrue(stack.isEmpty());</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Test</span></span><br><span class="line">        <span class="meta">@DisplayName(&quot;throws EmptyStackException when popped&quot;)</span></span><br><span class="line">        <span class="keyword">void</span> <span class="title function_">throwsExceptionWhenPopped</span><span class="params">()</span> &#123;</span><br><span class="line">            assertThrows(EmptyStackException.class, stack::pop);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Test</span></span><br><span class="line">        <span class="meta">@DisplayName(&quot;throws EmptyStackException when peeked&quot;)</span></span><br><span class="line">        <span class="keyword">void</span> <span class="title function_">throwsExceptionWhenPeeked</span><span class="params">()</span> &#123;</span><br><span class="line">            assertThrows(EmptyStackException.class, stack::peek);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Nested</span></span><br><span class="line">        <span class="meta">@DisplayName(&quot;after pushing an element&quot;)</span></span><br><span class="line">        <span class="keyword">class</span> <span class="title class_">AfterPushing</span> &#123;</span><br><span class="line"></span><br><span class="line">            <span class="type">String</span> <span class="variable">anElement</span> <span class="operator">=</span> <span class="string">&quot;an element&quot;</span>;</span><br><span class="line"></span><br><span class="line">            <span class="meta">@BeforeEach</span></span><br><span class="line">            <span class="keyword">void</span> <span class="title function_">pushAnElement</span><span class="params">()</span> &#123;</span><br><span class="line">                stack.push(anElement);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="meta">@Test</span></span><br><span class="line">            <span class="meta">@DisplayName(&quot;it is no longer empty&quot;)</span></span><br><span class="line">            <span class="keyword">void</span> <span class="title function_">isNotEmpty</span><span class="params">()</span> &#123;</span><br><span class="line">                assertFalse(stack.isEmpty());</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="meta">@Test</span></span><br><span class="line">            <span class="meta">@DisplayName(&quot;returns the element when popped and is empty&quot;)</span></span><br><span class="line">            <span class="keyword">void</span> <span class="title function_">returnElementWhenPopped</span><span class="params">()</span> &#123;</span><br><span class="line">                assertEquals(anElement, stack.pop());</span><br><span class="line">                assertTrue(stack.isEmpty());</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="meta">@Test</span></span><br><span class="line">            <span class="meta">@DisplayName(&quot;returns the element when peeked but remains not empty&quot;)</span></span><br><span class="line">            <span class="keyword">void</span> <span class="title function_">returnElementWhenPeeked</span><span class="params">()</span> &#123;</span><br><span class="line">                assertEquals(anElement, stack.peek());</span><br><span class="line">                assertFalse(stack.isEmpty());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="å‚æ•°åŒ–æµ‹è¯•"><a href="#å‚æ•°åŒ–æµ‹è¯•" class="headerlink" title="å‚æ•°åŒ–æµ‹è¯•"></a>å‚æ•°åŒ–æµ‹è¯•</h2><blockquote>
<p>å‚æ•°åŒ–æµ‹è¯•æ˜¯JUnit5å¾ˆé‡è¦çš„ä¸€ä¸ªæ–°ç‰¹æ€§ï¼Œå®ƒä½¿å¾—ç”¨ä¸åŒçš„å‚æ•°å¤šæ¬¡è¿è¡Œæµ‹è¯•æˆä¸ºäº†å¯èƒ½ï¼Œä¹Ÿä¸ºæˆ‘ä»¬çš„å•å…ƒæµ‹è¯•å¸¦æ¥è®¸å¤šä¾¿åˆ©ã€‚</p>
<p>åˆ©ç”¨**@ValueSource**ç­‰æ³¨è§£ï¼ŒæŒ‡å®šå…¥å‚ï¼Œæˆ‘ä»¬å°†å¯ä»¥ä½¿ç”¨ä¸åŒçš„å‚æ•°è¿›è¡Œå¤šæ¬¡å•å…ƒæµ‹è¯•ï¼Œè€Œä¸éœ€è¦æ¯æ–°å¢ä¸€ä¸ªå‚æ•°å°±æ–°å¢ä¸€ä¸ªå•å…ƒæµ‹è¯•ï¼Œçœå»äº†å¾ˆå¤šå†—ä½™ä»£ç ã€‚</p>
<p><strong>@ValueSource</strong>: ä¸ºå‚æ•°åŒ–æµ‹è¯•æŒ‡å®šå…¥å‚æ¥æºï¼Œæ”¯æŒå…«å¤§åŸºç¡€ç±»ä»¥åŠStringç±»å‹,Classç±»å‹</p>
<p><strong>@NullSource</strong>: è¡¨ç¤ºä¸ºå‚æ•°åŒ–æµ‹è¯•æä¾›ä¸€ä¸ªnullçš„å…¥å‚</p>
<p><strong>@EnumSource</strong>: è¡¨ç¤ºä¸ºå‚æ•°åŒ–æµ‹è¯•æä¾›ä¸€ä¸ªæšä¸¾å…¥å‚</p>
<p><strong>@CsvFileSource</strong>ï¼šè¡¨ç¤ºè¯»å–æŒ‡å®šCSVæ–‡ä»¶å†…å®¹ä½œä¸ºå‚æ•°åŒ–æµ‹è¯•å…¥å‚</p>
<p><strong>@MethodSource</strong>ï¼šè¡¨ç¤ºè¯»å–æŒ‡å®šæ–¹æ³•çš„è¿”å›å€¼ä½œä¸ºå‚æ•°åŒ–æµ‹è¯•å…¥å‚(æ³¨æ„æ–¹æ³•è¿”å›éœ€è¦æ˜¯ä¸€ä¸ªæµ)</p>
</blockquote>
<blockquote>
<p>å½“ç„¶å¦‚æœå‚æ•°åŒ–æµ‹è¯•ä»…ä»…åªèƒ½åšåˆ°æŒ‡å®šæ™®é€šçš„å…¥å‚è¿˜è¾¾ä¸åˆ°è®©æˆ‘è§‰å¾—æƒŠè‰³çš„åœ°æ­¥ã€‚è®©æˆ‘çœŸæ­£æ„Ÿåˆ°ä»–çš„å¼ºå¤§ä¹‹å¤„çš„åœ°æ–¹åœ¨äºä»–å¯ä»¥æ”¯æŒå¤–éƒ¨çš„å„ç±»å…¥å‚ã€‚å¦‚:CSV,YML,JSON æ–‡ä»¶ç”šè‡³æ–¹æ³•çš„è¿”å›å€¼ä¹Ÿå¯ä»¥ä½œä¸ºå…¥å‚ã€‚åªéœ€è¦å»å®ç°<strong>ArgumentsProvider</strong>æ¥å£ï¼Œä»»ä½•å¤–éƒ¨æ–‡ä»¶éƒ½å¯ä»¥ä½œä¸ºå®ƒçš„å…¥å‚ã€‚</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@DisplayName(&quot;å‚æ•°åŒ–æµ‹è¯•&quot;)</span></span><br><span class="line"><span class="meta">@ParameterizedTest</span></span><br><span class="line"><span class="comment">// é€šè¿‡æ–¹æ³•ä¼ å‚</span></span><br><span class="line"><span class="meta">@MethodSource(&quot;stringProvider&quot;)</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">testWithSourceValue2</span><span class="params">(String str)</span> &#123;</span><br><span class="line">    System.out.println(str);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="è¿ç§»æŒ‡å—"><a href="#è¿ç§»æŒ‡å—" class="headerlink" title="è¿ç§»æŒ‡å—"></a>è¿ç§»æŒ‡å—</h2><blockquote>
<p>åœ¨è¿›è¡Œè¿ç§»çš„æ—¶å€™éœ€è¦æ³¨æ„å¦‚ä¸‹çš„å˜åŒ–ï¼š</p>
<ul>
<li>æ³¨è§£åœ¨ org.junit.jupiter.api åŒ…ä¸­ï¼Œæ–­è¨€åœ¨ org.junit.jupiter.api.Assertions ç±»ä¸­ï¼Œå‰ç½®æ¡ä»¶åœ¨ org.junit.jupiter.api.Assumptions ç±»ä¸­ã€‚</li>
<li>æŠŠ@Before å’Œ@After æ›¿æ¢æˆ@BeforeEach å’Œ@AfterEachã€‚</li>
<li>æŠŠ@BeforeClass å’Œ@AfterClass æ›¿æ¢æˆ@BeforeAll å’Œ@AfterAllã€‚</li>
<li>æŠŠ@Ignore æ›¿æ¢æˆ@Disabledã€‚</li>
<li>æŠŠ@Category æ›¿æ¢æˆ@Tagã€‚</li>
<li>æŠŠ@RunWithã€@Rule å’Œ@ClassRule æ›¿æ¢æˆ@ExtendWithã€‚</li>
</ul>
</blockquote>
<h1 id="æŒ‡æ ‡ç›‘æ§"><a href="#æŒ‡æ ‡ç›‘æ§" class="headerlink" title="æŒ‡æ ‡ç›‘æ§"></a>æŒ‡æ ‡ç›‘æ§</h1><h2 id="SpringBoot-Actuator"><a href="#SpringBoot-Actuator" class="headerlink" title="SpringBoot Actuator"></a>SpringBoot Actuator</h2><h3 id="ç®€ä»‹-1"><a href="#ç®€ä»‹-1" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h3><blockquote>
<p>æœªæ¥æ¯ä¸€ä¸ªå¾®æœåŠ¡åœ¨äº‘ä¸Šéƒ¨ç½²ä»¥åï¼Œæˆ‘ä»¬éƒ½éœ€è¦å¯¹å…¶è¿›è¡Œç›‘æ§ã€è¿½è¸ªã€å®¡è®¡ã€æ§åˆ¶ç­‰ã€‚SpringBootå°±æŠ½å–äº†Actuatoråœºæ™¯ï¼Œä½¿å¾—æˆ‘ä»¬æ¯ä¸ªå¾®æœåŠ¡å¿«é€Ÿå¼•ç”¨å³å¯è·å¾—ç”Ÿäº§çº§åˆ«çš„åº”ç”¨ç›‘æ§ã€å®¡è®¡ç­‰åŠŸèƒ½ã€‚</p>
</blockquote>
<h1 id="é«˜çº§ç‰¹æ€§"><a href="#é«˜çº§ç‰¹æ€§" class="headerlink" title="é«˜çº§ç‰¹æ€§"></a>é«˜çº§ç‰¹æ€§</h1><h2 id="ç¯å¢ƒåˆ‡æ¢"><a href="#ç¯å¢ƒåˆ‡æ¢" class="headerlink" title="ç¯å¢ƒåˆ‡æ¢"></a>ç¯å¢ƒåˆ‡æ¢</h2><h3 id="Profileæ¡ä»¶è£…é…"><a href="#Profileæ¡ä»¶è£…é…" class="headerlink" title="@Profileæ¡ä»¶è£…é…"></a>@Profileæ¡ä»¶è£…é…</h3><blockquote>
<p>ä¸ºäº†æ–¹ä¾¿å¤šç¯å¢ƒé€‚é…ï¼Œspringbootç®€åŒ–äº†@profileåŠŸèƒ½ã€‚</p>
<h2 id="application-profileåŠŸèƒ½"><a href="#application-profileåŠŸèƒ½" class="headerlink" title="application-profileåŠŸèƒ½"></a>application-profileåŠŸèƒ½</h2><ul>
<li><p>é»˜è®¤é…ç½®æ–‡ä»¶  application.yamlï¼›ä»»ä½•æ—¶å€™éƒ½ä¼šåŠ è½½</p>
</li>
<li><p>æŒ‡å®šç¯å¢ƒé…ç½®æ–‡ä»¶  application-{env}.yaml</p>
</li>
<li><p>æ¿€æ´»æŒ‡å®šç¯å¢ƒ</p>
</li>
<li><ul>
<li>é…ç½®æ–‡ä»¶æ¿€æ´»<ul>
<li>å‘½ä»¤è¡Œæ¿€æ´»ï¼šjava -jar xxx.jar â€“**spring.profiles.active&#x3D;prod  â€“person.name&#x3D;aaa</li>
</ul>
</li>
</ul>
</li>
<li><ul>
<li><ul>
<li><strong>ä¿®æ”¹é…ç½®æ–‡ä»¶çš„ä»»æ„å€¼ï¼Œå‘½ä»¤è¡Œä¼˜å…ˆ</strong></li>
</ul>
</li>
</ul>
</li>
<li><p>é»˜è®¤é…ç½®ä¸ç¯å¢ƒé…ç½®åŒæ—¶ç”Ÿæ•ˆ</p>
</li>
<li><p>åŒåé…ç½®é¡¹ï¼Œprofileé…ç½®ä¼˜å…ˆ</p>
</li>
</ul>
</blockquote>
<p>ç¤ºä¾‹ï¼š</p>
<p>åˆ›å»º Worker å’Œ Boss ç±»ï¼Œéƒ½ç»§æ‰¿äº Person</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.springboot.bean;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Person</span> &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="comment">// ç”Ÿäº§ç¯å¢ƒå’Œé»˜è®¤ç¯å¢ƒéƒ½ä¼šç”Ÿæ•ˆ</span></span><br><span class="line"><span class="meta">@Profile(&#123;&quot;prod&quot;,&quot;default&quot;&#125;)</span></span><br><span class="line"><span class="meta">@ConfigurationProperties(prefix = &quot;person&quot;)</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Boss</span> <span class="keyword">extends</span> <span class="title class_">Person</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> Integer age;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@Profile(&quot;test&quot;)</span></span><br><span class="line"><span class="meta">@ConfigurationProperties(prefix = &quot;person&quot;)</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Worker</span> <span class="keyword">extends</span> <span class="title class_">Person</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> Integer age;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>é…ç½®ç±»ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="comment">//@Profile()    // æ ‡æ³¨ç”Ÿæ•ˆç¯å¢ƒ</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyConfig</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Bean(&quot;red&quot;)</span></span><br><span class="line">    <span class="meta">@Profile(&quot;test&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Color <span class="title function_">red</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Color</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean(&quot;green&quot;)</span></span><br><span class="line">    <span class="meta">@Profile(&quot;prod&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Color <span class="title function_">green</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Color</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>é…ç½®æ–‡ä»¶ï¼š</p>
<p>application-prod.yaml</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">person:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">prod-name</span></span><br><span class="line"></span><br><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">9000</span></span><br></pre></td></tr></table></figure>

<p>application-test.yaml</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">person:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">test-name</span></span><br><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">7000</span></span><br></pre></td></tr></table></figure>

<p>é»˜è®¤é…ç½®ï¼š</p>
<figure class="highlight properties"><table><tr><td class="code"><pre><span class="line"><span class="attr">person.name</span>=<span class="string">default-name</span></span><br><span class="line"><span class="attr">spring.profiles.active</span>=<span class="string">test</span></span><br><span class="line"></span><br><span class="line"><span class="attr">server.port</span>=<span class="string">8000</span></span><br></pre></td></tr></table></figure>

<p>æµ‹è¯•ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HelloController</span> &#123;</span><br><span class="line">    <span class="comment">// å†’å·è¡¨ç¤ºé»˜è®¤å€¼</span></span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;person.name:none-name&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> Person person;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/hello&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">hello</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/person&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">person</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.person.getClass().toString();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>ä½¿ç”¨ spring.profile.active&#x3D;prod æŒ‡å®šé»˜è®¤çš„ prod ç¯å¢ƒ</li>
<li>ä¹Ÿå¯ä»¥ä½¿ç”¨ java -jar xxx.jar â€“**spring.profiles.active&#x3D;prod  â€“person.name&#x3D;aaa</li>
</ul>
<h3 id="Profileåˆ†ç»„"><a href="#Profileåˆ†ç»„" class="headerlink" title="@Profileåˆ†ç»„"></a>@Profileåˆ†ç»„</h3><p>åŒä¸€åˆ†ç»„æ¡ä»¶ä¸‹çš„æ‰€æœ‰é…ç½®éƒ½ä¼šç”Ÿæ•ˆã€‚</p>
<p>ç¤ºä¾‹ï¼šæ–°å»º application-proddb-yaml å’Œ application-prodmq.yamlï¼Œå½“æŒ‡å®šç¯å¢ƒä¸º production æ—¶ï¼Œä¸¤è€…éƒ½ä¼šç”Ÿæ•ˆã€‚</p>
<figure class="highlight properties"><table><tr><td class="code"><pre><span class="line"><span class="attr">spring.profiles.group.production[0]</span>=<span class="string">proddb</span></span><br><span class="line"><span class="attr">spring.profiles.group.production[1]</span>=<span class="string">prodmq</span></span><br><span class="line"></span><br><span class="line"><span class="attr">ä½¿ç”¨ï¼š--spring.profiles.active</span>=<span class="string">production  æ¿€æ´»</span></span><br></pre></td></tr></table></figure>

<h2 id="é…ç½®åŠ è½½çš„ä¼˜å…ˆçº§"><a href="#é…ç½®åŠ è½½çš„ä¼˜å…ˆçº§" class="headerlink" title="é…ç½®åŠ è½½çš„ä¼˜å…ˆçº§"></a>é…ç½®åŠ è½½çš„ä¼˜å…ˆçº§</h2><h3 id="å¤–éƒ¨åŒ–é…ç½®"><a href="#å¤–éƒ¨åŒ–é…ç½®" class="headerlink" title="å¤–éƒ¨åŒ–é…ç½®"></a>å¤–éƒ¨åŒ–é…ç½®</h3><p><a href="https://docs.spring.io/spring-boot/docs/current/reference/html/spring-boot-features.html#boot-features-external-config">https://docs.spring.io/spring-boot/docs/current/reference/html/spring-boot-features.html#boot-features-external-config</a></p>
<p>SpringBoot å¯ä»¥æ¥å—çš„é…ç½®æ¥æºï¼š</p>
<p><strong>Javaå±æ€§æ–‡ä»¶</strong>ã€<strong>YAMLæ–‡ä»¶</strong>ã€<strong>ç¯å¢ƒå˜é‡</strong>ã€<strong>å‘½ä»¤è¡Œå‚æ•°ç­‰</strong></p>
<blockquote>
<ol>
<li>Default properties (specified by setting <code>SpringApplication.setDefaultProperties</code>).</li>
<li><code>@PropertySource</code> annotations on your <code>@Configuration</code> classes. Please note that such property sources are not added to the <code>Environment</code> until the application context is being refreshed. This is too late to configure certain properties such as <code>logging.*</code> and <code>spring.main.*</code> which are read before refresh begins.</li>
<li><strong>Config data (such as</strong> <code>**application.properties**</code> <strong>files)</strong></li>
<li>A <code>RandomValuePropertySource</code> that has properties only in <code>random.*</code>.</li>
<li>OS environment variables.</li>
<li>Java System properties (<code>System.getProperties()</code>).</li>
<li>JNDI attributes from <code>java:comp/env</code>.</li>
<li><code>ServletContext</code> init parameters.</li>
<li><code>ServletConfig</code> init parameters.</li>
<li>Properties from <code>SPRING_APPLICATION_JSON</code> (inline JSON embedded in an environment variable or system property).</li>
<li>Command line arguments.</li>
<li><code>properties</code> attribute on your tests. Available on <code>@SpringBootTest</code> and the <a href="https://docs.spring.io/spring-boot/docs/current/reference/html/spring-boot-features.html#boot-features-testing-spring-boot-applications-testing-autoconfigured-tests">test annotations for testing a particular slice of your application</a>.</li>
<li><code>@TestPropertySource</code> annotations on your tests.</li>
<li><a href="https://docs.spring.io/spring-boot/docs/current/reference/html/using-spring-boot.html#using-boot-devtools-globalsettings">Devtools global settings properties</a> in the <code>$HOME/.config/spring-boot</code> directory when devtools is active.</li>
</ol>
<p><strong>æ³¨æ„ï¼šåé¢çš„ä¼šè¦†ç›–å‰é¢çš„ã€‚</strong></p>
</blockquote>
<h3 id="é…ç½®æ–‡ä»¶æŸ¥æ‰¾ä½ç½®"><a href="#é…ç½®æ–‡ä»¶æŸ¥æ‰¾ä½ç½®" class="headerlink" title="é…ç½®æ–‡ä»¶æŸ¥æ‰¾ä½ç½®"></a>é…ç½®æ–‡ä»¶æŸ¥æ‰¾ä½ç½®</h3><blockquote>
<p>(1) classpath æ ¹è·¯å¾„</p>
<p>(2) classpath æ ¹è·¯å¾„ä¸‹configç›®å½•</p>
<p>(3) jaråŒ…å½“å‰ç›®å½•</p>
<p>(4) jaråŒ…å½“å‰ç›®å½•çš„configç›®å½•</p>
<p>(5) &#x2F;configå­ç›®å½•çš„ç›´æ¥å­ç›®å½•ï¼ˆLinuxç¯å¢ƒä¸‹ï¼‰</p>
<p><strong>æ³¨æ„ï¼šåé¢çš„ä¼šè¦†ç›–å‰é¢çš„ã€‚</strong></p>
</blockquote>
<h3 id="é…ç½®æ–‡ä»¶çš„åŠ è½½é¡ºåº"><a href="#é…ç½®æ–‡ä»¶çš„åŠ è½½é¡ºåº" class="headerlink" title="é…ç½®æ–‡ä»¶çš„åŠ è½½é¡ºåº"></a>é…ç½®æ–‡ä»¶çš„åŠ è½½é¡ºåº</h3><blockquote>
<ol>
<li>ã€€å½“å‰ jar åŒ…å†…éƒ¨çš„ application.properties å’Œ application.yml</li>
<li>ã€€å½“å‰jaråŒ…å†…éƒ¨çš„application-{profile}.properties å’Œ application-{profile}.yml</li>
<li>ã€€å¼•ç”¨çš„å¤–éƒ¨jaråŒ…çš„application.propertieså’Œapplication.yml</li>
<li>ã€€å¼•ç”¨çš„å¤–éƒ¨jaråŒ…çš„application-{profile}.properties å’Œ application-{profile}.yml</li>
</ol>
<p><strong>æ³¨æ„ï¼šåé¢çš„ä¼šè¦†ç›–å‰é¢çš„ã€‚</strong></p>
</blockquote>
<p><strong>æ³¨æ„ï¼šæŒ‡å®šç¯å¢ƒä¼˜å…ˆï¼Œå¤–éƒ¨ä¼˜å…ˆï¼Œåé¢çš„å¯ä»¥è¦†ç›–å‰é¢çš„åŒåé…ç½®é¡¹</strong></p>
<p>ç¤ºä¾‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Value(&quot;$&#123;JAVA_HOME&#125;&quot;)</span></span><br><span class="line"><span class="keyword">private</span> String javaHome;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Value(&quot;$&#123;os.name&#125;&quot;)</span></span><br><span class="line"><span class="keyword">private</span> String osName;</span><br><span class="line"></span><br><span class="line"><span class="meta">@GetMapping(&quot;/system&quot;)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">system</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> javaHome + <span class="string">&quot; : &quot;</span> + osName;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="è‡ªå®šä¹‰starter"><a href="#è‡ªå®šä¹‰starter" class="headerlink" title="è‡ªå®šä¹‰starter"></a>è‡ªå®šä¹‰starter</h2><h3 id="starterå¯åŠ¨åŸç†"><a href="#starterå¯åŠ¨åŸç†" class="headerlink" title="starterå¯åŠ¨åŸç†"></a>starterå¯åŠ¨åŸç†</h3><blockquote>
<img src="/2023/02/28/SpringBoot2/Java\SpringBoot\SpringBoot2.assets\image-20221025191311999.png" alt="image-20221025191311999" style="zoom:67%;">

<ul>
<li><p>autoconfigureåŒ…ä¸­é…ç½®ä½¿ç”¨ <strong>META-INF&#x2F;spring.factories</strong> ä¸­ <strong>EnableAutoConfiguration çš„å€¼ï¼Œä½¿å¾—é¡¹ç›®å¯åŠ¨åŠ è½½æŒ‡å®šçš„è‡ªåŠ¨é…ç½®ç±»</strong></p>
</li>
<li><p><strong>ç¼–å†™è‡ªåŠ¨é…ç½®ç±» xxxAutoConfiguration -&gt; xxxxProperties</strong></p>
</li>
<li><ul>
<li><strong>@Configuration</strong><ul>
<li><strong>@Conditional</strong></li>
<li><strong>@EnableConfigurationProperties</strong></li>
<li><strong>@Bean</strong></li>
</ul>
</li>
</ul>
</li>
</ul>
</blockquote>
<h3 id="ç¤ºä¾‹"><a href="#ç¤ºä¾‹" class="headerlink" title="ç¤ºä¾‹"></a>ç¤ºä¾‹</h3><blockquote>
<p>example-hello-spring-boot-starterï¼ˆå¯åŠ¨å™¨ï¼‰</p>
<p><strong>example-hello-spring-boot-starter-autoconfigureï¼ˆè‡ªåŠ¨é…ç½®åŒ…ï¼‰</strong></p>
</blockquote>
<p>æ­¥éª¤ï¼š</p>
<p>æ–°å»ºç©ºå·¥ç¨‹ï¼šexample-hello-spring-boot-starterï¼Œè¯¥å·¥ç¨‹å¼•å…¥æ¨¡å— example-hello-spring-boot-starter-autoconfigure</p>
<p>åœ¨example-hello-spring-boot-starter-autoconfigureä¸­å¼•å…¥åº•å±‚çš„spring-boot-starterã€‚</p>
<p><strong>example-hello-spring-boot-starterï¼š</strong></p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.example<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>example-hello-spring-boot-starter-autoconfigure<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.0.1-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>example-hello-spring-boot-starter-autoconfigureï¼š</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span>        </span><br><span class="line">	<span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">                   <span class="comment">&lt;!-- å–æ¶ˆæŸ¥æ‰¾æœ¬é¡¹ç›®ä¸‹çš„Mainæ–¹æ³•ï¼šä¸ºäº†è§£å†³Unable to find main classçš„é—®é¢˜ --&gt;</span></span><br><span class="line">                   <span class="tag">&lt;<span class="name">mainClass</span>&gt;</span>none<span class="tag">&lt;/<span class="name">mainClass</span>&gt;</span>  </span><br><span class="line">                    <span class="comment">&lt;!-- ä¸ºäº†è§£å†³ä¾èµ–æ¨¡å—æ‰¾ä¸åˆ°æ­¤æ¨¡å—ä¸­çš„ç±»æˆ–å±æ€§ --&gt;</span></span><br><span class="line">                   <span class="tag">&lt;<span class="name">classifier</span>&gt;</span>execute<span class="tag">&lt;/<span class="name">classifier</span>&gt;</span>   </span><br><span class="line">               <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>åœ¨META-INF&#x2F;spring.factoriesä¸­ï¼š</p>
<figure class="highlight tex"><table><tr><td class="code"><pre><span class="line">org.springframework.boot.autoconfigure.EnableAutoConfiguration=<span class="keyword">\</span></span><br><span class="line"><span class="keyword"></span>com.example.hellostarter.auto.HelloServiceAutoConfiguration</span><br></pre></td></tr></table></figure>

<p>æœåŠ¡ç±»HelloServiceï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.hellostarter.service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.example.hellostarter.bean.HelloProperties;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="comment">// è¯¥ç±»ä¸æ”¾å…¥å®¹å™¨ï¼Œç”±ConditionalXXXå†³å®š</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HelloService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String identify;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> HelloProperties helloProperties;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">hello</span><span class="params">(String name)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> helloProperties.getPrefix() + <span class="string">&quot; : &quot;</span> + name + <span class="string">&quot; : &quot;</span> + helloProperties.getSuffix();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getIdentify</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> identify;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setIdentify</span><span class="params">(String identify)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.identify = identify;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è‡ªåŠ¨é…ç½®ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.hellostarter.auto;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.example.hellostarter.bean.HelloProperties;</span><br><span class="line"><span class="keyword">import</span> com.example.hellostarter.service.HelloService;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.condition.ConditionalOnMissingBean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.context.properties.EnableConfigurationProperties;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="comment">//@ConditionalOnMissingBean(HelloService.class)</span></span><br><span class="line"><span class="meta">@EnableConfigurationProperties(HelloProperties.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HelloServiceAutoConfiguration</span> &#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="meta">@ConditionalOnMissingBean(HelloService.class)</span></span><br><span class="line">    <span class="keyword">public</span> HelloService <span class="title function_">helloService</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">HelloService</span> <span class="variable">helloService</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HelloService</span>();</span><br><span class="line">        <span class="keyword">return</span> helloService;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å±æ€§ç»‘å®šï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.hellostarter.bean;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.context.properties.ConfigurationProperties;</span><br><span class="line"></span><br><span class="line"><span class="meta">@ConfigurationProperties(&quot;example.hello&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HelloProperties</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String prefix;</span><br><span class="line">    <span class="keyword">private</span> String suffix;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getPrefix</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> prefix;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setPrefix</span><span class="params">(String prefix)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.prefix = prefix;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getSuffix</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> suffix;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setSuffix</span><span class="params">(String suffix)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.suffix = suffix;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä½¿ç”¨mvn clean install</p>
<p>æµ‹è¯•ï¼š</p>
<p>æ–°å»ºæµ‹è¯•å·¥ç¨‹ï¼šSpringBoot2-HelloService-Test</p>
<p>å¼•å…¥ä¾èµ–ï¼š</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.example<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>example-hello-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>controllerï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HelloController</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    HelloService helloService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/hello&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">hello</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> helloService.hello(<span class="string">&quot;Start&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¦‚æœæ”¾å…¥è‡ªå®šä¹‰çš„HelloServiceï¼Œåˆ™åŸæ¥çš„ä¸ä¼šç”Ÿæ•ˆã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyConfig</span> &#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> HelloService <span class="title function_">helloService</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">HelloService</span> <span class="variable">helloService</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HelloService</span>();</span><br><span class="line">        helloService.setIdentify(<span class="string">&quot;identify&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> helloService;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h1 id="åŸç†è§£æ"><a href="#åŸç†è§£æ" class="headerlink" title="åŸç†è§£æ"></a>åŸç†è§£æ</h1><h2 id="SpringBootå¯åŠ¨è¿‡ç¨‹"><a href="#SpringBootå¯åŠ¨è¿‡ç¨‹" class="headerlink" title="SpringBootå¯åŠ¨è¿‡ç¨‹"></a>SpringBootå¯åŠ¨è¿‡ç¨‹</h2><h3 id="åˆ›å»º-SpringApplication"><a href="#åˆ›å»º-SpringApplication" class="headerlink" title="åˆ›å»º SpringApplication"></a>åˆ›å»º <strong>SpringApplication</strong></h3>]]></content>
  </entry>
</search>
